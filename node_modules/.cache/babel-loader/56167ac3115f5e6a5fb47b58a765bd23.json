{"remainingRequest":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/thread-loader/dist/cjs.js!/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/babel-loader/lib/index.js!/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/bootstrap-vue/esm/components/tooltip/helpers/bv-tooltip.js","dependencies":[{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/bootstrap-vue/esm/components/tooltip/helpers/bv-tooltip.js","mtime":499162500000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/babel-loader/lib/index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmtleXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zeW1ib2wuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5maWx0ZXIuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuZ2V0LW93bi1wcm9wZXJ0eS1kZXNjcmlwdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5mb3ItZWFjaC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5nZXQtb3duLXByb3BlcnR5LWRlc2NyaXB0b3JzLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuam9pbi5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmNvbmNhdC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNvcnQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zcGxpdC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy50cmltLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnJlcGxhY2UuanMiOwoKZnVuY3Rpb24gb3duS2V5cyhvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7CiAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvYmplY3QpOwoKICBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykgewogICAgdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7CiAgICBpZiAoZW51bWVyYWJsZU9ubHkpIHN5bWJvbHMgPSBzeW1ib2xzLmZpbHRlcihmdW5jdGlvbiAoc3ltKSB7CiAgICAgIHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlOwogICAgfSk7CiAgICBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7CiAgfQoKICByZXR1cm4ga2V5czsKfQoKZnVuY3Rpb24gX29iamVjdFNwcmVhZCh0YXJnZXQpIHsKICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgewogICAgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXSAhPSBudWxsID8gYXJndW1lbnRzW2ldIDoge307CgogICAgaWYgKGkgJSAyKSB7CiAgICAgIG93bktleXMoT2JqZWN0KHNvdXJjZSksIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgIF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOwogICAgICB9KTsKICAgIH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsKICAgIH0gZWxzZSB7CiAgICAgIG93bktleXMoT2JqZWN0KHNvdXJjZSkpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIGtleSkpOwogICAgICB9KTsKICAgIH0KICB9CgogIHJldHVybiB0YXJnZXQ7Cn0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHsKICBpZiAoa2V5IGluIG9iaikgewogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7CiAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgY29uZmlndXJhYmxlOiB0cnVlLAogICAgICB3cml0YWJsZTogdHJ1ZQogICAgfSk7CiAgfSBlbHNlIHsKICAgIG9ialtrZXldID0gdmFsdWU7CiAgfQoKICByZXR1cm4gb2JqOwp9IC8vIFRvb2x0aXAgIkNsYXNzIiAoQnVpbHQgYXMgYSByZW5kZXJsZXNzIFZ1ZSBpbnN0YW5jZSkKLy8KLy8gSGFuZGxlcyB0cmlnZ2VyIGV2ZW50cywgZXRjLgovLyBJbnN0YW50aWF0ZXMgdGVtcGxhdGUgb24gZGVtYW5kCgoKaW1wb3J0IHsgQ09NUE9ORU5UX1VJRF9LRVksIFZ1ZSB9IGZyb20gJy4uLy4uLy4uL3Z1ZSc7CmltcG9ydCB7IE5BTUVfTU9EQUwsIE5BTUVfVE9PTFRJUF9IRUxQRVIgfSBmcm9tICcuLi8uLi8uLi9jb25zdGFudHMvY29tcG9uZW50cyc7CmltcG9ydCB7IEVWRU5UX05BTUVfRElTQUJMRSwgRVZFTlRfTkFNRV9ESVNBQkxFRCwgRVZFTlRfTkFNRV9FTkFCTEUsIEVWRU5UX05BTUVfRU5BQkxFRCwgRVZFTlRfTkFNRV9GT0NVU0lOLCBFVkVOVF9OQU1FX0ZPQ1VTT1VULCBFVkVOVF9OQU1FX0hJRERFTiwgRVZFTlRfTkFNRV9ISURFLCBFVkVOVF9OQU1FX01PVVNFRU5URVIsIEVWRU5UX05BTUVfTU9VU0VMRUFWRSwgRVZFTlRfTkFNRV9TSE9XLCBFVkVOVF9OQU1FX1NIT1dOLCBFVkVOVF9PUFRJT05TX05PX0NBUFRVUkUsIEhPT0tfRVZFTlRfTkFNRV9CRUZPUkVfREVTVFJPWSwgSE9PS19FVkVOVF9OQU1FX0RFU1RST1lFRCB9IGZyb20gJy4uLy4uLy4uL2NvbnN0YW50cy9ldmVudHMnOwppbXBvcnQgeyBhcnJheUluY2x1ZGVzLCBjb25jYXQsIGZyb20gYXMgYXJyYXlGcm9tIH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMvYXJyYXknOwppbXBvcnQgeyBhdHRlbXB0Rm9jdXMsIGNsb3Nlc3QsIGNvbnRhaW5zLCBnZXRBdHRyLCBnZXRCeUlkLCBoYXNBdHRyLCBoYXNDbGFzcywgaXNEaXNhYmxlZCwgaXNFbGVtZW50LCBpc1Zpc2libGUsIHJlbW92ZUF0dHIsIHJlcXVlc3RBRiwgc2VsZWN0LCBzZXRBdHRyIH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMvZG9tJzsKaW1wb3J0IHsgZXZlbnRPZmYsIGV2ZW50T24sIGV2ZW50T25PZmYsIGdldFJvb3RBY3Rpb25FdmVudE5hbWUsIGdldFJvb3RFdmVudE5hbWUgfSBmcm9tICcuLi8uLi8uLi91dGlscy9ldmVudHMnOwppbXBvcnQgeyBnZXRTY29wZUlkIH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMvZ2V0LXNjb3BlLWlkJzsKaW1wb3J0IHsgaWRlbnRpdHkgfSBmcm9tICcuLi8uLi8uLi91dGlscy9pZGVudGl0eSc7CmltcG9ydCB7IGlzRnVuY3Rpb24sIGlzTnVtYmVyLCBpc1BsYWluT2JqZWN0LCBpc1N0cmluZywgaXNVbmRlZmluZWQsIGlzVW5kZWZpbmVkT3JOdWxsIH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMvaW5zcGVjdCc7CmltcG9ydCB7IGxvb3NlRXF1YWwgfSBmcm9tICcuLi8uLi8uLi91dGlscy9sb29zZS1lcXVhbCc7CmltcG9ydCB7IG1hdGhNYXggfSBmcm9tICcuLi8uLi8uLi91dGlscy9tYXRoJzsKaW1wb3J0IHsgbm9vcCB9IGZyb20gJy4uLy4uLy4uL3V0aWxzL25vb3AnOwppbXBvcnQgeyB0b0ludGVnZXIgfSBmcm9tICcuLi8uLi8uLi91dGlscy9udW1iZXInOwppbXBvcnQgeyBrZXlzIH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMvb2JqZWN0JzsKaW1wb3J0IHsgd2FybiB9IGZyb20gJy4uLy4uLy4uL3V0aWxzL3dhcm4nOwppbXBvcnQgeyBCdkV2ZW50IH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMvYnYtZXZlbnQuY2xhc3MnOwppbXBvcnQgeyBsaXN0ZW5PblJvb3RNaXhpbiB9IGZyb20gJy4uLy4uLy4uL21peGlucy9saXN0ZW4tb24tcm9vdCc7CmltcG9ydCB7IEJWVG9vbHRpcFRlbXBsYXRlIH0gZnJvbSAnLi9idi10b29sdGlwLXRlbXBsYXRlJzsgLy8gLS0tIENvbnN0YW50cyAtLS0KLy8gTW9kYWwgY29udGFpbmVyIHNlbGVjdG9yIGZvciBhcHBlbmRpbmcgdG9vbHRpcC9wb3BvdmVyCgp2YXIgTU9EQUxfU0VMRUNUT1IgPSAnLm1vZGFsLWNvbnRlbnQnOyAvLyBNb2RhbCBgJHJvb3RgIGhpZGRlbiBldmVudAoKdmFyIFJPT1RfRVZFTlRfTkFNRV9NT0RBTF9ISURERU4gPSBnZXRSb290RXZlbnROYW1lKE5BTUVfTU9EQUwsIEVWRU5UX05BTUVfSElEREVOKTsgLy8gU2lkZWJhciBjb250YWluZXIgc2VsZWN0b3IgZm9yIGFwcGVuZGluZyB0b29sdGlwL3BvcG92ZXIKCnZhciBTSURFQkFSX1NFTEVDVE9SID0gJy5iLXNpZGViYXInOyAvLyBGb3IgZmluZGluZyB0aGUgY29udGFpbmVyIHRvIGFwcGVuZCB0bwoKdmFyIENPTlRBSU5FUl9TRUxFQ1RPUiA9IFtNT0RBTF9TRUxFQ1RPUiwgU0lERUJBUl9TRUxFQ1RPUl0uam9pbignLCAnKTsgLy8gRm9yIGRyb3Bkb3duIHNuaWZmaW5nCgp2YXIgRFJPUERPV05fQ0xBU1MgPSAnZHJvcGRvd24nOwp2YXIgRFJPUERPV05fT1BFTl9TRUxFQ1RPUiA9ICcuZHJvcGRvd24tbWVudS5zaG93JzsgLy8gRGF0YSBhdHRyaWJ1dGUgdG8gdGVtcG9yYXJ5IHN0b3JlIHRoZSBgdGl0bGVgIGF0dHJpYnV0ZSdzIHZhbHVlCgp2YXIgREFUQV9USVRMRV9BVFRSID0gJ2RhdGEtb3JpZ2luYWwtdGl0bGUnOyAvLyBEYXRhIHNwZWNpZmljIHRvIHBvcHBlciBhbmQgdGVtcGxhdGUKLy8gV2UgZG9uJ3QgdXNlIHByb3BzLCBhcyB3ZSBuZWVkIHJlYWN0aXZpdHkgKHdlIGNhbid0IHBhc3MgcmVhY3RpdmUgcHJvcHMpCgp2YXIgdGVtcGxhdGVEYXRhID0gewogIC8vIFRleHQgc3RyaW5nIG9yIFNjb3BlZCBzbG90IGZ1bmN0aW9uCiAgdGl0bGU6ICcnLAogIC8vIFRleHQgc3RyaW5nIG9yIFNjb3BlZCBzbG90IGZ1bmN0aW9uCiAgY29udGVudDogJycsCiAgLy8gU3RyaW5nCiAgdmFyaWFudDogbnVsbCwKICAvLyBTdHJpbmcsIEFycmF5LCBPYmplY3QKICBjdXN0b21DbGFzczogbnVsbCwKICAvLyBTdHJpbmcgb3IgYXJyYXkgb2YgU3RyaW5ncyAob3ZlcndyaXR0ZW4gYnkgQlZQb3BwZXIpCiAgdHJpZ2dlcnM6ICcnLAogIC8vIFN0cmluZyAob3ZlcndyaXR0ZW4gYnkgQlZQb3BwZXIpCiAgcGxhY2VtZW50OiAnYXV0bycsCiAgLy8gU3RyaW5nIG9yIGFycmF5IG9mIHN0cmluZ3MKICBmYWxsYmFja1BsYWNlbWVudDogJ2ZsaXAnLAogIC8vIEVsZW1lbnQgb3IgQ29tcG9uZW50IHJlZmVyZW5jZSAob3IgZnVuY3Rpb24gdGhhdCByZXR1cm5zIGVsZW1lbnQpIG9mCiAgLy8gdGhlIGVsZW1lbnQgdGhhdCB3aWxsIGhhdmUgdGhlIHRyaWdnZXIgZXZlbnRzIGJvdW5kLCBhbmQgaXMgYWxzbwogIC8vIGRlZmF1bHQgZWxlbWVudCBmb3IgcG9zaXRpb25pbmcKICB0YXJnZXQ6IG51bGwsCiAgLy8gSFRNTCBJRCwgRWxlbWVudCBvciBDb21wb25lbnQgcmVmZXJlbmNlCiAgY29udGFpbmVyOiBudWxsLAogIC8vICdib2R5JwogIC8vIEJvb2xlYW4KICBub0ZhZGU6IGZhbHNlLAogIC8vICdzY3JvbGxQYXJlbnQnLCAndmlld3BvcnQnLCAnd2luZG93JywgRWxlbWVudCwgb3IgQ29tcG9uZW50IHJlZmVyZW5jZQogIGJvdW5kYXJ5OiAnc2Nyb2xsUGFyZW50JywKICAvLyBUb29sdGlwL3BvcG92ZXIgd2lsbCB0cnkgYW5kIHN0YXkgYXdheSBmcm9tCiAgLy8gYm91bmRhcnkgZWRnZSBieSB0aGlzIG1hbnkgcGl4ZWxzIChOdW1iZXIpCiAgYm91bmRhcnlQYWRkaW5nOiA1LAogIC8vIEFycm93IG9mZnNldCAoTnVtYmVyKQogIG9mZnNldDogMCwKICAvLyBIb3Zlci9mb2N1cyBkZWxheSAoTnVtYmVyIG9yIE9iamVjdCkKICBkZWxheTogMCwKICAvLyBBcnJvdyBvZiBUb29sdGlwL3BvcG92ZXIgd2lsbCB0cnkgYW5kIHN0YXkgYXdheSBmcm9tCiAgLy8gdGhlIGVkZ2Ugb2YgdG9vbHRpcC9wb3BvdmVyIGVkZ2UgYnkgdGhpcyBtYW55IHBpeGVscwogIGFycm93UGFkZGluZzogNiwKICAvLyBJbnRlcmFjdGl2ZSBzdGF0ZSAoQm9vbGVhbikKICBpbnRlcmFjdGl2ZTogdHJ1ZSwKICAvLyBEaXNhYmxlZCBzdGF0ZSAoQm9vbGVhbikKICBkaXNhYmxlZDogZmFsc2UsCiAgLy8gSUQgdG8gdXNlIGZvciB0b29sdGlwL3BvcG92ZXIKICBpZDogbnVsbCwKICAvLyBGbGFnIHVzZWQgYnkgZGlyZWN0aXZlcyBvbmx5LCBmb3IgSFRNTCBjb250ZW50CiAgaHRtbDogZmFsc2UKfTsgLy8gLS0tIE1haW4gY29tcG9uZW50IC0tLQovLyBAdnVlL2NvbXBvbmVudAoKZXhwb3J0IHZhciBCVlRvb2x0aXAgPSAvKiNfX1BVUkVfXyovVnVlLmV4dGVuZCh7CiAgbmFtZTogTkFNRV9UT09MVElQX0hFTFBFUiwKICBtaXhpbnM6IFtsaXN0ZW5PblJvb3RNaXhpbl0sCiAgZGF0YTogZnVuY3Rpb24gZGF0YSgpIHsKICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIHRlbXBsYXRlRGF0YSksIHt9LCB7CiAgICAgIC8vIFN0YXRlIG1hbmFnZW1lbnQgZGF0YQogICAgICBhY3RpdmVUcmlnZ2VyOiB7CiAgICAgICAgLy8gbWFudWFsOiBmYWxzZSwKICAgICAgICBob3ZlcjogZmFsc2UsCiAgICAgICAgY2xpY2s6IGZhbHNlLAogICAgICAgIGZvY3VzOiBmYWxzZQogICAgICB9LAogICAgICBsb2NhbFNob3c6IGZhbHNlCiAgICB9KTsKICB9LAogIGNvbXB1dGVkOiB7CiAgICB0ZW1wbGF0ZVR5cGU6IGZ1bmN0aW9uIHRlbXBsYXRlVHlwZSgpIHsKICAgICAgLy8gT3ZlcndyaXR0ZW4gYnkgQlZQb3BvdmVyCiAgICAgIHJldHVybiAndG9vbHRpcCc7CiAgICB9LAogICAgY29tcHV0ZWRJZDogZnVuY3Rpb24gY29tcHV0ZWRJZCgpIHsKICAgICAgcmV0dXJuIHRoaXMuaWQgfHwgIl9fYnZfIi5jb25jYXQodGhpcy50ZW1wbGF0ZVR5cGUsICJfIikuY29uY2F0KHRoaXNbQ09NUE9ORU5UX1VJRF9LRVldLCAiX18iKTsKICAgIH0sCiAgICBjb21wdXRlZERlbGF5OiBmdW5jdGlvbiBjb21wdXRlZERlbGF5KCkgewogICAgICAvLyBOb3JtYWxpemVzIGRlbGF5IGludG8gb2JqZWN0IGZvcm0KICAgICAgdmFyIGRlbGF5ID0gewogICAgICAgIHNob3c6IDAsCiAgICAgICAgaGlkZTogMAogICAgICB9OwoKICAgICAgaWYgKGlzUGxhaW5PYmplY3QodGhpcy5kZWxheSkpIHsKICAgICAgICBkZWxheS5zaG93ID0gbWF0aE1heCh0b0ludGVnZXIodGhpcy5kZWxheS5zaG93LCAwKSwgMCk7CiAgICAgICAgZGVsYXkuaGlkZSA9IG1hdGhNYXgodG9JbnRlZ2VyKHRoaXMuZGVsYXkuaGlkZSwgMCksIDApOwogICAgICB9IGVsc2UgaWYgKGlzTnVtYmVyKHRoaXMuZGVsYXkpIHx8IGlzU3RyaW5nKHRoaXMuZGVsYXkpKSB7CiAgICAgICAgZGVsYXkuc2hvdyA9IGRlbGF5LmhpZGUgPSBtYXRoTWF4KHRvSW50ZWdlcih0aGlzLmRlbGF5LCAwKSwgMCk7CiAgICAgIH0KCiAgICAgIHJldHVybiBkZWxheTsKICAgIH0sCiAgICBjb21wdXRlZFRyaWdnZXJzOiBmdW5jdGlvbiBjb21wdXRlZFRyaWdnZXJzKCkgewogICAgICAvLyBSZXR1cm5zIHRoZSB0cmlnZ2VycyBpbiBzb3J0ZWQgYXJyYXkgZm9ybQogICAgICAvLyBUT0RPOiBTd2l0Y2ggdGhpcyB0byBvYmplY3QgZm9ybSBmb3IgZWFzaWVyIGxvb2t1cAogICAgICByZXR1cm4gY29uY2F0KHRoaXMudHJpZ2dlcnMpLmZpbHRlcihpZGVudGl0eSkuam9pbignICcpLnRyaW0oKS50b0xvd2VyQ2FzZSgpLnNwbGl0KC9ccysvKS5zb3J0KCk7CiAgICB9LAogICAgaXNXaXRoQWN0aXZlVHJpZ2dlcjogZnVuY3Rpb24gaXNXaXRoQWN0aXZlVHJpZ2dlcigpIHsKICAgICAgZm9yICh2YXIgdHJpZ2dlciBpbiB0aGlzLmFjdGl2ZVRyaWdnZXIpIHsKICAgICAgICBpZiAodGhpcy5hY3RpdmVUcmlnZ2VyW3RyaWdnZXJdKSB7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0sCiAgICBjb21wdXRlZFRlbXBsYXRlRGF0YTogZnVuY3Rpb24gY29tcHV0ZWRUZW1wbGF0ZURhdGEoKSB7CiAgICAgIHZhciB0aXRsZSA9IHRoaXMudGl0bGUsCiAgICAgICAgICBjb250ZW50ID0gdGhpcy5jb250ZW50LAogICAgICAgICAgdmFyaWFudCA9IHRoaXMudmFyaWFudCwKICAgICAgICAgIGN1c3RvbUNsYXNzID0gdGhpcy5jdXN0b21DbGFzcywKICAgICAgICAgIG5vRmFkZSA9IHRoaXMubm9GYWRlLAogICAgICAgICAgaW50ZXJhY3RpdmUgPSB0aGlzLmludGVyYWN0aXZlOwogICAgICByZXR1cm4gewogICAgICAgIHRpdGxlOiB0aXRsZSwKICAgICAgICBjb250ZW50OiBjb250ZW50LAogICAgICAgIHZhcmlhbnQ6IHZhcmlhbnQsCiAgICAgICAgY3VzdG9tQ2xhc3M6IGN1c3RvbUNsYXNzLAogICAgICAgIG5vRmFkZTogbm9GYWRlLAogICAgICAgIGludGVyYWN0aXZlOiBpbnRlcmFjdGl2ZQogICAgICB9OwogICAgfQogIH0sCiAgd2F0Y2g6IHsKICAgIGNvbXB1dGVkVHJpZ2dlcnM6IGZ1bmN0aW9uIGNvbXB1dGVkVHJpZ2dlcnMobmV3VHJpZ2dlcnMsIG9sZFRyaWdnZXJzKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7IC8vIFRyaWdnZXJzIGhhdmUgY2hhbmdlZCwgc28gcmUtcmVnaXN0ZXIgdGhlbQoKICAgICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8KCgogICAgICBpZiAoIWxvb3NlRXF1YWwobmV3VHJpZ2dlcnMsIG9sZFRyaWdnZXJzKSkgewogICAgICAgIHRoaXMuJG5leHRUaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIC8vIERpc2FibGUgdHJpZ2dlciBsaXN0ZW5lcnMKICAgICAgICAgIF90aGlzLnVuTGlzdGVuKCk7IC8vIENsZWFyIGFueSBhY3RpdmUgdHJpZ2dlcnMgdGhhdCBhcmUgbm8gbG9uZ2VyIGluIHRoZSBsaXN0IG9mIHRyaWdnZXJzCgoKICAgICAgICAgIG9sZFRyaWdnZXJzLmZvckVhY2goZnVuY3Rpb24gKHRyaWdnZXIpIHsKICAgICAgICAgICAgaWYgKCFhcnJheUluY2x1ZGVzKG5ld1RyaWdnZXJzLCB0cmlnZ2VyKSkgewogICAgICAgICAgICAgIGlmIChfdGhpcy5hY3RpdmVUcmlnZ2VyW3RyaWdnZXJdKSB7CiAgICAgICAgICAgICAgICBfdGhpcy5hY3RpdmVUcmlnZ2VyW3RyaWdnZXJdID0gZmFsc2U7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9KTsgLy8gUmUtZW5hYmxlIHRoZSB0cmlnZ2VyIGxpc3RlbmVycwoKICAgICAgICAgIF90aGlzLmxpc3RlbigpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgY29tcHV0ZWRUZW1wbGF0ZURhdGE6IGZ1bmN0aW9uIGNvbXB1dGVkVGVtcGxhdGVEYXRhKCkgewogICAgICAvLyBJZiBhbnkgb2YgdGhlIHdoaWxlIG9wZW4gcmVhY3RpdmUgInByb3BzIiBjaGFuZ2UsCiAgICAgIC8vIGVuc3VyZSB0aGF0IHRoZSB0ZW1wbGF0ZSB1cGRhdGVzIGFjY29yZGluZ2x5CiAgICAgIHRoaXMuaGFuZGxlVGVtcGxhdGVVcGRhdGUoKTsKICAgIH0sCiAgICB0aXRsZTogZnVuY3Rpb24gdGl0bGUobmV3VmFsdWUsIG9sZFZhbHVlKSB7CiAgICAgIC8vIE1ha2Ugc3VyZSB0byBoaWRlIHRoZSB0b29sdGlwIHdoZW4gdGhlIHRpdGxlIGlzIHNldCBlbXB0eQogICAgICBpZiAobmV3VmFsdWUgIT09IG9sZFZhbHVlICYmICFuZXdWYWx1ZSkgewogICAgICAgIHRoaXMuaGlkZSgpOwogICAgICB9CiAgICB9LAogICAgZGlzYWJsZWQ6IGZ1bmN0aW9uIGRpc2FibGVkKG5ld1ZhbHVlKSB7CiAgICAgIGlmIChuZXdWYWx1ZSkgewogICAgICAgIHRoaXMuZGlzYWJsZSgpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZW5hYmxlKCk7CiAgICAgIH0KICAgIH0KICB9LAogIGNyZWF0ZWQ6IGZ1bmN0aW9uIGNyZWF0ZWQoKSB7CiAgICB2YXIgX3RoaXMyID0gdGhpczsgLy8gQ3JlYXRlIG5vbi1yZWFjdGl2ZSBwcm9wZXJ0aWVzCgoKICAgIHRoaXMuJF90aXAgPSBudWxsOwogICAgdGhpcy4kX2hvdmVyVGltZW91dCA9IG51bGw7CiAgICB0aGlzLiRfaG92ZXJTdGF0ZSA9ICcnOwogICAgdGhpcy4kX3Zpc2libGVJbnRlcnZhbCA9IG51bGw7CiAgICB0aGlzLiRfZW5hYmxlZCA9ICF0aGlzLmRpc2FibGVkOwogICAgdGhpcy4kX25vb3AgPSBub29wLmJpbmQodGhpcyk7IC8vIERlc3Ryb3kgb3Vyc2VsdmVzIHdoZW4gdGhlIHBhcmVudCBpcyBkZXN0cm95ZWQKCiAgICBpZiAodGhpcy4kcGFyZW50KSB7CiAgICAgIHRoaXMuJHBhcmVudC4kb25jZShIT09LX0VWRU5UX05BTUVfQkVGT1JFX0RFU1RST1ksIGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczIuJG5leHRUaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIC8vIEluIGEgYHJlcXVlc3RBRigpYCB0byByZWxlYXNlIGNvbnRyb2wgYmFjayB0byBhcHBsaWNhdGlvbgogICAgICAgICAgcmVxdWVzdEFGKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgX3RoaXMyLiRkZXN0cm95KCk7CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CgogICAgdGhpcy4kbmV4dFRpY2soZnVuY3Rpb24gKCkgewogICAgICB2YXIgdGFyZ2V0ID0gX3RoaXMyLmdldFRhcmdldCgpOwoKICAgICAgaWYgKHRhcmdldCAmJiBjb250YWlucyhkb2N1bWVudC5ib2R5LCB0YXJnZXQpKSB7CiAgICAgICAgLy8gQ29weSB0aGUgcGFyZW50J3Mgc2NvcGVkIHN0eWxlIGF0dHJpYnV0ZQogICAgICAgIF90aGlzMi5zY29wZUlkID0gZ2V0U2NvcGVJZChfdGhpczIuJHBhcmVudCk7IC8vIFNldCB1cCBhbGwgdHJpZ2dlciBoYW5kbGVycyBhbmQgbGlzdGVuZXJzCgogICAgICAgIF90aGlzMi5saXN0ZW4oKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwogICAgICAgIHdhcm4oaXNTdHJpbmcoX3RoaXMyLnRhcmdldCkgPyAiVW5hYmxlIHRvIGZpbmQgdGFyZ2V0IGVsZW1lbnQgYnkgSUQgXCIjIi5jb25jYXQoX3RoaXMyLnRhcmdldCwgIlwiIGluIGRvY3VtZW50LiIpIDogJ1RoZSBwcm92aWRlZCB0YXJnZXQgaXMgbm8gdmFsaWQgSFRNTCBlbGVtZW50LicsIF90aGlzMi50ZW1wbGF0ZVR5cGUpOwogICAgICB9CiAgICB9KTsKICB9LAoKICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwogIHVwZGF0ZWQ6IGZ1bmN0aW9uIHVwZGF0ZWQoKSB7CiAgICAvLyBVc3VhbGx5IGNhbGxlZCB3aGVuIHRoZSBzbG90cy9kYXRhIGNoYW5nZXMKICAgIHRoaXMuJG5leHRUaWNrKHRoaXMuaGFuZGxlVGVtcGxhdGVVcGRhdGUpOwogIH0sCgogIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgZGVhY3RpdmF0ZWQ6IGZ1bmN0aW9uIGRlYWN0aXZhdGVkKCkgewogICAgLy8gSW4gYSBrZWVwYWxpdmUgdGhhdCBoYXMgYmVlbiBkZWFjdGl2YXRlZCwgc28gaGlkZQogICAgLy8gdGhlIHRvb2x0aXAvcG9wb3ZlciBpZiBpdCBpcyBzaG93aW5nCiAgICB0aGlzLmZvcmNlSGlkZSgpOwogIH0sCiAgYmVmb3JlRGVzdHJveTogZnVuY3Rpb24gYmVmb3JlRGVzdHJveSgpIHsKICAgIC8vIFJlbW92ZSBhbGwgaGFuZGxlci9saXN0ZW5lcnMKICAgIHRoaXMudW5MaXN0ZW4oKTsKICAgIHRoaXMuc2V0V2hpbGVPcGVuTGlzdGVuZXJzKGZhbHNlKTsgLy8gQ2xlYXIgYW55IHRpbWVvdXRzL2ludGVydmFscwoKICAgIHRoaXMuY2xlYXJIb3ZlclRpbWVvdXQoKTsKICAgIHRoaXMuY2xlYXJWaXNpYmlsaXR5SW50ZXJ2YWwoKTsgLy8gRGVzdHJveSB0aGUgdGVtcGxhdGUKCiAgICB0aGlzLmRlc3Ryb3lUZW1wbGF0ZSgpOyAvLyBSZW1vdmUgYW55IG90aGVyIHByaXZhdGUgcHJvcGVydGllcyBjcmVhdGVkIGR1cmluZyBjcmVhdGUKCiAgICB0aGlzLiRfbm9vcCA9IG51bGw7CiAgfSwKICBtZXRob2RzOiB7CiAgICAvLyAtLS0gTWV0aG9kcyBmb3IgY3JlYXRpbmcgYW5kIGRlc3Ryb3lpbmcgdGhlIHRlbXBsYXRlIC0tLQogICAgZ2V0VGVtcGxhdGU6IGZ1bmN0aW9uIGdldFRlbXBsYXRlKCkgewogICAgICAvLyBPdmVycmlkZGVuIGJ5IEJWUG9wb3ZlcgogICAgICByZXR1cm4gQlZUb29sdGlwVGVtcGxhdGU7CiAgICB9LAogICAgdXBkYXRlRGF0YTogZnVuY3Rpb24gdXBkYXRlRGF0YSgpIHsKICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgICB2YXIgZGF0YSA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDoge307IC8vIE1ldGhvZCBmb3IgdXBkYXRpbmcgcG9wcGVyL3RlbXBsYXRlIGRhdGEKICAgICAgLy8gV2Ugb25seSB1cGRhdGUgZGF0YSBpZiBpdCBleGlzdHMsIGFuZCBoYXMgbm90IGNoYW5nZWQKCiAgICAgIHZhciB0aXRsZVVwZGF0ZWQgPSBmYWxzZTsKICAgICAga2V5cyh0ZW1wbGF0ZURhdGEpLmZvckVhY2goZnVuY3Rpb24gKHByb3ApIHsKICAgICAgICBpZiAoIWlzVW5kZWZpbmVkKGRhdGFbcHJvcF0pICYmIF90aGlzM1twcm9wXSAhPT0gZGF0YVtwcm9wXSkgewogICAgICAgICAgX3RoaXMzW3Byb3BdID0gZGF0YVtwcm9wXTsKCiAgICAgICAgICBpZiAocHJvcCA9PT0gJ3RpdGxlJykgewogICAgICAgICAgICB0aXRsZVVwZGF0ZWQgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7IC8vIElmIHRoZSB0aXRsZSBoYXMgdXBkYXRlZCwgd2UgbWF5IG5lZWQgdG8gaGFuZGxlIHRoZSBgdGl0bGVgCiAgICAgIC8vIGF0dHJpYnV0ZSBvbiB0aGUgdHJpZ2dlciB0YXJnZXQKICAgICAgLy8gV2Ugb25seSBkbyB0aGlzIHdoaWxlIHRoZSB0ZW1wbGF0ZSBpcyBvcGVuCgogICAgICBpZiAodGl0bGVVcGRhdGVkICYmIHRoaXMubG9jYWxTaG93KSB7CiAgICAgICAgdGhpcy5maXhUaXRsZSgpOwogICAgICB9CiAgICB9LAogICAgY3JlYXRlVGVtcGxhdGVBbmRTaG93OiBmdW5jdGlvbiBjcmVhdGVUZW1wbGF0ZUFuZFNob3coKSB7CiAgICAgIC8vIENyZWF0ZXMgdGhlIHRlbXBsYXRlIGluc3RhbmNlIGFuZCBzaG93IGl0CiAgICAgIHZhciBjb250YWluZXIgPSB0aGlzLmdldENvbnRhaW5lcigpOwogICAgICB2YXIgVGVtcGxhdGUgPSB0aGlzLmdldFRlbXBsYXRlKCk7CiAgICAgIHZhciAkdGlwID0gdGhpcy4kX3RpcCA9IG5ldyBUZW1wbGF0ZSh7CiAgICAgICAgcGFyZW50OiB0aGlzLAogICAgICAgIC8vIFRoZSBmb2xsb3dpbmcgaXMgbm90IHJlYWN0aXZlIHRvIGNoYW5nZXMgaW4gdGhlIHByb3BzIGRhdGEKICAgICAgICBwcm9wc0RhdGE6IHsKICAgICAgICAgIC8vIFRoZXNlIHZhbHVlcyBjYW5ub3QgYmUgY2hhbmdlZCB3aGlsZSB0ZW1wbGF0ZSBpcyBzaG93aW5nCiAgICAgICAgICBpZDogdGhpcy5jb21wdXRlZElkLAogICAgICAgICAgaHRtbDogdGhpcy5odG1sLAogICAgICAgICAgcGxhY2VtZW50OiB0aGlzLnBsYWNlbWVudCwKICAgICAgICAgIGZhbGxiYWNrUGxhY2VtZW50OiB0aGlzLmZhbGxiYWNrUGxhY2VtZW50LAogICAgICAgICAgdGFyZ2V0OiB0aGlzLmdldFBsYWNlbWVudFRhcmdldCgpLAogICAgICAgICAgYm91bmRhcnk6IHRoaXMuZ2V0Qm91bmRhcnkoKSwKICAgICAgICAgIC8vIEVuc3VyZSB0aGUgZm9sbG93aW5nIGFyZSBpbnRlZ2VycwogICAgICAgICAgb2Zmc2V0OiB0b0ludGVnZXIodGhpcy5vZmZzZXQsIDApLAogICAgICAgICAgYXJyb3dQYWRkaW5nOiB0b0ludGVnZXIodGhpcy5hcnJvd1BhZGRpbmcsIDApLAogICAgICAgICAgYm91bmRhcnlQYWRkaW5nOiB0b0ludGVnZXIodGhpcy5ib3VuZGFyeVBhZGRpbmcsIDApCiAgICAgICAgfQogICAgICB9KTsgLy8gV2Ugc2V0IHRoZSBpbml0aWFsIHJlYWN0aXZlIGRhdGEgKHZhbHVlcyB0aGF0IGNhbiBiZSBjaGFuZ2VkIHdoaWxlIG9wZW4pCgogICAgICB0aGlzLmhhbmRsZVRlbXBsYXRlVXBkYXRlKCk7IC8vIFRlbXBsYXRlIHRyYW5zaXRpb24gcGhhc2UgZXZlbnRzIChoYW5kbGVkIG9uY2Ugb25seSkKICAgICAgLy8gV2hlbiB0aGUgdGVtcGxhdGUgaGFzIG1vdW50ZWQsIGJ1dCBub3QgdmlzaWJseSBzaG93biB5ZXQKCiAgICAgICR0aXAuJG9uY2UoRVZFTlRfTkFNRV9TSE9XLCB0aGlzLm9uVGVtcGxhdGVTaG93KTsgLy8gV2hlbiB0aGUgdGVtcGxhdGUgaGFzIGNvbXBsZXRlZCBzaG93aW5nCgogICAgICAkdGlwLiRvbmNlKEVWRU5UX05BTUVfU0hPV04sIHRoaXMub25UZW1wbGF0ZVNob3duKTsgLy8gV2hlbiB0aGUgdGVtcGxhdGUgaGFzIHN0YXJ0ZWQgdG8gaGlkZQoKICAgICAgJHRpcC4kb25jZShFVkVOVF9OQU1FX0hJREUsIHRoaXMub25UZW1wbGF0ZUhpZGUpOyAvLyBXaGVuIHRoZSB0ZW1wbGF0ZSBoYXMgY29tcGxldGVkIGhpZGluZwoKICAgICAgJHRpcC4kb25jZShFVkVOVF9OQU1FX0hJRERFTiwgdGhpcy5vblRlbXBsYXRlSGlkZGVuKTsgLy8gV2hlbiB0aGUgdGVtcGxhdGUgZ2V0cyBkZXN0cm95ZWQgZm9yIGFueSByZWFzb24KCiAgICAgICR0aXAuJG9uY2UoSE9PS19FVkVOVF9OQU1FX0RFU1RST1lFRCwgdGhpcy5kZXN0cm95VGVtcGxhdGUpOyAvLyBDb252ZW5pZW5jZSBldmVudHMgZnJvbSB0ZW1wbGF0ZQogICAgICAvLyBUbyBzYXZlIHVzIGZyb20gbWFudWFsbHkgYWRkaW5nL3JlbW92aW5nIERPTQogICAgICAvLyBsaXN0ZW5lcnMgdG8gdGlwIGVsZW1lbnQgd2hlbiBpdCBpcyBvcGVuCgogICAgICAkdGlwLiRvbihFVkVOVF9OQU1FX0ZPQ1VTSU4sIHRoaXMuaGFuZGxlRXZlbnQpOwogICAgICAkdGlwLiRvbihFVkVOVF9OQU1FX0ZPQ1VTT1VULCB0aGlzLmhhbmRsZUV2ZW50KTsKICAgICAgJHRpcC4kb24oRVZFTlRfTkFNRV9NT1VTRUVOVEVSLCB0aGlzLmhhbmRsZUV2ZW50KTsKICAgICAgJHRpcC4kb24oRVZFTlRfTkFNRV9NT1VTRUxFQVZFLCB0aGlzLmhhbmRsZUV2ZW50KTsgLy8gTW91bnQgKHdoaWNoIHRyaWdnZXJzIHRoZSBgc2hvd2ApCgogICAgICAkdGlwLiRtb3VudChjb250YWluZXIuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JykpKTsgLy8gVGVtcGxhdGUgd2lsbCBhdXRvbWF0aWNhbGx5IHJlbW92ZSBpdHMgbWFya3VwIGZyb20gRE9NIHdoZW4gaGlkZGVuCiAgICB9LAogICAgaGlkZVRlbXBsYXRlOiBmdW5jdGlvbiBoaWRlVGVtcGxhdGUoKSB7CiAgICAgIC8vIFRyaWdnZXIgdGhlIHRlbXBsYXRlIHRvIHN0YXJ0IGhpZGluZwogICAgICAvLyBUaGUgdGVtcGxhdGUgd2lsbCBlbWl0IHRoZSBgaGlkZWAgZXZlbnQgYWZ0ZXIgdGhpcyBhbmQKICAgICAgLy8gdGhlbiBlbWl0IHRoZSBgaGlkZGVuYCBldmVudCBvbmNlIGl0IGlzIGZ1bGx5IGhpZGRlbgogICAgICAvLyBUaGUgYGhvb2s6ZGVzdHJveWVkYCB3aWxsIGFsc28gYmUgY2FsbGVkIChzYWZldHkgbWVhc3VyZSkKICAgICAgdGhpcy4kX3RpcCAmJiB0aGlzLiRfdGlwLmhpZGUoKTsgLy8gQ2xlYXIgb3V0IGFueSBzdHJhZ2dpbmcgYWN0aXZlIHRyaWdnZXJzCgogICAgICB0aGlzLmNsZWFyQWN0aXZlVHJpZ2dlcnMoKTsgLy8gUmVzZXQgdGhlIGhvdmVyIHN0YXRlCgogICAgICB0aGlzLiRfaG92ZXJTdGF0ZSA9ICcnOwogICAgfSwKICAgIC8vIERlc3Ryb3kgdGhlIHRlbXBsYXRlIGluc3RhbmNlIGFuZCByZXNldCBzdGF0ZQogICAgZGVzdHJveVRlbXBsYXRlOiBmdW5jdGlvbiBkZXN0cm95VGVtcGxhdGUoKSB7CiAgICAgIHRoaXMuc2V0V2hpbGVPcGVuTGlzdGVuZXJzKGZhbHNlKTsKICAgICAgdGhpcy5jbGVhckhvdmVyVGltZW91dCgpOwogICAgICB0aGlzLiRfaG92ZXJTdGF0ZSA9ICcnOwogICAgICB0aGlzLmNsZWFyQWN0aXZlVHJpZ2dlcnMoKTsKICAgICAgdGhpcy5sb2NhbFBsYWNlbWVudFRhcmdldCA9IG51bGw7CgogICAgICB0cnkgewogICAgICAgIHRoaXMuJF90aXAuJGRlc3Ryb3koKTsKICAgICAgfSBjYXRjaCAoX3VudXNlZCkge30KCiAgICAgIHRoaXMuJF90aXAgPSBudWxsOwogICAgICB0aGlzLnJlbW92ZUFyaWFEZXNjcmliZWRieSgpOwogICAgICB0aGlzLnJlc3RvcmVUaXRsZSgpOwogICAgICB0aGlzLmxvY2FsU2hvdyA9IGZhbHNlOwogICAgfSwKICAgIGdldFRlbXBsYXRlRWxlbWVudDogZnVuY3Rpb24gZ2V0VGVtcGxhdGVFbGVtZW50KCkgewogICAgICByZXR1cm4gdGhpcy4kX3RpcCA/IHRoaXMuJF90aXAuJGVsIDogbnVsbDsKICAgIH0sCiAgICBoYW5kbGVUZW1wbGF0ZVVwZGF0ZTogZnVuY3Rpb24gaGFuZGxlVGVtcGxhdGVVcGRhdGUoKSB7CiAgICAgIHZhciBfdGhpczQgPSB0aGlzOyAvLyBVcGRhdGUgb3VyIHRlbXBsYXRlIHRpdGxlL2NvbnRlbnQgInByb3BzIgogICAgICAvLyBTbyB0aGF0IHRoZSB0ZW1wbGF0ZSB1cGRhdGVzIGFjY29yZGluZ2x5CgoKICAgICAgdmFyICR0aXAgPSB0aGlzLiRfdGlwOwoKICAgICAgaWYgKCR0aXApIHsKICAgICAgICB2YXIgcHJvcHMgPSBbJ3RpdGxlJywgJ2NvbnRlbnQnLCAndmFyaWFudCcsICdjdXN0b21DbGFzcycsICdub0ZhZGUnLCAnaW50ZXJhY3RpdmUnXTsgLy8gT25seSB1cGRhdGUgdGhlIHZhbHVlcyBpZiB0aGV5IGhhdmUgY2hhbmdlZAoKICAgICAgICBwcm9wcy5mb3JFYWNoKGZ1bmN0aW9uIChwcm9wKSB7CiAgICAgICAgICBpZiAoJHRpcFtwcm9wXSAhPT0gX3RoaXM0W3Byb3BdKSB7CiAgICAgICAgICAgICR0aXBbcHJvcF0gPSBfdGhpczRbcHJvcF07CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICAvLyAtLS0gU2hvdy9IaWRlIGhhbmRsZXJzIC0tLQogICAgLy8gU2hvdyB0aGUgdG9vbHRpcAogICAgc2hvdzogZnVuY3Rpb24gc2hvdygpIHsKICAgICAgdmFyIHRhcmdldCA9IHRoaXMuZ2V0VGFyZ2V0KCk7CgogICAgICBpZiAoIXRhcmdldCB8fCAhY29udGFpbnMoZG9jdW1lbnQuYm9keSwgdGFyZ2V0KSB8fCAhaXNWaXNpYmxlKHRhcmdldCkgfHwgdGhpcy5kcm9wZG93bk9wZW4oKSB8fCAoaXNVbmRlZmluZWRPck51bGwodGhpcy50aXRsZSkgfHwgdGhpcy50aXRsZSA9PT0gJycpICYmIChpc1VuZGVmaW5lZE9yTnVsbCh0aGlzLmNvbnRlbnQpIHx8IHRoaXMuY29udGVudCA9PT0gJycpKSB7CiAgICAgICAgLy8gSWYgdHJpZ2dlciBlbGVtZW50IGlzbid0IGluIHRoZSBET00gb3IgaXMgbm90IHZpc2libGUsIG9yCiAgICAgICAgLy8gaXMgb24gYW4gb3BlbiBkcm9wZG93biB0b2dnbGUsIG9yIGhhcyBubyBjb250ZW50LCB0aGVuCiAgICAgICAgLy8gd2UgZXhpdCB3aXRob3V0IHNob3dpbmcKICAgICAgICByZXR1cm47CiAgICAgIH0gLy8gSWYgdGlwIGFscmVhZHkgZXhpc3RzLCBleGl0IGVhcmx5CgoKICAgICAgaWYgKHRoaXMuJF90aXAgfHwgdGhpcy5sb2NhbFNob3cpIHsKICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBJbiB0aGUgcHJvY2VzcyBvZiBzaG93aW5nCgoKICAgICAgdGhpcy5sb2NhbFNob3cgPSB0cnVlOyAvLyBDcmVhdGUgYSBjYW5jZWxhYmxlIEJ2RXZlbnQKCiAgICAgIHZhciBzaG93RXZ0ID0gdGhpcy5idWlsZEV2ZW50KEVWRU5UX05BTUVfU0hPVywgewogICAgICAgIGNhbmNlbGFibGU6IHRydWUKICAgICAgfSk7CiAgICAgIHRoaXMuZW1pdEV2ZW50KHNob3dFdnQpOyAvLyBEb24ndCBzaG93IGlmIGV2ZW50IGNhbmNlbGxlZAoKICAgICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCgogICAgICBpZiAoc2hvd0V2dC5kZWZhdWx0UHJldmVudGVkKSB7CiAgICAgICAgLy8gRGVzdHJveSB0aGUgdGVtcGxhdGUgKGlmIGZvciBzb21lIHJlYXNvbiBpdCB3YXMgY3JlYXRlZCkKICAgICAgICB0aGlzLmRlc3Ryb3lUZW1wbGF0ZSgpOwogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBGaXggdGhlIHRpdGxlIGF0dHJpYnV0ZSBvbiB0YXJnZXQKCgogICAgICB0aGlzLmZpeFRpdGxlKCk7IC8vIFNldCBhcmlhLWRlc2NyaWJlZGJ5IG9uIHRhcmdldAoKICAgICAgdGhpcy5hZGRBcmlhRGVzY3JpYmVkYnkoKTsgLy8gQ3JlYXRlIGFuZCBzaG93IHRoZSB0b29sdGlwCgogICAgICB0aGlzLmNyZWF0ZVRlbXBsYXRlQW5kU2hvdygpOwogICAgfSwKICAgIGhpZGU6IGZ1bmN0aW9uIGhpZGUoKSB7CiAgICAgIHZhciBmb3JjZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogZmFsc2U7IC8vIEhpZGUgdGhlIHRvb2x0aXAKCiAgICAgIHZhciB0aXAgPSB0aGlzLmdldFRlbXBsYXRlRWxlbWVudCgpOwogICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KCiAgICAgIGlmICghdGlwIHx8ICF0aGlzLmxvY2FsU2hvdykgewogICAgICAgIHRoaXMucmVzdG9yZVRpdGxlKCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIEVtaXQgY2FuY2VsYWJsZSBCdkV2ZW50ICdoaWRlJwogICAgICAvLyBXZSBkaXNhYmxlIGNhbmNlbGxpbmcgaWYgYGZvcmNlYCBpcyB0cnVlCgoKICAgICAgdmFyIGhpZGVFdnQgPSB0aGlzLmJ1aWxkRXZlbnQoRVZFTlRfTkFNRV9ISURFLCB7CiAgICAgICAgY2FuY2VsYWJsZTogIWZvcmNlCiAgICAgIH0pOwogICAgICB0aGlzLmVtaXRFdmVudChoaWRlRXZ0KTsKICAgICAgLyogaXN0YW5idWwgaWdub3JlIGlmOiBpZ25vcmUgZm9yIG5vdyAqLwoKICAgICAgaWYgKGhpZGVFdnQuZGVmYXVsdFByZXZlbnRlZCkgewogICAgICAgIC8vIERvbid0IGhpZGUgaWYgZXZlbnQgY2FuY2VsbGVkCiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIFRlbGwgdGhlIHRlbXBsYXRlIHRvIGhpZGUKCgogICAgICB0aGlzLmhpZGVUZW1wbGF0ZSgpOwogICAgfSwKICAgIGZvcmNlSGlkZTogZnVuY3Rpb24gZm9yY2VIaWRlKCkgewogICAgICAvLyBGb3JjZWZ1bGx5IGhpZGVzL2Rlc3Ryb3lzIHRoZSB0ZW1wbGF0ZSwgcmVnYXJkbGVzcyBvZiBhbnkgYWN0aXZlIHRyaWdnZXJzCiAgICAgIHZhciB0aXAgPSB0aGlzLmdldFRlbXBsYXRlRWxlbWVudCgpOwoKICAgICAgaWYgKCF0aXAgfHwgIXRoaXMubG9jYWxTaG93KSB7CiAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8KICAgICAgICByZXR1cm47CiAgICAgIH0gLy8gRGlzYWJsZSB3aGlsZSBvcGVuIGxpc3RlbmVycy93YXRjaGVycwogICAgICAvLyBUaGlzIGlzIGFsc28gZG9uZSBpbiB0aGUgdGVtcGxhdGUgYGhpZGVgIGV2ZW50IGhhbmRsZXIKCgogICAgICB0aGlzLnNldFdoaWxlT3Blbkxpc3RlbmVycyhmYWxzZSk7IC8vIENsZWFyIGFueSBob3ZlciBlbnRlci9sZWF2ZSBldmVudAoKICAgICAgdGhpcy5jbGVhckhvdmVyVGltZW91dCgpOwogICAgICB0aGlzLiRfaG92ZXJTdGF0ZSA9ICcnOwogICAgICB0aGlzLmNsZWFyQWN0aXZlVHJpZ2dlcnMoKTsgLy8gRGlzYWJsZSB0aGUgZmFkZSBhbmltYXRpb24gb24gdGhlIHRlbXBsYXRlCgogICAgICBpZiAodGhpcy4kX3RpcCkgewogICAgICAgIHRoaXMuJF90aXAubm9GYWRlID0gdHJ1ZTsKICAgICAgfSAvLyBIaWRlIHRoZSB0aXAgKHdpdGggZm9yY2UgPSB0cnVlKQoKCiAgICAgIHRoaXMuaGlkZSh0cnVlKTsKICAgIH0sCiAgICBlbmFibGU6IGZ1bmN0aW9uIGVuYWJsZSgpIHsKICAgICAgdGhpcy4kX2VuYWJsZWQgPSB0cnVlOyAvLyBDcmVhdGUgYSBub24tY2FuY2VsYWJsZSBCdkV2ZW50CgogICAgICB0aGlzLmVtaXRFdmVudCh0aGlzLmJ1aWxkRXZlbnQoRVZFTlRfTkFNRV9FTkFCTEVEKSk7CiAgICB9LAogICAgZGlzYWJsZTogZnVuY3Rpb24gZGlzYWJsZSgpIHsKICAgICAgdGhpcy4kX2VuYWJsZWQgPSBmYWxzZTsgLy8gQ3JlYXRlIGEgbm9uLWNhbmNlbGFibGUgQnZFdmVudAoKICAgICAgdGhpcy5lbWl0RXZlbnQodGhpcy5idWlsZEV2ZW50KEVWRU5UX05BTUVfRElTQUJMRUQpKTsKICAgIH0sCiAgICAvLyAtLS0gSGFuZGxlcnMgZm9yIHRlbXBsYXRlIGV2ZW50cyAtLS0KICAgIC8vIFdoZW4gdGVtcGxhdGUgaXMgaW5zZXJ0ZWQgaW50byBET00sIGJ1dCBub3QgeWV0IHNob3duCiAgICBvblRlbXBsYXRlU2hvdzogZnVuY3Rpb24gb25UZW1wbGF0ZVNob3coKSB7CiAgICAgIC8vIEVuYWJsZSB3aGlsZSBvcGVuIGxpc3RlbmVycy93YXRjaGVycwogICAgICB0aGlzLnNldFdoaWxlT3Blbkxpc3RlbmVycyh0cnVlKTsKICAgIH0sCiAgICAvLyBXaGVuIHRlbXBsYXRlIHNob3cgdHJhbnNpdGlvbiBjb21wbGV0ZXMKICAgIG9uVGVtcGxhdGVTaG93bjogZnVuY3Rpb24gb25UZW1wbGF0ZVNob3duKCkgewogICAgICB2YXIgcHJldkhvdmVyU3RhdGUgPSB0aGlzLiRfaG92ZXJTdGF0ZTsKICAgICAgdGhpcy4kX2hvdmVyU3RhdGUgPSAnJzsKICAgICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQ6IG9jY2FzaW9uYWwgTm9kZSAxMCBjb3ZlcmFnZSBlcnJvciAqLwoKICAgICAgaWYgKHByZXZIb3ZlclN0YXRlID09PSAnb3V0JykgewogICAgICAgIHRoaXMubGVhdmUobnVsbCk7CiAgICAgIH0gLy8gRW1pdCBhIG5vbi1jYW5jZWxhYmxlIEJ2RXZlbnQgJ3Nob3duJwoKCiAgICAgIHRoaXMuZW1pdEV2ZW50KHRoaXMuYnVpbGRFdmVudChFVkVOVF9OQU1FX1NIT1dOKSk7CiAgICB9LAogICAgLy8gV2hlbiB0ZW1wbGF0ZSBpcyBzdGFydGluZyB0byBoaWRlCiAgICBvblRlbXBsYXRlSGlkZTogZnVuY3Rpb24gb25UZW1wbGF0ZUhpZGUoKSB7CiAgICAgIC8vIERpc2FibGUgd2hpbGUgb3BlbiBsaXN0ZW5lcnMvd2F0Y2hlcnMKICAgICAgdGhpcy5zZXRXaGlsZU9wZW5MaXN0ZW5lcnMoZmFsc2UpOwogICAgfSwKICAgIC8vIFdoZW4gdGVtcGxhdGUgaGFzIGNvbXBsZXRlZCBjbG9zaW5nIChqdXN0IGJlZm9yZSBpdCBzZWxmIGRlc3RydWN0cykKICAgIG9uVGVtcGxhdGVIaWRkZW46IGZ1bmN0aW9uIG9uVGVtcGxhdGVIaWRkZW4oKSB7CiAgICAgIC8vIERlc3Ryb3kgdGhlIHRlbXBsYXRlCiAgICAgIHRoaXMuZGVzdHJveVRlbXBsYXRlKCk7IC8vIEVtaXQgYSBub24tY2FuY2VsYWJsZSBCdkV2ZW50ICdzaG93bicKCiAgICAgIHRoaXMuZW1pdEV2ZW50KHRoaXMuYnVpbGRFdmVudChFVkVOVF9OQU1FX0hJRERFTikpOwogICAgfSwKICAgIC8vIC0tLSBIZWxwZXIgbWV0aG9kcyAtLS0KICAgIGdldFRhcmdldDogZnVuY3Rpb24gZ2V0VGFyZ2V0KCkgewogICAgICB2YXIgdGFyZ2V0ID0gdGhpcy50YXJnZXQ7CgogICAgICBpZiAoaXNTdHJpbmcodGFyZ2V0KSkgewogICAgICAgIHRhcmdldCA9IGdldEJ5SWQodGFyZ2V0LnJlcGxhY2UoL14jLywgJycpKTsKICAgICAgfSBlbHNlIGlmIChpc0Z1bmN0aW9uKHRhcmdldCkpIHsKICAgICAgICB0YXJnZXQgPSB0YXJnZXQoKTsKICAgICAgfSBlbHNlIGlmICh0YXJnZXQpIHsKICAgICAgICB0YXJnZXQgPSB0YXJnZXQuJGVsIHx8IHRhcmdldDsKICAgICAgfQoKICAgICAgcmV0dXJuIGlzRWxlbWVudCh0YXJnZXQpID8gdGFyZ2V0IDogbnVsbDsKICAgIH0sCiAgICBnZXRQbGFjZW1lbnRUYXJnZXQ6IGZ1bmN0aW9uIGdldFBsYWNlbWVudFRhcmdldCgpIHsKICAgICAgLy8gVGhpcyBpcyB0aGUgdGFyZ2V0IHRoYXQgdGhlIHRvb2x0aXAgd2lsbCBiZSBwbGFjZWQgb24sIHdoaWNoIG1heSBub3QKICAgICAgLy8gbmVjZXNzYXJpbHkgYmUgdGhlIHNhbWUgZWxlbWVudCB0aGF0IGhhcyB0aGUgdHJpZ2dlciBldmVudCBsaXN0ZW5lcnMKICAgICAgLy8gRm9yIG5vdywgdGhpcyBpcyB0aGUgc2FtZSBhcyB0YXJnZXQKICAgICAgLy8gVE9ETzoKICAgICAgLy8gICBBZGQgaW4gY2hpbGQgc2VsZWN0b3Igc3VwcG9ydAogICAgICAvLyAgIEFkZCBpbiB2aXNpYmlsaXR5IGNoZWNrcyBmb3IgdGhpcyBlbGVtZW50CiAgICAgIC8vICAgRmFsbGJhY2sgdG8gdGFyZ2V0IGlmIG5vdCBmb3VuZAogICAgICByZXR1cm4gdGhpcy5nZXRUYXJnZXQoKTsKICAgIH0sCiAgICBnZXRUYXJnZXRJZDogZnVuY3Rpb24gZ2V0VGFyZ2V0SWQoKSB7CiAgICAgIC8vIFJldHVybnMgdGhlIElEIG9mIHRoZSB0cmlnZ2VyIGVsZW1lbnQKICAgICAgdmFyIHRhcmdldCA9IHRoaXMuZ2V0VGFyZ2V0KCk7CiAgICAgIHJldHVybiB0YXJnZXQgJiYgdGFyZ2V0LmlkID8gdGFyZ2V0LmlkIDogbnVsbDsKICAgIH0sCiAgICBnZXRDb250YWluZXI6IGZ1bmN0aW9uIGdldENvbnRhaW5lcigpIHsKICAgICAgLy8gSGFuZGxlIGNhc2Ugd2hlcmUgY29udGFpbmVyIG1heSBiZSBhIGNvbXBvbmVudCByZWYKICAgICAgdmFyIGNvbnRhaW5lciA9IHRoaXMuY29udGFpbmVyID8gdGhpcy5jb250YWluZXIuJGVsIHx8IHRoaXMuY29udGFpbmVyIDogZmFsc2U7CiAgICAgIHZhciBib2R5ID0gZG9jdW1lbnQuYm9keTsKICAgICAgdmFyIHRhcmdldCA9IHRoaXMuZ2V0VGFyZ2V0KCk7IC8vIElmIHdlIGFyZSBpbiBhIG1vZGFsLCB3ZSBhcHBlbmQgdG8gdGhlIG1vZGFsLCBJZiB3ZQogICAgICAvLyBhcmUgaW4gYSBzaWRlYmFyLCB3ZSBhcHBlbmQgdG8gdGhlIHNpZGViYXIsIGVsc2UgYXBwZW5kCiAgICAgIC8vIHRvIGJvZHksIHVubGVzcyBhIGNvbnRhaW5lciBpcyBzcGVjaWZpZWQKICAgICAgLy8gVE9ETzoKICAgICAgLy8gICBUZW1wbGF0ZSBzaG91bGQgcGVyaW9kaWNhbGx5IGNoZWNrIHRvIHNlZSBpZiBpdCBpcyBpbiBkb20KICAgICAgLy8gICBBbmQgaWYgbm90LCBzZWxmIGRlc3RydWN0IChpZiBjb250YWluZXIgZ290IHYtaWYnZWQgb3V0IG9mIERPTSkKICAgICAgLy8gICBPciB0aGlzIGNvdWxkIHBvc3NpYmx5IGJlIHBhcnQgb2YgdGhlIHZpc2liaWxpdHkgY2hlY2sKCiAgICAgIHJldHVybiBjb250YWluZXIgPT09IGZhbHNlID8gY2xvc2VzdChDT05UQUlORVJfU0VMRUNUT1IsIHRhcmdldCkgfHwgYm9keSA6CiAgICAgIC8qaXN0YW5idWwgaWdub3JlIG5leHQgKi8KICAgICAgaXNTdHJpbmcoY29udGFpbmVyKSA/CiAgICAgIC8qaXN0YW5idWwgaWdub3JlIG5leHQgKi8KICAgICAgZ2V0QnlJZChjb250YWluZXIucmVwbGFjZSgvXiMvLCAnJykpIHx8IGJvZHkgOgogICAgICAvKmlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgICAgIGJvZHk7CiAgICB9LAogICAgZ2V0Qm91bmRhcnk6IGZ1bmN0aW9uIGdldEJvdW5kYXJ5KCkgewogICAgICByZXR1cm4gdGhpcy5ib3VuZGFyeSA/IHRoaXMuYm91bmRhcnkuJGVsIHx8IHRoaXMuYm91bmRhcnkgOiAnc2Nyb2xsUGFyZW50JzsKICAgIH0sCiAgICBpc0luTW9kYWw6IGZ1bmN0aW9uIGlzSW5Nb2RhbCgpIHsKICAgICAgdmFyIHRhcmdldCA9IHRoaXMuZ2V0VGFyZ2V0KCk7CiAgICAgIHJldHVybiB0YXJnZXQgJiYgY2xvc2VzdChNT0RBTF9TRUxFQ1RPUiwgdGFyZ2V0KTsKICAgIH0sCiAgICBpc0Ryb3Bkb3duOiBmdW5jdGlvbiBpc0Ryb3Bkb3duKCkgewogICAgICAvLyBSZXR1cm5zIHRydWUgaWYgdHJpZ2dlciBpcyBhIGRyb3Bkb3duCiAgICAgIHZhciB0YXJnZXQgPSB0aGlzLmdldFRhcmdldCgpOwogICAgICByZXR1cm4gdGFyZ2V0ICYmIGhhc0NsYXNzKHRhcmdldCwgRFJPUERPV05fQ0xBU1MpOwogICAgfSwKICAgIGRyb3Bkb3duT3BlbjogZnVuY3Rpb24gZHJvcGRvd25PcGVuKCkgewogICAgICAvLyBSZXR1cm5zIHRydWUgaWYgdHJpZ2dlciBpcyBhIGRyb3Bkb3duIGFuZCB0aGUgZHJvcGRvd24gbWVudSBpcyBvcGVuCiAgICAgIHZhciB0YXJnZXQgPSB0aGlzLmdldFRhcmdldCgpOwogICAgICByZXR1cm4gdGhpcy5pc0Ryb3Bkb3duKCkgJiYgdGFyZ2V0ICYmIHNlbGVjdChEUk9QRE9XTl9PUEVOX1NFTEVDVE9SLCB0YXJnZXQpOwogICAgfSwKICAgIGNsZWFySG92ZXJUaW1lb3V0OiBmdW5jdGlvbiBjbGVhckhvdmVyVGltZW91dCgpIHsKICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuJF9ob3ZlclRpbWVvdXQpOwogICAgICB0aGlzLiRfaG92ZXJUaW1lb3V0ID0gbnVsbDsKICAgIH0sCiAgICBjbGVhclZpc2liaWxpdHlJbnRlcnZhbDogZnVuY3Rpb24gY2xlYXJWaXNpYmlsaXR5SW50ZXJ2YWwoKSB7CiAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy4kX3Zpc2libGVJbnRlcnZhbCk7CiAgICAgIHRoaXMuJF92aXNpYmxlSW50ZXJ2YWwgPSBudWxsOwogICAgfSwKICAgIGNsZWFyQWN0aXZlVHJpZ2dlcnM6IGZ1bmN0aW9uIGNsZWFyQWN0aXZlVHJpZ2dlcnMoKSB7CiAgICAgIGZvciAodmFyIHRyaWdnZXIgaW4gdGhpcy5hY3RpdmVUcmlnZ2VyKSB7CiAgICAgICAgdGhpcy5hY3RpdmVUcmlnZ2VyW3RyaWdnZXJdID0gZmFsc2U7CiAgICAgIH0KICAgIH0sCiAgICBhZGRBcmlhRGVzY3JpYmVkYnk6IGZ1bmN0aW9uIGFkZEFyaWFEZXNjcmliZWRieSgpIHsKICAgICAgLy8gQWRkIGFyaWEtZGVzY3JpYmVkYnkgb24gdHJpZ2dlciBlbGVtZW50LCB3aXRob3V0IHJlbW92aW5nIGFueSBvdGhlciBJRHMKICAgICAgdmFyIHRhcmdldCA9IHRoaXMuZ2V0VGFyZ2V0KCk7CiAgICAgIHZhciBkZXNjID0gZ2V0QXR0cih0YXJnZXQsICdhcmlhLWRlc2NyaWJlZGJ5JykgfHwgJyc7CiAgICAgIGRlc2MgPSBkZXNjLnNwbGl0KC9ccysvKS5jb25jYXQodGhpcy5jb21wdXRlZElkKS5qb2luKCcgJykudHJpbSgpOyAvLyBVcGRhdGUvYWRkIGFyaWEtZGVzY3JpYmVkIGJ5CgogICAgICBzZXRBdHRyKHRhcmdldCwgJ2FyaWEtZGVzY3JpYmVkYnknLCBkZXNjKTsKICAgIH0sCiAgICByZW1vdmVBcmlhRGVzY3JpYmVkYnk6IGZ1bmN0aW9uIHJlbW92ZUFyaWFEZXNjcmliZWRieSgpIHsKICAgICAgdmFyIF90aGlzNSA9IHRoaXM7IC8vIFJlbW92ZSBhcmlhLWRlc2NyaWJlZGJ5IG9uIHRyaWdnZXIgZWxlbWVudCwgd2l0aG91dCByZW1vdmluZyBhbnkgb3RoZXIgSURzCgoKICAgICAgdmFyIHRhcmdldCA9IHRoaXMuZ2V0VGFyZ2V0KCk7CiAgICAgIHZhciBkZXNjID0gZ2V0QXR0cih0YXJnZXQsICdhcmlhLWRlc2NyaWJlZGJ5JykgfHwgJyc7CiAgICAgIGRlc2MgPSBkZXNjLnNwbGl0KC9ccysvKS5maWx0ZXIoZnVuY3Rpb24gKGQpIHsKICAgICAgICByZXR1cm4gZCAhPT0gX3RoaXM1LmNvbXB1dGVkSWQ7CiAgICAgIH0pLmpvaW4oJyAnKS50cmltKCk7IC8vIFVwZGF0ZSBvciByZW1vdmUgYXJpYS1kZXNjcmliZWRieQoKICAgICAgaWYgKGRlc2MpIHsKICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwogICAgICAgIHNldEF0dHIodGFyZ2V0LCAnYXJpYS1kZXNjcmliZWRieScsIGRlc2MpOwogICAgICB9IGVsc2UgewogICAgICAgIHJlbW92ZUF0dHIodGFyZ2V0LCAnYXJpYS1kZXNjcmliZWRieScpOwogICAgICB9CiAgICB9LAogICAgZml4VGl0bGU6IGZ1bmN0aW9uIGZpeFRpdGxlKCkgewogICAgICAvLyBJZiB0aGUgdGFyZ2V0IGhhcyBhIGB0aXRsZWAgYXR0cmlidXRlLAogICAgICAvLyByZW1vdmUgaXQgYW5kIHN0b3JlIGl0IG9uIGEgZGF0YSBhdHRyaWJ1dGUKICAgICAgdmFyIHRhcmdldCA9IHRoaXMuZ2V0VGFyZ2V0KCk7CgogICAgICBpZiAoaGFzQXR0cih0YXJnZXQsICd0aXRsZScpKSB7CiAgICAgICAgLy8gR2V0IGB0aXRsZWAgYXR0cmlidXRlIHZhbHVlIGFuZCByZW1vdmUgaXQgZnJvbSB0YXJnZXQKICAgICAgICB2YXIgdGl0bGUgPSBnZXRBdHRyKHRhcmdldCwgJ3RpdGxlJyk7CiAgICAgICAgc2V0QXR0cih0YXJnZXQsICd0aXRsZScsICcnKTsgLy8gT25seSBzZXQgdGhlIGRhdGEgYXR0cmlidXRlIHdoZW4gdGhlIHZhbHVlIGlzIHRydXRoeQoKICAgICAgICBpZiAodGl0bGUpIHsKICAgICAgICAgIHNldEF0dHIodGFyZ2V0LCBEQVRBX1RJVExFX0FUVFIsIHRpdGxlKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICByZXN0b3JlVGl0bGU6IGZ1bmN0aW9uIHJlc3RvcmVUaXRsZSgpIHsKICAgICAgLy8gSWYgdGhlIHRhcmdldCBoYWQgYSBgdGl0bGVgIGF0dHJpYnV0ZSwKICAgICAgLy8gcmVzdG9yZSBpdCBhbmQgcmVtb3ZlIHRoZSBkYXRhIGF0dHJpYnV0ZQogICAgICB2YXIgdGFyZ2V0ID0gdGhpcy5nZXRUYXJnZXQoKTsKCiAgICAgIGlmIChoYXNBdHRyKHRhcmdldCwgREFUQV9USVRMRV9BVFRSKSkgewogICAgICAgIC8vIEdldCBkYXRhIGF0dHJpYnV0ZSB2YWx1ZSBhbmQgcmVtb3ZlIGl0IGZyb20gdGFyZ2V0CiAgICAgICAgdmFyIHRpdGxlID0gZ2V0QXR0cih0YXJnZXQsIERBVEFfVElUTEVfQVRUUik7CiAgICAgICAgcmVtb3ZlQXR0cih0YXJnZXQsIERBVEFfVElUTEVfQVRUUik7IC8vIE9ubHkgcmVzdG9yZSB0aGUgYHRpdGxlYCBhdHRyaWJ1dGUgd2hlbiB0aGUgdmFsdWUgaXMgdHJ1dGh5CgogICAgICAgIGlmICh0aXRsZSkgewogICAgICAgICAgc2V0QXR0cih0YXJnZXQsICd0aXRsZScsIHRpdGxlKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICAvLyAtLS0gQnZFdmVudCBoZWxwZXJzIC0tLQogICAgYnVpbGRFdmVudDogZnVuY3Rpb24gYnVpbGRFdmVudCh0eXBlKSB7CiAgICAgIHZhciBvcHRpb25zID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB7fTsgLy8gRGVmYXVsdHMgdG8gYSBub24tY2FuY2VsbGFibGUgZXZlbnQKCiAgICAgIHJldHVybiBuZXcgQnZFdmVudCh0eXBlLCBfb2JqZWN0U3ByZWFkKHsKICAgICAgICBjYW5jZWxhYmxlOiBmYWxzZSwKICAgICAgICB0YXJnZXQ6IHRoaXMuZ2V0VGFyZ2V0KCksCiAgICAgICAgcmVsYXRlZFRhcmdldDogdGhpcy5nZXRUZW1wbGF0ZUVsZW1lbnQoKSB8fCBudWxsLAogICAgICAgIGNvbXBvbmVudElkOiB0aGlzLmNvbXB1dGVkSWQsCiAgICAgICAgdnVlVGFyZ2V0OiB0aGlzCiAgICAgIH0sIG9wdGlvbnMpKTsKICAgIH0sCiAgICBlbWl0RXZlbnQ6IGZ1bmN0aW9uIGVtaXRFdmVudChidkV2ZW50KSB7CiAgICAgIHZhciB0eXBlID0gYnZFdmVudC50eXBlOwogICAgICB0aGlzLmVtaXRPblJvb3QoZ2V0Um9vdEV2ZW50TmFtZSh0aGlzLnRlbXBsYXRlVHlwZSwgdHlwZSksIGJ2RXZlbnQpOwogICAgICB0aGlzLiRlbWl0KHR5cGUsIGJ2RXZlbnQpOwogICAgfSwKICAgIC8vIC0tLSBFdmVudCBoYW5kbGVyIHNldHVwIG1ldGhvZHMgLS0tCiAgICBsaXN0ZW46IGZ1bmN0aW9uIGxpc3RlbigpIHsKICAgICAgdmFyIF90aGlzNiA9IHRoaXM7IC8vIEVuYWJsZSB0cmlnZ2VyIGV2ZW50IGhhbmRsZXJzCgoKICAgICAgdmFyIGVsID0gdGhpcy5nZXRUYXJnZXQoKTsKCiAgICAgIGlmICghZWwpIHsKICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBMaXN0ZW4gZm9yIGdsb2JhbCBzaG93L2hpZGUgZXZlbnRzCgoKICAgICAgdGhpcy5zZXRSb290TGlzdGVuZXIodHJ1ZSk7IC8vIFNldCB1cCBvdXIgbGlzdGVuZXJzIG9uIHRoZSB0YXJnZXQgdHJpZ2dlciBlbGVtZW50CgogICAgICB0aGlzLmNvbXB1dGVkVHJpZ2dlcnMuZm9yRWFjaChmdW5jdGlvbiAodHJpZ2dlcikgewogICAgICAgIGlmICh0cmlnZ2VyID09PSAnY2xpY2snKSB7CiAgICAgICAgICBldmVudE9uKGVsLCAnY2xpY2snLCBfdGhpczYuaGFuZGxlRXZlbnQsIEVWRU5UX09QVElPTlNfTk9fQ0FQVFVSRSk7CiAgICAgICAgfSBlbHNlIGlmICh0cmlnZ2VyID09PSAnZm9jdXMnKSB7CiAgICAgICAgICBldmVudE9uKGVsLCAnZm9jdXNpbicsIF90aGlzNi5oYW5kbGVFdmVudCwgRVZFTlRfT1BUSU9OU19OT19DQVBUVVJFKTsKICAgICAgICAgIGV2ZW50T24oZWwsICdmb2N1c291dCcsIF90aGlzNi5oYW5kbGVFdmVudCwgRVZFTlRfT1BUSU9OU19OT19DQVBUVVJFKTsKICAgICAgICB9IGVsc2UgaWYgKHRyaWdnZXIgPT09ICdibHVyJykgewogICAgICAgICAgLy8gVXNlZCB0byBjbG9zZSAkdGlwIHdoZW4gZWxlbWVudCBsb29zZXMgZm9jdXMKCiAgICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwogICAgICAgICAgZXZlbnRPbihlbCwgJ2ZvY3Vzb3V0JywgX3RoaXM2LmhhbmRsZUV2ZW50LCBFVkVOVF9PUFRJT05TX05PX0NBUFRVUkUpOwogICAgICAgIH0gZWxzZSBpZiAodHJpZ2dlciA9PT0gJ2hvdmVyJykgewogICAgICAgICAgZXZlbnRPbihlbCwgJ21vdXNlZW50ZXInLCBfdGhpczYuaGFuZGxlRXZlbnQsIEVWRU5UX09QVElPTlNfTk9fQ0FQVFVSRSk7CiAgICAgICAgICBldmVudE9uKGVsLCAnbW91c2VsZWF2ZScsIF90aGlzNi5oYW5kbGVFdmVudCwgRVZFTlRfT1BUSU9OU19OT19DQVBUVVJFKTsKICAgICAgICB9CiAgICAgIH0sIHRoaXMpOwogICAgfSwKCiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwogICAgdW5MaXN0ZW46IGZ1bmN0aW9uIHVuTGlzdGVuKCkgewogICAgICB2YXIgX3RoaXM3ID0gdGhpczsgLy8gUmVtb3ZlIHRyaWdnZXIgZXZlbnQgaGFuZGxlcnMKCgogICAgICB2YXIgZXZlbnRzID0gWydjbGljaycsICdmb2N1c2luJywgJ2ZvY3Vzb3V0JywgJ21vdXNlZW50ZXInLCAnbW91c2VsZWF2ZSddOwogICAgICB2YXIgdGFyZ2V0ID0gdGhpcy5nZXRUYXJnZXQoKTsgLy8gU3RvcCBsaXN0ZW5pbmcgZm9yIGdsb2JhbCBzaG93L2hpZGUvZW5hYmxlL2Rpc2FibGUgZXZlbnRzCgogICAgICB0aGlzLnNldFJvb3RMaXN0ZW5lcihmYWxzZSk7IC8vIENsZWFyIG91dCBhbnkgYWN0aXZlIHRhcmdldCBsaXN0ZW5lcnMKCiAgICAgIGV2ZW50cy5mb3JFYWNoKGZ1bmN0aW9uIChldmVudCkgewogICAgICAgIHRhcmdldCAmJiBldmVudE9mZih0YXJnZXQsIGV2ZW50LCBfdGhpczcuaGFuZGxlRXZlbnQsIEVWRU5UX09QVElPTlNfTk9fQ0FQVFVSRSk7CiAgICAgIH0sIHRoaXMpOwogICAgfSwKICAgIHNldFJvb3RMaXN0ZW5lcjogZnVuY3Rpb24gc2V0Um9vdExpc3RlbmVyKG9uKSB7CiAgICAgIC8vIExpc3RlbiBmb3IgZ2xvYmFsIGBidjo6e2hpZGV8c2hvd306Ont0b29sdGlwfHBvcG92ZXJ9YCBoaWRlIHJlcXVlc3QgZXZlbnQKICAgICAgdmFyICRyb290ID0gdGhpcy4kcm9vdDsKCiAgICAgIGlmICgkcm9vdCkgewogICAgICAgIHZhciBtZXRob2QgPSBvbiA/ICckb24nIDogJyRvZmYnOwogICAgICAgIHZhciB0eXBlID0gdGhpcy50ZW1wbGF0ZVR5cGU7CiAgICAgICAgJHJvb3RbbWV0aG9kXShnZXRSb290QWN0aW9uRXZlbnROYW1lKHR5cGUsIEVWRU5UX05BTUVfSElERSksIHRoaXMuZG9IaWRlKTsKICAgICAgICAkcm9vdFttZXRob2RdKGdldFJvb3RBY3Rpb25FdmVudE5hbWUodHlwZSwgRVZFTlRfTkFNRV9TSE9XKSwgdGhpcy5kb1Nob3cpOwogICAgICAgICRyb290W21ldGhvZF0oZ2V0Um9vdEFjdGlvbkV2ZW50TmFtZSh0eXBlLCBFVkVOVF9OQU1FX0RJU0FCTEUpLCB0aGlzLmRvRGlzYWJsZSk7CiAgICAgICAgJHJvb3RbbWV0aG9kXShnZXRSb290QWN0aW9uRXZlbnROYW1lKHR5cGUsIEVWRU5UX05BTUVfRU5BQkxFKSwgdGhpcy5kb0VuYWJsZSk7CiAgICAgIH0KICAgIH0sCiAgICBzZXRXaGlsZU9wZW5MaXN0ZW5lcnM6IGZ1bmN0aW9uIHNldFdoaWxlT3Blbkxpc3RlbmVycyhvbikgewogICAgICAvLyBFdmVudHMgdGhhdCBhcmUgb25seSByZWdpc3RlcmVkIHdoZW4gdGhlIHRlbXBsYXRlIGlzIHNob3dpbmcKICAgICAgLy8gTW9kYWwgY2xvc2UgZXZlbnRzCiAgICAgIHRoaXMuc2V0TW9kYWxMaXN0ZW5lcihvbik7IC8vIERyb3Bkb3duIG9wZW4gZXZlbnRzIChpZiB3ZSBhcmUgYXR0YWNoZWQgdG8gYSBkcm9wZG93bikKCiAgICAgIHRoaXMuc2V0RHJvcGRvd25MaXN0ZW5lcihvbik7IC8vIFBlcmlvZGljICRlbGVtZW50IHZpc2liaWxpdHkgY2hlY2sKICAgICAgLy8gRm9yIGhhbmRsaW5nIHdoZW4gdGlwIHRhcmdldCBpcyBpbiA8a2VlcGFsaXZlPiwgdGFicywgY2Fyb3VzZWwsIGV0YwoKICAgICAgdGhpcy52aXNpYmxlQ2hlY2sob24pOyAvLyBPbi10b3VjaCBzdGFydCBsaXN0ZW5lcnMKCiAgICAgIHRoaXMuc2V0T25Ub3VjaFN0YXJ0TGlzdGVuZXIob24pOwogICAgfSwKICAgIC8vIEhhbmRsZXIgZm9yIHBlcmlvZGljIHZpc2liaWxpdHkgY2hlY2sKICAgIHZpc2libGVDaGVjazogZnVuY3Rpb24gdmlzaWJsZUNoZWNrKG9uKSB7CiAgICAgIHZhciBfdGhpczggPSB0aGlzOwoKICAgICAgdGhpcy5jbGVhclZpc2liaWxpdHlJbnRlcnZhbCgpOwogICAgICB2YXIgdGFyZ2V0ID0gdGhpcy5nZXRUYXJnZXQoKTsKICAgICAgdmFyIHRpcCA9IHRoaXMuZ2V0VGVtcGxhdGVFbGVtZW50KCk7CgogICAgICBpZiAob24pIHsKICAgICAgICB0aGlzLiRfdmlzaWJsZUludGVydmFsID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKHRpcCAmJiBfdGhpczgubG9jYWxTaG93ICYmICghdGFyZ2V0LnBhcmVudE5vZGUgfHwgIWlzVmlzaWJsZSh0YXJnZXQpKSkgewogICAgICAgICAgICAvLyBUYXJnZXQgZWxlbWVudCBpcyBubyBsb25nZXIgdmlzaWJsZSBvciBub3QgaW4gRE9NLCBzbyBmb3JjZS1oaWRlIHRoZSB0b29sdGlwCiAgICAgICAgICAgIF90aGlzOC5mb3JjZUhpZGUoKTsKICAgICAgICAgIH0KICAgICAgICB9LCAxMDApOwogICAgICB9CiAgICB9LAogICAgc2V0TW9kYWxMaXN0ZW5lcjogZnVuY3Rpb24gc2V0TW9kYWxMaXN0ZW5lcihvbikgewogICAgICAvLyBIYW5kbGUgY2FzZSB3aGVyZSB0b29sdGlwL3RhcmdldCBpcyBpbiBhIG1vZGFsCiAgICAgIGlmICh0aGlzLmlzSW5Nb2RhbCgpKSB7CiAgICAgICAgLy8gV2UgY2FuIGxpc3RlbiBmb3IgbW9kYWwgaGlkZGVuIGV2ZW50cyBvbiBgJHJvb3RgCiAgICAgICAgdGhpcy4kcm9vdFtvbiA/ICckb24nIDogJyRvZmYnXShST09UX0VWRU5UX05BTUVfTU9EQUxfSElEREVOLCB0aGlzLmZvcmNlSGlkZSk7CiAgICAgIH0KICAgIH0sCgogICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQ6IEpTRE9NIGRvZXNuJ3Qgc3VwcG9ydCBgb250b3VjaHN0YXJ0YCAqLwogICAgc2V0T25Ub3VjaFN0YXJ0TGlzdGVuZXI6IGZ1bmN0aW9uIHNldE9uVG91Y2hTdGFydExpc3RlbmVyKG9uKSB7CiAgICAgIHZhciBfdGhpczkgPSB0aGlzOyAvLyBJZiB0aGlzIGlzIGEgdG91Y2gtZW5hYmxlZCBkZXZpY2Ugd2UgYWRkIGV4dHJhIGVtcHR5CiAgICAgIC8vIGBtb3VzZW92ZXJgIGxpc3RlbmVycyB0byB0aGUgYm9keSdzIGltbWVkaWF0ZSBjaGlsZHJlbgogICAgICAvLyBPbmx5IG5lZWRlZCBiZWNhdXNlIG9mIGJyb2tlbiBldmVudCBkZWxlZ2F0aW9uIG9uIGlPUwogICAgICAvLyBodHRwczovL3d3dy5xdWlya3Ntb2RlLm9yZy9ibG9nL2FyY2hpdmVzLzIwMTQvMDIvbW91c2VfZXZlbnRfYnViLmh0bWwKCgogICAgICBpZiAoJ29udG91Y2hzdGFydCcgaW4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KSB7CiAgICAgICAgYXJyYXlGcm9tKGRvY3VtZW50LmJvZHkuY2hpbGRyZW4pLmZvckVhY2goZnVuY3Rpb24gKGVsKSB7CiAgICAgICAgICBldmVudE9uT2ZmKG9uLCBlbCwgJ21vdXNlb3ZlcicsIF90aGlzOS4kX25vb3ApOwogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgc2V0RHJvcGRvd25MaXN0ZW5lcjogZnVuY3Rpb24gc2V0RHJvcGRvd25MaXN0ZW5lcihvbikgewogICAgICB2YXIgdGFyZ2V0ID0gdGhpcy5nZXRUYXJnZXQoKTsKCiAgICAgIGlmICghdGFyZ2V0IHx8ICF0aGlzLiRyb290IHx8ICF0aGlzLmlzRHJvcGRvd24pIHsKICAgICAgICByZXR1cm47CiAgICAgIH0gLy8gV2UgY2FuIGxpc3RlbiBmb3IgZHJvcGRvd24gc2hvd24gZXZlbnRzIG9uIGl0cyBpbnN0YW5jZQogICAgICAvLyBUT0RPOgogICAgICAvLyAgIFdlIGNvdWxkIGdyYWIgdGhlIElEIGZyb20gdGhlIGRyb3Bkb3duLCBhbmQgbGlzdGVuIGZvcgogICAgICAvLyAgICRyb290IGV2ZW50cyBmb3IgdGhhdCBwYXJ0aWN1bGFyIGRyb3Bkb3duIGlkCiAgICAgIC8vICAgRHJvcGRvd24gc2hvd24gYW5kIGhpZGRlbiBldmVudHMgd2lsbCBuZWVkIHRvIGVtaXQKICAgICAgLy8gICBOb3RlOiBEcm9wZG93biBhdXRvLUlEIGhhcHBlbnMgaW4gYSBgJG5leHRUaWNrKClgIGFmdGVyIG1vdW50CiAgICAgIC8vICAgICAgICAgU28gdGhlIElEIGxvb2t1cCB3b3VsZCBuZWVkIHRvIGJlIGRvbmUgaW4gYSBgJG5leHRUaWNrKClgCgoKICAgICAgaWYgKHRhcmdldC5fX3Z1ZV9fKSB7CiAgICAgICAgdGFyZ2V0Ll9fdnVlX19bb24gPyAnJG9uJyA6ICckb2ZmJ10oRVZFTlRfTkFNRV9TSE9XTiwgdGhpcy5mb3JjZUhpZGUpOwogICAgICB9CiAgICB9LAogICAgLy8gLS0tIEV2ZW50IGhhbmRsZXJzIC0tLQogICAgaGFuZGxlRXZlbnQ6IGZ1bmN0aW9uIGhhbmRsZUV2ZW50KGV2ZW50KSB7CiAgICAgIC8vIEdlbmVyYWwgdHJpZ2dlciBldmVudCBoYW5kbGVyCiAgICAgIC8vIHRhcmdldCBpcyB0aGUgdHJpZ2dlciBlbGVtZW50CiAgICAgIHZhciB0YXJnZXQgPSB0aGlzLmdldFRhcmdldCgpOwoKICAgICAgaWYgKCF0YXJnZXQgfHwgaXNEaXNhYmxlZCh0YXJnZXQpIHx8ICF0aGlzLiRfZW5hYmxlZCB8fCB0aGlzLmRyb3Bkb3duT3BlbigpKSB7CiAgICAgICAgLy8gSWYgZGlzYWJsZWQgb3Igbm90IGVuYWJsZWQsIG9yIGlmIGEgZHJvcGRvd24gdGhhdCBpcyBvcGVuLCBkb24ndCBkbyBhbnl0aGluZwogICAgICAgIC8vIElmIHRpcCBpcyBzaG93biBiZWZvcmUgZWxlbWVudCBnZXRzIGRpc2FibGVkLCB0aGVuIHRpcCB3aWxsIG5vdAogICAgICAgIC8vIGNsb3NlIHVudGlsIG5vIGxvbmdlciBkaXNhYmxlZCBvciBmb3JjZWZ1bGx5IGNsb3NlZAogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIHR5cGUgPSBldmVudC50eXBlOwogICAgICB2YXIgdHJpZ2dlcnMgPSB0aGlzLmNvbXB1dGVkVHJpZ2dlcnM7CgogICAgICBpZiAodHlwZSA9PT0gJ2NsaWNrJyAmJiBhcnJheUluY2x1ZGVzKHRyaWdnZXJzLCAnY2xpY2snKSkgewogICAgICAgIHRoaXMuY2xpY2soZXZlbnQpOwogICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdtb3VzZWVudGVyJyAmJiBhcnJheUluY2x1ZGVzKHRyaWdnZXJzLCAnaG92ZXInKSkgewogICAgICAgIC8vIGBtb3VzZWVudGVyYCBpcyBhIG5vbi1idWJibGluZyBldmVudAogICAgICAgIHRoaXMuZW50ZXIoZXZlbnQpOwogICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdmb2N1c2luJyAmJiBhcnJheUluY2x1ZGVzKHRyaWdnZXJzLCAnZm9jdXMnKSkgewogICAgICAgIC8vIGBmb2N1c2luYCBpcyBhIGJ1YmJsaW5nIGV2ZW50CiAgICAgICAgLy8gYGV2ZW50YCBpbmNsdWRlcyBgcmVsYXRlZFRhcmdldGAgKGVsZW1lbnQgbG9zaW5nIGZvY3VzKQogICAgICAgIHRoaXMuZW50ZXIoZXZlbnQpOwogICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdmb2N1c291dCcgJiYgKGFycmF5SW5jbHVkZXModHJpZ2dlcnMsICdmb2N1cycpIHx8IGFycmF5SW5jbHVkZXModHJpZ2dlcnMsICdibHVyJykpIHx8IHR5cGUgPT09ICdtb3VzZWxlYXZlJyAmJiBhcnJheUluY2x1ZGVzKHRyaWdnZXJzLCAnaG92ZXInKSkgewogICAgICAgIC8vIGBmb2N1c291dGAgaXMgYSBidWJibGluZyBldmVudAogICAgICAgIC8vIGBtb3VzZWxlYXZlYCBpcyBhIG5vbi1idWJibGluZyBldmVudAogICAgICAgIC8vIGB0aXBgIGlzIHRoZSB0ZW1wbGF0ZSAod2lsbCBiZSBudWxsIGlmIG5vdCBvcGVuKQogICAgICAgIHZhciB0aXAgPSB0aGlzLmdldFRlbXBsYXRlRWxlbWVudCgpOyAvLyBgZXZlbnRUYXJnZXRgIGlzIHRoZSBlbGVtZW50IHdoaWNoIGlzIGxvc2luZyBmb2N1cy9ob3ZlciBhbmQKCiAgICAgICAgdmFyIGV2ZW50VGFyZ2V0ID0gZXZlbnQudGFyZ2V0OyAvLyBgcmVsYXRlZFRhcmdldGAgaXMgdGhlIGVsZW1lbnQgZ2FpbmluZyBmb2N1cy9ob3ZlcgoKICAgICAgICB2YXIgcmVsYXRlZFRhcmdldCA9IGV2ZW50LnJlbGF0ZWRUYXJnZXQ7CiAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8KCiAgICAgICAgaWYgKCAvLyBGcm9tIHRpcCB0byB0YXJnZXQKICAgICAgICB0aXAgJiYgY29udGFpbnModGlwLCBldmVudFRhcmdldCkgJiYgY29udGFpbnModGFyZ2V0LCByZWxhdGVkVGFyZ2V0KSB8fCAvLyBGcm9tIHRhcmdldCB0byB0aXAKICAgICAgICB0aXAgJiYgY29udGFpbnModGFyZ2V0LCBldmVudFRhcmdldCkgJiYgY29udGFpbnModGlwLCByZWxhdGVkVGFyZ2V0KSB8fCAvLyBXaXRoaW4gdGlwCiAgICAgICAgdGlwICYmIGNvbnRhaW5zKHRpcCwgZXZlbnRUYXJnZXQpICYmIGNvbnRhaW5zKHRpcCwgcmVsYXRlZFRhcmdldCkgfHwgLy8gV2l0aGluIHRhcmdldAogICAgICAgIGNvbnRhaW5zKHRhcmdldCwgZXZlbnRUYXJnZXQpICYmIGNvbnRhaW5zKHRhcmdldCwgcmVsYXRlZFRhcmdldCkpIHsKICAgICAgICAgIC8vIElmIGZvY3VzL2hvdmVyIG1vdmVzIHdpdGhpbiBgdGlwYCBhbmQgYHRhcmdldGAsIGRvbid0IHRyaWdnZXIgYSBsZWF2ZQogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0gLy8gT3RoZXJ3aXNlIHRyaWdnZXIgYSBsZWF2ZQoKCiAgICAgICAgdGhpcy5sZWF2ZShldmVudCk7CiAgICAgIH0KICAgIH0sCiAgICBkb0hpZGU6IGZ1bmN0aW9uIGRvSGlkZShpZCkgewogICAgICAvLyBQcm9ncmFtbWF0aWNhbGx5IGhpZGUgdG9vbHRpcCBvciBwb3BvdmVyCiAgICAgIGlmICghaWQgfHwgdGhpcy5nZXRUYXJnZXRJZCgpID09PSBpZCB8fCB0aGlzLmNvbXB1dGVkSWQgPT09IGlkKSB7CiAgICAgICAgLy8gQ2xvc2UgYWxsIHRvb2x0aXBzIG9yIHBvcG92ZXJzLCBvciB0aGlzIHNwZWNpZmljIHRpcCAod2l0aCBJRCkKICAgICAgICB0aGlzLmZvcmNlSGlkZSgpOwogICAgICB9CiAgICB9LAogICAgZG9TaG93OiBmdW5jdGlvbiBkb1Nob3coaWQpIHsKICAgICAgLy8gUHJvZ3JhbW1hdGljYWxseSBzaG93IHRvb2x0aXAgb3IgcG9wb3ZlcgogICAgICBpZiAoIWlkIHx8IHRoaXMuZ2V0VGFyZ2V0SWQoKSA9PT0gaWQgfHwgdGhpcy5jb21wdXRlZElkID09PSBpZCkgewogICAgICAgIC8vIE9wZW4gYWxsIHRvb2x0aXBzIG9yIHBvcG92ZXJzLCBvciB0aGlzIHNwZWNpZmljIHRpcCAod2l0aCBJRCkKICAgICAgICB0aGlzLnNob3coKTsKICAgICAgfQogICAgfSwKCiAgICAvKmlzdGFuYnVsIGlnbm9yZSBuZXh0OiBpZ25vcmUgZm9yIG5vdyAqLwogICAgZG9EaXNhYmxlOiBmdW5jdGlvbiBkb0Rpc2FibGUoaWQpCiAgICAvKmlzdGFuYnVsIGlnbm9yZSBuZXh0OiBpZ25vcmUgZm9yIG5vdyAqLwogICAgewogICAgICAvLyBQcm9ncmFtbWF0aWNhbGx5IGRpc2FibGUgdG9vbHRpcCBvciBwb3BvdmVyCiAgICAgIGlmICghaWQgfHwgdGhpcy5nZXRUYXJnZXRJZCgpID09PSBpZCB8fCB0aGlzLmNvbXB1dGVkSWQgPT09IGlkKSB7CiAgICAgICAgLy8gRGlzYWJsZSBhbGwgdG9vbHRpcHMgb3IgcG9wb3ZlcnMgKG5vIElEKSwgb3IgdGhpcyBzcGVjaWZpYyB0aXAgKHdpdGggSUQpCiAgICAgICAgdGhpcy5kaXNhYmxlKCk7CiAgICAgIH0KICAgIH0sCgogICAgLyppc3RhbmJ1bCBpZ25vcmUgbmV4dDogaWdub3JlIGZvciBub3cgKi8KICAgIGRvRW5hYmxlOiBmdW5jdGlvbiBkb0VuYWJsZShpZCkKICAgIC8qaXN0YW5idWwgaWdub3JlIG5leHQ6IGlnbm9yZSBmb3Igbm93ICovCiAgICB7CiAgICAgIC8vIFByb2dyYW1tYXRpY2FsbHkgZW5hYmxlIHRvb2x0aXAgb3IgcG9wb3ZlcgogICAgICBpZiAoIWlkIHx8IHRoaXMuZ2V0VGFyZ2V0SWQoKSA9PT0gaWQgfHwgdGhpcy5jb21wdXRlZElkID09PSBpZCkgewogICAgICAgIC8vIEVuYWJsZSBhbGwgdG9vbHRpcHMgb3IgcG9wb3ZlcnMgKG5vIElEKSwgb3IgdGhpcyBzcGVjaWZpYyB0aXAgKHdpdGggSUQpCiAgICAgICAgdGhpcy5lbmFibGUoKTsKICAgICAgfQogICAgfSwKICAgIGNsaWNrOiBmdW5jdGlvbiBjbGljayhldmVudCkgewogICAgICBpZiAoIXRoaXMuJF9lbmFibGVkIHx8IHRoaXMuZHJvcGRvd25PcGVuKCkpIHsKICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBHZXQgYXJvdW5kIGEgV2ViS2l0IGJ1ZyB3aGVyZSBgY2xpY2tgIGRvZXMgbm90IHRyaWdnZXIgZm9jdXMgZXZlbnRzCiAgICAgIC8vIE9uIG1vc3QgYnJvd3NlcnMsIGBjbGlja2AgdHJpZ2dlcnMgYSBgZm9jdXNpbmAvYGZvY3VzYCBldmVudCBmaXJzdAogICAgICAvLyBOZWVkZWQgc28gdGhhdCB0cmlnZ2VyICdjbGljayBibHVyJyB3b3JrcyBvbiBpT1MKICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2Jvb3RzdHJhcC12dWUvYm9vdHN0cmFwLXZ1ZS9pc3N1ZXMvNTA5OQogICAgICAvLyBXZSB1c2UgYGN1cnJlbnRUYXJnZXRgIHJhdGhlciB0aGFuIGB0YXJnZXRgIHRvIHRyaWdnZXIgb24gdGhlCiAgICAgIC8vIGVsZW1lbnQsIG5vdCB0aGUgaW5uZXIgY29udGVudAoKCiAgICAgIGF0dGVtcHRGb2N1cyhldmVudC5jdXJyZW50VGFyZ2V0KTsKICAgICAgdGhpcy5hY3RpdmVUcmlnZ2VyLmNsaWNrID0gIXRoaXMuYWN0aXZlVHJpZ2dlci5jbGljazsKCiAgICAgIGlmICh0aGlzLmlzV2l0aEFjdGl2ZVRyaWdnZXIpIHsKICAgICAgICB0aGlzLmVudGVyKG51bGwpOwogICAgICB9IGVsc2UgewogICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgICAgICAgdGhpcy5sZWF2ZShudWxsKTsKICAgICAgfQogICAgfSwKCiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwogICAgdG9nZ2xlOiBmdW5jdGlvbiB0b2dnbGUoKSB7CiAgICAgIC8vIE1hbnVhbCB0b2dnbGUgaGFuZGxlcgogICAgICBpZiAoIXRoaXMuJF9lbmFibGVkIHx8IHRoaXMuZHJvcGRvd25PcGVuKCkpIHsKICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBTaG91bGQgd2UgcmVnaXN0ZXIgYXMgYW4gYWN0aXZlIHRyaWdnZXI/CiAgICAgIC8vIHRoaXMuYWN0aXZlVHJpZ2dlci5tYW51YWwgPSAhdGhpcy5hY3RpdmVUcmlnZ2VyLm1hbnVhbAoKCiAgICAgIGlmICh0aGlzLmxvY2FsU2hvdykgewogICAgICAgIHRoaXMubGVhdmUobnVsbCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5lbnRlcihudWxsKTsKICAgICAgfQogICAgfSwKICAgIGVudGVyOiBmdW5jdGlvbiBlbnRlcigpIHsKICAgICAgdmFyIF90aGlzMTAgPSB0aGlzOwoKICAgICAgdmFyIGV2ZW50ID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiBudWxsOyAvLyBPcGVuaW5nIHRyaWdnZXIgaGFuZGxlcgogICAgICAvLyBOb3RlOiBDbGljayBldmVudHMgYXJlIHNlbnQgd2l0aCBldmVudCA9PT0gbnVsbAoKICAgICAgaWYgKGV2ZW50KSB7CiAgICAgICAgdGhpcy5hY3RpdmVUcmlnZ2VyW2V2ZW50LnR5cGUgPT09ICdmb2N1c2luJyA/ICdmb2N1cycgOiAnaG92ZXInXSA9IHRydWU7CiAgICAgIH0KICAgICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8KCgogICAgICBpZiAodGhpcy5sb2NhbFNob3cgfHwgdGhpcy4kX2hvdmVyU3RhdGUgPT09ICdpbicpIHsKICAgICAgICB0aGlzLiRfaG92ZXJTdGF0ZSA9ICdpbic7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLmNsZWFySG92ZXJUaW1lb3V0KCk7CiAgICAgIHRoaXMuJF9ob3ZlclN0YXRlID0gJ2luJzsKCiAgICAgIGlmICghdGhpcy5jb21wdXRlZERlbGF5LnNob3cpIHsKICAgICAgICB0aGlzLnNob3coKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBIaWRlIGFueSB0aXRsZSBhdHRyaWJ1dGUgd2hpbGUgZW50ZXIgZGVsYXkgaXMgYWN0aXZlCiAgICAgICAgdGhpcy5maXhUaXRsZSgpOwogICAgICAgIHRoaXMuJF9ob3ZlclRpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBlbHNlICovCiAgICAgICAgICBpZiAoX3RoaXMxMC4kX2hvdmVyU3RhdGUgPT09ICdpbicpIHsKICAgICAgICAgICAgX3RoaXMxMC5zaG93KCk7CiAgICAgICAgICB9IGVsc2UgaWYgKCFfdGhpczEwLmxvY2FsU2hvdykgewogICAgICAgICAgICBfdGhpczEwLnJlc3RvcmVUaXRsZSgpOwogICAgICAgICAgfQogICAgICAgIH0sIHRoaXMuY29tcHV0ZWREZWxheS5zaG93KTsKICAgICAgfQogICAgfSwKICAgIGxlYXZlOiBmdW5jdGlvbiBsZWF2ZSgpIHsKICAgICAgdmFyIF90aGlzMTEgPSB0aGlzOwoKICAgICAgdmFyIGV2ZW50ID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiBudWxsOyAvLyBDbG9zaW5nIHRyaWdnZXIgaGFuZGxlcgogICAgICAvLyBOb3RlOiBDbGljayBldmVudHMgYXJlIHNlbnQgd2l0aCBldmVudCA9PT0gbnVsbAoKICAgICAgaWYgKGV2ZW50KSB7CiAgICAgICAgdGhpcy5hY3RpdmVUcmlnZ2VyW2V2ZW50LnR5cGUgPT09ICdmb2N1c291dCcgPyAnZm9jdXMnIDogJ2hvdmVyJ10gPSBmYWxzZTsKICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwoKICAgICAgICBpZiAoZXZlbnQudHlwZSA9PT0gJ2ZvY3Vzb3V0JyAmJiBhcnJheUluY2x1ZGVzKHRoaXMuY29tcHV0ZWRUcmlnZ2VycywgJ2JsdXInKSkgewogICAgICAgICAgLy8gU3BlY2lhbCBjYXNlIGZvciBgYmx1cmA6IHdlIGNsZWFyIG91dCB0aGUgb3RoZXIgdHJpZ2dlcnMKICAgICAgICAgIHRoaXMuYWN0aXZlVHJpZ2dlci5jbGljayA9IGZhbHNlOwogICAgICAgICAgdGhpcy5hY3RpdmVUcmlnZ2VyLmhvdmVyID0gZmFsc2U7CiAgICAgICAgfQogICAgICB9CiAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0OiBpZ25vcmUgZm9yIG5vdyAqLwoKCiAgICAgIGlmICh0aGlzLmlzV2l0aEFjdGl2ZVRyaWdnZXIpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMuY2xlYXJIb3ZlclRpbWVvdXQoKTsKICAgICAgdGhpcy4kX2hvdmVyU3RhdGUgPSAnb3V0JzsKCiAgICAgIGlmICghdGhpcy5jb21wdXRlZERlbGF5LmhpZGUpIHsKICAgICAgICB0aGlzLmhpZGUoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLiRfaG92ZXJUaW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBpZiAoX3RoaXMxMS4kX2hvdmVyU3RhdGUgPT09ICdvdXQnKSB7CiAgICAgICAgICAgIF90aGlzMTEuaGlkZSgpOwogICAgICAgICAgfQogICAgICAgIH0sIHRoaXMuY29tcHV0ZWREZWxheS5oaWRlKTsKICAgICAgfQogICAgfQogIH0KfSk7"},null]}