{"remainingRequest":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/thread-loader/dist/cjs.js!/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/babel-loader/lib/index.js!/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/bootstrap-vue/esm/components/calendar/calendar.js","dependencies":[{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/bootstrap-vue/esm/components/calendar/calendar.js","mtime":499162500000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/babel-loader/lib/index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmtleXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zeW1ib2wuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5maWx0ZXIuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuZ2V0LW93bi1wcm9wZXJ0eS1kZXNjcmlwdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5mb3ItZWFjaC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5nZXQtb3duLXByb3BlcnR5LWRlc2NyaXB0b3JzLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcucmVwbGFjZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5Lm1hcC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmpvaW4uanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zbGljZS5qcyI7Cgp2YXIgX3dhdGNoOwoKZnVuY3Rpb24gb3duS2V5cyhvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7CiAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvYmplY3QpOwoKICBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykgewogICAgdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7CiAgICBpZiAoZW51bWVyYWJsZU9ubHkpIHN5bWJvbHMgPSBzeW1ib2xzLmZpbHRlcihmdW5jdGlvbiAoc3ltKSB7CiAgICAgIHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlOwogICAgfSk7CiAgICBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7CiAgfQoKICByZXR1cm4ga2V5czsKfQoKZnVuY3Rpb24gX29iamVjdFNwcmVhZCh0YXJnZXQpIHsKICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgewogICAgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXSAhPSBudWxsID8gYXJndW1lbnRzW2ldIDoge307CgogICAgaWYgKGkgJSAyKSB7CiAgICAgIG93bktleXMoT2JqZWN0KHNvdXJjZSksIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgIF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOwogICAgICB9KTsKICAgIH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsKICAgIH0gZWxzZSB7CiAgICAgIG93bktleXMoT2JqZWN0KHNvdXJjZSkpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIGtleSkpOwogICAgICB9KTsKICAgIH0KICB9CgogIHJldHVybiB0YXJnZXQ7Cn0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHsKICBpZiAoa2V5IGluIG9iaikgewogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7CiAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgY29uZmlndXJhYmxlOiB0cnVlLAogICAgICB3cml0YWJsZTogdHJ1ZQogICAgfSk7CiAgfSBlbHNlIHsKICAgIG9ialtrZXldID0gdmFsdWU7CiAgfQoKICByZXR1cm4gb2JqOwp9CgppbXBvcnQgeyBWdWUgfSBmcm9tICcuLi8uLi92dWUnOwppbXBvcnQgeyBOQU1FX0NBTEVOREFSIH0gZnJvbSAnLi4vLi4vY29uc3RhbnRzL2NvbXBvbmVudHMnOwppbXBvcnQgeyBDQUxFTkRBUl9HUkVHT1JZLCBDQUxFTkRBUl9MT05HLCBDQUxFTkRBUl9OQVJST1csIENBTEVOREFSX1NIT1JULCBEQVRFX0ZPUk1BVF8yX0RJR0lULCBEQVRFX0ZPUk1BVF9OVU1FUklDIH0gZnJvbSAnLi4vLi4vY29uc3RhbnRzL2RhdGUnOwppbXBvcnQgeyBFVkVOVF9OQU1FX0NPTlRFWFQsIEVWRU5UX05BTUVfU0VMRUNURUQgfSBmcm9tICcuLi8uLi9jb25zdGFudHMvZXZlbnRzJzsKaW1wb3J0IHsgQ09ERV9ET1dOLCBDT0RFX0VORCwgQ09ERV9FTlRFUiwgQ09ERV9IT01FLCBDT0RFX0xFRlQsIENPREVfUEFHRURPV04sIENPREVfUEFHRVVQLCBDT0RFX1JJR0hULCBDT0RFX1NQQUNFLCBDT0RFX1VQIH0gZnJvbSAnLi4vLi4vY29uc3RhbnRzL2tleS1jb2Rlcyc7CmltcG9ydCB7IFBST1BfVFlQRV9BUlJBWV9TVFJJTkcsIFBST1BfVFlQRV9CT09MRUFOLCBQUk9QX1RZUEVfREFURV9TVFJJTkcsIFBST1BfVFlQRV9GVU5DVElPTiwgUFJPUF9UWVBFX05VTUJFUl9TVFJJTkcsIFBST1BfVFlQRV9PQkpFQ1QsIFBST1BfVFlQRV9TVFJJTkcgfSBmcm9tICcuLi8uLi9jb25zdGFudHMvcHJvcHMnOwppbXBvcnQgeyBTTE9UX05BTUVfTkFWX05FWFRfREVDQURFLCBTTE9UX05BTUVfTkFWX05FWFRfTU9OVEgsIFNMT1RfTkFNRV9OQVZfTkVYVF9ZRUFSLCBTTE9UX05BTUVfTkFWX1BFVl9ERUNBREUsIFNMT1RfTkFNRV9OQVZfUEVWX01PTlRILCBTTE9UX05BTUVfTkFWX1BFVl9ZRUFSLCBTTE9UX05BTUVfTkFWX1RISVNfTU9OVEggfSBmcm9tICcuLi8uLi9jb25zdGFudHMvc2xvdHMnOwppbXBvcnQgeyBhcnJheUluY2x1ZGVzLCBjb25jYXQgfSBmcm9tICcuLi8uLi91dGlscy9hcnJheSc7CmltcG9ydCB7IGNyZWF0ZURhdGUsIGNyZWF0ZURhdGVGb3JtYXR0ZXIsIGNvbnN0cmFpbkRhdGUgYXMgX2NvbnN0cmFpbkRhdGUsIGRhdGVzRXF1YWwsIGZpcnN0RGF0ZU9mTW9udGgsIGZvcm1hdFlNRCwgbGFzdERhdGVPZk1vbnRoLCBvbmVNb250aEFnbywgb25lTW9udGhBaGVhZCwgb25lWWVhckFnbywgb25lWWVhckFoZWFkLCBvbmVEZWNhZGVBZ28sIG9uZURlY2FkZUFoZWFkLCBwYXJzZVlNRCwgcmVzb2x2ZUxvY2FsZSB9IGZyb20gJy4uLy4uL3V0aWxzL2RhdGUnOwppbXBvcnQgeyBhdHRlbXB0Qmx1ciwgYXR0ZW1wdEZvY3VzLCByZXF1ZXN0QUYgfSBmcm9tICcuLi8uLi91dGlscy9kb20nOwppbXBvcnQgeyBzdG9wRXZlbnQgfSBmcm9tICcuLi8uLi91dGlscy9ldmVudHMnOwppbXBvcnQgeyBpZGVudGl0eSB9IGZyb20gJy4uLy4uL3V0aWxzL2lkZW50aXR5JzsKaW1wb3J0IHsgaXNBcnJheSwgaXNQbGFpbk9iamVjdCwgaXNTdHJpbmcgfSBmcm9tICcuLi8uLi91dGlscy9pbnNwZWN0JzsKaW1wb3J0IHsgaXNMb2NhbGVSVEwgfSBmcm9tICcuLi8uLi91dGlscy9sb2NhbGUnOwppbXBvcnQgeyBsb29zZUVxdWFsIH0gZnJvbSAnLi4vLi4vdXRpbHMvbG9vc2UtZXF1YWwnOwppbXBvcnQgeyBtYXRoTWF4IH0gZnJvbSAnLi4vLi4vdXRpbHMvbWF0aCc7CmltcG9ydCB7IG1ha2VNb2RlbE1peGluIH0gZnJvbSAnLi4vLi4vdXRpbHMvbW9kZWwnOwppbXBvcnQgeyB0b0ludGVnZXIgfSBmcm9tICcuLi8uLi91dGlscy9udW1iZXInOwppbXBvcnQgeyBzb3J0S2V5cyB9IGZyb20gJy4uLy4uL3V0aWxzL29iamVjdCc7CmltcG9ydCB7IGhhc1Byb3BGdW5jdGlvbiwgbWFrZVByb3AsIG1ha2VQcm9wc0NvbmZpZ3VyYWJsZSB9IGZyb20gJy4uLy4uL3V0aWxzL3Byb3BzJzsKaW1wb3J0IHsgdG9TdHJpbmcgfSBmcm9tICcuLi8uLi91dGlscy9zdHJpbmcnOwppbXBvcnQgeyBhdHRyc01peGluIH0gZnJvbSAnLi4vLi4vbWl4aW5zL2F0dHJzJzsKaW1wb3J0IHsgaWRNaXhpbiwgcHJvcHMgYXMgaWRQcm9wcyB9IGZyb20gJy4uLy4uL21peGlucy9pZCc7CmltcG9ydCB7IG5vcm1hbGl6ZVNsb3RNaXhpbiB9IGZyb20gJy4uLy4uL21peGlucy9ub3JtYWxpemUtc2xvdCc7CmltcG9ydCB7IEJJY29uQ2hldnJvbkxlZnQsIEJJY29uQ2hldnJvbkRvdWJsZUxlZnQsIEJJY29uQ2hldnJvbkJhckxlZnQsIEJJY29uQ2lyY2xlRmlsbCB9IGZyb20gJy4uLy4uL2ljb25zL2ljb25zJzsgLy8gLS0tIENvbnN0YW50cyAtLS0KCnZhciBfbWFrZU1vZGVsTWl4aW4gPSBtYWtlTW9kZWxNaXhpbigndmFsdWUnLCB7CiAgdHlwZTogUFJPUF9UWVBFX0RBVEVfU1RSSU5HCn0pLAogICAgbW9kZWxNaXhpbiA9IF9tYWtlTW9kZWxNaXhpbi5taXhpbiwKICAgIG1vZGVsUHJvcHMgPSBfbWFrZU1vZGVsTWl4aW4ucHJvcHMsCiAgICBNT0RFTF9QUk9QX05BTUUgPSBfbWFrZU1vZGVsTWl4aW4ucHJvcCwKICAgIE1PREVMX0VWRU5UX05BTUUgPSBfbWFrZU1vZGVsTWl4aW4uZXZlbnQ7IC8vIC0tLSBQcm9wcyAtLS0KCgpleHBvcnQgdmFyIHByb3BzID0gbWFrZVByb3BzQ29uZmlndXJhYmxlKHNvcnRLZXlzKF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBpZFByb3BzKSwgbW9kZWxQcm9wcyksIHt9LCB7CiAgYXJpYUNvbnRyb2xzOiBtYWtlUHJvcChQUk9QX1RZUEVfU1RSSU5HKSwKICAvLyBNYWtlcyBjYWxlbmRhciB0aGUgZnVsbCB3aWR0aCBvZiBpdHMgcGFyZW50IGNvbnRhaW5lcgogIGJsb2NrOiBtYWtlUHJvcChQUk9QX1RZUEVfQk9PTEVBTiwgZmFsc2UpLAogIGRhdGVEaXNhYmxlZEZuOiBtYWtlUHJvcChQUk9QX1RZUEVfRlVOQ1RJT04pLAogIC8vIGBJbnRsLkRhdGVUaW1lRm9ybWF0YCBvYmplY3QKICBkYXRlRm9ybWF0T3B0aW9uczogbWFrZVByb3AoUFJPUF9UWVBFX09CSkVDVCwgewogICAgeWVhcjogREFURV9GT1JNQVRfTlVNRVJJQywKICAgIG1vbnRoOiBDQUxFTkRBUl9MT05HLAogICAgZGF5OiBEQVRFX0ZPUk1BVF9OVU1FUklDLAogICAgd2Vla2RheTogQ0FMRU5EQVJfTE9ORwogIH0pLAogIC8vIEZ1bmN0aW9uIHRvIHNldCBhIGNsYXNzIG9mIChjbGFzc2VzKSBvbiB0aGUgZGF0ZSBjZWxsCiAgLy8gaWYgcGFzc2VkIGEgc3RyaW5nIG9yIGFuIGFycmF5CiAgLy8gVE9ETzoKICAvLyAgIElmIHRoZSBmdW5jdGlvbiByZXR1cm5zIGFuIG9iamVjdCwgbG9vayBmb3IgY2xhc3MgcHJvcCBmb3IgY2xhc3NlcywKICAvLyAgIGFuZCBvdGhlciBwcm9wcyBmb3IgaGFuZGxpbmcgZXZlbnRzL2RldGFpbHMvZGVzY3JpcHRpb25zCiAgZGF0ZUluZm9GbjogbWFrZVByb3AoUFJPUF9UWVBFX0ZVTkNUSU9OKSwKICAvLyAnbHRyJywgJ3J0bCcsIG9yIGBudWxsYCAoZm9yIGF1dG8gZGV0ZWN0KQogIGRpcmVjdGlvbjogbWFrZVByb3AoUFJPUF9UWVBFX1NUUklORyksCiAgZGlzYWJsZWQ6IG1ha2VQcm9wKFBST1BfVFlQRV9CT09MRUFOLCBmYWxzZSksCiAgLy8gV2hlbiBgdHJ1ZWAsIHJlbmRlcnMgYSBjb21tZW50IG5vZGUsIGJ1dCBrZWVwcyB0aGUgY29tcG9uZW50IGluc3RhbmNlIGFjdGl2ZQogIC8vIE1haW5seSBmb3IgPGItZm9ybS1kYXRlPiwgc28gdGhhdCB3ZSBjYW4gZ2V0IHRoZSBjb21wb25lbnQncyB2YWx1ZSBhbmQgbG9jYWxlCiAgLy8gQnV0IHdlIG1pZ2h0IGp1c3QgdXNlIHNlcGFyYXRlIGRhdGUgZm9ybWF0dGVycywgdXNpbmcgdGhlIHJlc29sdmVkIGxvY2FsZQogIC8vIChhZGp1c3RlZCBmb3IgdGhlIGdyZWdvcmlhbiBjYWxlbmRhcikKICBoaWRkZW46IG1ha2VQcm9wKFBST1BfVFlQRV9CT09MRUFOLCBmYWxzZSksCiAgLy8gV2hlbiBgdHJ1ZWAgbWFrZXMgdGhlIHNlbGVjdGVkIGRhdGUgaGVhZGVyIGBzci1vbmx5YAogIGhpZGVIZWFkZXI6IG1ha2VQcm9wKFBST1BfVFlQRV9CT09MRUFOLCBmYWxzZSksCiAgLy8gVGhpcyBzcGVjaWZpZXMgdGhlIGNhbGVuZGFyIHllYXIvbW9udGgvZGF5IHRoYXQgd2lsbCBiZSBzaG93biB3aGVuCiAgLy8gZmlyc3Qgb3BlbmluZyB0aGUgZGF0ZXBpY2tlciBpZiBubyB2LW1vZGVsIHZhbHVlIGlzIHByb3ZpZGVkCiAgLy8gRGVmYXVsdCBpcyB0aGUgY3VycmVudCBkYXRlIChvciBgbWluYC9gbWF4YCkKICBpbml0aWFsRGF0ZTogbWFrZVByb3AoUFJPUF9UWVBFX0RBVEVfU1RSSU5HKSwKICAvLyBMYWJlbHMgZm9yIGJ1dHRvbnMgYW5kIGtleWJvYXJkIHNob3J0Y3V0cwogIGxhYmVsQ2FsZW5kYXI6IG1ha2VQcm9wKFBST1BfVFlQRV9TVFJJTkcsICdDYWxlbmRhcicpLAogIGxhYmVsQ3VycmVudE1vbnRoOiBtYWtlUHJvcChQUk9QX1RZUEVfU1RSSU5HLCAnQ3VycmVudCBtb250aCcpLAogIGxhYmVsSGVscDogbWFrZVByb3AoUFJPUF9UWVBFX1NUUklORywgJ1VzZSBjdXJzb3Iga2V5cyB0byBuYXZpZ2F0ZSBjYWxlbmRhciBkYXRlcycpLAogIGxhYmVsTmF2OiBtYWtlUHJvcChQUk9QX1RZUEVfU1RSSU5HLCAnQ2FsZW5kYXIgbmF2aWdhdGlvbicpLAogIGxhYmVsTmV4dERlY2FkZTogbWFrZVByb3AoUFJPUF9UWVBFX1NUUklORywgJ05leHQgZGVjYWRlJyksCiAgbGFiZWxOZXh0TW9udGg6IG1ha2VQcm9wKFBST1BfVFlQRV9TVFJJTkcsICdOZXh0IG1vbnRoJyksCiAgbGFiZWxOZXh0WWVhcjogbWFrZVByb3AoUFJPUF9UWVBFX1NUUklORywgJ05leHQgeWVhcicpLAogIGxhYmVsTm9EYXRlU2VsZWN0ZWQ6IG1ha2VQcm9wKFBST1BfVFlQRV9TVFJJTkcsICdObyBkYXRlIHNlbGVjdGVkJyksCiAgbGFiZWxQcmV2RGVjYWRlOiBtYWtlUHJvcChQUk9QX1RZUEVfU1RSSU5HLCAnUHJldmlvdXMgZGVjYWRlJyksCiAgbGFiZWxQcmV2TW9udGg6IG1ha2VQcm9wKFBST1BfVFlQRV9TVFJJTkcsICdQcmV2aW91cyBtb250aCcpLAogIGxhYmVsUHJldlllYXI6IG1ha2VQcm9wKFBST1BfVFlQRV9TVFJJTkcsICdQcmV2aW91cyB5ZWFyJyksCiAgbGFiZWxTZWxlY3RlZDogbWFrZVByb3AoUFJPUF9UWVBFX1NUUklORywgJ1NlbGVjdGVkIGRhdGUnKSwKICBsYWJlbFRvZGF5OiBtYWtlUHJvcChQUk9QX1RZUEVfU1RSSU5HLCAnVG9kYXknKSwKICAvLyBMb2NhbGUocykgdG8gdXNlCiAgLy8gRGVmYXVsdCBpcyB0byB1c2UgcGFnZS9icm93c2VyIGRlZmF1bHQgc2V0dGluZwogIGxvY2FsZTogbWFrZVByb3AoUFJPUF9UWVBFX0FSUkFZX1NUUklORyksCiAgbWF4OiBtYWtlUHJvcChQUk9QX1RZUEVfREFURV9TVFJJTkcpLAogIG1pbjogbWFrZVByb3AoUFJPUF9UWVBFX0RBVEVfU1RSSU5HKSwKICAvLyBWYXJpYW50IGNvbG9yIHRvIHVzZSBmb3IgdGhlIG5hdmlnYXRpb24gYnV0dG9ucwogIG5hdkJ1dHRvblZhcmlhbnQ6IG1ha2VQcm9wKFBST1BfVFlQRV9TVFJJTkcsICdzZWNvbmRhcnknKSwKICAvLyBEaXNhYmxlIGhpZ2hsaWdodGluZyB0b2RheSdzIGRhdGUKICBub0hpZ2hsaWdodFRvZGF5OiBtYWtlUHJvcChQUk9QX1RZUEVfQk9PTEVBTiwgZmFsc2UpLAogIG5vS2V5TmF2OiBtYWtlUHJvcChQUk9QX1RZUEVfQk9PTEVBTiwgZmFsc2UpLAogIHJlYWRvbmx5OiBtYWtlUHJvcChQUk9QX1RZUEVfQk9PTEVBTiwgZmFsc2UpLAogIHJvbGVEZXNjcmlwdGlvbjogbWFrZVByb3AoUFJPUF9UWVBFX1NUUklORyksCiAgLy8gVmFyaWFudCBjb2xvciB0byB1c2UgZm9yIHRoZSBzZWxlY3RlZCBkYXRlCiAgc2VsZWN0ZWRWYXJpYW50OiBtYWtlUHJvcChQUk9QX1RZUEVfU1RSSU5HLCAncHJpbWFyeScpLAogIC8vIFdoZW4gYHRydWVgIGVuYWJsZXMgdGhlIGRlY2FkZSBuYXZpZ2F0aW9uIGJ1dHRvbnMKICBzaG93RGVjYWRlTmF2OiBtYWtlUHJvcChQUk9QX1RZUEVfQk9PTEVBTiwgZmFsc2UpLAogIC8vIERheSBvZiB3ZWVrIHRvIHN0YXJ0IGNhbGVuZGFyIG9uCiAgLy8gYDBgIChTdW5kYXkpLCBgMWAgKE1vbmRheSksIC4uLiBgNmAgKFNhdHVyZGF5KQogIHN0YXJ0V2Vla2RheTogbWFrZVByb3AoUFJPUF9UWVBFX05VTUJFUl9TVFJJTkcsIDApLAogIC8vIFZhcmlhbnQgY29sb3IgdG8gdXNlIGZvciB0b2RheSdzIGRhdGUgKGRlZmF1bHRzIHRvIGBzZWxlY3RlZFZhcmlhbnRgKQogIHRvZGF5VmFyaWFudDogbWFrZVByb3AoUFJPUF9UWVBFX1NUUklORyksCiAgLy8gQWx3YXlzIHJldHVybiB0aGUgYHYtbW9kZWxgIHZhbHVlIGFzIGEgZGF0ZSBvYmplY3QKICB2YWx1ZUFzRGF0ZTogbWFrZVByb3AoUFJPUF9UWVBFX0JPT0xFQU4sIGZhbHNlKSwKICAvLyBGb3JtYXQgb2YgdGhlIHdlZWtkYXkgbmFtZXMgYXQgdGhlIHRvcCBvZiB0aGUgY2FsZW5kYXIKICAvLyBgc2hvcnRgIGlzIHR5cGljYWxseSBhIDMgbGV0dGVyIGFiYnJldmlhdGlvbiwKICAvLyBgbmFycm93YCBpcyB0eXBpY2FsbHkgYSBzaW5nbGUgbGV0dGVyCiAgLy8gYGxvbmdgIGlzIHRoZSBmdWxsIHdlZWsgZGF5IG5hbWUKICAvLyBBbHRob3VnaCBzb21lIGxvY2FsZXMgbWF5IG92ZXJyaWRlIHRoaXMgKGkuZSBgYXJgLCBldGMuKQogIHdlZWtkYXlIZWFkZXJGb3JtYXQ6IG1ha2VQcm9wKFBST1BfVFlQRV9TVFJJTkcsIENBTEVOREFSX1NIT1JULCBmdW5jdGlvbiAodmFsdWUpIHsKICAgIHJldHVybiBhcnJheUluY2x1ZGVzKFtDQUxFTkRBUl9MT05HLCBDQUxFTkRBUl9TSE9SVCwgQ0FMRU5EQVJfTkFSUk9XXSwgdmFsdWUpOwogIH0pLAogIC8vIEhhcyBubyBlZmZlY3QgaWYgcHJvcCBgYmxvY2tgIGlzIHNldAogIHdpZHRoOiBtYWtlUHJvcChQUk9QX1RZUEVfU1RSSU5HLCAnMjcwcHgnKQp9KSksIE5BTUVfQ0FMRU5EQVIpOyAvLyAtLS0gTWFpbiBjb21wb25lbnQgLS0tCi8vIEB2dWUvY29tcG9uZW50CgpleHBvcnQgdmFyIEJDYWxlbmRhciA9IFZ1ZS5leHRlbmQoewogIG5hbWU6IE5BTUVfQ0FMRU5EQVIsCiAgLy8gTWl4aW4gb3JkZXIgaXMgaW1wb3J0YW50IQogIG1peGluczogW2F0dHJzTWl4aW4sIGlkTWl4aW4sIG1vZGVsTWl4aW4sIG5vcm1hbGl6ZVNsb3RNaXhpbl0sCiAgcHJvcHM6IHByb3BzLAogIGRhdGE6IGZ1bmN0aW9uIGRhdGEoKSB7CiAgICB2YXIgc2VsZWN0ZWQgPSBmb3JtYXRZTUQodGhpc1tNT0RFTF9QUk9QX05BTUVdKSB8fCAnJzsKICAgIHJldHVybiB7CiAgICAgIC8vIFNlbGVjdGVkIGRhdGUKICAgICAgc2VsZWN0ZWRZTUQ6IHNlbGVjdGVkLAogICAgICAvLyBEYXRlIGluIGNhbGVuZGFyIGdyaWQgdGhhdCBoYXMgYHRhYmluZGV4YCBvZiBgMGAKICAgICAgYWN0aXZlWU1EOiBzZWxlY3RlZCB8fCBmb3JtYXRZTUQoX2NvbnN0cmFpbkRhdGUodGhpcy5pbml0aWFsRGF0ZSB8fCB0aGlzLmdldFRvZGF5KCkpLCB0aGlzLm1pbiwgdGhpcy5tYXgpLAogICAgICAvLyBXaWxsIGJlIHRydWUgaWYgdGhlIGNhbGVuZGFyIGdyaWQgaGFzL2NvbnRhaW5zIGZvY3VzCiAgICAgIGdyaWRIYXNGb2N1czogZmFsc2UsCiAgICAgIC8vIEZsYWcgdG8gZW5hYmxlIHRoZSBgYXJpYS1saXZlYCByZWdpb24ocykgYWZ0ZXIgbW91bnQKICAgICAgLy8gdG8gcHJldmVudCBzY3JlZW4gcmVhZGVyICJvdXRidXJzdHMiIHdoZW4gbW91bnRpbmcKICAgICAgaXNMaXZlOiBmYWxzZQogICAgfTsKICB9LAogIGNvbXB1dGVkOiB7CiAgICB2YWx1ZUlkOiBmdW5jdGlvbiB2YWx1ZUlkKCkgewogICAgICByZXR1cm4gdGhpcy5zYWZlSWQoKTsKICAgIH0sCiAgICB3aWRnZXRJZDogZnVuY3Rpb24gd2lkZ2V0SWQoKSB7CiAgICAgIHJldHVybiB0aGlzLnNhZmVJZCgnX2NhbGVuZGFyLXdyYXBwZXJfJyk7CiAgICB9LAogICAgbmF2SWQ6IGZ1bmN0aW9uIG5hdklkKCkgewogICAgICByZXR1cm4gdGhpcy5zYWZlSWQoJ19jYWxlbmRhci1uYXZfJyk7CiAgICB9LAogICAgZ3JpZElkOiBmdW5jdGlvbiBncmlkSWQoKSB7CiAgICAgIHJldHVybiB0aGlzLnNhZmVJZCgnX2NhbGVuZGFyLWdyaWRfJyk7CiAgICB9LAogICAgZ3JpZENhcHRpb25JZDogZnVuY3Rpb24gZ3JpZENhcHRpb25JZCgpIHsKICAgICAgcmV0dXJuIHRoaXMuc2FmZUlkKCdfY2FsZW5kYXItZ3JpZC1jYXB0aW9uXycpOwogICAgfSwKICAgIGdyaWRIZWxwSWQ6IGZ1bmN0aW9uIGdyaWRIZWxwSWQoKSB7CiAgICAgIHJldHVybiB0aGlzLnNhZmVJZCgnX2NhbGVuZGFyLWdyaWQtaGVscF8nKTsKICAgIH0sCiAgICBhY3RpdmVJZDogZnVuY3Rpb24gYWN0aXZlSWQoKSB7CiAgICAgIHJldHVybiB0aGlzLmFjdGl2ZVlNRCA/IHRoaXMuc2FmZUlkKCJfY2VsbC0iLmNvbmNhdCh0aGlzLmFjdGl2ZVlNRCwgIl8iKSkgOiBudWxsOwogICAgfSwKICAgIC8vIFRPRE86IFVzZSBjb21wdXRlZCBwcm9wcyB0byBjb252ZXJ0IGBZWVlZLU1NLUREYCB0byBgRGF0ZWAgb2JqZWN0CiAgICBzZWxlY3RlZERhdGU6IGZ1bmN0aW9uIHNlbGVjdGVkRGF0ZSgpIHsKICAgICAgLy8gU2VsZWN0ZWQgYXMgYSBgRGF0ZWAgb2JqZWN0CiAgICAgIHJldHVybiBwYXJzZVlNRCh0aGlzLnNlbGVjdGVkWU1EKTsKICAgIH0sCiAgICBhY3RpdmVEYXRlOiBmdW5jdGlvbiBhY3RpdmVEYXRlKCkgewogICAgICAvLyBBY3RpdmUgYXMgYSBgRGF0ZWAgb2JqZWN0CiAgICAgIHJldHVybiBwYXJzZVlNRCh0aGlzLmFjdGl2ZVlNRCk7CiAgICB9LAogICAgY29tcHV0ZWRNaW46IGZ1bmN0aW9uIGNvbXB1dGVkTWluKCkgewogICAgICByZXR1cm4gcGFyc2VZTUQodGhpcy5taW4pOwogICAgfSwKICAgIGNvbXB1dGVkTWF4OiBmdW5jdGlvbiBjb21wdXRlZE1heCgpIHsKICAgICAgcmV0dXJuIHBhcnNlWU1EKHRoaXMubWF4KTsKICAgIH0sCiAgICBjb21wdXRlZFdlZWtTdGFydHM6IGZ1bmN0aW9uIGNvbXB1dGVkV2Vla1N0YXJ0cygpIHsKICAgICAgLy8gYHN0YXJ0V2Vla2RheWAgaXMgYSBwcm9wIChjb25zdHJhaW5lZCB0byBgMGAgdGhyb3VnaCBgNmApCiAgICAgIHJldHVybiBtYXRoTWF4KHRvSW50ZWdlcih0aGlzLnN0YXJ0V2Vla2RheSwgMCksIDApICUgNzsKICAgIH0sCiAgICBjb21wdXRlZExvY2FsZTogZnVuY3Rpb24gY29tcHV0ZWRMb2NhbGUoKSB7CiAgICAgIC8vIFJldHVybnMgdGhlIHJlc29sdmVkIGxvY2FsZSB1c2VkIGJ5IHRoZSBjYWxlbmRhcgogICAgICByZXR1cm4gcmVzb2x2ZUxvY2FsZShjb25jYXQodGhpcy5sb2NhbGUpLmZpbHRlcihpZGVudGl0eSksIENBTEVOREFSX0dSRUdPUlkpOwogICAgfSwKICAgIGNvbXB1dGVkRGF0ZURpc2FibGVkRm46IGZ1bmN0aW9uIGNvbXB1dGVkRGF0ZURpc2FibGVkRm4oKSB7CiAgICAgIHZhciBkYXRlRGlzYWJsZWRGbiA9IHRoaXMuZGF0ZURpc2FibGVkRm47CiAgICAgIHJldHVybiBoYXNQcm9wRnVuY3Rpb24oZGF0ZURpc2FibGVkRm4pID8gZGF0ZURpc2FibGVkRm4gOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9OwogICAgfSwKICAgIC8vIFRPRE86IENoYW5nZSBgZGF0ZUluZm9GbmAgdG8gaGFuZGxlIGV2ZW50cyBhbmQgbm90ZXMgYXMgd2VsbCBhcyBjbGFzc2VzCiAgICBjb21wdXRlZERhdGVJbmZvRm46IGZ1bmN0aW9uIGNvbXB1dGVkRGF0ZUluZm9GbigpIHsKICAgICAgdmFyIGRhdGVJbmZvRm4gPSB0aGlzLmRhdGVJbmZvRm47CiAgICAgIHJldHVybiBoYXNQcm9wRnVuY3Rpb24oZGF0ZUluZm9GbikgPyBkYXRlSW5mb0ZuIDogZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB7fTsKICAgICAgfTsKICAgIH0sCiAgICBjYWxlbmRhckxvY2FsZTogZnVuY3Rpb24gY2FsZW5kYXJMb2NhbGUoKSB7CiAgICAgIC8vIFRoaXMgbG9jYWxlIGVuZm9yY2VzIHRoZSBncmVnb3JpYW4gY2FsZW5kYXIgKGZvciB1c2UgaW4gZm9ybWF0dGVyIGZ1bmN0aW9ucykKICAgICAgLy8gTmVlZGVkIGJlY2F1c2UgSUUgMTEgcmVzb2x2ZXMgYGFyLUlSYCBhcyBpc2xhbWljLWNpdmlsIGNhbGVuZGFyCiAgICAgIC8vIGFuZCBJRSAxMSAoYW5kIHNvbWUgb3RoZXIgYnJvd3NlcnMpIGRvIG5vdCBzdXBwb3J0IHRoZSBgY2FsZW5kYXJgIG9wdGlvbgogICAgICAvLyBBbmQgd2UgY3VycmVudGx5IG9ubHkgc3VwcG9ydCB0aGUgZ3JlZ29yaWFuIGNhbGVuZGFyCiAgICAgIHZhciBmbXQgPSBuZXcgSW50bC5EYXRlVGltZUZvcm1hdCh0aGlzLmNvbXB1dGVkTG9jYWxlLCB7CiAgICAgICAgY2FsZW5kYXI6IENBTEVOREFSX0dSRUdPUlkKICAgICAgfSk7CiAgICAgIHZhciBjYWxlbmRhciA9IGZtdC5yZXNvbHZlZE9wdGlvbnMoKS5jYWxlbmRhcjsKICAgICAgdmFyIGxvY2FsZSA9IGZtdC5yZXNvbHZlZE9wdGlvbnMoKS5sb2NhbGU7CiAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZjogbWFpbmx5IGZvciBJRSAxMSBhbmQgYSBmZXcgb3RoZXIgYnJvd3NlcnMsIGhhcmQgdG8gdGVzdCBpbiBKU0RPTSAqLwoKICAgICAgaWYgKGNhbGVuZGFyICE9PSBDQUxFTkRBUl9HUkVHT1JZKSB7CiAgICAgICAgLy8gRW5zdXJlIHRoZSBsb2NhbGUgcmVxdWVzdHMgdGhlIGdyZWdvcmlhbiBjYWxlbmRhcgogICAgICAgIC8vIE1haW5seSBmb3IgSUUgMTEsIGFuZCBjdXJyZW50bHkgd2UgY2FuJ3QgaGFuZGxlIG5vbi1ncmVnb3JpYW4gY2FsZW5kYXJzCiAgICAgICAgLy8gVE9ETzogU2hvdWxkIHdlIGFsd2F5cyByZXR1cm4gdGhpcyB2YWx1ZT8KICAgICAgICBsb2NhbGUgPSBsb2NhbGUucmVwbGFjZSgvLXUtLiskL2ksICcnKS5jb25jYXQoJy11LWNhLWdyZWdvcnknKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGxvY2FsZTsKICAgIH0sCiAgICBjYWxlbmRhclllYXI6IGZ1bmN0aW9uIGNhbGVuZGFyWWVhcigpIHsKICAgICAgcmV0dXJuIHRoaXMuYWN0aXZlRGF0ZS5nZXRGdWxsWWVhcigpOwogICAgfSwKICAgIGNhbGVuZGFyTW9udGg6IGZ1bmN0aW9uIGNhbGVuZGFyTW9udGgoKSB7CiAgICAgIHJldHVybiB0aGlzLmFjdGl2ZURhdGUuZ2V0TW9udGgoKTsKICAgIH0sCiAgICBjYWxlbmRhckZpcnN0RGF5OiBmdW5jdGlvbiBjYWxlbmRhckZpcnN0RGF5KCkgewogICAgICAvLyBXZSBzZXQgdGhlIHRpbWUgZm9yIHRoaXMgZGF0ZSB0byAxMnBtIHRvIHdvcmsgYXJvdW5kCiAgICAgIC8vIGRhdGUgZm9ybWF0dGluZyBpc3N1ZXMgaW4gRmlyZWZveCBhbmQgU2FmYXJpCiAgICAgIC8vIFNlZTogaHR0cHM6Ly9naXRodWIuY29tL2Jvb3RzdHJhcC12dWUvYm9vdHN0cmFwLXZ1ZS9pc3N1ZXMvNTgxOAogICAgICByZXR1cm4gY3JlYXRlRGF0ZSh0aGlzLmNhbGVuZGFyWWVhciwgdGhpcy5jYWxlbmRhck1vbnRoLCAxLCAxMik7CiAgICB9LAogICAgY2FsZW5kYXJEYXlzSW5Nb250aDogZnVuY3Rpb24gY2FsZW5kYXJEYXlzSW5Nb250aCgpIHsKICAgICAgLy8gV2UgY3JlYXRlIGEgbmV3IGRhdGUgYXMgdG8gbm90IG11dGF0ZSB0aGUgb3JpZ2luYWwKICAgICAgdmFyIGRhdGUgPSBjcmVhdGVEYXRlKHRoaXMuY2FsZW5kYXJGaXJzdERheSk7CiAgICAgIGRhdGUuc2V0TW9udGgoZGF0ZS5nZXRNb250aCgpICsgMSwgMCk7CiAgICAgIHJldHVybiBkYXRlLmdldERhdGUoKTsKICAgIH0sCiAgICBjb21wdXRlZFZhcmlhbnQ6IGZ1bmN0aW9uIGNvbXB1dGVkVmFyaWFudCgpIHsKICAgICAgcmV0dXJuICJidG4tIi5jb25jYXQodGhpcy5zZWxlY3RlZFZhcmlhbnQgfHwgJ3ByaW1hcnknKTsKICAgIH0sCiAgICBjb21wdXRlZFRvZGF5VmFyaWFudDogZnVuY3Rpb24gY29tcHV0ZWRUb2RheVZhcmlhbnQoKSB7CiAgICAgIHJldHVybiAiYnRuLW91dGxpbmUtIi5jb25jYXQodGhpcy50b2RheVZhcmlhbnQgfHwgdGhpcy5zZWxlY3RlZFZhcmlhbnQgfHwgJ3ByaW1hcnknKTsKICAgIH0sCiAgICBjb21wdXRlZE5hdkJ1dHRvblZhcmlhbnQ6IGZ1bmN0aW9uIGNvbXB1dGVkTmF2QnV0dG9uVmFyaWFudCgpIHsKICAgICAgcmV0dXJuICJidG4tb3V0bGluZS0iLmNvbmNhdCh0aGlzLm5hdkJ1dHRvblZhcmlhbnQgfHwgJ3ByaW1hcnknKTsKICAgIH0sCiAgICBpc1JUTDogZnVuY3Rpb24gaXNSVEwoKSB7CiAgICAgIC8vIGB0cnVlYCBpZiB0aGUgbGFuZ3VhZ2UgcmVxdWVzdGVkIGlzIFJUTAogICAgICB2YXIgZGlyID0gdG9TdHJpbmcodGhpcy5kaXJlY3Rpb24pLnRvTG93ZXJDYXNlKCk7CgogICAgICBpZiAoZGlyID09PSAncnRsJykgewogICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0gZWxzZSBpZiAoZGlyID09PSAnbHRyJykgewogICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gaXNMb2NhbGVSVEwodGhpcy5jb21wdXRlZExvY2FsZSk7CiAgICB9LAogICAgY29udGV4dDogZnVuY3Rpb24gY29udGV4dCgpIHsKICAgICAgdmFyIHNlbGVjdGVkWU1EID0gdGhpcy5zZWxlY3RlZFlNRCwKICAgICAgICAgIGFjdGl2ZVlNRCA9IHRoaXMuYWN0aXZlWU1EOwogICAgICB2YXIgc2VsZWN0ZWREYXRlID0gcGFyc2VZTUQoc2VsZWN0ZWRZTUQpOwogICAgICB2YXIgYWN0aXZlRGF0ZSA9IHBhcnNlWU1EKGFjdGl2ZVlNRCk7CiAgICAgIHJldHVybiB7CiAgICAgICAgLy8gVGhlIGN1cnJlbnQgdmFsdWUgb2YgdGhlIGB2LW1vZGVsYAogICAgICAgIHNlbGVjdGVkWU1EOiBzZWxlY3RlZFlNRCwKICAgICAgICBzZWxlY3RlZERhdGU6IHNlbGVjdGVkRGF0ZSwKICAgICAgICBzZWxlY3RlZEZvcm1hdHRlZDogc2VsZWN0ZWREYXRlID8gdGhpcy5mb3JtYXREYXRlU3RyaW5nKHNlbGVjdGVkRGF0ZSkgOiB0aGlzLmxhYmVsTm9EYXRlU2VsZWN0ZWQsCiAgICAgICAgLy8gV2hpY2ggZGF0ZSBjZWxsIGlzIGNvbnNpZGVyZWQgYWN0aXZlIGR1ZSB0byBuYXZpZ2F0aW9uCiAgICAgICAgYWN0aXZlWU1EOiBhY3RpdmVZTUQsCiAgICAgICAgYWN0aXZlRGF0ZTogYWN0aXZlRGF0ZSwKICAgICAgICBhY3RpdmVGb3JtYXR0ZWQ6IGFjdGl2ZURhdGUgPyB0aGlzLmZvcm1hdERhdGVTdHJpbmcoYWN0aXZlRGF0ZSkgOiAnJywKICAgICAgICAvLyBgdHJ1ZWAgaWYgdGhlIGRhdGUgaXMgZGlzYWJsZWQgKHdoZW4gdXNpbmcga2V5Ym9hcmQgbmF2aWdhdGlvbikKICAgICAgICBkaXNhYmxlZDogdGhpcy5kYXRlRGlzYWJsZWQoYWN0aXZlRGF0ZSksCiAgICAgICAgLy8gTG9jYWxlcyB1c2VkIGluIGZvcm1hdHRpbmcgZGF0ZXMKICAgICAgICBsb2NhbGU6IHRoaXMuY29tcHV0ZWRMb2NhbGUsCiAgICAgICAgY2FsZW5kYXJMb2NhbGU6IHRoaXMuY2FsZW5kYXJMb2NhbGUsCiAgICAgICAgcnRsOiB0aGlzLmlzUlRMCiAgICAgIH07CiAgICB9LAogICAgLy8gQ29tcHV0ZWQgcHJvcHMgdGhhdCByZXR1cm4gYSBmdW5jdGlvbiByZWZlcmVuY2UKICAgIGRhdGVPdXRPZlJhbmdlOiBmdW5jdGlvbiBkYXRlT3V0T2ZSYW5nZSgpIHsKICAgICAgLy8gQ2hlY2sgd2hldGhlciBhIGRhdGUgaXMgd2l0aGluIHRoZSBtaW4vbWF4IHJhbmdlCiAgICAgIC8vIFJldHVybnMgYSBuZXcgZnVuY3Rpb24gcmVmIGlmIHRoZSBwb3BzIGNoYW5nZQogICAgICAvLyBXZSBkbyB0aGlzIGFzIHdlIG5lZWQgdG8gdHJpZ2dlciB0aGUgY2FsZW5kYXIgY29tcHV0ZWQgcHJvcAogICAgICAvLyB0byB1cGRhdGUgd2hlbiB0aGVzZSBwcm9wcyB1cGRhdGUKICAgICAgdmFyIG1pbiA9IHRoaXMuY29tcHV0ZWRNaW4sCiAgICAgICAgICBtYXggPSB0aGlzLmNvbXB1dGVkTWF4OwogICAgICByZXR1cm4gZnVuY3Rpb24gKGRhdGUpIHsKICAgICAgICAvLyBIYW5kbGUgYm90aCBgWVlZWS1NTS1ERGAgYW5kIGBEYXRlYCBvYmplY3RzCiAgICAgICAgZGF0ZSA9IHBhcnNlWU1EKGRhdGUpOwogICAgICAgIHJldHVybiBtaW4gJiYgZGF0ZSA8IG1pbiB8fCBtYXggJiYgZGF0ZSA+IG1heDsKICAgICAgfTsKICAgIH0sCiAgICBkYXRlRGlzYWJsZWQ6IGZ1bmN0aW9uIGRhdGVEaXNhYmxlZCgpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsgLy8gUmV0dXJucyBhIGZ1bmN0aW9uIGZvciB2YWxpZGF0aW5nIGlmIGEgZGF0ZSBpcyB3aXRoaW4gcmFuZ2UKICAgICAgLy8gV2UgZ3JhYiB0aGlzIHZhcmlhYmxlcyBmaXJzdCB0byBlbnN1cmUgYSBuZXcgZnVuY3Rpb24gcmVmCiAgICAgIC8vIGlzIGdlbmVyYXRlZCB3aGVuIHRoZSBwcm9wcyB2YWx1ZSBjaGFuZ2VzCiAgICAgIC8vIFdlIGRvIHRoaXMgYXMgd2UgbmVlZCB0byB0cmlnZ2VyIHRoZSBjYWxlbmRhciBjb21wdXRlZCBwcm9wCiAgICAgIC8vIHRvIHVwZGF0ZSB3aGVuIHRoZXNlIHByb3BzIHVwZGF0ZQoKCiAgICAgIHZhciByYW5nZUZuID0gdGhpcy5kYXRlT3V0T2ZSYW5nZTsgLy8gUmV0dXJuIHRoZSBmdW5jdGlvbiByZWYKCiAgICAgIHJldHVybiBmdW5jdGlvbiAoZGF0ZSkgewogICAgICAgIC8vIEhhbmRsZSBib3RoIGBZWVlZLU1NLUREYCBhbmQgYERhdGVgIG9iamVjdHMKICAgICAgICBkYXRlID0gcGFyc2VZTUQoZGF0ZSk7CiAgICAgICAgdmFyIHltZCA9IGZvcm1hdFlNRChkYXRlKTsKICAgICAgICByZXR1cm4gISEocmFuZ2VGbihkYXRlKSB8fCBfdGhpcy5jb21wdXRlZERhdGVEaXNhYmxlZEZuKHltZCwgZGF0ZSkpOwogICAgICB9OwogICAgfSwKICAgIC8vIENvbXB1dGVkIHByb3BzIHRoYXQgcmV0dXJuIGRhdGUgZm9ybWF0dGVyIGZ1bmN0aW9ucwogICAgZm9ybWF0RGF0ZVN0cmluZzogZnVuY3Rpb24gZm9ybWF0RGF0ZVN0cmluZygpIHsKICAgICAgLy8gUmV0dXJucyBhIGRhdGUgZm9ybWF0dGVyIGZ1bmN0aW9uCiAgICAgIHJldHVybiBjcmVhdGVEYXRlRm9ybWF0dGVyKHRoaXMuY2FsZW5kYXJMb2NhbGUsIF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7CiAgICAgICAgLy8gRW5zdXJlIHdlIGhhdmUgeWVhciwgbW9udGgsIGRheSBzaG93biBmb3Igc2NyZWVuIHJlYWRlcnMvQVJJQQogICAgICAgIC8vIElmIHVzZXJzIHJlYWxseSB3YW50IHRvIGxlYXZlIG9uZSBvZiB0aGVzZSBvdXQsIHRoZXkgY2FuCiAgICAgICAgLy8gcGFzcyBgdW5kZWZpbmVkYCBmb3IgdGhlIHByb3BlcnR5IHZhbHVlCiAgICAgICAgeWVhcjogREFURV9GT1JNQVRfTlVNRVJJQywKICAgICAgICBtb250aDogREFURV9GT1JNQVRfMl9ESUdJVCwKICAgICAgICBkYXk6IERBVEVfRk9STUFUXzJfRElHSVQKICAgICAgfSwgdGhpcy5kYXRlRm9ybWF0T3B0aW9ucyksIHt9LCB7CiAgICAgICAgLy8gRW5zdXJlIGhvdXJzL21pbnV0ZXMvc2Vjb25kcyBhcmUgbm90IHNob3duCiAgICAgICAgLy8gQXMgd2UgZG8gbm90IHN1cHBvcnQgdGhlIHRpbWUgcG9ydGlvbiAoeWV0KQogICAgICAgIGhvdXI6IHVuZGVmaW5lZCwKICAgICAgICBtaW51dGU6IHVuZGVmaW5lZCwKICAgICAgICBzZWNvbmQ6IHVuZGVmaW5lZCwKICAgICAgICAvLyBFbnN1cmUgY2FsZW5kYXIgaXMgZ3JlZ29yaWFuCiAgICAgICAgY2FsZW5kYXI6IENBTEVOREFSX0dSRUdPUlkKICAgICAgfSkpOwogICAgfSwKICAgIGZvcm1hdFllYXJNb250aDogZnVuY3Rpb24gZm9ybWF0WWVhck1vbnRoKCkgewogICAgICAvLyBSZXR1cm5zIGEgZGF0ZSBmb3JtYXR0ZXIgZnVuY3Rpb24KICAgICAgcmV0dXJuIGNyZWF0ZURhdGVGb3JtYXR0ZXIodGhpcy5jYWxlbmRhckxvY2FsZSwgewogICAgICAgIHllYXI6IERBVEVfRk9STUFUX05VTUVSSUMsCiAgICAgICAgbW9udGg6IENBTEVOREFSX0xPTkcsCiAgICAgICAgY2FsZW5kYXI6IENBTEVOREFSX0dSRUdPUlkKICAgICAgfSk7CiAgICB9LAogICAgZm9ybWF0V2Vla2RheU5hbWU6IGZ1bmN0aW9uIGZvcm1hdFdlZWtkYXlOYW1lKCkgewogICAgICAvLyBMb25nIHdlZWtkYXkgbmFtZSBmb3Igd2Vla2RheSBoZWFkZXIgYXJpYS1sYWJlbAogICAgICByZXR1cm4gY3JlYXRlRGF0ZUZvcm1hdHRlcih0aGlzLmNhbGVuZGFyTG9jYWxlLCB7CiAgICAgICAgd2Vla2RheTogQ0FMRU5EQVJfTE9ORywKICAgICAgICBjYWxlbmRhcjogQ0FMRU5EQVJfR1JFR09SWQogICAgICB9KTsKICAgIH0sCiAgICBmb3JtYXRXZWVrZGF5TmFtZVNob3J0OiBmdW5jdGlvbiBmb3JtYXRXZWVrZGF5TmFtZVNob3J0KCkgewogICAgICAvLyBXZWVrZGF5IGhlYWRlciBjZWxsIGZvcm1hdAogICAgICAvLyBkZWZhdWx0cyB0byAnc2hvcnQnIDMgbGV0dGVyIGRheXMsIHdoZXJlIHBvc3NpYmxlCiAgICAgIHJldHVybiBjcmVhdGVEYXRlRm9ybWF0dGVyKHRoaXMuY2FsZW5kYXJMb2NhbGUsIHsKICAgICAgICB3ZWVrZGF5OiB0aGlzLndlZWtkYXlIZWFkZXJGb3JtYXQgfHwgQ0FMRU5EQVJfU0hPUlQsCiAgICAgICAgY2FsZW5kYXI6IENBTEVOREFSX0dSRUdPUlkKICAgICAgfSk7CiAgICB9LAogICAgZm9ybWF0RGF5OiBmdW5jdGlvbiBmb3JtYXREYXkoKSB7CiAgICAgIC8vIENhbGVuZGFyIGdyaWQgZGF5IG51bWJlciBmb3JtYXR0ZXIKICAgICAgLy8gV2UgZG9uJ3QgdXNlIERhdGVUaW1lRm9ybWF0dGVyIGhlcmUgYXMgaXQgY2FuIHBsYWNlIGV4dHJhCiAgICAgIC8vIGNoYXJhY3RlcihzKSBhZnRlciB0aGUgbnVtYmVyIChpLmUgdGhlIGB6aGAgbG9jYWxlKQogICAgICB2YXIgbmYgPSBuZXcgSW50bC5OdW1iZXJGb3JtYXQoW3RoaXMuY29tcHV0ZWRMb2NhbGVdLCB7CiAgICAgICAgc3R5bGU6ICdkZWNpbWFsJywKICAgICAgICBtaW5pbXVtSW50ZWdlckRpZ2l0czogMSwKICAgICAgICBtaW5pbXVtRnJhY3Rpb25EaWdpdHM6IDAsCiAgICAgICAgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiAwLAogICAgICAgIG5vdGF0aW9uOiAnc3RhbmRhcmQnCiAgICAgIH0pOyAvLyBSZXR1cm4gYSBmb3JtYXR0ZXIgZnVuY3Rpb24gaW5zdGFuY2UKCiAgICAgIHJldHVybiBmdW5jdGlvbiAoZGF0ZSkgewogICAgICAgIHJldHVybiBuZi5mb3JtYXQoZGF0ZS5nZXREYXRlKCkpOwogICAgICB9OwogICAgfSwKICAgIC8vIERpc2FibGVkIHN0YXRlcyBmb3IgdGhlIG5hdiBidXR0b25zCiAgICBwcmV2RGVjYWRlRGlzYWJsZWQ6IGZ1bmN0aW9uIHByZXZEZWNhZGVEaXNhYmxlZCgpIHsKICAgICAgdmFyIG1pbiA9IHRoaXMuY29tcHV0ZWRNaW47CiAgICAgIHJldHVybiB0aGlzLmRpc2FibGVkIHx8IG1pbiAmJiBsYXN0RGF0ZU9mTW9udGgob25lRGVjYWRlQWdvKHRoaXMuYWN0aXZlRGF0ZSkpIDwgbWluOwogICAgfSwKICAgIHByZXZZZWFyRGlzYWJsZWQ6IGZ1bmN0aW9uIHByZXZZZWFyRGlzYWJsZWQoKSB7CiAgICAgIHZhciBtaW4gPSB0aGlzLmNvbXB1dGVkTWluOwogICAgICByZXR1cm4gdGhpcy5kaXNhYmxlZCB8fCBtaW4gJiYgbGFzdERhdGVPZk1vbnRoKG9uZVllYXJBZ28odGhpcy5hY3RpdmVEYXRlKSkgPCBtaW47CiAgICB9LAogICAgcHJldk1vbnRoRGlzYWJsZWQ6IGZ1bmN0aW9uIHByZXZNb250aERpc2FibGVkKCkgewogICAgICB2YXIgbWluID0gdGhpcy5jb21wdXRlZE1pbjsKICAgICAgcmV0dXJuIHRoaXMuZGlzYWJsZWQgfHwgbWluICYmIGxhc3REYXRlT2ZNb250aChvbmVNb250aEFnbyh0aGlzLmFjdGl2ZURhdGUpKSA8IG1pbjsKICAgIH0sCiAgICB0aGlzTW9udGhEaXNhYmxlZDogZnVuY3Rpb24gdGhpc01vbnRoRGlzYWJsZWQoKSB7CiAgICAgIC8vIFRPRE86IFdlIGNvdWxkL3Nob3VsZCBjaGVjayBpZiB0b2RheSBpcyBvdXQgb2YgcmFuZ2UKICAgICAgcmV0dXJuIHRoaXMuZGlzYWJsZWQ7CiAgICB9LAogICAgbmV4dE1vbnRoRGlzYWJsZWQ6IGZ1bmN0aW9uIG5leHRNb250aERpc2FibGVkKCkgewogICAgICB2YXIgbWF4ID0gdGhpcy5jb21wdXRlZE1heDsKICAgICAgcmV0dXJuIHRoaXMuZGlzYWJsZWQgfHwgbWF4ICYmIGZpcnN0RGF0ZU9mTW9udGgob25lTW9udGhBaGVhZCh0aGlzLmFjdGl2ZURhdGUpKSA+IG1heDsKICAgIH0sCiAgICBuZXh0WWVhckRpc2FibGVkOiBmdW5jdGlvbiBuZXh0WWVhckRpc2FibGVkKCkgewogICAgICB2YXIgbWF4ID0gdGhpcy5jb21wdXRlZE1heDsKICAgICAgcmV0dXJuIHRoaXMuZGlzYWJsZWQgfHwgbWF4ICYmIGZpcnN0RGF0ZU9mTW9udGgob25lWWVhckFoZWFkKHRoaXMuYWN0aXZlRGF0ZSkpID4gbWF4OwogICAgfSwKICAgIG5leHREZWNhZGVEaXNhYmxlZDogZnVuY3Rpb24gbmV4dERlY2FkZURpc2FibGVkKCkgewogICAgICB2YXIgbWF4ID0gdGhpcy5jb21wdXRlZE1heDsKICAgICAgcmV0dXJuIHRoaXMuZGlzYWJsZWQgfHwgbWF4ICYmIGZpcnN0RGF0ZU9mTW9udGgob25lRGVjYWRlQWhlYWQodGhpcy5hY3RpdmVEYXRlKSkgPiBtYXg7CiAgICB9LAogICAgLy8gQ2FsZW5kYXIgZGF0ZXMgZ2VuZXJhdGlvbgogICAgY2FsZW5kYXI6IGZ1bmN0aW9uIGNhbGVuZGFyKCkgewogICAgICB2YXIgbWF0cml4ID0gW107CiAgICAgIHZhciBmaXJzdERheSA9IHRoaXMuY2FsZW5kYXJGaXJzdERheTsKICAgICAgdmFyIGNhbGVuZGFyWWVhciA9IGZpcnN0RGF5LmdldEZ1bGxZZWFyKCk7CiAgICAgIHZhciBjYWxlbmRhck1vbnRoID0gZmlyc3REYXkuZ2V0TW9udGgoKTsKICAgICAgdmFyIGRheXNJbk1vbnRoID0gdGhpcy5jYWxlbmRhckRheXNJbk1vbnRoOwogICAgICB2YXIgc3RhcnRJbmRleCA9IGZpcnN0RGF5LmdldERheSgpOyAvLyBgMGAuLmA2YAoKICAgICAgdmFyIHdlZWtPZmZzZXQgPSAodGhpcy5jb21wdXRlZFdlZWtTdGFydHMgPiBzdGFydEluZGV4ID8gNyA6IDApIC0gdGhpcy5jb21wdXRlZFdlZWtTdGFydHM7IC8vIEJ1aWxkIHRoZSBjYWxlbmRhciBtYXRyaXgKCiAgICAgIHZhciBjdXJyZW50RGF5ID0gMCAtIHdlZWtPZmZzZXQgLSBzdGFydEluZGV4OwoKICAgICAgZm9yICh2YXIgd2VlayA9IDA7IHdlZWsgPCA2ICYmIGN1cnJlbnREYXkgPCBkYXlzSW5Nb250aDsgd2VlaysrKSB7CiAgICAgICAgLy8gRm9yIGVhY2ggd2VlawogICAgICAgIG1hdHJpeFt3ZWVrXSA9IFtdOyAvLyBUaGUgZm9sbG93aW5nIGNvdWxkIGJlIGEgbWFwIGZ1bmN0aW9uCgogICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgNzsgaisrKSB7CiAgICAgICAgICAvLyBGb3IgZWFjaCBkYXkgaW4gd2VlawogICAgICAgICAgY3VycmVudERheSsrOwogICAgICAgICAgdmFyIGRhdGUgPSBjcmVhdGVEYXRlKGNhbGVuZGFyWWVhciwgY2FsZW5kYXJNb250aCwgY3VycmVudERheSk7CiAgICAgICAgICB2YXIgbW9udGggPSBkYXRlLmdldE1vbnRoKCk7CiAgICAgICAgICB2YXIgZGF5WU1EID0gZm9ybWF0WU1EKGRhdGUpOwogICAgICAgICAgdmFyIGRheURpc2FibGVkID0gdGhpcy5kYXRlRGlzYWJsZWQoZGF0ZSk7IC8vIFRPRE86IFRoaXMgY291bGQgYmUgYSBub3JtYWxpemVyIG1ldGhvZAoKICAgICAgICAgIHZhciBkYXRlSW5mbyA9IHRoaXMuY29tcHV0ZWREYXRlSW5mb0ZuKGRheVlNRCwgcGFyc2VZTUQoZGF5WU1EKSk7CiAgICAgICAgICBkYXRlSW5mbyA9IGlzU3RyaW5nKGRhdGVJbmZvKSB8fCBpc0FycmF5KGRhdGVJbmZvKSA/CiAgICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwogICAgICAgICAgewogICAgICAgICAgICBjbGFzczogZGF0ZUluZm8KICAgICAgICAgIH0gOiBpc1BsYWluT2JqZWN0KGRhdGVJbmZvKSA/IF9vYmplY3RTcHJlYWQoewogICAgICAgICAgICBjbGFzczogJycKICAgICAgICAgIH0sIGRhdGVJbmZvKSA6CiAgICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwogICAgICAgICAgewogICAgICAgICAgICBjbGFzczogJycKICAgICAgICAgIH07CiAgICAgICAgICBtYXRyaXhbd2Vla10ucHVzaCh7CiAgICAgICAgICAgIHltZDogZGF5WU1ELAogICAgICAgICAgICAvLyBDZWxsIGNvbnRlbnQKICAgICAgICAgICAgZGF5OiB0aGlzLmZvcm1hdERheShkYXRlKSwKICAgICAgICAgICAgbGFiZWw6IHRoaXMuZm9ybWF0RGF0ZVN0cmluZyhkYXRlKSwKICAgICAgICAgICAgLy8gRmxhZ3MgZm9yIHN0eWxpbmcKICAgICAgICAgICAgaXNUaGlzTW9udGg6IG1vbnRoID09PSBjYWxlbmRhck1vbnRoLAogICAgICAgICAgICBpc0Rpc2FibGVkOiBkYXlEaXNhYmxlZCwKICAgICAgICAgICAgLy8gVE9ETzogSGFuZGxlIG90aGVyIGRhdGVJbmZvIHByb3BlcnRpZXMgc3VjaCBhcyBub3Rlcy9ldmVudHMKICAgICAgICAgICAgaW5mbzogZGF0ZUluZm8KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG1hdHJpeDsKICAgIH0sCiAgICBjYWxlbmRhckhlYWRpbmdzOiBmdW5jdGlvbiBjYWxlbmRhckhlYWRpbmdzKCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIHJldHVybiB0aGlzLmNhbGVuZGFyWzBdLm1hcChmdW5jdGlvbiAoZCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICB0ZXh0OiBfdGhpczIuZm9ybWF0V2Vla2RheU5hbWVTaG9ydChwYXJzZVlNRChkLnltZCkpLAogICAgICAgICAgbGFiZWw6IF90aGlzMi5mb3JtYXRXZWVrZGF5TmFtZShwYXJzZVlNRChkLnltZCkpCiAgICAgICAgfTsKICAgICAgfSk7CiAgICB9CiAgfSwKICB3YXRjaDogKF93YXRjaCA9IHt9LCBfZGVmaW5lUHJvcGVydHkoX3dhdGNoLCBNT0RFTF9QUk9QX05BTUUsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHsKICAgIHZhciBzZWxlY3RlZCA9IGZvcm1hdFlNRChuZXdWYWx1ZSkgfHwgJyc7CiAgICB2YXIgb2xkID0gZm9ybWF0WU1EKG9sZFZhbHVlKSB8fCAnJzsKCiAgICBpZiAoIWRhdGVzRXF1YWwoc2VsZWN0ZWQsIG9sZCkpIHsKICAgICAgdGhpcy5hY3RpdmVZTUQgPSBzZWxlY3RlZCB8fCB0aGlzLmFjdGl2ZVlNRDsKICAgICAgdGhpcy5zZWxlY3RlZFlNRCA9IHNlbGVjdGVkOwogICAgfQogIH0pLCBfZGVmaW5lUHJvcGVydHkoX3dhdGNoLCAic2VsZWN0ZWRZTUQiLCBmdW5jdGlvbiBzZWxlY3RlZFlNRChuZXdZTUQsIG9sZFlNRCkgewogICAgLy8gVE9ETzoKICAgIC8vICAgU2hvdWxkIHdlIGNvbXBhcmUgdG8gYGZvcm1hdFlNRCh0aGlzLnZhbHVlKWAgYW5kIGVtaXQKICAgIC8vICAgb25seSBpZiB0aGV5IGFyZSBkaWZmZXJlbnQ/CiAgICBpZiAobmV3WU1EICE9PSBvbGRZTUQpIHsKICAgICAgdGhpcy4kZW1pdChNT0RFTF9FVkVOVF9OQU1FLCB0aGlzLnZhbHVlQXNEYXRlID8gcGFyc2VZTUQobmV3WU1EKSB8fCBudWxsIDogbmV3WU1EIHx8ICcnKTsKICAgIH0KICB9KSwgX2RlZmluZVByb3BlcnR5KF93YXRjaCwgImNvbnRleHQiLCBmdW5jdGlvbiBjb250ZXh0KG5ld1ZhbHVlLCBvbGRWYWx1ZSkgewogICAgaWYgKCFsb29zZUVxdWFsKG5ld1ZhbHVlLCBvbGRWYWx1ZSkpIHsKICAgICAgdGhpcy4kZW1pdChFVkVOVF9OQU1FX0NPTlRFWFQsIG5ld1ZhbHVlKTsKICAgIH0KICB9KSwgX2RlZmluZVByb3BlcnR5KF93YXRjaCwgImhpZGRlbiIsIGZ1bmN0aW9uIGhpZGRlbihuZXdWYWx1ZSkgewogICAgLy8gUmVzZXQgdGhlIGFjdGl2ZSBmb2N1c2VkIGRheSB3aGVuIGhpZGRlbgogICAgdGhpcy5hY3RpdmVZTUQgPSB0aGlzLnNlbGVjdGVkWU1EIHx8IGZvcm1hdFlNRCh0aGlzW01PREVMX1BST1BfTkFNRV0gfHwgdGhpcy5jb25zdHJhaW5EYXRlKHRoaXMuaW5pdGlhbERhdGUgfHwgdGhpcy5nZXRUb2RheSgpKSk7IC8vIEVuYWJsZS9kaXNhYmxlIHRoZSBsaXZlIHJlZ2lvbnMKCiAgICB0aGlzLnNldExpdmUoIW5ld1ZhbHVlKTsKICB9KSwgX3dhdGNoKSwKICBjcmVhdGVkOiBmdW5jdGlvbiBjcmVhdGVkKCkgewogICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgdGhpcy4kbmV4dFRpY2soZnVuY3Rpb24gKCkgewogICAgICBfdGhpczMuJGVtaXQoRVZFTlRfTkFNRV9DT05URVhULCBfdGhpczMuY29udGV4dCk7CiAgICB9KTsKICB9LAogIG1vdW50ZWQ6IGZ1bmN0aW9uIG1vdW50ZWQoKSB7CiAgICB0aGlzLnNldExpdmUodHJ1ZSk7CiAgfSwKCiAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8KICBhY3RpdmF0ZWQ6IGZ1bmN0aW9uIGFjdGl2YXRlZCgpIHsKICAgIHRoaXMuc2V0TGl2ZSh0cnVlKTsKICB9LAoKICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwogIGRlYWN0aXZhdGVkOiBmdW5jdGlvbiBkZWFjdGl2YXRlZCgpIHsKICAgIHRoaXMuc2V0TGl2ZShmYWxzZSk7CiAgfSwKICBiZWZvcmVEZXN0cm95OiBmdW5jdGlvbiBiZWZvcmVEZXN0cm95KCkgewogICAgdGhpcy5zZXRMaXZlKGZhbHNlKTsKICB9LAogIG1ldGhvZHM6IHsKICAgIC8vIFB1YmxpYyBtZXRob2QocykKICAgIGZvY3VzOiBmdW5jdGlvbiBmb2N1cygpIHsKICAgICAgaWYgKCF0aGlzLmRpc2FibGVkKSB7CiAgICAgICAgYXR0ZW1wdEZvY3VzKHRoaXMuJHJlZnMuZ3JpZCk7CiAgICAgIH0KICAgIH0sCiAgICBibHVyOiBmdW5jdGlvbiBibHVyKCkgewogICAgICBpZiAoIXRoaXMuZGlzYWJsZWQpIHsKICAgICAgICBhdHRlbXB0Qmx1cih0aGlzLiRyZWZzLmdyaWQpOwogICAgICB9CiAgICB9LAogICAgLy8gUHJpdmF0ZSBtZXRob2RzCiAgICBzZXRMaXZlOiBmdW5jdGlvbiBzZXRMaXZlKG9uKSB7CiAgICAgIHZhciBfdGhpczQgPSB0aGlzOwoKICAgICAgaWYgKG9uKSB7CiAgICAgICAgdGhpcy4kbmV4dFRpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgcmVxdWVzdEFGKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgX3RoaXM0LmlzTGl2ZSA9IHRydWU7CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmlzTGl2ZSA9IGZhbHNlOwogICAgICB9CiAgICB9LAogICAgZ2V0VG9kYXk6IGZ1bmN0aW9uIGdldFRvZGF5KCkgewogICAgICByZXR1cm4gcGFyc2VZTUQoY3JlYXRlRGF0ZSgpKTsKICAgIH0sCiAgICBjb25zdHJhaW5EYXRlOiBmdW5jdGlvbiBjb25zdHJhaW5EYXRlKGRhdGUpIHsKICAgICAgLy8gQ29uc3RyYWlucyBhIGRhdGUgYmV0d2VlbiBtaW4gYW5kIG1heAogICAgICAvLyByZXR1cm5zIGEgbmV3IGBEYXRlYCBvYmplY3QgaW5zdGFuY2UKICAgICAgcmV0dXJuIF9jb25zdHJhaW5EYXRlKGRhdGUsIHRoaXMuY29tcHV0ZWRNaW4sIHRoaXMuY29tcHV0ZWRNYXgpOwogICAgfSwKICAgIGVtaXRTZWxlY3RlZDogZnVuY3Rpb24gZW1pdFNlbGVjdGVkKGRhdGUpIHsKICAgICAgdmFyIF90aGlzNSA9IHRoaXM7IC8vIFBlcmZvcm1lZCBpbiBhIGAkbmV4dFRpY2soKWAgdG8gKHByb2JhYmx5KSBlbnN1cmUKICAgICAgLy8gdGhlIGlucHV0IGV2ZW50IGhhcyBlbWl0dGVkIGZpcnN0CgoKICAgICAgdGhpcy4kbmV4dFRpY2soZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzNS4kZW1pdChFVkVOVF9OQU1FX1NFTEVDVEVELCBmb3JtYXRZTUQoZGF0ZSkgfHwgJycsIHBhcnNlWU1EKGRhdGUpIHx8IG51bGwpOwogICAgICB9KTsKICAgIH0sCiAgICAvLyBFdmVudCBoYW5kbGVycwogICAgc2V0R3JpZEZvY3VzRmxhZzogZnVuY3Rpb24gc2V0R3JpZEZvY3VzRmxhZyhldmVudCkgewogICAgICAvLyBTZXRzIHRoZSBncmlkSGFzRm9jdXMgZmxhZyB0byBtYWtlIGRhdGUgImJ1dHRvbiIgbG9vayBmb2N1c2VkCiAgICAgIHRoaXMuZ3JpZEhhc0ZvY3VzID0gIXRoaXMuZGlzYWJsZWQgJiYgZXZlbnQudHlwZSA9PT0gJ2ZvY3VzJzsKICAgIH0sCiAgICBvbktleWRvd25XcmFwcGVyOiBmdW5jdGlvbiBvbktleWRvd25XcmFwcGVyKGV2ZW50KSB7CiAgICAgIC8vIENhbGVuZGFyIGtleWJvYXJkIG5hdmlnYXRpb24KICAgICAgLy8gSGFuZGxlcyBQQUdFVVAvUEFHRURPV04vRU5EL0hPTUUvTEVGVC9VUC9SSUdIVC9ET1dOCiAgICAgIC8vIEZvY3VzZXMgZ3JpZCBhZnRlciB1cGRhdGluZwogICAgICBpZiAodGhpcy5ub0tleU5hdikgewogICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgYWx0S2V5ID0gZXZlbnQuYWx0S2V5LAogICAgICAgICAgY3RybEtleSA9IGV2ZW50LmN0cmxLZXksCiAgICAgICAgICBrZXlDb2RlID0gZXZlbnQua2V5Q29kZTsKCiAgICAgIGlmICghYXJyYXlJbmNsdWRlcyhbQ09ERV9QQUdFVVAsIENPREVfUEFHRURPV04sIENPREVfRU5ELCBDT0RFX0hPTUUsIENPREVfTEVGVCwgQ09ERV9VUCwgQ09ERV9SSUdIVCwgQ09ERV9ET1dOXSwga2V5Q29kZSkpIHsKICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgc3RvcEV2ZW50KGV2ZW50KTsKICAgICAgdmFyIGFjdGl2ZURhdGUgPSBjcmVhdGVEYXRlKHRoaXMuYWN0aXZlRGF0ZSk7CiAgICAgIHZhciBjaGVja0RhdGUgPSBjcmVhdGVEYXRlKHRoaXMuYWN0aXZlRGF0ZSk7CiAgICAgIHZhciBkYXkgPSBhY3RpdmVEYXRlLmdldERhdGUoKTsKICAgICAgdmFyIGNvbnN0cmFpbmVkVG9kYXkgPSB0aGlzLmNvbnN0cmFpbkRhdGUodGhpcy5nZXRUb2RheSgpKTsKICAgICAgdmFyIGlzUlRMID0gdGhpcy5pc1JUTDsKCiAgICAgIGlmIChrZXlDb2RlID09PSBDT0RFX1BBR0VVUCkgewogICAgICAgIC8vIFBBR0VVUCAtIFByZXZpb3VzIG1vbnRoL3llYXIKICAgICAgICBhY3RpdmVEYXRlID0gKGFsdEtleSA/IGN0cmxLZXkgPyBvbmVEZWNhZGVBZ28gOiBvbmVZZWFyQWdvIDogb25lTW9udGhBZ28pKGFjdGl2ZURhdGUpOyAvLyBXZSBjaGVjayB0aGUgZmlyc3QgZGF5IG9mIG1vbnRoIHRvIGJlIGluIHJhZ2UKCiAgICAgICAgY2hlY2tEYXRlID0gY3JlYXRlRGF0ZShhY3RpdmVEYXRlKTsKICAgICAgICBjaGVja0RhdGUuc2V0RGF0ZSgxKTsKICAgICAgfSBlbHNlIGlmIChrZXlDb2RlID09PSBDT0RFX1BBR0VET1dOKSB7CiAgICAgICAgLy8gUEFHRURPV04gLSBOZXh0IG1vbnRoL3llYXIKICAgICAgICBhY3RpdmVEYXRlID0gKGFsdEtleSA/IGN0cmxLZXkgPyBvbmVEZWNhZGVBaGVhZCA6IG9uZVllYXJBaGVhZCA6IG9uZU1vbnRoQWhlYWQpKGFjdGl2ZURhdGUpOyAvLyBXZSBjaGVjayB0aGUgbGFzdCBkYXkgb2YgbW9udGggdG8gYmUgaW4gcmFnZQoKICAgICAgICBjaGVja0RhdGUgPSBjcmVhdGVEYXRlKGFjdGl2ZURhdGUpOwogICAgICAgIGNoZWNrRGF0ZS5zZXRNb250aChjaGVja0RhdGUuZ2V0TW9udGgoKSArIDEpOwogICAgICAgIGNoZWNrRGF0ZS5zZXREYXRlKDApOwogICAgICB9IGVsc2UgaWYgKGtleUNvZGUgPT09IENPREVfTEVGVCkgewogICAgICAgIC8vIExFRlQgLSBQcmV2aW91cyBkYXkgKG9yIG5leHQgZGF5IGZvciBSVEwpCiAgICAgICAgYWN0aXZlRGF0ZS5zZXREYXRlKGRheSArIChpc1JUTCA/IDEgOiAtMSkpOwogICAgICAgIGFjdGl2ZURhdGUgPSB0aGlzLmNvbnN0cmFpbkRhdGUoYWN0aXZlRGF0ZSk7CiAgICAgICAgY2hlY2tEYXRlID0gYWN0aXZlRGF0ZTsKICAgICAgfSBlbHNlIGlmIChrZXlDb2RlID09PSBDT0RFX1JJR0hUKSB7CiAgICAgICAgLy8gUklHSFQgLSBOZXh0IGRheSAob3IgcHJldmlvdXMgZGF5IGZvciBSVEwpCiAgICAgICAgYWN0aXZlRGF0ZS5zZXREYXRlKGRheSArIChpc1JUTCA/IC0xIDogMSkpOwogICAgICAgIGFjdGl2ZURhdGUgPSB0aGlzLmNvbnN0cmFpbkRhdGUoYWN0aXZlRGF0ZSk7CiAgICAgICAgY2hlY2tEYXRlID0gYWN0aXZlRGF0ZTsKICAgICAgfSBlbHNlIGlmIChrZXlDb2RlID09PSBDT0RFX1VQKSB7CiAgICAgICAgLy8gVVAgLSBQcmV2aW91cyB3ZWVrCiAgICAgICAgYWN0aXZlRGF0ZS5zZXREYXRlKGRheSAtIDcpOwogICAgICAgIGFjdGl2ZURhdGUgPSB0aGlzLmNvbnN0cmFpbkRhdGUoYWN0aXZlRGF0ZSk7CiAgICAgICAgY2hlY2tEYXRlID0gYWN0aXZlRGF0ZTsKICAgICAgfSBlbHNlIGlmIChrZXlDb2RlID09PSBDT0RFX0RPV04pIHsKICAgICAgICAvLyBET1dOIC0gTmV4dCB3ZWVrCiAgICAgICAgYWN0aXZlRGF0ZS5zZXREYXRlKGRheSArIDcpOwogICAgICAgIGFjdGl2ZURhdGUgPSB0aGlzLmNvbnN0cmFpbkRhdGUoYWN0aXZlRGF0ZSk7CiAgICAgICAgY2hlY2tEYXRlID0gYWN0aXZlRGF0ZTsKICAgICAgfSBlbHNlIGlmIChrZXlDb2RlID09PSBDT0RFX0hPTUUpIHsKICAgICAgICAvLyBIT01FIC0gVG9kYXkKICAgICAgICBhY3RpdmVEYXRlID0gY29uc3RyYWluZWRUb2RheTsKICAgICAgICBjaGVja0RhdGUgPSBhY3RpdmVEYXRlOwogICAgICB9IGVsc2UgaWYgKGtleUNvZGUgPT09IENPREVfRU5EKSB7CiAgICAgICAgLy8gRU5EIC0gU2VsZWN0ZWQgZGF0ZSwgb3IgdG9kYXkgaWYgbm8gc2VsZWN0ZWQgZGF0ZQogICAgICAgIGFjdGl2ZURhdGUgPSBwYXJzZVlNRCh0aGlzLnNlbGVjdGVkRGF0ZSkgfHwgY29uc3RyYWluZWRUb2RheTsKICAgICAgICBjaGVja0RhdGUgPSBhY3RpdmVEYXRlOwogICAgICB9CgogICAgICBpZiAoIXRoaXMuZGF0ZU91dE9mUmFuZ2UoY2hlY2tEYXRlKSAmJiAhZGF0ZXNFcXVhbChhY3RpdmVEYXRlLCB0aGlzLmFjdGl2ZURhdGUpKSB7CiAgICAgICAgLy8gV2Ugb25seSBqdW1wIHRvIGRhdGUgaWYgd2l0aGluIG1pbi9tYXgKICAgICAgICAvLyBXZSBkb24ndCBjaGVjayBmb3IgaW5kaXZpZHVhbCBkaXNhYmxlZCBkYXRlcyB0aG91Z2ggKHZpYSB1c2VyIGZ1bmN0aW9uKQogICAgICAgIHRoaXMuYWN0aXZlWU1EID0gZm9ybWF0WU1EKGFjdGl2ZURhdGUpOwogICAgICB9IC8vIEVuc3VyZSBncmlkIGlzIGZvY3VzZWQKCgogICAgICB0aGlzLmZvY3VzKCk7CiAgICB9LAogICAgb25LZXlkb3duR3JpZDogZnVuY3Rpb24gb25LZXlkb3duR3JpZChldmVudCkgewogICAgICAvLyBQcmVzc2luZyBlbnRlci9zcGFjZSBvbiBncmlkIHRvIHNlbGVjdCBhY3RpdmUgZGF0ZQogICAgICB2YXIga2V5Q29kZSA9IGV2ZW50LmtleUNvZGU7CiAgICAgIHZhciBhY3RpdmVEYXRlID0gdGhpcy5hY3RpdmVEYXRlOwoKICAgICAgaWYgKGtleUNvZGUgPT09IENPREVfRU5URVIgfHwga2V5Q29kZSA9PT0gQ09ERV9TUEFDRSkgewogICAgICAgIHN0b3BFdmVudChldmVudCk7CgogICAgICAgIGlmICghdGhpcy5kaXNhYmxlZCAmJiAhdGhpcy5yZWFkb25seSAmJiAhdGhpcy5kYXRlRGlzYWJsZWQoYWN0aXZlRGF0ZSkpIHsKICAgICAgICAgIHRoaXMuc2VsZWN0ZWRZTUQgPSBmb3JtYXRZTUQoYWN0aXZlRGF0ZSk7CiAgICAgICAgICB0aGlzLmVtaXRTZWxlY3RlZChhY3RpdmVEYXRlKTsKICAgICAgICB9IC8vIEVuc3VyZSBncmlkIGlzIGZvY3VzZWQKCgogICAgICAgIHRoaXMuZm9jdXMoKTsKICAgICAgfQogICAgfSwKICAgIG9uQ2xpY2tEYXk6IGZ1bmN0aW9uIG9uQ2xpY2tEYXkoZGF5KSB7CiAgICAgIC8vIENsaWNraW5nIG9uIGEgZGF0ZSAiYnV0dG9uIiB0byBzZWxlY3QgaXQKICAgICAgdmFyIHNlbGVjdGVkRGF0ZSA9IHRoaXMuc2VsZWN0ZWREYXRlLAogICAgICAgICAgYWN0aXZlRGF0ZSA9IHRoaXMuYWN0aXZlRGF0ZTsKICAgICAgdmFyIGNsaWNrZWREYXRlID0gcGFyc2VZTUQoZGF5LnltZCk7CgogICAgICBpZiAoIXRoaXMuZGlzYWJsZWQgJiYgIWRheS5pc0Rpc2FibGVkICYmICF0aGlzLmRhdGVEaXNhYmxlZChjbGlja2VkRGF0ZSkpIHsKICAgICAgICBpZiAoIXRoaXMucmVhZG9ubHkpIHsKICAgICAgICAgIC8vIElmIHJlYWRvbmx5IG1vZGUsIHdlIGRvbid0IHNldCB0aGUgc2VsZWN0ZWQgZGF0ZSwganVzdCB0aGUgYWN0aXZlIGRhdGUKICAgICAgICAgIC8vIElmIHRoZSBjbGlja2VkIGRhdGUgaXMgZXF1YWwgdG8gdGhlIGFscmVhZHkgc2VsZWN0ZWQgZGF0ZSwgd2UgZG9uJ3QgdXBkYXRlIHRoZSBtb2RlbAogICAgICAgICAgdGhpcy5zZWxlY3RlZFlNRCA9IGZvcm1hdFlNRChkYXRlc0VxdWFsKGNsaWNrZWREYXRlLCBzZWxlY3RlZERhdGUpID8gc2VsZWN0ZWREYXRlIDogY2xpY2tlZERhdGUpOwogICAgICAgICAgdGhpcy5lbWl0U2VsZWN0ZWQoY2xpY2tlZERhdGUpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5hY3RpdmVZTUQgPSBmb3JtYXRZTUQoZGF0ZXNFcXVhbChjbGlja2VkRGF0ZSwgYWN0aXZlRGF0ZSkgPyBhY3RpdmVEYXRlIDogY3JlYXRlRGF0ZShjbGlja2VkRGF0ZSkpOyAvLyBFbnN1cmUgZ3JpZCBpcyBmb2N1c2VkCgogICAgICAgIHRoaXMuZm9jdXMoKTsKICAgICAgfQogICAgfSwKICAgIGdvdG9QcmV2RGVjYWRlOiBmdW5jdGlvbiBnb3RvUHJldkRlY2FkZSgpIHsKICAgICAgdGhpcy5hY3RpdmVZTUQgPSBmb3JtYXRZTUQodGhpcy5jb25zdHJhaW5EYXRlKG9uZURlY2FkZUFnbyh0aGlzLmFjdGl2ZURhdGUpKSk7CiAgICB9LAogICAgZ290b1ByZXZZZWFyOiBmdW5jdGlvbiBnb3RvUHJldlllYXIoKSB7CiAgICAgIHRoaXMuYWN0aXZlWU1EID0gZm9ybWF0WU1EKHRoaXMuY29uc3RyYWluRGF0ZShvbmVZZWFyQWdvKHRoaXMuYWN0aXZlRGF0ZSkpKTsKICAgIH0sCiAgICBnb3RvUHJldk1vbnRoOiBmdW5jdGlvbiBnb3RvUHJldk1vbnRoKCkgewogICAgICB0aGlzLmFjdGl2ZVlNRCA9IGZvcm1hdFlNRCh0aGlzLmNvbnN0cmFpbkRhdGUob25lTW9udGhBZ28odGhpcy5hY3RpdmVEYXRlKSkpOwogICAgfSwKICAgIGdvdG9DdXJyZW50TW9udGg6IGZ1bmN0aW9uIGdvdG9DdXJyZW50TW9udGgoKSB7CiAgICAgIC8vIFRPRE86IE1heWJlIHRoaXMgZ290byBkYXRlIHNob3VsZCBiZSBjb25maWd1cmFibGU/CiAgICAgIHRoaXMuYWN0aXZlWU1EID0gZm9ybWF0WU1EKHRoaXMuY29uc3RyYWluRGF0ZSh0aGlzLmdldFRvZGF5KCkpKTsKICAgIH0sCiAgICBnb3RvTmV4dE1vbnRoOiBmdW5jdGlvbiBnb3RvTmV4dE1vbnRoKCkgewogICAgICB0aGlzLmFjdGl2ZVlNRCA9IGZvcm1hdFlNRCh0aGlzLmNvbnN0cmFpbkRhdGUob25lTW9udGhBaGVhZCh0aGlzLmFjdGl2ZURhdGUpKSk7CiAgICB9LAogICAgZ290b05leHRZZWFyOiBmdW5jdGlvbiBnb3RvTmV4dFllYXIoKSB7CiAgICAgIHRoaXMuYWN0aXZlWU1EID0gZm9ybWF0WU1EKHRoaXMuY29uc3RyYWluRGF0ZShvbmVZZWFyQWhlYWQodGhpcy5hY3RpdmVEYXRlKSkpOwogICAgfSwKICAgIGdvdG9OZXh0RGVjYWRlOiBmdW5jdGlvbiBnb3RvTmV4dERlY2FkZSgpIHsKICAgICAgdGhpcy5hY3RpdmVZTUQgPSBmb3JtYXRZTUQodGhpcy5jb25zdHJhaW5EYXRlKG9uZURlY2FkZUFoZWFkKHRoaXMuYWN0aXZlRGF0ZSkpKTsKICAgIH0sCiAgICBvbkhlYWRlckNsaWNrOiBmdW5jdGlvbiBvbkhlYWRlckNsaWNrKCkgewogICAgICBpZiAoIXRoaXMuZGlzYWJsZWQpIHsKICAgICAgICB0aGlzLmFjdGl2ZVlNRCA9IHRoaXMuc2VsZWN0ZWRZTUQgfHwgZm9ybWF0WU1EKHRoaXMuZ2V0VG9kYXkoKSk7CiAgICAgICAgdGhpcy5mb2N1cygpOwogICAgICB9CiAgICB9CiAgfSwKICByZW5kZXI6IGZ1bmN0aW9uIHJlbmRlcihoKSB7CiAgICB2YXIgX3RoaXM2ID0gdGhpczsgLy8gSWYgYGhpZGRlbmAgcHJvcCBpcyBzZXQsIHJlbmRlciBqdXN0IGEgcGxhY2Vob2xkZXIgbm9kZQoKCiAgICBpZiAodGhpcy5oaWRkZW4pIHsKICAgICAgcmV0dXJuIGgoKTsKICAgIH0KCiAgICB2YXIgdmFsdWVJZCA9IHRoaXMudmFsdWVJZCwKICAgICAgICB3aWRnZXRJZCA9IHRoaXMud2lkZ2V0SWQsCiAgICAgICAgbmF2SWQgPSB0aGlzLm5hdklkLAogICAgICAgIGdyaWRJZCA9IHRoaXMuZ3JpZElkLAogICAgICAgIGdyaWRDYXB0aW9uSWQgPSB0aGlzLmdyaWRDYXB0aW9uSWQsCiAgICAgICAgZ3JpZEhlbHBJZCA9IHRoaXMuZ3JpZEhlbHBJZCwKICAgICAgICBhY3RpdmVJZCA9IHRoaXMuYWN0aXZlSWQsCiAgICAgICAgZGlzYWJsZWQgPSB0aGlzLmRpc2FibGVkLAogICAgICAgIG5vS2V5TmF2ID0gdGhpcy5ub0tleU5hdiwKICAgICAgICBpc0xpdmUgPSB0aGlzLmlzTGl2ZSwKICAgICAgICBpc1JUTCA9IHRoaXMuaXNSVEwsCiAgICAgICAgYWN0aXZlWU1EID0gdGhpcy5hY3RpdmVZTUQsCiAgICAgICAgc2VsZWN0ZWRZTUQgPSB0aGlzLnNlbGVjdGVkWU1ELAogICAgICAgIHNhZmVJZCA9IHRoaXMuc2FmZUlkOwogICAgdmFyIGhpZGVEZWNhZGVOYXYgPSAhdGhpcy5zaG93RGVjYWRlTmF2OwogICAgdmFyIHRvZGF5WU1EID0gZm9ybWF0WU1EKHRoaXMuZ2V0VG9kYXkoKSk7CiAgICB2YXIgaGlnaGxpZ2h0VG9kYXkgPSAhdGhpcy5ub0hpZ2hsaWdodFRvZGF5OyAvLyBIZWFkZXIgc2hvd2luZyBjdXJyZW50IHNlbGVjdGVkIGRhdGUKCiAgICB2YXIgJGhlYWRlciA9IGgoJ291dHB1dCcsIHsKICAgICAgc3RhdGljQ2xhc3M6ICdmb3JtLWNvbnRyb2wgZm9ybS1jb250cm9sLXNtIHRleHQtY2VudGVyJywKICAgICAgY2xhc3M6IHsKICAgICAgICAndGV4dC1tdXRlZCc6IGRpc2FibGVkLAogICAgICAgIHJlYWRvbmx5OiB0aGlzLnJlYWRvbmx5IHx8IGRpc2FibGVkCiAgICAgIH0sCiAgICAgIGF0dHJzOiB7CiAgICAgICAgaWQ6IHZhbHVlSWQsCiAgICAgICAgZm9yOiBncmlkSWQsCiAgICAgICAgcm9sZTogJ3N0YXR1cycsCiAgICAgICAgdGFiaW5kZXg6IGRpc2FibGVkID8gbnVsbCA6ICctMScsCiAgICAgICAgLy8gTWFpbmx5IGZvciB0ZXN0aW5nIHB1cnBvc2VzLCBhcyB3ZSBkbyBub3Qga25vdwogICAgICAgIC8vIHRoZSBleGFjdCBmb3JtYXQgYEludGxgIHdpbGwgZm9ybWF0IHRoZSBkYXRlIHN0cmluZwogICAgICAgICdkYXRhLXNlbGVjdGVkJzogdG9TdHJpbmcoc2VsZWN0ZWRZTUQpLAogICAgICAgIC8vIFdlIHdhaXQgdW50aWwgYWZ0ZXIgbW91bnQgdG8gZW5hYmxlIGBhcmlhLWxpdmVgCiAgICAgICAgLy8gdG8gcHJldmVudCBpbml0aWFsIGFubm91bmNlbWVudCBvbiBwYWdlIHJlbmRlcgogICAgICAgICdhcmlhLWxpdmUnOiBpc0xpdmUgPyAncG9saXRlJyA6ICdvZmYnLAogICAgICAgICdhcmlhLWF0b21pYyc6IGlzTGl2ZSA/ICd0cnVlJyA6IG51bGwKICAgICAgfSwKICAgICAgb246IHsKICAgICAgICAvLyBUcmFuc2ZlciBmb2N1cy9jbGljayB0byBmb2N1cyBncmlkCiAgICAgICAgLy8gYW5kIGZvY3VzIGFjdGl2ZSBkYXRlIChvciB0b2RheSBpZiBubyBzZWxlY3Rpb24pCiAgICAgICAgY2xpY2s6IHRoaXMub25IZWFkZXJDbGljaywKICAgICAgICBmb2N1czogdGhpcy5vbkhlYWRlckNsaWNrCiAgICAgIH0KICAgIH0sIHRoaXMuc2VsZWN0ZWREYXRlID8gWy8vIFdlIHVzZSBgYmRpYCBlbGVtZW50cyBoZXJlIGluIGNhc2UgdGhlIGxhYmVsIGRvZXNuJ3QgbWF0Y2ggdGhlIGxvY2FsZQogICAgLy8gQWx0aG91Z2ggSUUgMTEgZG9lcyBub3QgZGVhbCB3aXRoIDxCREk+IGF0IGFsbCAoZXF1aXZhbGVudCB0byBhIHNwYW4pCiAgICBoKCdiZGknLCB7CiAgICAgIHN0YXRpY0NsYXNzOiAnc3Itb25seScKICAgIH0sICIgKCIuY29uY2F0KHRvU3RyaW5nKHRoaXMubGFiZWxTZWxlY3RlZCksICIpICIpKSwgaCgnYmRpJywgdGhpcy5mb3JtYXREYXRlU3RyaW5nKHRoaXMuc2VsZWN0ZWREYXRlKSldIDogdGhpcy5sYWJlbE5vRGF0ZVNlbGVjdGVkIHx8ICJceEEwIiAvLyAnJm5ic3A7JwogICAgKTsKICAgICRoZWFkZXIgPSBoKCdoZWFkZXInLCB7CiAgICAgIHN0YXRpY0NsYXNzOiAnYi1jYWxlbmRhci1oZWFkZXInLAogICAgICBjbGFzczogewogICAgICAgICdzci1vbmx5JzogdGhpcy5oaWRlSGVhZGVyCiAgICAgIH0sCiAgICAgIGF0dHJzOiB7CiAgICAgICAgdGl0bGU6IHRoaXMuc2VsZWN0ZWREYXRlID8gdGhpcy5sYWJlbFNlbGVjdGVkRGF0ZSB8fCBudWxsIDogbnVsbAogICAgICB9CiAgICB9LCBbJGhlYWRlcl0pOyAvLyBDb250ZW50IGZvciB0aGUgZGF0ZSBuYXZpZ2F0aW9uIGJ1dHRvbnMKCiAgICB2YXIgbmF2U2NvcGUgPSB7CiAgICAgIGlzUlRMOiBpc1JUTAogICAgfTsKICAgIHZhciBuYXZQcm9wcyA9IHsKICAgICAgc2hpZnRWOiAwLjUKICAgIH07CgogICAgdmFyIG5hdlByZXZQcm9wcyA9IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgbmF2UHJvcHMpLCB7fSwgewogICAgICBmbGlwSDogaXNSVEwKICAgIH0pOwoKICAgIHZhciBuYXZOZXh0UHJvcHMgPSBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIG5hdlByb3BzKSwge30sIHsKICAgICAgZmxpcEg6ICFpc1JUTAogICAgfSk7CgogICAgdmFyICRwcmV2RGVjYWRlSWNvbiA9IHRoaXMubm9ybWFsaXplU2xvdChTTE9UX05BTUVfTkFWX1BFVl9ERUNBREUsIG5hdlNjb3BlKSB8fCBoKEJJY29uQ2hldnJvbkJhckxlZnQsIHsKICAgICAgcHJvcHM6IG5hdlByZXZQcm9wcwogICAgfSk7CiAgICB2YXIgJHByZXZZZWFySWNvbiA9IHRoaXMubm9ybWFsaXplU2xvdChTTE9UX05BTUVfTkFWX1BFVl9ZRUFSLCBuYXZTY29wZSkgfHwgaChCSWNvbkNoZXZyb25Eb3VibGVMZWZ0LCB7CiAgICAgIHByb3BzOiBuYXZQcmV2UHJvcHMKICAgIH0pOwogICAgdmFyICRwcmV2TW9udGhJY29uID0gdGhpcy5ub3JtYWxpemVTbG90KFNMT1RfTkFNRV9OQVZfUEVWX01PTlRILCBuYXZTY29wZSkgfHwgaChCSWNvbkNoZXZyb25MZWZ0LCB7CiAgICAgIHByb3BzOiBuYXZQcmV2UHJvcHMKICAgIH0pOwogICAgdmFyICR0aGlzTW9udGhJY29uID0gdGhpcy5ub3JtYWxpemVTbG90KFNMT1RfTkFNRV9OQVZfVEhJU19NT05USCwgbmF2U2NvcGUpIHx8IGgoQkljb25DaXJjbGVGaWxsLCB7CiAgICAgIHByb3BzOiBuYXZQcm9wcwogICAgfSk7CiAgICB2YXIgJG5leHRNb250aEljb24gPSB0aGlzLm5vcm1hbGl6ZVNsb3QoU0xPVF9OQU1FX05BVl9ORVhUX01PTlRILCBuYXZTY29wZSkgfHwgaChCSWNvbkNoZXZyb25MZWZ0LCB7CiAgICAgIHByb3BzOiBuYXZOZXh0UHJvcHMKICAgIH0pOwogICAgdmFyICRuZXh0WWVhckljb24gPSB0aGlzLm5vcm1hbGl6ZVNsb3QoU0xPVF9OQU1FX05BVl9ORVhUX1lFQVIsIG5hdlNjb3BlKSB8fCBoKEJJY29uQ2hldnJvbkRvdWJsZUxlZnQsIHsKICAgICAgcHJvcHM6IG5hdk5leHRQcm9wcwogICAgfSk7CiAgICB2YXIgJG5leHREZWNhZGVJY29uID0gdGhpcy5ub3JtYWxpemVTbG90KFNMT1RfTkFNRV9OQVZfTkVYVF9ERUNBREUsIG5hdlNjb3BlKSB8fCBoKEJJY29uQ2hldnJvbkJhckxlZnQsIHsKICAgICAgcHJvcHM6IG5hdk5leHRQcm9wcwogICAgfSk7IC8vIFV0aWxpdHkgdG8gY3JlYXRlIHRoZSBkYXRlIG5hdmlnYXRpb24gYnV0dG9ucwoKICAgIHZhciBtYWtlTmF2QnRuID0gZnVuY3Rpb24gbWFrZU5hdkJ0bihjb250ZW50LCBsYWJlbCwgaGFuZGxlciwgYnRuRGlzYWJsZWQsIHNob3J0Y3V0KSB7CiAgICAgIHJldHVybiBoKCdidXR0b24nLCB7CiAgICAgICAgc3RhdGljQ2xhc3M6ICdidG4gYnRuLXNtIGJvcmRlci0wIGZsZXgtZmlsbCcsCiAgICAgICAgY2xhc3M6IFtfdGhpczYuY29tcHV0ZWROYXZCdXR0b25WYXJpYW50LCB7CiAgICAgICAgICBkaXNhYmxlZDogYnRuRGlzYWJsZWQKICAgICAgICB9XSwKICAgICAgICBhdHRyczogewogICAgICAgICAgdGl0bGU6IGxhYmVsIHx8IG51bGwsCiAgICAgICAgICB0eXBlOiAnYnV0dG9uJywKICAgICAgICAgIHRhYmluZGV4OiBub0tleU5hdiA/ICctMScgOiBudWxsLAogICAgICAgICAgJ2FyaWEtbGFiZWwnOiBsYWJlbCB8fCBudWxsLAogICAgICAgICAgJ2FyaWEtZGlzYWJsZWQnOiBidG5EaXNhYmxlZCA/ICd0cnVlJyA6IG51bGwsCiAgICAgICAgICAnYXJpYS1rZXlzaG9ydGN1dHMnOiBzaG9ydGN1dCB8fCBudWxsCiAgICAgICAgfSwKICAgICAgICBvbjogYnRuRGlzYWJsZWQgPyB7fSA6IHsKICAgICAgICAgIGNsaWNrOiBoYW5kbGVyCiAgICAgICAgfQogICAgICB9LCBbaCgnZGl2JywgewogICAgICAgIGF0dHJzOiB7CiAgICAgICAgICAnYXJpYS1oaWRkZW4nOiAndHJ1ZScKICAgICAgICB9CiAgICAgIH0sIFtjb250ZW50XSldKTsKICAgIH07IC8vIEdlbmVyYXRlIHRoZSBkYXRlIG5hdmlnYXRpb24gYnV0dG9ucwoKCiAgICB2YXIgJG5hdiA9IGgoJ2RpdicsIHsKICAgICAgc3RhdGljQ2xhc3M6ICdiLWNhbGVuZGFyLW5hdiBkLWZsZXgnLAogICAgICBhdHRyczogewogICAgICAgIGlkOiBuYXZJZCwKICAgICAgICByb2xlOiAnZ3JvdXAnLAogICAgICAgIHRhYmluZGV4OiBub0tleU5hdiA/ICctMScgOiBudWxsLAogICAgICAgICdhcmlhLWhpZGRlbic6IGRpc2FibGVkID8gJ3RydWUnIDogbnVsbCwKICAgICAgICAnYXJpYS1sYWJlbCc6IHRoaXMubGFiZWxOYXYgfHwgbnVsbCwKICAgICAgICAnYXJpYS1jb250cm9scyc6IGdyaWRJZAogICAgICB9CiAgICB9LCBbaGlkZURlY2FkZU5hdiA/IGgoKSA6IG1ha2VOYXZCdG4oJHByZXZEZWNhZGVJY29uLCB0aGlzLmxhYmVsUHJldkRlY2FkZSwgdGhpcy5nb3RvUHJldkRlY2FkZSwgdGhpcy5wcmV2RGVjYWRlRGlzYWJsZWQsICdDdHJsK0FsdCtQYWdlRG93bicpLCBtYWtlTmF2QnRuKCRwcmV2WWVhckljb24sIHRoaXMubGFiZWxQcmV2WWVhciwgdGhpcy5nb3RvUHJldlllYXIsIHRoaXMucHJldlllYXJEaXNhYmxlZCwgJ0FsdCtQYWdlRG93bicpLCBtYWtlTmF2QnRuKCRwcmV2TW9udGhJY29uLCB0aGlzLmxhYmVsUHJldk1vbnRoLCB0aGlzLmdvdG9QcmV2TW9udGgsIHRoaXMucHJldk1vbnRoRGlzYWJsZWQsICdQYWdlRG93bicpLCBtYWtlTmF2QnRuKCR0aGlzTW9udGhJY29uLCB0aGlzLmxhYmVsQ3VycmVudE1vbnRoLCB0aGlzLmdvdG9DdXJyZW50TW9udGgsIHRoaXMudGhpc01vbnRoRGlzYWJsZWQsICdIb21lJyksIG1ha2VOYXZCdG4oJG5leHRNb250aEljb24sIHRoaXMubGFiZWxOZXh0TW9udGgsIHRoaXMuZ290b05leHRNb250aCwgdGhpcy5uZXh0TW9udGhEaXNhYmxlZCwgJ1BhZ2VVcCcpLCBtYWtlTmF2QnRuKCRuZXh0WWVhckljb24sIHRoaXMubGFiZWxOZXh0WWVhciwgdGhpcy5nb3RvTmV4dFllYXIsIHRoaXMubmV4dFllYXJEaXNhYmxlZCwgJ0FsdCtQYWdlVXAnKSwgaGlkZURlY2FkZU5hdiA/IGgoKSA6IG1ha2VOYXZCdG4oJG5leHREZWNhZGVJY29uLCB0aGlzLmxhYmVsTmV4dERlY2FkZSwgdGhpcy5nb3RvTmV4dERlY2FkZSwgdGhpcy5uZXh0RGVjYWRlRGlzYWJsZWQsICdDdHJsK0FsdCtQYWdlVXAnKV0pOyAvLyBDYXB0aW9uIGZvciBjYWxlbmRhciBncmlkCgogICAgdmFyICRncmlkQ2FwdGlvbiA9IGgoJ2hlYWRlcicsIHsKICAgICAgc3RhdGljQ2xhc3M6ICdiLWNhbGVuZGFyLWdyaWQtY2FwdGlvbiB0ZXh0LWNlbnRlciBmb250LXdlaWdodC1ib2xkJywKICAgICAgY2xhc3M6IHsKICAgICAgICAndGV4dC1tdXRlZCc6IGRpc2FibGVkCiAgICAgIH0sCiAgICAgIGF0dHJzOiB7CiAgICAgICAgaWQ6IGdyaWRDYXB0aW9uSWQsCiAgICAgICAgJ2FyaWEtbGl2ZSc6IGlzTGl2ZSA/ICdwb2xpdGUnIDogbnVsbCwKICAgICAgICAnYXJpYS1hdG9taWMnOiBpc0xpdmUgPyAndHJ1ZScgOiBudWxsCiAgICAgIH0sCiAgICAgIGtleTogJ2dyaWQtY2FwdGlvbicKICAgIH0sIHRoaXMuZm9ybWF0WWVhck1vbnRoKHRoaXMuY2FsZW5kYXJGaXJzdERheSkpOyAvLyBDYWxlbmRhciB3ZWVrZGF5IGhlYWRpbmdzCgogICAgdmFyICRncmlkV2Vla0RheXMgPSBoKCdkaXYnLCB7CiAgICAgIHN0YXRpY0NsYXNzOiAnYi1jYWxlbmRhci1ncmlkLXdlZWtkYXlzIHJvdyBuby1ndXR0ZXJzIGJvcmRlci1ib3R0b20nLAogICAgICBhdHRyczogewogICAgICAgICdhcmlhLWhpZGRlbic6ICd0cnVlJwogICAgICB9CiAgICB9LCB0aGlzLmNhbGVuZGFySGVhZGluZ3MubWFwKGZ1bmN0aW9uIChkLCBpZHgpIHsKICAgICAgcmV0dXJuIGgoJ3NtYWxsJywgewogICAgICAgIHN0YXRpY0NsYXNzOiAnY29sIHRleHQtdHJ1bmNhdGUnLAogICAgICAgIGNsYXNzOiB7CiAgICAgICAgICAndGV4dC1tdXRlZCc6IGRpc2FibGVkCiAgICAgICAgfSwKICAgICAgICBhdHRyczogewogICAgICAgICAgdGl0bGU6IGQubGFiZWwgPT09IGQudGV4dCA/IG51bGwgOiBkLmxhYmVsLAogICAgICAgICAgJ2FyaWEtbGFiZWwnOiBkLmxhYmVsCiAgICAgICAgfSwKICAgICAgICBrZXk6IGlkeAogICAgICB9LCBkLnRleHQpOwogICAgfSkpOyAvLyBDYWxlbmRhciBkYXkgZ3JpZAoKICAgIHZhciAkZ3JpZEJvZHkgPSB0aGlzLmNhbGVuZGFyLm1hcChmdW5jdGlvbiAod2VlaykgewogICAgICB2YXIgJGNlbGxzID0gd2Vlay5tYXAoZnVuY3Rpb24gKGRheSwgZEluZGV4KSB7CiAgICAgICAgdmFyIF9jbGFzczsKCiAgICAgICAgdmFyIGlzU2VsZWN0ZWQgPSBkYXkueW1kID09PSBzZWxlY3RlZFlNRDsKICAgICAgICB2YXIgaXNBY3RpdmUgPSBkYXkueW1kID09PSBhY3RpdmVZTUQ7CiAgICAgICAgdmFyIGlzVG9kYXkgPSBkYXkueW1kID09PSB0b2RheVlNRDsKICAgICAgICB2YXIgaWRDZWxsID0gc2FmZUlkKCJfY2VsbC0iLmNvbmNhdChkYXkueW1kLCAiXyIpKTsgLy8gImZha2UiIGJ1dHRvbgoKICAgICAgICB2YXIgJGJ0biA9IGgoJ3NwYW4nLCB7CiAgICAgICAgICBzdGF0aWNDbGFzczogJ2J0biBib3JkZXItMCByb3VuZGVkLWNpcmNsZSB0ZXh0LW5vd3JhcCcsCiAgICAgICAgICAvLyBTaG91bGQgd2UgYWRkIHNvbWUgY2xhc3NlcyB0byBzaWduaWZ5IGlmIHRvZGF5L3NlbGVjdGVkL2V0Yz8KICAgICAgICAgIGNsYXNzOiAoX2NsYXNzID0gewogICAgICAgICAgICAvLyBHaXZlIHRoZSBmYWtlIGJ1dHRvbiBhIGZvY3VzIHJpbmcKICAgICAgICAgICAgZm9jdXM6IGlzQWN0aXZlICYmIF90aGlzNi5ncmlkSGFzRm9jdXMsCiAgICAgICAgICAgIC8vIFN0eWxpbmcKICAgICAgICAgICAgZGlzYWJsZWQ6IGRheS5pc0Rpc2FibGVkIHx8IGRpc2FibGVkLAogICAgICAgICAgICBhY3RpdmU6IGlzU2VsZWN0ZWQKICAgICAgICAgIH0sIF9kZWZpbmVQcm9wZXJ0eShfY2xhc3MsIF90aGlzNi5jb21wdXRlZFZhcmlhbnQsIGlzU2VsZWN0ZWQpLCBfZGVmaW5lUHJvcGVydHkoX2NsYXNzLCBfdGhpczYuY29tcHV0ZWRUb2RheVZhcmlhbnQsIGlzVG9kYXkgJiYgaGlnaGxpZ2h0VG9kYXkgJiYgIWlzU2VsZWN0ZWQgJiYgZGF5LmlzVGhpc01vbnRoKSwgX2RlZmluZVByb3BlcnR5KF9jbGFzcywgJ2J0bi1vdXRsaW5lLWxpZ2h0JywgIShpc1RvZGF5ICYmIGhpZ2hsaWdodFRvZGF5KSAmJiAhaXNTZWxlY3RlZCAmJiAhaXNBY3RpdmUpLCBfZGVmaW5lUHJvcGVydHkoX2NsYXNzLCAnYnRuLWxpZ2h0JywgIShpc1RvZGF5ICYmIGhpZ2hsaWdodFRvZGF5KSAmJiAhaXNTZWxlY3RlZCAmJiBpc0FjdGl2ZSksIF9kZWZpbmVQcm9wZXJ0eShfY2xhc3MsICd0ZXh0LW11dGVkJywgIWRheS5pc1RoaXNNb250aCAmJiAhaXNTZWxlY3RlZCksIF9kZWZpbmVQcm9wZXJ0eShfY2xhc3MsICd0ZXh0LWRhcmsnLCAhKGlzVG9kYXkgJiYgaGlnaGxpZ2h0VG9kYXkpICYmICFpc1NlbGVjdGVkICYmICFpc0FjdGl2ZSAmJiBkYXkuaXNUaGlzTW9udGgpLCBfZGVmaW5lUHJvcGVydHkoX2NsYXNzLCAnZm9udC13ZWlnaHQtYm9sZCcsIChpc1NlbGVjdGVkIHx8IGRheS5pc1RoaXNNb250aCkgJiYgIWRheS5pc0Rpc2FibGVkKSwgX2NsYXNzKSwKICAgICAgICAgIG9uOiB7CiAgICAgICAgICAgIGNsaWNrOiBmdW5jdGlvbiBjbGljaygpIHsKICAgICAgICAgICAgICByZXR1cm4gX3RoaXM2Lm9uQ2xpY2tEYXkoZGF5KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIGRheS5kYXkpOwogICAgICAgIHJldHVybiBoKCdkaXYnLCAvLyBDZWxsIHdpdGggYnV0dG9uCiAgICAgICAgewogICAgICAgICAgc3RhdGljQ2xhc3M6ICdjb2wgcC0wJywKICAgICAgICAgIGNsYXNzOiBkYXkuaXNEaXNhYmxlZCA/ICdiZy1saWdodCcgOiBkYXkuaW5mby5jbGFzcyB8fCAnJywKICAgICAgICAgIGF0dHJzOiB7CiAgICAgICAgICAgIGlkOiBpZENlbGwsCiAgICAgICAgICAgIHJvbGU6ICdidXR0b24nLAogICAgICAgICAgICAnZGF0YS1kYXRlJzogZGF5LnltZCwKICAgICAgICAgICAgLy8gUHJpbWFyaWx5IGZvciB0ZXN0aW5nIHB1cnBvc2VzCiAgICAgICAgICAgIC8vIE9ubHkgZGF5cyBpbiB0aGUgbW9udGggYXJlIHByZXNlbnRlZCBhcyBidXR0b25zIHRvIHNjcmVlbiByZWFkZXJzCiAgICAgICAgICAgICdhcmlhLWhpZGRlbic6IGRheS5pc1RoaXNNb250aCA/IG51bGwgOiAndHJ1ZScsCiAgICAgICAgICAgICdhcmlhLWRpc2FibGVkJzogZGF5LmlzRGlzYWJsZWQgfHwgZGlzYWJsZWQgPyAndHJ1ZScgOiBudWxsLAogICAgICAgICAgICAnYXJpYS1sYWJlbCc6IFtkYXkubGFiZWwsIGlzU2VsZWN0ZWQgPyAiKCIuY29uY2F0KF90aGlzNi5sYWJlbFNlbGVjdGVkLCAiKSIpIDogbnVsbCwgaXNUb2RheSA/ICIoIi5jb25jYXQoX3RoaXM2LmxhYmVsVG9kYXksICIpIikgOiBudWxsXS5maWx0ZXIoaWRlbnRpdHkpLmpvaW4oJyAnKSwKICAgICAgICAgICAgLy8gTlZEQSBkb2Vzbid0IGNvbnZleSBgYXJpYS1zZWxlY3RlZGAsIGJ1dCBkb2VzIGBhcmlhLWN1cnJlbnRgLAogICAgICAgICAgICAvLyBDaHJvbWVWb3ggZG9lc24ndCBjb252ZXkgYGFyaWEtY3VycmVudGAsIGJ1dCBkb2VzIGBhcmlhLXNlbGVjdGVkYCwKICAgICAgICAgICAgLy8gc28gd2Ugc2V0IGJvdGggYXR0cmlidXRlcyBmb3Igcm9idXN0bmVzcwogICAgICAgICAgICAnYXJpYS1zZWxlY3RlZCc6IGlzU2VsZWN0ZWQgPyAndHJ1ZScgOiBudWxsLAogICAgICAgICAgICAnYXJpYS1jdXJyZW50JzogaXNTZWxlY3RlZCA/ICdkYXRlJyA6IG51bGwKICAgICAgICAgIH0sCiAgICAgICAgICBrZXk6IGRJbmRleAogICAgICAgIH0sIFskYnRuXSk7CiAgICAgIH0pOyAvLyBSZXR1cm4gdGhlIHdlZWsgInJvdyIKICAgICAgLy8gV2UgdXNlIHRoZSBmaXJzdCBkYXkgb2YgdGhlIHdlZWtzIFlNRCB2YWx1ZSBhcyBhCiAgICAgIC8vIGtleSBmb3IgZWZmaWNpZW50IERPTSBwYXRjaGluZyAvIGVsZW1lbnQgcmUtdXNlCgogICAgICByZXR1cm4gaCgnZGl2JywgewogICAgICAgIHN0YXRpY0NsYXNzOiAncm93IG5vLWd1dHRlcnMnLAogICAgICAgIGtleTogd2Vla1swXS55bWQKICAgICAgfSwgJGNlbGxzKTsKICAgIH0pOwogICAgJGdyaWRCb2R5ID0gaCgnZGl2JywgewogICAgICAvLyBBIGtleSBpcyBvbmx5IHJlcXVpcmVkIG9uIHRoZSBib2R5IGlmIHdlIGFkZCBpbiB0cmFuc2l0aW9uIHN1cHBvcnQKICAgICAgc3RhdGljQ2xhc3M6ICdiLWNhbGVuZGFyLWdyaWQtYm9keScsCiAgICAgIHN0eWxlOiBkaXNhYmxlZCA/IHsKICAgICAgICBwb2ludGVyRXZlbnRzOiAnbm9uZScKICAgICAgfSA6IHt9IC8vIGtleTogdGhpcy5hY3RpdmVZTUQuc2xpY2UoMCwgLTMpCgogICAgfSwgJGdyaWRCb2R5KTsKICAgIHZhciAkZ3JpZEhlbHAgPSBoKCdmb290ZXInLCB7CiAgICAgIHN0YXRpY0NsYXNzOiAnYi1jYWxlbmRhci1ncmlkLWhlbHAgYm9yZGVyLXRvcCBzbWFsbCB0ZXh0LW11dGVkIHRleHQtY2VudGVyIGJnLWxpZ2h0JywKICAgICAgYXR0cnM6IHsKICAgICAgICBpZDogZ3JpZEhlbHBJZAogICAgICB9CiAgICB9LCBbaCgnZGl2JywgewogICAgICBzdGF0aWNDbGFzczogJ3NtYWxsJwogICAgfSwgdGhpcy5sYWJlbEhlbHApXSk7CiAgICB2YXIgJGdyaWQgPSBoKCdkaXYnLCB7CiAgICAgIHN0YXRpY0NsYXNzOiAnYi1jYWxlbmRhci1ncmlkIGZvcm0tY29udHJvbCBoLWF1dG8gdGV4dC1jZW50ZXInLAogICAgICBhdHRyczogewogICAgICAgIGlkOiBncmlkSWQsCiAgICAgICAgcm9sZTogJ2FwcGxpY2F0aW9uJywKICAgICAgICB0YWJpbmRleDogbm9LZXlOYXYgPyAnLTEnIDogZGlzYWJsZWQgPyBudWxsIDogJzAnLAogICAgICAgICdkYXRhLW1vbnRoJzogYWN0aXZlWU1ELnNsaWNlKDAsIC0zKSwKICAgICAgICAvLyBgWVlZWS1NTWAsIG1haW5seSBmb3IgdGVzdGluZwogICAgICAgICdhcmlhLXJvbGVkZXNjcmlwdGlvbic6IHRoaXMubGFiZWxDYWxlbmRhciB8fCBudWxsLAogICAgICAgICdhcmlhLWxhYmVsbGVkYnknOiBncmlkQ2FwdGlvbklkLAogICAgICAgICdhcmlhLWRlc2NyaWJlZGJ5JzogZ3JpZEhlbHBJZCwKICAgICAgICAvLyBgYXJpYS1yZWFkb25seWAgaXMgbm90IGNvbnNpZGVyZWQgdmFsaWQgb24gYHJvbGU9ImFwcGxpY2F0aW9uImAKICAgICAgICAvLyBodHRwczovL3d3dy53My5vcmcvVFIvd2FpLWFyaWEtMS4xLyNhcmlhLXJlYWRvbmx5CiAgICAgICAgLy8gJ2FyaWEtcmVhZG9ubHknOiB0aGlzLnJlYWRvbmx5ICYmICFkaXNhYmxlZCA/ICd0cnVlJyA6IG51bGwsCiAgICAgICAgJ2FyaWEtZGlzYWJsZWQnOiBkaXNhYmxlZCA/ICd0cnVlJyA6IG51bGwsCiAgICAgICAgJ2FyaWEtYWN0aXZlZGVzY2VuZGFudCc6IGFjdGl2ZUlkCiAgICAgIH0sCiAgICAgIG9uOiB7CiAgICAgICAga2V5ZG93bjogdGhpcy5vbktleWRvd25HcmlkLAogICAgICAgIGZvY3VzOiB0aGlzLnNldEdyaWRGb2N1c0ZsYWcsCiAgICAgICAgYmx1cjogdGhpcy5zZXRHcmlkRm9jdXNGbGFnCiAgICAgIH0sCiAgICAgIHJlZjogJ2dyaWQnCiAgICB9LCBbJGdyaWRDYXB0aW9uLCAkZ3JpZFdlZWtEYXlzLCAkZ3JpZEJvZHksICRncmlkSGVscF0pOyAvLyBPcHRpb25hbCBib3R0b20gc2xvdAoKICAgIHZhciAkc2xvdCA9IHRoaXMubm9ybWFsaXplU2xvdCgpOwogICAgJHNsb3QgPSAkc2xvdCA/IGgoJ2Zvb3RlcicsIHsKICAgICAgc3RhdGljQ2xhc3M6ICdiLWNhbGVuZGFyLWZvb3RlcicKICAgIH0sICRzbG90KSA6IGgoKTsKICAgIHZhciAkd2lkZ2V0ID0gaCgnZGl2JywgewogICAgICBzdGF0aWNDbGFzczogJ2ItY2FsZW5kYXItaW5uZXInLAogICAgICBzdHlsZTogdGhpcy5ibG9jayA/IHt9IDogewogICAgICAgIHdpZHRoOiB0aGlzLndpZHRoCiAgICAgIH0sCiAgICAgIGF0dHJzOiB7CiAgICAgICAgaWQ6IHdpZGdldElkLAogICAgICAgIGRpcjogaXNSVEwgPyAncnRsJyA6ICdsdHInLAogICAgICAgIGxhbmc6IHRoaXMuY29tcHV0ZWRMb2NhbGUgfHwgbnVsbCwKICAgICAgICByb2xlOiAnZ3JvdXAnLAogICAgICAgICdhcmlhLWRpc2FibGVkJzogZGlzYWJsZWQgPyAndHJ1ZScgOiBudWxsLAogICAgICAgIC8vIElmIGRhdGVwaWNrZXIgY29udHJvbHMgYW4gaW5wdXQsIHRoaXMgd2lsbCBzcGVjaWZ5IHRoZSBJRCBvZiB0aGUgaW5wdXQKICAgICAgICAnYXJpYS1jb250cm9scyc6IHRoaXMuYXJpYUNvbnRyb2xzIHx8IG51bGwsCiAgICAgICAgLy8gVGhpcyBzaG91bGQgYmUgYSBwcm9wIChzbyBpdCBjYW4gYmUgY2hhbmdlZCB0byBEYXRlIHBpY2tlciwgZXRjLCBsb2NhbGl6ZWQKICAgICAgICAnYXJpYS1yb2xlZGVzY3JpcHRpb24nOiB0aGlzLnJvbGVEZXNjcmlwdGlvbiB8fCBudWxsLAogICAgICAgICdhcmlhLWRlc2NyaWJlZGJ5JzogWy8vIFNob3VsZCB0aGUgYXR0ciAoaWYgcHJlc2VudCkgZ28gbGFzdD8KICAgICAgICAvLyBPciBzaG91bGQgdGhpcyBhdHRyIGJlIGEgcHJvcD8KICAgICAgICB0aGlzLmJ2QXR0cnNbJ2FyaWEtZGVzY3JpYmVkYnknXSwgdmFsdWVJZCwgZ3JpZEhlbHBJZF0uZmlsdGVyKGlkZW50aXR5KS5qb2luKCcgJykKICAgICAgfSwKICAgICAgb246IHsKICAgICAgICBrZXlkb3duOiB0aGlzLm9uS2V5ZG93bldyYXBwZXIKICAgICAgfQogICAgfSwgWyRoZWFkZXIsICRuYXYsICRncmlkLCAkc2xvdF0pOyAvLyBXcmFwIGluIGFuIG91dGVyIGRpdiB0aGF0IGNhbiBiZSBzdHlsZWQKCiAgICByZXR1cm4gaCgnZGl2JywgewogICAgICBzdGF0aWNDbGFzczogJ2ItY2FsZW5kYXInLAogICAgICBjbGFzczogewogICAgICAgICdkLWJsb2NrJzogdGhpcy5ibG9jawogICAgICB9CiAgICB9LCBbJHdpZGdldF0pOwogIH0KfSk7"},null]}