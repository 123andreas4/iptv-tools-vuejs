{"remainingRequest":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/thread-loader/dist/cjs.js!/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/babel-loader/lib/index.js!/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/cache-loader/dist/cjs.js??ref--0-0!/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/vue-loader/lib/index.js??vue-loader-options!/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/src/views/app/xtream/editor.vue?vue&type=script&lang=js&","dependencies":[{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/src/views/app/xtream/editor.vue","mtime":1625832741237},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF90b0NvbnN1bWFibGVBcnJheSBmcm9tICIvbWVkaWEvZXJuc3QvNjNiY2U0M2MtNWU1MS00YmYxLWE2MTEtM2FmZGYzMmFjNmY2L1Z1ZUpTL0lQVFYtVG9vbHMvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL3RvQ29uc3VtYWJsZUFycmF5IjsKaW1wb3J0IF9vYmplY3RTcHJlYWQgZnJvbSAiL21lZGlhL2VybnN0LzYzYmNlNDNjLTVlNTEtNGJmMS1hNjExLTNhZmRmMzJhYzZmNi9WdWVKUy9JUFRWLVRvb2xzL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9vYmplY3RTcHJlYWQyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc2VhcmNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmNvbnN0cnVjdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLnRvLXN0cmluZy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbHRlci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5tYXRjaC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbmQtaW5kZXguanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5tYXAuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5udW1iZXIuY29uc3RydWN0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuam9pbi5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pdGVyYXRvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuaXRlcmF0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zb3J0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5jbHVkZXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuaW5jbHVkZXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zcGxpY2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcucmVwbGFjZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmNvbmNhdC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmZ1bmN0aW9uLm5hbWUuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3Qua2V5cy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbmQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc3BsaXQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIudXJsLmpzIjsKLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCi8qIGVzbGludC1kaXNhYmxlIHZ1ZS9uby1zaWRlLWVmZmVjdHMtaW4tY29tcHV0ZWQtcHJvcGVydGllcyAqLwoKLyogZXNsaW50LWRpc2FibGUgbm8tdW51c2VkLXZhcnMgKi8KCi8qIGVzbGludC1kaXNhYmxlIG5vLXVzZWxlc3MtZXNjYXBlICovCmltcG9ydCB7IEV2ZW50QnVzIH0gZnJvbSAiLi4vLi4vLi4vc2VydmljZXMvZWJ1cyI7CmltcG9ydCB7IGh0dHBTZXJ2aWNlIH0gZnJvbSAiLi4vLi4vLi4vc2VydmljZXMvaHR0cCI7CmltcG9ydCB7IG1hcEdldHRlcnMgfSBmcm9tICJ2dWV4IjsKaW1wb3J0IGRyYWdnYWJsZSBmcm9tICJ2dWVkcmFnZ2FibGUiOwppbXBvcnQgeyBTdWJzY3JpcHRpb25UeXBlIH0gZnJvbSAiLi4vLi4vLi4vY29uc3RhbnRzL2NvbmZpZyI7CmltcG9ydCB7IGNvdW50cmllcyB9IGZyb20gIi4uLy4uLy4uL2hlbHBlcnMiOwppbXBvcnQgeyBtM3UgfSBmcm9tICIuLi8uLi8uLi9wbHVnaW5zL20zdSI7CmV4cG9ydCBkZWZhdWx0IHsKICBjb21wb25lbnRzOiB7CiAgICBkcmFnZ2FibGU6IGRyYWdnYWJsZQogIH0sCiAgZGF0YTogZnVuY3Rpb24gZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGRhdGVPcHRpb25zOiB7CiAgICAgICAgZGF5OiAiMi1kaWdpdCIsCiAgICAgICAgbW9udGg6ICJudW1lcmljIiwKICAgICAgICB5ZWFyOiAibnVtZXJpYyIKICAgICAgfSwKICAgICAgY291bnRyaWVzOiBjb3VudHJpZXMsCiAgICAgIGFjdGl2ZVRhYjogMCwKICAgICAgYWN0aXZlR3JvdXA6IC0xLAogICAgICBhY3RpdmVHcm91cHM6IFtdLAogICAgICBhY3RpdmVTdHJlYW06IC0xLAogICAgICBhY3RpdmVTdHJlYW1zOiBbXSwKICAgICAgZHJhZ0dyb3VwOiBmYWxzZSwKICAgICAgZHJhZ1N0cmVhbTogZmFsc2UsCiAgICAgIGVkaXRvcjogZmFsc2UsCiAgICAgIHNlYXJjaDogbnVsbCwKICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgcGxheWxpc3RFZGl0b3I6IHsKICAgICAgICBpZDogdW5kZWZpbmVkLAogICAgICAgIHBsYXlsaXN0OiBudWxsLAogICAgICAgIGdyb3VwczogW10sCiAgICAgICAgc3RyZWFtczogW10sCiAgICAgICAgY2hhbmdlZDogZmFsc2UKICAgICAgfSwKICAgICAgZmluZFJlcGxhY2U6IHsKICAgICAgICB0eXBlOiAwLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBmcm9tOiAiIiwKICAgICAgICB0bzogIiIsCiAgICAgICAgcmVwbGFjZUFsbDogZmFsc2UsCiAgICAgICAgaWdub3JlQ2FzZTogZmFsc2UsCiAgICAgICAgc2VsZWN0ZWRPbmx5OiAwCiAgICAgIH0sCiAgICAgIHByZWZpeFN1ZmZpeDogewogICAgICAgIHR5cGU6IDAsCiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIHByZWZpeDogIiIsCiAgICAgICAgc3VmZml4OiAiIiwKICAgICAgICBzZWxlY3RlZE9ubHk6IDAKICAgICAgfSwKICAgICAgY29udmVydENhc2U6IHsKICAgICAgICB0eXBlOiAwLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBtZXRob2Q6IDAsCiAgICAgICAgc2VsZWN0ZWRPbmx5OiAwCiAgICAgIH0sCiAgICAgIGdyb3VwRWRpdG9yOiB7CiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIGlkOiAwLAogICAgICAgIGdyb3VwX25hbWU6ICIiLAogICAgICAgIGdyb3VwX3BhcmVudF9jb2RlOiAiIiwKICAgICAgICBncm91cF90eXBlOiAxLAogICAgICAgIGdyb3VwX2lzX2hpZGRlbjogMAogICAgICB9LAogICAgICBzdHJlYW1FZGl0b3I6IHsKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgaWQ6IC0xLAogICAgICAgIHN0cmVhbV90dmdfbmFtZTogIiIsCiAgICAgICAgc3RyZWFtX3R2Z19pZDogIiIsCiAgICAgICAgc3RyZWFtX3R2Z19sb2dvOiAiIiwKICAgICAgICBzdHJlYW1fcGFyZW50X2NvZGU6ICIiLAogICAgICAgIHN0cmVhbV9yYWRpbzogMCwKICAgICAgICBzdHJlYW1faXNfaGlkZGVuOiAwLAogICAgICAgIHN0cmVhbV9pc19jdXN0b206IDAsCiAgICAgICAgbW92aWVfbmFtZTogIiIsCiAgICAgICAgbW92aWVfeWVhcjogIiIsCiAgICAgICAgc2VyaWVfbmFtZTogIiIsCiAgICAgICAgc2VyaWVfc2Vhc29uOiAwLAogICAgICAgIHNlcmllX2VwaXNvZGU6IDAsCiAgICAgICAgc291cmNlX3N0cmVhbV91cmw6ICIiCiAgICAgIH0sCiAgICAgIHJhZGlvQnJvd3NlcjogewogICAgICAgIGlzTG9hZGluZzogZmFsc2UsCiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIGJvdW5jZTogbnVsbCwKICAgICAgICBhY3RpdmU6IFtdLAogICAgICAgIHNlYXJjaDogIiIsCiAgICAgICAgcmVzdWx0czogW10KICAgICAgfSwKICAgICAgc291bmRjbG91ZDogewogICAgICAgIGlzTG9hZGluZzogZmFsc2UsCiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIGJvdW5jZTogbnVsbCwKICAgICAgICB1cmw6ICIiLAogICAgICAgIHRyYWNrOiBudWxsCiAgICAgIH0sCiAgICAgIHlvdXR1YmU6IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBib3VuY2U6IG51bGwsCiAgICAgICAgdXJsOiAiIiwKICAgICAgICB2aWRlb0lkOiAiIiwKICAgICAgICB2aWRlbzogbnVsbAogICAgICB9LAogICAgICB2aW1lbzogewogICAgICAgIGlzTG9hZGluZzogZmFsc2UsCiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIGJvdW5jZTogbnVsbCwKICAgICAgICB1cmw6ICIiLAogICAgICAgIHZpZGVvSWQ6ICIiLAogICAgICAgIHZpZGVvOiBudWxsCiAgICAgIH0sCiAgICAgIGRhaWx5bW90aW9uOiB7CiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgYm91bmNlOiBudWxsLAogICAgICAgIHVybDogIiIsCiAgICAgICAgdmlkZW9JZDogIiIsCiAgICAgICAgdmlkZW86IG51bGwKICAgICAgfSwKICAgICAgdGVkVGFsa3M6IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBib3VuY2U6IG51bGwsCiAgICAgICAgdXJsOiAiIiwKICAgICAgICB2aWRlbzogbnVsbAogICAgICB9LAogICAgICB4aGFtc3RlcjogewogICAgICAgIGlzTG9hZGluZzogZmFsc2UsCiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIGJvdW5jZTogbnVsbCwKICAgICAgICB1cmw6ICIiLAogICAgICAgIHZpZGVvOiBudWxsCiAgICAgIH0sCiAgICAgIGZpbmRMb2dvOiB7CiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgY291bnRyaWVzOiBbXSwKICAgICAgICBjb3VudHJ5OiAiIiwKICAgICAgICBsb2dvczogW10sCiAgICAgICAgbG9nbzogIiIsCiAgICAgICAgc2VhcmNoOiAiIiwKICAgICAgICB0aXRsZTogIiIKICAgICAgfSwKICAgICAgYXNzaWduTG9nbzogewogICAgICAgIGlzTG9hZGluZzogZmFsc2UsCiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIGNvdW50cmllczogW10sCiAgICAgICAgY291bnRyeTogIiIsCiAgICAgICAgbG9nb3M6IFtdLAogICAgICAgIGFzc2lnbkFsbDogMAogICAgICB9LAogICAgICBpbXBvcnRNM1U6IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBncm91cHM6IFtdLAogICAgICAgIGltcG9ydEdyb3VwczogW10sCiAgICAgICAgbTN1OiBudWxsLAogICAgICAgIGZpbGU6IG51bGwKICAgICAgfSwKICAgICAgZmluZFRWR0lEOiB7CiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgY291bnRyaWVzOiBbXSwKICAgICAgICBjb3VudHJ5OiAiIiwKICAgICAgICBjaGFubmVsczogW10sCiAgICAgICAgY2hhbm5lbDogIiIsCiAgICAgICAgc2VhcmNoOiAiIiwKICAgICAgICB0aXRsZTogIiIKICAgICAgfSwKICAgICAgYXNzaWduVFZHSUQ6IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBjb3VudHJpZXM6IFtdLAogICAgICAgIGNvdW50cnk6ICIiLAogICAgICAgIGNoYW5uZWxzOiBbXSwKICAgICAgICBhc3NpZ25BbGw6IDAKICAgICAgfSwKICAgICAgc2F2ZUNoYW5nZXM6IHsKICAgICAgICBtb2RhbDogZmFsc2UKICAgICAgfSwKICAgICAgZ3JvdXBUeXBlczogW3sKICAgICAgICB0ZXh0OiB0aGlzLiR0KCJ4dHJlYW0ubGl2ZSIpLAogICAgICAgIHZhbHVlOiAxCiAgICAgIH0sIHsKICAgICAgICB0ZXh0OiB0aGlzLiR0KCJ4dHJlYW0ubW92aWVzIiksCiAgICAgICAgdmFsdWU6IDIKICAgICAgfSwgewogICAgICAgIHRleHQ6IHRoaXMuJHQoInh0cmVhbS5zZXJpZXMiKSwKICAgICAgICB2YWx1ZTogMwogICAgICB9XQogICAgfTsKICB9LAogIGNvbXB1dGVkOiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIG1hcEdldHRlcnMoWyJjdXJyZW50VXNlciIsICJzZXR0aW5ncyIsICJzb3VuZGNsb3VkQ2xpZW50SWQiLCAibW92aWVTZXJpZVBsYXlsaXN0Il0pKSwge30sIHsKICAgIHNob3dUb29sdGlwczogZnVuY3Rpb24gc2hvd1Rvb2x0aXBzKCkgewogICAgICByZXR1cm4gdGhpcy5zZXR0aW5ncy5zaG93VG9vbHRpcHM7CiAgICB9LAogICAgc2VhcmNoRmlsdGVyZWQ6IGZ1bmN0aW9uIHNlYXJjaEZpbHRlcmVkKCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgaWYgKHRoaXMuc2VhcmNoID09PSBudWxsKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuYWNjb3VudHM7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIHJlID0gbmV3IFJlZ0V4cCh0aGlzLnNlYXJjaCwgImkiKTsKICAgICAgICByZXR1cm4gdGhpcy5hY2NvdW50cy5maWx0ZXIoZnVuY3Rpb24gKGFjY291bnQpIHsKICAgICAgICAgIHJldHVybiBTdHJpbmcoYWNjb3VudC50aXRsZSkubWF0Y2gocmUpIHx8IFN0cmluZyhhY2NvdW50Lmhvc3QpLm1hdGNoKHJlKSB8fCBTdHJpbmcoYWNjb3VudC5wb3J0KS5tYXRjaChyZSkgfHwgU3RyaW5nKGFjY291bnQudXNlcm5hbWUpLm1hdGNoKHJlKSB8fCBTdHJpbmcoYWNjb3VudC5wYXNzd29yZCkubWF0Y2gocmUpIHx8IF90aGlzLmZvcm1hdERhdGUoYWNjb3VudC5zeW5jZWRfYXQpLm1hdGNoKHJlKSB8fCBfdGhpcy4kdCgic3luYy1pbnRlcnZhbC4iLmNvbmNhdChhY2NvdW50LnN5bmNfaW50ZXJ2YWwpKS5tYXRjaChyZSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBwbGF5bGlzdFNlbGVjdGVkOiBmdW5jdGlvbiBwbGF5bGlzdFNlbGVjdGVkKCkgewogICAgICByZXR1cm4gdGhpcy5wbGF5bGlzdEVkaXRvci5pZCAhPT0gdW5kZWZpbmVkOwogICAgfSwKICAgIGxhc3RTZWxlY3RlZEdyb3VwOiBmdW5jdGlvbiBsYXN0U2VsZWN0ZWRHcm91cCgpIHsKICAgICAgcmV0dXJuIHRoaXMuYWN0aXZlR3JvdXBzW3RoaXMuYWN0aXZlR3JvdXBzLmxlbmd0aCAtIDFdOwogICAgfSwKICAgIGxhc3RTZWxlY3RlZFN0cmVhbTogZnVuY3Rpb24gbGFzdFNlbGVjdGVkU3RyZWFtKCkgewogICAgICByZXR1cm4gdGhpcy5hY3RpdmVTdHJlYW1zW3RoaXMuYWN0aXZlU3RyZWFtcy5sZW5ndGggLSAxXTsKICAgIH0sCiAgICBjYW5FZGl0R3JvdXBUeXBlOiBmdW5jdGlvbiBjYW5FZGl0R3JvdXBUeXBlKCkgewogICAgICByZXR1cm4gdGhpcy5ncm91cEVkaXRvci5pZCAmJiB0aGlzLmdldEdyb3VwV2l0aElkKHRoaXMuZ3JvdXBFZGl0b3IuaWQpLnN0cmVhbXMgPT0gMDsKICAgIH0sCiAgICBzdWJzY3JpcHRpb25MaW1pdGVkOiBmdW5jdGlvbiBzdWJzY3JpcHRpb25MaW1pdGVkKCkgewogICAgICByZXR1cm4gdGhpcy5jdXJyZW50VXNlci5zdWJzY3JpcHRpb24gJiYgdGhpcy5jdXJyZW50VXNlci5zdWJzY3JpcHRpb24uc3Vic2NyaXB0aW9uX3R5cGUgPT0gU3Vic2NyaXB0aW9uVHlwZS5FbnRodXNpYXN0OwogICAgfSwKICAgIGZpbHRlcmVkR3JvdXBzOiBmdW5jdGlvbiBmaWx0ZXJlZEdyb3VwcygpIHsKICAgICAgaWYgKHRoaXMuc3Vic2NyaXB0aW9uTGltaXRlZCkgewogICAgICAgIHJldHVybiB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maWx0ZXIoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgICByZXR1cm4gZ3JvdXAuZ3JvdXBfaXNfcmVtb3ZlZCAhPT0gMSAmJiBncm91cC5zb3VyY2VfZ3JvdXBfdHlwZSA9PSAxICYmIGdyb3VwLmdyb3VwX3R5cGUgPT0gMTsKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbHRlcihmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICByZXR1cm4gZ3JvdXAuZ3JvdXBfaXNfcmVtb3ZlZCAhPT0gMTsKICAgICAgfSk7CiAgICB9LAogICAgZmlsdGVyZWRTdHJlYW1zOiBmdW5jdGlvbiBmaWx0ZXJlZFN0cmVhbXMoKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMuZmlsdGVyKGZ1bmN0aW9uIChncm91cCkgewogICAgICAgIHJldHVybiBncm91cC5zdHJlYW1faXNfcmVtb3ZlZCAhPT0gMTsKICAgICAgfSk7CiAgICB9LAogICAgYWN0aXZlR3JvdXBUeXBlOiBmdW5jdGlvbiBhY3RpdmVHcm91cFR5cGUoKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgdmFyIGluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KGZ1bmN0aW9uIChncm91cCkgewogICAgICAgIHJldHVybiBncm91cC5pZCA9PSBfdGhpczIuYWN0aXZlR3JvdXA7CiAgICAgIH0pOwogICAgICByZXR1cm4gaW5kZXggPiAtMSA/IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2luZGV4XS5ncm91cF90eXBlIDogMDsKICAgIH0sCiAgICBmaWx0ZXJlZExvZ29zOiBmdW5jdGlvbiBmaWx0ZXJlZExvZ29zKCkgewogICAgICBpZiAoIXRoaXMuZmluZExvZ28uc2VhcmNoLmxlbmd0aCkgewogICAgICAgIHJldHVybiB0aGlzLmZpbmRMb2dvLmxvZ29zOwogICAgICB9CgogICAgICB2YXIgc2VsZWN0ZWRTdHJlYW0gPSB0aGlzLmdldFN0cmVhbVdpdGhJZCh0aGlzLmFjdGl2ZVN0cmVhbXNbMF0pOwogICAgICB2YXIgcmUgPSBuZXcgUmVnRXhwKHRoaXMuZmluZExvZ28uc2VhcmNoLCAiaSIpOwogICAgICByZXR1cm4gdGhpcy5maW5kTG9nby5sb2dvcy5maWx0ZXIoZnVuY3Rpb24gKGxvZ28pIHsKICAgICAgICByZXR1cm4gbG9nby50ZXh0Lm1hdGNoKHJlKTsKICAgICAgfSk7CiAgICB9LAogICAgZmlsdGVyZWRUVkdJRFM6IGZ1bmN0aW9uIGZpbHRlcmVkVFZHSURTKCkgewogICAgICBpZiAoIXRoaXMuZmluZFRWR0lELnNlYXJjaC5sZW5ndGgpIHsKICAgICAgICByZXR1cm4gdGhpcy5maW5kVFZHSUQuY2hhbm5lbHM7CiAgICAgIH0KCiAgICAgIHZhciBzZWxlY3RlZFN0cmVhbSA9IHRoaXMuZ2V0U3RyZWFtV2l0aElkKHRoaXMuYWN0aXZlU3RyZWFtc1swXSk7CiAgICAgIHZhciByZSA9IG5ldyBSZWdFeHAodGhpcy5maW5kVFZHSUQuc2VhcmNoLCAiaSIpOwogICAgICByZXR1cm4gdGhpcy5maW5kVFZHSUQuY2hhbm5lbHMuZmlsdGVyKGZ1bmN0aW9uIChjaGFubmVsKSB7CiAgICAgICAgcmV0dXJuIGNoYW5uZWwudGV4dC5tYXRjaChyZSk7CiAgICAgIH0pOwogICAgfSwKICAgIGdyb3VwQ29udGV4dE1lbnU6IGZ1bmN0aW9uIGdyb3VwQ29udGV4dE1lbnUoKSB7CiAgICAgIHZhciB2bSA9IHRoaXM7CiAgICAgIHJldHVybiBbewogICAgICAgIGljb246ICJsYS1wbHVzIiwKICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLmFkZC1ncm91cCIpLAogICAgICAgIG9uQ2xpY2s6IHZtLmFkZEdyb3VwCiAgICAgIH0sIHsKICAgICAgICBkaXNhYmxlZDogdm0uYWN0aXZlR3JvdXBzLmxlbmd0aCAhPT0gMSwKICAgICAgICBpY29uOiAibGEtZWRpdCIsCiAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5lZGl0LWdyb3VwIiksCiAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgIGlmICh2bS5hY3RpdmVHcm91cHMubGVuZ3RoID09PSAxKSB7CiAgICAgICAgICAgIHZtLmVkaXRHcm91cE1vZGFsKHRydWUpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGRpdmlkZXI6IHRydWUKICAgICAgfSwgewogICAgICAgIHRleHQ6IHZtLiR0KCJnZW5lcmFsLnNlbGVjdC1hbGwiKSwKICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgdm0uYWN0aXZlR3JvdXBzID0gX3RvQ29uc3VtYWJsZUFycmF5KHZtLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5tYXAoZnVuY3Rpb24gKGcpIHsKICAgICAgICAgICAgcmV0dXJuIGcuaWQ7CiAgICAgICAgICB9KSk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAgdGV4dDogdm0uJHQoImdlbmVyYWwuc2VsZWN0LW5vbmUiKSwKICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgdm0uYWN0aXZlR3JvdXBzID0gW107CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAgZGl2aWRlcjogdHJ1ZQogICAgICB9LCB7CiAgICAgICAgaWNvbjogImxhLXNlYXJjaCIsCiAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5maW5kLXJlcGxhY2UiKSwKICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgdm0uZmluZEFuZFJlcGxhY2VNb2RhbCh0cnVlLCAxKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBpY29uOiAibGEtcGVuIiwKICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLmFkZC1wcmVmaXgtc3VmZml4IiksCiAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgIHZtLnByZWZpeFN1ZmZpeE1vZGFsKHRydWUsIDEpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGljb246ICJsYS1mb250IiwKICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLmNoYW5nZS1jYXNlIiksCiAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgIHZtLmNvbnZlcnRDYXNlTW9kYWwodHJ1ZSwgMSk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAgZGl2aWRlcjogdHJ1ZQogICAgICB9LCB7CiAgICAgICAgZGlzYWJsZWQ6IHZtLmFjdGl2ZUdyb3Vwcy5sZW5ndGggPT09IDAsCiAgICAgICAgaWNvbjogImxhLWV5ZSIsCiAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci50b2dnbGUtdmlzaWJpbGl0eSIpLAogICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICBpZiAodm0uYWN0aXZlR3JvdXBzLmxlbmd0aCkgewogICAgICAgICAgICB2bS50b2dnbGVHcm91cFZpc2liaWxpdHkoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBkaXNhYmxlZDogdm0uYWN0aXZlR3JvdXBzLmxlbmd0aCA9PT0gMCwKICAgICAgICBpY29uOiAibGEtdHJhc2giLAogICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IuZGVsZXRlIiksCiAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgIGlmICh2bS5hY3RpdmVHcm91cHMubGVuZ3RoKSB7CiAgICAgICAgICAgIHZtLmRlbGV0ZVNlbGVjdGVkR3JvdXBzKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9XTsKICAgIH0sCiAgICBzdHJlYW1Db250ZXh0TWVudTogZnVuY3Rpb24gc3RyZWFtQ29udGV4dE1lbnUoKSB7CiAgICAgIHZhciB2bSA9IHRoaXM7CiAgICAgIHJldHVybiBbewogICAgICAgIGljb246ICJsYS1wbHVzIiwKICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLmFkZC1zdHJlYW0iKSwKICAgICAgICBvbkNsaWNrOiB2bS5hZGRTdHJlYW0KICAgICAgfSwgewogICAgICAgIGRpc2FibGVkOiB2bS5hY3RpdmVTdHJlYW1zLmxlbmd0aCAhPT0gMSwKICAgICAgICBpY29uOiAibGEtZWRpdCIsCiAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5lZGl0LXN0cmVhbSIpLAogICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICBpZiAodm0uYWN0aXZlU3RyZWFtcy5sZW5ndGggPT09IDEpIHsKICAgICAgICAgICAgdm0uZWRpdFN0cmVhbU1vZGFsKHRydWUpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGRpdmlkZXI6IHRydWUKICAgICAgfSwgewogICAgICAgIHRleHQ6IHZtLiR0KCJnZW5lcmFsLnNlbGVjdC1hbGwiKSwKICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgdm0uYWN0aXZlU3RyZWFtcyA9IF90b0NvbnN1bWFibGVBcnJheSh2bS5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLm1hcChmdW5jdGlvbiAoZykgewogICAgICAgICAgICByZXR1cm4gZy5pZDsKICAgICAgICAgIH0pKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICB0ZXh0OiB2bS4kdCgiZ2VuZXJhbC5zZWxlY3Qtbm9uZSIpLAogICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICB2bS5hY3RpdmVTdHJlYW1zID0gW107CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAgZGl2aWRlcjogdHJ1ZQogICAgICB9LCB7CiAgICAgICAgZGlzYWJsZWQ6IHZtLmFjdGl2ZUdyb3Vwcy5sZW5ndGggIT09IDEgfHwgdm0uYWN0aXZlU3RyZWFtcy5sZW5ndGggPT09IDAgfHwgdm0uZ2V0R3JvdXBXaXRoSWQodm0uYWN0aXZlR3JvdXBzWzBdKS5ncm91cF90eXBlICE9PSB2bS5hY3RpdmVHcm91cFR5cGUgfHwgdm0uYWN0aXZlR3JvdXBzWzBdID09PSB2bS5hY3RpdmVHcm91cCwKICAgICAgICBpY29uOiAibGEtY2hldnJvbi1sZWZ0IiwKICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLm1vdmUtdG8tc2VsZWN0ZWQtZ3JvdXAiKSwKICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgdm0ubW92ZVRvU2VsZWN0ZWRHcm91cCgpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGRpdmlkZXI6IHRydWUKICAgICAgfSwgewogICAgICAgIGljb246ICJsYS1zZWFyY2giLAogICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IuZmluZC1yZXBsYWNlIiksCiAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgIHZtLmZpbmRBbmRSZXBsYWNlTW9kYWwodHJ1ZSwgMik7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAgaWNvbjogImxhLXBlbiIsCiAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5hZGQtcHJlZml4LXN1ZmZpeCIpLAogICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICB2bS5wcmVmaXhTdWZmaXhNb2RhbCh0cnVlLCAyKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBpY29uOiAibGEtZm9udCIsCiAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5jaGFuZ2UtY2FzZSIpLAogICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICB2bS5jb252ZXJ0Q2FzZU1vZGFsKHRydWUsIDIpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGRpdmlkZXI6IHRydWUKICAgICAgfSwgewogICAgICAgIGRpc2FibGVkOiB2bS5hY3RpdmVTdHJlYW1zLmxlbmd0aCAhPT0gMSB8fCB2bS5hY3RpdmVHcm91cFR5cGUgIT09IDEsCiAgICAgICAgaWNvbjogImxhLXBob3RvLXZpZGVvIiwKICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLmZpbmQtbG9nbyIpLAogICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICB2bS5maW5kTG9nb01vZGFsKHRydWUpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGRpc2FibGVkOiB2bS5hY3RpdmVTdHJlYW1zLmxlbmd0aCAhPT0gMSB8fCB2bS5hY3RpdmVHcm91cFR5cGUgIT09IDEsCiAgICAgICAgaWNvbjogImxhLXRoLWxpc3QiLAogICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IuZmluZC10di1ndWlkZSIpLAogICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICB2bS5maW5kVFZHSURNb2RhbCh0cnVlKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBkaXZpZGVyOiB0cnVlCiAgICAgIH0sIHsKICAgICAgICBkaXNhYmxlZDogdm0uYWN0aXZlU3RyZWFtcy5sZW5ndGggPT09IDAgfHwgdm0uYWN0aXZlR3JvdXBUeXBlICE9PSAxLAogICAgICAgIGljb246ICJsYS1tdXNpYyIsCiAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci50b2dnbGUtcmFkaW8iKSwKICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgaWYgKHZtLmFjdGl2ZVN0cmVhbXMubGVuZ3RoICYmIHZtLmFjdGl2ZUdyb3VwVHlwZSA9PSAxKSB7CiAgICAgICAgICAgIHZtLnRvZ2dsZVN0cmVhbVJhZGlvKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAgZGlzYWJsZWQ6IHZtLmFjdGl2ZVN0cmVhbXMubGVuZ3RoID09PSAwLAogICAgICAgIGljb246ICJsYS1leWUiLAogICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IudG9nZ2xlLXZpc2liaWxpdHkiKSwKICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgaWYgKHZtLmFjdGl2ZVN0cmVhbXMubGVuZ3RoKSB7CiAgICAgICAgICAgIHZtLnRvZ2dsZVN0cmVhbVZpc2liaWxpdHkoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBkaXZpZGVyOiB0cnVlCiAgICAgIH0sIHsKICAgICAgICBkaXNhYmxlZDogdm0uYWN0aXZlU3RyZWFtcy5sZW5ndGggPT09IDAsCiAgICAgICAgaWNvbjogImxhLXRyYXNoIiwKICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLmRlbGV0ZSIpLAogICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICBpZiAodm0uYWN0aXZlU3RyZWFtcy5sZW5ndGgpIHsKICAgICAgICAgICAgdm0uZGVsZXRlU2VsZWN0ZWRTdHJlYW1zKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9XTsKICAgIH0KICB9KSwKICBtZXRob2RzOiB7CiAgICBncm91cERyYWdDaGFuZ2VkOiBmdW5jdGlvbiBncm91cERyYWdDaGFuZ2VkKGcpIHsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmICh0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5ncm91cF9vcmRlciAhPSBpICsgMSkgewogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uZ3JvdXBfb3JkZXIgPSBpICsgMTsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBzdHJlYW1EcmFnQ2hhbmdlZDogZnVuY3Rpb24gc3RyZWFtRHJhZ0NoYW5nZWQoZykgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmICh0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uc3RyZWFtX29yZGVyICE9IGkgKyAxKSB7CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uc3RyZWFtX29yZGVyID0gaSArIDE7CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIG9wZW5Db250ZXh0OiBmdW5jdGlvbiBvcGVuQ29udGV4dChjb250ZXh0KSB7CiAgICAgIHRoaXMuJHJlZnNbY29udGV4dF0ub3BlbigpOwogICAgfSwKICAgIHNlYXJjaEVkaXRvcjogZnVuY3Rpb24gc2VhcmNoRWRpdG9yKHNlYXJjaCkgewogICAgICBpZiAoc2VhcmNoLmxlbmd0aCA9PT0gMCkgewogICAgICAgIHRoaXMuc2VhcmNoID0gbnVsbDsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNlYXJjaCA9IHNlYXJjaDsKICAgICAgfQogICAgfSwKICAgIHByaW50RWRpdG9yOiBmdW5jdGlvbiBwcmludEVkaXRvcigpIHsKICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVkaXRvciIpLnByaW50KCk7CiAgICB9LAogICAgZm9ybWF0TnVtYmVyOiBmdW5jdGlvbiBmb3JtYXROdW1iZXIobnVtYmVyKSB7CiAgICAgIHJldHVybiBuZXcgSW50bC5OdW1iZXJGb3JtYXQodGhpcy4kdCgiZGF0ZS5sb2NhbGUiKSkuZm9ybWF0KG51bWJlcik7CiAgICB9LAogICAgZm9ybWF0RGF0ZTogZnVuY3Rpb24gZm9ybWF0RGF0ZShkYXRlKSB7CiAgICAgIHJldHVybiBuZXcgRGF0ZShkYXRlKS50b0xvY2FsZVN0cmluZyh0aGlzLiR0KCJkYXRlLmxvY2FsZSIpLCB0aGlzLmRhdGVPcHRpb25zKTsKICAgIH0sCiAgICBmb3JtYXREYXRlWW91dHViZTogZnVuY3Rpb24gZm9ybWF0RGF0ZVlvdXR1YmUoZGF0ZSkgewogICAgICByZXR1cm4gbmV3IERhdGUoZGF0ZSkudG9Mb2NhbGVEYXRlU3RyaW5nKHRoaXMuJHQoImRhdGUubG9jYWxlIiksIHsKICAgICAgICB5ZWFyOiAibnVtZXJpYyIsCiAgICAgICAgbW9udGg6ICJzaG9ydCIsCiAgICAgICAgZGF5OiAibnVtZXJpYyIKICAgICAgfSk7CiAgICB9LAogICAgZm9ybWF0U2Vjb25kczogZnVuY3Rpb24gZm9ybWF0U2Vjb25kcyhzZWMpIHsKICAgICAgdmFyIGQgPSBOdW1iZXIoc2VjKTsKICAgICAgdmFyIGggPSBNYXRoLmZsb29yKGQgLyAzNjAwKTsKICAgICAgdmFyIG0gPSBNYXRoLmZsb29yKGQgJSAzNjAwIC8gNjApOwogICAgICB2YXIgcyA9IE1hdGguZmxvb3IoZCAlIDM2MDAgJSA2MCk7CiAgICAgIHZhciBob3VyID0gdGhpcy4kdCgiZ2VuZXJhbC5ob3VyIik7CiAgICAgIHZhciBob3VycyA9IHRoaXMuJHQoImdlbmVyYWwuaG91cnMiKTsKICAgICAgdmFyIG1pbnV0ZSA9IHRoaXMuJHQoImdlbmVyYWwubWludXRlIik7CiAgICAgIHZhciBtaW51dGVzID0gdGhpcy4kdCgiZ2VuZXJhbC5taW51dGVzIik7CiAgICAgIHZhciBzZWNvbmQgPSB0aGlzLiR0KCJnZW5lcmFsLnNlY29uZCIpOwogICAgICB2YXIgc2Vjb25kcyA9IHRoaXMuJHQoImdlbmVyYWwuc2Vjb25kcyIpOwogICAgICB2YXIgaERpc3BsYXkgPSBoID4gMCA/IGggKyAoaCA9PSAxID8gIiAiLmNvbmNhdChob3VyLCAiICIpIDogIiAiLmNvbmNhdChob3VycywgIiAiKSkgOiAiIjsKICAgICAgdmFyIG1EaXNwbGF5ID0gbSA+IDAgPyBtICsgKG0gPT0gMSA/ICIgIi5jb25jYXQobWludXRlLCAiICIpIDogIiAiLmNvbmNhdChtaW51dGVzLCAiICIpKSA6ICIiOwogICAgICB2YXIgc0Rpc3BsYXkgPSBzID4gMCA/IHMgKyAocyA9PSAxID8gIiAiLmNvbmNhdChzZWNvbmQsICIgIikgOiAiICIuY29uY2F0KHNlY29uZHMsICIgIikpIDogIiI7CiAgICAgIHJldHVybiBoRGlzcGxheSArIG1EaXNwbGF5ICsgc0Rpc3BsYXk7CiAgICB9LAogICAgZ2V0R3JvdXBXaXRoSWQ6IGZ1bmN0aW9uIGdldEdyb3VwV2l0aElkKGlkKSB7CiAgICAgIHZhciBpbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleChmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICByZXR1cm4gZ3JvdXAuaWQgPT0gaWQ7CiAgICAgIH0pOwogICAgICByZXR1cm4gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaW5kZXhdOwogICAgfSwKICAgIGdldFN0cmVhbVdpdGhJZDogZnVuY3Rpb24gZ2V0U3RyZWFtV2l0aElkKGlkKSB7CiAgICAgIHZhciBpbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5maW5kSW5kZXgoZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgIHJldHVybiBzdHJlYW0uaWQgPT0gaWQ7CiAgICAgIH0pOwogICAgICByZXR1cm4gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XTsKICAgIH0sCiAgICBkb1NhdmU6IGZ1bmN0aW9uIGRvU2F2ZSgpIHsKICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IGZhbHNlOwogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgICAgICB2YXIgaW5kZXggPSBfdGhpczMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleChmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICAgIHJldHVybiBncm91cC5pZCA9PSBfdGhpczMuYWN0aXZlR3JvdXA7CiAgICAgICAgfSk7CgogICAgICAgIHZhciB1cGRhdGVHcm91cHMgPSBfdGhpczMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbHRlcihmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICAgIHJldHVybiAhZ3JvdXAuZ3JvdXBfaXNfcmVtb3ZlZCAmJiBncm91cC5tb2RpZmllZDsKICAgICAgICB9KS5tYXAoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBpZDogZ3JvdXAuaWQsCiAgICAgICAgICAgIGdyb3VwX25hbWU6IGdyb3VwLmdyb3VwX25hbWUsCiAgICAgICAgICAgIGdyb3VwX29yZGVyOiBncm91cC5ncm91cF9vcmRlciwKICAgICAgICAgICAgZ3JvdXBfdHlwZTogZ3JvdXAuZ3JvdXBfdHlwZSwKICAgICAgICAgICAgZ3JvdXBfcGFyZW50X2NvZGU6IGdyb3VwLmdyb3VwX3BhcmVudF9jb2RlLAogICAgICAgICAgICBncm91cF9pc19oaWRkZW46IGdyb3VwLmdyb3VwX2lzX2hpZGRlbgogICAgICAgICAgfTsKICAgICAgICB9KTsKCiAgICAgICAgdmFyIGRlbGV0ZUdyb3VwcyA9IF90aGlzMy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmlsdGVyKGZ1bmN0aW9uIChncm91cCkgewogICAgICAgICAgcmV0dXJuIGdyb3VwLmdyb3VwX2lzX3JlbW92ZWQgJiYgZ3JvdXAubW9kaWZpZWQ7CiAgICAgICAgfSkubWFwKGZ1bmN0aW9uIChncm91cCkgewogICAgICAgICAgcmV0dXJuIGdyb3VwLmlkOwogICAgICAgIH0pLmpvaW4oKTsKCiAgICAgICAgdmFyIHVwZGF0ZVN0cmVhbXM7CgogICAgICAgIHN3aXRjaCAoX3RoaXMzLmFjdGl2ZUdyb3VwVHlwZSkgewogICAgICAgICAgLy8gTGl2ZSBzdHJlYW1zCiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIHVwZGF0ZVN0cmVhbXMgPSBfdGhpczMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5maWx0ZXIoZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgICAgICAgIHJldHVybiBzdHJlYW0uc3RyZWFtX2lzX3JlbW92ZWQgIT09IDEgJiYgc3RyZWFtLm1vZGlmaWVkOwogICAgICAgICAgICB9KS5tYXAoZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBpZDogc3RyZWFtLmlkLAogICAgICAgICAgICAgICAgc291cmNlX3N0cmVhbV91cmw6IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX3VybCwKICAgICAgICAgICAgICAgIHN0cmVhbV90dmdfbmFtZTogc3RyZWFtLnN0cmVhbV90dmdfbmFtZSwKICAgICAgICAgICAgICAgIHN0cmVhbV90dmdfaWQ6IHN0cmVhbS5zdHJlYW1fdHZnX2lkLAogICAgICAgICAgICAgICAgc3RyZWFtX3R2Z19sb2dvOiBzdHJlYW0uc3RyZWFtX3R2Z19sb2dvLAogICAgICAgICAgICAgICAgc3RyZWFtX3BhcmVudF9jb2RlOiBzdHJlYW0uc3RyZWFtX3BhcmVudF9jb2RlLAogICAgICAgICAgICAgICAgc3RyZWFtX3JhZGlvOiBzdHJlYW0uc3RyZWFtX3JhZGlvLAogICAgICAgICAgICAgICAgc3RyZWFtX2lzX2hpZGRlbjogc3RyZWFtLnN0cmVhbV9pc19oaWRkZW4sCiAgICAgICAgICAgICAgICBzdHJlYW1fb3JkZXI6IHN0cmVhbS5zdHJlYW1fb3JkZXIKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAvLyBNb3ZpZXMKCiAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgIHVwZGF0ZVN0cmVhbXMgPSBfdGhpczMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5maWx0ZXIoZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgICAgICAgIHJldHVybiBzdHJlYW0uc3RyZWFtX2lzX3JlbW92ZWQgIT09IDEgJiYgc3RyZWFtLm1vZGlmaWVkOwogICAgICAgICAgICB9KS5tYXAoZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBpZDogc3RyZWFtLmlkLAogICAgICAgICAgICAgICAgc291cmNlX3N0cmVhbV91cmw6IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX3VybCwKICAgICAgICAgICAgICAgIG1vdmllX25hbWU6IHN0cmVhbS5tb3ZpZV9uYW1lLAogICAgICAgICAgICAgICAgbW92aWVfeWVhcjogc3RyZWFtLm1vdmllX3llYXIsCiAgICAgICAgICAgICAgICB0bWRiX2lkOiBzdHJlYW0udG1kYl9pZCwKICAgICAgICAgICAgICAgIHN0cmVhbV90dmdfbG9nbzogc3RyZWFtLnN0cmVhbV90dmdfbG9nbywKICAgICAgICAgICAgICAgIHN0cmVhbV9pc19oaWRkZW46IHN0cmVhbS5zdHJlYW1faXNfaGlkZGVuLAogICAgICAgICAgICAgICAgc3RyZWFtX29yZGVyOiBzdHJlYW0uc3RyZWFtX29yZGVyCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgLy8gU2VyaWVzCgogICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICB1cGRhdGVTdHJlYW1zID0gX3RoaXMzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMuZmlsdGVyKGZ1bmN0aW9uIChzdHJlYW0pIHsKICAgICAgICAgICAgICByZXR1cm4gc3RyZWFtLnN0cmVhbV9pc19yZW1vdmVkICE9PSAxICYmIHN0cmVhbS5tb2RpZmllZDsKICAgICAgICAgICAgfSkubWFwKGZ1bmN0aW9uIChzdHJlYW0pIHsKICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgaWQ6IHN0cmVhbS5pZCwKICAgICAgICAgICAgICAgIHNvdXJjZV9zdHJlYW1fdXJsOiBzdHJlYW0uc291cmNlX3N0cmVhbV91cmwsCiAgICAgICAgICAgICAgICBzZXJpZV9uYW1lOiBzdHJlYW0uc2VyaWVfbmFtZSwKICAgICAgICAgICAgICAgIHNlcmllX3NlYXNvbjogc3RyZWFtLnNlcmllX3NlYXNvbiwKICAgICAgICAgICAgICAgIHNlcmllX2VwaXNvZGU6IHN0cmVhbS5zZXJpZV9lcGlzb2RlLAogICAgICAgICAgICAgICAgdG1kYl9pZDogc3RyZWFtLnRtZGJfaWQsCiAgICAgICAgICAgICAgICBzdHJlYW1fdHZnX2xvZ286IHN0cmVhbS5zdHJlYW1fdHZnX2xvZ28sCiAgICAgICAgICAgICAgICBzdHJlYW1faXNfaGlkZGVuOiBzdHJlYW0uc3RyZWFtX2lzX2hpZGRlbiwKICAgICAgICAgICAgICAgIHN0cmVhbV9vcmRlcjogc3RyZWFtLnN0cmVhbV9vcmRlcgogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICAgIHZhciBkZWxldGVTdHJlYW1zID0gX3RoaXMzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMuZmlsdGVyKGZ1bmN0aW9uIChzdHJlYW0pIHsKICAgICAgICAgIHJldHVybiBzdHJlYW0uc3RyZWFtX2lzX3JlbW92ZWQgPT09IDEgJiYgc3RyZWFtLm1vZGlmaWVkOwogICAgICAgIH0pLm1hcChmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAgICAgICByZXR1cm4gc3RyZWFtLmlkOwogICAgICAgIH0pLmpvaW4oKTsKCiAgICAgICAgdmFyIHJlcXVlc3RzID0gW107CgogICAgICAgIGlmICh1cGRhdGVHcm91cHMubGVuZ3RoKSB7CiAgICAgICAgICByZXF1ZXN0cy5wdXNoKGh0dHBTZXJ2aWNlLnBvc3QoImVkaXRvci91cGRhdGUtZ3JvdXBzIiwgewogICAgICAgICAgICBwbGF5bGlzdF9pZDogX3RoaXMzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgICBncm91cHM6IHVwZGF0ZUdyb3VwcwogICAgICAgICAgfSkpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGRlbGV0ZUdyb3Vwcy5sZW5ndGgpIHsKICAgICAgICAgIGluZGV4ID0gMDsKICAgICAgICAgIHJlcXVlc3RzLnB1c2goaHR0cFNlcnZpY2UucG9zdCgiZWRpdG9yL2RlbGV0ZS1ncm91cHMiLCB7CiAgICAgICAgICAgIHBsYXlsaXN0X2lkOiBfdGhpczMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICAgIGdyb3VwczogZGVsZXRlR3JvdXBzCiAgICAgICAgICB9KSk7CiAgICAgICAgfQoKICAgICAgICBpZiAodXBkYXRlU3RyZWFtcy5sZW5ndGgpIHsKICAgICAgICAgIHJlcXVlc3RzLnB1c2goaHR0cFNlcnZpY2UucG9zdCgiZWRpdG9yL3VwZGF0ZS1zdHJlYW1zLyIuY29uY2F0KF90aGlzMy5hY3RpdmVHcm91cFR5cGUpLCB7CiAgICAgICAgICAgIHBsYXlsaXN0X2lkOiBfdGhpczMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICAgIHN0cmVhbXM6IHVwZGF0ZVN0cmVhbXMKICAgICAgICAgIH0pKTsKICAgICAgICB9CgogICAgICAgIGlmIChkZWxldGVTdHJlYW1zLmxlbmd0aCkgewogICAgICAgICAgcmVxdWVzdHMucHVzaChodHRwU2VydmljZS5wb3N0KCJlZGl0b3IvZGVsZXRlLXN0cmVhbXMvIi5jb25jYXQoX3RoaXMzLmFjdGl2ZUdyb3VwVHlwZSksIHsKICAgICAgICAgICAgcGxheWxpc3RfaWQ6IF90aGlzMy5wbGF5bGlzdEVkaXRvci5pZCwKICAgICAgICAgICAgc3RyZWFtczogZGVsZXRlU3RyZWFtcwogICAgICAgICAgfSkpOwogICAgICAgIH0KCiAgICAgICAgUHJvbWlzZS5hbGwocmVxdWVzdHMpLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgICAgX3RoaXMzLmxvYWRQbGF5bGlzdChfdGhpczMucGxheWxpc3RFZGl0b3IuaWQsIGluZGV4KTsKCiAgICAgICAgICByZXNvbHZlKHJlcyk7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSwKICAgIGRvQ2FuY2VsOiBmdW5jdGlvbiBkb0NhbmNlbCgpIHsKICAgICAgdmFyIF90aGlzNCA9IHRoaXM7CgogICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIFByb21pc2UuYWxsKFt0aGlzLnJlc3RvcmVHcm91cHMoKSwgdGhpcy5yZXN0b3JlU3RyZWFtcygpXSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXM0LnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSBmYWxzZTsKICAgICAgICBfdGhpczQuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0pOwogICAgfSwKICAgIGRvVGFiQ2hhbmdlOiBmdW5jdGlvbiBkb1RhYkNoYW5nZSh0YWIpIHsKICAgICAgdGhpcy5hY3RpdmVUYWIgPSB0YWI7CiAgICB9LAogICAgdXBkYXRlR3JvdXBPcmRlcjogZnVuY3Rpb24gdXBkYXRlR3JvdXBPcmRlcihzb3VyY2UpIHsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgICAgdmFyIGdyb3VwcyA9IF90b0NvbnN1bWFibGVBcnJheShzb3VyY2UpOwoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGdyb3Vwcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgZ3JvdXBzW2ldLnNvdXJjZV9ncm91cF9vcmRlciA9IGkgKyAxOwogICAgICAgICAgZ3JvdXBzW2ldLmdyb3VwX29yZGVyID0gaSArIDE7CiAgICAgICAgfQoKICAgICAgICByZXNvbHZlKGdyb3Vwcyk7CiAgICAgIH0pOwogICAgfSwKICAgIHVwZGF0ZVN0cmVhbU9yZGVyOiBmdW5jdGlvbiB1cGRhdGVTdHJlYW1PcmRlcihzb3VyY2UpIHsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgICAgdmFyIHN0cmVhbXMgPSBfdG9Db25zdW1hYmxlQXJyYXkoc291cmNlKTsKCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzdHJlYW1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBzdHJlYW1zW2ldLnNvdXJjZV9zdHJlYW1fb3JkZXIgPSBpICsgMTsKICAgICAgICAgIHN0cmVhbXNbaV0uc3RyZWFtX29yZGVyID0gaSArIDE7CiAgICAgICAgfQoKICAgICAgICByZXNvbHZlKHN0cmVhbXMpOwogICAgICB9KTsKICAgIH0sCiAgICByZXN0b3JlR3JvdXBPcmRlcjogZnVuY3Rpb24gcmVzdG9yZUdyb3VwT3JkZXIoKSB7CiAgICAgIHZhciBfdGhpczUgPSB0aGlzOwoKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgICAgX3RoaXM1LnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICByZXR1cm4gYS5zb3VyY2VfZ3JvdXBfb3JkZXIgPiBiLnNvdXJjZV9ncm91cF9vcmRlciA/IDEgOiBiLnNvdXJjZV9ncm91cF9vcmRlciA+IGEuc291cmNlX2dyb3VwX29yZGVyID8gLTEgOiAwOwogICAgICAgIH0pOwoKICAgICAgICByZXNvbHZlKCk7CiAgICAgIH0pOwogICAgfSwKICAgIHJlc3RvcmVTdHJlYW1PcmRlcjogZnVuY3Rpb24gcmVzdG9yZVN0cmVhbU9yZGVyKCkgewogICAgICB2YXIgX3RoaXM2ID0gdGhpczsKCiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkgewogICAgICAgIF90aGlzNi5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgIHJldHVybiBhLnNvdXJjZV9zdHJlYW1fb3JkZXIgPiBiLnNvdXJjZV9zdHJlYW1fb3JkZXIgPyAxIDogYi5zb3VyY2Vfc3RyZWFtX29yZGVyID4gYS5zb3VyY2Vfc3RyZWFtX29yZGVyID8gLTEgOiAwOwogICAgICAgIH0pOwoKICAgICAgICByZXNvbHZlKCk7CiAgICAgIH0pOwogICAgfSwKICAgIHJlc3RvcmVHcm91cHM6IGZ1bmN0aW9uIHJlc3RvcmVHcm91cHMoKSB7CiAgICAgIHZhciBfdGhpczcgPSB0aGlzOwoKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgICAgX3RoaXM3LnJlc3RvcmVHcm91cE9yZGVyKCkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgZ3JvdXA7CgogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBfdGhpczcucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGdyb3VwID0gX3RoaXM3LnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXTsKICAgICAgICAgICAgZ3JvdXAubW9kaWZpZWQgPSBmYWxzZTsKICAgICAgICAgICAgZ3JvdXAuZ3JvdXBfaXNfcmVtb3ZlZCA9IDA7CiAgICAgICAgICAgIGdyb3VwLmdyb3VwX3R5cGUgPSBncm91cC5zb3VyY2VfZ3JvdXBfdHlwZTsKICAgICAgICAgICAgZ3JvdXAuZ3JvdXBfbmFtZSA9IGdyb3VwLnNvdXJjZV9ncm91cF9uYW1lOwogICAgICAgICAgICBncm91cC5wYXJlbnRfY29kZSA9IGdyb3VwLnNvdXJjZV9ncm91cF9wYXJlbnRfY29kZTsKICAgICAgICAgICAgZ3JvdXAuZ3JvdXBfaXNfaGlkZGVuID0gZ3JvdXAuc291cmNlX2dyb3VwX2lzX2hpZGRlbjsKICAgICAgICAgIH0KCiAgICAgICAgICByZXNvbHZlKCk7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSwKICAgIHJlc3RvcmVTdHJlYW1zOiBmdW5jdGlvbiByZXN0b3JlU3RyZWFtcygpIHsKICAgICAgdmFyIF90aGlzOCA9IHRoaXM7CgogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgICAgICBfdGhpczgucmVzdG9yZVN0cmVhbU9yZGVyKCkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgc3RyZWFtOwoKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgX3RoaXM4LnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgc3RyZWFtID0gX3RoaXM4LnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV07CiAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IGZhbHNlOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX2lzX3JlbW92ZWQgPSAwOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lID0gc3RyZWFtLnNvdXJjZV9zdHJlYW1fdHZnX25hbWU7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX2lkID0gc3RyZWFtLnNvdXJjZV9zdHJlYW1fdHZnX2lkOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19sb2dvID0gc3RyZWFtLnNvdXJjZV9zdHJlYW1fdHZnX2xvZ287CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX2Nobm8gPSBzdHJlYW0uc291cmNlX3N0cmVhbV90dmdfY2hubzsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfc2hpZnQgPSBzdHJlYW0uc291cmNlX3N0cmVhbV90dmdfc2hpZnQ7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fcGFyZW50X2NvZGUgPSBzdHJlYW0uc291cmNlX3N0cmVhbV9wYXJlbnRfY29kZTsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV9hdWRpb190cmFjayA9IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX2F1ZGlvX3RyYWNrOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX2FzcGVjdF9yYXRpbyA9IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX2FzcGVjdF9yYXRpbzsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV9yYWRpbyA9IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX3JhZGlvOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX29yZGVyID0gc3RyZWFtLnNvdXJjZV9zdHJlYW1fb3JkZXI7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1faXNfaGlkZGVuID0gc3RyZWFtLnNvdXJjZV9zdHJlYW1faXNfaGlkZGVuOwoKICAgICAgICAgICAgaWYgKHN0cmVhbS5tb3ZpZV9uYW1lICE9PSB1bmRlZmluZWQgJiYgc3RyZWFtLm1vdmllX3llYXIgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIHN0cmVhbS5tb3ZpZV9uYW1lID0gc3RyZWFtLnNvdXJjZV9tb3ZpZV9uYW1lOwogICAgICAgICAgICAgIHN0cmVhbS5tb3ZpZV95ZWFyID0gc3RyZWFtLnNvdXJjZV9tb3ZpZV95ZWFyOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoc3RyZWFtLnNlcmllX25hbWUgIT09IHVuZGVmaW5lZCAmJiBzdHJlYW0uc2VyaWVfc2Vhc29uICE9PSB1bmRlZmluZWQgJiYgc3RyZWFtLnNlcmllX2VwaXNvZGUgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIHN0cmVhbS5zZXJpZV9uYW1lID0gc3RyZWFtLnNvdXJjZV9zZXJpZV9uYW1lOwogICAgICAgICAgICAgIHN0cmVhbS5zZXJpZV9zZWFzb24gPSBzdHJlYW0uc291cmNlX3NlcmllX3NlYXNvbjsKICAgICAgICAgICAgICBzdHJlYW0uc2VyaWVfZXBpc29kZSA9IHN0cmVhbS5zb3VyY2Vfc2VyaWVfZXBpc29kZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LAogICAgdG9nZ2xlR3JvdXBWaXNpYmlsaXR5OiBmdW5jdGlvbiB0b2dnbGVHcm91cFZpc2liaWxpdHkoKSB7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cHMuaW5jbHVkZXModGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uaWQpKSB7CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5ncm91cF9pc19oaWRkZW4gPSAhdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uZ3JvdXBfaXNfaGlkZGVuOwogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgIH0sCiAgICB0b2dnbGVTdHJlYW1WaXNpYmlsaXR5OiBmdW5jdGlvbiB0b2dnbGVTdHJlYW1WaXNpYmlsaXR5KCkgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmICh0aGlzLmFjdGl2ZVN0cmVhbXMuaW5jbHVkZXModGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLmlkKSkgewogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLnN0cmVhbV9pc19oaWRkZW4gPSAhdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLnN0cmVhbV9pc19oaWRkZW47CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgIH0sCiAgICB0b2dnbGVTdHJlYW1SYWRpbzogZnVuY3Rpb24gdG9nZ2xlU3RyZWFtUmFkaW8oKSB7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHRoaXMuYWN0aXZlU3RyZWFtcy5pbmNsdWRlcyh0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uaWQpKSB7CiAgICAgICAgICBpZiAodGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLnN0cmVhbV9yYWRpbyA9PSAwKSB7CiAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5zdHJlYW1fcmFkaW8gPSAxOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLnN0cmVhbV9yYWRpbyA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICB9LAogICAgZGVsZXRlU2VsZWN0ZWRHcm91cHM6IGZ1bmN0aW9uIGRlbGV0ZVNlbGVjdGVkR3JvdXBzKCkgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBzLmluY2x1ZGVzKHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmlkKSkgewogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uZ3JvdXBfaXNfcmVtb3ZlZCA9IDE7CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgfSwKICAgIGRlbGV0ZVNlbGVjdGVkU3RyZWFtczogZnVuY3Rpb24gZGVsZXRlU2VsZWN0ZWRTdHJlYW1zKCkgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmICh0aGlzLmFjdGl2ZVN0cmVhbXMuaW5jbHVkZXModGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLmlkKSkgewogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLnN0cmVhbV9pc19yZW1vdmVkID0gMTsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgfSwKICAgIGxvYWRQbGF5bGlzdDogZnVuY3Rpb24gbG9hZFBsYXlsaXN0KHZhbCkgewogICAgICB2YXIgX3RoaXM5ID0gdGhpczsKCiAgICAgIHZhciBncm91cF9pbmRleCA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkOwogICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7CgogICAgICBpZiAodGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkKSB7CiAgICAgICAgdGhpcy5kb1NhdmUoKTsKICAgICAgfQoKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5pZCA9IHZhbDsKICAgICAgaHR0cFNlcnZpY2UuZ2V0KCJlZGl0b3IvZ3JvdXBzLyIuY29uY2F0KHZhbCkpLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgIGlmIChyZXMuc3RhdHVzID09PSB0cnVlKSB7CiAgICAgICAgICBfdGhpczkudXBkYXRlR3JvdXBPcmRlcihyZXMuZGF0YSkudGhlbihmdW5jdGlvbiAoZ3JvdXBzKSB7CiAgICAgICAgICAgIF90aGlzOS5wbGF5bGlzdEVkaXRvci5ncm91cHMgPSBncm91cHMubWFwKGZ1bmN0aW9uIChncm91cCkgewogICAgICAgICAgICAgIHZhciBncnAgPSBPYmplY3QuYXNzaWduKHt9LCBncm91cCk7CiAgICAgICAgICAgICAgZ3JwLnNvdXJjZV9ncm91cF9wYXJlbnRfY29kZSA9IGdyb3VwLmdyb3VwX3BhcmVudF9jb2RlOwogICAgICAgICAgICAgIGdycC5zb3VyY2VfZ3JvdXBfaXNfaGlkZGVuID0gZ3JvdXAuZ3JvdXBfaXNfaGlkZGVuOwogICAgICAgICAgICAgIGdycC5zb3VyY2VfZ3JvdXBfbmFtZSA9IGdyb3VwLmdyb3VwX25hbWU7CiAgICAgICAgICAgICAgZ3JwLnNvdXJjZV9ncm91cF90eXBlID0gZ3JvdXAuZ3JvdXBfdHlwZTsKICAgICAgICAgICAgICBncnAuZ3JvdXBfaXNfcmVtb3ZlZCA9IGZhbHNlOwogICAgICAgICAgICAgIGdycC5tb2RpZmllZCA9IGZhbHNlOwogICAgICAgICAgICAgIHJldHVybiBncnA7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaWYgKGdyb3Vwcy5sZW5ndGgpIHsKICAgICAgICAgICAgICBpZiAoZ3JvdXBfaW5kZXggPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgX3RoaXM5LmFjdGl2ZUdyb3VwID0gX3RoaXM5LnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1swXS5pZDsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgX3RoaXM5LmFjdGl2ZUdyb3VwID0gX3RoaXM5LnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tncm91cF9pbmRleF0uaWQ7CgogICAgICAgICAgICAgICAgX3RoaXM5LmxvYWRTdHJlYW1zKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIF90aGlzOS5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzOS5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfSk7CiAgICB9LAogICAgdG9nZ2xlR3JvdXBTZWxlY3Rpb246IGZ1bmN0aW9uIHRvZ2dsZUdyb3VwU2VsZWN0aW9uKGl0ZW0pIHsKICAgICAgdmFyIGlkeCA9IHRoaXMuYWN0aXZlR3JvdXBzLmluZGV4T2YoaXRlbSk7CgogICAgICBpZiAoaWR4ICE9PSAtMSkgewogICAgICAgIHRoaXMuYWN0aXZlR3JvdXBzLnNwbGljZShpZHgsIDEpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYWN0aXZlR3JvdXBzLnB1c2goaXRlbSk7CiAgICAgIH0KICAgIH0sCiAgICB0b2dnbGVTdHJlYW1TZWxlY3Rpb246IGZ1bmN0aW9uIHRvZ2dsZVN0cmVhbVNlbGVjdGlvbihpdGVtKSB7CiAgICAgIHZhciBpZHggPSB0aGlzLmFjdGl2ZVN0cmVhbXMuaW5kZXhPZihpdGVtKTsKCiAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgdGhpcy5hY3RpdmVTdHJlYW1zLnNwbGljZShpZHgsIDEpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYWN0aXZlU3RyZWFtcy5wdXNoKGl0ZW0pOwogICAgICB9CiAgICB9LAogICAgdG9nZ2xlUmFkaW9icm93c2VyU2VsZWN0aW9uOiBmdW5jdGlvbiB0b2dnbGVSYWRpb2Jyb3dzZXJTZWxlY3Rpb24oaXRlbSkgewogICAgICB2YXIgaWR4ID0gdGhpcy5yYWRpb0Jyb3dzZXIuYWN0aXZlLmluZGV4T2YoaXRlbSk7CgogICAgICBpZiAoaWR4ICE9PSAtMSkgewogICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZS5zcGxpY2UoaWR4LCAxKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnJhZGlvQnJvd3Nlci5hY3RpdmUucHVzaChpdGVtKTsKICAgICAgfQogICAgfSwKICAgIHRvZ2dsZUltcG9ydE0zVVNlbGVjdGlvbjogZnVuY3Rpb24gdG9nZ2xlSW1wb3J0TTNVU2VsZWN0aW9uKGl0ZW0pIHsKICAgICAgdmFyIGlkeCA9IHRoaXMuaW1wb3J0TTNVLmltcG9ydEdyb3Vwcy5pbmRleE9mKGl0ZW0pOwoKICAgICAgaWYgKGlkeCAhPT0gLTEpIHsKICAgICAgICB0aGlzLmltcG9ydE0zVS5pbXBvcnRHcm91cHMuc3BsaWNlKGlkeCwgMSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5pbXBvcnRNM1UuaW1wb3J0R3JvdXBzLnB1c2goaXRlbSk7CiAgICAgIH0KICAgIH0sCiAgICBpbmRleE9mR3JvdXA6IGZ1bmN0aW9uIGluZGV4T2ZHcm91cChncm91cCkgewogICAgICByZXR1cm4gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMubWFwKGZ1bmN0aW9uIChnKSB7CiAgICAgICAgcmV0dXJuIGcuaWQ7CiAgICAgIH0pLmluZGV4T2YoZ3JvdXApOwogICAgfSwKICAgIHNlbGVjdEdyb3VwUmFuZ2VTZWxlY3Rpb246IGZ1bmN0aW9uIHNlbGVjdEdyb3VwUmFuZ2VTZWxlY3Rpb24oaXRlbSkgewogICAgICB2YXIgbGFzdEluZGV4ID0gdGhpcy5pbmRleE9mR3JvdXAodGhpcy5sYXN0U2VsZWN0ZWRHcm91cCk7CiAgICAgIHZhciBpdGVtSW5kZXggPSB0aGlzLmluZGV4T2ZHcm91cChpdGVtKTsKICAgICAgdmFyIGRpciA9IGl0ZW1JbmRleCA+IGxhc3RJbmRleCA/IDEgOiAtMTsKCiAgICAgIGZvciAodmFyIGkgPSBsYXN0SW5kZXg7IGkgIT0gaXRlbUluZGV4ICsgZGlyOyBpICs9IGRpcikgewogICAgICAgIGlmICghdGhpcy5hY3RpdmVHcm91cHMuaW5jbHVkZXModGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uaWQpKSB7CiAgICAgICAgICB0aGlzLmFjdGl2ZUdyb3Vwcy5wdXNoKHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmlkKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBpbmRleE9mU3RyZWFtOiBmdW5jdGlvbiBpbmRleE9mU3RyZWFtKHN0cmVhbSkgewogICAgICByZXR1cm4gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLm1hcChmdW5jdGlvbiAoZykgewogICAgICAgIHJldHVybiBnLmlkOwogICAgICB9KS5pbmRleE9mKHN0cmVhbSk7CiAgICB9LAogICAgc2VsZWN0U3RyZWFtUmFuZ2VTZWxlY3Rpb246IGZ1bmN0aW9uIHNlbGVjdFN0cmVhbVJhbmdlU2VsZWN0aW9uKGl0ZW0pIHsKICAgICAgdmFyIGxhc3RJbmRleCA9IHRoaXMuaW5kZXhPZlN0cmVhbSh0aGlzLmxhc3RTZWxlY3RlZFN0cmVhbSk7CiAgICAgIHZhciBpdGVtSW5kZXggPSB0aGlzLmluZGV4T2ZTdHJlYW0oaXRlbSk7CiAgICAgIHZhciBkaXIgPSBpdGVtSW5kZXggPiBsYXN0SW5kZXggPyAxIDogLTE7CgogICAgICBmb3IgKHZhciBpID0gbGFzdEluZGV4OyBpICE9IGl0ZW1JbmRleCArIGRpcjsgaSArPSBkaXIpIHsKICAgICAgICBpZiAoIXRoaXMuYWN0aXZlU3RyZWFtcy5pbmNsdWRlcyh0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uaWQpKSB7CiAgICAgICAgICB0aGlzLmFjdGl2ZVN0cmVhbXMucHVzaCh0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uaWQpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHNlbGVjdFJhZGlvYnJvd3NlclJhbmdlU2VsZWN0aW9uOiBmdW5jdGlvbiBzZWxlY3RSYWRpb2Jyb3dzZXJSYW5nZVNlbGVjdGlvbihpbmRleCkgewogICAgICB2YXIgbGFzdEluZGV4ID0gdGhpcy5yYWRpb0Jyb3dzZXIuYWN0aXZlW3RoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZS5sZW5ndGggLSAxXTsKICAgICAgdmFyIGRpciA9IGluZGV4ID4gbGFzdEluZGV4ID8gMSA6IC0xOwoKICAgICAgZm9yICh2YXIgaSA9IGxhc3RJbmRleDsgaSAhPSBpbmRleCArIGRpcjsgaSArPSBkaXIpIHsKICAgICAgICBpZiAoIXRoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZS5pbmNsdWRlcyhpKSkgewogICAgICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuYWN0aXZlLnB1c2goaSk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgc2VsZWN0SW1wb3J0TTNVUmFuZ2VTZWxlY3Rpb246IGZ1bmN0aW9uIHNlbGVjdEltcG9ydE0zVVJhbmdlU2VsZWN0aW9uKGluZGV4KSB7CiAgICAgIHZhciBsYXN0SW5kZXggPSB0aGlzLmltcG9ydE0zVS5pbXBvcnRHcm91cHNbdGhpcy5pbXBvcnRNM1UuaW1wb3J0R3JvdXBzLmxlbmd0aCAtIDFdOwogICAgICB2YXIgZGlyID0gaW5kZXggPiBsYXN0SW5kZXggPyAxIDogLTE7CgogICAgICBmb3IgKHZhciBpID0gbGFzdEluZGV4OyBpICE9IGluZGV4ICsgZGlyOyBpICs9IGRpcikgewogICAgICAgIGlmICghdGhpcy5pbXBvcnRNM1UuaW1wb3J0R3JvdXBzLmluY2x1ZGVzKGkpKSB7CiAgICAgICAgICB0aGlzLmltcG9ydE0zVS5pbXBvcnRHcm91cHMucHVzaChpKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBzZWxlY3RHcm91cFNlbGVjdGlvbjogZnVuY3Rpb24gc2VsZWN0R3JvdXBTZWxlY3Rpb24oaXRlbSkgewogICAgICB0aGlzLmFjdGl2ZUdyb3Vwcy5sZW5ndGggPSAwOwogICAgICB0aGlzLmFjdGl2ZUdyb3Vwcy5wdXNoKGl0ZW0pOwogICAgfSwKICAgIHNlbGVjdFN0cmVhbVNlbGVjdGlvbjogZnVuY3Rpb24gc2VsZWN0U3RyZWFtU2VsZWN0aW9uKGl0ZW0pIHsKICAgICAgdGhpcy5hY3RpdmVTdHJlYW1zLmxlbmd0aCA9IDA7CiAgICAgIHRoaXMuYWN0aXZlU3RyZWFtcy5wdXNoKGl0ZW0pOwogICAgfSwKICAgIHNlbGVjdFJhZGlvYnJvd3NlclNlbGVjdGlvbjogZnVuY3Rpb24gc2VsZWN0UmFkaW9icm93c2VyU2VsZWN0aW9uKGl0ZW0pIHsKICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuYWN0aXZlLmxlbmd0aCA9IDA7CiAgICAgIHRoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZS5wdXNoKGl0ZW0pOwogICAgfSwKICAgIHNlbGVjdEltcG9ydE0zVVNlbGVjdGlvbjogZnVuY3Rpb24gc2VsZWN0SW1wb3J0TTNVU2VsZWN0aW9uKGl0ZW0pIHsKICAgICAgdGhpcy5pbXBvcnRNM1UuaW1wb3J0R3JvdXBzLmxlbmd0aCA9IDA7CiAgICAgIHRoaXMuaW1wb3J0TTNVLmltcG9ydEdyb3Vwcy5wdXNoKGl0ZW0pOwogICAgfSwKICAgIGZpbmRBbmRSZXBsYWNlTW9kYWw6IGZ1bmN0aW9uIGZpbmRBbmRSZXBsYWNlTW9kYWwoc2hvdykgewogICAgICB2YXIgdHlwZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogMTsKICAgICAgdGhpcy5maW5kUmVwbGFjZS50eXBlID0gdHlwZTsKICAgICAgdGhpcy5maW5kUmVwbGFjZS5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgZmluZEFuZFJlcGxhY2U6IGZ1bmN0aW9uIGZpbmRBbmRSZXBsYWNlKCkgewogICAgICB2YXIgX3RoaXMxMCA9IHRoaXM7CgogICAgICB2YXIgb3B0aW9ucyA9ICIiOwoKICAgICAgaWYgKHRoaXMuZmluZFJlcGxhY2UucmVwbGFjZUFsbCkgewogICAgICAgIG9wdGlvbnMgKz0gImciOwogICAgICB9CgogICAgICBpZiAodGhpcy5maW5kUmVwbGFjZS5pZ25vcmVDYXNlKSB7CiAgICAgICAgb3B0aW9ucyArPSAiaSI7CiAgICAgIH0KCiAgICAgIHZhciByZSA9IG5ldyBSZWdFeHAodGhpcy5maW5kUmVwbGFjZS5mcm9tLnJlcGxhY2UoInwiLCAiXFx8IiksIG9wdGlvbnMpOwoKICAgICAgc3dpdGNoIChwYXJzZUludCh0aGlzLmZpbmRSZXBsYWNlLnR5cGUpKSB7CiAgICAgICAgLy8gR3JvdXAKICAgICAgICBjYXNlIDE6CiAgICAgICAgICBpZiAocGFyc2VJbnQodGhpcy5maW5kUmVwbGFjZS5zZWxlY3RlZE9ubHkpID09PSAxKSB7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cHMuaW5jbHVkZXModGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uaWQpKSB7CiAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5ncm91cF9uYW1lID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uZ3JvdXBfbmFtZS5yZXBsYWNlKHJlLCB0aGlzLmZpbmRSZXBsYWNlLnRvKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuZmlsdGVyZWRHcm91cHMubWFwKGZ1bmN0aW9uIChncm91cCkgewogICAgICAgICAgICAgIGdyb3VwLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICBncm91cC5ncm91cF9uYW1lID0gZ3JvdXAuZ3JvdXBfbmFtZS5yZXBsYWNlKHJlLCBfdGhpczEwLmZpbmRSZXBsYWNlLnRvKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgYnJlYWs7CiAgICAgICAgLy8gU3RyZWFtcwoKICAgICAgICBjYXNlIDI6CiAgICAgICAgICBpZiAocGFyc2VJbnQodGhpcy5maW5kUmVwbGFjZS5zZWxlY3RlZE9ubHkpID09PSAxKSB7CiAgICAgICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOyBfaSsrKSB7CiAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlU3RyZWFtcy5pbmNsdWRlcyh0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbX2ldLmlkKSkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAxKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tfaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbX2ldLnN0cmVhbV90dmdfbmFtZSA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tfaV0uc3RyZWFtX3R2Z19uYW1lLnJlcGxhY2UocmUsIHRoaXMuZmluZFJlcGxhY2UudG8pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMikgewogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbX2ldLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW19pXS5tb3ZpZV9uYW1lID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW19pXS5tb3ZpZV9uYW1lLnJlcGxhY2UocmUsIHRoaXMuZmluZFJlcGxhY2UudG8pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMykgewogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbX2ldLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW19pXS5zZXJpZV9uYW1lID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW19pXS5zZXJpZV9uYW1lLnJlcGxhY2UocmUsIHRoaXMuZmluZFJlcGxhY2UudG8pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5maWx0ZXJlZFN0cmVhbXMubWFwKGZ1bmN0aW9uIChzdHJlYW0pIHsKICAgICAgICAgICAgICBpZiAoX3RoaXMxMC5hY3RpdmVHcm91cFR5cGUgPT09IDEpIHsKICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lID0gc3RyZWFtLnN0cmVhbV90dmdfbmFtZS5yZXBsYWNlKHJlLCBfdGhpczEwLmZpbmRSZXBsYWNlLnRvKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChfdGhpczEwLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMikgewogICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHN0cmVhbS5tb3ZpZV9uYW1lID0gc3RyZWFtLm1vdmllX25hbWUucmVwbGFjZShyZSwgX3RoaXMxMC5maW5kUmVwbGFjZS50byk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoX3RoaXMxMC5hY3RpdmVHcm91cFR5cGUgPT09IDMpIHsKICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICBzdHJlYW0uc2VyaWVfbmFtZSA9IHN0cmVhbS5zZXJpZV9uYW1lLnJlcGxhY2UocmUsIF90aGlzMTAuZmluZFJlcGxhY2UudG8pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgYnJlYWs7CiAgICAgIH0KCiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICAgIHRoaXMuZmluZFJlcGxhY2UubW9kYWwgPSBmYWxzZTsKICAgIH0sCiAgICBwcmVmaXhTdWZmaXhNb2RhbDogZnVuY3Rpb24gcHJlZml4U3VmZml4TW9kYWwoc2hvdykgewogICAgICB2YXIgdHlwZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogMTsKICAgICAgdGhpcy5wcmVmaXhTdWZmaXgudHlwZSA9IHR5cGU7CiAgICAgIHRoaXMucHJlZml4U3VmZml4Lm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBhZGRQcmVmaXhTdWZmaXg6IGZ1bmN0aW9uIGFkZFByZWZpeFN1ZmZpeCgpIHsKICAgICAgdmFyIHByZWZpeCA9IHRoaXMucHJlZml4U3VmZml4LnByZWZpeDsKICAgICAgdmFyIHN1ZmZpeCA9IHRoaXMucHJlZml4U3VmZml4LnN1ZmZpeDsKCiAgICAgIHN3aXRjaCAocGFyc2VJbnQodGhpcy5wcmVmaXhTdWZmaXgudHlwZSkpIHsKICAgICAgICAvLyBHcm91cAogICAgICAgIGNhc2UgMToKICAgICAgICAgIGlmIChwYXJzZUludCh0aGlzLnByZWZpeFN1ZmZpeC5zZWxlY3RlZE9ubHkpID09PSAxKSB7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cHMuaW5jbHVkZXModGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uaWQpKSB7CiAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5ncm91cF9uYW1lID0gcHJlZml4ICsgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uZ3JvdXBfbmFtZSArIHN1ZmZpeDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuZmlsdGVyZWRHcm91cHMubWFwKGZ1bmN0aW9uIChncm91cCkgewogICAgICAgICAgICAgIGdyb3VwLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICBncm91cC5ncm91cF9uYW1lID0gcHJlZml4ICsgZ3JvdXAuZ3JvdXBfbmFtZSArIHN1ZmZpeDsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgYnJlYWs7CiAgICAgICAgLy8gU3RyZWFtCgogICAgICAgIGNhc2UgMjoKICAgICAgICAgIGlmIChwYXJzZUludCh0aGlzLnByZWZpeFN1ZmZpeC5zZWxlY3RlZE9ubHkpID09PSAxKSB7CiAgICAgICAgICAgIGZvciAodmFyIF9pMiA9IDA7IF9pMiA8IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7IF9pMisrKSB7CiAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlU3RyZWFtcy5pbmNsdWRlcyh0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbX2kyXS5pZCkpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMSkgewogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbX2kyXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tfaTJdLnN0cmVhbV90dmdfbmFtZSA9IHByZWZpeCArIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tfaTJdLnN0cmVhbV90dmdfbmFtZSArIHN1ZmZpeDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDIpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW19pMl0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbX2kyXS5tb3ZpZV9uYW1lID0gcHJlZml4ICsgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW19pMl0ubW92aWVfbmFtZSArIHN1ZmZpeDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDMpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW19pMl0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbX2kyXS5zZXJpZV9uYW1lID0gcHJlZml4ICsgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW19pMl0uc2VyaWVfbmFtZSArIHN1ZmZpeDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMSkgewogICAgICAgICAgICAgIHRoaXMuZmlsdGVyZWRTdHJlYW1zLm1hcChmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfbmFtZSA9IHByZWZpeCArIHN0cmVhbS5zdHJlYW1fdHZnX25hbWUgKyBzdWZmaXg7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMikgewogICAgICAgICAgICAgIHRoaXMuZmlsdGVyZWRTdHJlYW1zLm1hcChmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgc3RyZWFtLm1vdmllX25hbWUgPSBwcmVmaXggKyBzdHJlYW0ubW92aWVfbmFtZSArIHN1ZmZpeDsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAzKSB7CiAgICAgICAgICAgICAgdGhpcy5maWx0ZXJlZFN0cmVhbXMubWFwKGZ1bmN0aW9uIChzdHJlYW0pIHsKICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICBzdHJlYW0uc2VyaWVfbmFtZSA9IHByZWZpeCArIHN0cmVhbS5zZXJpZV9uYW1lICsgc3VmZml4OwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgYnJlYWs7CiAgICAgIH0KCiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICAgIHRoaXMucHJlZml4U3VmZml4Lm1vZGFsID0gZmFsc2U7CiAgICB9LAogICAgY29udmVydENhc2VNb2RhbDogZnVuY3Rpb24gY29udmVydENhc2VNb2RhbChzaG93LCB0eXBlKSB7CiAgICAgIHRoaXMuY29udmVydENhc2UudHlwZSA9IHR5cGU7CiAgICAgIHRoaXMuY29udmVydENhc2UubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGNoYW5nZUNhc2U6IGZ1bmN0aW9uIGNoYW5nZUNhc2UoKSB7CiAgICAgIHZhciBfdGhpczExID0gdGhpczsKCiAgICAgIHZhciBtZXRob2QgPSB0aGlzLmNvbnZlcnRDYXNlLm1ldGhvZDsKICAgICAgdmFyIGdyb3VwczsKICAgICAgdmFyIHN0cmVhbXM7CgogICAgICBpZiAocGFyc2VJbnQodGhpcy5jb252ZXJ0Q2FzZS5zZWxlY3RlZE9ubHkpID09PSAxKSB7CiAgICAgICAgZ3JvdXBzID0gdGhpcy5maWx0ZXJlZEdyb3Vwcy5maWx0ZXIoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgICByZXR1cm4gX3RoaXMxMS5hY3RpdmVHcm91cHMuaW5jbHVkZXMoZ3JvdXAuaWQpOwogICAgICAgIH0pOwogICAgICAgIHN0cmVhbXMgPSB0aGlzLmZpbHRlcmVkU3RyZWFtcy5maWx0ZXIoZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgICAgcmV0dXJuIF90aGlzMTEuYWN0aXZlU3RyZWFtcy5pbmNsdWRlcyhzdHJlYW0uaWQpOwogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIGdyb3VwcyA9IHRoaXMuZmlsdGVyZWRHcm91cHM7CiAgICAgICAgc3RyZWFtcyA9IHRoaXMuZmlsdGVyZWRTdHJlYW1zOwogICAgICB9CgogICAgICBzd2l0Y2ggKHBhcnNlSW50KHRoaXMuY29udmVydENhc2UudHlwZSkpIHsKICAgICAgICAvLyBDYXRlZ29yaWVzCiAgICAgICAgY2FzZSAxOgogICAgICAgICAgZ3JvdXBzLm1hcChmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICAgICAgc3dpdGNoIChwYXJzZUludChtZXRob2QpKSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgZ3JvdXAubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgZ3JvdXAuZ3JvdXBfbmFtZSA9IGdyb3VwLmdyb3VwX25hbWUudGl0bGVDYXNlKCk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgZ3JvdXAubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgZ3JvdXAuZ3JvdXBfbmFtZSA9IGdyb3VwLmdyb3VwX25hbWUudG9VcHBlckNhc2UoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICBncm91cC5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICBncm91cC5ncm91cF9uYW1lID0gZ3JvdXAuZ3JvdXBfbmFtZS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgLy8gU3RyZWFtcwoKICAgICAgICBjYXNlIDI6CiAgICAgICAgICBzdHJlYW1zLm1hcChmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAgICAgICAgIHN3aXRjaCAocGFyc2VJbnQobWV0aG9kKSkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGlmIChfdGhpczExLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMSkgewogICAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lID0gc3RyZWFtLnN0cmVhbV90dmdfbmFtZS50aXRsZUNhc2UoKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoX3RoaXMxMS5hY3RpdmVHcm91cFR5cGUgPT09IDIpIHsKICAgICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgc3RyZWFtLm1vdmllX25hbWUgPSBzdHJlYW0ubW92aWVfbmFtZS50aXRsZUNhc2UoKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoX3RoaXMxMS5hY3RpdmVHcm91cFR5cGUgPT09IDMpIHsKICAgICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgc3RyZWFtLnNlcmllX25hbWUgPSBzdHJlYW0uc2VyaWVfbmFtZS50aXRsZUNhc2UoKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgaWYgKF90aGlzMTEuYWN0aXZlR3JvdXBUeXBlID09PSAxKSB7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX25hbWUgPSBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lLnRvVXBwZXJDYXNlKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKF90aGlzMTEuYWN0aXZlR3JvdXBUeXBlID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5tb3ZpZV9uYW1lID0gc3RyZWFtLm1vdmllX25hbWUudG9VcHBlckNhc2UoKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoX3RoaXMxMS5hY3RpdmVHcm91cFR5cGUgPT09IDMpIHsKICAgICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgc3RyZWFtLnNlcmllX25hbWUgPSBzdHJlYW0uc2VyaWVfbmFtZS50b1VwcGVyQ2FzZSgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICBpZiAoX3RoaXMxMS5hY3RpdmVHcm91cFR5cGUgPT09IDEpIHsKICAgICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfbmFtZSA9IHN0cmVhbS5zdHJlYW1fdHZnX25hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoX3RoaXMxMS5hY3RpdmVHcm91cFR5cGUgPT09IDIpIHsKICAgICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgc3RyZWFtLm1vdmllX25hbWUgPSBzdHJlYW0ubW92aWVfbmFtZS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChfdGhpczExLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMykgewogICAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICBzdHJlYW0uc2VyaWVfbmFtZSA9IHN0cmVhbS5zZXJpZV9uYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KCiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICAgIHRoaXMuY29udmVydENhc2UubW9kYWwgPSBmYWxzZTsKICAgIH0sCiAgICBlZGl0R3JvdXBNb2RhbDogZnVuY3Rpb24gZWRpdEdyb3VwTW9kYWwoc2hvdykgewogICAgICB2YXIgX3RoaXMxMiA9IHRoaXM7CgogICAgICB2YXIgaW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgcmV0dXJuIGdyb3VwLmlkID09PSBfdGhpczEyLmFjdGl2ZUdyb3Vwc1swXTsKICAgICAgfSk7CiAgICAgIHZhciBncm91cCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2luZGV4XTsKCiAgICAgIGlmIChncm91cCkgewogICAgICAgIHRoaXMuZ3JvdXBFZGl0b3IuaWQgPSB0aGlzLmFjdGl2ZUdyb3Vwc1swXTsKICAgICAgICB0aGlzLmdyb3VwRWRpdG9yLmdyb3VwX3R5cGUgPSBncm91cC5ncm91cF90eXBlOwogICAgICAgIHRoaXMuZ3JvdXBFZGl0b3IuZ3JvdXBfbmFtZSA9IGdyb3VwLmdyb3VwX25hbWU7CiAgICAgICAgdGhpcy5ncm91cEVkaXRvci5ncm91cF9pc19oaWRkZW4gPSBncm91cC5ncm91cF9pc19oaWRkZW47CiAgICAgICAgdGhpcy5ncm91cEVkaXRvci5ncm91cF9wYXJlbnRfY29kZSA9IGdyb3VwLmdyb3VwX3BhcmVudF9jb2RlOwogICAgICAgIHRoaXMuZ3JvdXBFZGl0b3IubW9kYWwgPSBzaG93OwogICAgICB9CiAgICB9LAogICAgZWRpdFN0cmVhbU1vZGFsOiBmdW5jdGlvbiBlZGl0U3RyZWFtTW9kYWwoc2hvdykgewogICAgICB2YXIgX3RoaXMxMyA9IHRoaXM7CgogICAgICB2YXIgaW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMuZmluZEluZGV4KGZ1bmN0aW9uIChzdHJlYW0pIHsKICAgICAgICByZXR1cm4gc3RyZWFtLmlkID09PSBfdGhpczEzLmFjdGl2ZVN0cmVhbXNbMF07CiAgICAgIH0pOwogICAgICB2YXIgc3RyZWFtID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XTsKCiAgICAgIGlmIChzdHJlYW0pIHsKICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5pZCA9IHRoaXMuYWN0aXZlU3RyZWFtc1swXTsKICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1fdHZnX25hbWUgPSBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lOwogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV90dmdfaWQgPSBzdHJlYW0uc3RyZWFtX3R2Z19pZDsKICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1fdHZnX2xvZ28gPSBzdHJlYW0uc3RyZWFtX3R2Z19sb2dvOwogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV9wYXJlbnRfY29kZSA9IHN0cmVhbS5zdHJlYW1fcGFyZW50X2NvZGU7CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX3JhZGlvID0gc3RyZWFtLnN0cmVhbV9yYWRpbzsKICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1faXNfaGlkZGVuID0gc3RyZWFtLnN0cmVhbV9pc19oaWRkZW47CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc291cmNlX3N0cmVhbV91cmwgPSBzdHJlYW0uc291cmNlX3N0cmVhbV91cmw7CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX2lzX2N1c3RvbSA9IHN0cmVhbS5zdHJlYW1faXNfY3VzdG9tOwoKICAgICAgICBpZiAoc3RyZWFtLm1vdmllX25hbWUgIT09IHVuZGVmaW5lZCAmJiBzdHJlYW0ubW92aWVfeWVhciAhPT0gdW5kZWZpbmVkICYmIHN0cmVhbS50bWRiX2lkICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLm1vdmllX25hbWUgPSBzdHJlYW0ubW92aWVfbmFtZTsKICAgICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLm1vdmllX3llYXIgPSBzdHJlYW0ubW92aWVfeWVhcjsKICAgICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnRtZGJfaWQgPSBzdHJlYW0udG1kYl9pZDsKICAgICAgICB9CgogICAgICAgIGlmIChzdHJlYW0uc2VyaWVfbmFtZSAhPT0gdW5kZWZpbmVkICYmIHN0cmVhbS5zZXJpZV9zZWFzb24gIT09IHVuZGVmaW5lZCAmJiBzdHJlYW0uc2VyaWVfZXBpc29kZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zZXJpZV9uYW1lID0gc3RyZWFtLnNlcmllX25hbWU7CiAgICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zZXJpZV9zZWFzb24gPSBzdHJlYW0uc2VyaWVfc2Vhc29uOwogICAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc2VyaWVfZXBpc29kZSA9IHN0cmVhbS5zZXJpZV9lcGlzb2RlOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3IubW9kYWwgPSBzaG93OwogICAgICB9CiAgICB9LAogICAgZWRpdEdyb3VwOiBmdW5jdGlvbiBlZGl0R3JvdXAoKSB7CiAgICAgIHZhciBfdGhpczE0ID0gdGhpczsKCiAgICAgIHZhciBpbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleChmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICByZXR1cm4gZ3JvdXAuaWQgPT09IF90aGlzMTQuZ3JvdXBFZGl0b3IuaWQ7CiAgICAgIH0pOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpbmRleF0uZ3JvdXBfdHlwZSA9IHRoaXMuZ3JvdXBFZGl0b3IuZ3JvdXBfdHlwZTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaW5kZXhdLmdyb3VwX25hbWUgPSB0aGlzLmdyb3VwRWRpdG9yLmdyb3VwX25hbWU7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2luZGV4XS5ncm91cF9pc19oaWRkZW4gPSB0aGlzLmdyb3VwRWRpdG9yLmdyb3VwX2lzX2hpZGRlbjsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaW5kZXhdLmdyb3VwX3BhcmVudF9jb2RlID0gdGhpcy5ncm91cEVkaXRvci5ncm91cF9wYXJlbnRfY29kZTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaW5kZXhdLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgICAgdGhpcy5ncm91cEVkaXRvci5tb2RhbCA9IGZhbHNlOwogICAgfSwKICAgIGVkaXRTdHJlYW06IGZ1bmN0aW9uIGVkaXRTdHJlYW0oKSB7CiAgICAgIHZhciBfdGhpczE1ID0gdGhpczsKCiAgICAgIHZhciBpbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5maW5kSW5kZXgoZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgIHJldHVybiBzdHJlYW0uaWQgPT09IF90aGlzMTUuYWN0aXZlU3RyZWFtc1swXTsKICAgICAgfSk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc3RyZWFtX3R2Z19uYW1lID0gdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX3R2Z19uYW1lOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnN0cmVhbV90dmdfaWQgPSB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1fdHZnX2lkOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnN0cmVhbV90dmdfbG9nbyA9IHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV90dmdfbG9nbzsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zdHJlYW1fcGFyZW50X2NvZGUgPSB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1fcGFyZW50X2NvZGU7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc3RyZWFtX2lzX2hpZGRlbiA9IHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV9pc19oaWRkZW47CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc3RyZWFtX3JhZGlvID0gdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX3JhZGlvOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnNvdXJjZV9zdHJlYW1fdXJsID0gdGhpcy5zdHJlYW1FZGl0b3Iuc291cmNlX3N0cmVhbV91cmw7CgogICAgICBpZiAodGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5tb3ZpZV9uYW1lICE9PSB1bmRlZmluZWQgJiYgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5tb3ZpZV95ZWFyICE9PSB1bmRlZmluZWQgJiYgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS50bWRiX2lkICE9PSB1bmRlZmluZWQpIHsKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLm1vdmllX25hbWUgPSB0aGlzLnN0cmVhbUVkaXRvci5tb3ZpZV9uYW1lOwogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0ubW92aWVfeWVhciA9IHRoaXMuc3RyZWFtRWRpdG9yLm1vdmllX3llYXI7CiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS50bWRiX2lkID0gdGhpcy5zdHJlYW1FZGl0b3IudG1kYl9pZDsKICAgICAgfQoKICAgICAgaWYgKHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc2VyaWVfbmFtZSAhPT0gdW5kZWZpbmVkICYmIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc2VyaWVfc2Vhc29uICE9PSB1bmRlZmluZWQgJiYgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zZXJpZV9lcGlzb2RlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnNlcmllX25hbWUgPSB0aGlzLnN0cmVhbUVkaXRvci5zZXJpZV9uYW1lOwogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc2VyaWVfc2Vhc29uID0gdGhpcy5zdHJlYW1FZGl0b3Iuc2VyaWVfc2Vhc29uOwogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc2VyaWVfZXBpc29kZSA9IHRoaXMuc3RyZWFtRWRpdG9yLnNlcmllX2VwaXNvZGU7CiAgICAgIH0KCiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0ubW9kaWZpZWQgPSB0cnVlOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgICB0aGlzLnN0cmVhbUVkaXRvci5tb2RhbCA9IGZhbHNlOwogICAgfSwKICAgIHNvcnRHcm91cEFscGhhVXA6IGZ1bmN0aW9uIHNvcnRHcm91cEFscGhhVXAoKSB7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHJldHVybiBiLmdyb3VwX25hbWUgPiBhLmdyb3VwX25hbWUgPyAxIDogYS5ncm91cF9uYW1lID4gYi5ncm91cF9uYW1lID8gLTEgOiAwOwogICAgICB9KTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMubWFwKGZ1bmN0aW9uIChncm91cCkgewogICAgICAgIHJldHVybiBncm91cC5tb2RpZmllZCA9IHRydWU7CiAgICAgIH0pOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgfSwKICAgIHNvcnRHcm91cEFscGhhRG93bjogZnVuY3Rpb24gc29ydEdyb3VwQWxwaGFEb3duKCkgewogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3VwcyA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICByZXR1cm4gYS5ncm91cF9uYW1lID4gYi5ncm91cF9uYW1lID8gMSA6IGIuZ3JvdXBfbmFtZSA+IGEuZ3JvdXBfbmFtZSA/IC0xIDogMDsKICAgICAgfSk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLm1hcChmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICByZXR1cm4gZ3JvdXAubW9kaWZpZWQgPSB0cnVlOwogICAgICB9KTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgIH0sCiAgICBzb3J0R3JvdXBUeXBlVXA6IGZ1bmN0aW9uIHNvcnRHcm91cFR5cGVVcCgpIHsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgcmV0dXJuIGIuZ3JvdXBfdHlwZSA+IGEuZ3JvdXBfdHlwZSA/IDEgOiBhLmdyb3VwX3R5cGUgPiBiLmdyb3VwX3R5cGUgPyAtMSA6IDA7CiAgICAgIH0pOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5tYXAoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgcmV0dXJuIGdyb3VwLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgfSk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICB9LAogICAgc29ydEdyb3VwVHlwZURvd246IGZ1bmN0aW9uIHNvcnRHcm91cFR5cGVEb3duKCkgewogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3VwcyA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICByZXR1cm4gYS5ncm91cF90eXBlID4gYi5ncm91cF90eXBlID8gMSA6IGIuZ3JvdXBfdHlwZSA+IGEuZ3JvdXBfdHlwZSA/IC0xIDogMDsKICAgICAgfSk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLm1hcChmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICByZXR1cm4gZ3JvdXAubW9kaWZpZWQgPSB0cnVlOwogICAgICB9KTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgIH0sCiAgICBzb3J0U3RyZWFtQWxwaGFVcDogZnVuY3Rpb24gc29ydFN0cmVhbUFscGhhVXAoKSB7CiAgICAgIHZhciBfdGhpczE2ID0gdGhpczsKCiAgICAgIC8vRVJOU1QgSElFUgogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMuc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHN3aXRjaCAoX3RoaXMxNi5hY3RpdmVHcm91cFR5cGUpIHsKICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgcmV0dXJuIGIuc3RyZWFtX3R2Z19uYW1lID4gYS5zdHJlYW1fdHZnX25hbWUgPyAxIDogYS5zdHJlYW1fdHZnX25hbWUgPiBiLnN0cmVhbV90dmdfbmFtZSA/IC0xIDogMDsKCiAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgIHJldHVybiBiLm1vdmllX25hbWUgPiBhLm1vdmllX25hbWUgPyAxIDogYS5tb3ZpZV9uYW1lID4gYi5tb3ZpZV9uYW1lID8gLTEgOiAwOwoKICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgcmV0dXJuIGIuc2VyaWVfbmFtZSA+IGEuc2VyaWVfbmFtZSA/IDEgOiBhLnNlcmllX25hbWUgPiBiLnNlcmllX25hbWUgPyAtMSA6IDA7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLm1hcChmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAgICAgcmV0dXJuIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgIH0pOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgfSwKICAgIHNvcnRTdHJlYW1BbHBoYURvd246IGZ1bmN0aW9uIHNvcnRTdHJlYW1BbHBoYURvd24oKSB7CiAgICAgIHZhciBfdGhpczE3ID0gdGhpczsKCiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcyA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgc3dpdGNoIChfdGhpczE3LmFjdGl2ZUdyb3VwVHlwZSkgewogICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICByZXR1cm4gYS5zdHJlYW1fdHZnX25hbWUgPiBiLnN0cmVhbV90dmdfbmFtZSA/IDEgOiBiLnN0cmVhbV90dmdfbmFtZSA+IGEuc3RyZWFtX3R2Z19uYW1lID8gLTEgOiAwOwoKICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgcmV0dXJuIGEubW92aWVfbmFtZSA+IGIubW92aWVfbmFtZSA/IDEgOiBiLm1vdmllX25hbWUgPiBhLm1vdmllX25hbWUgPyAtMSA6IDA7CgogICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICByZXR1cm4gYS5zZXJpZV9uYW1lID4gYi5zZXJpZV9uYW1lID8gMSA6IGIuc2VyaWVfbmFtZSA+IGEuc2VyaWVfbmFtZSA/IC0xIDogMDsKICAgICAgICB9CiAgICAgIH0pOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubWFwKGZ1bmN0aW9uIChzdHJlYW0pIHsKICAgICAgICByZXR1cm4gc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgfSk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICB9LAogICAgc29ydFN0cmVhbUhpZGRlblVwOiBmdW5jdGlvbiBzb3J0U3RyZWFtSGlkZGVuVXAoKSB7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcyA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgcmV0dXJuIGIuc3RyZWFtX2lzX2hpZGRlbiA+IGEuc3RyZWFtX2lzX2hpZGRlbiA/IDEgOiBhLnN0cmVhbV9pc19oaWRkZW4gPiBiLnN0cmVhbV9pc19oaWRkZW4gPyAtMSA6IDA7CiAgICAgIH0pOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubWFwKGZ1bmN0aW9uIChncm91cCkgewogICAgICAgIHJldHVybiBncm91cC5tb2RpZmllZCA9IHRydWU7CiAgICAgIH0pOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgfSwKICAgIHNvcnRTdHJlYW1IaWRkZW5Eb3duOiBmdW5jdGlvbiBzb3J0U3RyZWFtSGlkZGVuRG93bigpIHsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICByZXR1cm4gYS5zdHJlYW1faXNfaGlkZGVuID4gYi5zdHJlYW1faXNfaGlkZGVuID8gMSA6IGIuc3RyZWFtX2lzX2hpZGRlbiA+IGEuc3RyZWFtX2lzX2hpZGRlbiA/IC0xIDogMDsKICAgICAgfSk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5tYXAoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgcmV0dXJuIGdyb3VwLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgfSk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICB9LAogICAgYWRkR3JvdXA6IGZ1bmN0aW9uIGFkZEdyb3VwKCkgewogICAgICB2YXIgX3RoaXMxOCA9IHRoaXM7CgogICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGh0dHBTZXJ2aWNlLnBvc3QoImVkaXRvci9hZGQtZ3JvdXAiLCB7CiAgICAgICAgcGxheWxpc3RfaWQ6IHRoaXMucGxheWxpc3RFZGl0b3IuaWQKICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgX3RoaXMxOC5pc0xvYWRpbmcgPSBmYWxzZTsKCiAgICAgICAgaWYgKHJlcy5zdGF0dXMgPT09IHRydWUgJiYgcmVzLmRhdGEpIHsKICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkgewogICAgICAgICAgICBfdGhpczE4LnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5wdXNoKHJlcy5kYXRhKTsKCiAgICAgICAgICAgIF90aGlzMTguYWN0aXZlR3JvdXAgPSBfdGhpczE4LnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tfdGhpczE4LnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5sZW5ndGggLSAxXS5pZDsKICAgICAgICAgICAgX3RoaXMxOC5hY3RpdmVHcm91cHMgPSBbX3RoaXMxOC5wbGF5bGlzdEVkaXRvci5ncm91cHNbX3RoaXMxOC5wbGF5bGlzdEVkaXRvci5ncm91cHMubGVuZ3RoIC0gMV0uaWRdOwogICAgICAgICAgICByZXNvbHZlKCk7CiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgX3RoaXMxOC5lZGl0R3JvdXBNb2RhbCh0cnVlKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzMTguaXNMb2FkaW5nID0gZmFsc2U7CgogICAgICAgIF90aGlzMTguJG5vdGlmeSgiZXJyb3IiLCBfdGhpczE4LiR0KCJwcm9maWxlLmZhaWxlZCIpLCBfdGhpczE4LiR0KCJlZGl0b3IuYWRkLWdyb3VwLWVycm9yIiksICJsYS11c2VyLXNoaWVsZCIsIHsKICAgICAgICAgIGR1cmF0aW9uOiA1MDAwLAogICAgICAgICAgcGVybWFuZW50OiBmYWxzZQogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0sCiAgICBhZGRTdHJlYW06IGZ1bmN0aW9uIGFkZFN0cmVhbSgpIHsKICAgICAgdmFyIF90aGlzMTkgPSB0aGlzOwoKICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZS5wb3N0KCJlZGl0b3IvYWRkLXN0cmVhbSIsIHsKICAgICAgICBwbGF5bGlzdF9pZDogdGhpcy5wbGF5bGlzdEVkaXRvci5pZCwKICAgICAgICBncm91cF9pZDogdGhpcy5nZXRHcm91cFdpdGhJZCh0aGlzLmFjdGl2ZUdyb3VwKS5pZCwKICAgICAgICBzdHJlYW1fdHlwZTogdGhpcy5nZXRHcm91cFdpdGhJZCh0aGlzLmFjdGl2ZUdyb3VwKS5ncm91cF90eXBlCiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgIF90aGlzMTkuaXNMb2FkaW5nID0gZmFsc2U7CgogICAgICAgIGlmIChyZXMuc3RhdHVzID09PSB0cnVlICYmIHJlcy5kYXRhKSB7CiAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgICAgICAgICAgX3RoaXMxOS5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLnVuc2hpZnQocmVzLmRhdGEpOwoKICAgICAgICAgICAgX3RoaXMxOS5hY3RpdmVTdHJlYW0gPSBfdGhpczE5LnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbX3RoaXMxOS5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aCAtIDFdLmlkOwogICAgICAgICAgICBfdGhpczE5LmFjdGl2ZVN0cmVhbXMgPSBbX3RoaXMxOS5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW190aGlzMTkucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGggLSAxXS5pZF07CiAgICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgICBfdGhpczE5LmVkaXRTdHJlYW1Nb2RhbCh0cnVlKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzMTkuaXNMb2FkaW5nID0gZmFsc2U7CgogICAgICAgIF90aGlzMTkuJG5vdGlmeSgiZXJyb3IiLCBfdGhpczE5LiR0KCJwcm9maWxlLmZhaWxlZCIpLCBfdGhpczE5LiR0KCJlZGl0b3IuYWRkLXN0cmVhbS1lcnJvciIpLCAibGEtdXNlci1zaGllbGQiLCB7CiAgICAgICAgICBkdXJhdGlvbjogNTAwMCwKICAgICAgICAgIHBlcm1hbmVudDogZmFsc2UKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LAogICAgbG9hZFN0cmVhbXM6IGZ1bmN0aW9uIGxvYWRTdHJlYW1zKCkgewogICAgICB2YXIgX3RoaXMyMCA9IHRoaXM7CgogICAgICB0aGlzLmFjdGl2ZVN0cmVhbSA9IC0xOwogICAgICB0aGlzLmFjdGl2ZVN0cmVhbXMgPSBbXTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zID0gW107CiAgICAgIHZhciBpbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleChmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICByZXR1cm4gZ3JvdXAuaWQgPT09IF90aGlzMjAuYWN0aXZlR3JvdXA7CiAgICAgIH0pOwogICAgICB2YXIgZ3JvdXAgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpbmRleF07CiAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UuZ2V0KCJlZGl0b3Ivc3RyZWFtcy8iLmNvbmNhdCh0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLCAiLyIpLmNvbmNhdChncm91cC5pZCwgIi8iKS5jb25jYXQoZ3JvdXAuZ3JvdXBfdHlwZSkpLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgIGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wID0gMDsKICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wID0gMDsKCiAgICAgICAgaWYgKHJlcy5zdGF0dXMgPT09IHRydWUpIHsKICAgICAgICAgIHZhciBzdHJlYW1zID0gcmVzLmRhdGEubWFwKGZ1bmN0aW9uIChzdHJlYW0pIHsKICAgICAgICAgICAgdmFyIHN0ciA9IE9iamVjdC5hc3NpZ24oe30sIHN0cmVhbSk7CiAgICAgICAgICAgIHN0ci5zb3VyY2Vfc3RyZWFtX3R2Z19uYW1lID0gc3RyZWFtLnN0cmVhbV90dmdfbmFtZTsKICAgICAgICAgICAgc3RyLnNvdXJjZV9zdHJlYW1fdHZnX2lkID0gc3RyZWFtLnN0cmVhbV90dmdfaWQ7CiAgICAgICAgICAgIHN0ci5zb3VyY2Vfc3RyZWFtX3R2Z19sb2dvID0gc3RyZWFtLnN0cmVhbV90dmdfbG9nbzsKICAgICAgICAgICAgc3RyLnNvdXJjZV9zdHJlYW1fdHZnX2Nobm8gPSBzdHJlYW0uc3RyZWFtX3R2Z19jaG5vOwogICAgICAgICAgICBzdHIuc291cmNlX3N0cmVhbV90dmdfc2hpZnQgPSBzdHJlYW0uc3RyZWFtX3R2Z19zaGlmdDsKICAgICAgICAgICAgc3RyLnNvdXJjZV9zdHJlYW1fcGFyZW50X2NvZGUgPSBzdHJlYW0uc3RyZWFtX3BhcmVudF9jb2RlOwogICAgICAgICAgICBzdHIuc291cmNlX3N0cmVhbV9hdWRpb190cmFjayA9IHN0cmVhbS5zdHJlYW1fYXVkaW9fdHJhY2s7CiAgICAgICAgICAgIHN0ci5zb3VyY2Vfc3RyZWFtX2FzcGVjdF9yYXRpbyA9IHN0cmVhbS5zdHJlYW1fYXNwZWN0X3JhdGlvOwogICAgICAgICAgICBzdHIuc291cmNlX3N0cmVhbV9yYWRpbyA9IHN0cmVhbS5zdHJlYW1fcmFkaW87CiAgICAgICAgICAgIHN0ci5zb3VyY2Vfc3RyZWFtX29yZGVyID0gc3RyZWFtLnN0cmVhbV9vcmRlcjsKICAgICAgICAgICAgc3RyLnNvdXJjZV9zdHJlYW1faXNfaGlkZGVuID0gc3RyZWFtLnN0cmVhbV9pc19oaWRkZW47CiAgICAgICAgICAgIHN0ci5tb2RpZmllZCA9IGZhbHNlOwogICAgICAgICAgICBzdHIuc3RyZWFtX2lzX3JlbW92ZWQgPSAwOwoKICAgICAgICAgICAgaWYgKGdyb3VwLmdyb3VwX3R5cGUgPT0gMikgewogICAgICAgICAgICAgIGlmIChzdHIubW92aWVfbmFtZSA9PSAiIikgewogICAgICAgICAgICAgICAgc3RyLm1vdmllX25hbWUgPSBzdHIuc3RyZWFtX3R2Z19uYW1lOwogICAgICAgICAgICAgICAgc3RyLnNvdXJjZV9tb3ZpZV9uYW1lID0gc3RyLnN0cmVhbV90dmdfbmFtZTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgc3RyLnNvdXJjZV9tb3ZpZV9uYW1lID0gc3RyZWFtLm1vdmllX25hbWU7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBzdHIuc291cmNlX21vdmllX3llYXIgPSBzdHJlYW0ubW92aWVfeWVhcjsKICAgICAgICAgICAgICBzdHIuc291cmNlX3RtZGJfaWQgPSBzdHJlYW0udG1kYl9pZDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGdyb3VwLmdyb3VwX3R5cGUgPT0gMykgewogICAgICAgICAgICAgIGlmIChzdHIuc2VyaWVfbmFtZSA9PSAiIikgewogICAgICAgICAgICAgICAgc3RyLnNlcmllX25hbWUgPSBzdHIuc3RyZWFtX3R2Z19uYW1lOwogICAgICAgICAgICAgICAgc3RyLnNvdXJjZV9zZXJpZV9uYW1lID0gc3RyLnN0cmVhbV90dmdfbmFtZTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgc3RyLnNvdXJjZV9zZXJpZV9uYW1lID0gc3RyZWFtLnNlcmllX25hbWU7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBzdHIuc291cmNlX3NlcmllX3NlYXNvbiA9IHN0cmVhbS5zZXJpZV9zZWFzb247CiAgICAgICAgICAgICAgc3RyLnNvdXJjZV9zZXJpZV9lcGlzb2RlID0gc3RyZWFtLnNlcmllX2VwaXNvZGU7CiAgICAgICAgICAgICAgc3RyLnNvdXJjZV90bWRiX2lkID0gc3RyZWFtLnRtZGJfaWQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBzdHI7CiAgICAgICAgICB9KTsKICAgICAgICAgIHN0cmVhbXMuc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgICByZXR1cm4gYS5zb3VyY2Vfc3RyZWFtX29yZGVyID4gYi5zb3VyY2Vfc3RyZWFtX29yZGVyID8gMSA6IGIuc291cmNlX3N0cmVhbV9vcmRlciA+IGEuc291cmNlX3N0cmVhbV9vcmRlciA/IC0xIDogMDsKICAgICAgICAgIH0pOwogICAgICAgICAgX3RoaXMyMC5wbGF5bGlzdEVkaXRvci5zdHJlYW1zID0gc3RyZWFtczsKICAgICAgICAgIF90aGlzMjAuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIF90aGlzMjAuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMyMC5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfSk7CiAgICB9LAogICAgbW92ZVRvU2VsZWN0ZWRHcm91cDogZnVuY3Rpb24gbW92ZVRvU2VsZWN0ZWRHcm91cCgpIHsKICAgICAgdmFyIF90aGlzMjEgPSB0aGlzOwoKICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlOwogICAgICB2YXIgc3RyZWFtcyA9IHRoaXMuYWN0aXZlU3RyZWFtcy5qb2luKCk7CiAgICAgIHZhciBpbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleChmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICByZXR1cm4gZ3JvdXAuaWQgPT0gX3RoaXMyMS5hY3RpdmVHcm91cDsKICAgICAgfSk7CiAgICAgIGh0dHBTZXJ2aWNlLnBvc3QoImVkaXRvci9tb3ZlLXRvLWdyb3VwLyIuY29uY2F0KHRoaXMuYWN0aXZlR3JvdXBUeXBlKSwgewogICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgIHN0cmVhbXM6IHN0cmVhbXMsCiAgICAgICAgZ3JvdXBfaWQ6IHRoaXMuYWN0aXZlR3JvdXBzWzBdCiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgIF90aGlzMjEuaXNMb2FkaW5nID0gZmFsc2U7CgogICAgICAgIGlmIChyZXMuc3RhdHVzICYmIHJlcy5kYXRhKSB7CiAgICAgICAgICBfdGhpczIxLmxvYWRQbGF5bGlzdChfdGhpczIxLnBsYXlsaXN0RWRpdG9yLmlkLCBpbmRleCk7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMyMS5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfSk7CiAgICB9LAogICAgc2F2ZUNoYW5nZXNNb2RhbDogZnVuY3Rpb24gc2F2ZUNoYW5nZXNNb2RhbChzaG93KSB7CiAgICAgIHZhciBzYXZlID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiBmYWxzZTsKICAgICAgdGhpcy5zYXZlQ2hhbmdlcy5tb2RhbCA9IHNob3c7CgogICAgICBpZiAoc2F2ZSkgewogICAgICAgIHRoaXMuZG9TYXZlKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5sb2FkU3RyZWFtcygpOwogICAgICB9CiAgICB9LAogICAgcmFkaW9Ccm93c2VyTW9kYWw6IGZ1bmN0aW9uIHJhZGlvQnJvd3Nlck1vZGFsKHNob3cpIHsKICAgICAgdmFyIF90aGlzMjIgPSB0aGlzOwoKICAgICAgdmFyIHNhdmUgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IGZhbHNlOwoKICAgICAgaWYgKHNob3cpIHsKICAgICAgICB0aGlzLnJhZGlvQnJvd3Nlci5zZWFyY2ggPSAiIjsKICAgICAgICB0aGlzLnJhZGlvQnJvd3Nlci5yZXN1bHRzID0gW107CiAgICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuYWN0aXZlID0gW107CiAgICAgIH0KCiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlOwogICAgICAgIHZhciBncm91cEluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KGZ1bmN0aW9uIChncm91cCkgewogICAgICAgICAgcmV0dXJuIGdyb3VwLmlkID09IF90aGlzMjIuYWN0aXZlR3JvdXA7CiAgICAgICAgfSk7CiAgICAgICAgdmFyIG9yZGVyID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsKICAgICAgICB2YXIgc3RyZWFtcyA9IHRoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZS5tYXAoZnVuY3Rpb24gKGluZGV4KSB7CiAgICAgICAgICB2YXIgcmFkaW8gPSBfdGhpczIyLnJhZGlvQnJvd3Nlci5yZXN1bHRzW2luZGV4XTsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHNvdXJjZV9zdHJlYW1fdXJsOiByYWRpby51cmwsCiAgICAgICAgICAgIHN0cmVhbV90dmdfbmFtZTogcmFkaW8ubmFtZSwKICAgICAgICAgICAgc3RyZWFtX3R2Z19pZDogIiIsCiAgICAgICAgICAgIHN0cmVhbV90dmdfbG9nbzogcmFkaW8uZmF2aWNvbiwKICAgICAgICAgICAgc3RyZWFtX3JhZGlvOiB0cnVlLAogICAgICAgICAgICBzdHJlYW1fb3JkZXI6IG9yZGVyKysKICAgICAgICAgIH07CiAgICAgICAgfSk7CiAgICAgICAgaHR0cFNlcnZpY2UucG9zdCgiZWRpdG9yL2FkZC1zdHJlYW1zLyIuY29uY2F0KHRoaXMuYWN0aXZlR3JvdXBUeXBlKSwgewogICAgICAgICAgcGxheWxpc3RfaWQ6IHRoaXMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICBncm91cF9pZDogdGhpcy5nZXRHcm91cFdpdGhJZCh0aGlzLmFjdGl2ZUdyb3VwKS5pZCwKICAgICAgICAgIHN0cmVhbXM6IHN0cmVhbXMKICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICAgIF90aGlzMjIuaXNMb2FkaW5nID0gZmFsc2U7CgogICAgICAgICAgaWYgKHJlcy5zdGF0dXMpIHsKICAgICAgICAgICAgX3RoaXMyMi5sb2FkUGxheWxpc3QoX3RoaXMyMi5wbGF5bGlzdEVkaXRvci5pZCwgZ3JvdXBJbmRleCk7CiAgICAgICAgICB9CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkgewogICAgICAgICAgX3RoaXMyMi5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGZpbmRSYWRpb2Jyb3dzZXI6IGZ1bmN0aW9uIGZpbmRSYWRpb2Jyb3dzZXIoc2VhcmNoKSB7CiAgICAgIHZhciBfdGhpczIzID0gdGhpczsKCiAgICAgIGlmIChzZWFyY2gubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIucmVzdWx0cyA9IFtdOwogICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZSA9IFtdOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLmlzTG9hZGluZyA9IHRydWU7CiAgICAgICAgaHR0cFNlcnZpY2UucG9zdCgiZWRpdG9yL2ZpbmQtcmFkaW9icm93c2VyIiwgewogICAgICAgICAgc2VhcmNoOiBzZWFyY2gKICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICAgIF90aGlzMjMucmFkaW9Ccm93c2VyLmFjdGl2ZSA9IFtdOwoKICAgICAgICAgIGlmIChyZXMuc3RhdHVzKSB7CiAgICAgICAgICAgIF90aGlzMjMucmFkaW9Ccm93c2VyLnJlc3VsdHMgPSByZXMuZGF0YTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF90aGlzMjMucmFkaW9Ccm93c2VyLnJlc3VsdHMgPSBbXTsKICAgICAgICAgIH0KCiAgICAgICAgICBfdGhpczIzLnJhZGlvQnJvd3Nlci5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBfdGhpczIzLnJhZGlvQnJvd3Nlci5hY3RpdmUgPSBbXTsKICAgICAgICAgIF90aGlzMjMucmFkaW9Ccm93c2VyLnJlc3VsdHMgPSBbXTsKICAgICAgICAgIF90aGlzMjMucmFkaW9Ccm93c2VyLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgc291bmRjbG91ZE1vZGFsOiBmdW5jdGlvbiBzb3VuZGNsb3VkTW9kYWwoc2hvdykgewogICAgICB2YXIgX3RoaXMyNCA9IHRoaXM7CgogICAgICB2YXIgc2F2ZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogZmFsc2U7CgogICAgICBpZiAoc2hvdykgewogICAgICAgIHRoaXMuc291bmRjbG91ZC51cmwgPSAiIjsKICAgICAgICB0aGlzLnNvdW5kY2xvdWQudHJhY2sgPSBudWxsOwogICAgICB9CgogICAgICBpZiAoc2F2ZSkgewogICAgICAgIGlmICh0aGlzLnNvdW5kY2xvdWQudHJhY2spIHsKICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgIHZhciBncm91cEluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KGZ1bmN0aW9uIChncm91cCkgewogICAgICAgICAgICByZXR1cm4gZ3JvdXAuaWQgPT0gX3RoaXMyNC5hY3RpdmVHcm91cDsKICAgICAgICAgIH0pOwogICAgICAgICAgdmFyIG9yZGVyID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsKICAgICAgICAgIHZhciBzdHJlYW1zID0gW3sKICAgICAgICAgICAgc291cmNlX3N0cmVhbV91cmw6IHRoaXMuc291bmRjbG91ZC51cmwsCiAgICAgICAgICAgIHN0cmVhbV90dmdfbmFtZTogdGhpcy5zb3VuZGNsb3VkLnRyYWNrLnRpdGxlLAogICAgICAgICAgICBzdHJlYW1fdHZnX2lkOiAiIiwKICAgICAgICAgICAgc3RyZWFtX3R2Z19sb2dvOiB0aGlzLnNvdW5kY2xvdWQudHJhY2suYXJ0d29ya191cmwucmVwbGFjZSgibGFyZ2UuanBnIiwgInQ1MDB4NTAwLmpwZyIpLAogICAgICAgICAgICBzdHJlYW1fcmFkaW86IHRydWUsCiAgICAgICAgICAgIHN0cmVhbV9vcmRlcjogb3JkZXIrKwogICAgICAgICAgfV07CiAgICAgICAgICBodHRwU2VydmljZS5wb3N0KCJlZGl0b3IvYWRkLXN0cmVhbXMvIi5jb25jYXQodGhpcy5hY3RpdmVHcm91cFR5cGUpLCB7CiAgICAgICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgICBncm91cF9pZDogdGhpcy5nZXRHcm91cFdpdGhJZCh0aGlzLmFjdGl2ZUdyb3VwKS5pZCwKICAgICAgICAgICAgc3RyZWFtczogc3RyZWFtcwogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICAgIF90aGlzMjQuaXNMb2FkaW5nID0gZmFsc2U7CgogICAgICAgICAgICBpZiAocmVzLnN0YXR1cykgewogICAgICAgICAgICAgIF90aGlzMjQubG9hZFBsYXlsaXN0KF90aGlzMjQucGxheWxpc3RFZGl0b3IuaWQsIGdyb3VwSW5kZXgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIF90aGlzMjQuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuc291bmRjbG91ZC5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgZ2V0U291bmRjbG91ZFRyYWNrOiBmdW5jdGlvbiBnZXRTb3VuZGNsb3VkVHJhY2sodXJsLCBjbGllbnRfaWQpIHsKICAgICAgdmFyIF90aGlzMjUgPSB0aGlzOwoKICAgICAgaWYgKHVybC5sZW5ndGggPT09IDAgfHwgIS9zb3VuZGNsb3VkXC5jb20vLnRlc3QodXJsKSkgewogICAgICAgIHRoaXMuc291bmRjbG91ZC51cmwgPSAiIjsKICAgICAgICB0aGlzLnNvdW5kY2xvdWQudHJhY2sgPSBudWxsOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc291bmRjbG91ZC5pc0xvYWRpbmcgPSB0cnVlOwogICAgICAgIGh0dHBTZXJ2aWNlLnBvc3QoImVkaXRvci9zb3VuZGNsb3VkLXRyYWNrIiwgewogICAgICAgICAgdXJsOiB1cmwsCiAgICAgICAgICBjbGllbnRfaWQ6IGNsaWVudF9pZAogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgICAgaWYgKHJlcy5zdGF0dXMgJiYgT2JqZWN0LmtleXMocmVzLmRhdGEpLmxlbmd0aCkgewogICAgICAgICAgICBfdGhpczI1LnNvdW5kY2xvdWQudHJhY2sgPSByZXMuZGF0YTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF90aGlzMjUuc291bmRjbG91ZC50cmFjayA9IG51bGw7CiAgICAgICAgICB9CgogICAgICAgICAgX3RoaXMyNS5zb3VuZGNsb3VkLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIF90aGlzMjUuc291bmRjbG91ZC50cmFjayA9IG51bGw7CiAgICAgICAgICBfdGhpczI1LnNvdW5kY2xvdWQuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICB5b3V0dWJlTW9kYWw6IGZ1bmN0aW9uIHlvdXR1YmVNb2RhbChzaG93KSB7CiAgICAgIHZhciBfdGhpczI2ID0gdGhpczsKCiAgICAgIHZhciBzYXZlID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiBmYWxzZTsKCiAgICAgIGlmIChzaG93KSB7CiAgICAgICAgdGhpcy55b3V0dWJlLnVybCA9ICIiOwogICAgICAgIHRoaXMueW91dHViZS52aWRlbyA9IG51bGw7CiAgICAgICAgdGhpcy55b3V0dWJlLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9CgogICAgICBpZiAoc2F2ZSkgewogICAgICAgIGlmICh0aGlzLnlvdXR1YmUudmlkZW8pIHsKICAgICAgICAgIHRoaXMueW91dHViZS5pc0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgdmFyIGdyb3VwSW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgICAgIHJldHVybiBncm91cC5pZCA9PSBfdGhpczI2LmFjdGl2ZUdyb3VwOwogICAgICAgICAgfSk7CiAgICAgICAgICB2YXIgb3JkZXIgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOwogICAgICAgICAgdmFyIHN0cmVhbXMgPSBbewogICAgICAgICAgICBzb3VyY2Vfc3RyZWFtX3VybDogdGhpcy55b3V0dWJlLnVybCwKICAgICAgICAgICAgc3RyZWFtX3R2Z19uYW1lOiB0aGlzLnlvdXR1YmUudmlkZW8udmlkZW9EZXRhaWxzLnRpdGxlLAogICAgICAgICAgICBzdHJlYW1fdHZnX2lkOiAiIiwKICAgICAgICAgICAgc3RyZWFtX3R2Z19sb2dvOiAiaHR0cDovL2kueXRpbWcuY29tL3ZpLyIuY29uY2F0KHRoaXMueW91dHViZS52aWRlb0lkLCAiL21heHJlc2RlZmF1bHQuanBnIiksCiAgICAgICAgICAgIHN0cmVhbV9vcmRlcjogb3JkZXIrKwogICAgICAgICAgfV07CiAgICAgICAgICBodHRwU2VydmljZS5wb3N0KCJlZGl0b3IvYWRkLXN0cmVhbXMvIi5jb25jYXQodGhpcy5hY3RpdmVHcm91cFR5cGUpLCB7CiAgICAgICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgICBncm91cF9pZDogdGhpcy5nZXRHcm91cFdpdGhJZCh0aGlzLmFjdGl2ZUdyb3VwKS5pZCwKICAgICAgICAgICAgc3RyZWFtczogc3RyZWFtcwogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICAgIF90aGlzMjYueW91dHViZS5pc0xvYWRpbmcgPSBmYWxzZTsKCiAgICAgICAgICAgIGlmIChyZXMuc3RhdHVzKSB7CiAgICAgICAgICAgICAgX3RoaXMyNi5sb2FkUGxheWxpc3QoX3RoaXMyNi5wbGF5bGlzdEVkaXRvci5pZCwgZ3JvdXBJbmRleCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgX3RoaXMyNi55b3V0dWJlLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLnlvdXR1YmUubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGdldFlvdXR1YmVQYWdlOiBmdW5jdGlvbiBnZXRZb3V0dWJlUGFnZSh2aWRlb0lkKSB7CiAgICAgIHZhciBfdGhpczI3ID0gdGhpczsKCiAgICAgIHRoaXMueW91dHViZS5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZS5wb3N0KCJlZGl0b3IveW91dHViZS12aWRlbyIsIHsKICAgICAgICB2aWRlb19pZDogdmlkZW9JZAogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICBpZiAocmVzLnN0YXR1cyAmJiBPYmplY3Qua2V5cyhyZXMuZGF0YSkubGVuZ3RoKSB7CiAgICAgICAgICBfdGhpczI3LnlvdXR1YmUudmlkZW8gPSByZXMuZGF0YTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgX3RoaXMyNy55b3V0dWJlLnZpZGVvID0gbnVsbDsKICAgICAgICB9CgogICAgICAgIF90aGlzMjcueW91dHViZS5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzMjcueW91dHViZS52aWRlbyA9IG51bGw7CiAgICAgICAgX3RoaXMyNy55b3V0dWJlLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9KTsKICAgIH0sCiAgICB2aW1lb01vZGFsOiBmdW5jdGlvbiB2aW1lb01vZGFsKHNob3cpIHsKICAgICAgdmFyIF90aGlzMjggPSB0aGlzOwoKICAgICAgdmFyIHNhdmUgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IGZhbHNlOwoKICAgICAgaWYgKHNob3cpIHsKICAgICAgICB0aGlzLnZpbWVvLnVybCA9ICIiOwogICAgICAgIHRoaXMudmltZW8udmlkZW8gPSBudWxsOwogICAgICAgIHRoaXMudmltZW8uaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgaWYgKHRoaXMudmltZW8udmlkZW8pIHsKICAgICAgICAgIHRoaXMudmltZW8uaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgIHZhciBncm91cEluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KGZ1bmN0aW9uIChncm91cCkgewogICAgICAgICAgICByZXR1cm4gZ3JvdXAuaWQgPT0gX3RoaXMyOC5hY3RpdmVHcm91cDsKICAgICAgICAgIH0pOwogICAgICAgICAgdmFyIG9yZGVyID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsKICAgICAgICAgIHZhciBzdHJlYW1zID0gW3sKICAgICAgICAgICAgc291cmNlX3N0cmVhbV91cmw6IHRoaXMudmltZW8udXJsLAogICAgICAgICAgICBzdHJlYW1fdHZnX25hbWU6IHRoaXMudmltZW8udmlkZW8udmlkZW8udGl0bGUsCiAgICAgICAgICAgIHN0cmVhbV90dmdfaWQ6ICIiLAogICAgICAgICAgICBzdHJlYW1fdHZnX2xvZ286IHRoaXMudmltZW8udmlkZW8udmlkZW8udGh1bWJzLmJhc2UsCiAgICAgICAgICAgIHN0cmVhbV9vcmRlcjogb3JkZXIrKwogICAgICAgICAgfV07CiAgICAgICAgICBodHRwU2VydmljZS5wb3N0KCJlZGl0b3IvYWRkLXN0cmVhbXMvIi5jb25jYXQodGhpcy5hY3RpdmVHcm91cFR5cGUpLCB7CiAgICAgICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgICBncm91cF9pZDogdGhpcy5nZXRHcm91cFdpdGhJZCh0aGlzLmFjdGl2ZUdyb3VwKS5pZCwKICAgICAgICAgICAgc3RyZWFtczogc3RyZWFtcwogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICAgIF90aGlzMjgudmltZW8uaXNMb2FkaW5nID0gZmFsc2U7CgogICAgICAgICAgICBpZiAocmVzLnN0YXR1cykgewogICAgICAgICAgICAgIF90aGlzMjgubG9hZFBsYXlsaXN0KF90aGlzMjgucGxheWxpc3RFZGl0b3IuaWQsIGdyb3VwSW5kZXgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIF90aGlzMjgudmltZW8uaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMudmltZW8ubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGdldFZpbWVvQ29uZmlnOiBmdW5jdGlvbiBnZXRWaW1lb0NvbmZpZyh2aWRlb0lkKSB7CiAgICAgIHZhciBfdGhpczI5ID0gdGhpczsKCiAgICAgIHRoaXMudmltZW8uaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UucG9zdCgiZWRpdG9yL3ZpbWVvLXZpZGVvIiwgewogICAgICAgIHZpZGVvX2lkOiB2aWRlb0lkCiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgIF90aGlzMjkudmltZW8udmlkZW8gPSByZXMuZGF0YTsKICAgICAgICBfdGhpczI5LnZpbWVvLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9KTsKICAgIH0sCiAgICBkYWlseW1vdGlvbk1vZGFsOiBmdW5jdGlvbiBkYWlseW1vdGlvbk1vZGFsKHNob3cpIHsKICAgICAgdmFyIF90aGlzMzAgPSB0aGlzOwoKICAgICAgdmFyIHNhdmUgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IGZhbHNlOwoKICAgICAgaWYgKHNob3cpIHsKICAgICAgICB0aGlzLmRhaWx5bW90aW9uLnVybCA9ICIiOwogICAgICAgIHRoaXMuZGFpbHltb3Rpb24udmlkZW8gPSBudWxsOwogICAgICAgIHRoaXMuZGFpbHltb3Rpb24uaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgaWYgKHRoaXMuZGFpbHltb3Rpb24udmlkZW8pIHsKICAgICAgICAgIHRoaXMuZGFpbHltb3Rpb24uaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgIHZhciBncm91cEluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KGZ1bmN0aW9uIChncm91cCkgewogICAgICAgICAgICByZXR1cm4gZ3JvdXAuaWQgPT0gX3RoaXMzMC5hY3RpdmVHcm91cDsKICAgICAgICAgIH0pOwogICAgICAgICAgdmFyIG9yZGVyID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsKICAgICAgICAgIHZhciBzdHJlYW1zID0gW3sKICAgICAgICAgICAgc291cmNlX3N0cmVhbV91cmw6IHRoaXMuZGFpbHltb3Rpb24udXJsLAogICAgICAgICAgICBzdHJlYW1fdHZnX25hbWU6IHRoaXMuZGFpbHltb3Rpb24udmlkZW8udGl0bGUsCiAgICAgICAgICAgIHN0cmVhbV90dmdfaWQ6ICIiLAogICAgICAgICAgICBzdHJlYW1fdHZnX2xvZ286IHRoaXMuZGFpbHltb3Rpb24udmlkZW8udGh1bWJuYWlsXzEwODBfdXJsLAogICAgICAgICAgICBzdHJlYW1fb3JkZXI6IG9yZGVyKysKICAgICAgICAgIH1dOwogICAgICAgICAgaHR0cFNlcnZpY2UucG9zdCgiZWRpdG9yL2FkZC1zdHJlYW1zLyIuY29uY2F0KHRoaXMuYWN0aXZlR3JvdXBUeXBlKSwgewogICAgICAgICAgICBwbGF5bGlzdF9pZDogdGhpcy5wbGF5bGlzdEVkaXRvci5pZCwKICAgICAgICAgICAgZ3JvdXBfaWQ6IHRoaXMuZ2V0R3JvdXBXaXRoSWQodGhpcy5hY3RpdmVHcm91cCkuaWQsCiAgICAgICAgICAgIHN0cmVhbXM6IHN0cmVhbXMKICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgICAgICBfdGhpczMwLmRhaWx5bW90aW9uLmlzTG9hZGluZyA9IGZhbHNlOwoKICAgICAgICAgICAgaWYgKHJlcy5zdGF0dXMpIHsKICAgICAgICAgICAgICBfdGhpczMwLmxvYWRQbGF5bGlzdChfdGhpczMwLnBsYXlsaXN0RWRpdG9yLmlkLCBncm91cEluZGV4KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkgewogICAgICAgICAgICBfdGhpczMwLmRhaWx5bW90aW9uLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmRhaWx5bW90aW9uLm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBnZXREYWlseW1vdGlvbkNvbmZpZzogZnVuY3Rpb24gZ2V0RGFpbHltb3Rpb25Db25maWcodmlkZW9JZCkgewogICAgICB2YXIgX3RoaXMzMSA9IHRoaXM7CgogICAgICB0aGlzLmRhaWx5bW90aW9uLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGh0dHBTZXJ2aWNlLnBvc3QoImVkaXRvci9kYWlseW1vdGlvbi12aWRlbyIsIHsKICAgICAgICB2aWRlb19pZDogdmlkZW9JZAogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICBfdGhpczMxLmRhaWx5bW90aW9uLnZpZGVvID0gcmVzLmRhdGE7CiAgICAgICAgX3RoaXMzMS5kYWlseW1vdGlvbi5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfSk7CiAgICB9LAogICAgdGVkVGFsa3NNb2RhbDogZnVuY3Rpb24gdGVkVGFsa3NNb2RhbChzaG93KSB7CiAgICAgIHZhciBfdGhpczMyID0gdGhpczsKCiAgICAgIHZhciBzYXZlID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiBmYWxzZTsKCiAgICAgIGlmIChzaG93KSB7CiAgICAgICAgdGhpcy50ZWRUYWxrcy51cmwgPSAiIjsKICAgICAgICB0aGlzLnRlZFRhbGtzLnZpZGVvID0gbnVsbDsKICAgICAgICB0aGlzLnRlZFRhbGtzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9CgogICAgICBpZiAoc2F2ZSkgewogICAgICAgIGlmICh0aGlzLnRlZFRhbGtzLnZpZGVvKSB7CiAgICAgICAgICB0aGlzLnRlZFRhbGtzLmlzTG9hZGluZyA9IHRydWU7CiAgICAgICAgICB2YXIgZ3JvdXBJbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleChmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICAgICAgcmV0dXJuIGdyb3VwLmlkID09IF90aGlzMzIuYWN0aXZlR3JvdXA7CiAgICAgICAgICB9KTsKICAgICAgICAgIHZhciBvcmRlciA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7CiAgICAgICAgICB2YXIgc3RyZWFtcyA9IFt7CiAgICAgICAgICAgIHNvdXJjZV9zdHJlYW1fdXJsOiB0aGlzLnRlZFRhbGtzLnVybCwKICAgICAgICAgICAgc3RyZWFtX3R2Z19uYW1lOiB0aGlzLnRlZFRhbGtzLnZpZGVvLnRpdGxlLAogICAgICAgICAgICBzdHJlYW1fdHZnX2lkOiAiIiwKICAgICAgICAgICAgc3RyZWFtX3R2Z19sb2dvOiB0aGlzLnRlZFRhbGtzLnZpZGVvLmhlcm8sCiAgICAgICAgICAgIHN0cmVhbV9vcmRlcjogb3JkZXIrKwogICAgICAgICAgfV07CiAgICAgICAgICBodHRwU2VydmljZS5wb3N0KCJlZGl0b3IvYWRkLXN0cmVhbXMvIi5jb25jYXQodGhpcy5hY3RpdmVHcm91cFR5cGUpLCB7CiAgICAgICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgICBncm91cF9pZDogdGhpcy5nZXRHcm91cFdpdGhJZCh0aGlzLmFjdGl2ZUdyb3VwKS5pZCwKICAgICAgICAgICAgc3RyZWFtczogc3RyZWFtcwogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICAgIF90aGlzMzIudGVkVGFsa3MuaXNMb2FkaW5nID0gZmFsc2U7CgogICAgICAgICAgICBpZiAocmVzLnN0YXR1cykgewogICAgICAgICAgICAgIF90aGlzMzIubG9hZFBsYXlsaXN0KF90aGlzMzIucGxheWxpc3RFZGl0b3IuaWQsIGdyb3VwSW5kZXgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIF90aGlzMzIudGVkVGFsa3MuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMudGVkVGFsa3MubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGdldFRlZFRhbGtzQ29uZmlnOiBmdW5jdGlvbiBnZXRUZWRUYWxrc0NvbmZpZyh1cmwpIHsKICAgICAgdmFyIF90aGlzMzMgPSB0aGlzOwoKICAgICAgdGhpcy50ZWRUYWxrcy5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZS5wb3N0KCJlZGl0b3IvdGVkLXRhbGtzLXZpZGVvIiwgewogICAgICAgIHVybDogdXJsCiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgIF90aGlzMzMudGVkVGFsa3MudmlkZW8gPSByZXMuZGF0YS50YWxrcy5sZW5ndGggPyByZXMuZGF0YS50YWxrc1swXSA6IG51bGw7CiAgICAgICAgX3RoaXMzMy50ZWRUYWxrcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfSk7CiAgICB9LAogICAgeGhhbXN0ZXJNb2RhbDogZnVuY3Rpb24geGhhbXN0ZXJNb2RhbChzaG93KSB7CiAgICAgIHZhciBfdGhpczM0ID0gdGhpczsKCiAgICAgIHZhciBzYXZlID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiBmYWxzZTsKCiAgICAgIGlmIChzaG93KSB7CiAgICAgICAgdGhpcy54aGFtc3Rlci51cmwgPSAiIjsKICAgICAgICB0aGlzLnhoYW1zdGVyLnZpZGVvID0gbnVsbDsKICAgICAgICB0aGlzLnhoYW1zdGVyLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9CgogICAgICBpZiAoc2F2ZSkgewogICAgICAgIGlmICh0aGlzLnhoYW1zdGVyLnZpZGVvKSB7CiAgICAgICAgICB0aGlzLnhoYW1zdGVyLmlzTG9hZGluZyA9IHRydWU7CiAgICAgICAgICB2YXIgZ3JvdXBJbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleChmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICAgICAgcmV0dXJuIGdyb3VwLmlkID09IF90aGlzMzQuYWN0aXZlR3JvdXA7CiAgICAgICAgICB9KTsKICAgICAgICAgIHZhciBvcmRlciA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7CiAgICAgICAgICB2YXIgc3RyZWFtcyA9IFt7CiAgICAgICAgICAgIHNvdXJjZV9zdHJlYW1fdXJsOiB0aGlzLnhoYW1zdGVyLnVybCwKICAgICAgICAgICAgc3RyZWFtX3R2Z19uYW1lOiB0aGlzLnhoYW1zdGVyLnZpZGVvLnZpZGVvRW50aXR5LnRpdGxlLAogICAgICAgICAgICBzdHJlYW1fdHZnX2lkOiAiIiwKICAgICAgICAgICAgc3RyZWFtX3R2Z19sb2dvOiB0aGlzLnhoYW1zdGVyLnZpZGVvLnZpZGVvRW50aXR5LnRodW1iQmlnLAogICAgICAgICAgICBzdHJlYW1fb3JkZXI6IG9yZGVyKysKICAgICAgICAgIH1dOwogICAgICAgICAgaHR0cFNlcnZpY2UucG9zdCgiZWRpdG9yL2FkZC1zdHJlYW1zLyIuY29uY2F0KHRoaXMuYWN0aXZlR3JvdXBUeXBlKSwgewogICAgICAgICAgICBwbGF5bGlzdF9pZDogdGhpcy5wbGF5bGlzdEVkaXRvci5pZCwKICAgICAgICAgICAgZ3JvdXBfaWQ6IHRoaXMuZ2V0R3JvdXBXaXRoSWQodGhpcy5hY3RpdmVHcm91cCkuaWQsCiAgICAgICAgICAgIHN0cmVhbXM6IHN0cmVhbXMKICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgICAgICBfdGhpczM0LnhoYW1zdGVyLmlzTG9hZGluZyA9IGZhbHNlOwoKICAgICAgICAgICAgaWYgKHJlcy5zdGF0dXMpIHsKICAgICAgICAgICAgICBfdGhpczM0LmxvYWRQbGF5bGlzdChfdGhpczM0LnBsYXlsaXN0RWRpdG9yLmlkLCBncm91cEluZGV4KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkgewogICAgICAgICAgICBfdGhpczM0LnhoYW1zdGVyLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLnhoYW1zdGVyLm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBnZXRYaGFtc3RlckNvbmZpZzogZnVuY3Rpb24gZ2V0WGhhbXN0ZXJDb25maWcodXJsKSB7CiAgICAgIHZhciBfdGhpczM1ID0gdGhpczsKCiAgICAgIHRoaXMueGhhbXN0ZXIuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UucG9zdCgiZWRpdG9yL3hoYW1zdGVyLXZpZGVvIiwgewogICAgICAgIHVybDogdXJsCiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgIF90aGlzMzUueGhhbXN0ZXIudmlkZW8gPSByZXMuZGF0YTsKICAgICAgICBfdGhpczM1LnhoYW1zdGVyLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9KTsKICAgIH0sCiAgICBncm91cERvdWJsZUNsaWNrOiBmdW5jdGlvbiBncm91cERvdWJsZUNsaWNrKCkgewogICAgICBpZiAodGhpcy5hY3RpdmVHcm91cHMubGVuZ3RoID09PSAxKSB7CiAgICAgICAgdGhpcy5lZGl0R3JvdXBNb2RhbCh0cnVlKTsKICAgICAgfQogICAgfSwKICAgIHN0cmVhbURvdWJsZUNsaWNrOiBmdW5jdGlvbiBzdHJlYW1Eb3VibGVDbGljaygpIHsKICAgICAgaWYgKHRoaXMuYWN0aXZlU3RyZWFtcy5sZW5ndGggPT09IDEpIHsKICAgICAgICB0aGlzLmVkaXRTdHJlYW1Nb2RhbCh0cnVlKTsKICAgICAgfQogICAgfSwKICAgIGxvYWRMb2dvQ291bnRyaWVzOiBmdW5jdGlvbiBsb2FkTG9nb0NvdW50cmllcygpIHsKICAgICAgdmFyIF90aGlzMzYgPSB0aGlzOwoKICAgICAgdGhpcy5maW5kTG9nby5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZS5nZXQoImVkaXRvci9sb2dvLWNvdW50cmllcyIpLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgIF90aGlzMzYuZmluZExvZ28uaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgX3RoaXMzNi5maW5kTG9nby5jb3VudHJpZXMgPSByZXMuZGF0YS5tYXAoZnVuY3Rpb24gKGNvdW50cnkpIHsKICAgICAgICAgIHZhciBjbiA9IF90aGlzMzYuY291bnRyaWVzLmZpbmQoZnVuY3Rpb24gKGNudCkgewogICAgICAgICAgICByZXR1cm4gY250LmNvZGUudG9Mb3dlckNhc2UoKSA9PSBjb3VudHJ5LnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICB9KTsKCiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICB0ZXh0OiBjbiA/IGNuLm5hbWUgOiBjb3VudHJ5LAogICAgICAgICAgICB2YWx1ZTogY291bnRyeQogICAgICAgICAgfTsKICAgICAgICB9KS5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICByZXR1cm4gYS50ZXh0LnRvVXBwZXJDYXNlKCkgPCBiLnRleHQudG9VcHBlckNhc2UoKSA/IC0xIDogYS50ZXh0LnRvVXBwZXJDYXNlKCkgPiBiLnRleHQudG9VcHBlckNhc2UoKSA/IDEgOiAwOwogICAgICAgIH0pOwogICAgICAgIF90aGlzMzYuYXNzaWduTG9nby5jb3VudHJpZXMgPSBfdG9Db25zdW1hYmxlQXJyYXkoX3RoaXMzNi5maW5kTG9nby5jb3VudHJpZXMpOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMzNi5maW5kTG9nby5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfSk7CiAgICB9LAogICAgbG9hZFRWR0lEQ291bnRyaWVzOiBmdW5jdGlvbiBsb2FkVFZHSURDb3VudHJpZXMoKSB7CiAgICAgIHZhciBfdGhpczM3ID0gdGhpczsKCiAgICAgIHRoaXMuYXNzaWduVFZHSUQuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UuZ2V0KCJlZGl0b3IvdHYtZ3VpZGUtY291bnRyaWVzIikudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgX3RoaXMzNy5hc3NpZ25UVkdJRC5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICBfdGhpczM3LmFzc2lnblRWR0lELmNvdW50cmllcyA9IHJlcy5kYXRhLm1hcChmdW5jdGlvbiAoY291bnRyeSkgewogICAgICAgICAgdmFyIGNuID0gX3RoaXMzNy5jb3VudHJpZXMuZmluZChmdW5jdGlvbiAoY250KSB7CiAgICAgICAgICAgIHJldHVybiBjbnQuY29kZS50b0xvd2VyQ2FzZSgpID09IGNvdW50cnkudG9Mb3dlckNhc2UoKTsKICAgICAgICAgIH0pOwoKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHRleHQ6IGNuID8gY24ubmFtZSA6IGNvdW50cnksCiAgICAgICAgICAgIHZhbHVlOiBjb3VudHJ5CiAgICAgICAgICB9OwogICAgICAgIH0pLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgIHJldHVybiBhLnRleHQudG9VcHBlckNhc2UoKSA8IGIudGV4dC50b1VwcGVyQ2FzZSgpID8gLTEgOiBhLnRleHQudG9VcHBlckNhc2UoKSA+IGIudGV4dC50b1VwcGVyQ2FzZSgpID8gMSA6IDA7CiAgICAgICAgfSk7CgogICAgICAgIF90aGlzMzcuYXNzaWduVFZHSUQuY291bnRyaWVzLnVuc2hpZnQoewogICAgICAgICAgdGV4dDogX3RoaXMzNy4kdCgiZ2VuZXJhbC5hbGwiKSwKICAgICAgICAgIHZhbHVlOiAiYWxsIgogICAgICAgIH0pOwoKICAgICAgICBfdGhpczM3LmZpbmRUVkdJRC5jb3VudHJpZXMgPSBfdG9Db25zdW1hYmxlQXJyYXkoX3RoaXMzNy5hc3NpZ25UVkdJRC5jb3VudHJpZXMpOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMzNy5hc3NpZ25UVkdJRC5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfSk7CiAgICB9LAogICAgbG9hZExvZ29zRmluZDogZnVuY3Rpb24gbG9hZExvZ29zRmluZChjb3VudHJ5KSB7CiAgICAgIHZhciBfdGhpczM4ID0gdGhpczsKCiAgICAgIHRoaXMuZmluZExvZ28uaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UuZ2V0KCJlZGl0b3IvbG9nb3MvIi5jb25jYXQoY291bnRyeSkpLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgIF90aGlzMzguZmluZExvZ28ubG9nbyA9ICIiOwogICAgICAgIF90aGlzMzguZmluZExvZ28uaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgX3RoaXMzOC5maW5kTG9nby5sb2dvcyA9IHJlcy5kYXRhLm1hcChmdW5jdGlvbiAobG9nbykgewogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgdGV4dDogbG9nby5sYWJlbCwKICAgICAgICAgICAgdmFsdWU6IGxvZ28uZmlsZW5hbWUKICAgICAgICAgIH07CiAgICAgICAgfSk7CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczM4LmZpbmRMb2dvLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9KTsKICAgIH0sCiAgICBmaW5kTG9nb01vZGFsOiBmdW5jdGlvbiBmaW5kTG9nb01vZGFsKHNob3cpIHsKICAgICAgdmFyIHNhdmUgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IGZhbHNlOwogICAgICB2YXIgc2VsZWN0ZWQgPSB0aGlzLmdldFN0cmVhbVdpdGhJZCh0aGlzLmFjdGl2ZVN0cmVhbXNbMF0pOwoKICAgICAgaWYgKHNob3cpIHsKICAgICAgICB0aGlzLmZpbmRMb2dvLmxvZ28gPSAiIjsKICAgICAgICB0aGlzLmZpbmRMb2dvLnRpdGxlID0gc2VsZWN0ZWQuc3RyZWFtX3R2Z19uYW1lOwogICAgICB9CgogICAgICB0aGlzLmZpbmRMb2dvLnNlYXJjaCA9ICIiOwoKICAgICAgaWYgKHNhdmUpIHsKICAgICAgICBpZiAoc2VsZWN0ZWQpIHsKICAgICAgICAgIHNlbGVjdGVkLnN0cmVhbV90dmdfbG9nbyA9ICJodHRwOi8vc3RhdGljLmlwdHYtdG9vbHMuY29tLyIuY29uY2F0KHRoaXMuZmluZExvZ28uY291bnRyeSwgIi8iKS5jb25jYXQodGhpcy5maW5kTG9nby5sb2dvKTsKICAgICAgICAgIHNlbGVjdGVkLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmZpbmRMb2dvLm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBsb2FkTG9nb3NBc3NpZ246IGZ1bmN0aW9uIGxvYWRMb2dvc0Fzc2lnbihjb3VudHJ5KSB7CiAgICAgIHZhciBfdGhpczM5ID0gdGhpczsKCiAgICAgIHRoaXMuYXNzaWduTG9nby5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZS5nZXQoImVkaXRvci9sb2dvcy8iLmNvbmNhdChjb3VudHJ5KSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgX3RoaXMzOS5hc3NpZ25Mb2dvLmxvZ28gPSAiIjsKICAgICAgICBfdGhpczM5LmFzc2lnbkxvZ28uaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgX3RoaXMzOS5hc3NpZ25Mb2dvLmxvZ29zID0gcmVzLmRhdGEubWFwKGZ1bmN0aW9uIChsb2dvKSB7CiAgICAgICAgICByZXR1cm4gbG9nby5maWxlbmFtZTsKICAgICAgICB9KTsKICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzMzkuYXNzaWduTG9nby5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfSk7CiAgICB9LAogICAgYXNzaWduTG9nb01vZGFsOiBmdW5jdGlvbiBhc3NpZ25Mb2dvTW9kYWwoc2hvdykgewogICAgICB2YXIgX3RoaXM0MCA9IHRoaXM7CgogICAgICB2YXIgc2F2ZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogZmFsc2U7CgogICAgICBpZiAoc2hvdykgewogICAgICAgIHRoaXMuYXNzaWduTG9nby5sb2dvID0gIiI7CiAgICAgIH0KCiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgdmFyIGNoYW5nZWQgPSBmYWxzZTsKCiAgICAgICAgdmFyIHN0cmluZ1NpbWlsYXJpdHkgPSByZXF1aXJlKCJzdHJpbmctc2ltaWxhcml0eSIpOwoKICAgICAgICB2YXIgc3RyZWFtcyA9IFtdOwoKICAgICAgICBpZiAodGhpcy5hc3NpZ25Mb2dvLmFzc2lnbkFsbCA9PSAxKSB7CiAgICAgICAgICBzdHJlYW1zID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzdHJlYW1zID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmZpbHRlcihmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAgICAgICAgIHJldHVybiAhc3RyZWFtLnN0cmVhbV90dmdfbG9nby5sZW5ndGg7CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIHN0cmVhbXMubWFwKGZ1bmN0aW9uIChzdHJlYW0pIHsKICAgICAgICAgIHZhciBtYXRjaDEgPSBzdHJpbmdTaW1pbGFyaXR5LmZpbmRCZXN0TWF0Y2goU3RyaW5nKHN0cmVhbS5zdHJlYW1fdHZnX25hbWUpLnJlcGxhY2UoLyBoZCQvaSwgIiIpLCBfdGhpczQwLmFzc2lnbkxvZ28ubG9nb3MpLmJlc3RNYXRjaDsKICAgICAgICAgIHZhciBtYXRjaDIgPSBzdHJpbmdTaW1pbGFyaXR5LmZpbmRCZXN0TWF0Y2goU3RyaW5nKHN0cmVhbS5zdHJlYW1fdHZnX2lkKSwgX3RoaXM0MC5hc3NpZ25Mb2dvLmxvZ29zKS5iZXN0TWF0Y2g7CgogICAgICAgICAgaWYgKG1hdGNoMS5yYXRpbmcgPj0gMC4zKSB7CiAgICAgICAgICAgIGNoYW5nZWQgPSB0cnVlOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19sb2dvID0gImh0dHA6Ly9zdGF0aWMuaXB0di10b29scy5jb20vIi5jb25jYXQoX3RoaXM0MC5hc3NpZ25Mb2dvLmNvdW50cnksICIvIikuY29uY2F0KG1hdGNoMS50YXJnZXQpOwogICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgfSBlbHNlIGlmIChtYXRjaDIucmF0aW5nID49IDAuNSkgewogICAgICAgICAgICBjaGFuZ2VkID0gdHJ1ZTsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfbG9nbyA9ICJodHRwOi8vc3RhdGljLmlwdHYtdG9vbHMuY29tLyIuY29uY2F0KF90aGlzNDAuYXNzaWduTG9nby5jb3VudHJ5LCAiLyIpLmNvbmNhdChtYXRjaDIudGFyZ2V0KTsKICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSBjaGFuZ2VkOwogICAgICB9CgogICAgICB0aGlzLmFzc2lnbkxvZ28ubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGxvYWRUVkdJREFzc2lnbjogZnVuY3Rpb24gbG9hZFRWR0lEQXNzaWduKGNvdW50cnkpIHsKICAgICAgdmFyIF90aGlzNDEgPSB0aGlzOwoKICAgICAgdGhpcy5hc3NpZ25UVkdJRC5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZS5nZXQoImVkaXRvci90di1ndWlkZS8iLmNvbmNhdChjb3VudHJ5KSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgX3RoaXM0MS5hc3NpZ25UVkdJRC5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICBfdGhpczQxLmFzc2lnblRWR0lELmNoYW5uZWxzID0gcmVzLmRhdGE7CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczQxLmFzc2lnblRWR0lELmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9KTsKICAgIH0sCiAgICBhc3NpZ25UVkdJRE1vZGFsOiBmdW5jdGlvbiBhc3NpZ25UVkdJRE1vZGFsKHNob3cpIHsKICAgICAgdmFyIF90aGlzNDIgPSB0aGlzOwoKICAgICAgdmFyIHNhdmUgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IGZhbHNlOwoKICAgICAgaWYgKHNhdmUpIHsKICAgICAgICB2YXIgY2hhbmdlZCA9IGZhbHNlOwoKICAgICAgICB2YXIgc3RyaW5nU2ltaWxhcml0eSA9IHJlcXVpcmUoInN0cmluZy1zaW1pbGFyaXR5Iik7CgogICAgICAgIHZhciBzdHJlYW1zID0gW107CgogICAgICAgIGlmICh0aGlzLmFzc2lnblRWR0lELmFzc2lnbkFsbCA9PSAxKSB7CiAgICAgICAgICBzdHJlYW1zID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzdHJlYW1zID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmZpbHRlcihmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAgICAgICAgIHJldHVybiAhc3RyZWFtLnN0cmVhbV90dmdfaWQubGVuZ3RoIHx8IHN0cmVhbS5zdHJlYW1fdHZnX2lkLmxlbmd0aCA9PSAwOwogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICB2YXIgY2hhbm5lbE5hbWVzID0gdGhpcy5hc3NpZ25UVkdJRC5jaGFubmVscy5tYXAoZnVuY3Rpb24gKGNoYW5uZWwpIHsKICAgICAgICAgIHJldHVybiBjaGFubmVsLnR2Z19uYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgfSk7CiAgICAgICAgdmFyIGNoYW5uZWxJZHMgPSB0aGlzLmFzc2lnblRWR0lELmNoYW5uZWxzLm1hcChmdW5jdGlvbiAoY2hhbm5lbCkgewogICAgICAgICAgcmV0dXJuIGNoYW5uZWwudHZnX2lkLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgfSk7CiAgICAgICAgc3RyZWFtcy5tYXAoZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgICAgdmFyIG1hdGNoMSA9IHN0cmluZ1NpbWlsYXJpdHkuZmluZEJlc3RNYXRjaChTdHJpbmcoc3RyZWFtLnN0cmVhbV90dmdfbmFtZSkudG9Mb3dlckNhc2UoKSwgY2hhbm5lbE5hbWVzKS5iZXN0TWF0Y2g7CiAgICAgICAgICB2YXIgbWF0Y2gyID0gc3RyaW5nU2ltaWxhcml0eS5maW5kQmVzdE1hdGNoKFN0cmluZyhzdHJlYW0uc3RyZWFtX3R2Z19pZCkudG9Mb3dlckNhc2UoKSwgY2hhbm5lbElkcykuYmVzdE1hdGNoOwogICAgICAgICAgdmFyIG1hdGNoMyA9IHN0cmluZ1NpbWlsYXJpdHkuZmluZEJlc3RNYXRjaChTdHJpbmcoc3RyZWFtLnN0cmVhbV90dmdfbmFtZSkucmVwbGFjZSgvIGhkJHwgZmhkJHwgaGV2YyR8IGgyNjUkfC9pLCAiIikudG9Mb3dlckNhc2UoKSwgY2hhbm5lbE5hbWVzKS5iZXN0TWF0Y2g7CgogICAgICAgICAgaWYgKG1hdGNoMi5yYXRpbmcgPj0gMC43NSkgewogICAgICAgICAgICBjaGFuZ2VkID0gdHJ1ZTsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfaWQgPSBtYXRjaDIudGFyZ2V0OwogICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgfSBlbHNlIGlmIChtYXRjaDEucmF0aW5nID49IDAuNzUpIHsKICAgICAgICAgICAgY2hhbmdlZCA9IHRydWU7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX2lkID0gX3RoaXM0Mi5hc3NpZ25UVkdJRC5jaGFubmVscy5maW5kKGZ1bmN0aW9uIChjaGFubmVsKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGNoYW5uZWwudHZnX25hbWUudG9Mb3dlckNhc2UoKSA9PT0gbWF0Y2gxLnRhcmdldDsKICAgICAgICAgICAgfSkudHZnX2lkOwogICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgfSBlbHNlIGlmIChtYXRjaDMucmF0aW5nID49IDAuNzUpIHsKICAgICAgICAgICAgY2hhbmdlZCA9IHRydWU7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX2lkID0gX3RoaXM0Mi5hc3NpZ25UVkdJRC5jaGFubmVscy5maW5kKGZ1bmN0aW9uIChjaGFubmVsKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGNoYW5uZWwudHZnX25hbWUudG9Mb3dlckNhc2UoKSA9PT0gbWF0Y2gxLnRhcmdldDsKICAgICAgICAgICAgfSkudHZnX2lkOwogICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY2hhbmdlZCA9IHRydWU7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX2lkID0gIiI7CiAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gY2hhbmdlZDsKICAgICAgfQoKICAgICAgdGhpcy5hc3NpZ25UVkdJRC5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgbG9hZFRWR0lERmluZDogZnVuY3Rpb24gbG9hZFRWR0lERmluZChjb3VudHJ5KSB7CiAgICAgIHZhciBfdGhpczQzID0gdGhpczsKCiAgICAgIHRoaXMuZmluZFRWR0lELmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGh0dHBTZXJ2aWNlLmdldCgiZWRpdG9yL3R2LWd1aWRlLyIuY29uY2F0KGNvdW50cnkpKS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICBfdGhpczQzLmZpbmRUVkdJRC5jaGFubmVsID0gIiI7CiAgICAgICAgX3RoaXM0My5maW5kVFZHSUQuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgX3RoaXM0My5maW5kVFZHSUQuY2hhbm5lbHMgPSByZXMuZGF0YS5tYXAoZnVuY3Rpb24gKGNoYW5uZWwpIHsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHRleHQ6IGNoYW5uZWwudHZnX25hbWUsCiAgICAgICAgICAgIHZhbHVlOiBjaGFubmVsLnR2Z19pZAogICAgICAgICAgfTsKICAgICAgICB9KTsKICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzNDMuZmluZFRWR0lELmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9KTsKICAgIH0sCiAgICBmaW5kVFZHSURNb2RhbDogZnVuY3Rpb24gZmluZFRWR0lETW9kYWwoc2hvdykgewogICAgICB2YXIgc2F2ZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogZmFsc2U7CiAgICAgIHZhciBzZWxlY3RlZCA9IHRoaXMuZ2V0U3RyZWFtV2l0aElkKHRoaXMuYWN0aXZlU3RyZWFtc1swXSk7CgogICAgICBpZiAoc2hvdykgewogICAgICAgIHRoaXMuZmluZFRWR0lELmNoYW5uZWwgPSAiIjsKICAgICAgICB0aGlzLmZpbmRUVkdJRC50aXRsZSA9IHNlbGVjdGVkLnN0cmVhbV90dmdfbmFtZTsKICAgICAgfQoKICAgICAgdGhpcy5maW5kVFZHSUQuc2VhcmNoID0gIiI7CgogICAgICBpZiAoc2F2ZSkgewogICAgICAgIGlmIChzZWxlY3RlZCkgewogICAgICAgICAgc2VsZWN0ZWQuc3RyZWFtX3R2Z19pZCA9IHRoaXMuZmluZFRWR0lELmNoYW5uZWw7CiAgICAgICAgICBzZWxlY3RlZC5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5maW5kVFZHSUQubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGltcG9ydE0zVU1vZGFsOiBmdW5jdGlvbiBpbXBvcnRNM1VNb2RhbChzaG93KSB7CiAgICAgIHZhciBfdGhpczQ0ID0gdGhpczsKCiAgICAgIHZhciBzYXZlID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiBmYWxzZTsKCiAgICAgIGlmIChzaG93KSB7CiAgICAgICAgdGhpcy5pbXBvcnRNM1UuZmlsZSA9IG51bGw7CiAgICAgICAgdGhpcy5pbXBvcnRNM1UubTN1ID0gbnVsbDsKICAgICAgICB0aGlzLmltcG9ydE0zVS5ncm91cHMgPSBbXTsKICAgICAgICB0aGlzLmltcG9ydE0zVS5pbXBvcnRHcm91cHMgPSBbXTsKICAgICAgfQoKICAgICAgaWYgKHNhdmUpIHsKICAgICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7CiAgICAgICAgdmFyIGdyb3VwSW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgICByZXR1cm4gZ3JvdXAuaWQgPT0gX3RoaXM0NC5hY3RpdmVHcm91cDsKICAgICAgICB9KTsKICAgICAgICBodHRwU2VydmljZS5wb3N0KCJlZGl0b3IvaW1wb3J0IiwgewogICAgICAgICAgcGxheWxpc3RfaWQ6IHRoaXMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICBpbXBvcnQ6IHRoaXMuaW1wb3J0TTNVLmdyb3Vwcy5maWx0ZXIoZnVuY3Rpb24gKGdyb3VwLCBpbmRleCkgewogICAgICAgICAgICByZXR1cm4gX3RoaXM0NC5pbXBvcnRNM1UuaW1wb3J0R3JvdXBzLmluY2x1ZGVzKGluZGV4KTsKICAgICAgICAgIH0pCiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICBfdGhpczQ0LmlzTG9hZGluZyA9IGZhbHNlOwoKICAgICAgICAgIGlmIChyZXMuc3RhdHVzKSB7CiAgICAgICAgICAgIF90aGlzNDQubG9hZFBsYXlsaXN0KF90aGlzNDQucGxheWxpc3RFZGl0b3IuaWQsIGdyb3VwSW5kZXgpOwogICAgICAgICAgfQogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIF90aGlzNDQuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHRoaXMuaW1wb3J0TTNVLm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICB1cGxvYWRNM1U6IGZ1bmN0aW9uIHVwbG9hZE0zVShldmVudCkgewogICAgICB2YXIgX3RoaXM0NSA9IHRoaXM7CgogICAgICB2YXIgaW5wdXQgPSBldmVudC50YXJnZXQ7CgogICAgICBpZiAoImZpbGVzIiBpbiBpbnB1dCAmJiBpbnB1dC5maWxlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgdGhpcy5pbXBvcnRNM1UuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgICB0aGlzLnJlYWRGaWxlQ29udGVudChpbnB1dC5maWxlc1swXSkudGhlbihmdW5jdGlvbiAoY29udGVudCkgewogICAgICAgICAgX3RoaXM0NS5pbXBvcnRNM1UuaXNMb2FkaW5nID0gZmFsc2U7CgogICAgICAgICAgX3RoaXM0NS5wYXJzZU0zVShjb250ZW50KTsKICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgICAgIF90aGlzNDUuJG5vdGlmeSgiZXJyb3IiLCBfdGhpczQ1LiR0KCJwcm9maWxlLmZhaWxlZCIpLCBlcnJvciwgImxhLXVzZXItc2hpZWxkIiwgewogICAgICAgICAgICBkdXJhdGlvbjogNTAwMCwKICAgICAgICAgICAgcGVybWFuZW50OiBmYWxzZQogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBwYXJzZU0zVTogZnVuY3Rpb24gcGFyc2VNM1UoY29udGVudCkgewogICAgICB2YXIgX3RoaXM0NiA9IHRoaXM7CgogICAgICB2YXIgdm0gPSB0aGlzOwogICAgICB2bS5pbXBvcnRNM1UuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgbTN1LnBhcnNlKGNvbnRlbnQsIHsKICAgICAgICB0YWc6ICJuYW1lIiwKICAgICAgICB0eXBlOiBbIk1vdmllIiwgIlNlcmllcyIsICJWT0QiLCAiTGl2ZSJdCiAgICAgIH0sIHRydWUpLnRoZW4oZnVuY3Rpb24gKHBsYXlsaXN0KSB7CiAgICAgICAgX3RoaXM0Ni5pbXBvcnRNM1UubTN1ID0gcGxheWxpc3Q7CiAgICAgICAgX3RoaXM0Ni5pbXBvcnRNM1UuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgX3RoaXM0Ni5pbXBvcnRNM1UuZ3JvdXBzID0gcGxheWxpc3QuZ3JvdXBzOwogICAgICAgIF90aGlzNDYuaW1wb3J0TTNVLmltcG9ydEdyb3VwcyA9IFtdOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgICB2bS5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICB2bS4kbm90aWZ5KCJlcnJvciIsIHZtLiR0KCJwcm9maWxlLmZhaWxlZCIpLCBlcnJvciwgImxhLXVzZXItc2hpZWxkIiwgewogICAgICAgICAgZHVyYXRpb246IDUwMDAsCiAgICAgICAgICBwZXJtYW5lbnQ6IGZhbHNlCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSwKICAgIHJlYWRGaWxlQ29udGVudDogZnVuY3Rpb24gcmVhZEZpbGVDb250ZW50KGZpbGUpIHsKICAgICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgcmV0dXJuIHJlc29sdmUoZXZlbnQudGFyZ2V0LnJlc3VsdCk7CiAgICAgICAgfTsKCiAgICAgICAgcmVhZGVyLm9uZXJyb3IgPSBmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgICAgIHJldHVybiByZWplY3QoZXJyb3IpOwogICAgICAgIH07CgogICAgICAgIHJlYWRlci5yZWFkQXNUZXh0KGZpbGUpOwogICAgICB9KTsKICAgIH0KICB9LAogIGJlZm9yZU1vdW50OiBmdW5jdGlvbiBiZWZvcmVNb3VudCgpIHsKICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmFkZCgicmlnaHQtbWVudSIpOwogICAgRXZlbnRCdXMuJG9uKCJzZWFyY2giLCB0aGlzLnNlYXJjaEVkaXRvcik7CiAgICBFdmVudEJ1cy4kb24oInByaW50IiwgdGhpcy5wcmludEVkaXRvcik7CiAgICBFdmVudEJ1cy4kb24oInRhYi1jaGFuZ2UiLCB0aGlzLmRvVGFiQ2hhbmdlKTsKICAgIEV2ZW50QnVzLiRvbigic2F2ZSIsIHRoaXMuZG9TYXZlKTsKICAgIEV2ZW50QnVzLiRvbigiY2FuY2VsIiwgdGhpcy5kb0NhbmNlbCk7CgogICAgaWYgKHRoaXMubW92aWVTZXJpZVBsYXlsaXN0KSB7CiAgICAgIHRoaXMubG9hZFBsYXlsaXN0KHRoaXMubW92aWVTZXJpZVBsYXlsaXN0KTsKICAgIH0KCiAgICB0aGlzLmxvYWRMb2dvQ291bnRyaWVzKCk7CiAgICB0aGlzLmxvYWRUVkdJRENvdW50cmllcygpOwogIH0sCiAgYmVmb3JlRGVzdHJveTogZnVuY3Rpb24gYmVmb3JlRGVzdHJveSgpIHsKICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnJlbW92ZSgicmlnaHQtbWVudSIpOwogICAgRXZlbnRCdXMuJG9mZigic2VhcmNoIiwgdGhpcy5zZWFyY2hFZGl0b3IpOwogICAgRXZlbnRCdXMuJG9mZigicHJpbnQiLCB0aGlzLnByaW50RWRpdG9yKTsKICAgIEV2ZW50QnVzLiRvZmYoInRhYi1jaGFuZ2UiLCB0aGlzLmRvVGFiQ2hhbmdlKTsKICAgIEV2ZW50QnVzLiRvZmYoInNhdmUiLCB0aGlzLmRvU2F2ZSk7CiAgICBFdmVudEJ1cy4kb2ZmKCJjYW5jZWwiLCB0aGlzLmRvQ2FuY2VsKTsKICB9LAogIHdhdGNoOiB7CiAgICBkcmFnU3RyZWFtOiBmdW5jdGlvbiBkcmFnU3RyZWFtKHZhbCkgewogICAgICBpZiAoIXZhbCkgewogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICAgIH0KICAgIH0sCiAgICBkcmFnR3JvdXA6IGZ1bmN0aW9uIGRyYWdHcm91cCh2YWwpIHsKICAgICAgaWYgKCF2YWwpIHsKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgICB9CiAgICB9LAogICAgYWN0aXZlR3JvdXA6IGZ1bmN0aW9uIGFjdGl2ZUdyb3VwKHZhbCkgewogICAgICBpZiAodGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkKSB7CiAgICAgICAgdGhpcy5zYXZlQ2hhbmdlc01vZGFsKHRydWUpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMubG9hZFN0cmVhbXMoKTsKICAgICAgfQogICAgfSwKICAgICJwbGF5bGlzdEVkaXRvci5jaGFuZ2VkIjogZnVuY3Rpb24gcGxheWxpc3RFZGl0b3JDaGFuZ2VkKHZhbCkgewogICAgICBFdmVudEJ1cy4kZW1pdCgiZWRpdG9yLWNoYW5nZXMiLCB2YWwpOwogICAgfSwKICAgICJyYWRpb0Jyb3dzZXIuc2VhcmNoIjogZnVuY3Rpb24gcmFkaW9Ccm93c2VyU2VhcmNoKHZhbCkgewogICAgICB2YXIgdm0gPSB0aGlzOwogICAgICBjbGVhclRpbWVvdXQodGhpcy5yYWRpb0Jyb3dzZXIuYm91bmNlKTsKICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuYm91bmNlID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgdm0uZmluZFJhZGlvYnJvd3Nlcih2YWwpOwogICAgICB9LCA1MDApOwogICAgfSwKICAgICJzb3VuZGNsb3VkLnVybCI6IGZ1bmN0aW9uIHNvdW5kY2xvdWRVcmwodmFsKSB7CiAgICAgIHZhciB2bSA9IHRoaXM7CiAgICAgIGNsZWFyVGltZW91dCh0aGlzLnJhZGlvQnJvd3Nlci5ib3VuY2UpOwogICAgICB0aGlzLnJhZGlvQnJvd3Nlci5ib3VuY2UgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICB2bS5nZXRTb3VuZGNsb3VkVHJhY2sodmFsLCB2bS5zb3VuZGNsb3VkQ2xpZW50SWQpOwogICAgICB9LCA1MDApOwogICAgfSwKICAgICJ5b3V0dWJlLnVybCI6IGZ1bmN0aW9uIHlvdXR1YmVVcmwodmFsKSB7CiAgICAgIGlmICghdmFsLmxlbmd0aCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKC95b3V0dVwuP2JlL2kudGVzdCh2YWwpKSB7CiAgICAgICAgdmFyIGk7CiAgICAgICAgdmFyIHBhdHRlcm5zID0gWy95b3V0dVwuYmVcLyhbXiMmP117MTF9KS8sIC8vIHlvdXR1LmJlLzxpZD4KICAgICAgICAvXD92PShbXiMmP117MTF9KS8sIC8vID92PTxpZD4KICAgICAgICAvJnY9KFteIyY/XXsxMX0pLywgLy8gJnY9PGlkPgogICAgICAgIC9lbWJlZFwvKFteIyY/XXsxMX0pLywgLy8gZW1iZWQvPGlkPgogICAgICAgIC9cL3ZcLyhbXiMmP117MTF9KS8gLy8gL3YvPGlkPgogICAgICAgIF07CgogICAgICAgIGZvciAoaSA9IDA7IGkgPCBwYXR0ZXJucy5sZW5ndGg7ICsraSkgewogICAgICAgICAgaWYgKHBhdHRlcm5zW2ldLnRlc3QodmFsKSkgewogICAgICAgICAgICB0aGlzLnlvdXR1YmUudmlkZW9JZCA9IHBhdHRlcm5zW2ldLmV4ZWModmFsKVsxXTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdmFyIHRva2VucyA9IHZhbC5zcGxpdCgvWy8mPz0jLlxzXS9nKTsKCiAgICAgICAgZm9yIChpID0gMDsgaSA8IHRva2Vucy5sZW5ndGg7ICsraSkgewogICAgICAgICAgaWYgKC9eW14jJj9dezExfSQvLnRlc3QodG9rZW5zW2ldKSkgewogICAgICAgICAgICB0aGlzLnlvdXR1YmUudmlkZW9JZCA9IHRva2Vuc1tpXTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdGhpcy55b3V0dWJlLnZpZGVvSWQgPSAiIjsKICAgICAgfSBlbHNlIHsKICAgICAgICB0cnkgewogICAgICAgICAgdmFyIHVybHAgPSBuZXcgVVJMKHZhbCk7CiAgICAgICAgICB0aGlzLnlvdXR1YmUudmlkZW9JZCA9IHVybHAuc2VhcmNoUGFyYW1zLmdldCgidiIpOwogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICB0aGlzLnlvdXR1YmUudmlkZW9JZCA9ICIiOwogICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgICJ5b3V0dWJlLnZpZGVvSWQiOiBmdW5jdGlvbiB5b3V0dWJlVmlkZW9JZCh2YWwpIHsKICAgICAgdmFyIHZtID0gdGhpczsKICAgICAgY2xlYXJUaW1lb3V0KHRoaXMueW91dHViZS5ib3VuY2UpOwogICAgICB0aGlzLnlvdXR1YmUuYm91bmNlID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKHZhbC5sZW5ndGgpIHsKICAgICAgICAgIHZtLmdldFlvdXR1YmVQYWdlKHZhbCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZtLnlvdXR1YmUudmlkZW8gPSBudWxsOwogICAgICAgIH0KICAgICAgfSwgNTAwKTsKICAgIH0sCiAgICAidmltZW8udXJsIjogZnVuY3Rpb24gdmltZW9VcmwodmFsKSB7CiAgICAgIGlmICgvdmltZW9cLmNvbS9pLnRlc3QodmFsKSkgewogICAgICAgIHZhciBtYXRjaCA9IHZhbC5tYXRjaCgvKD86d3d3XC58cGxheWVyXC4pP3ZpbWVvLmNvbVwvKD86Y2hhbm5lbHNcLyg/Olx3K1wvKT98Z3JvdXBzXC8oPzpbXi9dKilcL3ZpZGVvc1wvfGFsYnVtXC8oPzpcZCspXC92aWRlb1wvfHZpZGVvXC98KShcZCspKD86W2EtekEtWjAtOV8tXSspPy9pKTsKCiAgICAgICAgaWYgKG1hdGNoLmxlbmd0aCA+PSAyKSB7CiAgICAgICAgICB0aGlzLnZpbWVvLnZpZGVvSWQgPSBtYXRjaFsxXTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy52aW1lby52aWRlb0lkID0gIiI7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMudmltZW8udmlkZW9JZCA9ICIiOwogICAgICB9CiAgICB9LAogICAgInZpbWVvLnZpZGVvSWQiOiBmdW5jdGlvbiB2aW1lb1ZpZGVvSWQodmFsKSB7CiAgICAgIHZhciB2bSA9IHRoaXM7CiAgICAgIGNsZWFyVGltZW91dCh0aGlzLnZpbWVvLmJvdW5jZSk7CiAgICAgIHRoaXMudmltZW8uYm91bmNlID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKHZhbC5sZW5ndGgpIHsKICAgICAgICAgIHZtLmdldFZpbWVvQ29uZmlnKHZhbCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZtLnZpbWVvLnZpZGVvID0gbnVsbDsKICAgICAgICB9CiAgICAgIH0sIDUwMCk7CiAgICB9LAogICAgImRhaWx5bW90aW9uLnVybCI6IGZ1bmN0aW9uIGRhaWx5bW90aW9uVXJsKHZhbCkgewogICAgICBpZiAoL2RhaWx5bW90aW9uXC5jb20vaS50ZXN0KHZhbCkpIHsKICAgICAgICB2YXIgbWF0Y2ggPSB2YWwubWF0Y2goL14uK2RhaWx5bW90aW9uLmNvbVwvKHZpZGVvfGh1YilcLyhbXl9dKylbXiNdKigjdmlkZW89KFteXyZdKykpPy9pKTsKCiAgICAgICAgaWYgKG1hdGNoLmxlbmd0aCA+PSA0ICYmIG1hdGNoWzRdKSB7CiAgICAgICAgICB0aGlzLmRhaWx5bW90aW9uLnZpZGVvSWQgPSBtYXRjaFs0XTsKICAgICAgICB9IGVsc2UgaWYgKG1hdGNoLmxlbmd0aCA+PSAyKSB7CiAgICAgICAgICB0aGlzLmRhaWx5bW90aW9uLnZpZGVvSWQgPSBtYXRjaFsyXTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5kYWlseW1vdGlvbi52aWRlb0lkID0gIiI7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZGFpbHltb3Rpb24udmlkZW9JZCA9ICIiOwogICAgICB9CiAgICB9LAogICAgImRhaWx5bW90aW9uLnZpZGVvSWQiOiBmdW5jdGlvbiBkYWlseW1vdGlvblZpZGVvSWQodmFsKSB7CiAgICAgIHZhciB2bSA9IHRoaXM7CiAgICAgIGNsZWFyVGltZW91dCh0aGlzLmRhaWx5bW90aW9uLmJvdW5jZSk7CiAgICAgIHRoaXMuZGFpbHltb3Rpb24uYm91bmNlID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKHZhbC5sZW5ndGgpIHsKICAgICAgICAgIHZtLmdldERhaWx5bW90aW9uQ29uZmlnKHZhbCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZtLmRhaWx5bW90aW9uLnZpZGVvID0gbnVsbDsKICAgICAgICB9CiAgICAgIH0sIDUwMCk7CiAgICB9LAogICAgInRlZFRhbGtzLnVybCI6IGZ1bmN0aW9uIHRlZFRhbGtzVXJsKHZhbCkgewogICAgICBpZiAoL3RlZFwuY29tXC90YWxrcy9pLnRlc3QodmFsKSkgewogICAgICAgIHZhciB2bSA9IHRoaXM7CiAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMudGVkVGFsa3MuYm91bmNlKTsKICAgICAgICB0aGlzLnRlZFRhbGtzLmJvdW5jZSA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKHZhbC5sZW5ndGgpIHsKICAgICAgICAgICAgdm0uZ2V0VGVkVGFsa3NDb25maWcodmFsKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZtLnRlZFRhbGtzLnZpZGVvID0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICB9LCA1MDApOwogICAgICB9CiAgICB9LAogICAgInhoYW1zdGVyLnVybCI6IGZ1bmN0aW9uIHhoYW1zdGVyVXJsKHZhbCkgewogICAgICB2YXIgdm0gPSB0aGlzOwoKICAgICAgaWYgKC94aGFtc3RlclwuY29tXC92aWRlb3MvaS50ZXN0KHZhbCkpIHsKICAgICAgICBjbGVhclRpbWVvdXQodGhpcy54aGFtc3RlckJvdW5jZSk7CiAgICAgICAgdGhpcy54aGFtc3RlckJvdW5jZSA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKHZhbC5sZW5ndGgpIHsKICAgICAgICAgICAgdm0uZ2V0WGhhbXN0ZXJDb25maWcodmFsKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZtLnhoYW1zdGVyLnZpZGVvID0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICB9LCA1MDApOwogICAgICB9CiAgICB9LAogICAgImZpbmRMb2dvLmNvdW50cnkiOiBmdW5jdGlvbiBmaW5kTG9nb0NvdW50cnkodmFsKSB7CiAgICAgIGlmICh2YWwubGVuZ3RoKSB7CiAgICAgICAgdGhpcy5sb2FkTG9nb3NGaW5kKHZhbCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5maW5kTG9nby5sb2dvID0gIiI7CiAgICAgIH0KICAgIH0sCiAgICAiYXNzaWduTG9nby5jb3VudHJ5IjogZnVuY3Rpb24gYXNzaWduTG9nb0NvdW50cnkodmFsKSB7CiAgICAgIGlmICh2YWwubGVuZ3RoKSB7CiAgICAgICAgdGhpcy5sb2FkTG9nb3NBc3NpZ24odmFsKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmFzc2lnbkxvZ28ubG9nbyA9ICIiOwogICAgICB9CiAgICB9LAogICAgImZpbmRUVkdJRC5jb3VudHJ5IjogZnVuY3Rpb24gZmluZFRWR0lEQ291bnRyeSh2YWwpIHsKICAgICAgaWYgKHZhbC5sZW5ndGgpIHsKICAgICAgICB0aGlzLmxvYWRUVkdJREZpbmQodmFsKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmZpbmRUVkdJRC5jaGFubmVsID0gIiI7CiAgICAgIH0KICAgIH0sCiAgICAiYXNzaWduVFZHSUQuY291bnRyeSI6IGZ1bmN0aW9uIGFzc2lnblRWR0lEQ291bnRyeSh2YWwpIHsKICAgICAgaWYgKHZhbC5sZW5ndGgpIHsKICAgICAgICB0aGlzLmxvYWRUVkdJREFzc2lnbih2YWwpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYXNzaWduVFZHSUQuY2hhbm5lbHMgPSBbXTsKICAgICAgfQogICAgfSwKICAgIG1vdmllU2VyaWVQbGF5bGlzdDogZnVuY3Rpb24gbW92aWVTZXJpZVBsYXlsaXN0KHZhbCkgewogICAgICB0aGlzLmxvYWRQbGF5bGlzdCh2YWwpOwogICAgfQogIH0KfTs="},null]}