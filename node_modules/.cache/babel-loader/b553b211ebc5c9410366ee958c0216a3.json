{"remainingRequest":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/thread-loader/dist/cjs.js!/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/babel-loader/lib/index.js!/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/cache-loader/dist/cjs.js??ref--0-0!/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/vue-loader/lib/index.js??vue-loader-options!/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/src/views/app/xtream/editor.vue?vue&type=script&lang=js&","dependencies":[{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/src/views/app/xtream/editor.vue","mtime":1625401606218},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF90b0NvbnN1bWFibGVBcnJheSBmcm9tICIvbWVkaWEvZXJuc3QvNjNiY2U0M2MtNWU1MS00YmYxLWE2MTEtM2FmZGYzMmFjNmY2L1Z1ZUpTL0lQVFYtVG9vbHMvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL3RvQ29uc3VtYWJsZUFycmF5IjsKaW1wb3J0IF9vYmplY3RTcHJlYWQgZnJvbSAiL21lZGlhL2VybnN0LzYzYmNlNDNjLTVlNTEtNGJmMS1hNjExLTNhZmRmMzJhYzZmNi9WdWVKUy9JUFRWLVRvb2xzL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9vYmplY3RTcHJlYWQyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc2VhcmNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmNvbnN0cnVjdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLnRvLXN0cmluZy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbHRlci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5tYXRjaC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbmQtaW5kZXguanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5tYXAuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5udW1iZXIuY29uc3RydWN0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuam9pbi5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pdGVyYXRvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuaXRlcmF0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zb3J0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5jbHVkZXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuaW5jbHVkZXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zcGxpY2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcucmVwbGFjZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmNvbmNhdC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmZ1bmN0aW9uLm5hbWUuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3Qua2V5cy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbmQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc3BsaXQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIudXJsLmpzIjsKLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCi8qIGVzbGludC1kaXNhYmxlIHZ1ZS9uby1zaWRlLWVmZmVjdHMtaW4tY29tcHV0ZWQtcHJvcGVydGllcyAqLwoKLyogZXNsaW50LWRpc2FibGUgbm8tdW51c2VkLXZhcnMgKi8KCi8qIGVzbGludC1kaXNhYmxlIG5vLXVzZWxlc3MtZXNjYXBlICovCmltcG9ydCB7IEV2ZW50QnVzIH0gZnJvbSAiLi4vLi4vLi4vc2VydmljZXMvZWJ1cyI7CmltcG9ydCB7IGh0dHBTZXJ2aWNlIH0gZnJvbSAiLi4vLi4vLi4vc2VydmljZXMvaHR0cCI7CmltcG9ydCB7IG1hcEdldHRlcnMgfSBmcm9tICJ2dWV4IjsKaW1wb3J0IGRyYWdnYWJsZSBmcm9tICJ2dWVkcmFnZ2FibGUiOwppbXBvcnQgeyBTdWJzY3JpcHRpb25UeXBlIH0gZnJvbSAiLi4vLi4vLi4vY29uc3RhbnRzL2NvbmZpZyI7CmltcG9ydCB7IGNvdW50cmllcyB9IGZyb20gIi4uLy4uLy4uL2hlbHBlcnMiOwppbXBvcnQgeyBtM3UgfSBmcm9tICIuLi8uLi8uLi9wbHVnaW5zL20zdSI7CmV4cG9ydCBkZWZhdWx0IHsKICBjb21wb25lbnRzOiB7CiAgICBkcmFnZ2FibGU6IGRyYWdnYWJsZQogIH0sCiAgZGF0YTogZnVuY3Rpb24gZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGNvdW50cmllczogY291bnRyaWVzLAogICAgICBhY3RpdmVUYWI6IDAsCiAgICAgIGFjdGl2ZUdyb3VwOiAtMSwKICAgICAgYWN0aXZlR3JvdXBzOiBbXSwKICAgICAgYWN0aXZlU3RyZWFtOiAtMSwKICAgICAgYWN0aXZlU3RyZWFtczogW10sCiAgICAgIGRyYWdHcm91cDogZmFsc2UsCiAgICAgIGRyYWdTdHJlYW06IGZhbHNlLAogICAgICBlZGl0b3I6IGZhbHNlLAogICAgICBzZWFyY2g6IG51bGwsCiAgICAgIGlzTG9hZGluZzogZmFsc2UsCiAgICAgIHBsYXlsaXN0RWRpdG9yOiB7CiAgICAgICAgaWQ6IHVuZGVmaW5lZCwKICAgICAgICBwbGF5bGlzdDogbnVsbCwKICAgICAgICBncm91cHM6IFtdLAogICAgICAgIHN0cmVhbXM6IFtdLAogICAgICAgIGNoYW5nZWQ6IGZhbHNlCiAgICAgIH0sCiAgICAgIGZpbmRSZXBsYWNlOiB7CiAgICAgICAgdHlwZTogMCwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgZnJvbTogIiIsCiAgICAgICAgdG86ICIiLAogICAgICAgIHJlcGxhY2VBbGw6IGZhbHNlLAogICAgICAgIGlnbm9yZUNhc2U6IGZhbHNlLAogICAgICAgIHNlbGVjdGVkT25seTogMAogICAgICB9LAogICAgICBwcmVmaXhTdWZmaXg6IHsKICAgICAgICB0eXBlOiAwLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBwcmVmaXg6ICIiLAogICAgICAgIHN1ZmZpeDogIiIsCiAgICAgICAgc2VsZWN0ZWRPbmx5OiAwCiAgICAgIH0sCiAgICAgIGNvbnZlcnRDYXNlOiB7CiAgICAgICAgdHlwZTogMCwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgbWV0aG9kOiAwLAogICAgICAgIHNlbGVjdGVkT25seTogMAogICAgICB9LAogICAgICBncm91cEVkaXRvcjogewogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBpZDogMCwKICAgICAgICBncm91cF9uYW1lOiAiIiwKICAgICAgICBncm91cF9wYXJlbnRfY29kZTogIiIsCiAgICAgICAgZ3JvdXBfdHlwZTogMSwKICAgICAgICBncm91cF9pc19oaWRkZW46IDAKICAgICAgfSwKICAgICAgc3RyZWFtRWRpdG9yOiB7CiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIGlkOiAtMSwKICAgICAgICBzdHJlYW1fdHZnX25hbWU6ICIiLAogICAgICAgIHN0cmVhbV90dmdfaWQ6ICIiLAogICAgICAgIHN0cmVhbV90dmdfbG9nbzogIiIsCiAgICAgICAgc3RyZWFtX3BhcmVudF9jb2RlOiAiIiwKICAgICAgICBzdHJlYW1fcmFkaW86IDAsCiAgICAgICAgc3RyZWFtX2lzX2hpZGRlbjogMCwKICAgICAgICBzdHJlYW1faXNfY3VzdG9tOiAwLAogICAgICAgIG1vdmllX25hbWU6ICIiLAogICAgICAgIG1vdmllX3llYXI6ICIiLAogICAgICAgIHNlcmllX25hbWU6ICIiLAogICAgICAgIHNlcmllX3NlYXNvbjogMCwKICAgICAgICBzZXJpZV9lcGlzb2RlOiAwLAogICAgICAgIHNvdXJjZV9zdHJlYW1fdXJsOiAiIgogICAgICB9LAogICAgICByYWRpb0Jyb3dzZXI6IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBib3VuY2U6IG51bGwsCiAgICAgICAgYWN0aXZlOiBbXSwKICAgICAgICBzZWFyY2g6ICIiLAogICAgICAgIHJlc3VsdHM6IFtdCiAgICAgIH0sCiAgICAgIHNvdW5kY2xvdWQ6IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBib3VuY2U6IG51bGwsCiAgICAgICAgdXJsOiAiIiwKICAgICAgICB0cmFjazogbnVsbAogICAgICB9LAogICAgICB5b3V0dWJlOiB7CiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgYm91bmNlOiBudWxsLAogICAgICAgIHVybDogIiIsCiAgICAgICAgdmlkZW9JZDogIiIsCiAgICAgICAgdmlkZW86IG51bGwKICAgICAgfSwKICAgICAgdmltZW86IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBib3VuY2U6IG51bGwsCiAgICAgICAgdXJsOiAiIiwKICAgICAgICB2aWRlb0lkOiAiIiwKICAgICAgICB2aWRlbzogbnVsbAogICAgICB9LAogICAgICBkYWlseW1vdGlvbjogewogICAgICAgIGlzTG9hZGluZzogZmFsc2UsCiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIGJvdW5jZTogbnVsbCwKICAgICAgICB1cmw6ICIiLAogICAgICAgIHZpZGVvSWQ6ICIiLAogICAgICAgIHZpZGVvOiBudWxsCiAgICAgIH0sCiAgICAgIHRlZFRhbGtzOiB7CiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgYm91bmNlOiBudWxsLAogICAgICAgIHVybDogIiIsCiAgICAgICAgdmlkZW86IG51bGwKICAgICAgfSwKICAgICAgeGhhbXN0ZXI6IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBib3VuY2U6IG51bGwsCiAgICAgICAgdXJsOiAiIiwKICAgICAgICB2aWRlbzogbnVsbAogICAgICB9LAogICAgICBmaW5kTG9nbzogewogICAgICAgIGlzTG9hZGluZzogZmFsc2UsCiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIGNvdW50cmllczogW10sCiAgICAgICAgY291bnRyeTogIiIsCiAgICAgICAgbG9nb3M6IFtdLAogICAgICAgIGxvZ286ICIiLAogICAgICAgIHNlYXJjaDogIiIsCiAgICAgICAgdGl0bGU6ICIiCiAgICAgIH0sCiAgICAgIGFzc2lnbkxvZ286IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBjb3VudHJpZXM6IFtdLAogICAgICAgIGNvdW50cnk6ICIiLAogICAgICAgIGxvZ29zOiBbXSwKICAgICAgICBhc3NpZ25BbGw6IDAKICAgICAgfSwKICAgICAgaW1wb3J0TTNVOiB7CiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgZ3JvdXBzOiBbXSwKICAgICAgICBpbXBvcnRHcm91cHM6IFtdLAogICAgICAgIG0zdTogbnVsbCwKICAgICAgICBmaWxlOiBudWxsCiAgICAgIH0sCiAgICAgIGZpbmRUVkdJRDogewogICAgICAgIGlzTG9hZGluZzogZmFsc2UsCiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIGNvdW50cmllczogW10sCiAgICAgICAgY291bnRyeTogIiIsCiAgICAgICAgY2hhbm5lbHM6IFtdLAogICAgICAgIGNoYW5uZWw6ICIiLAogICAgICAgIHNlYXJjaDogIiIsCiAgICAgICAgdGl0bGU6ICIiCiAgICAgIH0sCiAgICAgIGFzc2lnblRWR0lEOiB7CiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgY291bnRyaWVzOiBbXSwKICAgICAgICBjb3VudHJ5OiAiIiwKICAgICAgICBjaGFubmVsczogW10sCiAgICAgICAgYXNzaWduQWxsOiAwCiAgICAgIH0sCiAgICAgIHNhdmVDaGFuZ2VzOiB7CiAgICAgICAgbW9kYWw6IGZhbHNlCiAgICAgIH0sCiAgICAgIGdyb3VwVHlwZXM6IFt7CiAgICAgICAgdGV4dDogdGhpcy4kdCgieHRyZWFtLmxpdmUiKSwKICAgICAgICB2YWx1ZTogMQogICAgICB9LCB7CiAgICAgICAgdGV4dDogdGhpcy4kdCgieHRyZWFtLm1vdmllcyIpLAogICAgICAgIHZhbHVlOiAyCiAgICAgIH0sIHsKICAgICAgICB0ZXh0OiB0aGlzLiR0KCJ4dHJlYW0uc2VyaWVzIiksCiAgICAgICAgdmFsdWU6IDMKICAgICAgfV0KICAgIH07CiAgfSwKICBjb21wdXRlZDogX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBtYXBHZXR0ZXJzKFsiY3VycmVudFVzZXIiLCAic2V0dGluZ3MiLCAic291bmRjbG91ZENsaWVudElkIiwgIm1vdmllU2VyaWVQbGF5bGlzdCJdKSksIHt9LCB7CiAgICBzaG93VG9vbHRpcHM6IGZ1bmN0aW9uIHNob3dUb29sdGlwcygpIHsKICAgICAgcmV0dXJuIHRoaXMuc2V0dGluZ3Muc2hvd1Rvb2x0aXBzOwogICAgfSwKICAgIHNlYXJjaEZpbHRlcmVkOiBmdW5jdGlvbiBzZWFyY2hGaWx0ZXJlZCgpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIGlmICh0aGlzLnNlYXJjaCA9PT0gbnVsbCkgewogICAgICAgIHJldHVybiB0aGlzLmFjY291bnRzOwogICAgICB9IGVsc2UgewogICAgICAgIHZhciByZSA9IG5ldyBSZWdFeHAodGhpcy5zZWFyY2gsICJpIik7CiAgICAgICAgcmV0dXJuIHRoaXMuYWNjb3VudHMuZmlsdGVyKGZ1bmN0aW9uIChhY2NvdW50KSB7CiAgICAgICAgICByZXR1cm4gU3RyaW5nKGFjY291bnQudGl0bGUpLm1hdGNoKHJlKSB8fCBTdHJpbmcoYWNjb3VudC5ob3N0KS5tYXRjaChyZSkgfHwgU3RyaW5nKGFjY291bnQucG9ydCkubWF0Y2gocmUpIHx8IFN0cmluZyhhY2NvdW50LnVzZXJuYW1lKS5tYXRjaChyZSkgfHwgU3RyaW5nKGFjY291bnQucGFzc3dvcmQpLm1hdGNoKHJlKSB8fCBfdGhpcy5mb3JtYXREYXRlKGFjY291bnQuc3luY2VkX2F0KS5tYXRjaChyZSkgfHwgX3RoaXMuJHQoInN5bmMtaW50ZXJ2YWwuIi5jb25jYXQoYWNjb3VudC5zeW5jX2ludGVydmFsKSkubWF0Y2gocmUpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgcGxheWxpc3RTZWxlY3RlZDogZnVuY3Rpb24gcGxheWxpc3RTZWxlY3RlZCgpIHsKICAgICAgcmV0dXJuIHRoaXMucGxheWxpc3RFZGl0b3IuaWQgIT09IHVuZGVmaW5lZDsKICAgIH0sCiAgICBsYXN0U2VsZWN0ZWRHcm91cDogZnVuY3Rpb24gbGFzdFNlbGVjdGVkR3JvdXAoKSB7CiAgICAgIHJldHVybiB0aGlzLmFjdGl2ZUdyb3Vwc1t0aGlzLmFjdGl2ZUdyb3Vwcy5sZW5ndGggLSAxXTsKICAgIH0sCiAgICBsYXN0U2VsZWN0ZWRTdHJlYW06IGZ1bmN0aW9uIGxhc3RTZWxlY3RlZFN0cmVhbSgpIHsKICAgICAgcmV0dXJuIHRoaXMuYWN0aXZlU3RyZWFtc1t0aGlzLmFjdGl2ZVN0cmVhbXMubGVuZ3RoIC0gMV07CiAgICB9LAogICAgY2FuRWRpdEdyb3VwVHlwZTogZnVuY3Rpb24gY2FuRWRpdEdyb3VwVHlwZSgpIHsKICAgICAgcmV0dXJuIHRoaXMuZ3JvdXBFZGl0b3IuaWQgJiYgdGhpcy5nZXRHcm91cFdpdGhJZCh0aGlzLmdyb3VwRWRpdG9yLmlkKS5zdHJlYW1zID09IDA7CiAgICB9LAogICAgc3Vic2NyaXB0aW9uTGltaXRlZDogZnVuY3Rpb24gc3Vic2NyaXB0aW9uTGltaXRlZCgpIHsKICAgICAgcmV0dXJuIHRoaXMuY3VycmVudFVzZXIuc3Vic2NyaXB0aW9uICYmIHRoaXMuY3VycmVudFVzZXIuc3Vic2NyaXB0aW9uLnN1YnNjcmlwdGlvbl90eXBlID09IFN1YnNjcmlwdGlvblR5cGUuRW50aHVzaWFzdDsKICAgIH0sCiAgICBmaWx0ZXJlZEdyb3VwczogZnVuY3Rpb24gZmlsdGVyZWRHcm91cHMoKSB7CiAgICAgIGlmICh0aGlzLnN1YnNjcmlwdGlvbkxpbWl0ZWQpIHsKICAgICAgICByZXR1cm4gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmlsdGVyKGZ1bmN0aW9uIChncm91cCkgewogICAgICAgICAgcmV0dXJuIGdyb3VwLmdyb3VwX2lzX3JlbW92ZWQgIT09IDEgJiYgZ3JvdXAuc291cmNlX2dyb3VwX3R5cGUgPT0gMSAmJiBncm91cC5ncm91cF90eXBlID09IDE7CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maWx0ZXIoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgcmV0dXJuIGdyb3VwLmdyb3VwX2lzX3JlbW92ZWQgIT09IDE7CiAgICAgIH0pOwogICAgfSwKICAgIGZpbHRlcmVkU3RyZWFtczogZnVuY3Rpb24gZmlsdGVyZWRTdHJlYW1zKCkgewogICAgICByZXR1cm4gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmZpbHRlcihmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICByZXR1cm4gZ3JvdXAuc3RyZWFtX2lzX3JlbW92ZWQgIT09IDE7CiAgICAgIH0pOwogICAgfSwKICAgIGFjdGl2ZUdyb3VwVHlwZTogZnVuY3Rpb24gYWN0aXZlR3JvdXBUeXBlKCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIHZhciBpbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleChmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICByZXR1cm4gZ3JvdXAuaWQgPT0gX3RoaXMyLmFjdGl2ZUdyb3VwOwogICAgICB9KTsKICAgICAgcmV0dXJuIGluZGV4ID4gLTEgPyB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpbmRleF0uZ3JvdXBfdHlwZSA6IDA7CiAgICB9LAogICAgZmlsdGVyZWRMb2dvczogZnVuY3Rpb24gZmlsdGVyZWRMb2dvcygpIHsKICAgICAgaWYgKCF0aGlzLmZpbmRMb2dvLnNlYXJjaC5sZW5ndGgpIHsKICAgICAgICByZXR1cm4gdGhpcy5maW5kTG9nby5sb2dvczsKICAgICAgfQoKICAgICAgdmFyIHNlbGVjdGVkU3RyZWFtID0gdGhpcy5nZXRTdHJlYW1XaXRoSWQodGhpcy5hY3RpdmVTdHJlYW1zWzBdKTsKICAgICAgdmFyIHJlID0gbmV3IFJlZ0V4cCh0aGlzLmZpbmRMb2dvLnNlYXJjaCwgImkiKTsKICAgICAgcmV0dXJuIHRoaXMuZmluZExvZ28ubG9nb3MuZmlsdGVyKGZ1bmN0aW9uIChsb2dvKSB7CiAgICAgICAgcmV0dXJuIGxvZ28udGV4dC5tYXRjaChyZSk7CiAgICAgIH0pOwogICAgfSwKICAgIGZpbHRlcmVkVFZHSURTOiBmdW5jdGlvbiBmaWx0ZXJlZFRWR0lEUygpIHsKICAgICAgaWYgKCF0aGlzLmZpbmRUVkdJRC5zZWFyY2gubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZmluZFRWR0lELmNoYW5uZWxzOwogICAgICB9CgogICAgICB2YXIgc2VsZWN0ZWRTdHJlYW0gPSB0aGlzLmdldFN0cmVhbVdpdGhJZCh0aGlzLmFjdGl2ZVN0cmVhbXNbMF0pOwogICAgICB2YXIgcmUgPSBuZXcgUmVnRXhwKHRoaXMuZmluZFRWR0lELnNlYXJjaCwgImkiKTsKICAgICAgcmV0dXJuIHRoaXMuZmluZFRWR0lELmNoYW5uZWxzLmZpbHRlcihmdW5jdGlvbiAoY2hhbm5lbCkgewogICAgICAgIHJldHVybiBjaGFubmVsLnRleHQubWF0Y2gocmUpOwogICAgICB9KTsKICAgIH0sCiAgICBncm91cENvbnRleHRNZW51OiBmdW5jdGlvbiBncm91cENvbnRleHRNZW51KCkgewogICAgICB2YXIgdm0gPSB0aGlzOwogICAgICByZXR1cm4gW3sKICAgICAgICBpY29uOiAibGEtcGx1cyIsCiAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5hZGQtZ3JvdXAiKSwKICAgICAgICBvbkNsaWNrOiB2bS5hZGRHcm91cAogICAgICB9LCB7CiAgICAgICAgZGlzYWJsZWQ6IHZtLmFjdGl2ZUdyb3Vwcy5sZW5ndGggIT09IDEsCiAgICAgICAgaWNvbjogImxhLWVkaXQiLAogICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IuZWRpdC1ncm91cCIpLAogICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICBpZiAodm0uYWN0aXZlR3JvdXBzLmxlbmd0aCA9PT0gMSkgewogICAgICAgICAgICB2bS5lZGl0R3JvdXBNb2RhbCh0cnVlKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBkaXZpZGVyOiB0cnVlCiAgICAgIH0sIHsKICAgICAgICB0ZXh0OiB2bS4kdCgiZ2VuZXJhbC5zZWxlY3QtYWxsIiksCiAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgIHZtLmFjdGl2ZUdyb3VwcyA9IF90b0NvbnN1bWFibGVBcnJheSh2bS5wbGF5bGlzdEVkaXRvci5ncm91cHMubWFwKGZ1bmN0aW9uIChnKSB7CiAgICAgICAgICAgIHJldHVybiBnLmlkOwogICAgICAgICAgfSkpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIHRleHQ6IHZtLiR0KCJnZW5lcmFsLnNlbGVjdC1ub25lIiksCiAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgIHZtLmFjdGl2ZUdyb3VwcyA9IFtdOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGRpdmlkZXI6IHRydWUKICAgICAgfSwgewogICAgICAgIGljb246ICJsYS1zZWFyY2giLAogICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IuZmluZC1yZXBsYWNlIiksCiAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgIHZtLmZpbmRBbmRSZXBsYWNlTW9kYWwodHJ1ZSwgMSk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAgaWNvbjogImxhLXBlbiIsCiAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5hZGQtcHJlZml4LXN1ZmZpeCIpLAogICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICB2bS5wcmVmaXhTdWZmaXhNb2RhbCh0cnVlLCAxKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBpY29uOiAibGEtZm9udCIsCiAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5jaGFuZ2UtY2FzZSIpLAogICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICB2bS5jb252ZXJ0Q2FzZU1vZGFsKHRydWUsIDEpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGRpdmlkZXI6IHRydWUKICAgICAgfSwgewogICAgICAgIGRpc2FibGVkOiB2bS5hY3RpdmVHcm91cHMubGVuZ3RoID09PSAwLAogICAgICAgIGljb246ICJsYS1leWUiLAogICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IudG9nZ2xlLXZpc2liaWxpdHkiKSwKICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgaWYgKHZtLmFjdGl2ZUdyb3Vwcy5sZW5ndGgpIHsKICAgICAgICAgICAgdm0udG9nZ2xlR3JvdXBWaXNpYmlsaXR5KCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAgZGlzYWJsZWQ6IHZtLmFjdGl2ZUdyb3Vwcy5sZW5ndGggPT09IDAsCiAgICAgICAgaWNvbjogImxhLXRyYXNoIiwKICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLmRlbGV0ZSIpLAogICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICBpZiAodm0uYWN0aXZlR3JvdXBzLmxlbmd0aCkgewogICAgICAgICAgICB2bS5kZWxldGVTZWxlY3RlZEdyb3VwcygpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfV07CiAgICB9LAogICAgc3RyZWFtQ29udGV4dE1lbnU6IGZ1bmN0aW9uIHN0cmVhbUNvbnRleHRNZW51KCkgewogICAgICB2YXIgdm0gPSB0aGlzOwogICAgICByZXR1cm4gW3sKICAgICAgICBpY29uOiAibGEtcGx1cyIsCiAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5hZGQtc3RyZWFtIiksCiAgICAgICAgb25DbGljazogdm0uYWRkU3RyZWFtCiAgICAgIH0sIHsKICAgICAgICBkaXNhYmxlZDogdm0uYWN0aXZlU3RyZWFtcy5sZW5ndGggIT09IDEsCiAgICAgICAgaWNvbjogImxhLWVkaXQiLAogICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IuZWRpdC1zdHJlYW0iKSwKICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgaWYgKHZtLmFjdGl2ZVN0cmVhbXMubGVuZ3RoID09PSAxKSB7CiAgICAgICAgICAgIHZtLmVkaXRTdHJlYW1Nb2RhbCh0cnVlKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBkaXZpZGVyOiB0cnVlCiAgICAgIH0sIHsKICAgICAgICB0ZXh0OiB2bS4kdCgiZ2VuZXJhbC5zZWxlY3QtYWxsIiksCiAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgIHZtLmFjdGl2ZVN0cmVhbXMgPSBfdG9Db25zdW1hYmxlQXJyYXkodm0ucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5tYXAoZnVuY3Rpb24gKGcpIHsKICAgICAgICAgICAgcmV0dXJuIGcuaWQ7CiAgICAgICAgICB9KSk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAgdGV4dDogdm0uJHQoImdlbmVyYWwuc2VsZWN0LW5vbmUiKSwKICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgdm0uYWN0aXZlU3RyZWFtcyA9IFtdOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGRpdmlkZXI6IHRydWUKICAgICAgfSwgewogICAgICAgIGRpc2FibGVkOiB2bS5hY3RpdmVHcm91cHMubGVuZ3RoICE9PSAxIHx8IHZtLmFjdGl2ZVN0cmVhbXMubGVuZ3RoID09PSAwIHx8IHZtLmdldEdyb3VwV2l0aElkKHZtLmFjdGl2ZUdyb3Vwc1swXSkuZ3JvdXBfdHlwZSAhPT0gdm0uYWN0aXZlR3JvdXBUeXBlIHx8IHZtLmFjdGl2ZUdyb3Vwc1swXSA9PT0gdm0uYWN0aXZlR3JvdXAsCiAgICAgICAgaWNvbjogImxhLWNoZXZyb24tbGVmdCIsCiAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5tb3ZlLXRvLXNlbGVjdGVkLWdyb3VwIiksCiAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgIHZtLm1vdmVUb1NlbGVjdGVkR3JvdXAoKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBkaXZpZGVyOiB0cnVlCiAgICAgIH0sIHsKICAgICAgICBpY29uOiAibGEtc2VhcmNoIiwKICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLmZpbmQtcmVwbGFjZSIpLAogICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICB2bS5maW5kQW5kUmVwbGFjZU1vZGFsKHRydWUsIDIpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGljb246ICJsYS1wZW4iLAogICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IuYWRkLXByZWZpeC1zdWZmaXgiKSwKICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgdm0ucHJlZml4U3VmZml4TW9kYWwodHJ1ZSwgMik7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAgaWNvbjogImxhLWZvbnQiLAogICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IuY2hhbmdlLWNhc2UiKSwKICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgdm0uY29udmVydENhc2VNb2RhbCh0cnVlLCAyKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBkaXZpZGVyOiB0cnVlCiAgICAgIH0sIHsKICAgICAgICBkaXNhYmxlZDogdm0uYWN0aXZlU3RyZWFtcy5sZW5ndGggIT09IDEgfHwgdm0uYWN0aXZlR3JvdXBUeXBlICE9PSAxLAogICAgICAgIGljb246ICJsYS1waG90by12aWRlbyIsCiAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5maW5kLWxvZ28iKSwKICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgdm0uZmluZExvZ29Nb2RhbCh0cnVlKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBkaXNhYmxlZDogdm0uYWN0aXZlU3RyZWFtcy5sZW5ndGggIT09IDEgfHwgdm0uYWN0aXZlR3JvdXBUeXBlICE9PSAxLAogICAgICAgIGljb246ICJsYS10aC1saXN0IiwKICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLmZpbmQtdHYtZ3VpZGUiKSwKICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgdm0uZmluZFRWR0lETW9kYWwodHJ1ZSk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAgZGl2aWRlcjogdHJ1ZQogICAgICB9LCB7CiAgICAgICAgZGlzYWJsZWQ6IHZtLmFjdGl2ZVN0cmVhbXMubGVuZ3RoID09PSAwIHx8IHZtLmFjdGl2ZUdyb3VwVHlwZSAhPT0gMSwKICAgICAgICBpY29uOiAibGEtbXVzaWMiLAogICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IudG9nZ2xlLXJhZGlvIiksCiAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgIGlmICh2bS5hY3RpdmVTdHJlYW1zLmxlbmd0aCAmJiB2bS5hY3RpdmVHcm91cFR5cGUgPT0gMSkgewogICAgICAgICAgICB2bS50b2dnbGVTdHJlYW1SYWRpbygpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGRpc2FibGVkOiB2bS5hY3RpdmVTdHJlYW1zLmxlbmd0aCA9PT0gMCwKICAgICAgICBpY29uOiAibGEtZXllIiwKICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLnRvZ2dsZS12aXNpYmlsaXR5IiksCiAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgIGlmICh2bS5hY3RpdmVTdHJlYW1zLmxlbmd0aCkgewogICAgICAgICAgICB2bS50b2dnbGVTdHJlYW1WaXNpYmlsaXR5KCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAgZGl2aWRlcjogdHJ1ZQogICAgICB9LCB7CiAgICAgICAgZGlzYWJsZWQ6IHZtLmFjdGl2ZVN0cmVhbXMubGVuZ3RoID09PSAwLAogICAgICAgIGljb246ICJsYS10cmFzaCIsCiAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5kZWxldGUiKSwKICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgaWYgKHZtLmFjdGl2ZVN0cmVhbXMubGVuZ3RoKSB7CiAgICAgICAgICAgIHZtLmRlbGV0ZVNlbGVjdGVkU3RyZWFtcygpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfV07CiAgICB9CiAgfSksCiAgbWV0aG9kczogewogICAgZ3JvdXBEcmFnQ2hhbmdlZDogZnVuY3Rpb24gZ3JvdXBEcmFnQ2hhbmdlZChnKSB7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAodGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uZ3JvdXBfb3JkZXIgIT0gaSArIDEpIHsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmdyb3VwX29yZGVyID0gaSArIDE7CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgc3RyZWFtRHJhZ0NoYW5nZWQ6IGZ1bmN0aW9uIHN0cmVhbURyYWdDaGFuZ2VkKGcpIHsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAodGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLnN0cmVhbV9vcmRlciAhPSBpICsgMSkgewogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLnN0cmVhbV9vcmRlciA9IGkgKyAxOwogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBvcGVuQ29udGV4dDogZnVuY3Rpb24gb3BlbkNvbnRleHQoY29udGV4dCkgewogICAgICB0aGlzLiRyZWZzW2NvbnRleHRdLm9wZW4oKTsKICAgIH0sCiAgICBzZWFyY2hFZGl0b3I6IGZ1bmN0aW9uIHNlYXJjaEVkaXRvcihzZWFyY2gpIHsKICAgICAgaWYgKHNlYXJjaC5sZW5ndGggPT09IDApIHsKICAgICAgICB0aGlzLnNlYXJjaCA9IG51bGw7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zZWFyY2ggPSBzZWFyY2g7CiAgICAgIH0KICAgIH0sCiAgICBwcmludEVkaXRvcjogZnVuY3Rpb24gcHJpbnRFZGl0b3IoKSB7CiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlZGl0b3IiKS5wcmludCgpOwogICAgfSwKICAgIGZvcm1hdE51bWJlcjogZnVuY3Rpb24gZm9ybWF0TnVtYmVyKG51bWJlcikgewogICAgICByZXR1cm4gbmV3IEludGwuTnVtYmVyRm9ybWF0KHRoaXMuJHQoImRhdGUubG9jYWxlIikpLmZvcm1hdChudW1iZXIpOwogICAgfSwKICAgIGZvcm1hdERhdGU6IGZ1bmN0aW9uIGZvcm1hdERhdGUoZGF0ZSkgewogICAgICByZXR1cm4gbmV3IERhdGUoZGF0ZSkudG9Mb2NhbGVTdHJpbmcodGhpcy4kdCgiZGF0ZS5sb2NhbGUiKSwgdGhpcy5kYXRlT3B0aW9ucyk7CiAgICB9LAogICAgZm9ybWF0RGF0ZVlvdXR1YmU6IGZ1bmN0aW9uIGZvcm1hdERhdGVZb3V0dWJlKGRhdGUpIHsKICAgICAgcmV0dXJuIG5ldyBEYXRlKGRhdGUpLnRvTG9jYWxlRGF0ZVN0cmluZyh0aGlzLiR0KCJkYXRlLmxvY2FsZSIpLCB7CiAgICAgICAgeWVhcjogIm51bWVyaWMiLAogICAgICAgIG1vbnRoOiAic2hvcnQiLAogICAgICAgIGRheTogIm51bWVyaWMiCiAgICAgIH0pOwogICAgfSwKICAgIGZvcm1hdFNlY29uZHM6IGZ1bmN0aW9uIGZvcm1hdFNlY29uZHMoc2VjKSB7CiAgICAgIHZhciBkID0gTnVtYmVyKHNlYyk7CiAgICAgIHZhciBoID0gTWF0aC5mbG9vcihkIC8gMzYwMCk7CiAgICAgIHZhciBtID0gTWF0aC5mbG9vcihkICUgMzYwMCAvIDYwKTsKICAgICAgdmFyIHMgPSBNYXRoLmZsb29yKGQgJSAzNjAwICUgNjApOwogICAgICB2YXIgaG91ciA9IHRoaXMuJHQoImdlbmVyYWwuaG91ciIpOwogICAgICB2YXIgaG91cnMgPSB0aGlzLiR0KCJnZW5lcmFsLmhvdXJzIik7CiAgICAgIHZhciBtaW51dGUgPSB0aGlzLiR0KCJnZW5lcmFsLm1pbnV0ZSIpOwogICAgICB2YXIgbWludXRlcyA9IHRoaXMuJHQoImdlbmVyYWwubWludXRlcyIpOwogICAgICB2YXIgc2Vjb25kID0gdGhpcy4kdCgiZ2VuZXJhbC5zZWNvbmQiKTsKICAgICAgdmFyIHNlY29uZHMgPSB0aGlzLiR0KCJnZW5lcmFsLnNlY29uZHMiKTsKICAgICAgdmFyIGhEaXNwbGF5ID0gaCA+IDAgPyBoICsgKGggPT0gMSA/ICIgIi5jb25jYXQoaG91ciwgIiAiKSA6ICIgIi5jb25jYXQoaG91cnMsICIgIikpIDogIiI7CiAgICAgIHZhciBtRGlzcGxheSA9IG0gPiAwID8gbSArIChtID09IDEgPyAiICIuY29uY2F0KG1pbnV0ZSwgIiAiKSA6ICIgIi5jb25jYXQobWludXRlcywgIiAiKSkgOiAiIjsKICAgICAgdmFyIHNEaXNwbGF5ID0gcyA+IDAgPyBzICsgKHMgPT0gMSA/ICIgIi5jb25jYXQoc2Vjb25kLCAiICIpIDogIiAiLmNvbmNhdChzZWNvbmRzLCAiICIpKSA6ICIiOwogICAgICByZXR1cm4gaERpc3BsYXkgKyBtRGlzcGxheSArIHNEaXNwbGF5OwogICAgfSwKICAgIGdldEdyb3VwV2l0aElkOiBmdW5jdGlvbiBnZXRHcm91cFdpdGhJZChpZCkgewogICAgICB2YXIgaW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgcmV0dXJuIGdyb3VwLmlkID09IGlkOwogICAgICB9KTsKICAgICAgcmV0dXJuIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2luZGV4XTsKICAgIH0sCiAgICBnZXRTdHJlYW1XaXRoSWQ6IGZ1bmN0aW9uIGdldFN0cmVhbVdpdGhJZChpZCkgewogICAgICB2YXIgaW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMuZmluZEluZGV4KGZ1bmN0aW9uIChzdHJlYW0pIHsKICAgICAgICByZXR1cm4gc3RyZWFtLmlkID09IGlkOwogICAgICB9KTsKICAgICAgcmV0dXJuIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF07CiAgICB9LAogICAgZG9TYXZlOiBmdW5jdGlvbiBkb1NhdmUoKSB7CiAgICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSBmYWxzZTsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgICAgdmFyIGluZGV4ID0gX3RoaXMzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgICByZXR1cm4gZ3JvdXAuaWQgPT0gX3RoaXMzLmFjdGl2ZUdyb3VwOwogICAgICAgIH0pOwoKICAgICAgICB2YXIgdXBkYXRlR3JvdXBzID0gX3RoaXMzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maWx0ZXIoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgICByZXR1cm4gIWdyb3VwLmdyb3VwX2lzX3JlbW92ZWQgJiYgZ3JvdXAubW9kaWZpZWQ7CiAgICAgICAgfSkubWFwKGZ1bmN0aW9uIChncm91cCkgewogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgaWQ6IGdyb3VwLmlkLAogICAgICAgICAgICBncm91cF9uYW1lOiBncm91cC5ncm91cF9uYW1lLAogICAgICAgICAgICBncm91cF9vcmRlcjogZ3JvdXAuZ3JvdXBfb3JkZXIsCiAgICAgICAgICAgIGdyb3VwX3R5cGU6IGdyb3VwLmdyb3VwX3R5cGUsCiAgICAgICAgICAgIGdyb3VwX3BhcmVudF9jb2RlOiBncm91cC5ncm91cF9wYXJlbnRfY29kZSwKICAgICAgICAgICAgZ3JvdXBfaXNfaGlkZGVuOiBncm91cC5ncm91cF9pc19oaWRkZW4KICAgICAgICAgIH07CiAgICAgICAgfSk7CgogICAgICAgIHZhciBkZWxldGVHcm91cHMgPSBfdGhpczMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbHRlcihmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICAgIHJldHVybiBncm91cC5ncm91cF9pc19yZW1vdmVkICYmIGdyb3VwLm1vZGlmaWVkOwogICAgICAgIH0pLm1hcChmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICAgIHJldHVybiBncm91cC5pZDsKICAgICAgICB9KS5qb2luKCk7CgogICAgICAgIHZhciB1cGRhdGVTdHJlYW1zOwoKICAgICAgICBzd2l0Y2ggKF90aGlzMy5hY3RpdmVHcm91cFR5cGUpIHsKICAgICAgICAgIC8vIExpdmUgc3RyZWFtcwogICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICB1cGRhdGVTdHJlYW1zID0gX3RoaXMzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMuZmlsdGVyKGZ1bmN0aW9uIChzdHJlYW0pIHsKICAgICAgICAgICAgICByZXR1cm4gc3RyZWFtLnN0cmVhbV9pc19yZW1vdmVkICE9PSAxICYmIHN0cmVhbS5tb2RpZmllZDsKICAgICAgICAgICAgfSkubWFwKGZ1bmN0aW9uIChzdHJlYW0pIHsKICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgaWQ6IHN0cmVhbS5pZCwKICAgICAgICAgICAgICAgIHNvdXJjZV9zdHJlYW1fdXJsOiBzdHJlYW0uc291cmNlX3N0cmVhbV91cmwsCiAgICAgICAgICAgICAgICBzdHJlYW1fdHZnX25hbWU6IHN0cmVhbS5zdHJlYW1fdHZnX25hbWUsCiAgICAgICAgICAgICAgICBzdHJlYW1fdHZnX2lkOiBzdHJlYW0uc3RyZWFtX3R2Z19pZCwKICAgICAgICAgICAgICAgIHN0cmVhbV90dmdfbG9nbzogc3RyZWFtLnN0cmVhbV90dmdfbG9nbywKICAgICAgICAgICAgICAgIHN0cmVhbV9wYXJlbnRfY29kZTogc3RyZWFtLnN0cmVhbV9wYXJlbnRfY29kZSwKICAgICAgICAgICAgICAgIHN0cmVhbV9yYWRpbzogc3RyZWFtLnN0cmVhbV9yYWRpbywKICAgICAgICAgICAgICAgIHN0cmVhbV9pc19oaWRkZW46IHN0cmVhbS5zdHJlYW1faXNfaGlkZGVuLAogICAgICAgICAgICAgICAgc3RyZWFtX29yZGVyOiBzdHJlYW0uc3RyZWFtX29yZGVyCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgLy8gTW92aWVzCgogICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICB1cGRhdGVTdHJlYW1zID0gX3RoaXMzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMuZmlsdGVyKGZ1bmN0aW9uIChzdHJlYW0pIHsKICAgICAgICAgICAgICByZXR1cm4gc3RyZWFtLnN0cmVhbV9pc19yZW1vdmVkICE9PSAxICYmIHN0cmVhbS5tb2RpZmllZDsKICAgICAgICAgICAgfSkubWFwKGZ1bmN0aW9uIChzdHJlYW0pIHsKICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgaWQ6IHN0cmVhbS5pZCwKICAgICAgICAgICAgICAgIHNvdXJjZV9zdHJlYW1fdXJsOiBzdHJlYW0uc291cmNlX3N0cmVhbV91cmwsCiAgICAgICAgICAgICAgICBtb3ZpZV9uYW1lOiBzdHJlYW0ubW92aWVfbmFtZSwKICAgICAgICAgICAgICAgIG1vdmllX3llYXI6IHN0cmVhbS5tb3ZpZV95ZWFyLAogICAgICAgICAgICAgICAgdG1kYl9pZDogc3RyZWFtLnRtZGJfaWQsCiAgICAgICAgICAgICAgICBzdHJlYW1fdHZnX2xvZ286IHN0cmVhbS5zdHJlYW1fdHZnX2xvZ28sCiAgICAgICAgICAgICAgICBzdHJlYW1faXNfaGlkZGVuOiBzdHJlYW0uc3RyZWFtX2lzX2hpZGRlbiwKICAgICAgICAgICAgICAgIHN0cmVhbV9vcmRlcjogc3RyZWFtLnN0cmVhbV9vcmRlcgogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIC8vIFNlcmllcwoKICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgdXBkYXRlU3RyZWFtcyA9IF90aGlzMy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmZpbHRlcihmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHN0cmVhbS5zdHJlYW1faXNfcmVtb3ZlZCAhPT0gMSAmJiBzdHJlYW0ubW9kaWZpZWQ7CiAgICAgICAgICAgIH0pLm1hcChmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGlkOiBzdHJlYW0uaWQsCiAgICAgICAgICAgICAgICBzb3VyY2Vfc3RyZWFtX3VybDogc3RyZWFtLnNvdXJjZV9zdHJlYW1fdXJsLAogICAgICAgICAgICAgICAgc2VyaWVfbmFtZTogc3RyZWFtLnNlcmllX25hbWUsCiAgICAgICAgICAgICAgICBzZXJpZV9zZWFzb246IHN0cmVhbS5zZXJpZV9zZWFzb24sCiAgICAgICAgICAgICAgICBzZXJpZV9lcGlzb2RlOiBzdHJlYW0uc2VyaWVfZXBpc29kZSwKICAgICAgICAgICAgICAgIHRtZGJfaWQ6IHN0cmVhbS50bWRiX2lkLAogICAgICAgICAgICAgICAgc3RyZWFtX3R2Z19sb2dvOiBzdHJlYW0uc3RyZWFtX3R2Z19sb2dvLAogICAgICAgICAgICAgICAgc3RyZWFtX2lzX2hpZGRlbjogc3RyZWFtLnN0cmVhbV9pc19oaWRkZW4sCiAgICAgICAgICAgICAgICBzdHJlYW1fb3JkZXI6IHN0cmVhbS5zdHJlYW1fb3JkZXIKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICB2YXIgZGVsZXRlU3RyZWFtcyA9IF90aGlzMy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmZpbHRlcihmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAgICAgICByZXR1cm4gc3RyZWFtLnN0cmVhbV9pc19yZW1vdmVkID09PSAxICYmIHN0cmVhbS5tb2RpZmllZDsKICAgICAgICB9KS5tYXAoZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgICAgcmV0dXJuIHN0cmVhbS5pZDsKICAgICAgICB9KS5qb2luKCk7CgogICAgICAgIHZhciByZXF1ZXN0cyA9IFtdOwoKICAgICAgICBpZiAodXBkYXRlR3JvdXBzLmxlbmd0aCkgewogICAgICAgICAgcmVxdWVzdHMucHVzaChodHRwU2VydmljZS5wb3N0KCJlZGl0b3IvdXBkYXRlLWdyb3VwcyIsIHsKICAgICAgICAgICAgcGxheWxpc3RfaWQ6IF90aGlzMy5wbGF5bGlzdEVkaXRvci5pZCwKICAgICAgICAgICAgZ3JvdXBzOiB1cGRhdGVHcm91cHMKICAgICAgICAgIH0pKTsKICAgICAgICB9CgogICAgICAgIGlmIChkZWxldGVHcm91cHMubGVuZ3RoKSB7CiAgICAgICAgICBpbmRleCA9IDA7CiAgICAgICAgICByZXF1ZXN0cy5wdXNoKGh0dHBTZXJ2aWNlLnBvc3QoImVkaXRvci9kZWxldGUtZ3JvdXBzIiwgewogICAgICAgICAgICBwbGF5bGlzdF9pZDogX3RoaXMzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgICBncm91cHM6IGRlbGV0ZUdyb3VwcwogICAgICAgICAgfSkpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHVwZGF0ZVN0cmVhbXMubGVuZ3RoKSB7CiAgICAgICAgICByZXF1ZXN0cy5wdXNoKGh0dHBTZXJ2aWNlLnBvc3QoImVkaXRvci91cGRhdGUtc3RyZWFtcy8iLmNvbmNhdChfdGhpczMuYWN0aXZlR3JvdXBUeXBlKSwgewogICAgICAgICAgICBwbGF5bGlzdF9pZDogX3RoaXMzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgICBzdHJlYW1zOiB1cGRhdGVTdHJlYW1zCiAgICAgICAgICB9KSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoZGVsZXRlU3RyZWFtcy5sZW5ndGgpIHsKICAgICAgICAgIHJlcXVlc3RzLnB1c2goaHR0cFNlcnZpY2UucG9zdCgiZWRpdG9yL2RlbGV0ZS1zdHJlYW1zLyIuY29uY2F0KF90aGlzMy5hY3RpdmVHcm91cFR5cGUpLCB7CiAgICAgICAgICAgIHBsYXlsaXN0X2lkOiBfdGhpczMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICAgIHN0cmVhbXM6IGRlbGV0ZVN0cmVhbXMKICAgICAgICAgIH0pKTsKICAgICAgICB9CgogICAgICAgIFByb21pc2UuYWxsKHJlcXVlc3RzKS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICAgIF90aGlzMy5sb2FkUGxheWxpc3QoX3RoaXMzLnBsYXlsaXN0RWRpdG9yLmlkLCBpbmRleCk7CgogICAgICAgICAgcmVzb2x2ZShyZXMpOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0sCiAgICBkb0NhbmNlbDogZnVuY3Rpb24gZG9DYW5jZWwoKSB7CiAgICAgIHZhciBfdGhpczQgPSB0aGlzOwoKICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBQcm9taXNlLmFsbChbdGhpcy5yZXN0b3JlR3JvdXBzKCksIHRoaXMucmVzdG9yZVN0cmVhbXMoKV0pLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzNC5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gZmFsc2U7CiAgICAgICAgX3RoaXM0LmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9KTsKICAgIH0sCiAgICBkb1RhYkNoYW5nZTogZnVuY3Rpb24gZG9UYWJDaGFuZ2UodGFiKSB7CiAgICAgIHRoaXMuYWN0aXZlVGFiID0gdGFiOwogICAgfSwKICAgIHVwZGF0ZUdyb3VwT3JkZXI6IGZ1bmN0aW9uIHVwZGF0ZUdyb3VwT3JkZXIoc291cmNlKSB7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkgewogICAgICAgIHZhciBncm91cHMgPSBfdG9Db25zdW1hYmxlQXJyYXkoc291cmNlKTsKCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBncm91cHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGdyb3Vwc1tpXS5zb3VyY2VfZ3JvdXBfb3JkZXIgPSBpICsgMTsKICAgICAgICAgIGdyb3Vwc1tpXS5ncm91cF9vcmRlciA9IGkgKyAxOwogICAgICAgIH0KCiAgICAgICAgcmVzb2x2ZShncm91cHMpOwogICAgICB9KTsKICAgIH0sCiAgICB1cGRhdGVTdHJlYW1PcmRlcjogZnVuY3Rpb24gdXBkYXRlU3RyZWFtT3JkZXIoc291cmNlKSB7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkgewogICAgICAgIHZhciBzdHJlYW1zID0gX3RvQ29uc3VtYWJsZUFycmF5KHNvdXJjZSk7CgogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3RyZWFtcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgc3RyZWFtc1tpXS5zb3VyY2Vfc3RyZWFtX29yZGVyID0gaSArIDE7CiAgICAgICAgICBzdHJlYW1zW2ldLnN0cmVhbV9vcmRlciA9IGkgKyAxOwogICAgICAgIH0KCiAgICAgICAgcmVzb2x2ZShzdHJlYW1zKTsKICAgICAgfSk7CiAgICB9LAogICAgcmVzdG9yZUdyb3VwT3JkZXI6IGZ1bmN0aW9uIHJlc3RvcmVHcm91cE9yZGVyKCkgewogICAgICB2YXIgX3RoaXM1ID0gdGhpczsKCiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkgewogICAgICAgIF90aGlzNS5wbGF5bGlzdEVkaXRvci5ncm91cHMuc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgcmV0dXJuIGEuc291cmNlX2dyb3VwX29yZGVyID4gYi5zb3VyY2VfZ3JvdXBfb3JkZXIgPyAxIDogYi5zb3VyY2VfZ3JvdXBfb3JkZXIgPiBhLnNvdXJjZV9ncm91cF9vcmRlciA/IC0xIDogMDsKICAgICAgICB9KTsKCiAgICAgICAgcmVzb2x2ZSgpOwogICAgICB9KTsKICAgIH0sCiAgICByZXN0b3JlU3RyZWFtT3JkZXI6IGZ1bmN0aW9uIHJlc3RvcmVTdHJlYW1PcmRlcigpIHsKICAgICAgdmFyIF90aGlzNiA9IHRoaXM7CgogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgICAgICBfdGhpczYucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICByZXR1cm4gYS5zb3VyY2Vfc3RyZWFtX29yZGVyID4gYi5zb3VyY2Vfc3RyZWFtX29yZGVyID8gMSA6IGIuc291cmNlX3N0cmVhbV9vcmRlciA+IGEuc291cmNlX3N0cmVhbV9vcmRlciA/IC0xIDogMDsKICAgICAgICB9KTsKCiAgICAgICAgcmVzb2x2ZSgpOwogICAgICB9KTsKICAgIH0sCiAgICByZXN0b3JlR3JvdXBzOiBmdW5jdGlvbiByZXN0b3JlR3JvdXBzKCkgewogICAgICB2YXIgX3RoaXM3ID0gdGhpczsKCiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkgewogICAgICAgIF90aGlzNy5yZXN0b3JlR3JvdXBPcmRlcigpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIGdyb3VwOwoKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgX3RoaXM3LnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBncm91cCA9IF90aGlzNy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV07CiAgICAgICAgICAgIGdyb3VwLm1vZGlmaWVkID0gZmFsc2U7CiAgICAgICAgICAgIGdyb3VwLmdyb3VwX2lzX3JlbW92ZWQgPSAwOwogICAgICAgICAgICBncm91cC5ncm91cF90eXBlID0gZ3JvdXAuc291cmNlX2dyb3VwX3R5cGU7CiAgICAgICAgICAgIGdyb3VwLmdyb3VwX25hbWUgPSBncm91cC5zb3VyY2VfZ3JvdXBfbmFtZTsKICAgICAgICAgICAgZ3JvdXAucGFyZW50X2NvZGUgPSBncm91cC5zb3VyY2VfZ3JvdXBfcGFyZW50X2NvZGU7CiAgICAgICAgICAgIGdyb3VwLmdyb3VwX2lzX2hpZGRlbiA9IGdyb3VwLnNvdXJjZV9ncm91cF9pc19oaWRkZW47CiAgICAgICAgICB9CgogICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0sCiAgICByZXN0b3JlU3RyZWFtczogZnVuY3Rpb24gcmVzdG9yZVN0cmVhbXMoKSB7CiAgICAgIHZhciBfdGhpczggPSB0aGlzOwoKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgICAgX3RoaXM4LnJlc3RvcmVTdHJlYW1PcmRlcigpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIHN0cmVhbTsKCiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IF90aGlzOC5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHN0cmVhbSA9IF90aGlzOC5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldOwogICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSBmYWxzZTsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV9pc19yZW1vdmVkID0gMDsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfbmFtZSA9IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX3R2Z19uYW1lOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19pZCA9IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX3R2Z19pZDsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfbG9nbyA9IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX3R2Z19sb2dvOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19jaG5vID0gc3RyZWFtLnNvdXJjZV9zdHJlYW1fdHZnX2Nobm87CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX3NoaWZ0ID0gc3RyZWFtLnNvdXJjZV9zdHJlYW1fdHZnX3NoaWZ0OwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3BhcmVudF9jb2RlID0gc3RyZWFtLnNvdXJjZV9zdHJlYW1fcGFyZW50X2NvZGU7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fYXVkaW9fdHJhY2sgPSBzdHJlYW0uc291cmNlX3N0cmVhbV9hdWRpb190cmFjazsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV9hc3BlY3RfcmF0aW8gPSBzdHJlYW0uc291cmNlX3N0cmVhbV9hc3BlY3RfcmF0aW87CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fcmFkaW8gPSBzdHJlYW0uc291cmNlX3N0cmVhbV9yYWRpbzsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV9vcmRlciA9IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX29yZGVyOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX2lzX2hpZGRlbiA9IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX2lzX2hpZGRlbjsKCiAgICAgICAgICAgIGlmIChzdHJlYW0ubW92aWVfbmFtZSAhPT0gdW5kZWZpbmVkICYmIHN0cmVhbS5tb3ZpZV95ZWFyICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICBzdHJlYW0ubW92aWVfbmFtZSA9IHN0cmVhbS5zb3VyY2VfbW92aWVfbmFtZTsKICAgICAgICAgICAgICBzdHJlYW0ubW92aWVfeWVhciA9IHN0cmVhbS5zb3VyY2VfbW92aWVfeWVhcjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHN0cmVhbS5zZXJpZV9uYW1lICE9PSB1bmRlZmluZWQgJiYgc3RyZWFtLnNlcmllX3NlYXNvbiAhPT0gdW5kZWZpbmVkICYmIHN0cmVhbS5zZXJpZV9lcGlzb2RlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICBzdHJlYW0uc2VyaWVfbmFtZSA9IHN0cmVhbS5zb3VyY2Vfc2VyaWVfbmFtZTsKICAgICAgICAgICAgICBzdHJlYW0uc2VyaWVfc2Vhc29uID0gc3RyZWFtLnNvdXJjZV9zZXJpZV9zZWFzb247CiAgICAgICAgICAgICAgc3RyZWFtLnNlcmllX2VwaXNvZGUgPSBzdHJlYW0uc291cmNlX3NlcmllX2VwaXNvZGU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICByZXNvbHZlKCk7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSwKICAgIHRvZ2dsZUdyb3VwVmlzaWJpbGl0eTogZnVuY3Rpb24gdG9nZ2xlR3JvdXBWaXNpYmlsaXR5KCkgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBzLmluY2x1ZGVzKHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmlkKSkgewogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uZ3JvdXBfaXNfaGlkZGVuID0gIXRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmdyb3VwX2lzX2hpZGRlbjsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICB9LAogICAgdG9nZ2xlU3RyZWFtVmlzaWJpbGl0eTogZnVuY3Rpb24gdG9nZ2xlU3RyZWFtVmlzaWJpbGl0eSgpIHsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAodGhpcy5hY3RpdmVTdHJlYW1zLmluY2x1ZGVzKHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5pZCkpIHsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5zdHJlYW1faXNfaGlkZGVuID0gIXRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5zdHJlYW1faXNfaGlkZGVuOwogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICB9LAogICAgdG9nZ2xlU3RyZWFtUmFkaW86IGZ1bmN0aW9uIHRvZ2dsZVN0cmVhbVJhZGlvKCkgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmICh0aGlzLmFjdGl2ZVN0cmVhbXMuaW5jbHVkZXModGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLmlkKSkgewogICAgICAgICAgaWYgKHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5zdHJlYW1fcmFkaW8gPT0gMCkgewogICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uc3RyZWFtX3JhZGlvID0gMTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5zdHJlYW1fcmFkaW8gPSAwOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgfSwKICAgIGRlbGV0ZVNlbGVjdGVkR3JvdXBzOiBmdW5jdGlvbiBkZWxldGVTZWxlY3RlZEdyb3VwcygpIHsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3Vwcy5pbmNsdWRlcyh0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5pZCkpIHsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmdyb3VwX2lzX3JlbW92ZWQgPSAxOwogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgIH0sCiAgICBkZWxldGVTZWxlY3RlZFN0cmVhbXM6IGZ1bmN0aW9uIGRlbGV0ZVNlbGVjdGVkU3RyZWFtcygpIHsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAodGhpcy5hY3RpdmVTdHJlYW1zLmluY2x1ZGVzKHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5pZCkpIHsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5zdHJlYW1faXNfcmVtb3ZlZCA9IDE7CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgIH0sCiAgICBsb2FkUGxheWxpc3Q6IGZ1bmN0aW9uIGxvYWRQbGF5bGlzdCh2YWwpIHsKICAgICAgdmFyIF90aGlzOSA9IHRoaXM7CgogICAgICB2YXIgZ3JvdXBfaW5kZXggPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZDsKICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlOwoKICAgICAgaWYgKHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCkgewogICAgICAgIHRoaXMuZG9TYXZlKCk7CiAgICAgIH0KCiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuaWQgPSB2YWw7CiAgICAgIGh0dHBTZXJ2aWNlLmdldCgiZWRpdG9yL2dyb3Vwcy8iLmNvbmNhdCh2YWwpKS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICBpZiAocmVzLnN0YXR1cyA9PT0gdHJ1ZSkgewogICAgICAgICAgX3RoaXM5LnVwZGF0ZUdyb3VwT3JkZXIocmVzLmRhdGEpLnRoZW4oZnVuY3Rpb24gKGdyb3VwcykgewogICAgICAgICAgICBfdGhpczkucGxheWxpc3RFZGl0b3IuZ3JvdXBzID0gZ3JvdXBzLm1hcChmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICAgICAgICB2YXIgZ3JwID0gT2JqZWN0LmFzc2lnbih7fSwgZ3JvdXApOwogICAgICAgICAgICAgIGdycC5zb3VyY2VfZ3JvdXBfcGFyZW50X2NvZGUgPSBncm91cC5ncm91cF9wYXJlbnRfY29kZTsKICAgICAgICAgICAgICBncnAuc291cmNlX2dyb3VwX2lzX2hpZGRlbiA9IGdyb3VwLmdyb3VwX2lzX2hpZGRlbjsKICAgICAgICAgICAgICBncnAuc291cmNlX2dyb3VwX25hbWUgPSBncm91cC5ncm91cF9uYW1lOwogICAgICAgICAgICAgIGdycC5zb3VyY2VfZ3JvdXBfdHlwZSA9IGdyb3VwLmdyb3VwX3R5cGU7CiAgICAgICAgICAgICAgZ3JwLmdyb3VwX2lzX3JlbW92ZWQgPSBmYWxzZTsKICAgICAgICAgICAgICBncnAubW9kaWZpZWQgPSBmYWxzZTsKICAgICAgICAgICAgICByZXR1cm4gZ3JwOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGlmIChncm91cHMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgaWYgKGdyb3VwX2luZGV4ID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIF90aGlzOS5hY3RpdmVHcm91cCA9IF90aGlzOS5wbGF5bGlzdEVkaXRvci5ncm91cHNbMF0uaWQ7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIF90aGlzOS5hY3RpdmVHcm91cCA9IF90aGlzOS5wbGF5bGlzdEVkaXRvci5ncm91cHNbZ3JvdXBfaW5kZXhdLmlkOwoKICAgICAgICAgICAgICAgIF90aGlzOS5sb2FkU3RyZWFtcygpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBfdGhpczkuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczkuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0pOwogICAgfSwKICAgIHRvZ2dsZUdyb3VwU2VsZWN0aW9uOiBmdW5jdGlvbiB0b2dnbGVHcm91cFNlbGVjdGlvbihpdGVtKSB7CiAgICAgIHZhciBpZHggPSB0aGlzLmFjdGl2ZUdyb3Vwcy5pbmRleE9mKGl0ZW0pOwoKICAgICAgaWYgKGlkeCAhPT0gLTEpIHsKICAgICAgICB0aGlzLmFjdGl2ZUdyb3Vwcy5zcGxpY2UoaWR4LCAxKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmFjdGl2ZUdyb3Vwcy5wdXNoKGl0ZW0pOwogICAgICB9CiAgICB9LAogICAgdG9nZ2xlU3RyZWFtU2VsZWN0aW9uOiBmdW5jdGlvbiB0b2dnbGVTdHJlYW1TZWxlY3Rpb24oaXRlbSkgewogICAgICB2YXIgaWR4ID0gdGhpcy5hY3RpdmVTdHJlYW1zLmluZGV4T2YoaXRlbSk7CgogICAgICBpZiAoaWR4ICE9PSAtMSkgewogICAgICAgIHRoaXMuYWN0aXZlU3RyZWFtcy5zcGxpY2UoaWR4LCAxKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmFjdGl2ZVN0cmVhbXMucHVzaChpdGVtKTsKICAgICAgfQogICAgfSwKICAgIHRvZ2dsZVJhZGlvYnJvd3NlclNlbGVjdGlvbjogZnVuY3Rpb24gdG9nZ2xlUmFkaW9icm93c2VyU2VsZWN0aW9uKGl0ZW0pIHsKICAgICAgdmFyIGlkeCA9IHRoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZS5pbmRleE9mKGl0ZW0pOwoKICAgICAgaWYgKGlkeCAhPT0gLTEpIHsKICAgICAgICB0aGlzLnJhZGlvQnJvd3Nlci5hY3RpdmUuc3BsaWNlKGlkeCwgMSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuYWN0aXZlLnB1c2goaXRlbSk7CiAgICAgIH0KICAgIH0sCiAgICB0b2dnbGVJbXBvcnRNM1VTZWxlY3Rpb246IGZ1bmN0aW9uIHRvZ2dsZUltcG9ydE0zVVNlbGVjdGlvbihpdGVtKSB7CiAgICAgIHZhciBpZHggPSB0aGlzLmltcG9ydE0zVS5pbXBvcnRHcm91cHMuaW5kZXhPZihpdGVtKTsKCiAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgdGhpcy5pbXBvcnRNM1UuaW1wb3J0R3JvdXBzLnNwbGljZShpZHgsIDEpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuaW1wb3J0TTNVLmltcG9ydEdyb3Vwcy5wdXNoKGl0ZW0pOwogICAgICB9CiAgICB9LAogICAgaW5kZXhPZkdyb3VwOiBmdW5jdGlvbiBpbmRleE9mR3JvdXAoZ3JvdXApIHsKICAgICAgcmV0dXJuIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLm1hcChmdW5jdGlvbiAoZykgewogICAgICAgIHJldHVybiBnLmlkOwogICAgICB9KS5pbmRleE9mKGdyb3VwKTsKICAgIH0sCiAgICBzZWxlY3RHcm91cFJhbmdlU2VsZWN0aW9uOiBmdW5jdGlvbiBzZWxlY3RHcm91cFJhbmdlU2VsZWN0aW9uKGl0ZW0pIHsKICAgICAgdmFyIGxhc3RJbmRleCA9IHRoaXMuaW5kZXhPZkdyb3VwKHRoaXMubGFzdFNlbGVjdGVkR3JvdXApOwogICAgICB2YXIgaXRlbUluZGV4ID0gdGhpcy5pbmRleE9mR3JvdXAoaXRlbSk7CiAgICAgIHZhciBkaXIgPSBpdGVtSW5kZXggPiBsYXN0SW5kZXggPyAxIDogLTE7CgogICAgICBmb3IgKHZhciBpID0gbGFzdEluZGV4OyBpICE9IGl0ZW1JbmRleCArIGRpcjsgaSArPSBkaXIpIHsKICAgICAgICBpZiAoIXRoaXMuYWN0aXZlR3JvdXBzLmluY2x1ZGVzKHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmlkKSkgewogICAgICAgICAgdGhpcy5hY3RpdmVHcm91cHMucHVzaCh0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5pZCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgaW5kZXhPZlN0cmVhbTogZnVuY3Rpb24gaW5kZXhPZlN0cmVhbShzdHJlYW0pIHsKICAgICAgcmV0dXJuIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5tYXAoZnVuY3Rpb24gKGcpIHsKICAgICAgICByZXR1cm4gZy5pZDsKICAgICAgfSkuaW5kZXhPZihzdHJlYW0pOwogICAgfSwKICAgIHNlbGVjdFN0cmVhbVJhbmdlU2VsZWN0aW9uOiBmdW5jdGlvbiBzZWxlY3RTdHJlYW1SYW5nZVNlbGVjdGlvbihpdGVtKSB7CiAgICAgIHZhciBsYXN0SW5kZXggPSB0aGlzLmluZGV4T2ZTdHJlYW0odGhpcy5sYXN0U2VsZWN0ZWRTdHJlYW0pOwogICAgICB2YXIgaXRlbUluZGV4ID0gdGhpcy5pbmRleE9mU3RyZWFtKGl0ZW0pOwogICAgICB2YXIgZGlyID0gaXRlbUluZGV4ID4gbGFzdEluZGV4ID8gMSA6IC0xOwoKICAgICAgZm9yICh2YXIgaSA9IGxhc3RJbmRleDsgaSAhPSBpdGVtSW5kZXggKyBkaXI7IGkgKz0gZGlyKSB7CiAgICAgICAgaWYgKCF0aGlzLmFjdGl2ZVN0cmVhbXMuaW5jbHVkZXModGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLmlkKSkgewogICAgICAgICAgdGhpcy5hY3RpdmVTdHJlYW1zLnB1c2godGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLmlkKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBzZWxlY3RSYWRpb2Jyb3dzZXJSYW5nZVNlbGVjdGlvbjogZnVuY3Rpb24gc2VsZWN0UmFkaW9icm93c2VyUmFuZ2VTZWxlY3Rpb24oaW5kZXgpIHsKICAgICAgdmFyIGxhc3RJbmRleCA9IHRoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZVt0aGlzLnJhZGlvQnJvd3Nlci5hY3RpdmUubGVuZ3RoIC0gMV07CiAgICAgIHZhciBkaXIgPSBpbmRleCA+IGxhc3RJbmRleCA/IDEgOiAtMTsKCiAgICAgIGZvciAodmFyIGkgPSBsYXN0SW5kZXg7IGkgIT0gaW5kZXggKyBkaXI7IGkgKz0gZGlyKSB7CiAgICAgICAgaWYgKCF0aGlzLnJhZGlvQnJvd3Nlci5hY3RpdmUuaW5jbHVkZXMoaSkpIHsKICAgICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZS5wdXNoKGkpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHNlbGVjdEltcG9ydE0zVVJhbmdlU2VsZWN0aW9uOiBmdW5jdGlvbiBzZWxlY3RJbXBvcnRNM1VSYW5nZVNlbGVjdGlvbihpbmRleCkgewogICAgICB2YXIgbGFzdEluZGV4ID0gdGhpcy5pbXBvcnRNM1UuaW1wb3J0R3JvdXBzW3RoaXMuaW1wb3J0TTNVLmltcG9ydEdyb3Vwcy5sZW5ndGggLSAxXTsKICAgICAgdmFyIGRpciA9IGluZGV4ID4gbGFzdEluZGV4ID8gMSA6IC0xOwoKICAgICAgZm9yICh2YXIgaSA9IGxhc3RJbmRleDsgaSAhPSBpbmRleCArIGRpcjsgaSArPSBkaXIpIHsKICAgICAgICBpZiAoIXRoaXMuaW1wb3J0TTNVLmltcG9ydEdyb3Vwcy5pbmNsdWRlcyhpKSkgewogICAgICAgICAgdGhpcy5pbXBvcnRNM1UuaW1wb3J0R3JvdXBzLnB1c2goaSk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgc2VsZWN0R3JvdXBTZWxlY3Rpb246IGZ1bmN0aW9uIHNlbGVjdEdyb3VwU2VsZWN0aW9uKGl0ZW0pIHsKICAgICAgdGhpcy5hY3RpdmVHcm91cHMubGVuZ3RoID0gMDsKICAgICAgdGhpcy5hY3RpdmVHcm91cHMucHVzaChpdGVtKTsKICAgIH0sCiAgICBzZWxlY3RTdHJlYW1TZWxlY3Rpb246IGZ1bmN0aW9uIHNlbGVjdFN0cmVhbVNlbGVjdGlvbihpdGVtKSB7CiAgICAgIHRoaXMuYWN0aXZlU3RyZWFtcy5sZW5ndGggPSAwOwogICAgICB0aGlzLmFjdGl2ZVN0cmVhbXMucHVzaChpdGVtKTsKICAgIH0sCiAgICBzZWxlY3RSYWRpb2Jyb3dzZXJTZWxlY3Rpb246IGZ1bmN0aW9uIHNlbGVjdFJhZGlvYnJvd3NlclNlbGVjdGlvbihpdGVtKSB7CiAgICAgIHRoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZS5sZW5ndGggPSAwOwogICAgICB0aGlzLnJhZGlvQnJvd3Nlci5hY3RpdmUucHVzaChpdGVtKTsKICAgIH0sCiAgICBzZWxlY3RJbXBvcnRNM1VTZWxlY3Rpb246IGZ1bmN0aW9uIHNlbGVjdEltcG9ydE0zVVNlbGVjdGlvbihpdGVtKSB7CiAgICAgIHRoaXMuaW1wb3J0TTNVLmltcG9ydEdyb3Vwcy5sZW5ndGggPSAwOwogICAgICB0aGlzLmltcG9ydE0zVS5pbXBvcnRHcm91cHMucHVzaChpdGVtKTsKICAgIH0sCiAgICBmaW5kQW5kUmVwbGFjZU1vZGFsOiBmdW5jdGlvbiBmaW5kQW5kUmVwbGFjZU1vZGFsKHNob3cpIHsKICAgICAgdmFyIHR5cGUgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IDE7CiAgICAgIHRoaXMuZmluZFJlcGxhY2UudHlwZSA9IHR5cGU7CiAgICAgIHRoaXMuZmluZFJlcGxhY2UubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGZpbmRBbmRSZXBsYWNlOiBmdW5jdGlvbiBmaW5kQW5kUmVwbGFjZSgpIHsKICAgICAgdmFyIF90aGlzMTAgPSB0aGlzOwoKICAgICAgdmFyIG9wdGlvbnMgPSAiIjsKCiAgICAgIGlmICh0aGlzLmZpbmRSZXBsYWNlLnJlcGxhY2VBbGwpIHsKICAgICAgICBvcHRpb25zICs9ICJnIjsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuZmluZFJlcGxhY2UuaWdub3JlQ2FzZSkgewogICAgICAgIG9wdGlvbnMgKz0gImkiOwogICAgICB9CgogICAgICB2YXIgcmUgPSBuZXcgUmVnRXhwKHRoaXMuZmluZFJlcGxhY2UuZnJvbS5yZXBsYWNlKCJ8IiwgIlxcfCIpLCBvcHRpb25zKTsKCiAgICAgIHN3aXRjaCAocGFyc2VJbnQodGhpcy5maW5kUmVwbGFjZS50eXBlKSkgewogICAgICAgIC8vIEdyb3VwCiAgICAgICAgY2FzZSAxOgogICAgICAgICAgaWYgKHBhcnNlSW50KHRoaXMuZmluZFJlcGxhY2Uuc2VsZWN0ZWRPbmx5KSA9PT0gMSkgewogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBzLmluY2x1ZGVzKHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmlkKSkgewogICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uZ3JvdXBfbmFtZSA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmdyb3VwX25hbWUucmVwbGFjZShyZSwgdGhpcy5maW5kUmVwbGFjZS50byk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLmZpbHRlcmVkR3JvdXBzLm1hcChmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICAgICAgICBncm91cC5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgZ3JvdXAuZ3JvdXBfbmFtZSA9IGdyb3VwLmdyb3VwX25hbWUucmVwbGFjZShyZSwgX3RoaXMxMC5maW5kUmVwbGFjZS50byk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwogICAgICAgIC8vIFN0cmVhbXMKCiAgICAgICAgY2FzZSAyOgogICAgICAgICAgaWYgKHBhcnNlSW50KHRoaXMuZmluZFJlcGxhY2Uuc2VsZWN0ZWRPbmx5KSA9PT0gMSkgewogICAgICAgICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsgX2krKykgewogICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZVN0cmVhbXMuaW5jbHVkZXModGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW19pXS5pZCkpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMSkgewogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbX2ldLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW19pXS5zdHJlYW1fdHZnX25hbWUgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbX2ldLnN0cmVhbV90dmdfbmFtZS5yZXBsYWNlKHJlLCB0aGlzLmZpbmRSZXBsYWNlLnRvKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDIpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW19pXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tfaV0ubW92aWVfbmFtZSA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tfaV0ubW92aWVfbmFtZS5yZXBsYWNlKHJlLCB0aGlzLmZpbmRSZXBsYWNlLnRvKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDMpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW19pXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tfaV0uc2VyaWVfbmFtZSA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tfaV0uc2VyaWVfbmFtZS5yZXBsYWNlKHJlLCB0aGlzLmZpbmRSZXBsYWNlLnRvKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuZmlsdGVyZWRTdHJlYW1zLm1hcChmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAgICAgICAgICAgaWYgKF90aGlzMTAuYWN0aXZlR3JvdXBUeXBlID09PSAxKSB7CiAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfbmFtZSA9IHN0cmVhbS5zdHJlYW1fdHZnX25hbWUucmVwbGFjZShyZSwgX3RoaXMxMC5maW5kUmVwbGFjZS50byk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoX3RoaXMxMC5hY3RpdmVHcm91cFR5cGUgPT09IDIpIHsKICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICBzdHJlYW0ubW92aWVfbmFtZSA9IHN0cmVhbS5tb3ZpZV9uYW1lLnJlcGxhY2UocmUsIF90aGlzMTAuZmluZFJlcGxhY2UudG8pOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKF90aGlzMTAuYWN0aXZlR3JvdXBUeXBlID09PSAzKSB7CiAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgc3RyZWFtLnNlcmllX25hbWUgPSBzdHJlYW0uc2VyaWVfbmFtZS5yZXBsYWNlKHJlLCBfdGhpczEwLmZpbmRSZXBsYWNlLnRvKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwogICAgICB9CgogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgICB0aGlzLmZpbmRSZXBsYWNlLm1vZGFsID0gZmFsc2U7CiAgICB9LAogICAgcHJlZml4U3VmZml4TW9kYWw6IGZ1bmN0aW9uIHByZWZpeFN1ZmZpeE1vZGFsKHNob3cpIHsKICAgICAgdmFyIHR5cGUgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IDE7CiAgICAgIHRoaXMucHJlZml4U3VmZml4LnR5cGUgPSB0eXBlOwogICAgICB0aGlzLnByZWZpeFN1ZmZpeC5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgYWRkUHJlZml4U3VmZml4OiBmdW5jdGlvbiBhZGRQcmVmaXhTdWZmaXgoKSB7CiAgICAgIHZhciBwcmVmaXggPSB0aGlzLnByZWZpeFN1ZmZpeC5wcmVmaXg7CiAgICAgIHZhciBzdWZmaXggPSB0aGlzLnByZWZpeFN1ZmZpeC5zdWZmaXg7CgogICAgICBzd2l0Y2ggKHBhcnNlSW50KHRoaXMucHJlZml4U3VmZml4LnR5cGUpKSB7CiAgICAgICAgLy8gR3JvdXAKICAgICAgICBjYXNlIDE6CiAgICAgICAgICBpZiAocGFyc2VJbnQodGhpcy5wcmVmaXhTdWZmaXguc2VsZWN0ZWRPbmx5KSA9PT0gMSkgewogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBzLmluY2x1ZGVzKHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmlkKSkgewogICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uZ3JvdXBfbmFtZSA9IHByZWZpeCArIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmdyb3VwX25hbWUgKyBzdWZmaXg7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLmZpbHRlcmVkR3JvdXBzLm1hcChmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICAgICAgICBncm91cC5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgZ3JvdXAuZ3JvdXBfbmFtZSA9IHByZWZpeCArIGdyb3VwLmdyb3VwX25hbWUgKyBzdWZmaXg7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwogICAgICAgIC8vIFN0cmVhbQoKICAgICAgICBjYXNlIDI6CiAgICAgICAgICBpZiAocGFyc2VJbnQodGhpcy5wcmVmaXhTdWZmaXguc2VsZWN0ZWRPbmx5KSA9PT0gMSkgewogICAgICAgICAgICBmb3IgKHZhciBfaTIgPSAwOyBfaTIgPCB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOyBfaTIrKykgewogICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZVN0cmVhbXMuaW5jbHVkZXModGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW19pMl0uaWQpKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDEpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW19pMl0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbX2kyXS5zdHJlYW1fdHZnX25hbWUgPSBwcmVmaXggKyB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbX2kyXS5zdHJlYW1fdHZnX25hbWUgKyBzdWZmaXg7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tfaTJdLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW19pMl0ubW92aWVfbmFtZSA9IHByZWZpeCArIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tfaTJdLm1vdmllX25hbWUgKyBzdWZmaXg7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAzKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tfaTJdLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW19pMl0uc2VyaWVfbmFtZSA9IHByZWZpeCArIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tfaTJdLnNlcmllX25hbWUgKyBzdWZmaXg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDEpIHsKICAgICAgICAgICAgICB0aGlzLmZpbHRlcmVkU3RyZWFtcy5tYXAoZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX25hbWUgPSBwcmVmaXggKyBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lICsgc3VmZml4OwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDIpIHsKICAgICAgICAgICAgICB0aGlzLmZpbHRlcmVkU3RyZWFtcy5tYXAoZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHN0cmVhbS5tb3ZpZV9uYW1lID0gcHJlZml4ICsgc3RyZWFtLm1vdmllX25hbWUgKyBzdWZmaXg7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMykgewogICAgICAgICAgICAgIHRoaXMuZmlsdGVyZWRTdHJlYW1zLm1hcChmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgc3RyZWFtLnNlcmllX25hbWUgPSBwcmVmaXggKyBzdHJlYW0uc2VyaWVfbmFtZSArIHN1ZmZpeDsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwogICAgICB9CgogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgICB0aGlzLnByZWZpeFN1ZmZpeC5tb2RhbCA9IGZhbHNlOwogICAgfSwKICAgIGNvbnZlcnRDYXNlTW9kYWw6IGZ1bmN0aW9uIGNvbnZlcnRDYXNlTW9kYWwoc2hvdywgdHlwZSkgewogICAgICB0aGlzLmNvbnZlcnRDYXNlLnR5cGUgPSB0eXBlOwogICAgICB0aGlzLmNvbnZlcnRDYXNlLm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBjaGFuZ2VDYXNlOiBmdW5jdGlvbiBjaGFuZ2VDYXNlKCkgewogICAgICB2YXIgX3RoaXMxMSA9IHRoaXM7CgogICAgICB2YXIgbWV0aG9kID0gdGhpcy5jb252ZXJ0Q2FzZS5tZXRob2Q7CiAgICAgIHZhciBncm91cHM7CiAgICAgIHZhciBzdHJlYW1zOwoKICAgICAgaWYgKHBhcnNlSW50KHRoaXMuY29udmVydENhc2Uuc2VsZWN0ZWRPbmx5KSA9PT0gMSkgewogICAgICAgIGdyb3VwcyA9IHRoaXMuZmlsdGVyZWRHcm91cHMuZmlsdGVyKGZ1bmN0aW9uIChncm91cCkgewogICAgICAgICAgcmV0dXJuIF90aGlzMTEuYWN0aXZlR3JvdXBzLmluY2x1ZGVzKGdyb3VwLmlkKTsKICAgICAgICB9KTsKICAgICAgICBzdHJlYW1zID0gdGhpcy5maWx0ZXJlZFN0cmVhbXMuZmlsdGVyKGZ1bmN0aW9uIChzdHJlYW0pIHsKICAgICAgICAgIHJldHVybiBfdGhpczExLmFjdGl2ZVN0cmVhbXMuaW5jbHVkZXMoc3RyZWFtLmlkKTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBncm91cHMgPSB0aGlzLmZpbHRlcmVkR3JvdXBzOwogICAgICAgIHN0cmVhbXMgPSB0aGlzLmZpbHRlcmVkU3RyZWFtczsKICAgICAgfQoKICAgICAgc3dpdGNoIChwYXJzZUludCh0aGlzLmNvbnZlcnRDYXNlLnR5cGUpKSB7CiAgICAgICAgLy8gQ2F0ZWdvcmllcwogICAgICAgIGNhc2UgMToKICAgICAgICAgIGdyb3Vwcy5tYXAoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgICAgIHN3aXRjaCAocGFyc2VJbnQobWV0aG9kKSkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGdyb3VwLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGdyb3VwLmdyb3VwX25hbWUgPSBncm91cC5ncm91cF9uYW1lLnRpdGxlQ2FzZSgpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgIGdyb3VwLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGdyb3VwLmdyb3VwX25hbWUgPSBncm91cC5ncm91cF9uYW1lLnRvVXBwZXJDYXNlKCk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgZ3JvdXAubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgZ3JvdXAuZ3JvdXBfbmFtZSA9IGdyb3VwLmdyb3VwX25hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIC8vIFN0cmVhbXMKCiAgICAgICAgY2FzZSAyOgogICAgICAgICAgc3RyZWFtcy5tYXAoZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgICAgICBzd2l0Y2ggKHBhcnNlSW50KG1ldGhvZCkpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBpZiAoX3RoaXMxMS5hY3RpdmVHcm91cFR5cGUgPT09IDEpIHsKICAgICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfbmFtZSA9IHN0cmVhbS5zdHJlYW1fdHZnX25hbWUudGl0bGVDYXNlKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKF90aGlzMTEuYWN0aXZlR3JvdXBUeXBlID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5tb3ZpZV9uYW1lID0gc3RyZWFtLm1vdmllX25hbWUudGl0bGVDYXNlKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKF90aGlzMTEuYWN0aXZlR3JvdXBUeXBlID09PSAzKSB7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5zZXJpZV9uYW1lID0gc3RyZWFtLnNlcmllX25hbWUudGl0bGVDYXNlKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgIGlmIChfdGhpczExLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMSkgewogICAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lID0gc3RyZWFtLnN0cmVhbV90dmdfbmFtZS50b1VwcGVyQ2FzZSgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChfdGhpczExLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMikgewogICAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICBzdHJlYW0ubW92aWVfbmFtZSA9IHN0cmVhbS5tb3ZpZV9uYW1lLnRvVXBwZXJDYXNlKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKF90aGlzMTEuYWN0aXZlR3JvdXBUeXBlID09PSAzKSB7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5zZXJpZV9uYW1lID0gc3RyZWFtLnNlcmllX25hbWUudG9VcHBlckNhc2UoKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgaWYgKF90aGlzMTEuYWN0aXZlR3JvdXBUeXBlID09PSAxKSB7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX25hbWUgPSBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKF90aGlzMTEuYWN0aXZlR3JvdXBUeXBlID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5tb3ZpZV9uYW1lID0gc3RyZWFtLm1vdmllX25hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoX3RoaXMxMS5hY3RpdmVHcm91cFR5cGUgPT09IDMpIHsKICAgICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgc3RyZWFtLnNlcmllX25hbWUgPSBzdHJlYW0uc2VyaWVfbmFtZS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CgogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgICB0aGlzLmNvbnZlcnRDYXNlLm1vZGFsID0gZmFsc2U7CiAgICB9LAogICAgZWRpdEdyb3VwTW9kYWw6IGZ1bmN0aW9uIGVkaXRHcm91cE1vZGFsKHNob3cpIHsKICAgICAgdmFyIF90aGlzMTIgPSB0aGlzOwoKICAgICAgdmFyIGluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KGZ1bmN0aW9uIChncm91cCkgewogICAgICAgIHJldHVybiBncm91cC5pZCA9PT0gX3RoaXMxMi5hY3RpdmVHcm91cHNbMF07CiAgICAgIH0pOwogICAgICB2YXIgZ3JvdXAgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpbmRleF07CgogICAgICBpZiAoZ3JvdXApIHsKICAgICAgICB0aGlzLmdyb3VwRWRpdG9yLmlkID0gdGhpcy5hY3RpdmVHcm91cHNbMF07CiAgICAgICAgdGhpcy5ncm91cEVkaXRvci5ncm91cF90eXBlID0gZ3JvdXAuZ3JvdXBfdHlwZTsKICAgICAgICB0aGlzLmdyb3VwRWRpdG9yLmdyb3VwX25hbWUgPSBncm91cC5ncm91cF9uYW1lOwogICAgICAgIHRoaXMuZ3JvdXBFZGl0b3IuZ3JvdXBfaXNfaGlkZGVuID0gZ3JvdXAuZ3JvdXBfaXNfaGlkZGVuOwogICAgICAgIHRoaXMuZ3JvdXBFZGl0b3IuZ3JvdXBfcGFyZW50X2NvZGUgPSBncm91cC5ncm91cF9wYXJlbnRfY29kZTsKICAgICAgICB0aGlzLmdyb3VwRWRpdG9yLm1vZGFsID0gc2hvdzsKICAgICAgfQogICAgfSwKICAgIGVkaXRTdHJlYW1Nb2RhbDogZnVuY3Rpb24gZWRpdFN0cmVhbU1vZGFsKHNob3cpIHsKICAgICAgdmFyIF90aGlzMTMgPSB0aGlzOwoKICAgICAgdmFyIGluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmZpbmRJbmRleChmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAgICAgcmV0dXJuIHN0cmVhbS5pZCA9PT0gX3RoaXMxMy5hY3RpdmVTdHJlYW1zWzBdOwogICAgICB9KTsKICAgICAgdmFyIHN0cmVhbSA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF07CgogICAgICBpZiAoc3RyZWFtKSB7CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3IuaWQgPSB0aGlzLmFjdGl2ZVN0cmVhbXNbMF07CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX3R2Z19uYW1lID0gc3RyZWFtLnN0cmVhbV90dmdfbmFtZTsKICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1fdHZnX2lkID0gc3RyZWFtLnN0cmVhbV90dmdfaWQ7CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX3R2Z19sb2dvID0gc3RyZWFtLnN0cmVhbV90dmdfbG9nbzsKICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1fcGFyZW50X2NvZGUgPSBzdHJlYW0uc3RyZWFtX3BhcmVudF9jb2RlOwogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV9yYWRpbyA9IHN0cmVhbS5zdHJlYW1fcmFkaW87CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX2lzX2hpZGRlbiA9IHN0cmVhbS5zdHJlYW1faXNfaGlkZGVuOwogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnNvdXJjZV9zdHJlYW1fdXJsID0gc3RyZWFtLnNvdXJjZV9zdHJlYW1fdXJsOwogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV9pc19jdXN0b20gPSBzdHJlYW0uc3RyZWFtX2lzX2N1c3RvbTsKCiAgICAgICAgaWYgKHN0cmVhbS5tb3ZpZV9uYW1lICE9PSB1bmRlZmluZWQgJiYgc3RyZWFtLm1vdmllX3llYXIgIT09IHVuZGVmaW5lZCAmJiBzdHJlYW0udG1kYl9pZCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5tb3ZpZV9uYW1lID0gc3RyZWFtLm1vdmllX25hbWU7CiAgICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5tb3ZpZV95ZWFyID0gc3RyZWFtLm1vdmllX3llYXI7CiAgICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci50bWRiX2lkID0gc3RyZWFtLnRtZGJfaWQ7CiAgICAgICAgfQoKICAgICAgICBpZiAoc3RyZWFtLnNlcmllX25hbWUgIT09IHVuZGVmaW5lZCAmJiBzdHJlYW0uc2VyaWVfc2Vhc29uICE9PSB1bmRlZmluZWQgJiYgc3RyZWFtLnNlcmllX2VwaXNvZGUgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc2VyaWVfbmFtZSA9IHN0cmVhbS5zZXJpZV9uYW1lOwogICAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc2VyaWVfc2Vhc29uID0gc3RyZWFtLnNlcmllX3NlYXNvbjsKICAgICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnNlcmllX2VwaXNvZGUgPSBzdHJlYW0uc2VyaWVfZXBpc29kZTsKICAgICAgICB9CgogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLm1vZGFsID0gc2hvdzsKICAgICAgfQogICAgfSwKICAgIGVkaXRHcm91cDogZnVuY3Rpb24gZWRpdEdyb3VwKCkgewogICAgICB2YXIgX3RoaXMxNCA9IHRoaXM7CgogICAgICB2YXIgaW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgcmV0dXJuIGdyb3VwLmlkID09PSBfdGhpczE0Lmdyb3VwRWRpdG9yLmlkOwogICAgICB9KTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaW5kZXhdLmdyb3VwX3R5cGUgPSB0aGlzLmdyb3VwRWRpdG9yLmdyb3VwX3R5cGU7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2luZGV4XS5ncm91cF9uYW1lID0gdGhpcy5ncm91cEVkaXRvci5ncm91cF9uYW1lOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpbmRleF0uZ3JvdXBfaXNfaGlkZGVuID0gdGhpcy5ncm91cEVkaXRvci5ncm91cF9pc19oaWRkZW47CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2luZGV4XS5ncm91cF9wYXJlbnRfY29kZSA9IHRoaXMuZ3JvdXBFZGl0b3IuZ3JvdXBfcGFyZW50X2NvZGU7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2luZGV4XS5tb2RpZmllZCA9IHRydWU7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICAgIHRoaXMuZ3JvdXBFZGl0b3IubW9kYWwgPSBmYWxzZTsKICAgIH0sCiAgICBlZGl0U3RyZWFtOiBmdW5jdGlvbiBlZGl0U3RyZWFtKCkgewogICAgICB2YXIgX3RoaXMxNSA9IHRoaXM7CgogICAgICB2YXIgaW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMuZmluZEluZGV4KGZ1bmN0aW9uIChzdHJlYW0pIHsKICAgICAgICByZXR1cm4gc3RyZWFtLmlkID09PSBfdGhpczE1LmFjdGl2ZVN0cmVhbXNbMF07CiAgICAgIH0pOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnN0cmVhbV90dmdfbmFtZSA9IHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV90dmdfbmFtZTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zdHJlYW1fdHZnX2lkID0gdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX3R2Z19pZDsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zdHJlYW1fdHZnX2xvZ28gPSB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1fdHZnX2xvZ287CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc3RyZWFtX3BhcmVudF9jb2RlID0gdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX3BhcmVudF9jb2RlOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnN0cmVhbV9pc19oaWRkZW4gPSB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1faXNfaGlkZGVuOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnN0cmVhbV9yYWRpbyA9IHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV9yYWRpbzsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zb3VyY2Vfc3RyZWFtX3VybCA9IHRoaXMuc3RyZWFtRWRpdG9yLnNvdXJjZV9zdHJlYW1fdXJsOwoKICAgICAgaWYgKHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0ubW92aWVfbmFtZSAhPT0gdW5kZWZpbmVkICYmIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0ubW92aWVfeWVhciAhPT0gdW5kZWZpbmVkICYmIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0udG1kYl9pZCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5tb3ZpZV9uYW1lID0gdGhpcy5zdHJlYW1FZGl0b3IubW92aWVfbmFtZTsKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLm1vdmllX3llYXIgPSB0aGlzLnN0cmVhbUVkaXRvci5tb3ZpZV95ZWFyOwogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0udG1kYl9pZCA9IHRoaXMuc3RyZWFtRWRpdG9yLnRtZGJfaWQ7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnNlcmllX25hbWUgIT09IHVuZGVmaW5lZCAmJiB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnNlcmllX3NlYXNvbiAhPT0gdW5kZWZpbmVkICYmIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc2VyaWVfZXBpc29kZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zZXJpZV9uYW1lID0gdGhpcy5zdHJlYW1FZGl0b3Iuc2VyaWVfbmFtZTsKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnNlcmllX3NlYXNvbiA9IHRoaXMuc3RyZWFtRWRpdG9yLnNlcmllX3NlYXNvbjsKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnNlcmllX2VwaXNvZGUgPSB0aGlzLnN0cmVhbUVkaXRvci5zZXJpZV9lcGlzb2RlOwogICAgICB9CgogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgICAgdGhpcy5zdHJlYW1FZGl0b3IubW9kYWwgPSBmYWxzZTsKICAgIH0sCiAgICBzb3J0R3JvdXBBbHBoYVVwOiBmdW5jdGlvbiBzb3J0R3JvdXBBbHBoYVVwKCkgewogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3VwcyA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICByZXR1cm4gYi5ncm91cF9uYW1lID4gYS5ncm91cF9uYW1lID8gMSA6IGEuZ3JvdXBfbmFtZSA+IGIuZ3JvdXBfbmFtZSA/IC0xIDogMDsKICAgICAgfSk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLm1hcChmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICByZXR1cm4gZ3JvdXAubW9kaWZpZWQgPSB0cnVlOwogICAgICB9KTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgIH0sCiAgICBzb3J0R3JvdXBBbHBoYURvd246IGZ1bmN0aW9uIHNvcnRHcm91cEFscGhhRG93bigpIHsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgcmV0dXJuIGEuZ3JvdXBfbmFtZSA+IGIuZ3JvdXBfbmFtZSA/IDEgOiBiLmdyb3VwX25hbWUgPiBhLmdyb3VwX25hbWUgPyAtMSA6IDA7CiAgICAgIH0pOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5tYXAoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgcmV0dXJuIGdyb3VwLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgfSk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICB9LAogICAgc29ydEdyb3VwVHlwZVVwOiBmdW5jdGlvbiBzb3J0R3JvdXBUeXBlVXAoKSB7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHJldHVybiBiLmdyb3VwX3R5cGUgPiBhLmdyb3VwX3R5cGUgPyAxIDogYS5ncm91cF90eXBlID4gYi5ncm91cF90eXBlID8gLTEgOiAwOwogICAgICB9KTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMubWFwKGZ1bmN0aW9uIChncm91cCkgewogICAgICAgIHJldHVybiBncm91cC5tb2RpZmllZCA9IHRydWU7CiAgICAgIH0pOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgfSwKICAgIHNvcnRHcm91cFR5cGVEb3duOiBmdW5jdGlvbiBzb3J0R3JvdXBUeXBlRG93bigpIHsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgcmV0dXJuIGEuZ3JvdXBfdHlwZSA+IGIuZ3JvdXBfdHlwZSA/IDEgOiBiLmdyb3VwX3R5cGUgPiBhLmdyb3VwX3R5cGUgPyAtMSA6IDA7CiAgICAgIH0pOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5tYXAoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgcmV0dXJuIGdyb3VwLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgfSk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICB9LAogICAgc29ydFN0cmVhbUFscGhhVXA6IGZ1bmN0aW9uIHNvcnRTdHJlYW1BbHBoYVVwKCkgewogICAgICB2YXIgX3RoaXMxNiA9IHRoaXM7CgogICAgICAvL0VSTlNUIEhJRVIKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICBzd2l0Y2ggKF90aGlzMTYuYWN0aXZlR3JvdXBUeXBlKSB7CiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIHJldHVybiBiLnN0cmVhbV90dmdfbmFtZSA+IGEuc3RyZWFtX3R2Z19uYW1lID8gMSA6IGEuc3RyZWFtX3R2Z19uYW1lID4gYi5zdHJlYW1fdHZnX25hbWUgPyAtMSA6IDA7CgogICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICByZXR1cm4gYi5tb3ZpZV9uYW1lID4gYS5tb3ZpZV9uYW1lID8gMSA6IGEubW92aWVfbmFtZSA+IGIubW92aWVfbmFtZSA/IC0xIDogMDsKCiAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgIHJldHVybiBiLnNlcmllX25hbWUgPiBhLnNlcmllX25hbWUgPyAxIDogYS5zZXJpZV9uYW1lID4gYi5zZXJpZV9uYW1lID8gLTEgOiAwOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5tYXAoZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgIHJldHVybiBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICB9KTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgIH0sCiAgICBzb3J0U3RyZWFtQWxwaGFEb3duOiBmdW5jdGlvbiBzb3J0U3RyZWFtQWxwaGFEb3duKCkgewogICAgICB2YXIgX3RoaXMxNyA9IHRoaXM7CgogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMuc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHN3aXRjaCAoX3RoaXMxNy5hY3RpdmVHcm91cFR5cGUpIHsKICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgcmV0dXJuIGEuc3RyZWFtX3R2Z19uYW1lID4gYi5zdHJlYW1fdHZnX25hbWUgPyAxIDogYi5zdHJlYW1fdHZnX25hbWUgPiBhLnN0cmVhbV90dmdfbmFtZSA/IC0xIDogMDsKCiAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgIHJldHVybiBhLm1vdmllX25hbWUgPiBiLm1vdmllX25hbWUgPyAxIDogYi5tb3ZpZV9uYW1lID4gYS5tb3ZpZV9uYW1lID8gLTEgOiAwOwoKICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgcmV0dXJuIGEuc2VyaWVfbmFtZSA+IGIuc2VyaWVfbmFtZSA/IDEgOiBiLnNlcmllX25hbWUgPiBhLnNlcmllX25hbWUgPyAtMSA6IDA7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLm1hcChmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAgICAgcmV0dXJuIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgIH0pOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgfSwKICAgIHNvcnRTdHJlYW1IaWRkZW5VcDogZnVuY3Rpb24gc29ydFN0cmVhbUhpZGRlblVwKCkgewogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMuc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHJldHVybiBiLnN0cmVhbV9pc19oaWRkZW4gPiBhLnN0cmVhbV9pc19oaWRkZW4gPyAxIDogYS5zdHJlYW1faXNfaGlkZGVuID4gYi5zdHJlYW1faXNfaGlkZGVuID8gLTEgOiAwOwogICAgICB9KTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLm1hcChmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICByZXR1cm4gZ3JvdXAubW9kaWZpZWQgPSB0cnVlOwogICAgICB9KTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgIH0sCiAgICBzb3J0U3RyZWFtSGlkZGVuRG93bjogZnVuY3Rpb24gc29ydFN0cmVhbUhpZGRlbkRvd24oKSB7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcyA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgcmV0dXJuIGEuc3RyZWFtX2lzX2hpZGRlbiA+IGIuc3RyZWFtX2lzX2hpZGRlbiA/IDEgOiBiLnN0cmVhbV9pc19oaWRkZW4gPiBhLnN0cmVhbV9pc19oaWRkZW4gPyAtMSA6IDA7CiAgICAgIH0pOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubWFwKGZ1bmN0aW9uIChncm91cCkgewogICAgICAgIHJldHVybiBncm91cC5tb2RpZmllZCA9IHRydWU7CiAgICAgIH0pOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgfSwKICAgIGFkZEdyb3VwOiBmdW5jdGlvbiBhZGRHcm91cCgpIHsKICAgICAgdmFyIF90aGlzMTggPSB0aGlzOwoKICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZS5wb3N0KCJlZGl0b3IvYWRkLWdyb3VwIiwgewogICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkCiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgIF90aGlzMTguaXNMb2FkaW5nID0gZmFsc2U7CgogICAgICAgIGlmIChyZXMuc3RhdHVzID09PSB0cnVlICYmIHJlcy5kYXRhKSB7CiAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgICAgICAgICAgX3RoaXMxOC5wbGF5bGlzdEVkaXRvci5ncm91cHMucHVzaChyZXMuZGF0YSk7CgogICAgICAgICAgICBfdGhpczE4LmFjdGl2ZUdyb3VwID0gX3RoaXMxOC5wbGF5bGlzdEVkaXRvci5ncm91cHNbX3RoaXMxOC5wbGF5bGlzdEVkaXRvci5ncm91cHMubGVuZ3RoIC0gMV0uaWQ7CiAgICAgICAgICAgIF90aGlzMTguYWN0aXZlR3JvdXBzID0gW190aGlzMTgucGxheWxpc3RFZGl0b3IuZ3JvdXBzW190aGlzMTgucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmxlbmd0aCAtIDFdLmlkXTsKICAgICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIF90aGlzMTguZWRpdEdyb3VwTW9kYWwodHJ1ZSk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczE4LmlzTG9hZGluZyA9IGZhbHNlOwoKICAgICAgICBfdGhpczE4LiRub3RpZnkoImVycm9yIiwgX3RoaXMxOC4kdCgicHJvZmlsZS5mYWlsZWQiKSwgX3RoaXMxOC4kdCgiZWRpdG9yLmFkZC1ncm91cC1lcnJvciIpLCAibGEtdXNlci1zaGllbGQiLCB7CiAgICAgICAgICBkdXJhdGlvbjogNTAwMCwKICAgICAgICAgIHBlcm1hbmVudDogZmFsc2UKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LAogICAgYWRkU3RyZWFtOiBmdW5jdGlvbiBhZGRTdHJlYW0oKSB7CiAgICAgIHZhciBfdGhpczE5ID0gdGhpczsKCiAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UucG9zdCgiZWRpdG9yL2FkZC1zdHJlYW0iLCB7CiAgICAgICAgcGxheWxpc3RfaWQ6IHRoaXMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgZ3JvdXBfaWQ6IHRoaXMuZ2V0R3JvdXBXaXRoSWQodGhpcy5hY3RpdmVHcm91cCkuaWQsCiAgICAgICAgc3RyZWFtX3R5cGU6IHRoaXMuZ2V0R3JvdXBXaXRoSWQodGhpcy5hY3RpdmVHcm91cCkuZ3JvdXBfdHlwZQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICBfdGhpczE5LmlzTG9hZGluZyA9IGZhbHNlOwoKICAgICAgICBpZiAocmVzLnN0YXR1cyA9PT0gdHJ1ZSAmJiByZXMuZGF0YSkgewogICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgICAgICAgIF90aGlzMTkucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy51bnNoaWZ0KHJlcy5kYXRhKTsKCiAgICAgICAgICAgIF90aGlzMTkuYWN0aXZlU3RyZWFtID0gX3RoaXMxOS5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW190aGlzMTkucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGggLSAxXS5pZDsKICAgICAgICAgICAgX3RoaXMxOS5hY3RpdmVTdHJlYW1zID0gW190aGlzMTkucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tfdGhpczE5LnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoIC0gMV0uaWRdOwogICAgICAgICAgICByZXNvbHZlKCk7CiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgX3RoaXMxOS5lZGl0U3RyZWFtTW9kYWwodHJ1ZSk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczE5LmlzTG9hZGluZyA9IGZhbHNlOwoKICAgICAgICBfdGhpczE5LiRub3RpZnkoImVycm9yIiwgX3RoaXMxOS4kdCgicHJvZmlsZS5mYWlsZWQiKSwgX3RoaXMxOS4kdCgiZWRpdG9yLmFkZC1zdHJlYW0tZXJyb3IiKSwgImxhLXVzZXItc2hpZWxkIiwgewogICAgICAgICAgZHVyYXRpb246IDUwMDAsCiAgICAgICAgICBwZXJtYW5lbnQ6IGZhbHNlCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSwKICAgIGxvYWRTdHJlYW1zOiBmdW5jdGlvbiBsb2FkU3RyZWFtcygpIHsKICAgICAgdmFyIF90aGlzMjAgPSB0aGlzOwoKICAgICAgdGhpcy5hY3RpdmVTdHJlYW0gPSAtMTsKICAgICAgdGhpcy5hY3RpdmVTdHJlYW1zID0gW107CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcyA9IFtdOwogICAgICB2YXIgaW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgcmV0dXJuIGdyb3VwLmlkID09PSBfdGhpczIwLmFjdGl2ZUdyb3VwOwogICAgICB9KTsKICAgICAgdmFyIGdyb3VwID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaW5kZXhdOwogICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGh0dHBTZXJ2aWNlLmdldCgiZWRpdG9yL3N0cmVhbXMvIi5jb25jYXQodGhpcy5wbGF5bGlzdEVkaXRvci5pZCwgIi8iKS5jb25jYXQoZ3JvdXAuaWQsICIvIikuY29uY2F0KGdyb3VwLmdyb3VwX3R5cGUpKS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICBkb2N1bWVudC5ib2R5LnNjcm9sbFRvcCA9IDA7CiAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcCA9IDA7CgogICAgICAgIGlmIChyZXMuc3RhdHVzID09PSB0cnVlKSB7CiAgICAgICAgICB2YXIgc3RyZWFtcyA9IHJlcy5kYXRhLm1hcChmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAgICAgICAgIHZhciBzdHIgPSBPYmplY3QuYXNzaWduKHt9LCBzdHJlYW0pOwogICAgICAgICAgICBzdHIuc291cmNlX3N0cmVhbV90dmdfbmFtZSA9IHN0cmVhbS5zdHJlYW1fdHZnX25hbWU7CiAgICAgICAgICAgIHN0ci5zb3VyY2Vfc3RyZWFtX3R2Z19pZCA9IHN0cmVhbS5zdHJlYW1fdHZnX2lkOwogICAgICAgICAgICBzdHIuc291cmNlX3N0cmVhbV90dmdfbG9nbyA9IHN0cmVhbS5zdHJlYW1fdHZnX2xvZ287CiAgICAgICAgICAgIHN0ci5zb3VyY2Vfc3RyZWFtX3R2Z19jaG5vID0gc3RyZWFtLnN0cmVhbV90dmdfY2hubzsKICAgICAgICAgICAgc3RyLnNvdXJjZV9zdHJlYW1fdHZnX3NoaWZ0ID0gc3RyZWFtLnN0cmVhbV90dmdfc2hpZnQ7CiAgICAgICAgICAgIHN0ci5zb3VyY2Vfc3RyZWFtX3BhcmVudF9jb2RlID0gc3RyZWFtLnN0cmVhbV9wYXJlbnRfY29kZTsKICAgICAgICAgICAgc3RyLnNvdXJjZV9zdHJlYW1fYXVkaW9fdHJhY2sgPSBzdHJlYW0uc3RyZWFtX2F1ZGlvX3RyYWNrOwogICAgICAgICAgICBzdHIuc291cmNlX3N0cmVhbV9hc3BlY3RfcmF0aW8gPSBzdHJlYW0uc3RyZWFtX2FzcGVjdF9yYXRpbzsKICAgICAgICAgICAgc3RyLnNvdXJjZV9zdHJlYW1fcmFkaW8gPSBzdHJlYW0uc3RyZWFtX3JhZGlvOwogICAgICAgICAgICBzdHIuc291cmNlX3N0cmVhbV9vcmRlciA9IHN0cmVhbS5zdHJlYW1fb3JkZXI7CiAgICAgICAgICAgIHN0ci5zb3VyY2Vfc3RyZWFtX2lzX2hpZGRlbiA9IHN0cmVhbS5zdHJlYW1faXNfaGlkZGVuOwogICAgICAgICAgICBzdHIubW9kaWZpZWQgPSBmYWxzZTsKICAgICAgICAgICAgc3RyLnN0cmVhbV9pc19yZW1vdmVkID0gMDsKCiAgICAgICAgICAgIGlmIChncm91cC5ncm91cF90eXBlID09IDIpIHsKICAgICAgICAgICAgICBpZiAoc3RyLm1vdmllX25hbWUgPT0gIiIpIHsKICAgICAgICAgICAgICAgIHN0ci5tb3ZpZV9uYW1lID0gc3RyLnN0cmVhbV90dmdfbmFtZTsKICAgICAgICAgICAgICAgIHN0ci5zb3VyY2VfbW92aWVfbmFtZSA9IHN0ci5zdHJlYW1fdHZnX25hbWU7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHN0ci5zb3VyY2VfbW92aWVfbmFtZSA9IHN0cmVhbS5tb3ZpZV9uYW1lOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgc3RyLnNvdXJjZV9tb3ZpZV95ZWFyID0gc3RyZWFtLm1vdmllX3llYXI7CiAgICAgICAgICAgICAgc3RyLnNvdXJjZV90bWRiX2lkID0gc3RyZWFtLnRtZGJfaWQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChncm91cC5ncm91cF90eXBlID09IDMpIHsKICAgICAgICAgICAgICBpZiAoc3RyLnNlcmllX25hbWUgPT0gIiIpIHsKICAgICAgICAgICAgICAgIHN0ci5zZXJpZV9uYW1lID0gc3RyLnN0cmVhbV90dmdfbmFtZTsKICAgICAgICAgICAgICAgIHN0ci5zb3VyY2Vfc2VyaWVfbmFtZSA9IHN0ci5zdHJlYW1fdHZnX25hbWU7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHN0ci5zb3VyY2Vfc2VyaWVfbmFtZSA9IHN0cmVhbS5zZXJpZV9uYW1lOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgc3RyLnNvdXJjZV9zZXJpZV9zZWFzb24gPSBzdHJlYW0uc2VyaWVfc2Vhc29uOwogICAgICAgICAgICAgIHN0ci5zb3VyY2Vfc2VyaWVfZXBpc29kZSA9IHN0cmVhbS5zZXJpZV9lcGlzb2RlOwogICAgICAgICAgICAgIHN0ci5zb3VyY2VfdG1kYl9pZCA9IHN0cmVhbS50bWRiX2lkOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gc3RyOwogICAgICAgICAgfSk7CiAgICAgICAgICBzdHJlYW1zLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgICAgcmV0dXJuIGEuc291cmNlX3N0cmVhbV9vcmRlciA+IGIuc291cmNlX3N0cmVhbV9vcmRlciA/IDEgOiBiLnNvdXJjZV9zdHJlYW1fb3JkZXIgPiBhLnNvdXJjZV9zdHJlYW1fb3JkZXIgPyAtMSA6IDA7CiAgICAgICAgICB9KTsKICAgICAgICAgIF90aGlzMjAucGxheWxpc3RFZGl0b3Iuc3RyZWFtcyA9IHN0cmVhbXM7CiAgICAgICAgICBfdGhpczIwLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBfdGhpczIwLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzMjAuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0pOwogICAgfSwKICAgIG1vdmVUb1NlbGVjdGVkR3JvdXA6IGZ1bmN0aW9uIG1vdmVUb1NlbGVjdGVkR3JvdXAoKSB7CiAgICAgIHZhciBfdGhpczIxID0gdGhpczsKCiAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgdmFyIHN0cmVhbXMgPSB0aGlzLmFjdGl2ZVN0cmVhbXMuam9pbigpOwogICAgICB2YXIgaW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgcmV0dXJuIGdyb3VwLmlkID09IF90aGlzMjEuYWN0aXZlR3JvdXA7CiAgICAgIH0pOwogICAgICBodHRwU2VydmljZS5wb3N0KCJlZGl0b3IvbW92ZS10by1ncm91cC8iLmNvbmNhdCh0aGlzLmFjdGl2ZUdyb3VwVHlwZSksIHsKICAgICAgICBwbGF5bGlzdF9pZDogdGhpcy5wbGF5bGlzdEVkaXRvci5pZCwKICAgICAgICBzdHJlYW1zOiBzdHJlYW1zLAogICAgICAgIGdyb3VwX2lkOiB0aGlzLmFjdGl2ZUdyb3Vwc1swXQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICBfdGhpczIxLmlzTG9hZGluZyA9IGZhbHNlOwoKICAgICAgICBpZiAocmVzLnN0YXR1cyAmJiByZXMuZGF0YSkgewogICAgICAgICAgX3RoaXMyMS5sb2FkUGxheWxpc3QoX3RoaXMyMS5wbGF5bGlzdEVkaXRvci5pZCwgaW5kZXgpOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzMjEuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0pOwogICAgfSwKICAgIHNhdmVDaGFuZ2VzTW9kYWw6IGZ1bmN0aW9uIHNhdmVDaGFuZ2VzTW9kYWwoc2hvdykgewogICAgICB2YXIgc2F2ZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogZmFsc2U7CiAgICAgIHRoaXMuc2F2ZUNoYW5nZXMubW9kYWwgPSBzaG93OwoKICAgICAgaWYgKHNhdmUpIHsKICAgICAgICB0aGlzLmRvU2F2ZSgpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMubG9hZFN0cmVhbXMoKTsKICAgICAgfQogICAgfSwKICAgIHJhZGlvQnJvd3Nlck1vZGFsOiBmdW5jdGlvbiByYWRpb0Jyb3dzZXJNb2RhbChzaG93KSB7CiAgICAgIHZhciBfdGhpczIyID0gdGhpczsKCiAgICAgIHZhciBzYXZlID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiBmYWxzZTsKCiAgICAgIGlmIChzaG93KSB7CiAgICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuc2VhcmNoID0gIiI7CiAgICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIucmVzdWx0cyA9IFtdOwogICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZSA9IFtdOwogICAgICB9CgogICAgICBpZiAoc2F2ZSkgewogICAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgICB2YXIgZ3JvdXBJbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleChmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICAgIHJldHVybiBncm91cC5pZCA9PSBfdGhpczIyLmFjdGl2ZUdyb3VwOwogICAgICAgIH0pOwogICAgICAgIHZhciBvcmRlciA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7CiAgICAgICAgdmFyIHN0cmVhbXMgPSB0aGlzLnJhZGlvQnJvd3Nlci5hY3RpdmUubWFwKGZ1bmN0aW9uIChpbmRleCkgewogICAgICAgICAgdmFyIHJhZGlvID0gX3RoaXMyMi5yYWRpb0Jyb3dzZXIucmVzdWx0c1tpbmRleF07CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBzb3VyY2Vfc3RyZWFtX3VybDogcmFkaW8udXJsLAogICAgICAgICAgICBzdHJlYW1fdHZnX25hbWU6IHJhZGlvLm5hbWUsCiAgICAgICAgICAgIHN0cmVhbV90dmdfaWQ6ICIiLAogICAgICAgICAgICBzdHJlYW1fdHZnX2xvZ286IHJhZGlvLmZhdmljb24sCiAgICAgICAgICAgIHN0cmVhbV9yYWRpbzogdHJ1ZSwKICAgICAgICAgICAgc3RyZWFtX29yZGVyOiBvcmRlcisrCiAgICAgICAgICB9OwogICAgICAgIH0pOwogICAgICAgIGh0dHBTZXJ2aWNlLnBvc3QoImVkaXRvci9hZGQtc3RyZWFtcy8iLmNvbmNhdCh0aGlzLmFjdGl2ZUdyb3VwVHlwZSksIHsKICAgICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgZ3JvdXBfaWQ6IHRoaXMuZ2V0R3JvdXBXaXRoSWQodGhpcy5hY3RpdmVHcm91cCkuaWQsCiAgICAgICAgICBzdHJlYW1zOiBzdHJlYW1zCiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICBfdGhpczIyLmlzTG9hZGluZyA9IGZhbHNlOwoKICAgICAgICAgIGlmIChyZXMuc3RhdHVzKSB7CiAgICAgICAgICAgIF90aGlzMjIubG9hZFBsYXlsaXN0KF90aGlzMjIucGxheWxpc3RFZGl0b3IuaWQsIGdyb3VwSW5kZXgpOwogICAgICAgICAgfQogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIF90aGlzMjIuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHRoaXMucmFkaW9Ccm93c2VyLm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBmaW5kUmFkaW9icm93c2VyOiBmdW5jdGlvbiBmaW5kUmFkaW9icm93c2VyKHNlYXJjaCkgewogICAgICB2YXIgX3RoaXMyMyA9IHRoaXM7CgogICAgICBpZiAoc2VhcmNoLmxlbmd0aCA9PT0gMCkgewogICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLnJlc3VsdHMgPSBbXTsKICAgICAgICB0aGlzLnJhZGlvQnJvd3Nlci5hY3RpdmUgPSBbXTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnJhZGlvQnJvd3Nlci5pc0xvYWRpbmcgPSB0cnVlOwogICAgICAgIGh0dHBTZXJ2aWNlLnBvc3QoImVkaXRvci9maW5kLXJhZGlvYnJvd3NlciIsIHsKICAgICAgICAgIHNlYXJjaDogc2VhcmNoCiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICBfdGhpczIzLnJhZGlvQnJvd3Nlci5hY3RpdmUgPSBbXTsKCiAgICAgICAgICBpZiAocmVzLnN0YXR1cykgewogICAgICAgICAgICBfdGhpczIzLnJhZGlvQnJvd3Nlci5yZXN1bHRzID0gcmVzLmRhdGE7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBfdGhpczIzLnJhZGlvQnJvd3Nlci5yZXN1bHRzID0gW107CiAgICAgICAgICB9CgogICAgICAgICAgX3RoaXMyMy5yYWRpb0Jyb3dzZXIuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkgewogICAgICAgICAgX3RoaXMyMy5yYWRpb0Jyb3dzZXIuYWN0aXZlID0gW107CiAgICAgICAgICBfdGhpczIzLnJhZGlvQnJvd3Nlci5yZXN1bHRzID0gW107CiAgICAgICAgICBfdGhpczIzLnJhZGlvQnJvd3Nlci5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIHNvdW5kY2xvdWRNb2RhbDogZnVuY3Rpb24gc291bmRjbG91ZE1vZGFsKHNob3cpIHsKICAgICAgdmFyIF90aGlzMjQgPSB0aGlzOwoKICAgICAgdmFyIHNhdmUgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IGZhbHNlOwoKICAgICAgaWYgKHNob3cpIHsKICAgICAgICB0aGlzLnNvdW5kY2xvdWQudXJsID0gIiI7CiAgICAgICAgdGhpcy5zb3VuZGNsb3VkLnRyYWNrID0gbnVsbDsKICAgICAgfQoKICAgICAgaWYgKHNhdmUpIHsKICAgICAgICBpZiAodGhpcy5zb3VuZGNsb3VkLnRyYWNrKSB7CiAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7CiAgICAgICAgICB2YXIgZ3JvdXBJbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleChmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICAgICAgcmV0dXJuIGdyb3VwLmlkID09IF90aGlzMjQuYWN0aXZlR3JvdXA7CiAgICAgICAgICB9KTsKICAgICAgICAgIHZhciBvcmRlciA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7CiAgICAgICAgICB2YXIgc3RyZWFtcyA9IFt7CiAgICAgICAgICAgIHNvdXJjZV9zdHJlYW1fdXJsOiB0aGlzLnNvdW5kY2xvdWQudXJsLAogICAgICAgICAgICBzdHJlYW1fdHZnX25hbWU6IHRoaXMuc291bmRjbG91ZC50cmFjay50aXRsZSwKICAgICAgICAgICAgc3RyZWFtX3R2Z19pZDogIiIsCiAgICAgICAgICAgIHN0cmVhbV90dmdfbG9nbzogdGhpcy5zb3VuZGNsb3VkLnRyYWNrLmFydHdvcmtfdXJsLnJlcGxhY2UoImxhcmdlLmpwZyIsICJ0NTAweDUwMC5qcGciKSwKICAgICAgICAgICAgc3RyZWFtX3JhZGlvOiB0cnVlLAogICAgICAgICAgICBzdHJlYW1fb3JkZXI6IG9yZGVyKysKICAgICAgICAgIH1dOwogICAgICAgICAgaHR0cFNlcnZpY2UucG9zdCgiZWRpdG9yL2FkZC1zdHJlYW1zLyIuY29uY2F0KHRoaXMuYWN0aXZlR3JvdXBUeXBlKSwgewogICAgICAgICAgICBwbGF5bGlzdF9pZDogdGhpcy5wbGF5bGlzdEVkaXRvci5pZCwKICAgICAgICAgICAgZ3JvdXBfaWQ6IHRoaXMuZ2V0R3JvdXBXaXRoSWQodGhpcy5hY3RpdmVHcm91cCkuaWQsCiAgICAgICAgICAgIHN0cmVhbXM6IHN0cmVhbXMKICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgICAgICBfdGhpczI0LmlzTG9hZGluZyA9IGZhbHNlOwoKICAgICAgICAgICAgaWYgKHJlcy5zdGF0dXMpIHsKICAgICAgICAgICAgICBfdGhpczI0LmxvYWRQbGF5bGlzdChfdGhpczI0LnBsYXlsaXN0RWRpdG9yLmlkLCBncm91cEluZGV4KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkgewogICAgICAgICAgICBfdGhpczI0LmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLnNvdW5kY2xvdWQubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGdldFNvdW5kY2xvdWRUcmFjazogZnVuY3Rpb24gZ2V0U291bmRjbG91ZFRyYWNrKHVybCwgY2xpZW50X2lkKSB7CiAgICAgIHZhciBfdGhpczI1ID0gdGhpczsKCiAgICAgIGlmICh1cmwubGVuZ3RoID09PSAwIHx8ICEvc291bmRjbG91ZFwuY29tLy50ZXN0KHVybCkpIHsKICAgICAgICB0aGlzLnNvdW5kY2xvdWQudXJsID0gIiI7CiAgICAgICAgdGhpcy5zb3VuZGNsb3VkLnRyYWNrID0gbnVsbDsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNvdW5kY2xvdWQuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgICBodHRwU2VydmljZS5wb3N0KCJlZGl0b3Ivc291bmRjbG91ZC10cmFjayIsIHsKICAgICAgICAgIHVybDogdXJsLAogICAgICAgICAgY2xpZW50X2lkOiBjbGllbnRfaWQKICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICAgIGlmIChyZXMuc3RhdHVzICYmIE9iamVjdC5rZXlzKHJlcy5kYXRhKS5sZW5ndGgpIHsKICAgICAgICAgICAgX3RoaXMyNS5zb3VuZGNsb3VkLnRyYWNrID0gcmVzLmRhdGE7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBfdGhpczI1LnNvdW5kY2xvdWQudHJhY2sgPSBudWxsOwogICAgICAgICAgfQoKICAgICAgICAgIF90aGlzMjUuc291bmRjbG91ZC5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBfdGhpczI1LnNvdW5kY2xvdWQudHJhY2sgPSBudWxsOwogICAgICAgICAgX3RoaXMyNS5zb3VuZGNsb3VkLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgeW91dHViZU1vZGFsOiBmdW5jdGlvbiB5b3V0dWJlTW9kYWwoc2hvdykgewogICAgICB2YXIgX3RoaXMyNiA9IHRoaXM7CgogICAgICB2YXIgc2F2ZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogZmFsc2U7CgogICAgICBpZiAoc2hvdykgewogICAgICAgIHRoaXMueW91dHViZS51cmwgPSAiIjsKICAgICAgICB0aGlzLnlvdXR1YmUudmlkZW8gPSBudWxsOwogICAgICAgIHRoaXMueW91dHViZS5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfQoKICAgICAgaWYgKHNhdmUpIHsKICAgICAgICBpZiAodGhpcy55b3V0dWJlLnZpZGVvKSB7CiAgICAgICAgICB0aGlzLnlvdXR1YmUuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgIHZhciBncm91cEluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KGZ1bmN0aW9uIChncm91cCkgewogICAgICAgICAgICByZXR1cm4gZ3JvdXAuaWQgPT0gX3RoaXMyNi5hY3RpdmVHcm91cDsKICAgICAgICAgIH0pOwogICAgICAgICAgdmFyIG9yZGVyID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsKICAgICAgICAgIHZhciBzdHJlYW1zID0gW3sKICAgICAgICAgICAgc291cmNlX3N0cmVhbV91cmw6IHRoaXMueW91dHViZS51cmwsCiAgICAgICAgICAgIHN0cmVhbV90dmdfbmFtZTogdGhpcy55b3V0dWJlLnZpZGVvLnZpZGVvRGV0YWlscy50aXRsZSwKICAgICAgICAgICAgc3RyZWFtX3R2Z19pZDogIiIsCiAgICAgICAgICAgIHN0cmVhbV90dmdfbG9nbzogImh0dHA6Ly9pLnl0aW1nLmNvbS92aS8iLmNvbmNhdCh0aGlzLnlvdXR1YmUudmlkZW9JZCwgIi9tYXhyZXNkZWZhdWx0LmpwZyIpLAogICAgICAgICAgICBzdHJlYW1fb3JkZXI6IG9yZGVyKysKICAgICAgICAgIH1dOwogICAgICAgICAgaHR0cFNlcnZpY2UucG9zdCgiZWRpdG9yL2FkZC1zdHJlYW1zLyIuY29uY2F0KHRoaXMuYWN0aXZlR3JvdXBUeXBlKSwgewogICAgICAgICAgICBwbGF5bGlzdF9pZDogdGhpcy5wbGF5bGlzdEVkaXRvci5pZCwKICAgICAgICAgICAgZ3JvdXBfaWQ6IHRoaXMuZ2V0R3JvdXBXaXRoSWQodGhpcy5hY3RpdmVHcm91cCkuaWQsCiAgICAgICAgICAgIHN0cmVhbXM6IHN0cmVhbXMKICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgICAgICBfdGhpczI2LnlvdXR1YmUuaXNMb2FkaW5nID0gZmFsc2U7CgogICAgICAgICAgICBpZiAocmVzLnN0YXR1cykgewogICAgICAgICAgICAgIF90aGlzMjYubG9hZFBsYXlsaXN0KF90aGlzMjYucGxheWxpc3RFZGl0b3IuaWQsIGdyb3VwSW5kZXgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIF90aGlzMjYueW91dHViZS5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy55b3V0dWJlLm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBnZXRZb3V0dWJlUGFnZTogZnVuY3Rpb24gZ2V0WW91dHViZVBhZ2UodmlkZW9JZCkgewogICAgICB2YXIgX3RoaXMyNyA9IHRoaXM7CgogICAgICB0aGlzLnlvdXR1YmUuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UucG9zdCgiZWRpdG9yL3lvdXR1YmUtdmlkZW8iLCB7CiAgICAgICAgdmlkZW9faWQ6IHZpZGVvSWQKICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgaWYgKHJlcy5zdGF0dXMgJiYgT2JqZWN0LmtleXMocmVzLmRhdGEpLmxlbmd0aCkgewogICAgICAgICAgX3RoaXMyNy55b3V0dWJlLnZpZGVvID0gcmVzLmRhdGE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIF90aGlzMjcueW91dHViZS52aWRlbyA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICBfdGhpczI3LnlvdXR1YmUuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczI3LnlvdXR1YmUudmlkZW8gPSBudWxsOwogICAgICAgIF90aGlzMjcueW91dHViZS5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfSk7CiAgICB9LAogICAgdmltZW9Nb2RhbDogZnVuY3Rpb24gdmltZW9Nb2RhbChzaG93KSB7CiAgICAgIHZhciBfdGhpczI4ID0gdGhpczsKCiAgICAgIHZhciBzYXZlID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiBmYWxzZTsKCiAgICAgIGlmIChzaG93KSB7CiAgICAgICAgdGhpcy52aW1lby51cmwgPSAiIjsKICAgICAgICB0aGlzLnZpbWVvLnZpZGVvID0gbnVsbDsKICAgICAgICB0aGlzLnZpbWVvLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9CgogICAgICBpZiAoc2F2ZSkgewogICAgICAgIGlmICh0aGlzLnZpbWVvLnZpZGVvKSB7CiAgICAgICAgICB0aGlzLnZpbWVvLmlzTG9hZGluZyA9IHRydWU7CiAgICAgICAgICB2YXIgZ3JvdXBJbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleChmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICAgICAgcmV0dXJuIGdyb3VwLmlkID09IF90aGlzMjguYWN0aXZlR3JvdXA7CiAgICAgICAgICB9KTsKICAgICAgICAgIHZhciBvcmRlciA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7CiAgICAgICAgICB2YXIgc3RyZWFtcyA9IFt7CiAgICAgICAgICAgIHNvdXJjZV9zdHJlYW1fdXJsOiB0aGlzLnZpbWVvLnVybCwKICAgICAgICAgICAgc3RyZWFtX3R2Z19uYW1lOiB0aGlzLnZpbWVvLnZpZGVvLnZpZGVvLnRpdGxlLAogICAgICAgICAgICBzdHJlYW1fdHZnX2lkOiAiIiwKICAgICAgICAgICAgc3RyZWFtX3R2Z19sb2dvOiB0aGlzLnZpbWVvLnZpZGVvLnZpZGVvLnRodW1icy5iYXNlLAogICAgICAgICAgICBzdHJlYW1fb3JkZXI6IG9yZGVyKysKICAgICAgICAgIH1dOwogICAgICAgICAgaHR0cFNlcnZpY2UucG9zdCgiZWRpdG9yL2FkZC1zdHJlYW1zLyIuY29uY2F0KHRoaXMuYWN0aXZlR3JvdXBUeXBlKSwgewogICAgICAgICAgICBwbGF5bGlzdF9pZDogdGhpcy5wbGF5bGlzdEVkaXRvci5pZCwKICAgICAgICAgICAgZ3JvdXBfaWQ6IHRoaXMuZ2V0R3JvdXBXaXRoSWQodGhpcy5hY3RpdmVHcm91cCkuaWQsCiAgICAgICAgICAgIHN0cmVhbXM6IHN0cmVhbXMKICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgICAgICBfdGhpczI4LnZpbWVvLmlzTG9hZGluZyA9IGZhbHNlOwoKICAgICAgICAgICAgaWYgKHJlcy5zdGF0dXMpIHsKICAgICAgICAgICAgICBfdGhpczI4LmxvYWRQbGF5bGlzdChfdGhpczI4LnBsYXlsaXN0RWRpdG9yLmlkLCBncm91cEluZGV4KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkgewogICAgICAgICAgICBfdGhpczI4LnZpbWVvLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLnZpbWVvLm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBnZXRWaW1lb0NvbmZpZzogZnVuY3Rpb24gZ2V0VmltZW9Db25maWcodmlkZW9JZCkgewogICAgICB2YXIgX3RoaXMyOSA9IHRoaXM7CgogICAgICB0aGlzLnZpbWVvLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGh0dHBTZXJ2aWNlLnBvc3QoImVkaXRvci92aW1lby12aWRlbyIsIHsKICAgICAgICB2aWRlb19pZDogdmlkZW9JZAogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICBfdGhpczI5LnZpbWVvLnZpZGVvID0gcmVzLmRhdGE7CiAgICAgICAgX3RoaXMyOS52aW1lby5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfSk7CiAgICB9LAogICAgZGFpbHltb3Rpb25Nb2RhbDogZnVuY3Rpb24gZGFpbHltb3Rpb25Nb2RhbChzaG93KSB7CiAgICAgIHZhciBfdGhpczMwID0gdGhpczsKCiAgICAgIHZhciBzYXZlID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiBmYWxzZTsKCiAgICAgIGlmIChzaG93KSB7CiAgICAgICAgdGhpcy5kYWlseW1vdGlvbi51cmwgPSAiIjsKICAgICAgICB0aGlzLmRhaWx5bW90aW9uLnZpZGVvID0gbnVsbDsKICAgICAgICB0aGlzLmRhaWx5bW90aW9uLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9CgogICAgICBpZiAoc2F2ZSkgewogICAgICAgIGlmICh0aGlzLmRhaWx5bW90aW9uLnZpZGVvKSB7CiAgICAgICAgICB0aGlzLmRhaWx5bW90aW9uLmlzTG9hZGluZyA9IHRydWU7CiAgICAgICAgICB2YXIgZ3JvdXBJbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleChmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICAgICAgcmV0dXJuIGdyb3VwLmlkID09IF90aGlzMzAuYWN0aXZlR3JvdXA7CiAgICAgICAgICB9KTsKICAgICAgICAgIHZhciBvcmRlciA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7CiAgICAgICAgICB2YXIgc3RyZWFtcyA9IFt7CiAgICAgICAgICAgIHNvdXJjZV9zdHJlYW1fdXJsOiB0aGlzLmRhaWx5bW90aW9uLnVybCwKICAgICAgICAgICAgc3RyZWFtX3R2Z19uYW1lOiB0aGlzLmRhaWx5bW90aW9uLnZpZGVvLnRpdGxlLAogICAgICAgICAgICBzdHJlYW1fdHZnX2lkOiAiIiwKICAgICAgICAgICAgc3RyZWFtX3R2Z19sb2dvOiB0aGlzLmRhaWx5bW90aW9uLnZpZGVvLnRodW1ibmFpbF8xMDgwX3VybCwKICAgICAgICAgICAgc3RyZWFtX29yZGVyOiBvcmRlcisrCiAgICAgICAgICB9XTsKICAgICAgICAgIGh0dHBTZXJ2aWNlLnBvc3QoImVkaXRvci9hZGQtc3RyZWFtcy8iLmNvbmNhdCh0aGlzLmFjdGl2ZUdyb3VwVHlwZSksIHsKICAgICAgICAgICAgcGxheWxpc3RfaWQ6IHRoaXMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICAgIGdyb3VwX2lkOiB0aGlzLmdldEdyb3VwV2l0aElkKHRoaXMuYWN0aXZlR3JvdXApLmlkLAogICAgICAgICAgICBzdHJlYW1zOiBzdHJlYW1zCiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICAgICAgX3RoaXMzMC5kYWlseW1vdGlvbi5pc0xvYWRpbmcgPSBmYWxzZTsKCiAgICAgICAgICAgIGlmIChyZXMuc3RhdHVzKSB7CiAgICAgICAgICAgICAgX3RoaXMzMC5sb2FkUGxheWxpc3QoX3RoaXMzMC5wbGF5bGlzdEVkaXRvci5pZCwgZ3JvdXBJbmRleCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgX3RoaXMzMC5kYWlseW1vdGlvbi5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5kYWlseW1vdGlvbi5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgZ2V0RGFpbHltb3Rpb25Db25maWc6IGZ1bmN0aW9uIGdldERhaWx5bW90aW9uQ29uZmlnKHZpZGVvSWQpIHsKICAgICAgdmFyIF90aGlzMzEgPSB0aGlzOwoKICAgICAgdGhpcy5kYWlseW1vdGlvbi5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZS5wb3N0KCJlZGl0b3IvZGFpbHltb3Rpb24tdmlkZW8iLCB7CiAgICAgICAgdmlkZW9faWQ6IHZpZGVvSWQKICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgX3RoaXMzMS5kYWlseW1vdGlvbi52aWRlbyA9IHJlcy5kYXRhOwogICAgICAgIF90aGlzMzEuZGFpbHltb3Rpb24uaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0pOwogICAgfSwKICAgIHRlZFRhbGtzTW9kYWw6IGZ1bmN0aW9uIHRlZFRhbGtzTW9kYWwoc2hvdykgewogICAgICB2YXIgX3RoaXMzMiA9IHRoaXM7CgogICAgICB2YXIgc2F2ZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogZmFsc2U7CgogICAgICBpZiAoc2hvdykgewogICAgICAgIHRoaXMudGVkVGFsa3MudXJsID0gIiI7CiAgICAgICAgdGhpcy50ZWRUYWxrcy52aWRlbyA9IG51bGw7CiAgICAgICAgdGhpcy50ZWRUYWxrcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfQoKICAgICAgaWYgKHNhdmUpIHsKICAgICAgICBpZiAodGhpcy50ZWRUYWxrcy52aWRlbykgewogICAgICAgICAgdGhpcy50ZWRUYWxrcy5pc0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgdmFyIGdyb3VwSW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgICAgIHJldHVybiBncm91cC5pZCA9PSBfdGhpczMyLmFjdGl2ZUdyb3VwOwogICAgICAgICAgfSk7CiAgICAgICAgICB2YXIgb3JkZXIgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOwogICAgICAgICAgdmFyIHN0cmVhbXMgPSBbewogICAgICAgICAgICBzb3VyY2Vfc3RyZWFtX3VybDogdGhpcy50ZWRUYWxrcy51cmwsCiAgICAgICAgICAgIHN0cmVhbV90dmdfbmFtZTogdGhpcy50ZWRUYWxrcy52aWRlby50aXRsZSwKICAgICAgICAgICAgc3RyZWFtX3R2Z19pZDogIiIsCiAgICAgICAgICAgIHN0cmVhbV90dmdfbG9nbzogdGhpcy50ZWRUYWxrcy52aWRlby5oZXJvLAogICAgICAgICAgICBzdHJlYW1fb3JkZXI6IG9yZGVyKysKICAgICAgICAgIH1dOwogICAgICAgICAgaHR0cFNlcnZpY2UucG9zdCgiZWRpdG9yL2FkZC1zdHJlYW1zLyIuY29uY2F0KHRoaXMuYWN0aXZlR3JvdXBUeXBlKSwgewogICAgICAgICAgICBwbGF5bGlzdF9pZDogdGhpcy5wbGF5bGlzdEVkaXRvci5pZCwKICAgICAgICAgICAgZ3JvdXBfaWQ6IHRoaXMuZ2V0R3JvdXBXaXRoSWQodGhpcy5hY3RpdmVHcm91cCkuaWQsCiAgICAgICAgICAgIHN0cmVhbXM6IHN0cmVhbXMKICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgICAgICBfdGhpczMyLnRlZFRhbGtzLmlzTG9hZGluZyA9IGZhbHNlOwoKICAgICAgICAgICAgaWYgKHJlcy5zdGF0dXMpIHsKICAgICAgICAgICAgICBfdGhpczMyLmxvYWRQbGF5bGlzdChfdGhpczMyLnBsYXlsaXN0RWRpdG9yLmlkLCBncm91cEluZGV4KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkgewogICAgICAgICAgICBfdGhpczMyLnRlZFRhbGtzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLnRlZFRhbGtzLm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBnZXRUZWRUYWxrc0NvbmZpZzogZnVuY3Rpb24gZ2V0VGVkVGFsa3NDb25maWcodXJsKSB7CiAgICAgIHZhciBfdGhpczMzID0gdGhpczsKCiAgICAgIHRoaXMudGVkVGFsa3MuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UucG9zdCgiZWRpdG9yL3RlZC10YWxrcy12aWRlbyIsIHsKICAgICAgICB1cmw6IHVybAogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICBfdGhpczMzLnRlZFRhbGtzLnZpZGVvID0gcmVzLmRhdGEudGFsa3MubGVuZ3RoID8gcmVzLmRhdGEudGFsa3NbMF0gOiBudWxsOwogICAgICAgIF90aGlzMzMudGVkVGFsa3MuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0pOwogICAgfSwKICAgIHhoYW1zdGVyTW9kYWw6IGZ1bmN0aW9uIHhoYW1zdGVyTW9kYWwoc2hvdykgewogICAgICB2YXIgX3RoaXMzNCA9IHRoaXM7CgogICAgICB2YXIgc2F2ZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogZmFsc2U7CgogICAgICBpZiAoc2hvdykgewogICAgICAgIHRoaXMueGhhbXN0ZXIudXJsID0gIiI7CiAgICAgICAgdGhpcy54aGFtc3Rlci52aWRlbyA9IG51bGw7CiAgICAgICAgdGhpcy54aGFtc3Rlci5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfQoKICAgICAgaWYgKHNhdmUpIHsKICAgICAgICBpZiAodGhpcy54aGFtc3Rlci52aWRlbykgewogICAgICAgICAgdGhpcy54aGFtc3Rlci5pc0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgdmFyIGdyb3VwSW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgICAgIHJldHVybiBncm91cC5pZCA9PSBfdGhpczM0LmFjdGl2ZUdyb3VwOwogICAgICAgICAgfSk7CiAgICAgICAgICB2YXIgb3JkZXIgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOwogICAgICAgICAgdmFyIHN0cmVhbXMgPSBbewogICAgICAgICAgICBzb3VyY2Vfc3RyZWFtX3VybDogdGhpcy54aGFtc3Rlci51cmwsCiAgICAgICAgICAgIHN0cmVhbV90dmdfbmFtZTogdGhpcy54aGFtc3Rlci52aWRlby52aWRlb0VudGl0eS50aXRsZSwKICAgICAgICAgICAgc3RyZWFtX3R2Z19pZDogIiIsCiAgICAgICAgICAgIHN0cmVhbV90dmdfbG9nbzogdGhpcy54aGFtc3Rlci52aWRlby52aWRlb0VudGl0eS50aHVtYkJpZywKICAgICAgICAgICAgc3RyZWFtX29yZGVyOiBvcmRlcisrCiAgICAgICAgICB9XTsKICAgICAgICAgIGh0dHBTZXJ2aWNlLnBvc3QoImVkaXRvci9hZGQtc3RyZWFtcy8iLmNvbmNhdCh0aGlzLmFjdGl2ZUdyb3VwVHlwZSksIHsKICAgICAgICAgICAgcGxheWxpc3RfaWQ6IHRoaXMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICAgIGdyb3VwX2lkOiB0aGlzLmdldEdyb3VwV2l0aElkKHRoaXMuYWN0aXZlR3JvdXApLmlkLAogICAgICAgICAgICBzdHJlYW1zOiBzdHJlYW1zCiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICAgICAgX3RoaXMzNC54aGFtc3Rlci5pc0xvYWRpbmcgPSBmYWxzZTsKCiAgICAgICAgICAgIGlmIChyZXMuc3RhdHVzKSB7CiAgICAgICAgICAgICAgX3RoaXMzNC5sb2FkUGxheWxpc3QoX3RoaXMzNC5wbGF5bGlzdEVkaXRvci5pZCwgZ3JvdXBJbmRleCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgX3RoaXMzNC54aGFtc3Rlci5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy54aGFtc3Rlci5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgZ2V0WGhhbXN0ZXJDb25maWc6IGZ1bmN0aW9uIGdldFhoYW1zdGVyQ29uZmlnKHVybCkgewogICAgICB2YXIgX3RoaXMzNSA9IHRoaXM7CgogICAgICB0aGlzLnhoYW1zdGVyLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGh0dHBTZXJ2aWNlLnBvc3QoImVkaXRvci94aGFtc3Rlci12aWRlbyIsIHsKICAgICAgICB1cmw6IHVybAogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICBfdGhpczM1LnhoYW1zdGVyLnZpZGVvID0gcmVzLmRhdGE7CiAgICAgICAgX3RoaXMzNS54aGFtc3Rlci5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfSk7CiAgICB9LAogICAgZ3JvdXBEb3VibGVDbGljazogZnVuY3Rpb24gZ3JvdXBEb3VibGVDbGljaygpIHsKICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBzLmxlbmd0aCA9PT0gMSkgewogICAgICAgIHRoaXMuZWRpdEdyb3VwTW9kYWwodHJ1ZSk7CiAgICAgIH0KICAgIH0sCiAgICBzdHJlYW1Eb3VibGVDbGljazogZnVuY3Rpb24gc3RyZWFtRG91YmxlQ2xpY2soKSB7CiAgICAgIGlmICh0aGlzLmFjdGl2ZVN0cmVhbXMubGVuZ3RoID09PSAxKSB7CiAgICAgICAgdGhpcy5lZGl0U3RyZWFtTW9kYWwodHJ1ZSk7CiAgICAgIH0KICAgIH0sCiAgICBsb2FkTG9nb0NvdW50cmllczogZnVuY3Rpb24gbG9hZExvZ29Db3VudHJpZXMoKSB7CiAgICAgIHZhciBfdGhpczM2ID0gdGhpczsKCiAgICAgIHRoaXMuZmluZExvZ28uaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UuZ2V0KCJlZGl0b3IvbG9nby1jb3VudHJpZXMiKS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICBfdGhpczM2LmZpbmRMb2dvLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIF90aGlzMzYuZmluZExvZ28uY291bnRyaWVzID0gcmVzLmRhdGEubWFwKGZ1bmN0aW9uIChjb3VudHJ5KSB7CiAgICAgICAgICB2YXIgY24gPSBfdGhpczM2LmNvdW50cmllcy5maW5kKGZ1bmN0aW9uIChjbnQpIHsKICAgICAgICAgICAgcmV0dXJuIGNudC5jb2RlLnRvTG93ZXJDYXNlKCkgPT0gY291bnRyeS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgfSk7CgogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgdGV4dDogY24gPyBjbi5uYW1lIDogY291bnRyeSwKICAgICAgICAgICAgdmFsdWU6IGNvdW50cnkKICAgICAgICAgIH07CiAgICAgICAgfSkuc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgcmV0dXJuIGEudGV4dC50b1VwcGVyQ2FzZSgpIDwgYi50ZXh0LnRvVXBwZXJDYXNlKCkgPyAtMSA6IGEudGV4dC50b1VwcGVyQ2FzZSgpID4gYi50ZXh0LnRvVXBwZXJDYXNlKCkgPyAxIDogMDsKICAgICAgICB9KTsKICAgICAgICBfdGhpczM2LmFzc2lnbkxvZ28uY291bnRyaWVzID0gX3RvQ29uc3VtYWJsZUFycmF5KF90aGlzMzYuZmluZExvZ28uY291bnRyaWVzKTsKICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzMzYuZmluZExvZ28uaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0pOwogICAgfSwKICAgIGxvYWRUVkdJRENvdW50cmllczogZnVuY3Rpb24gbG9hZFRWR0lEQ291bnRyaWVzKCkgewogICAgICB2YXIgX3RoaXMzNyA9IHRoaXM7CgogICAgICB0aGlzLmFzc2lnblRWR0lELmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGh0dHBTZXJ2aWNlLmdldCgiZWRpdG9yL3R2LWd1aWRlLWNvdW50cmllcyIpLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgIF90aGlzMzcuYXNzaWduVFZHSUQuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgX3RoaXMzNy5hc3NpZ25UVkdJRC5jb3VudHJpZXMgPSByZXMuZGF0YS5tYXAoZnVuY3Rpb24gKGNvdW50cnkpIHsKICAgICAgICAgIHZhciBjbiA9IF90aGlzMzcuY291bnRyaWVzLmZpbmQoZnVuY3Rpb24gKGNudCkgewogICAgICAgICAgICByZXR1cm4gY250LmNvZGUudG9Mb3dlckNhc2UoKSA9PSBjb3VudHJ5LnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICB9KTsKCiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICB0ZXh0OiBjbiA/IGNuLm5hbWUgOiBjb3VudHJ5LAogICAgICAgICAgICB2YWx1ZTogY291bnRyeQogICAgICAgICAgfTsKICAgICAgICB9KS5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICByZXR1cm4gYS50ZXh0LnRvVXBwZXJDYXNlKCkgPCBiLnRleHQudG9VcHBlckNhc2UoKSA/IC0xIDogYS50ZXh0LnRvVXBwZXJDYXNlKCkgPiBiLnRleHQudG9VcHBlckNhc2UoKSA/IDEgOiAwOwogICAgICAgIH0pOwoKICAgICAgICBfdGhpczM3LmFzc2lnblRWR0lELmNvdW50cmllcy51bnNoaWZ0KHsKICAgICAgICAgIHRleHQ6IF90aGlzMzcuJHQoImdlbmVyYWwuYWxsIiksCiAgICAgICAgICB2YWx1ZTogImFsbCIKICAgICAgICB9KTsKCiAgICAgICAgX3RoaXMzNy5maW5kVFZHSUQuY291bnRyaWVzID0gX3RvQ29uc3VtYWJsZUFycmF5KF90aGlzMzcuYXNzaWduVFZHSUQuY291bnRyaWVzKTsKICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzMzcuYXNzaWduVFZHSUQuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0pOwogICAgfSwKICAgIGxvYWRMb2dvc0ZpbmQ6IGZ1bmN0aW9uIGxvYWRMb2dvc0ZpbmQoY291bnRyeSkgewogICAgICB2YXIgX3RoaXMzOCA9IHRoaXM7CgogICAgICB0aGlzLmZpbmRMb2dvLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGh0dHBTZXJ2aWNlLmdldCgiZWRpdG9yL2xvZ29zLyIuY29uY2F0KGNvdW50cnkpKS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICBfdGhpczM4LmZpbmRMb2dvLmxvZ28gPSAiIjsKICAgICAgICBfdGhpczM4LmZpbmRMb2dvLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIF90aGlzMzguZmluZExvZ28ubG9nb3MgPSByZXMuZGF0YS5tYXAoZnVuY3Rpb24gKGxvZ28pIHsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHRleHQ6IGxvZ28ubGFiZWwsCiAgICAgICAgICAgIHZhbHVlOiBsb2dvLmZpbGVuYW1lCiAgICAgICAgICB9OwogICAgICAgIH0pOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMzOC5maW5kTG9nby5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfSk7CiAgICB9LAogICAgZmluZExvZ29Nb2RhbDogZnVuY3Rpb24gZmluZExvZ29Nb2RhbChzaG93KSB7CiAgICAgIHZhciBzYXZlID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiBmYWxzZTsKICAgICAgdmFyIHNlbGVjdGVkID0gdGhpcy5nZXRTdHJlYW1XaXRoSWQodGhpcy5hY3RpdmVTdHJlYW1zWzBdKTsKCiAgICAgIGlmIChzaG93KSB7CiAgICAgICAgdGhpcy5maW5kTG9nby5sb2dvID0gIiI7CiAgICAgICAgdGhpcy5maW5kTG9nby50aXRsZSA9IHNlbGVjdGVkLnN0cmVhbV90dmdfbmFtZTsKICAgICAgfQoKICAgICAgdGhpcy5maW5kTG9nby5zZWFyY2ggPSAiIjsKCiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgaWYgKHNlbGVjdGVkKSB7CiAgICAgICAgICBzZWxlY3RlZC5zdHJlYW1fdHZnX2xvZ28gPSAiaHR0cDovL3N0YXRpYy5pcHR2LXRvb2xzLmNvbS8iLmNvbmNhdCh0aGlzLmZpbmRMb2dvLmNvdW50cnksICIvIikuY29uY2F0KHRoaXMuZmluZExvZ28ubG9nbyk7CiAgICAgICAgICBzZWxlY3RlZC5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5maW5kTG9nby5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgbG9hZExvZ29zQXNzaWduOiBmdW5jdGlvbiBsb2FkTG9nb3NBc3NpZ24oY291bnRyeSkgewogICAgICB2YXIgX3RoaXMzOSA9IHRoaXM7CgogICAgICB0aGlzLmFzc2lnbkxvZ28uaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UuZ2V0KCJlZGl0b3IvbG9nb3MvIi5jb25jYXQoY291bnRyeSkpLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgIF90aGlzMzkuYXNzaWduTG9nby5sb2dvID0gIiI7CiAgICAgICAgX3RoaXMzOS5hc3NpZ25Mb2dvLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIF90aGlzMzkuYXNzaWduTG9nby5sb2dvcyA9IHJlcy5kYXRhLm1hcChmdW5jdGlvbiAobG9nbykgewogICAgICAgICAgcmV0dXJuIGxvZ28uZmlsZW5hbWU7CiAgICAgICAgfSk7CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczM5LmFzc2lnbkxvZ28uaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0pOwogICAgfSwKICAgIGFzc2lnbkxvZ29Nb2RhbDogZnVuY3Rpb24gYXNzaWduTG9nb01vZGFsKHNob3cpIHsKICAgICAgdmFyIF90aGlzNDAgPSB0aGlzOwoKICAgICAgdmFyIHNhdmUgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IGZhbHNlOwoKICAgICAgaWYgKHNob3cpIHsKICAgICAgICB0aGlzLmFzc2lnbkxvZ28ubG9nbyA9ICIiOwogICAgICB9CgogICAgICBpZiAoc2F2ZSkgewogICAgICAgIHZhciBjaGFuZ2VkID0gZmFsc2U7CgogICAgICAgIHZhciBzdHJpbmdTaW1pbGFyaXR5ID0gcmVxdWlyZSgic3RyaW5nLXNpbWlsYXJpdHkiKTsKCiAgICAgICAgdmFyIHN0cmVhbXMgPSBbXTsKCiAgICAgICAgaWYgKHRoaXMuYXNzaWduTG9nby5hc3NpZ25BbGwgPT0gMSkgewogICAgICAgICAgc3RyZWFtcyA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtczsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc3RyZWFtcyA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5maWx0ZXIoZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgICAgICByZXR1cm4gIXN0cmVhbS5zdHJlYW1fdHZnX2xvZ28ubGVuZ3RoOwogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBzdHJlYW1zLm1hcChmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAgICAgICB2YXIgbWF0Y2gxID0gc3RyaW5nU2ltaWxhcml0eS5maW5kQmVzdE1hdGNoKFN0cmluZyhzdHJlYW0uc3RyZWFtX3R2Z19uYW1lKS5yZXBsYWNlKC8gaGQkL2ksICIiKSwgX3RoaXM0MC5hc3NpZ25Mb2dvLmxvZ29zKS5iZXN0TWF0Y2g7CiAgICAgICAgICB2YXIgbWF0Y2gyID0gc3RyaW5nU2ltaWxhcml0eS5maW5kQmVzdE1hdGNoKFN0cmluZyhzdHJlYW0uc3RyZWFtX3R2Z19pZCksIF90aGlzNDAuYXNzaWduTG9nby5sb2dvcykuYmVzdE1hdGNoOwoKICAgICAgICAgIGlmIChtYXRjaDEucmF0aW5nID49IDAuMykgewogICAgICAgICAgICBjaGFuZ2VkID0gdHJ1ZTsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfbG9nbyA9ICJodHRwOi8vc3RhdGljLmlwdHYtdG9vbHMuY29tLyIuY29uY2F0KF90aGlzNDAuYXNzaWduTG9nby5jb3VudHJ5LCAiLyIpLmNvbmNhdChtYXRjaDEudGFyZ2V0KTsKICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgIH0gZWxzZSBpZiAobWF0Y2gyLnJhdGluZyA+PSAwLjUpIHsKICAgICAgICAgICAgY2hhbmdlZCA9IHRydWU7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX2xvZ28gPSAiaHR0cDovL3N0YXRpYy5pcHR2LXRvb2xzLmNvbS8iLmNvbmNhdChfdGhpczQwLmFzc2lnbkxvZ28uY291bnRyeSwgIi8iKS5jb25jYXQobWF0Y2gyLnRhcmdldCk7CiAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gY2hhbmdlZDsKICAgICAgfQoKICAgICAgdGhpcy5hc3NpZ25Mb2dvLm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBsb2FkVFZHSURBc3NpZ246IGZ1bmN0aW9uIGxvYWRUVkdJREFzc2lnbihjb3VudHJ5KSB7CiAgICAgIHZhciBfdGhpczQxID0gdGhpczsKCiAgICAgIHRoaXMuYXNzaWduVFZHSUQuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UuZ2V0KCJlZGl0b3IvdHYtZ3VpZGUvIi5jb25jYXQoY291bnRyeSkpLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgIF90aGlzNDEuYXNzaWduVFZHSUQuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgX3RoaXM0MS5hc3NpZ25UVkdJRC5jaGFubmVscyA9IHJlcy5kYXRhOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXM0MS5hc3NpZ25UVkdJRC5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfSk7CiAgICB9LAogICAgYXNzaWduVFZHSURNb2RhbDogZnVuY3Rpb24gYXNzaWduVFZHSURNb2RhbChzaG93KSB7CiAgICAgIHZhciBfdGhpczQyID0gdGhpczsKCiAgICAgIHZhciBzYXZlID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiBmYWxzZTsKCiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgdmFyIGNoYW5nZWQgPSBmYWxzZTsKCiAgICAgICAgdmFyIHN0cmluZ1NpbWlsYXJpdHkgPSByZXF1aXJlKCJzdHJpbmctc2ltaWxhcml0eSIpOwoKICAgICAgICB2YXIgc3RyZWFtcyA9IFtdOwoKICAgICAgICBpZiAodGhpcy5hc3NpZ25UVkdJRC5hc3NpZ25BbGwgPT0gMSkgewogICAgICAgICAgc3RyZWFtcyA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtczsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc3RyZWFtcyA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5maWx0ZXIoZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgICAgICByZXR1cm4gIXN0cmVhbS5zdHJlYW1fdHZnX2lkLmxlbmd0aCB8fCBzdHJlYW0uc3RyZWFtX3R2Z19pZC5sZW5ndGggPT0gMDsKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgdmFyIGNoYW5uZWxOYW1lcyA9IHRoaXMuYXNzaWduVFZHSUQuY2hhbm5lbHMubWFwKGZ1bmN0aW9uIChjaGFubmVsKSB7CiAgICAgICAgICByZXR1cm4gY2hhbm5lbC50dmdfbmFtZS50b0xvd2VyQ2FzZSgpOwogICAgICAgIH0pOwogICAgICAgIHZhciBjaGFubmVsSWRzID0gdGhpcy5hc3NpZ25UVkdJRC5jaGFubmVscy5tYXAoZnVuY3Rpb24gKGNoYW5uZWwpIHsKICAgICAgICAgIHJldHVybiBjaGFubmVsLnR2Z19pZC50b0xvd2VyQ2FzZSgpOwogICAgICAgIH0pOwogICAgICAgIHN0cmVhbXMubWFwKGZ1bmN0aW9uIChzdHJlYW0pIHsKICAgICAgICAgIHZhciBtYXRjaDEgPSBzdHJpbmdTaW1pbGFyaXR5LmZpbmRCZXN0TWF0Y2goU3RyaW5nKHN0cmVhbS5zdHJlYW1fdHZnX25hbWUpLnRvTG93ZXJDYXNlKCksIGNoYW5uZWxOYW1lcykuYmVzdE1hdGNoOwogICAgICAgICAgdmFyIG1hdGNoMiA9IHN0cmluZ1NpbWlsYXJpdHkuZmluZEJlc3RNYXRjaChTdHJpbmcoc3RyZWFtLnN0cmVhbV90dmdfaWQpLnRvTG93ZXJDYXNlKCksIGNoYW5uZWxJZHMpLmJlc3RNYXRjaDsKICAgICAgICAgIHZhciBtYXRjaDMgPSBzdHJpbmdTaW1pbGFyaXR5LmZpbmRCZXN0TWF0Y2goU3RyaW5nKHN0cmVhbS5zdHJlYW1fdHZnX25hbWUpLnJlcGxhY2UoLyBoZCR8IGZoZCR8IGhldmMkfCBoMjY1JHwvaSwgIiIpLnRvTG93ZXJDYXNlKCksIGNoYW5uZWxOYW1lcykuYmVzdE1hdGNoOwoKICAgICAgICAgIGlmIChtYXRjaDIucmF0aW5nID49IDAuNzUpIHsKICAgICAgICAgICAgY2hhbmdlZCA9IHRydWU7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX2lkID0gbWF0Y2gyLnRhcmdldDsKICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgIH0gZWxzZSBpZiAobWF0Y2gxLnJhdGluZyA+PSAwLjc1KSB7CiAgICAgICAgICAgIGNoYW5nZWQgPSB0cnVlOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19pZCA9IF90aGlzNDIuYXNzaWduVFZHSUQuY2hhbm5lbHMuZmluZChmdW5jdGlvbiAoY2hhbm5lbCkgewogICAgICAgICAgICAgIHJldHVybiBjaGFubmVsLnR2Z19uYW1lLnRvTG93ZXJDYXNlKCkgPT09IG1hdGNoMS50YXJnZXQ7CiAgICAgICAgICAgIH0pLnR2Z19pZDsKICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgIH0gZWxzZSBpZiAobWF0Y2gzLnJhdGluZyA+PSAwLjc1KSB7CiAgICAgICAgICAgIGNoYW5nZWQgPSB0cnVlOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19pZCA9IF90aGlzNDIuYXNzaWduVFZHSUQuY2hhbm5lbHMuZmluZChmdW5jdGlvbiAoY2hhbm5lbCkgewogICAgICAgICAgICAgIHJldHVybiBjaGFubmVsLnR2Z19uYW1lLnRvTG93ZXJDYXNlKCkgPT09IG1hdGNoMS50YXJnZXQ7CiAgICAgICAgICAgIH0pLnR2Z19pZDsKICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNoYW5nZWQgPSB0cnVlOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19pZCA9ICIiOwogICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IGNoYW5nZWQ7CiAgICAgIH0KCiAgICAgIHRoaXMuYXNzaWduVFZHSUQubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGxvYWRUVkdJREZpbmQ6IGZ1bmN0aW9uIGxvYWRUVkdJREZpbmQoY291bnRyeSkgewogICAgICB2YXIgX3RoaXM0MyA9IHRoaXM7CgogICAgICB0aGlzLmZpbmRUVkdJRC5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZS5nZXQoImVkaXRvci90di1ndWlkZS8iLmNvbmNhdChjb3VudHJ5KSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgX3RoaXM0My5maW5kVFZHSUQuY2hhbm5lbCA9ICIiOwogICAgICAgIF90aGlzNDMuZmluZFRWR0lELmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIF90aGlzNDMuZmluZFRWR0lELmNoYW5uZWxzID0gcmVzLmRhdGEubWFwKGZ1bmN0aW9uIChjaGFubmVsKSB7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICB0ZXh0OiBjaGFubmVsLnR2Z19uYW1lLAogICAgICAgICAgICB2YWx1ZTogY2hhbm5lbC50dmdfaWQKICAgICAgICAgIH07CiAgICAgICAgfSk7CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczQzLmZpbmRUVkdJRC5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfSk7CiAgICB9LAogICAgZmluZFRWR0lETW9kYWw6IGZ1bmN0aW9uIGZpbmRUVkdJRE1vZGFsKHNob3cpIHsKICAgICAgdmFyIHNhdmUgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IGZhbHNlOwogICAgICB2YXIgc2VsZWN0ZWQgPSB0aGlzLmdldFN0cmVhbVdpdGhJZCh0aGlzLmFjdGl2ZVN0cmVhbXNbMF0pOwoKICAgICAgaWYgKHNob3cpIHsKICAgICAgICB0aGlzLmZpbmRUVkdJRC5jaGFubmVsID0gIiI7CiAgICAgICAgdGhpcy5maW5kVFZHSUQudGl0bGUgPSBzZWxlY3RlZC5zdHJlYW1fdHZnX25hbWU7CiAgICAgIH0KCiAgICAgIHRoaXMuZmluZFRWR0lELnNlYXJjaCA9ICIiOwoKICAgICAgaWYgKHNhdmUpIHsKICAgICAgICBpZiAoc2VsZWN0ZWQpIHsKICAgICAgICAgIHNlbGVjdGVkLnN0cmVhbV90dmdfaWQgPSB0aGlzLmZpbmRUVkdJRC5jaGFubmVsOwogICAgICAgICAgc2VsZWN0ZWQubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuZmluZFRWR0lELm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBpbXBvcnRNM1VNb2RhbDogZnVuY3Rpb24gaW1wb3J0TTNVTW9kYWwoc2hvdykgewogICAgICB2YXIgX3RoaXM0NCA9IHRoaXM7CgogICAgICB2YXIgc2F2ZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogZmFsc2U7CgogICAgICBpZiAoc2hvdykgewogICAgICAgIHRoaXMuaW1wb3J0TTNVLmZpbGUgPSBudWxsOwogICAgICAgIHRoaXMuaW1wb3J0TTNVLm0zdSA9IG51bGw7CiAgICAgICAgdGhpcy5pbXBvcnRNM1UuZ3JvdXBzID0gW107CiAgICAgICAgdGhpcy5pbXBvcnRNM1UuaW1wb3J0R3JvdXBzID0gW107CiAgICAgIH0KCiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlOwogICAgICAgIHZhciBncm91cEluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KGZ1bmN0aW9uIChncm91cCkgewogICAgICAgICAgcmV0dXJuIGdyb3VwLmlkID09IF90aGlzNDQuYWN0aXZlR3JvdXA7CiAgICAgICAgfSk7CiAgICAgICAgaHR0cFNlcnZpY2UucG9zdCgiZWRpdG9yL2ltcG9ydCIsIHsKICAgICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgaW1wb3J0OiB0aGlzLmltcG9ydE0zVS5ncm91cHMuZmlsdGVyKGZ1bmN0aW9uIChncm91cCwgaW5kZXgpIHsKICAgICAgICAgICAgcmV0dXJuIF90aGlzNDQuaW1wb3J0TTNVLmltcG9ydEdyb3Vwcy5pbmNsdWRlcyhpbmRleCk7CiAgICAgICAgICB9KQogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgICAgX3RoaXM0NC5pc0xvYWRpbmcgPSBmYWxzZTsKCiAgICAgICAgICBpZiAocmVzLnN0YXR1cykgewogICAgICAgICAgICBfdGhpczQ0LmxvYWRQbGF5bGlzdChfdGhpczQ0LnBsYXlsaXN0RWRpdG9yLmlkLCBncm91cEluZGV4KTsKICAgICAgICAgIH0KICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBfdGhpczQ0LmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0pOwogICAgICB9CgogICAgICB0aGlzLmltcG9ydE0zVS5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgdXBsb2FkTTNVOiBmdW5jdGlvbiB1cGxvYWRNM1UoZXZlbnQpIHsKICAgICAgdmFyIF90aGlzNDUgPSB0aGlzOwoKICAgICAgdmFyIGlucHV0ID0gZXZlbnQudGFyZ2V0OwoKICAgICAgaWYgKCJmaWxlcyIgaW4gaW5wdXQgJiYgaW5wdXQuZmlsZXMubGVuZ3RoID4gMCkgewogICAgICAgIHRoaXMuaW1wb3J0TTNVLmlzTG9hZGluZyA9IHRydWU7CiAgICAgICAgdGhpcy5yZWFkRmlsZUNvbnRlbnQoaW5wdXQuZmlsZXNbMF0pLnRoZW4oZnVuY3Rpb24gKGNvbnRlbnQpIHsKICAgICAgICAgIF90aGlzNDUuaW1wb3J0TTNVLmlzTG9hZGluZyA9IGZhbHNlOwoKICAgICAgICAgIF90aGlzNDUucGFyc2VNM1UoY29udGVudCk7CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgICBfdGhpczQ1LiRub3RpZnkoImVycm9yIiwgX3RoaXM0NS4kdCgicHJvZmlsZS5mYWlsZWQiKSwgZXJyb3IsICJsYS11c2VyLXNoaWVsZCIsIHsKICAgICAgICAgICAgZHVyYXRpb246IDUwMDAsCiAgICAgICAgICAgIHBlcm1hbmVudDogZmFsc2UKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgcGFyc2VNM1U6IGZ1bmN0aW9uIHBhcnNlTTNVKGNvbnRlbnQpIHsKICAgICAgdmFyIF90aGlzNDYgPSB0aGlzOwoKICAgICAgdmFyIHZtID0gdGhpczsKICAgICAgdm0uaW1wb3J0TTNVLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIG0zdS5wYXJzZShjb250ZW50LCB7CiAgICAgICAgdGFnOiAibmFtZSIsCiAgICAgICAgdHlwZTogWyJNb3ZpZSIsICJTZXJpZXMiLCAiVk9EIiwgIkxpdmUiXQogICAgICB9LCB0cnVlKS50aGVuKGZ1bmN0aW9uIChwbGF5bGlzdCkgewogICAgICAgIF90aGlzNDYuaW1wb3J0TTNVLm0zdSA9IHBsYXlsaXN0OwogICAgICAgIF90aGlzNDYuaW1wb3J0TTNVLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIF90aGlzNDYuaW1wb3J0TTNVLmdyb3VwcyA9IHBsYXlsaXN0Lmdyb3VwczsKICAgICAgICBfdGhpczQ2LmltcG9ydE0zVS5pbXBvcnRHcm91cHMgPSBbXTsKICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgdm0uaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgdm0uJG5vdGlmeSgiZXJyb3IiLCB2bS4kdCgicHJvZmlsZS5mYWlsZWQiKSwgZXJyb3IsICJsYS11c2VyLXNoaWVsZCIsIHsKICAgICAgICAgIGR1cmF0aW9uOiA1MDAwLAogICAgICAgICAgcGVybWFuZW50OiBmYWxzZQogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0sCiAgICByZWFkRmlsZUNvbnRlbnQ6IGZ1bmN0aW9uIHJlYWRGaWxlQ29udGVudChmaWxlKSB7CiAgICAgIHZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgIHJldHVybiByZXNvbHZlKGV2ZW50LnRhcmdldC5yZXN1bHQpOwogICAgICAgIH07CgogICAgICAgIHJlYWRlci5vbmVycm9yID0gZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgICByZXR1cm4gcmVqZWN0KGVycm9yKTsKICAgICAgICB9OwoKICAgICAgICByZWFkZXIucmVhZEFzVGV4dChmaWxlKTsKICAgICAgfSk7CiAgICB9CiAgfSwKICBiZWZvcmVNb3VudDogZnVuY3Rpb24gYmVmb3JlTW91bnQoKSB7CiAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5hZGQoInJpZ2h0LW1lbnUiKTsKICAgIEV2ZW50QnVzLiRvbigic2VhcmNoIiwgdGhpcy5zZWFyY2hFZGl0b3IpOwogICAgRXZlbnRCdXMuJG9uKCJwcmludCIsIHRoaXMucHJpbnRFZGl0b3IpOwogICAgRXZlbnRCdXMuJG9uKCJ0YWItY2hhbmdlIiwgdGhpcy5kb1RhYkNoYW5nZSk7CiAgICBFdmVudEJ1cy4kb24oInNhdmUiLCB0aGlzLmRvU2F2ZSk7CiAgICBFdmVudEJ1cy4kb24oImNhbmNlbCIsIHRoaXMuZG9DYW5jZWwpOwoKICAgIGlmICh0aGlzLm1vdmllU2VyaWVQbGF5bGlzdCkgewogICAgICB0aGlzLmxvYWRQbGF5bGlzdCh0aGlzLm1vdmllU2VyaWVQbGF5bGlzdCk7CiAgICB9CgogICAgdGhpcy5sb2FkTG9nb0NvdW50cmllcygpOwogICAgdGhpcy5sb2FkVFZHSURDb3VudHJpZXMoKTsKICB9LAogIGJlZm9yZURlc3Ryb3k6IGZ1bmN0aW9uIGJlZm9yZURlc3Ryb3koKSB7CiAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5yZW1vdmUoInJpZ2h0LW1lbnUiKTsKICAgIEV2ZW50QnVzLiRvZmYoInNlYXJjaCIsIHRoaXMuc2VhcmNoRWRpdG9yKTsKICAgIEV2ZW50QnVzLiRvZmYoInByaW50IiwgdGhpcy5wcmludEVkaXRvcik7CiAgICBFdmVudEJ1cy4kb2ZmKCJ0YWItY2hhbmdlIiwgdGhpcy5kb1RhYkNoYW5nZSk7CiAgICBFdmVudEJ1cy4kb2ZmKCJzYXZlIiwgdGhpcy5kb1NhdmUpOwogICAgRXZlbnRCdXMuJG9mZigiY2FuY2VsIiwgdGhpcy5kb0NhbmNlbCk7CiAgfSwKICB3YXRjaDogewogICAgZHJhZ1N0cmVhbTogZnVuY3Rpb24gZHJhZ1N0cmVhbSh2YWwpIHsKICAgICAgaWYgKCF2YWwpIHsKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgICB9CiAgICB9LAogICAgZHJhZ0dyb3VwOiBmdW5jdGlvbiBkcmFnR3JvdXAodmFsKSB7CiAgICAgIGlmICghdmFsKSB7CiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgICAgfQogICAgfSwKICAgIGFjdGl2ZUdyb3VwOiBmdW5jdGlvbiBhY3RpdmVHcm91cCh2YWwpIHsKICAgICAgaWYgKHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCkgewogICAgICAgIHRoaXMuc2F2ZUNoYW5nZXNNb2RhbCh0cnVlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmxvYWRTdHJlYW1zKCk7CiAgICAgIH0KICAgIH0sCiAgICAicGxheWxpc3RFZGl0b3IuY2hhbmdlZCI6IGZ1bmN0aW9uIHBsYXlsaXN0RWRpdG9yQ2hhbmdlZCh2YWwpIHsKICAgICAgRXZlbnRCdXMuJGVtaXQoImVkaXRvci1jaGFuZ2VzIiwgdmFsKTsKICAgIH0sCiAgICAicmFkaW9Ccm93c2VyLnNlYXJjaCI6IGZ1bmN0aW9uIHJhZGlvQnJvd3NlclNlYXJjaCh2YWwpIHsKICAgICAgdmFyIHZtID0gdGhpczsKICAgICAgY2xlYXJUaW1lb3V0KHRoaXMucmFkaW9Ccm93c2VyLmJvdW5jZSk7CiAgICAgIHRoaXMucmFkaW9Ccm93c2VyLmJvdW5jZSA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgIHZtLmZpbmRSYWRpb2Jyb3dzZXIodmFsKTsKICAgICAgfSwgNTAwKTsKICAgIH0sCiAgICAic291bmRjbG91ZC51cmwiOiBmdW5jdGlvbiBzb3VuZGNsb3VkVXJsKHZhbCkgewogICAgICB2YXIgdm0gPSB0aGlzOwogICAgICBjbGVhclRpbWVvdXQodGhpcy5yYWRpb0Jyb3dzZXIuYm91bmNlKTsKICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuYm91bmNlID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgdm0uZ2V0U291bmRjbG91ZFRyYWNrKHZhbCwgdm0uc291bmRjbG91ZENsaWVudElkKTsKICAgICAgfSwgNTAwKTsKICAgIH0sCiAgICAieW91dHViZS51cmwiOiBmdW5jdGlvbiB5b3V0dWJlVXJsKHZhbCkgewogICAgICBpZiAoIXZhbC5sZW5ndGgpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICgveW91dHVcLj9iZS9pLnRlc3QodmFsKSkgewogICAgICAgIHZhciBpOwogICAgICAgIHZhciBwYXR0ZXJucyA9IFsveW91dHVcLmJlXC8oW14jJj9dezExfSkvLCAvLyB5b3V0dS5iZS88aWQ+CiAgICAgICAgL1w/dj0oW14jJj9dezExfSkvLCAvLyA/dj08aWQ+CiAgICAgICAgLyZ2PShbXiMmP117MTF9KS8sIC8vICZ2PTxpZD4KICAgICAgICAvZW1iZWRcLyhbXiMmP117MTF9KS8sIC8vIGVtYmVkLzxpZD4KICAgICAgICAvXC92XC8oW14jJj9dezExfSkvIC8vIC92LzxpZD4KICAgICAgICBdOwoKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcGF0dGVybnMubGVuZ3RoOyArK2kpIHsKICAgICAgICAgIGlmIChwYXR0ZXJuc1tpXS50ZXN0KHZhbCkpIHsKICAgICAgICAgICAgdGhpcy55b3V0dWJlLnZpZGVvSWQgPSBwYXR0ZXJuc1tpXS5leGVjKHZhbClbMV07CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHZhciB0b2tlbnMgPSB2YWwuc3BsaXQoL1svJj89Iy5cc10vZyk7CgogICAgICAgIGZvciAoaSA9IDA7IGkgPCB0b2tlbnMubGVuZ3RoOyArK2kpIHsKICAgICAgICAgIGlmICgvXlteIyY/XXsxMX0kLy50ZXN0KHRva2Vuc1tpXSkpIHsKICAgICAgICAgICAgdGhpcy55b3V0dWJlLnZpZGVvSWQgPSB0b2tlbnNbaV07CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHRoaXMueW91dHViZS52aWRlb0lkID0gIiI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHZhciB1cmxwID0gbmV3IFVSTCh2YWwpOwogICAgICAgICAgdGhpcy55b3V0dWJlLnZpZGVvSWQgPSB1cmxwLnNlYXJjaFBhcmFtcy5nZXQoInYiKTsKICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgdGhpcy55b3V0dWJlLnZpZGVvSWQgPSAiIjsKICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICAieW91dHViZS52aWRlb0lkIjogZnVuY3Rpb24geW91dHViZVZpZGVvSWQodmFsKSB7CiAgICAgIHZhciB2bSA9IHRoaXM7CiAgICAgIGNsZWFyVGltZW91dCh0aGlzLnlvdXR1YmUuYm91bmNlKTsKICAgICAgdGhpcy55b3V0dWJlLmJvdW5jZSA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgIGlmICh2YWwubGVuZ3RoKSB7CiAgICAgICAgICB2bS5nZXRZb3V0dWJlUGFnZSh2YWwpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2bS55b3V0dWJlLnZpZGVvID0gbnVsbDsKICAgICAgICB9CiAgICAgIH0sIDUwMCk7CiAgICB9LAogICAgInZpbWVvLnVybCI6IGZ1bmN0aW9uIHZpbWVvVXJsKHZhbCkgewogICAgICBpZiAoL3ZpbWVvXC5jb20vaS50ZXN0KHZhbCkpIHsKICAgICAgICB2YXIgbWF0Y2ggPSB2YWwubWF0Y2goLyg/Ond3d1wufHBsYXllclwuKT92aW1lby5jb21cLyg/OmNoYW5uZWxzXC8oPzpcdytcLyk/fGdyb3Vwc1wvKD86W14vXSopXC92aWRlb3NcL3xhbGJ1bVwvKD86XGQrKVwvdmlkZW9cL3x2aWRlb1wvfCkoXGQrKSg/OlthLXpBLVowLTlfLV0rKT8vaSk7CgogICAgICAgIGlmIChtYXRjaC5sZW5ndGggPj0gMikgewogICAgICAgICAgdGhpcy52aW1lby52aWRlb0lkID0gbWF0Y2hbMV07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMudmltZW8udmlkZW9JZCA9ICIiOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnZpbWVvLnZpZGVvSWQgPSAiIjsKICAgICAgfQogICAgfSwKICAgICJ2aW1lby52aWRlb0lkIjogZnVuY3Rpb24gdmltZW9WaWRlb0lkKHZhbCkgewogICAgICB2YXIgdm0gPSB0aGlzOwogICAgICBjbGVhclRpbWVvdXQodGhpcy52aW1lby5ib3VuY2UpOwogICAgICB0aGlzLnZpbWVvLmJvdW5jZSA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgIGlmICh2YWwubGVuZ3RoKSB7CiAgICAgICAgICB2bS5nZXRWaW1lb0NvbmZpZyh2YWwpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2bS52aW1lby52aWRlbyA9IG51bGw7CiAgICAgICAgfQogICAgICB9LCA1MDApOwogICAgfSwKICAgICJkYWlseW1vdGlvbi51cmwiOiBmdW5jdGlvbiBkYWlseW1vdGlvblVybCh2YWwpIHsKICAgICAgaWYgKC9kYWlseW1vdGlvblwuY29tL2kudGVzdCh2YWwpKSB7CiAgICAgICAgdmFyIG1hdGNoID0gdmFsLm1hdGNoKC9eLitkYWlseW1vdGlvbi5jb21cLyh2aWRlb3xodWIpXC8oW15fXSspW14jXSooI3ZpZGVvPShbXl8mXSspKT8vaSk7CgogICAgICAgIGlmIChtYXRjaC5sZW5ndGggPj0gNCAmJiBtYXRjaFs0XSkgewogICAgICAgICAgdGhpcy5kYWlseW1vdGlvbi52aWRlb0lkID0gbWF0Y2hbNF07CiAgICAgICAgfSBlbHNlIGlmIChtYXRjaC5sZW5ndGggPj0gMikgewogICAgICAgICAgdGhpcy5kYWlseW1vdGlvbi52aWRlb0lkID0gbWF0Y2hbMl07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuZGFpbHltb3Rpb24udmlkZW9JZCA9ICIiOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmRhaWx5bW90aW9uLnZpZGVvSWQgPSAiIjsKICAgICAgfQogICAgfSwKICAgICJkYWlseW1vdGlvbi52aWRlb0lkIjogZnVuY3Rpb24gZGFpbHltb3Rpb25WaWRlb0lkKHZhbCkgewogICAgICB2YXIgdm0gPSB0aGlzOwogICAgICBjbGVhclRpbWVvdXQodGhpcy5kYWlseW1vdGlvbi5ib3VuY2UpOwogICAgICB0aGlzLmRhaWx5bW90aW9uLmJvdW5jZSA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgIGlmICh2YWwubGVuZ3RoKSB7CiAgICAgICAgICB2bS5nZXREYWlseW1vdGlvbkNvbmZpZyh2YWwpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2bS5kYWlseW1vdGlvbi52aWRlbyA9IG51bGw7CiAgICAgICAgfQogICAgICB9LCA1MDApOwogICAgfSwKICAgICJ0ZWRUYWxrcy51cmwiOiBmdW5jdGlvbiB0ZWRUYWxrc1VybCh2YWwpIHsKICAgICAgaWYgKC90ZWRcLmNvbVwvdGFsa3MvaS50ZXN0KHZhbCkpIHsKICAgICAgICB2YXIgdm0gPSB0aGlzOwogICAgICAgIGNsZWFyVGltZW91dCh0aGlzLnRlZFRhbGtzLmJvdW5jZSk7CiAgICAgICAgdGhpcy50ZWRUYWxrcy5ib3VuY2UgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGlmICh2YWwubGVuZ3RoKSB7CiAgICAgICAgICAgIHZtLmdldFRlZFRhbGtzQ29uZmlnKHZhbCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2bS50ZWRUYWxrcy52aWRlbyA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgfSwgNTAwKTsKICAgICAgfQogICAgfSwKICAgICJ4aGFtc3Rlci51cmwiOiBmdW5jdGlvbiB4aGFtc3RlclVybCh2YWwpIHsKICAgICAgdmFyIHZtID0gdGhpczsKCiAgICAgIGlmICgveGhhbXN0ZXJcLmNvbVwvdmlkZW9zL2kudGVzdCh2YWwpKSB7CiAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMueGhhbXN0ZXJCb3VuY2UpOwogICAgICAgIHRoaXMueGhhbXN0ZXJCb3VuY2UgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGlmICh2YWwubGVuZ3RoKSB7CiAgICAgICAgICAgIHZtLmdldFhoYW1zdGVyQ29uZmlnKHZhbCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2bS54aGFtc3Rlci52aWRlbyA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgfSwgNTAwKTsKICAgICAgfQogICAgfSwKICAgICJmaW5kTG9nby5jb3VudHJ5IjogZnVuY3Rpb24gZmluZExvZ29Db3VudHJ5KHZhbCkgewogICAgICBpZiAodmFsLmxlbmd0aCkgewogICAgICAgIHRoaXMubG9hZExvZ29zRmluZCh2YWwpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZmluZExvZ28ubG9nbyA9ICIiOwogICAgICB9CiAgICB9LAogICAgImFzc2lnbkxvZ28uY291bnRyeSI6IGZ1bmN0aW9uIGFzc2lnbkxvZ29Db3VudHJ5KHZhbCkgewogICAgICBpZiAodmFsLmxlbmd0aCkgewogICAgICAgIHRoaXMubG9hZExvZ29zQXNzaWduKHZhbCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5hc3NpZ25Mb2dvLmxvZ28gPSAiIjsKICAgICAgfQogICAgfSwKICAgICJmaW5kVFZHSUQuY291bnRyeSI6IGZ1bmN0aW9uIGZpbmRUVkdJRENvdW50cnkodmFsKSB7CiAgICAgIGlmICh2YWwubGVuZ3RoKSB7CiAgICAgICAgdGhpcy5sb2FkVFZHSURGaW5kKHZhbCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5maW5kVFZHSUQuY2hhbm5lbCA9ICIiOwogICAgICB9CiAgICB9LAogICAgImFzc2lnblRWR0lELmNvdW50cnkiOiBmdW5jdGlvbiBhc3NpZ25UVkdJRENvdW50cnkodmFsKSB7CiAgICAgIGlmICh2YWwubGVuZ3RoKSB7CiAgICAgICAgdGhpcy5sb2FkVFZHSURBc3NpZ24odmFsKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmFzc2lnblRWR0lELmNoYW5uZWxzID0gW107CiAgICAgIH0KICAgIH0sCiAgICBtb3ZpZVNlcmllUGxheWxpc3Q6IGZ1bmN0aW9uIG1vdmllU2VyaWVQbGF5bGlzdCh2YWwpIHsKICAgICAgdGhpcy5sb2FkUGxheWxpc3QodmFsKTsKICAgIH0KICB9Cn07"},null]}