{"remainingRequest":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/thread-loader/dist/cjs.js!/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/babel-loader/lib/index.js!/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/cache-loader/dist/cjs.js??ref--0-0!/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/vue-loader/lib/index.js??vue-loader-options!/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/src/views/app/xtream/editor.vue?vue&type=script&lang=js&","dependencies":[{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/src/views/app/xtream/editor.vue","mtime":1624960129020},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF90b0NvbnN1bWFibGVBcnJheSBmcm9tICIvbWVkaWEvZXJuc3QvNjNiY2U0M2MtNWU1MS00YmYxLWE2MTEtM2FmZGYzMmFjNmY2L1Z1ZUpTL0lQVFYtVG9vbHMvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL3RvQ29uc3VtYWJsZUFycmF5IjsKaW1wb3J0IF9vYmplY3RTcHJlYWQgZnJvbSAiL21lZGlhL2VybnN0LzYzYmNlNDNjLTVlNTEtNGJmMS1hNjExLTNhZmRmMzJhYzZmNi9WdWVKUy9JUFRWLVRvb2xzL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9vYmplY3RTcHJlYWQyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc2VhcmNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmNvbnN0cnVjdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLnRvLXN0cmluZy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbHRlci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5tYXRjaC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbmQtaW5kZXguanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5tYXAuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5udW1iZXIuY29uc3RydWN0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuam9pbi5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pdGVyYXRvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuaXRlcmF0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zb3J0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5jbHVkZXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuaW5jbHVkZXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zcGxpY2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcucmVwbGFjZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmNvbmNhdC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmZ1bmN0aW9uLm5hbWUuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3Qua2V5cy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbmQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc3BsaXQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIudXJsLmpzIjsKLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCi8qIGVzbGludC1kaXNhYmxlIHZ1ZS9uby1zaWRlLWVmZmVjdHMtaW4tY29tcHV0ZWQtcHJvcGVydGllcyAqLwoKLyogZXNsaW50LWRpc2FibGUgbm8tdW51c2VkLXZhcnMgKi8KCi8qIGVzbGludC1kaXNhYmxlIG5vLXVzZWxlc3MtZXNjYXBlICovCmltcG9ydCB7IEV2ZW50QnVzIH0gZnJvbSAiLi4vLi4vLi4vc2VydmljZXMvZWJ1cyI7CmltcG9ydCB7IGh0dHBTZXJ2aWNlIH0gZnJvbSAiLi4vLi4vLi4vc2VydmljZXMvaHR0cCI7CmltcG9ydCB7IG1hcEdldHRlcnMgfSBmcm9tICJ2dWV4IjsKaW1wb3J0IGRyYWdnYWJsZSBmcm9tICJ2dWVkcmFnZ2FibGUiOwppbXBvcnQgeyBTdWJzY3JpcHRpb25UeXBlIH0gZnJvbSAiLi4vLi4vLi4vY29uc3RhbnRzL2NvbmZpZyI7CmltcG9ydCB7IGNvdW50cmllcyB9IGZyb20gIi4uLy4uLy4uL2hlbHBlcnMiOwppbXBvcnQgeyBtM3UgfSBmcm9tICIuLi8uLi8uLi9wbHVnaW5zL20zdSI7CmV4cG9ydCBkZWZhdWx0IHsKICBjb21wb25lbnRzOiB7CiAgICBkcmFnZ2FibGU6IGRyYWdnYWJsZQogIH0sCiAgZGF0YTogZnVuY3Rpb24gZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGNvdW50cmllczogY291bnRyaWVzLAogICAgICBhY3RpdmVUYWI6IDAsCiAgICAgIGFjdGl2ZUdyb3VwOiAtMSwKICAgICAgYWN0aXZlR3JvdXBzOiBbXSwKICAgICAgYWN0aXZlU3RyZWFtOiAtMSwKICAgICAgYWN0aXZlU3RyZWFtczogW10sCiAgICAgIGRyYWdHcm91cDogZmFsc2UsCiAgICAgIGRyYWdTdHJlYW06IGZhbHNlLAogICAgICBlZGl0b3I6IGZhbHNlLAogICAgICBzZWFyY2g6IG51bGwsCiAgICAgIGlzTG9hZGluZzogZmFsc2UsCiAgICAgIHBsYXlsaXN0RWRpdG9yOiB7CiAgICAgICAgaWQ6IHVuZGVmaW5lZCwKICAgICAgICBwbGF5bGlzdDogbnVsbCwKICAgICAgICBncm91cHM6IFtdLAogICAgICAgIHN0cmVhbXM6IFtdLAogICAgICAgIGNoYW5nZWQ6IGZhbHNlCiAgICAgIH0sCiAgICAgIGZpbmRSZXBsYWNlOiB7CiAgICAgICAgdHlwZTogMCwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgZnJvbTogIiIsCiAgICAgICAgdG86ICIiLAogICAgICAgIHJlcGxhY2VBbGw6IGZhbHNlLAogICAgICAgIGlnbm9yZUNhc2U6IGZhbHNlLAogICAgICAgIHNlbGVjdGVkT25seTogMAogICAgICB9LAogICAgICBwcmVmaXhTdWZmaXg6IHsKICAgICAgICB0eXBlOiAwLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBwcmVmaXg6ICIiLAogICAgICAgIHN1ZmZpeDogIiIsCiAgICAgICAgc2VsZWN0ZWRPbmx5OiAwCiAgICAgIH0sCiAgICAgIGNvbnZlcnRDYXNlOiB7CiAgICAgICAgdHlwZTogMCwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgbWV0aG9kOiAwLAogICAgICAgIHNlbGVjdGVkT25seTogMAogICAgICB9LAogICAgICBncm91cEVkaXRvcjogewogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBpZDogMCwKICAgICAgICBncm91cF9uYW1lOiAiIiwKICAgICAgICBncm91cF9wYXJlbnRfY29kZTogIiIsCiAgICAgICAgZ3JvdXBfdHlwZTogMSwKICAgICAgICBncm91cF9pc19oaWRkZW46IDAKICAgICAgfSwKICAgICAgc3RyZWFtRWRpdG9yOiB7CiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIGlkOiAtMSwKICAgICAgICBzdHJlYW1fdHZnX25hbWU6ICIiLAogICAgICAgIHN0cmVhbV90dmdfaWQ6ICIiLAogICAgICAgIHN0cmVhbV90dmdfbG9nbzogIiIsCiAgICAgICAgc3RyZWFtX3BhcmVudF9jb2RlOiAiIiwKICAgICAgICBzdHJlYW1fcmFkaW86IDAsCiAgICAgICAgc3RyZWFtX2lzX2hpZGRlbjogMCwKICAgICAgICBzdHJlYW1faXNfY3VzdG9tOiAwLAogICAgICAgIG1vdmllX25hbWU6ICIiLAogICAgICAgIG1vdmllX3llYXI6ICIiLAogICAgICAgIHNlcmllX25hbWU6ICIiLAogICAgICAgIHNlcmllX3NlYXNvbjogMCwKICAgICAgICBzZXJpZV9lcGlzb2RlOiAwLAogICAgICAgIHNvdXJjZV9zdHJlYW1fdXJsOiAiIgogICAgICB9LAogICAgICByYWRpb0Jyb3dzZXI6IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBib3VuY2U6IG51bGwsCiAgICAgICAgYWN0aXZlOiBbXSwKICAgICAgICBzZWFyY2g6ICIiLAogICAgICAgIHJlc3VsdHM6IFtdCiAgICAgIH0sCiAgICAgIHNvdW5kY2xvdWQ6IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBib3VuY2U6IG51bGwsCiAgICAgICAgdXJsOiAiIiwKICAgICAgICB0cmFjazogbnVsbAogICAgICB9LAogICAgICB5b3V0dWJlOiB7CiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgYm91bmNlOiBudWxsLAogICAgICAgIHVybDogIiIsCiAgICAgICAgdmlkZW9JZDogIiIsCiAgICAgICAgdmlkZW86IG51bGwKICAgICAgfSwKICAgICAgdmltZW86IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBib3VuY2U6IG51bGwsCiAgICAgICAgdXJsOiAiIiwKICAgICAgICB2aWRlb0lkOiAiIiwKICAgICAgICB2aWRlbzogbnVsbAogICAgICB9LAogICAgICBkYWlseW1vdGlvbjogewogICAgICAgIGlzTG9hZGluZzogZmFsc2UsCiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIGJvdW5jZTogbnVsbCwKICAgICAgICB1cmw6ICIiLAogICAgICAgIHZpZGVvSWQ6ICIiLAogICAgICAgIHZpZGVvOiBudWxsCiAgICAgIH0sCiAgICAgIHRlZFRhbGtzOiB7CiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgYm91bmNlOiBudWxsLAogICAgICAgIHVybDogIiIsCiAgICAgICAgdmlkZW86IG51bGwKICAgICAgfSwKICAgICAgeGhhbXN0ZXI6IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBib3VuY2U6IG51bGwsCiAgICAgICAgdXJsOiAiIiwKICAgICAgICB2aWRlbzogbnVsbAogICAgICB9LAogICAgICBmaW5kTG9nbzogewogICAgICAgIGlzTG9hZGluZzogZmFsc2UsCiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIGNvdW50cmllczogW10sCiAgICAgICAgY291bnRyeTogIiIsCiAgICAgICAgbG9nb3M6IFtdLAogICAgICAgIGxvZ286ICIiLAogICAgICAgIHNlYXJjaDogIiIsCiAgICAgICAgdGl0bGU6ICIiCiAgICAgIH0sCiAgICAgIGFzc2lnbkxvZ286IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBjb3VudHJpZXM6IFtdLAogICAgICAgIGNvdW50cnk6ICIiLAogICAgICAgIGxvZ29zOiBbXSwKICAgICAgICBhc3NpZ25BbGw6IDAKICAgICAgfSwKICAgICAgaW1wb3J0TTNVOiB7CiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgZ3JvdXBzOiBbXSwKICAgICAgICBpbXBvcnRHcm91cHM6IFtdLAogICAgICAgIG0zdTogbnVsbCwKICAgICAgICBmaWxlOiBudWxsCiAgICAgIH0sCiAgICAgIGZpbmRUVkdJRDogewogICAgICAgIGlzTG9hZGluZzogZmFsc2UsCiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIGNvdW50cmllczogW10sCiAgICAgICAgY291bnRyeTogIiIsCiAgICAgICAgY2hhbm5lbHM6IFtdLAogICAgICAgIGNoYW5uZWw6ICIiLAogICAgICAgIHNlYXJjaDogIiIsCiAgICAgICAgdGl0bGU6ICIiCiAgICAgIH0sCiAgICAgIGFzc2lnblRWR0lEOiB7CiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgY291bnRyaWVzOiBbXSwKICAgICAgICBjb3VudHJ5OiAiIiwKICAgICAgICBjaGFubmVsczogW10sCiAgICAgICAgYXNzaWduQWxsOiAwCiAgICAgIH0sCiAgICAgIHNhdmVDaGFuZ2VzOiB7CiAgICAgICAgbW9kYWw6IGZhbHNlCiAgICAgIH0sCiAgICAgIGdyb3VwVHlwZXM6IFt7CiAgICAgICAgdGV4dDogdGhpcy4kdCgieHRyZWFtLmxpdmUiKSwKICAgICAgICB2YWx1ZTogMQogICAgICB9LCB7CiAgICAgICAgdGV4dDogdGhpcy4kdCgieHRyZWFtLm1vdmllcyIpLAogICAgICAgIHZhbHVlOiAyCiAgICAgIH0sIHsKICAgICAgICB0ZXh0OiB0aGlzLiR0KCJ4dHJlYW0uc2VyaWVzIiksCiAgICAgICAgdmFsdWU6IDMKICAgICAgfV0KICAgIH07CiAgfSwKICBjb21wdXRlZDogX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBtYXBHZXR0ZXJzKFsiY3VycmVudFVzZXIiLCAic2V0dGluZ3MiLCAic291bmRjbG91ZENsaWVudElkIiwgIm1vdmllU2VyaWVQbGF5bGlzdCJdKSksIHt9LCB7CiAgICBzZWFyY2hGaWx0ZXJlZDogZnVuY3Rpb24gc2VhcmNoRmlsdGVyZWQoKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBpZiAodGhpcy5zZWFyY2ggPT09IG51bGwpIHsKICAgICAgICByZXR1cm4gdGhpcy5hY2NvdW50czsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgcmUgPSBuZXcgUmVnRXhwKHRoaXMuc2VhcmNoLCAiaSIpOwogICAgICAgIHJldHVybiB0aGlzLmFjY291bnRzLmZpbHRlcihmdW5jdGlvbiAoYWNjb3VudCkgewogICAgICAgICAgcmV0dXJuIFN0cmluZyhhY2NvdW50LnRpdGxlKS5tYXRjaChyZSkgfHwgU3RyaW5nKGFjY291bnQuaG9zdCkubWF0Y2gocmUpIHx8IFN0cmluZyhhY2NvdW50LnBvcnQpLm1hdGNoKHJlKSB8fCBTdHJpbmcoYWNjb3VudC51c2VybmFtZSkubWF0Y2gocmUpIHx8IFN0cmluZyhhY2NvdW50LnBhc3N3b3JkKS5tYXRjaChyZSkgfHwgX3RoaXMuZm9ybWF0RGF0ZShhY2NvdW50LnN5bmNlZF9hdCkubWF0Y2gocmUpIHx8IF90aGlzLiR0KCJzeW5jLWludGVydmFsLiIuY29uY2F0KGFjY291bnQuc3luY19pbnRlcnZhbCkpLm1hdGNoKHJlKTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIHBsYXlsaXN0U2VsZWN0ZWQ6IGZ1bmN0aW9uIHBsYXlsaXN0U2VsZWN0ZWQoKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkICE9PSB1bmRlZmluZWQ7CiAgICB9LAogICAgbGFzdFNlbGVjdGVkR3JvdXA6IGZ1bmN0aW9uIGxhc3RTZWxlY3RlZEdyb3VwKCkgewogICAgICByZXR1cm4gdGhpcy5hY3RpdmVHcm91cHNbdGhpcy5hY3RpdmVHcm91cHMubGVuZ3RoIC0gMV07CiAgICB9LAogICAgbGFzdFNlbGVjdGVkU3RyZWFtOiBmdW5jdGlvbiBsYXN0U2VsZWN0ZWRTdHJlYW0oKSB7CiAgICAgIHJldHVybiB0aGlzLmFjdGl2ZVN0cmVhbXNbdGhpcy5hY3RpdmVTdHJlYW1zLmxlbmd0aCAtIDFdOwogICAgfSwKICAgIGNhbkVkaXRHcm91cFR5cGU6IGZ1bmN0aW9uIGNhbkVkaXRHcm91cFR5cGUoKSB7CiAgICAgIHJldHVybiB0aGlzLmdyb3VwRWRpdG9yLmlkICYmIHRoaXMuZ2V0R3JvdXBXaXRoSWQodGhpcy5ncm91cEVkaXRvci5pZCkuc3RyZWFtcyA9PSAwOwogICAgfSwKICAgIHN1YnNjcmlwdGlvbkxpbWl0ZWQ6IGZ1bmN0aW9uIHN1YnNjcmlwdGlvbkxpbWl0ZWQoKSB7CiAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRVc2VyLnN1YnNjcmlwdGlvbiAmJiB0aGlzLmN1cnJlbnRVc2VyLnN1YnNjcmlwdGlvbi5zdWJzY3JpcHRpb25fdHlwZSA9PSBTdWJzY3JpcHRpb25UeXBlLkVudGh1c2lhc3Q7CiAgICB9LAogICAgZmlsdGVyZWRHcm91cHM6IGZ1bmN0aW9uIGZpbHRlcmVkR3JvdXBzKCkgewogICAgICBpZiAodGhpcy5zdWJzY3JpcHRpb25MaW1pdGVkKSB7CiAgICAgICAgcmV0dXJuIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbHRlcihmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICAgIHJldHVybiBncm91cC5ncm91cF9pc19yZW1vdmVkICE9PSAxICYmIGdyb3VwLnNvdXJjZV9ncm91cF90eXBlID09IDEgJiYgZ3JvdXAuZ3JvdXBfdHlwZSA9PSAxOwogICAgICAgIH0pOwogICAgICB9CgogICAgICByZXR1cm4gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmlsdGVyKGZ1bmN0aW9uIChncm91cCkgewogICAgICAgIHJldHVybiBncm91cC5ncm91cF9pc19yZW1vdmVkICE9PSAxOwogICAgICB9KTsKICAgIH0sCiAgICBmaWx0ZXJlZFN0cmVhbXM6IGZ1bmN0aW9uIGZpbHRlcmVkU3RyZWFtcygpIHsKICAgICAgcmV0dXJuIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5maWx0ZXIoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgcmV0dXJuIGdyb3VwLnN0cmVhbV9pc19yZW1vdmVkICE9PSAxOwogICAgICB9KTsKICAgIH0sCiAgICBhY3RpdmVHcm91cFR5cGU6IGZ1bmN0aW9uIGFjdGl2ZUdyb3VwVHlwZSgpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICB2YXIgaW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgcmV0dXJuIGdyb3VwLmlkID09IF90aGlzMi5hY3RpdmVHcm91cDsKICAgICAgfSk7CiAgICAgIHJldHVybiBpbmRleCA+IC0xID8gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaW5kZXhdLmdyb3VwX3R5cGUgOiAwOwogICAgfSwKICAgIGZpbHRlcmVkTG9nb3M6IGZ1bmN0aW9uIGZpbHRlcmVkTG9nb3MoKSB7CiAgICAgIGlmICghdGhpcy5maW5kTG9nby5zZWFyY2gubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZmluZExvZ28ubG9nb3M7CiAgICAgIH0KCiAgICAgIHZhciBzZWxlY3RlZFN0cmVhbSA9IHRoaXMuZ2V0U3RyZWFtV2l0aElkKHRoaXMuYWN0aXZlU3RyZWFtc1swXSk7CiAgICAgIHZhciByZSA9IG5ldyBSZWdFeHAodGhpcy5maW5kTG9nby5zZWFyY2gsICJpIik7CiAgICAgIHJldHVybiB0aGlzLmZpbmRMb2dvLmxvZ29zLmZpbHRlcihmdW5jdGlvbiAobG9nbykgewogICAgICAgIHJldHVybiBsb2dvLnRleHQubWF0Y2gocmUpOwogICAgICB9KTsKICAgIH0sCiAgICBmaWx0ZXJlZFRWR0lEUzogZnVuY3Rpb24gZmlsdGVyZWRUVkdJRFMoKSB7CiAgICAgIGlmICghdGhpcy5maW5kVFZHSUQuc2VhcmNoLmxlbmd0aCkgewogICAgICAgIHJldHVybiB0aGlzLmZpbmRUVkdJRC5jaGFubmVsczsKICAgICAgfQoKICAgICAgdmFyIHNlbGVjdGVkU3RyZWFtID0gdGhpcy5nZXRTdHJlYW1XaXRoSWQodGhpcy5hY3RpdmVTdHJlYW1zWzBdKTsKICAgICAgdmFyIHJlID0gbmV3IFJlZ0V4cCh0aGlzLmZpbmRUVkdJRC5zZWFyY2gsICJpIik7CiAgICAgIHJldHVybiB0aGlzLmZpbmRUVkdJRC5jaGFubmVscy5maWx0ZXIoZnVuY3Rpb24gKGNoYW5uZWwpIHsKICAgICAgICByZXR1cm4gY2hhbm5lbC50ZXh0Lm1hdGNoKHJlKTsKICAgICAgfSk7CiAgICB9LAogICAgZ3JvdXBDb250ZXh0TWVudTogZnVuY3Rpb24gZ3JvdXBDb250ZXh0TWVudSgpIHsKICAgICAgdmFyIHZtID0gdGhpczsKICAgICAgcmV0dXJuIFt7CiAgICAgICAgaWNvbjogImxhLXBsdXMiLAogICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IuYWRkLWdyb3VwIiksCiAgICAgICAgb25DbGljazogdm0uYWRkR3JvdXAKICAgICAgfSwgewogICAgICAgIGRpc2FibGVkOiB2bS5hY3RpdmVHcm91cHMubGVuZ3RoICE9PSAxLAogICAgICAgIGljb246ICJsYS1lZGl0IiwKICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLmVkaXQtZ3JvdXAiKSwKICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgaWYgKHZtLmFjdGl2ZUdyb3Vwcy5sZW5ndGggPT09IDEpIHsKICAgICAgICAgICAgdm0uZWRpdEdyb3VwTW9kYWwodHJ1ZSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAgZGl2aWRlcjogdHJ1ZQogICAgICB9LCB7CiAgICAgICAgdGV4dDogdm0uJHQoImdlbmVyYWwuc2VsZWN0LWFsbCIpLAogICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICB2bS5hY3RpdmVHcm91cHMgPSBfdG9Db25zdW1hYmxlQXJyYXkodm0ucGxheWxpc3RFZGl0b3IuZ3JvdXBzLm1hcChmdW5jdGlvbiAoZykgewogICAgICAgICAgICByZXR1cm4gZy5pZDsKICAgICAgICAgIH0pKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICB0ZXh0OiB2bS4kdCgiZ2VuZXJhbC5zZWxlY3Qtbm9uZSIpLAogICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICB2bS5hY3RpdmVHcm91cHMgPSBbXTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBkaXZpZGVyOiB0cnVlCiAgICAgIH0sIHsKICAgICAgICBpY29uOiAibGEtc2VhcmNoIiwKICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLmZpbmQtcmVwbGFjZSIpLAogICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICB2bS5maW5kQW5kUmVwbGFjZU1vZGFsKHRydWUsIDEpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGljb246ICJsYS1wZW4iLAogICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IuYWRkLXByZWZpeC1zdWZmaXgiKSwKICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgdm0ucHJlZml4U3VmZml4TW9kYWwodHJ1ZSwgMSk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAgaWNvbjogImxhLWZvbnQiLAogICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IuY2hhbmdlLWNhc2UiKSwKICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgdm0uY29udmVydENhc2VNb2RhbCh0cnVlLCAxKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBkaXZpZGVyOiB0cnVlCiAgICAgIH0sIHsKICAgICAgICBkaXNhYmxlZDogdm0uYWN0aXZlR3JvdXBzLmxlbmd0aCA9PT0gMCwKICAgICAgICBpY29uOiAibGEtZXllIiwKICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLnRvZ2dsZS12aXNpYmlsaXR5IiksCiAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgIGlmICh2bS5hY3RpdmVHcm91cHMubGVuZ3RoKSB7CiAgICAgICAgICAgIHZtLnRvZ2dsZUdyb3VwVmlzaWJpbGl0eSgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGRpc2FibGVkOiB2bS5hY3RpdmVHcm91cHMubGVuZ3RoID09PSAwLAogICAgICAgIGljb246ICJsYS10cmFzaCIsCiAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5kZWxldGUiKSwKICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgaWYgKHZtLmFjdGl2ZUdyb3Vwcy5sZW5ndGgpIHsKICAgICAgICAgICAgdm0uZGVsZXRlU2VsZWN0ZWRHcm91cHMoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH1dOwogICAgfSwKICAgIHN0cmVhbUNvbnRleHRNZW51OiBmdW5jdGlvbiBzdHJlYW1Db250ZXh0TWVudSgpIHsKICAgICAgdmFyIHZtID0gdGhpczsKICAgICAgcmV0dXJuIFt7CiAgICAgICAgaWNvbjogImxhLXBsdXMiLAogICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IuYWRkLXN0cmVhbSIpLAogICAgICAgIG9uQ2xpY2s6IHZtLmFkZFN0cmVhbQogICAgICB9LCB7CiAgICAgICAgZGlzYWJsZWQ6IHZtLmFjdGl2ZVN0cmVhbXMubGVuZ3RoICE9PSAxLAogICAgICAgIGljb246ICJsYS1lZGl0IiwKICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLmVkaXQtc3RyZWFtIiksCiAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgIGlmICh2bS5hY3RpdmVTdHJlYW1zLmxlbmd0aCA9PT0gMSkgewogICAgICAgICAgICB2bS5lZGl0U3RyZWFtTW9kYWwodHJ1ZSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAgZGl2aWRlcjogdHJ1ZQogICAgICB9LCB7CiAgICAgICAgdGV4dDogdm0uJHQoImdlbmVyYWwuc2VsZWN0LWFsbCIpLAogICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICB2bS5hY3RpdmVTdHJlYW1zID0gX3RvQ29uc3VtYWJsZUFycmF5KHZtLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubWFwKGZ1bmN0aW9uIChnKSB7CiAgICAgICAgICAgIHJldHVybiBnLmlkOwogICAgICAgICAgfSkpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIHRleHQ6IHZtLiR0KCJnZW5lcmFsLnNlbGVjdC1ub25lIiksCiAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgIHZtLmFjdGl2ZVN0cmVhbXMgPSBbXTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBkaXZpZGVyOiB0cnVlCiAgICAgIH0sIHsKICAgICAgICBkaXNhYmxlZDogdm0uYWN0aXZlR3JvdXBzLmxlbmd0aCAhPT0gMSB8fCB2bS5hY3RpdmVTdHJlYW1zLmxlbmd0aCA9PT0gMCB8fCB2bS5nZXRHcm91cFdpdGhJZCh2bS5hY3RpdmVHcm91cHNbMF0pLmdyb3VwX3R5cGUgIT09IHZtLmFjdGl2ZUdyb3VwVHlwZSB8fCB2bS5hY3RpdmVHcm91cHNbMF0gPT09IHZtLmFjdGl2ZUdyb3VwLAogICAgICAgIGljb246ICJsYS1jaGV2cm9uLWxlZnQiLAogICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IubW92ZS10by1zZWxlY3RlZC1ncm91cCIpLAogICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICB2bS5tb3ZlVG9TZWxlY3RlZEdyb3VwKCk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAgZGl2aWRlcjogdHJ1ZQogICAgICB9LCB7CiAgICAgICAgaWNvbjogImxhLXNlYXJjaCIsCiAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5maW5kLXJlcGxhY2UiKSwKICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgdm0uZmluZEFuZFJlcGxhY2VNb2RhbCh0cnVlLCAyKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBpY29uOiAibGEtcGVuIiwKICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLmFkZC1wcmVmaXgtc3VmZml4IiksCiAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgIHZtLnByZWZpeFN1ZmZpeE1vZGFsKHRydWUsIDIpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGljb246ICJsYS1mb250IiwKICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLmNoYW5nZS1jYXNlIiksCiAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgIHZtLmNvbnZlcnRDYXNlTW9kYWwodHJ1ZSwgMik7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAgZGl2aWRlcjogdHJ1ZQogICAgICB9LCB7CiAgICAgICAgZGlzYWJsZWQ6IHZtLmFjdGl2ZVN0cmVhbXMubGVuZ3RoICE9PSAxIHx8IHZtLmFjdGl2ZUdyb3VwVHlwZSAhPT0gMSwKICAgICAgICBpY29uOiAibGEtcGhvdG8tdmlkZW8iLAogICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IuZmluZC1sb2dvIiksCiAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgIHZtLmZpbmRMb2dvTW9kYWwodHJ1ZSk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAgZGlzYWJsZWQ6IHZtLmFjdGl2ZVN0cmVhbXMubGVuZ3RoICE9PSAxIHx8IHZtLmFjdGl2ZUdyb3VwVHlwZSAhPT0gMSwKICAgICAgICBpY29uOiAibGEtdGgtbGlzdCIsCiAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5maW5kLXR2LWd1aWRlIiksCiAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgIHZtLmZpbmRUVkdJRE1vZGFsKHRydWUpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGRpdmlkZXI6IHRydWUKICAgICAgfSwgewogICAgICAgIGRpc2FibGVkOiB2bS5hY3RpdmVTdHJlYW1zLmxlbmd0aCA9PT0gMCB8fCB2bS5hY3RpdmVHcm91cFR5cGUgIT09IDEsCiAgICAgICAgaWNvbjogImxhLW11c2ljIiwKICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLnRvZ2dsZS1yYWRpbyIpLAogICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICBpZiAodm0uYWN0aXZlU3RyZWFtcy5sZW5ndGggJiYgdm0uYWN0aXZlR3JvdXBUeXBlID09IDEpIHsKICAgICAgICAgICAgdm0udG9nZ2xlU3RyZWFtUmFkaW8oKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBkaXNhYmxlZDogdm0uYWN0aXZlU3RyZWFtcy5sZW5ndGggPT09IDAsCiAgICAgICAgaWNvbjogImxhLWV5ZSIsCiAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci50b2dnbGUtdmlzaWJpbGl0eSIpLAogICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICBpZiAodm0uYWN0aXZlU3RyZWFtcy5sZW5ndGgpIHsKICAgICAgICAgICAgdm0udG9nZ2xlU3RyZWFtVmlzaWJpbGl0eSgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGRpdmlkZXI6IHRydWUKICAgICAgfSwgewogICAgICAgIGRpc2FibGVkOiB2bS5hY3RpdmVTdHJlYW1zLmxlbmd0aCA9PT0gMCwKICAgICAgICBpY29uOiAibGEtdHJhc2giLAogICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IuZGVsZXRlIiksCiAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgIGlmICh2bS5hY3RpdmVTdHJlYW1zLmxlbmd0aCkgewogICAgICAgICAgICB2bS5kZWxldGVTZWxlY3RlZFN0cmVhbXMoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH1dOwogICAgfQogIH0pLAogIG1ldGhvZHM6IHsKICAgIGdyb3VwRHJhZ0NoYW5nZWQ6IGZ1bmN0aW9uIGdyb3VwRHJhZ0NoYW5nZWQoZykgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmdyb3VwX29yZGVyICE9IGkgKyAxKSB7CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5ncm91cF9vcmRlciA9IGkgKyAxOwogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHN0cmVhbURyYWdDaGFuZ2VkOiBmdW5jdGlvbiBzdHJlYW1EcmFnQ2hhbmdlZChnKSB7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5zdHJlYW1fb3JkZXIgIT0gaSArIDEpIHsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5zdHJlYW1fb3JkZXIgPSBpICsgMTsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgb3BlbkNvbnRleHQ6IGZ1bmN0aW9uIG9wZW5Db250ZXh0KGNvbnRleHQpIHsKICAgICAgdGhpcy4kcmVmc1tjb250ZXh0XS5vcGVuKCk7CiAgICB9LAogICAgc2VhcmNoRWRpdG9yOiBmdW5jdGlvbiBzZWFyY2hFZGl0b3Ioc2VhcmNoKSB7CiAgICAgIGlmIChzZWFyY2gubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhpcy5zZWFyY2ggPSBudWxsOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc2VhcmNoID0gc2VhcmNoOwogICAgICB9CiAgICB9LAogICAgcHJpbnRFZGl0b3I6IGZ1bmN0aW9uIHByaW50RWRpdG9yKCkgewogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZWRpdG9yIikucHJpbnQoKTsKICAgIH0sCiAgICBmb3JtYXROdW1iZXI6IGZ1bmN0aW9uIGZvcm1hdE51bWJlcihudW1iZXIpIHsKICAgICAgcmV0dXJuIG5ldyBJbnRsLk51bWJlckZvcm1hdCh0aGlzLiR0KCJkYXRlLmxvY2FsZSIpKS5mb3JtYXQobnVtYmVyKTsKICAgIH0sCiAgICBmb3JtYXREYXRlOiBmdW5jdGlvbiBmb3JtYXREYXRlKGRhdGUpIHsKICAgICAgcmV0dXJuIG5ldyBEYXRlKGRhdGUpLnRvTG9jYWxlU3RyaW5nKHRoaXMuJHQoImRhdGUubG9jYWxlIiksIHRoaXMuZGF0ZU9wdGlvbnMpOwogICAgfSwKICAgIGZvcm1hdERhdGVZb3V0dWJlOiBmdW5jdGlvbiBmb3JtYXREYXRlWW91dHViZShkYXRlKSB7CiAgICAgIHJldHVybiBuZXcgRGF0ZShkYXRlKS50b0xvY2FsZURhdGVTdHJpbmcodGhpcy4kdCgiZGF0ZS5sb2NhbGUiKSwgewogICAgICAgIHllYXI6ICJudW1lcmljIiwKICAgICAgICBtb250aDogInNob3J0IiwKICAgICAgICBkYXk6ICJudW1lcmljIgogICAgICB9KTsKICAgIH0sCiAgICBmb3JtYXRTZWNvbmRzOiBmdW5jdGlvbiBmb3JtYXRTZWNvbmRzKHNlYykgewogICAgICB2YXIgZCA9IE51bWJlcihzZWMpOwogICAgICB2YXIgaCA9IE1hdGguZmxvb3IoZCAvIDM2MDApOwogICAgICB2YXIgbSA9IE1hdGguZmxvb3IoZCAlIDM2MDAgLyA2MCk7CiAgICAgIHZhciBzID0gTWF0aC5mbG9vcihkICUgMzYwMCAlIDYwKTsKICAgICAgdmFyIGhvdXIgPSB0aGlzLiR0KCJnZW5lcmFsLmhvdXIiKTsKICAgICAgdmFyIGhvdXJzID0gdGhpcy4kdCgiZ2VuZXJhbC5ob3VycyIpOwogICAgICB2YXIgbWludXRlID0gdGhpcy4kdCgiZ2VuZXJhbC5taW51dGUiKTsKICAgICAgdmFyIG1pbnV0ZXMgPSB0aGlzLiR0KCJnZW5lcmFsLm1pbnV0ZXMiKTsKICAgICAgdmFyIHNlY29uZCA9IHRoaXMuJHQoImdlbmVyYWwuc2Vjb25kIik7CiAgICAgIHZhciBzZWNvbmRzID0gdGhpcy4kdCgiZ2VuZXJhbC5zZWNvbmRzIik7CiAgICAgIHZhciBoRGlzcGxheSA9IGggPiAwID8gaCArIChoID09IDEgPyAiICIuY29uY2F0KGhvdXIsICIgIikgOiAiICIuY29uY2F0KGhvdXJzLCAiICIpKSA6ICIiOwogICAgICB2YXIgbURpc3BsYXkgPSBtID4gMCA/IG0gKyAobSA9PSAxID8gIiAiLmNvbmNhdChtaW51dGUsICIgIikgOiAiICIuY29uY2F0KG1pbnV0ZXMsICIgIikpIDogIiI7CiAgICAgIHZhciBzRGlzcGxheSA9IHMgPiAwID8gcyArIChzID09IDEgPyAiICIuY29uY2F0KHNlY29uZCwgIiAiKSA6ICIgIi5jb25jYXQoc2Vjb25kcywgIiAiKSkgOiAiIjsKICAgICAgcmV0dXJuIGhEaXNwbGF5ICsgbURpc3BsYXkgKyBzRGlzcGxheTsKICAgIH0sCiAgICBnZXRHcm91cFdpdGhJZDogZnVuY3Rpb24gZ2V0R3JvdXBXaXRoSWQoaWQpIHsKICAgICAgdmFyIGluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KGZ1bmN0aW9uIChncm91cCkgewogICAgICAgIHJldHVybiBncm91cC5pZCA9PSBpZDsKICAgICAgfSk7CiAgICAgIHJldHVybiB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpbmRleF07CiAgICB9LAogICAgZ2V0U3RyZWFtV2l0aElkOiBmdW5jdGlvbiBnZXRTdHJlYW1XaXRoSWQoaWQpIHsKICAgICAgdmFyIGluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmZpbmRJbmRleChmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAgICAgcmV0dXJuIHN0cmVhbS5pZCA9PSBpZDsKICAgICAgfSk7CiAgICAgIHJldHVybiB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdOwogICAgfSwKICAgIGRvU2F2ZTogZnVuY3Rpb24gZG9TYXZlKCkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gZmFsc2U7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkgewogICAgICAgIHZhciBpbmRleCA9IF90aGlzMy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KGZ1bmN0aW9uIChncm91cCkgewogICAgICAgICAgcmV0dXJuIGdyb3VwLmlkID09IF90aGlzMy5hY3RpdmVHcm91cDsKICAgICAgICB9KTsKCiAgICAgICAgdmFyIHVwZGF0ZUdyb3VwcyA9IF90aGlzMy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmlsdGVyKGZ1bmN0aW9uIChncm91cCkgewogICAgICAgICAgcmV0dXJuICFncm91cC5ncm91cF9pc19yZW1vdmVkICYmIGdyb3VwLm1vZGlmaWVkOwogICAgICAgIH0pLm1hcChmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGlkOiBncm91cC5pZCwKICAgICAgICAgICAgZ3JvdXBfbmFtZTogZ3JvdXAuZ3JvdXBfbmFtZSwKICAgICAgICAgICAgZ3JvdXBfb3JkZXI6IGdyb3VwLmdyb3VwX29yZGVyLAogICAgICAgICAgICBncm91cF90eXBlOiBncm91cC5ncm91cF90eXBlLAogICAgICAgICAgICBncm91cF9wYXJlbnRfY29kZTogZ3JvdXAuZ3JvdXBfcGFyZW50X2NvZGUsCiAgICAgICAgICAgIGdyb3VwX2lzX2hpZGRlbjogZ3JvdXAuZ3JvdXBfaXNfaGlkZGVuCiAgICAgICAgICB9OwogICAgICAgIH0pOwoKICAgICAgICB2YXIgZGVsZXRlR3JvdXBzID0gX3RoaXMzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maWx0ZXIoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgICByZXR1cm4gZ3JvdXAuZ3JvdXBfaXNfcmVtb3ZlZCAmJiBncm91cC5tb2RpZmllZDsKICAgICAgICB9KS5tYXAoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgICByZXR1cm4gZ3JvdXAuaWQ7CiAgICAgICAgfSkuam9pbigpOwoKICAgICAgICB2YXIgdXBkYXRlU3RyZWFtczsKCiAgICAgICAgc3dpdGNoIChfdGhpczMuYWN0aXZlR3JvdXBUeXBlKSB7CiAgICAgICAgICAvLyBMaXZlIHN0cmVhbXMKICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgdXBkYXRlU3RyZWFtcyA9IF90aGlzMy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmZpbHRlcihmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHN0cmVhbS5zdHJlYW1faXNfcmVtb3ZlZCAhPT0gMSAmJiBzdHJlYW0ubW9kaWZpZWQ7CiAgICAgICAgICAgIH0pLm1hcChmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGlkOiBzdHJlYW0uaWQsCiAgICAgICAgICAgICAgICBzb3VyY2Vfc3RyZWFtX3VybDogc3RyZWFtLnNvdXJjZV9zdHJlYW1fdXJsLAogICAgICAgICAgICAgICAgc3RyZWFtX3R2Z19uYW1lOiBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lLAogICAgICAgICAgICAgICAgc3RyZWFtX3R2Z19pZDogc3RyZWFtLnN0cmVhbV90dmdfaWQsCiAgICAgICAgICAgICAgICBzdHJlYW1fdHZnX2xvZ286IHN0cmVhbS5zdHJlYW1fdHZnX2xvZ28sCiAgICAgICAgICAgICAgICBzdHJlYW1fcGFyZW50X2NvZGU6IHN0cmVhbS5zdHJlYW1fcGFyZW50X2NvZGUsCiAgICAgICAgICAgICAgICBzdHJlYW1fcmFkaW86IHN0cmVhbS5zdHJlYW1fcmFkaW8sCiAgICAgICAgICAgICAgICBzdHJlYW1faXNfaGlkZGVuOiBzdHJlYW0uc3RyZWFtX2lzX2hpZGRlbiwKICAgICAgICAgICAgICAgIHN0cmVhbV9vcmRlcjogc3RyZWFtLnN0cmVhbV9vcmRlcgogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIC8vIE1vdmllcwoKICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgdXBkYXRlU3RyZWFtcyA9IF90aGlzMy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmZpbHRlcihmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHN0cmVhbS5zdHJlYW1faXNfcmVtb3ZlZCAhPT0gMSAmJiBzdHJlYW0ubW9kaWZpZWQ7CiAgICAgICAgICAgIH0pLm1hcChmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGlkOiBzdHJlYW0uaWQsCiAgICAgICAgICAgICAgICBzb3VyY2Vfc3RyZWFtX3VybDogc3RyZWFtLnNvdXJjZV9zdHJlYW1fdXJsLAogICAgICAgICAgICAgICAgbW92aWVfbmFtZTogc3RyZWFtLm1vdmllX25hbWUsCiAgICAgICAgICAgICAgICBtb3ZpZV95ZWFyOiBzdHJlYW0ubW92aWVfeWVhciwKICAgICAgICAgICAgICAgIHRtZGJfaWQ6IHN0cmVhbS50bWRiX2lkLAogICAgICAgICAgICAgICAgc3RyZWFtX3R2Z19sb2dvOiBzdHJlYW0uc3RyZWFtX3R2Z19sb2dvLAogICAgICAgICAgICAgICAgc3RyZWFtX2lzX2hpZGRlbjogc3RyZWFtLnN0cmVhbV9pc19oaWRkZW4sCiAgICAgICAgICAgICAgICBzdHJlYW1fb3JkZXI6IHN0cmVhbS5zdHJlYW1fb3JkZXIKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAvLyBTZXJpZXMKCiAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgIHVwZGF0ZVN0cmVhbXMgPSBfdGhpczMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5maWx0ZXIoZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgICAgICAgIHJldHVybiBzdHJlYW0uc3RyZWFtX2lzX3JlbW92ZWQgIT09IDEgJiYgc3RyZWFtLm1vZGlmaWVkOwogICAgICAgICAgICB9KS5tYXAoZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBpZDogc3RyZWFtLmlkLAogICAgICAgICAgICAgICAgc291cmNlX3N0cmVhbV91cmw6IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX3VybCwKICAgICAgICAgICAgICAgIHNlcmllX25hbWU6IHN0cmVhbS5zZXJpZV9uYW1lLAogICAgICAgICAgICAgICAgc2VyaWVfc2Vhc29uOiBzdHJlYW0uc2VyaWVfc2Vhc29uLAogICAgICAgICAgICAgICAgc2VyaWVfZXBpc29kZTogc3RyZWFtLnNlcmllX2VwaXNvZGUsCiAgICAgICAgICAgICAgICB0bWRiX2lkOiBzdHJlYW0udG1kYl9pZCwKICAgICAgICAgICAgICAgIHN0cmVhbV90dmdfbG9nbzogc3RyZWFtLnN0cmVhbV90dmdfbG9nbywKICAgICAgICAgICAgICAgIHN0cmVhbV9pc19oaWRkZW46IHN0cmVhbS5zdHJlYW1faXNfaGlkZGVuLAogICAgICAgICAgICAgICAgc3RyZWFtX29yZGVyOiBzdHJlYW0uc3RyZWFtX29yZGVyCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgICAgdmFyIGRlbGV0ZVN0cmVhbXMgPSBfdGhpczMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5maWx0ZXIoZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgICAgcmV0dXJuIHN0cmVhbS5zdHJlYW1faXNfcmVtb3ZlZCA9PT0gMSAmJiBzdHJlYW0ubW9kaWZpZWQ7CiAgICAgICAgfSkubWFwKGZ1bmN0aW9uIChzdHJlYW0pIHsKICAgICAgICAgIHJldHVybiBzdHJlYW0uaWQ7CiAgICAgICAgfSkuam9pbigpOwoKICAgICAgICB2YXIgcmVxdWVzdHMgPSBbXTsKCiAgICAgICAgaWYgKHVwZGF0ZUdyb3Vwcy5sZW5ndGgpIHsKICAgICAgICAgIHJlcXVlc3RzLnB1c2goaHR0cFNlcnZpY2UucG9zdCgiZWRpdG9yL3VwZGF0ZS1ncm91cHMiLCB7CiAgICAgICAgICAgIHBsYXlsaXN0X2lkOiBfdGhpczMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICAgIGdyb3VwczogdXBkYXRlR3JvdXBzCiAgICAgICAgICB9KSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoZGVsZXRlR3JvdXBzLmxlbmd0aCkgewogICAgICAgICAgaW5kZXggPSAwOwogICAgICAgICAgcmVxdWVzdHMucHVzaChodHRwU2VydmljZS5wb3N0KCJlZGl0b3IvZGVsZXRlLWdyb3VwcyIsIHsKICAgICAgICAgICAgcGxheWxpc3RfaWQ6IF90aGlzMy5wbGF5bGlzdEVkaXRvci5pZCwKICAgICAgICAgICAgZ3JvdXBzOiBkZWxldGVHcm91cHMKICAgICAgICAgIH0pKTsKICAgICAgICB9CgogICAgICAgIGlmICh1cGRhdGVTdHJlYW1zLmxlbmd0aCkgewogICAgICAgICAgcmVxdWVzdHMucHVzaChodHRwU2VydmljZS5wb3N0KCJlZGl0b3IvdXBkYXRlLXN0cmVhbXMvIi5jb25jYXQoX3RoaXMzLmFjdGl2ZUdyb3VwVHlwZSksIHsKICAgICAgICAgICAgcGxheWxpc3RfaWQ6IF90aGlzMy5wbGF5bGlzdEVkaXRvci5pZCwKICAgICAgICAgICAgc3RyZWFtczogdXBkYXRlU3RyZWFtcwogICAgICAgICAgfSkpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGRlbGV0ZVN0cmVhbXMubGVuZ3RoKSB7CiAgICAgICAgICByZXF1ZXN0cy5wdXNoKGh0dHBTZXJ2aWNlLnBvc3QoImVkaXRvci9kZWxldGUtc3RyZWFtcy8iLmNvbmNhdChfdGhpczMuYWN0aXZlR3JvdXBUeXBlKSwgewogICAgICAgICAgICBwbGF5bGlzdF9pZDogX3RoaXMzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgICBzdHJlYW1zOiBkZWxldGVTdHJlYW1zCiAgICAgICAgICB9KSk7CiAgICAgICAgfQoKICAgICAgICBQcm9taXNlLmFsbChyZXF1ZXN0cykudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICBfdGhpczMubG9hZFBsYXlsaXN0KF90aGlzMy5wbGF5bGlzdEVkaXRvci5pZCwgaW5kZXgpOwoKICAgICAgICAgIHJlc29sdmUocmVzKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LAogICAgZG9DYW5jZWw6IGZ1bmN0aW9uIGRvQ2FuY2VsKCkgewogICAgICB2YXIgX3RoaXM0ID0gdGhpczsKCiAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgUHJvbWlzZS5hbGwoW3RoaXMucmVzdG9yZUdyb3VwcygpLCB0aGlzLnJlc3RvcmVTdHJlYW1zKCldKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczQucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IGZhbHNlOwogICAgICAgIF90aGlzNC5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfSk7CiAgICB9LAogICAgZG9UYWJDaGFuZ2U6IGZ1bmN0aW9uIGRvVGFiQ2hhbmdlKHRhYikgewogICAgICB0aGlzLmFjdGl2ZVRhYiA9IHRhYjsKICAgIH0sCiAgICB1cGRhdGVHcm91cE9yZGVyOiBmdW5jdGlvbiB1cGRhdGVHcm91cE9yZGVyKHNvdXJjZSkgewogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgICAgICB2YXIgZ3JvdXBzID0gX3RvQ29uc3VtYWJsZUFycmF5KHNvdXJjZSk7CgogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZ3JvdXBzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBncm91cHNbaV0uc291cmNlX2dyb3VwX29yZGVyID0gaSArIDE7CiAgICAgICAgICBncm91cHNbaV0uZ3JvdXBfb3JkZXIgPSBpICsgMTsKICAgICAgICB9CgogICAgICAgIHJlc29sdmUoZ3JvdXBzKTsKICAgICAgfSk7CiAgICB9LAogICAgdXBkYXRlU3RyZWFtT3JkZXI6IGZ1bmN0aW9uIHVwZGF0ZVN0cmVhbU9yZGVyKHNvdXJjZSkgewogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgICAgICB2YXIgc3RyZWFtcyA9IF90b0NvbnN1bWFibGVBcnJheShzb3VyY2UpOwoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN0cmVhbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHN0cmVhbXNbaV0uc291cmNlX3N0cmVhbV9vcmRlciA9IGkgKyAxOwogICAgICAgICAgc3RyZWFtc1tpXS5zdHJlYW1fb3JkZXIgPSBpICsgMTsKICAgICAgICB9CgogICAgICAgIHJlc29sdmUoc3RyZWFtcyk7CiAgICAgIH0pOwogICAgfSwKICAgIHJlc3RvcmVHcm91cE9yZGVyOiBmdW5jdGlvbiByZXN0b3JlR3JvdXBPcmRlcigpIHsKICAgICAgdmFyIF90aGlzNSA9IHRoaXM7CgogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgICAgICBfdGhpczUucGxheWxpc3RFZGl0b3IuZ3JvdXBzLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgIHJldHVybiBhLnNvdXJjZV9ncm91cF9vcmRlciA+IGIuc291cmNlX2dyb3VwX29yZGVyID8gMSA6IGIuc291cmNlX2dyb3VwX29yZGVyID4gYS5zb3VyY2VfZ3JvdXBfb3JkZXIgPyAtMSA6IDA7CiAgICAgICAgfSk7CgogICAgICAgIHJlc29sdmUoKTsKICAgICAgfSk7CiAgICB9LAogICAgcmVzdG9yZVN0cmVhbU9yZGVyOiBmdW5jdGlvbiByZXN0b3JlU3RyZWFtT3JkZXIoKSB7CiAgICAgIHZhciBfdGhpczYgPSB0aGlzOwoKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgICAgX3RoaXM2LnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMuc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgcmV0dXJuIGEuc291cmNlX3N0cmVhbV9vcmRlciA+IGIuc291cmNlX3N0cmVhbV9vcmRlciA/IDEgOiBiLnNvdXJjZV9zdHJlYW1fb3JkZXIgPiBhLnNvdXJjZV9zdHJlYW1fb3JkZXIgPyAtMSA6IDA7CiAgICAgICAgfSk7CgogICAgICAgIHJlc29sdmUoKTsKICAgICAgfSk7CiAgICB9LAogICAgcmVzdG9yZUdyb3VwczogZnVuY3Rpb24gcmVzdG9yZUdyb3VwcygpIHsKICAgICAgdmFyIF90aGlzNyA9IHRoaXM7CgogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgICAgICBfdGhpczcucmVzdG9yZUdyb3VwT3JkZXIoKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciBncm91cDsKCiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IF90aGlzNy5wbGF5bGlzdEVkaXRvci5ncm91cHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgZ3JvdXAgPSBfdGhpczcucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldOwogICAgICAgICAgICBncm91cC5tb2RpZmllZCA9IGZhbHNlOwogICAgICAgICAgICBncm91cC5ncm91cF9pc19yZW1vdmVkID0gMDsKICAgICAgICAgICAgZ3JvdXAuZ3JvdXBfdHlwZSA9IGdyb3VwLnNvdXJjZV9ncm91cF90eXBlOwogICAgICAgICAgICBncm91cC5ncm91cF9uYW1lID0gZ3JvdXAuc291cmNlX2dyb3VwX25hbWU7CiAgICAgICAgICAgIGdyb3VwLnBhcmVudF9jb2RlID0gZ3JvdXAuc291cmNlX2dyb3VwX3BhcmVudF9jb2RlOwogICAgICAgICAgICBncm91cC5ncm91cF9pc19oaWRkZW4gPSBncm91cC5zb3VyY2VfZ3JvdXBfaXNfaGlkZGVuOwogICAgICAgICAgfQoKICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LAogICAgcmVzdG9yZVN0cmVhbXM6IGZ1bmN0aW9uIHJlc3RvcmVTdHJlYW1zKCkgewogICAgICB2YXIgX3RoaXM4ID0gdGhpczsKCiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkgewogICAgICAgIF90aGlzOC5yZXN0b3JlU3RyZWFtT3JkZXIoKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciBzdHJlYW07CgogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBfdGhpczgucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBzdHJlYW0gPSBfdGhpczgucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXTsKICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gZmFsc2U7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1faXNfcmVtb3ZlZCA9IDA7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX25hbWUgPSBzdHJlYW0uc291cmNlX3N0cmVhbV90dmdfbmFtZTsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfaWQgPSBzdHJlYW0uc291cmNlX3N0cmVhbV90dmdfaWQ7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX2xvZ28gPSBzdHJlYW0uc291cmNlX3N0cmVhbV90dmdfbG9nbzsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfY2hubyA9IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX3R2Z19jaG5vOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19zaGlmdCA9IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX3R2Z19zaGlmdDsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV9wYXJlbnRfY29kZSA9IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX3BhcmVudF9jb2RlOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX2F1ZGlvX3RyYWNrID0gc3RyZWFtLnNvdXJjZV9zdHJlYW1fYXVkaW9fdHJhY2s7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fYXNwZWN0X3JhdGlvID0gc3RyZWFtLnNvdXJjZV9zdHJlYW1fYXNwZWN0X3JhdGlvOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3JhZGlvID0gc3RyZWFtLnNvdXJjZV9zdHJlYW1fcmFkaW87CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fb3JkZXIgPSBzdHJlYW0uc291cmNlX3N0cmVhbV9vcmRlcjsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV9pc19oaWRkZW4gPSBzdHJlYW0uc291cmNlX3N0cmVhbV9pc19oaWRkZW47CgogICAgICAgICAgICBpZiAoc3RyZWFtLm1vdmllX25hbWUgIT09IHVuZGVmaW5lZCAmJiBzdHJlYW0ubW92aWVfeWVhciAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgc3RyZWFtLm1vdmllX25hbWUgPSBzdHJlYW0uc291cmNlX21vdmllX25hbWU7CiAgICAgICAgICAgICAgc3RyZWFtLm1vdmllX3llYXIgPSBzdHJlYW0uc291cmNlX21vdmllX3llYXI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChzdHJlYW0uc2VyaWVfbmFtZSAhPT0gdW5kZWZpbmVkICYmIHN0cmVhbS5zZXJpZV9zZWFzb24gIT09IHVuZGVmaW5lZCAmJiBzdHJlYW0uc2VyaWVfZXBpc29kZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgc3RyZWFtLnNlcmllX25hbWUgPSBzdHJlYW0uc291cmNlX3NlcmllX25hbWU7CiAgICAgICAgICAgICAgc3RyZWFtLnNlcmllX3NlYXNvbiA9IHN0cmVhbS5zb3VyY2Vfc2VyaWVfc2Vhc29uOwogICAgICAgICAgICAgIHN0cmVhbS5zZXJpZV9lcGlzb2RlID0gc3RyZWFtLnNvdXJjZV9zZXJpZV9lcGlzb2RlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0sCiAgICB0b2dnbGVHcm91cFZpc2liaWxpdHk6IGZ1bmN0aW9uIHRvZ2dsZUdyb3VwVmlzaWJpbGl0eSgpIHsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3Vwcy5pbmNsdWRlcyh0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5pZCkpIHsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmdyb3VwX2lzX2hpZGRlbiA9ICF0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5ncm91cF9pc19oaWRkZW47CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgfSwKICAgIHRvZ2dsZVN0cmVhbVZpc2liaWxpdHk6IGZ1bmN0aW9uIHRvZ2dsZVN0cmVhbVZpc2liaWxpdHkoKSB7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHRoaXMuYWN0aXZlU3RyZWFtcy5pbmNsdWRlcyh0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uaWQpKSB7CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uc3RyZWFtX2lzX2hpZGRlbiA9ICF0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uc3RyZWFtX2lzX2hpZGRlbjsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgfSwKICAgIHRvZ2dsZVN0cmVhbVJhZGlvOiBmdW5jdGlvbiB0b2dnbGVTdHJlYW1SYWRpbygpIHsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAodGhpcy5hY3RpdmVTdHJlYW1zLmluY2x1ZGVzKHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5pZCkpIHsKICAgICAgICAgIGlmICh0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uc3RyZWFtX3JhZGlvID09IDApIHsKICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLnN0cmVhbV9yYWRpbyA9IDE7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uc3RyZWFtX3JhZGlvID0gMDsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgIH0sCiAgICBkZWxldGVTZWxlY3RlZEdyb3VwczogZnVuY3Rpb24gZGVsZXRlU2VsZWN0ZWRHcm91cHMoKSB7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cHMuaW5jbHVkZXModGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uaWQpKSB7CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5ncm91cF9pc19yZW1vdmVkID0gMTsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICB9LAogICAgZGVsZXRlU2VsZWN0ZWRTdHJlYW1zOiBmdW5jdGlvbiBkZWxldGVTZWxlY3RlZFN0cmVhbXMoKSB7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHRoaXMuYWN0aXZlU3RyZWFtcy5pbmNsdWRlcyh0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uaWQpKSB7CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uc3RyZWFtX2lzX3JlbW92ZWQgPSAxOwogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICB9LAogICAgbG9hZFBsYXlsaXN0OiBmdW5jdGlvbiBsb2FkUGxheWxpc3QodmFsKSB7CiAgICAgIHZhciBfdGhpczkgPSB0aGlzOwoKICAgICAgdmFyIGdyb3VwX2luZGV4ID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQ7CiAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTsKCiAgICAgIGlmICh0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQpIHsKICAgICAgICB0aGlzLmRvU2F2ZSgpOwogICAgICB9CgogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkID0gdmFsOwogICAgICBodHRwU2VydmljZS5nZXQoImVkaXRvci9ncm91cHMvIi5jb25jYXQodmFsKSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgaWYgKHJlcy5zdGF0dXMgPT09IHRydWUpIHsKICAgICAgICAgIF90aGlzOS51cGRhdGVHcm91cE9yZGVyKHJlcy5kYXRhKS50aGVuKGZ1bmN0aW9uIChncm91cHMpIHsKICAgICAgICAgICAgX3RoaXM5LnBsYXlsaXN0RWRpdG9yLmdyb3VwcyA9IGdyb3Vwcy5tYXAoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgICAgICAgdmFyIGdycCA9IE9iamVjdC5hc3NpZ24oe30sIGdyb3VwKTsKICAgICAgICAgICAgICBncnAuc291cmNlX2dyb3VwX3BhcmVudF9jb2RlID0gZ3JvdXAuZ3JvdXBfcGFyZW50X2NvZGU7CiAgICAgICAgICAgICAgZ3JwLnNvdXJjZV9ncm91cF9pc19oaWRkZW4gPSBncm91cC5ncm91cF9pc19oaWRkZW47CiAgICAgICAgICAgICAgZ3JwLnNvdXJjZV9ncm91cF9uYW1lID0gZ3JvdXAuZ3JvdXBfbmFtZTsKICAgICAgICAgICAgICBncnAuc291cmNlX2dyb3VwX3R5cGUgPSBncm91cC5ncm91cF90eXBlOwogICAgICAgICAgICAgIGdycC5ncm91cF9pc19yZW1vdmVkID0gZmFsc2U7CiAgICAgICAgICAgICAgZ3JwLm1vZGlmaWVkID0gZmFsc2U7CiAgICAgICAgICAgICAgcmV0dXJuIGdycDsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpZiAoZ3JvdXBzLmxlbmd0aCkgewogICAgICAgICAgICAgIGlmIChncm91cF9pbmRleCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBfdGhpczkuYWN0aXZlR3JvdXAgPSBfdGhpczkucGxheWxpc3RFZGl0b3IuZ3JvdXBzWzBdLmlkOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBfdGhpczkuYWN0aXZlR3JvdXAgPSBfdGhpczkucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2dyb3VwX2luZGV4XS5pZDsKCiAgICAgICAgICAgICAgICBfdGhpczkubG9hZFN0cmVhbXMoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgX3RoaXM5LmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXM5LmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9KTsKICAgIH0sCiAgICB0b2dnbGVHcm91cFNlbGVjdGlvbjogZnVuY3Rpb24gdG9nZ2xlR3JvdXBTZWxlY3Rpb24oaXRlbSkgewogICAgICB2YXIgaWR4ID0gdGhpcy5hY3RpdmVHcm91cHMuaW5kZXhPZihpdGVtKTsKCiAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgdGhpcy5hY3RpdmVHcm91cHMuc3BsaWNlKGlkeCwgMSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5hY3RpdmVHcm91cHMucHVzaChpdGVtKTsKICAgICAgfQogICAgfSwKICAgIHRvZ2dsZVN0cmVhbVNlbGVjdGlvbjogZnVuY3Rpb24gdG9nZ2xlU3RyZWFtU2VsZWN0aW9uKGl0ZW0pIHsKICAgICAgdmFyIGlkeCA9IHRoaXMuYWN0aXZlU3RyZWFtcy5pbmRleE9mKGl0ZW0pOwoKICAgICAgaWYgKGlkeCAhPT0gLTEpIHsKICAgICAgICB0aGlzLmFjdGl2ZVN0cmVhbXMuc3BsaWNlKGlkeCwgMSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5hY3RpdmVTdHJlYW1zLnB1c2goaXRlbSk7CiAgICAgIH0KICAgIH0sCiAgICB0b2dnbGVSYWRpb2Jyb3dzZXJTZWxlY3Rpb246IGZ1bmN0aW9uIHRvZ2dsZVJhZGlvYnJvd3NlclNlbGVjdGlvbihpdGVtKSB7CiAgICAgIHZhciBpZHggPSB0aGlzLnJhZGlvQnJvd3Nlci5hY3RpdmUuaW5kZXhPZihpdGVtKTsKCiAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuYWN0aXZlLnNwbGljZShpZHgsIDEpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZS5wdXNoKGl0ZW0pOwogICAgICB9CiAgICB9LAogICAgdG9nZ2xlSW1wb3J0TTNVU2VsZWN0aW9uOiBmdW5jdGlvbiB0b2dnbGVJbXBvcnRNM1VTZWxlY3Rpb24oaXRlbSkgewogICAgICB2YXIgaWR4ID0gdGhpcy5pbXBvcnRNM1UuaW1wb3J0R3JvdXBzLmluZGV4T2YoaXRlbSk7CgogICAgICBpZiAoaWR4ICE9PSAtMSkgewogICAgICAgIHRoaXMuaW1wb3J0TTNVLmltcG9ydEdyb3Vwcy5zcGxpY2UoaWR4LCAxKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmltcG9ydE0zVS5pbXBvcnRHcm91cHMucHVzaChpdGVtKTsKICAgICAgfQogICAgfSwKICAgIGluZGV4T2ZHcm91cDogZnVuY3Rpb24gaW5kZXhPZkdyb3VwKGdyb3VwKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5tYXAoZnVuY3Rpb24gKGcpIHsKICAgICAgICByZXR1cm4gZy5pZDsKICAgICAgfSkuaW5kZXhPZihncm91cCk7CiAgICB9LAogICAgc2VsZWN0R3JvdXBSYW5nZVNlbGVjdGlvbjogZnVuY3Rpb24gc2VsZWN0R3JvdXBSYW5nZVNlbGVjdGlvbihpdGVtKSB7CiAgICAgIHZhciBsYXN0SW5kZXggPSB0aGlzLmluZGV4T2ZHcm91cCh0aGlzLmxhc3RTZWxlY3RlZEdyb3VwKTsKICAgICAgdmFyIGl0ZW1JbmRleCA9IHRoaXMuaW5kZXhPZkdyb3VwKGl0ZW0pOwogICAgICB2YXIgZGlyID0gaXRlbUluZGV4ID4gbGFzdEluZGV4ID8gMSA6IC0xOwoKICAgICAgZm9yICh2YXIgaSA9IGxhc3RJbmRleDsgaSAhPSBpdGVtSW5kZXggKyBkaXI7IGkgKz0gZGlyKSB7CiAgICAgICAgaWYgKCF0aGlzLmFjdGl2ZUdyb3Vwcy5pbmNsdWRlcyh0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5pZCkpIHsKICAgICAgICAgIHRoaXMuYWN0aXZlR3JvdXBzLnB1c2godGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uaWQpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGluZGV4T2ZTdHJlYW06IGZ1bmN0aW9uIGluZGV4T2ZTdHJlYW0oc3RyZWFtKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubWFwKGZ1bmN0aW9uIChnKSB7CiAgICAgICAgcmV0dXJuIGcuaWQ7CiAgICAgIH0pLmluZGV4T2Yoc3RyZWFtKTsKICAgIH0sCiAgICBzZWxlY3RTdHJlYW1SYW5nZVNlbGVjdGlvbjogZnVuY3Rpb24gc2VsZWN0U3RyZWFtUmFuZ2VTZWxlY3Rpb24oaXRlbSkgewogICAgICB2YXIgbGFzdEluZGV4ID0gdGhpcy5pbmRleE9mU3RyZWFtKHRoaXMubGFzdFNlbGVjdGVkU3RyZWFtKTsKICAgICAgdmFyIGl0ZW1JbmRleCA9IHRoaXMuaW5kZXhPZlN0cmVhbShpdGVtKTsKICAgICAgdmFyIGRpciA9IGl0ZW1JbmRleCA+IGxhc3RJbmRleCA/IDEgOiAtMTsKCiAgICAgIGZvciAodmFyIGkgPSBsYXN0SW5kZXg7IGkgIT0gaXRlbUluZGV4ICsgZGlyOyBpICs9IGRpcikgewogICAgICAgIGlmICghdGhpcy5hY3RpdmVTdHJlYW1zLmluY2x1ZGVzKHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5pZCkpIHsKICAgICAgICAgIHRoaXMuYWN0aXZlU3RyZWFtcy5wdXNoKHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5pZCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgc2VsZWN0UmFkaW9icm93c2VyUmFuZ2VTZWxlY3Rpb246IGZ1bmN0aW9uIHNlbGVjdFJhZGlvYnJvd3NlclJhbmdlU2VsZWN0aW9uKGluZGV4KSB7CiAgICAgIHZhciBsYXN0SW5kZXggPSB0aGlzLnJhZGlvQnJvd3Nlci5hY3RpdmVbdGhpcy5yYWRpb0Jyb3dzZXIuYWN0aXZlLmxlbmd0aCAtIDFdOwogICAgICB2YXIgZGlyID0gaW5kZXggPiBsYXN0SW5kZXggPyAxIDogLTE7CgogICAgICBmb3IgKHZhciBpID0gbGFzdEluZGV4OyBpICE9IGluZGV4ICsgZGlyOyBpICs9IGRpcikgewogICAgICAgIGlmICghdGhpcy5yYWRpb0Jyb3dzZXIuYWN0aXZlLmluY2x1ZGVzKGkpKSB7CiAgICAgICAgICB0aGlzLnJhZGlvQnJvd3Nlci5hY3RpdmUucHVzaChpKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBzZWxlY3RJbXBvcnRNM1VSYW5nZVNlbGVjdGlvbjogZnVuY3Rpb24gc2VsZWN0SW1wb3J0TTNVUmFuZ2VTZWxlY3Rpb24oaW5kZXgpIHsKICAgICAgdmFyIGxhc3RJbmRleCA9IHRoaXMuaW1wb3J0TTNVLmltcG9ydEdyb3Vwc1t0aGlzLmltcG9ydE0zVS5pbXBvcnRHcm91cHMubGVuZ3RoIC0gMV07CiAgICAgIHZhciBkaXIgPSBpbmRleCA+IGxhc3RJbmRleCA/IDEgOiAtMTsKCiAgICAgIGZvciAodmFyIGkgPSBsYXN0SW5kZXg7IGkgIT0gaW5kZXggKyBkaXI7IGkgKz0gZGlyKSB7CiAgICAgICAgaWYgKCF0aGlzLmltcG9ydE0zVS5pbXBvcnRHcm91cHMuaW5jbHVkZXMoaSkpIHsKICAgICAgICAgIHRoaXMuaW1wb3J0TTNVLmltcG9ydEdyb3Vwcy5wdXNoKGkpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHNlbGVjdEdyb3VwU2VsZWN0aW9uOiBmdW5jdGlvbiBzZWxlY3RHcm91cFNlbGVjdGlvbihpdGVtKSB7CiAgICAgIHRoaXMuYWN0aXZlR3JvdXBzLmxlbmd0aCA9IDA7CiAgICAgIHRoaXMuYWN0aXZlR3JvdXBzLnB1c2goaXRlbSk7CiAgICB9LAogICAgc2VsZWN0U3RyZWFtU2VsZWN0aW9uOiBmdW5jdGlvbiBzZWxlY3RTdHJlYW1TZWxlY3Rpb24oaXRlbSkgewogICAgICB0aGlzLmFjdGl2ZVN0cmVhbXMubGVuZ3RoID0gMDsKICAgICAgdGhpcy5hY3RpdmVTdHJlYW1zLnB1c2goaXRlbSk7CiAgICB9LAogICAgc2VsZWN0UmFkaW9icm93c2VyU2VsZWN0aW9uOiBmdW5jdGlvbiBzZWxlY3RSYWRpb2Jyb3dzZXJTZWxlY3Rpb24oaXRlbSkgewogICAgICB0aGlzLnJhZGlvQnJvd3Nlci5hY3RpdmUubGVuZ3RoID0gMDsKICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuYWN0aXZlLnB1c2goaXRlbSk7CiAgICB9LAogICAgc2VsZWN0SW1wb3J0TTNVU2VsZWN0aW9uOiBmdW5jdGlvbiBzZWxlY3RJbXBvcnRNM1VTZWxlY3Rpb24oaXRlbSkgewogICAgICB0aGlzLmltcG9ydE0zVS5pbXBvcnRHcm91cHMubGVuZ3RoID0gMDsKICAgICAgdGhpcy5pbXBvcnRNM1UuaW1wb3J0R3JvdXBzLnB1c2goaXRlbSk7CiAgICB9LAogICAgZmluZEFuZFJlcGxhY2VNb2RhbDogZnVuY3Rpb24gZmluZEFuZFJlcGxhY2VNb2RhbChzaG93KSB7CiAgICAgIHZhciB0eXBlID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiAxOwogICAgICB0aGlzLmZpbmRSZXBsYWNlLnR5cGUgPSB0eXBlOwogICAgICB0aGlzLmZpbmRSZXBsYWNlLm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBmaW5kQW5kUmVwbGFjZTogZnVuY3Rpb24gZmluZEFuZFJlcGxhY2UoKSB7CiAgICAgIHZhciBfdGhpczEwID0gdGhpczsKCiAgICAgIHZhciBvcHRpb25zID0gIiI7CgogICAgICBpZiAodGhpcy5maW5kUmVwbGFjZS5yZXBsYWNlQWxsKSB7CiAgICAgICAgb3B0aW9ucyArPSAiZyI7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmZpbmRSZXBsYWNlLmlnbm9yZUNhc2UpIHsKICAgICAgICBvcHRpb25zICs9ICJpIjsKICAgICAgfQoKICAgICAgdmFyIHJlID0gbmV3IFJlZ0V4cCh0aGlzLmZpbmRSZXBsYWNlLmZyb20ucmVwbGFjZSgifCIsICJcXHwiKSwgb3B0aW9ucyk7CgogICAgICBzd2l0Y2ggKHBhcnNlSW50KHRoaXMuZmluZFJlcGxhY2UudHlwZSkpIHsKICAgICAgICAvLyBHcm91cAogICAgICAgIGNhc2UgMToKICAgICAgICAgIGlmIChwYXJzZUludCh0aGlzLmZpbmRSZXBsYWNlLnNlbGVjdGVkT25seSkgPT09IDEpIHsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3Vwcy5pbmNsdWRlcyh0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5pZCkpIHsKICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmdyb3VwX25hbWUgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5ncm91cF9uYW1lLnJlcGxhY2UocmUsIHRoaXMuZmluZFJlcGxhY2UudG8pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5maWx0ZXJlZEdyb3Vwcy5tYXAoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgICAgICAgZ3JvdXAubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgIGdyb3VwLmdyb3VwX25hbWUgPSBncm91cC5ncm91cF9uYW1lLnJlcGxhY2UocmUsIF90aGlzMTAuZmluZFJlcGxhY2UudG8pOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KCiAgICAgICAgICBicmVhazsKICAgICAgICAvLyBTdHJlYW1zCgogICAgICAgIGNhc2UgMjoKICAgICAgICAgIGlmIChwYXJzZUludCh0aGlzLmZpbmRSZXBsYWNlLnNlbGVjdGVkT25seSkgPT09IDEpIHsKICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7IF9pKyspIHsKICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVTdHJlYW1zLmluY2x1ZGVzKHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tfaV0uaWQpKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDEpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW19pXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tfaV0uc3RyZWFtX3R2Z19uYW1lID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW19pXS5zdHJlYW1fdHZnX25hbWUucmVwbGFjZShyZSwgdGhpcy5maW5kUmVwbGFjZS50byk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tfaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbX2ldLm1vdmllX25hbWUgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbX2ldLm1vdmllX25hbWUucmVwbGFjZShyZSwgdGhpcy5maW5kUmVwbGFjZS50byk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAzKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tfaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbX2ldLnNlcmllX25hbWUgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbX2ldLnNlcmllX25hbWUucmVwbGFjZShyZSwgdGhpcy5maW5kUmVwbGFjZS50byk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLmZpbHRlcmVkU3RyZWFtcy5tYXAoZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgICAgICAgIGlmIChfdGhpczEwLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMSkgewogICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX25hbWUgPSBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lLnJlcGxhY2UocmUsIF90aGlzMTAuZmluZFJlcGxhY2UudG8pOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKF90aGlzMTAuYWN0aXZlR3JvdXBUeXBlID09PSAyKSB7CiAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgc3RyZWFtLm1vdmllX25hbWUgPSBzdHJlYW0ubW92aWVfbmFtZS5yZXBsYWNlKHJlLCBfdGhpczEwLmZpbmRSZXBsYWNlLnRvKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChfdGhpczEwLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMykgewogICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHN0cmVhbS5zZXJpZV9uYW1lID0gc3RyZWFtLnNlcmllX25hbWUucmVwbGFjZShyZSwgX3RoaXMxMC5maW5kUmVwbGFjZS50byk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KCiAgICAgICAgICBicmVhazsKICAgICAgfQoKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgICAgdGhpcy5maW5kUmVwbGFjZS5tb2RhbCA9IGZhbHNlOwogICAgfSwKICAgIHByZWZpeFN1ZmZpeE1vZGFsOiBmdW5jdGlvbiBwcmVmaXhTdWZmaXhNb2RhbChzaG93KSB7CiAgICAgIHZhciB0eXBlID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiAxOwogICAgICB0aGlzLnByZWZpeFN1ZmZpeC50eXBlID0gdHlwZTsKICAgICAgdGhpcy5wcmVmaXhTdWZmaXgubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGFkZFByZWZpeFN1ZmZpeDogZnVuY3Rpb24gYWRkUHJlZml4U3VmZml4KCkgewogICAgICB2YXIgcHJlZml4ID0gdGhpcy5wcmVmaXhTdWZmaXgucHJlZml4OwogICAgICB2YXIgc3VmZml4ID0gdGhpcy5wcmVmaXhTdWZmaXguc3VmZml4OwoKICAgICAgc3dpdGNoIChwYXJzZUludCh0aGlzLnByZWZpeFN1ZmZpeC50eXBlKSkgewogICAgICAgIC8vIEdyb3VwCiAgICAgICAgY2FzZSAxOgogICAgICAgICAgaWYgKHBhcnNlSW50KHRoaXMucHJlZml4U3VmZml4LnNlbGVjdGVkT25seSkgPT09IDEpIHsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3Vwcy5pbmNsdWRlcyh0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5pZCkpIHsKICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmdyb3VwX25hbWUgPSBwcmVmaXggKyB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5ncm91cF9uYW1lICsgc3VmZml4OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5maWx0ZXJlZEdyb3Vwcy5tYXAoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgICAgICAgZ3JvdXAubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgIGdyb3VwLmdyb3VwX25hbWUgPSBwcmVmaXggKyBncm91cC5ncm91cF9uYW1lICsgc3VmZml4OwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KCiAgICAgICAgICBicmVhazsKICAgICAgICAvLyBTdHJlYW0KCiAgICAgICAgY2FzZSAyOgogICAgICAgICAgaWYgKHBhcnNlSW50KHRoaXMucHJlZml4U3VmZml4LnNlbGVjdGVkT25seSkgPT09IDEpIHsKICAgICAgICAgICAgZm9yICh2YXIgX2kyID0gMDsgX2kyIDwgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsgX2kyKyspIHsKICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVTdHJlYW1zLmluY2x1ZGVzKHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tfaTJdLmlkKSkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAxKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tfaTJdLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW19pMl0uc3RyZWFtX3R2Z19uYW1lID0gcHJlZml4ICsgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW19pMl0uc3RyZWFtX3R2Z19uYW1lICsgc3VmZml4OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMikgewogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbX2kyXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tfaTJdLm1vdmllX25hbWUgPSBwcmVmaXggKyB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbX2kyXS5tb3ZpZV9uYW1lICsgc3VmZml4OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMykgewogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbX2kyXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tfaTJdLnNlcmllX25hbWUgPSBwcmVmaXggKyB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbX2kyXS5zZXJpZV9uYW1lICsgc3VmZml4OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAxKSB7CiAgICAgICAgICAgICAgdGhpcy5maWx0ZXJlZFN0cmVhbXMubWFwKGZ1bmN0aW9uIChzdHJlYW0pIHsKICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lID0gcHJlZml4ICsgc3RyZWFtLnN0cmVhbV90dmdfbmFtZSArIHN1ZmZpeDsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAyKSB7CiAgICAgICAgICAgICAgdGhpcy5maWx0ZXJlZFN0cmVhbXMubWFwKGZ1bmN0aW9uIChzdHJlYW0pIHsKICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICBzdHJlYW0ubW92aWVfbmFtZSA9IHByZWZpeCArIHN0cmVhbS5tb3ZpZV9uYW1lICsgc3VmZml4OwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDMpIHsKICAgICAgICAgICAgICB0aGlzLmZpbHRlcmVkU3RyZWFtcy5tYXAoZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHN0cmVhbS5zZXJpZV9uYW1lID0gcHJlZml4ICsgc3RyZWFtLnNlcmllX25hbWUgKyBzdWZmaXg7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBicmVhazsKICAgICAgfQoKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgICAgdGhpcy5wcmVmaXhTdWZmaXgubW9kYWwgPSBmYWxzZTsKICAgIH0sCiAgICBjb252ZXJ0Q2FzZU1vZGFsOiBmdW5jdGlvbiBjb252ZXJ0Q2FzZU1vZGFsKHNob3csIHR5cGUpIHsKICAgICAgdGhpcy5jb252ZXJ0Q2FzZS50eXBlID0gdHlwZTsKICAgICAgdGhpcy5jb252ZXJ0Q2FzZS5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgY2hhbmdlQ2FzZTogZnVuY3Rpb24gY2hhbmdlQ2FzZSgpIHsKICAgICAgdmFyIF90aGlzMTEgPSB0aGlzOwoKICAgICAgdmFyIG1ldGhvZCA9IHRoaXMuY29udmVydENhc2UubWV0aG9kOwogICAgICB2YXIgZ3JvdXBzOwogICAgICB2YXIgc3RyZWFtczsKCiAgICAgIGlmIChwYXJzZUludCh0aGlzLmNvbnZlcnRDYXNlLnNlbGVjdGVkT25seSkgPT09IDEpIHsKICAgICAgICBncm91cHMgPSB0aGlzLmZpbHRlcmVkR3JvdXBzLmZpbHRlcihmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICAgIHJldHVybiBfdGhpczExLmFjdGl2ZUdyb3Vwcy5pbmNsdWRlcyhncm91cC5pZCk7CiAgICAgICAgfSk7CiAgICAgICAgc3RyZWFtcyA9IHRoaXMuZmlsdGVyZWRTdHJlYW1zLmZpbHRlcihmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAgICAgICByZXR1cm4gX3RoaXMxMS5hY3RpdmVTdHJlYW1zLmluY2x1ZGVzKHN0cmVhbS5pZCk7CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZ3JvdXBzID0gdGhpcy5maWx0ZXJlZEdyb3VwczsKICAgICAgICBzdHJlYW1zID0gdGhpcy5maWx0ZXJlZFN0cmVhbXM7CiAgICAgIH0KCiAgICAgIHN3aXRjaCAocGFyc2VJbnQodGhpcy5jb252ZXJ0Q2FzZS50eXBlKSkgewogICAgICAgIC8vIENhdGVnb3JpZXMKICAgICAgICBjYXNlIDE6CiAgICAgICAgICBncm91cHMubWFwKGZ1bmN0aW9uIChncm91cCkgewogICAgICAgICAgICBzd2l0Y2ggKHBhcnNlSW50KG1ldGhvZCkpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBncm91cC5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICBncm91cC5ncm91cF9uYW1lID0gZ3JvdXAuZ3JvdXBfbmFtZS50aXRsZUNhc2UoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICBncm91cC5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICBncm91cC5ncm91cF9uYW1lID0gZ3JvdXAuZ3JvdXBfbmFtZS50b1VwcGVyQ2FzZSgpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIGdyb3VwLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGdyb3VwLmdyb3VwX25hbWUgPSBncm91cC5ncm91cF9uYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgICBicmVhazsKICAgICAgICAvLyBTdHJlYW1zCgogICAgICAgIGNhc2UgMjoKICAgICAgICAgIHN0cmVhbXMubWFwKGZ1bmN0aW9uIChzdHJlYW0pIHsKICAgICAgICAgICAgc3dpdGNoIChwYXJzZUludChtZXRob2QpKSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgaWYgKF90aGlzMTEuYWN0aXZlR3JvdXBUeXBlID09PSAxKSB7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX25hbWUgPSBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lLnRpdGxlQ2FzZSgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChfdGhpczExLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMikgewogICAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICBzdHJlYW0ubW92aWVfbmFtZSA9IHN0cmVhbS5tb3ZpZV9uYW1lLnRpdGxlQ2FzZSgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChfdGhpczExLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMykgewogICAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICBzdHJlYW0uc2VyaWVfbmFtZSA9IHN0cmVhbS5zZXJpZV9uYW1lLnRpdGxlQ2FzZSgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICBpZiAoX3RoaXMxMS5hY3RpdmVHcm91cFR5cGUgPT09IDEpIHsKICAgICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfbmFtZSA9IHN0cmVhbS5zdHJlYW1fdHZnX25hbWUudG9VcHBlckNhc2UoKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoX3RoaXMxMS5hY3RpdmVHcm91cFR5cGUgPT09IDIpIHsKICAgICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgc3RyZWFtLm1vdmllX25hbWUgPSBzdHJlYW0ubW92aWVfbmFtZS50b1VwcGVyQ2FzZSgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChfdGhpczExLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMykgewogICAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICBzdHJlYW0uc2VyaWVfbmFtZSA9IHN0cmVhbS5zZXJpZV9uYW1lLnRvVXBwZXJDYXNlKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIGlmIChfdGhpczExLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMSkgewogICAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lID0gc3RyZWFtLnN0cmVhbV90dmdfbmFtZS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChfdGhpczExLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMikgewogICAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICBzdHJlYW0ubW92aWVfbmFtZSA9IHN0cmVhbS5tb3ZpZV9uYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKF90aGlzMTEuYWN0aXZlR3JvdXBUeXBlID09PSAzKSB7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5zZXJpZV9uYW1lID0gc3RyZWFtLnNlcmllX25hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgICBicmVhazsKICAgICAgfQoKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgICAgdGhpcy5jb252ZXJ0Q2FzZS5tb2RhbCA9IGZhbHNlOwogICAgfSwKICAgIGVkaXRHcm91cE1vZGFsOiBmdW5jdGlvbiBlZGl0R3JvdXBNb2RhbChzaG93KSB7CiAgICAgIHZhciBfdGhpczEyID0gdGhpczsKCiAgICAgIHZhciBpbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleChmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICByZXR1cm4gZ3JvdXAuaWQgPT09IF90aGlzMTIuYWN0aXZlR3JvdXBzWzBdOwogICAgICB9KTsKICAgICAgdmFyIGdyb3VwID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaW5kZXhdOwoKICAgICAgaWYgKGdyb3VwKSB7CiAgICAgICAgdGhpcy5ncm91cEVkaXRvci5pZCA9IHRoaXMuYWN0aXZlR3JvdXBzWzBdOwogICAgICAgIHRoaXMuZ3JvdXBFZGl0b3IuZ3JvdXBfdHlwZSA9IGdyb3VwLmdyb3VwX3R5cGU7CiAgICAgICAgdGhpcy5ncm91cEVkaXRvci5ncm91cF9uYW1lID0gZ3JvdXAuZ3JvdXBfbmFtZTsKICAgICAgICB0aGlzLmdyb3VwRWRpdG9yLmdyb3VwX2lzX2hpZGRlbiA9IGdyb3VwLmdyb3VwX2lzX2hpZGRlbjsKICAgICAgICB0aGlzLmdyb3VwRWRpdG9yLmdyb3VwX3BhcmVudF9jb2RlID0gZ3JvdXAuZ3JvdXBfcGFyZW50X2NvZGU7CiAgICAgICAgdGhpcy5ncm91cEVkaXRvci5tb2RhbCA9IHNob3c7CiAgICAgIH0KICAgIH0sCiAgICBlZGl0U3RyZWFtTW9kYWw6IGZ1bmN0aW9uIGVkaXRTdHJlYW1Nb2RhbChzaG93KSB7CiAgICAgIHZhciBfdGhpczEzID0gdGhpczsKCiAgICAgIHZhciBpbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5maW5kSW5kZXgoZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgIHJldHVybiBzdHJlYW0uaWQgPT09IF90aGlzMTMuYWN0aXZlU3RyZWFtc1swXTsKICAgICAgfSk7CiAgICAgIHZhciBzdHJlYW0gPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdOwoKICAgICAgaWYgKHN0cmVhbSkgewogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLmlkID0gdGhpcy5hY3RpdmVTdHJlYW1zWzBdOwogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV90dmdfbmFtZSA9IHN0cmVhbS5zdHJlYW1fdHZnX25hbWU7CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX3R2Z19pZCA9IHN0cmVhbS5zdHJlYW1fdHZnX2lkOwogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV90dmdfbG9nbyA9IHN0cmVhbS5zdHJlYW1fdHZnX2xvZ287CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX3BhcmVudF9jb2RlID0gc3RyZWFtLnN0cmVhbV9wYXJlbnRfY29kZTsKICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1fcmFkaW8gPSBzdHJlYW0uc3RyZWFtX3JhZGlvOwogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV9pc19oaWRkZW4gPSBzdHJlYW0uc3RyZWFtX2lzX2hpZGRlbjsKICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zb3VyY2Vfc3RyZWFtX3VybCA9IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX3VybDsKICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1faXNfY3VzdG9tID0gc3RyZWFtLnN0cmVhbV9pc19jdXN0b207CgogICAgICAgIGlmIChzdHJlYW0ubW92aWVfbmFtZSAhPT0gdW5kZWZpbmVkICYmIHN0cmVhbS5tb3ZpZV95ZWFyICE9PSB1bmRlZmluZWQgJiYgc3RyZWFtLnRtZGJfaWQgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3IubW92aWVfbmFtZSA9IHN0cmVhbS5tb3ZpZV9uYW1lOwogICAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3IubW92aWVfeWVhciA9IHN0cmVhbS5tb3ZpZV95ZWFyOwogICAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3IudG1kYl9pZCA9IHN0cmVhbS50bWRiX2lkOwogICAgICAgIH0KCiAgICAgICAgaWYgKHN0cmVhbS5zZXJpZV9uYW1lICE9PSB1bmRlZmluZWQgJiYgc3RyZWFtLnNlcmllX3NlYXNvbiAhPT0gdW5kZWZpbmVkICYmIHN0cmVhbS5zZXJpZV9lcGlzb2RlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnNlcmllX25hbWUgPSBzdHJlYW0uc2VyaWVfbmFtZTsKICAgICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnNlcmllX3NlYXNvbiA9IHN0cmVhbS5zZXJpZV9zZWFzb247CiAgICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zZXJpZV9lcGlzb2RlID0gc3RyZWFtLnNlcmllX2VwaXNvZGU7CiAgICAgICAgfQoKICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5tb2RhbCA9IHNob3c7CiAgICAgIH0KICAgIH0sCiAgICBlZGl0R3JvdXA6IGZ1bmN0aW9uIGVkaXRHcm91cCgpIHsKICAgICAgdmFyIF90aGlzMTQgPSB0aGlzOwoKICAgICAgdmFyIGluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KGZ1bmN0aW9uIChncm91cCkgewogICAgICAgIHJldHVybiBncm91cC5pZCA9PT0gX3RoaXMxNC5ncm91cEVkaXRvci5pZDsKICAgICAgfSk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2luZGV4XS5ncm91cF90eXBlID0gdGhpcy5ncm91cEVkaXRvci5ncm91cF90eXBlOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpbmRleF0uZ3JvdXBfbmFtZSA9IHRoaXMuZ3JvdXBFZGl0b3IuZ3JvdXBfbmFtZTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaW5kZXhdLmdyb3VwX2lzX2hpZGRlbiA9IHRoaXMuZ3JvdXBFZGl0b3IuZ3JvdXBfaXNfaGlkZGVuOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpbmRleF0uZ3JvdXBfcGFyZW50X2NvZGUgPSB0aGlzLmdyb3VwRWRpdG9yLmdyb3VwX3BhcmVudF9jb2RlOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpbmRleF0ubW9kaWZpZWQgPSB0cnVlOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgICB0aGlzLmdyb3VwRWRpdG9yLm1vZGFsID0gZmFsc2U7CiAgICB9LAogICAgZWRpdFN0cmVhbTogZnVuY3Rpb24gZWRpdFN0cmVhbSgpIHsKICAgICAgdmFyIF90aGlzMTUgPSB0aGlzOwoKICAgICAgdmFyIGluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmZpbmRJbmRleChmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAgICAgcmV0dXJuIHN0cmVhbS5pZCA9PT0gX3RoaXMxNS5hY3RpdmVTdHJlYW1zWzBdOwogICAgICB9KTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zdHJlYW1fdHZnX25hbWUgPSB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1fdHZnX25hbWU7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc3RyZWFtX3R2Z19pZCA9IHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV90dmdfaWQ7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc3RyZWFtX3R2Z19sb2dvID0gdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX3R2Z19sb2dvOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnN0cmVhbV9wYXJlbnRfY29kZSA9IHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV9wYXJlbnRfY29kZTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zdHJlYW1faXNfaGlkZGVuID0gdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX2lzX2hpZGRlbjsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zdHJlYW1fcmFkaW8gPSB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1fcmFkaW87CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc291cmNlX3N0cmVhbV91cmwgPSB0aGlzLnN0cmVhbUVkaXRvci5zb3VyY2Vfc3RyZWFtX3VybDsKCiAgICAgIGlmICh0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLm1vdmllX25hbWUgIT09IHVuZGVmaW5lZCAmJiB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLm1vdmllX3llYXIgIT09IHVuZGVmaW5lZCAmJiB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnRtZGJfaWQgIT09IHVuZGVmaW5lZCkgewogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0ubW92aWVfbmFtZSA9IHRoaXMuc3RyZWFtRWRpdG9yLm1vdmllX25hbWU7CiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5tb3ZpZV95ZWFyID0gdGhpcy5zdHJlYW1FZGl0b3IubW92aWVfeWVhcjsKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnRtZGJfaWQgPSB0aGlzLnN0cmVhbUVkaXRvci50bWRiX2lkOwogICAgICB9CgogICAgICBpZiAodGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zZXJpZV9uYW1lICE9PSB1bmRlZmluZWQgJiYgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zZXJpZV9zZWFzb24gIT09IHVuZGVmaW5lZCAmJiB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnNlcmllX2VwaXNvZGUgIT09IHVuZGVmaW5lZCkgewogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc2VyaWVfbmFtZSA9IHRoaXMuc3RyZWFtRWRpdG9yLnNlcmllX25hbWU7CiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zZXJpZV9zZWFzb24gPSB0aGlzLnN0cmVhbUVkaXRvci5zZXJpZV9zZWFzb247CiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zZXJpZV9lcGlzb2RlID0gdGhpcy5zdHJlYW1FZGl0b3Iuc2VyaWVfZXBpc29kZTsKICAgICAgfQoKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5tb2RpZmllZCA9IHRydWU7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLm1vZGFsID0gZmFsc2U7CiAgICB9LAogICAgc29ydEdyb3VwQWxwaGFVcDogZnVuY3Rpb24gc29ydEdyb3VwQWxwaGFVcCgpIHsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgcmV0dXJuIGIuZ3JvdXBfbmFtZSA+IGEuZ3JvdXBfbmFtZSA/IDEgOiBhLmdyb3VwX25hbWUgPiBiLmdyb3VwX25hbWUgPyAtMSA6IDA7CiAgICAgIH0pOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5tYXAoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgcmV0dXJuIGdyb3VwLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgfSk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICB9LAogICAgc29ydEdyb3VwQWxwaGFEb3duOiBmdW5jdGlvbiBzb3J0R3JvdXBBbHBoYURvd24oKSB7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHJldHVybiBhLmdyb3VwX25hbWUgPiBiLmdyb3VwX25hbWUgPyAxIDogYi5ncm91cF9uYW1lID4gYS5ncm91cF9uYW1lID8gLTEgOiAwOwogICAgICB9KTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMubWFwKGZ1bmN0aW9uIChncm91cCkgewogICAgICAgIHJldHVybiBncm91cC5tb2RpZmllZCA9IHRydWU7CiAgICAgIH0pOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgfSwKICAgIHNvcnRHcm91cFR5cGVVcDogZnVuY3Rpb24gc29ydEdyb3VwVHlwZVVwKCkgewogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3VwcyA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICByZXR1cm4gYi5ncm91cF90eXBlID4gYS5ncm91cF90eXBlID8gMSA6IGEuZ3JvdXBfdHlwZSA+IGIuZ3JvdXBfdHlwZSA/IC0xIDogMDsKICAgICAgfSk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLm1hcChmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICByZXR1cm4gZ3JvdXAubW9kaWZpZWQgPSB0cnVlOwogICAgICB9KTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgIH0sCiAgICBzb3J0R3JvdXBUeXBlRG93bjogZnVuY3Rpb24gc29ydEdyb3VwVHlwZURvd24oKSB7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHJldHVybiBhLmdyb3VwX3R5cGUgPiBiLmdyb3VwX3R5cGUgPyAxIDogYi5ncm91cF90eXBlID4gYS5ncm91cF90eXBlID8gLTEgOiAwOwogICAgICB9KTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMubWFwKGZ1bmN0aW9uIChncm91cCkgewogICAgICAgIHJldHVybiBncm91cC5tb2RpZmllZCA9IHRydWU7CiAgICAgIH0pOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgfSwKICAgIHNvcnRTdHJlYW1BbHBoYVVwOiBmdW5jdGlvbiBzb3J0U3RyZWFtQWxwaGFVcCgpIHsKICAgICAgdmFyIF90aGlzMTYgPSB0aGlzOwoKICAgICAgLy9FUk5TVCBISUVSCiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcyA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgc3dpdGNoIChfdGhpczE2LmFjdGl2ZUdyb3VwVHlwZSkgewogICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICByZXR1cm4gYi5zdHJlYW1fdHZnX25hbWUgPiBhLnN0cmVhbV90dmdfbmFtZSA/IDEgOiBhLnN0cmVhbV90dmdfbmFtZSA+IGIuc3RyZWFtX3R2Z19uYW1lID8gLTEgOiAwOwoKICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgcmV0dXJuIGIubW92aWVfbmFtZSA+IGEubW92aWVfbmFtZSA/IDEgOiBhLm1vdmllX25hbWUgPiBiLm1vdmllX25hbWUgPyAtMSA6IDA7CgogICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICByZXR1cm4gYi5zZXJpZV9uYW1lID4gYS5zZXJpZV9uYW1lID8gMSA6IGEuc2VyaWVfbmFtZSA+IGIuc2VyaWVfbmFtZSA/IC0xIDogMDsKICAgICAgICB9CiAgICAgIH0pOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubWFwKGZ1bmN0aW9uIChzdHJlYW0pIHsKICAgICAgICByZXR1cm4gc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgfSk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICB9LAogICAgc29ydFN0cmVhbUFscGhhRG93bjogZnVuY3Rpb24gc29ydFN0cmVhbUFscGhhRG93bigpIHsKICAgICAgdmFyIF90aGlzMTcgPSB0aGlzOwoKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICBzd2l0Y2ggKF90aGlzMTcuYWN0aXZlR3JvdXBUeXBlKSB7CiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIHJldHVybiBhLnN0cmVhbV90dmdfbmFtZSA+IGIuc3RyZWFtX3R2Z19uYW1lID8gMSA6IGIuc3RyZWFtX3R2Z19uYW1lID4gYS5zdHJlYW1fdHZnX25hbWUgPyAtMSA6IDA7CgogICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICByZXR1cm4gYS5tb3ZpZV9uYW1lID4gYi5tb3ZpZV9uYW1lID8gMSA6IGIubW92aWVfbmFtZSA+IGEubW92aWVfbmFtZSA/IC0xIDogMDsKCiAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgIHJldHVybiBhLnNlcmllX25hbWUgPiBiLnNlcmllX25hbWUgPyAxIDogYi5zZXJpZV9uYW1lID4gYS5zZXJpZV9uYW1lID8gLTEgOiAwOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5tYXAoZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgIHJldHVybiBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICB9KTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgIH0sCiAgICBzb3J0U3RyZWFtSGlkZGVuVXA6IGZ1bmN0aW9uIHNvcnRTdHJlYW1IaWRkZW5VcCgpIHsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICByZXR1cm4gYi5zdHJlYW1faXNfaGlkZGVuID4gYS5zdHJlYW1faXNfaGlkZGVuID8gMSA6IGEuc3RyZWFtX2lzX2hpZGRlbiA+IGIuc3RyZWFtX2lzX2hpZGRlbiA/IC0xIDogMDsKICAgICAgfSk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5tYXAoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgcmV0dXJuIGdyb3VwLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgfSk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICB9LAogICAgc29ydFN0cmVhbUhpZGRlbkRvd246IGZ1bmN0aW9uIHNvcnRTdHJlYW1IaWRkZW5Eb3duKCkgewogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMuc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHJldHVybiBhLnN0cmVhbV9pc19oaWRkZW4gPiBiLnN0cmVhbV9pc19oaWRkZW4gPyAxIDogYi5zdHJlYW1faXNfaGlkZGVuID4gYS5zdHJlYW1faXNfaGlkZGVuID8gLTEgOiAwOwogICAgICB9KTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLm1hcChmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICByZXR1cm4gZ3JvdXAubW9kaWZpZWQgPSB0cnVlOwogICAgICB9KTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgIH0sCiAgICBhZGRHcm91cDogZnVuY3Rpb24gYWRkR3JvdXAoKSB7CiAgICAgIHZhciBfdGhpczE4ID0gdGhpczsKCiAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UucG9zdCgiZWRpdG9yL2FkZC1ncm91cCIsIHsKICAgICAgICBwbGF5bGlzdF9pZDogdGhpcy5wbGF5bGlzdEVkaXRvci5pZAogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICBfdGhpczE4LmlzTG9hZGluZyA9IGZhbHNlOwoKICAgICAgICBpZiAocmVzLnN0YXR1cyA9PT0gdHJ1ZSAmJiByZXMuZGF0YSkgewogICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgICAgICAgIF90aGlzMTgucGxheWxpc3RFZGl0b3IuZ3JvdXBzLnB1c2gocmVzLmRhdGEpOwoKICAgICAgICAgICAgX3RoaXMxOC5hY3RpdmVHcm91cCA9IF90aGlzMTgucGxheWxpc3RFZGl0b3IuZ3JvdXBzW190aGlzMTgucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmxlbmd0aCAtIDFdLmlkOwogICAgICAgICAgICBfdGhpczE4LmFjdGl2ZUdyb3VwcyA9IFtfdGhpczE4LnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tfdGhpczE4LnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5sZW5ndGggLSAxXS5pZF07CiAgICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgICBfdGhpczE4LmVkaXRHcm91cE1vZGFsKHRydWUpOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMxOC5pc0xvYWRpbmcgPSBmYWxzZTsKCiAgICAgICAgX3RoaXMxOC4kbm90aWZ5KCJlcnJvciIsIF90aGlzMTguJHQoInByb2ZpbGUuZmFpbGVkIiksIF90aGlzMTguJHQoImVkaXRvci5hZGQtZ3JvdXAtZXJyb3IiKSwgImxhLXVzZXItc2hpZWxkIiwgewogICAgICAgICAgZHVyYXRpb246IDUwMDAsCiAgICAgICAgICBwZXJtYW5lbnQ6IGZhbHNlCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSwKICAgIGFkZFN0cmVhbTogZnVuY3Rpb24gYWRkU3RyZWFtKCkgewogICAgICB2YXIgX3RoaXMxOSA9IHRoaXM7CgogICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGh0dHBTZXJ2aWNlLnBvc3QoImVkaXRvci9hZGQtc3RyZWFtIiwgewogICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgIGdyb3VwX2lkOiB0aGlzLmdldEdyb3VwV2l0aElkKHRoaXMuYWN0aXZlR3JvdXApLmlkLAogICAgICAgIHN0cmVhbV90eXBlOiB0aGlzLmdldEdyb3VwV2l0aElkKHRoaXMuYWN0aXZlR3JvdXApLmdyb3VwX3R5cGUKICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgX3RoaXMxOS5pc0xvYWRpbmcgPSBmYWxzZTsKCiAgICAgICAgaWYgKHJlcy5zdGF0dXMgPT09IHRydWUgJiYgcmVzLmRhdGEpIHsKICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkgewogICAgICAgICAgICBfdGhpczE5LnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMudW5zaGlmdChyZXMuZGF0YSk7CgogICAgICAgICAgICBfdGhpczE5LmFjdGl2ZVN0cmVhbSA9IF90aGlzMTkucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tfdGhpczE5LnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoIC0gMV0uaWQ7CiAgICAgICAgICAgIF90aGlzMTkuYWN0aXZlU3RyZWFtcyA9IFtfdGhpczE5LnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbX3RoaXMxOS5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aCAtIDFdLmlkXTsKICAgICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIF90aGlzMTkuZWRpdFN0cmVhbU1vZGFsKHRydWUpOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMxOS5pc0xvYWRpbmcgPSBmYWxzZTsKCiAgICAgICAgX3RoaXMxOS4kbm90aWZ5KCJlcnJvciIsIF90aGlzMTkuJHQoInByb2ZpbGUuZmFpbGVkIiksIF90aGlzMTkuJHQoImVkaXRvci5hZGQtc3RyZWFtLWVycm9yIiksICJsYS11c2VyLXNoaWVsZCIsIHsKICAgICAgICAgIGR1cmF0aW9uOiA1MDAwLAogICAgICAgICAgcGVybWFuZW50OiBmYWxzZQogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0sCiAgICBsb2FkU3RyZWFtczogZnVuY3Rpb24gbG9hZFN0cmVhbXMoKSB7CiAgICAgIHZhciBfdGhpczIwID0gdGhpczsKCiAgICAgIHRoaXMuYWN0aXZlU3RyZWFtID0gLTE7CiAgICAgIHRoaXMuYWN0aXZlU3RyZWFtcyA9IFtdOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMgPSBbXTsKICAgICAgdmFyIGluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KGZ1bmN0aW9uIChncm91cCkgewogICAgICAgIHJldHVybiBncm91cC5pZCA9PT0gX3RoaXMyMC5hY3RpdmVHcm91cDsKICAgICAgfSk7CiAgICAgIHZhciBncm91cCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2luZGV4XTsKICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZS5nZXQoImVkaXRvci9zdHJlYW1zLyIuY29uY2F0KHRoaXMucGxheWxpc3RFZGl0b3IuaWQsICIvIikuY29uY2F0KGdyb3VwLmlkLCAiLyIpLmNvbmNhdChncm91cC5ncm91cF90eXBlKSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgZG9jdW1lbnQuYm9keS5zY3JvbGxUb3AgPSAwOwogICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3AgPSAwOwoKICAgICAgICBpZiAocmVzLnN0YXR1cyA9PT0gdHJ1ZSkgewogICAgICAgICAgdmFyIHN0cmVhbXMgPSByZXMuZGF0YS5tYXAoZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgICAgICB2YXIgc3RyID0gT2JqZWN0LmFzc2lnbih7fSwgc3RyZWFtKTsKICAgICAgICAgICAgc3RyLnNvdXJjZV9zdHJlYW1fdHZnX25hbWUgPSBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lOwogICAgICAgICAgICBzdHIuc291cmNlX3N0cmVhbV90dmdfaWQgPSBzdHJlYW0uc3RyZWFtX3R2Z19pZDsKICAgICAgICAgICAgc3RyLnNvdXJjZV9zdHJlYW1fdHZnX2xvZ28gPSBzdHJlYW0uc3RyZWFtX3R2Z19sb2dvOwogICAgICAgICAgICBzdHIuc291cmNlX3N0cmVhbV90dmdfY2hubyA9IHN0cmVhbS5zdHJlYW1fdHZnX2Nobm87CiAgICAgICAgICAgIHN0ci5zb3VyY2Vfc3RyZWFtX3R2Z19zaGlmdCA9IHN0cmVhbS5zdHJlYW1fdHZnX3NoaWZ0OwogICAgICAgICAgICBzdHIuc291cmNlX3N0cmVhbV9wYXJlbnRfY29kZSA9IHN0cmVhbS5zdHJlYW1fcGFyZW50X2NvZGU7CiAgICAgICAgICAgIHN0ci5zb3VyY2Vfc3RyZWFtX2F1ZGlvX3RyYWNrID0gc3RyZWFtLnN0cmVhbV9hdWRpb190cmFjazsKICAgICAgICAgICAgc3RyLnNvdXJjZV9zdHJlYW1fYXNwZWN0X3JhdGlvID0gc3RyZWFtLnN0cmVhbV9hc3BlY3RfcmF0aW87CiAgICAgICAgICAgIHN0ci5zb3VyY2Vfc3RyZWFtX3JhZGlvID0gc3RyZWFtLnN0cmVhbV9yYWRpbzsKICAgICAgICAgICAgc3RyLnNvdXJjZV9zdHJlYW1fb3JkZXIgPSBzdHJlYW0uc3RyZWFtX29yZGVyOwogICAgICAgICAgICBzdHIuc291cmNlX3N0cmVhbV9pc19oaWRkZW4gPSBzdHJlYW0uc3RyZWFtX2lzX2hpZGRlbjsKICAgICAgICAgICAgc3RyLm1vZGlmaWVkID0gZmFsc2U7CiAgICAgICAgICAgIHN0ci5zdHJlYW1faXNfcmVtb3ZlZCA9IDA7CgogICAgICAgICAgICBpZiAoZ3JvdXAuZ3JvdXBfdHlwZSA9PSAyKSB7CiAgICAgICAgICAgICAgaWYgKHN0ci5tb3ZpZV9uYW1lID09ICIiKSB7CiAgICAgICAgICAgICAgICBzdHIubW92aWVfbmFtZSA9IHN0ci5zdHJlYW1fdHZnX25hbWU7CiAgICAgICAgICAgICAgICBzdHIuc291cmNlX21vdmllX25hbWUgPSBzdHIuc3RyZWFtX3R2Z19uYW1lOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBzdHIuc291cmNlX21vdmllX25hbWUgPSBzdHJlYW0ubW92aWVfbmFtZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHN0ci5zb3VyY2VfbW92aWVfeWVhciA9IHN0cmVhbS5tb3ZpZV95ZWFyOwogICAgICAgICAgICAgIHN0ci5zb3VyY2VfdG1kYl9pZCA9IHN0cmVhbS50bWRiX2lkOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZ3JvdXAuZ3JvdXBfdHlwZSA9PSAzKSB7CiAgICAgICAgICAgICAgaWYgKHN0ci5zZXJpZV9uYW1lID09ICIiKSB7CiAgICAgICAgICAgICAgICBzdHIuc2VyaWVfbmFtZSA9IHN0ci5zdHJlYW1fdHZnX25hbWU7CiAgICAgICAgICAgICAgICBzdHIuc291cmNlX3NlcmllX25hbWUgPSBzdHIuc3RyZWFtX3R2Z19uYW1lOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBzdHIuc291cmNlX3NlcmllX25hbWUgPSBzdHJlYW0uc2VyaWVfbmFtZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHN0ci5zb3VyY2Vfc2VyaWVfc2Vhc29uID0gc3RyZWFtLnNlcmllX3NlYXNvbjsKICAgICAgICAgICAgICBzdHIuc291cmNlX3NlcmllX2VwaXNvZGUgPSBzdHJlYW0uc2VyaWVfZXBpc29kZTsKICAgICAgICAgICAgICBzdHIuc291cmNlX3RtZGJfaWQgPSBzdHJlYW0udG1kYl9pZDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHN0cjsKICAgICAgICAgIH0pOwogICAgICAgICAgc3RyZWFtcy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICAgIHJldHVybiBhLnNvdXJjZV9zdHJlYW1fb3JkZXIgPiBiLnNvdXJjZV9zdHJlYW1fb3JkZXIgPyAxIDogYi5zb3VyY2Vfc3RyZWFtX29yZGVyID4gYS5zb3VyY2Vfc3RyZWFtX29yZGVyID8gLTEgOiAwOwogICAgICAgICAgfSk7CiAgICAgICAgICBfdGhpczIwLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMgPSBzdHJlYW1zOwogICAgICAgICAgX3RoaXMyMC5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgX3RoaXMyMC5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczIwLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9KTsKICAgIH0sCiAgICBtb3ZlVG9TZWxlY3RlZEdyb3VwOiBmdW5jdGlvbiBtb3ZlVG9TZWxlY3RlZEdyb3VwKCkgewogICAgICB2YXIgX3RoaXMyMSA9IHRoaXM7CgogICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIHZhciBzdHJlYW1zID0gdGhpcy5hY3RpdmVTdHJlYW1zLmpvaW4oKTsKICAgICAgdmFyIGluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KGZ1bmN0aW9uIChncm91cCkgewogICAgICAgIHJldHVybiBncm91cC5pZCA9PSBfdGhpczIxLmFjdGl2ZUdyb3VwOwogICAgICB9KTsKICAgICAgaHR0cFNlcnZpY2UucG9zdCgiZWRpdG9yL21vdmUtdG8tZ3JvdXAvIi5jb25jYXQodGhpcy5hY3RpdmVHcm91cFR5cGUpLCB7CiAgICAgICAgcGxheWxpc3RfaWQ6IHRoaXMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgc3RyZWFtczogc3RyZWFtcywKICAgICAgICBncm91cF9pZDogdGhpcy5hY3RpdmVHcm91cHNbMF0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgX3RoaXMyMS5pc0xvYWRpbmcgPSBmYWxzZTsKCiAgICAgICAgaWYgKHJlcy5zdGF0dXMgJiYgcmVzLmRhdGEpIHsKICAgICAgICAgIF90aGlzMjEubG9hZFBsYXlsaXN0KF90aGlzMjEucGxheWxpc3RFZGl0b3IuaWQsIGluZGV4KTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczIxLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9KTsKICAgIH0sCiAgICBzYXZlQ2hhbmdlc01vZGFsOiBmdW5jdGlvbiBzYXZlQ2hhbmdlc01vZGFsKHNob3cpIHsKICAgICAgdmFyIHNhdmUgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IGZhbHNlOwogICAgICB0aGlzLnNhdmVDaGFuZ2VzLm1vZGFsID0gc2hvdzsKCiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgdGhpcy5kb1NhdmUoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmxvYWRTdHJlYW1zKCk7CiAgICAgIH0KICAgIH0sCiAgICByYWRpb0Jyb3dzZXJNb2RhbDogZnVuY3Rpb24gcmFkaW9Ccm93c2VyTW9kYWwoc2hvdykgewogICAgICB2YXIgX3RoaXMyMiA9IHRoaXM7CgogICAgICB2YXIgc2F2ZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogZmFsc2U7CgogICAgICBpZiAoc2hvdykgewogICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLnNlYXJjaCA9ICIiOwogICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLnJlc3VsdHMgPSBbXTsKICAgICAgICB0aGlzLnJhZGlvQnJvd3Nlci5hY3RpdmUgPSBbXTsKICAgICAgfQoKICAgICAgaWYgKHNhdmUpIHsKICAgICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7CiAgICAgICAgdmFyIGdyb3VwSW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgICByZXR1cm4gZ3JvdXAuaWQgPT0gX3RoaXMyMi5hY3RpdmVHcm91cDsKICAgICAgICB9KTsKICAgICAgICB2YXIgb3JkZXIgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOwogICAgICAgIHZhciBzdHJlYW1zID0gdGhpcy5yYWRpb0Jyb3dzZXIuYWN0aXZlLm1hcChmdW5jdGlvbiAoaW5kZXgpIHsKICAgICAgICAgIHZhciByYWRpbyA9IF90aGlzMjIucmFkaW9Ccm93c2VyLnJlc3VsdHNbaW5kZXhdOwogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgc291cmNlX3N0cmVhbV91cmw6IHJhZGlvLnVybCwKICAgICAgICAgICAgc3RyZWFtX3R2Z19uYW1lOiByYWRpby5uYW1lLAogICAgICAgICAgICBzdHJlYW1fdHZnX2lkOiAiIiwKICAgICAgICAgICAgc3RyZWFtX3R2Z19sb2dvOiByYWRpby5mYXZpY29uLAogICAgICAgICAgICBzdHJlYW1fcmFkaW86IHRydWUsCiAgICAgICAgICAgIHN0cmVhbV9vcmRlcjogb3JkZXIrKwogICAgICAgICAgfTsKICAgICAgICB9KTsKICAgICAgICBodHRwU2VydmljZS5wb3N0KCJlZGl0b3IvYWRkLXN0cmVhbXMvIi5jb25jYXQodGhpcy5hY3RpdmVHcm91cFR5cGUpLCB7CiAgICAgICAgICBwbGF5bGlzdF9pZDogdGhpcy5wbGF5bGlzdEVkaXRvci5pZCwKICAgICAgICAgIGdyb3VwX2lkOiB0aGlzLmdldEdyb3VwV2l0aElkKHRoaXMuYWN0aXZlR3JvdXApLmlkLAogICAgICAgICAgc3RyZWFtczogc3RyZWFtcwogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgICAgX3RoaXMyMi5pc0xvYWRpbmcgPSBmYWxzZTsKCiAgICAgICAgICBpZiAocmVzLnN0YXR1cykgewogICAgICAgICAgICBfdGhpczIyLmxvYWRQbGF5bGlzdChfdGhpczIyLnBsYXlsaXN0RWRpdG9yLmlkLCBncm91cEluZGV4KTsKICAgICAgICAgIH0KICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBfdGhpczIyLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0pOwogICAgICB9CgogICAgICB0aGlzLnJhZGlvQnJvd3Nlci5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgZmluZFJhZGlvYnJvd3NlcjogZnVuY3Rpb24gZmluZFJhZGlvYnJvd3NlcihzZWFyY2gpIHsKICAgICAgdmFyIF90aGlzMjMgPSB0aGlzOwoKICAgICAgaWYgKHNlYXJjaC5sZW5ndGggPT09IDApIHsKICAgICAgICB0aGlzLnJhZGlvQnJvd3Nlci5yZXN1bHRzID0gW107CiAgICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuYWN0aXZlID0gW107CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgICBodHRwU2VydmljZS5wb3N0KCJlZGl0b3IvZmluZC1yYWRpb2Jyb3dzZXIiLCB7CiAgICAgICAgICBzZWFyY2g6IHNlYXJjaAogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgICAgX3RoaXMyMy5yYWRpb0Jyb3dzZXIuYWN0aXZlID0gW107CgogICAgICAgICAgaWYgKHJlcy5zdGF0dXMpIHsKICAgICAgICAgICAgX3RoaXMyMy5yYWRpb0Jyb3dzZXIucmVzdWx0cyA9IHJlcy5kYXRhOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgX3RoaXMyMy5yYWRpb0Jyb3dzZXIucmVzdWx0cyA9IFtdOwogICAgICAgICAgfQoKICAgICAgICAgIF90aGlzMjMucmFkaW9Ccm93c2VyLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIF90aGlzMjMucmFkaW9Ccm93c2VyLmFjdGl2ZSA9IFtdOwogICAgICAgICAgX3RoaXMyMy5yYWRpb0Jyb3dzZXIucmVzdWx0cyA9IFtdOwogICAgICAgICAgX3RoaXMyMy5yYWRpb0Jyb3dzZXIuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBzb3VuZGNsb3VkTW9kYWw6IGZ1bmN0aW9uIHNvdW5kY2xvdWRNb2RhbChzaG93KSB7CiAgICAgIHZhciBfdGhpczI0ID0gdGhpczsKCiAgICAgIHZhciBzYXZlID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiBmYWxzZTsKCiAgICAgIGlmIChzaG93KSB7CiAgICAgICAgdGhpcy5zb3VuZGNsb3VkLnVybCA9ICIiOwogICAgICAgIHRoaXMuc291bmRjbG91ZC50cmFjayA9IG51bGw7CiAgICAgIH0KCiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgaWYgKHRoaXMuc291bmRjbG91ZC50cmFjaykgewogICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgdmFyIGdyb3VwSW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgICAgIHJldHVybiBncm91cC5pZCA9PSBfdGhpczI0LmFjdGl2ZUdyb3VwOwogICAgICAgICAgfSk7CiAgICAgICAgICB2YXIgb3JkZXIgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOwogICAgICAgICAgdmFyIHN0cmVhbXMgPSBbewogICAgICAgICAgICBzb3VyY2Vfc3RyZWFtX3VybDogdGhpcy5zb3VuZGNsb3VkLnVybCwKICAgICAgICAgICAgc3RyZWFtX3R2Z19uYW1lOiB0aGlzLnNvdW5kY2xvdWQudHJhY2sudGl0bGUsCiAgICAgICAgICAgIHN0cmVhbV90dmdfaWQ6ICIiLAogICAgICAgICAgICBzdHJlYW1fdHZnX2xvZ286IHRoaXMuc291bmRjbG91ZC50cmFjay5hcnR3b3JrX3VybC5yZXBsYWNlKCJsYXJnZS5qcGciLCAidDUwMHg1MDAuanBnIiksCiAgICAgICAgICAgIHN0cmVhbV9yYWRpbzogdHJ1ZSwKICAgICAgICAgICAgc3RyZWFtX29yZGVyOiBvcmRlcisrCiAgICAgICAgICB9XTsKICAgICAgICAgIGh0dHBTZXJ2aWNlLnBvc3QoImVkaXRvci9hZGQtc3RyZWFtcy8iLmNvbmNhdCh0aGlzLmFjdGl2ZUdyb3VwVHlwZSksIHsKICAgICAgICAgICAgcGxheWxpc3RfaWQ6IHRoaXMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICAgIGdyb3VwX2lkOiB0aGlzLmdldEdyb3VwV2l0aElkKHRoaXMuYWN0aXZlR3JvdXApLmlkLAogICAgICAgICAgICBzdHJlYW1zOiBzdHJlYW1zCiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICAgICAgX3RoaXMyNC5pc0xvYWRpbmcgPSBmYWxzZTsKCiAgICAgICAgICAgIGlmIChyZXMuc3RhdHVzKSB7CiAgICAgICAgICAgICAgX3RoaXMyNC5sb2FkUGxheWxpc3QoX3RoaXMyNC5wbGF5bGlzdEVkaXRvci5pZCwgZ3JvdXBJbmRleCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgX3RoaXMyNC5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5zb3VuZGNsb3VkLm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBnZXRTb3VuZGNsb3VkVHJhY2s6IGZ1bmN0aW9uIGdldFNvdW5kY2xvdWRUcmFjayh1cmwsIGNsaWVudF9pZCkgewogICAgICB2YXIgX3RoaXMyNSA9IHRoaXM7CgogICAgICBpZiAodXJsLmxlbmd0aCA9PT0gMCB8fCAhL3NvdW5kY2xvdWRcLmNvbS8udGVzdCh1cmwpKSB7CiAgICAgICAgdGhpcy5zb3VuZGNsb3VkLnVybCA9ICIiOwogICAgICAgIHRoaXMuc291bmRjbG91ZC50cmFjayA9IG51bGw7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zb3VuZGNsb3VkLmlzTG9hZGluZyA9IHRydWU7CiAgICAgICAgaHR0cFNlcnZpY2UucG9zdCgiZWRpdG9yL3NvdW5kY2xvdWQtdHJhY2siLCB7CiAgICAgICAgICB1cmw6IHVybCwKICAgICAgICAgIGNsaWVudF9pZDogY2xpZW50X2lkCiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICBpZiAocmVzLnN0YXR1cyAmJiBPYmplY3Qua2V5cyhyZXMuZGF0YSkubGVuZ3RoKSB7CiAgICAgICAgICAgIF90aGlzMjUuc291bmRjbG91ZC50cmFjayA9IHJlcy5kYXRhOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgX3RoaXMyNS5zb3VuZGNsb3VkLnRyYWNrID0gbnVsbDsKICAgICAgICAgIH0KCiAgICAgICAgICBfdGhpczI1LnNvdW5kY2xvdWQuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkgewogICAgICAgICAgX3RoaXMyNS5zb3VuZGNsb3VkLnRyYWNrID0gbnVsbDsKICAgICAgICAgIF90aGlzMjUuc291bmRjbG91ZC5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIHlvdXR1YmVNb2RhbDogZnVuY3Rpb24geW91dHViZU1vZGFsKHNob3cpIHsKICAgICAgdmFyIF90aGlzMjYgPSB0aGlzOwoKICAgICAgdmFyIHNhdmUgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IGZhbHNlOwoKICAgICAgaWYgKHNob3cpIHsKICAgICAgICB0aGlzLnlvdXR1YmUudXJsID0gIiI7CiAgICAgICAgdGhpcy55b3V0dWJlLnZpZGVvID0gbnVsbDsKICAgICAgICB0aGlzLnlvdXR1YmUuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgaWYgKHRoaXMueW91dHViZS52aWRlbykgewogICAgICAgICAgdGhpcy55b3V0dWJlLmlzTG9hZGluZyA9IHRydWU7CiAgICAgICAgICB2YXIgZ3JvdXBJbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleChmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICAgICAgcmV0dXJuIGdyb3VwLmlkID09IF90aGlzMjYuYWN0aXZlR3JvdXA7CiAgICAgICAgICB9KTsKICAgICAgICAgIHZhciBvcmRlciA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7CiAgICAgICAgICB2YXIgc3RyZWFtcyA9IFt7CiAgICAgICAgICAgIHNvdXJjZV9zdHJlYW1fdXJsOiB0aGlzLnlvdXR1YmUudXJsLAogICAgICAgICAgICBzdHJlYW1fdHZnX25hbWU6IHRoaXMueW91dHViZS52aWRlby52aWRlb0RldGFpbHMudGl0bGUsCiAgICAgICAgICAgIHN0cmVhbV90dmdfaWQ6ICIiLAogICAgICAgICAgICBzdHJlYW1fdHZnX2xvZ286ICJodHRwOi8vaS55dGltZy5jb20vdmkvIi5jb25jYXQodGhpcy55b3V0dWJlLnZpZGVvSWQsICIvbWF4cmVzZGVmYXVsdC5qcGciKSwKICAgICAgICAgICAgc3RyZWFtX29yZGVyOiBvcmRlcisrCiAgICAgICAgICB9XTsKICAgICAgICAgIGh0dHBTZXJ2aWNlLnBvc3QoImVkaXRvci9hZGQtc3RyZWFtcy8iLmNvbmNhdCh0aGlzLmFjdGl2ZUdyb3VwVHlwZSksIHsKICAgICAgICAgICAgcGxheWxpc3RfaWQ6IHRoaXMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICAgIGdyb3VwX2lkOiB0aGlzLmdldEdyb3VwV2l0aElkKHRoaXMuYWN0aXZlR3JvdXApLmlkLAogICAgICAgICAgICBzdHJlYW1zOiBzdHJlYW1zCiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICAgICAgX3RoaXMyNi55b3V0dWJlLmlzTG9hZGluZyA9IGZhbHNlOwoKICAgICAgICAgICAgaWYgKHJlcy5zdGF0dXMpIHsKICAgICAgICAgICAgICBfdGhpczI2LmxvYWRQbGF5bGlzdChfdGhpczI2LnBsYXlsaXN0RWRpdG9yLmlkLCBncm91cEluZGV4KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkgewogICAgICAgICAgICBfdGhpczI2LnlvdXR1YmUuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMueW91dHViZS5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgZ2V0WW91dHViZVBhZ2U6IGZ1bmN0aW9uIGdldFlvdXR1YmVQYWdlKHZpZGVvSWQpIHsKICAgICAgdmFyIF90aGlzMjcgPSB0aGlzOwoKICAgICAgdGhpcy55b3V0dWJlLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGh0dHBTZXJ2aWNlLnBvc3QoImVkaXRvci95b3V0dWJlLXZpZGVvIiwgewogICAgICAgIHZpZGVvX2lkOiB2aWRlb0lkCiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgIGlmIChyZXMuc3RhdHVzICYmIE9iamVjdC5rZXlzKHJlcy5kYXRhKS5sZW5ndGgpIHsKICAgICAgICAgIF90aGlzMjcueW91dHViZS52aWRlbyA9IHJlcy5kYXRhOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBfdGhpczI3LnlvdXR1YmUudmlkZW8gPSBudWxsOwogICAgICAgIH0KCiAgICAgICAgX3RoaXMyNy55b3V0dWJlLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMyNy55b3V0dWJlLnZpZGVvID0gbnVsbDsKICAgICAgICBfdGhpczI3LnlvdXR1YmUuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0pOwogICAgfSwKICAgIHZpbWVvTW9kYWw6IGZ1bmN0aW9uIHZpbWVvTW9kYWwoc2hvdykgewogICAgICB2YXIgX3RoaXMyOCA9IHRoaXM7CgogICAgICB2YXIgc2F2ZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogZmFsc2U7CgogICAgICBpZiAoc2hvdykgewogICAgICAgIHRoaXMudmltZW8udXJsID0gIiI7CiAgICAgICAgdGhpcy52aW1lby52aWRlbyA9IG51bGw7CiAgICAgICAgdGhpcy52aW1lby5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfQoKICAgICAgaWYgKHNhdmUpIHsKICAgICAgICBpZiAodGhpcy52aW1lby52aWRlbykgewogICAgICAgICAgdGhpcy52aW1lby5pc0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgdmFyIGdyb3VwSW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgICAgIHJldHVybiBncm91cC5pZCA9PSBfdGhpczI4LmFjdGl2ZUdyb3VwOwogICAgICAgICAgfSk7CiAgICAgICAgICB2YXIgb3JkZXIgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOwogICAgICAgICAgdmFyIHN0cmVhbXMgPSBbewogICAgICAgICAgICBzb3VyY2Vfc3RyZWFtX3VybDogdGhpcy52aW1lby51cmwsCiAgICAgICAgICAgIHN0cmVhbV90dmdfbmFtZTogdGhpcy52aW1lby52aWRlby52aWRlby50aXRsZSwKICAgICAgICAgICAgc3RyZWFtX3R2Z19pZDogIiIsCiAgICAgICAgICAgIHN0cmVhbV90dmdfbG9nbzogdGhpcy52aW1lby52aWRlby52aWRlby50aHVtYnMuYmFzZSwKICAgICAgICAgICAgc3RyZWFtX29yZGVyOiBvcmRlcisrCiAgICAgICAgICB9XTsKICAgICAgICAgIGh0dHBTZXJ2aWNlLnBvc3QoImVkaXRvci9hZGQtc3RyZWFtcy8iLmNvbmNhdCh0aGlzLmFjdGl2ZUdyb3VwVHlwZSksIHsKICAgICAgICAgICAgcGxheWxpc3RfaWQ6IHRoaXMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICAgIGdyb3VwX2lkOiB0aGlzLmdldEdyb3VwV2l0aElkKHRoaXMuYWN0aXZlR3JvdXApLmlkLAogICAgICAgICAgICBzdHJlYW1zOiBzdHJlYW1zCiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICAgICAgX3RoaXMyOC52aW1lby5pc0xvYWRpbmcgPSBmYWxzZTsKCiAgICAgICAgICAgIGlmIChyZXMuc3RhdHVzKSB7CiAgICAgICAgICAgICAgX3RoaXMyOC5sb2FkUGxheWxpc3QoX3RoaXMyOC5wbGF5bGlzdEVkaXRvci5pZCwgZ3JvdXBJbmRleCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgX3RoaXMyOC52aW1lby5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy52aW1lby5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgZ2V0VmltZW9Db25maWc6IGZ1bmN0aW9uIGdldFZpbWVvQ29uZmlnKHZpZGVvSWQpIHsKICAgICAgdmFyIF90aGlzMjkgPSB0aGlzOwoKICAgICAgdGhpcy52aW1lby5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZS5wb3N0KCJlZGl0b3IvdmltZW8tdmlkZW8iLCB7CiAgICAgICAgdmlkZW9faWQ6IHZpZGVvSWQKICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgX3RoaXMyOS52aW1lby52aWRlbyA9IHJlcy5kYXRhOwogICAgICAgIF90aGlzMjkudmltZW8uaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0pOwogICAgfSwKICAgIGRhaWx5bW90aW9uTW9kYWw6IGZ1bmN0aW9uIGRhaWx5bW90aW9uTW9kYWwoc2hvdykgewogICAgICB2YXIgX3RoaXMzMCA9IHRoaXM7CgogICAgICB2YXIgc2F2ZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogZmFsc2U7CgogICAgICBpZiAoc2hvdykgewogICAgICAgIHRoaXMuZGFpbHltb3Rpb24udXJsID0gIiI7CiAgICAgICAgdGhpcy5kYWlseW1vdGlvbi52aWRlbyA9IG51bGw7CiAgICAgICAgdGhpcy5kYWlseW1vdGlvbi5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfQoKICAgICAgaWYgKHNhdmUpIHsKICAgICAgICBpZiAodGhpcy5kYWlseW1vdGlvbi52aWRlbykgewogICAgICAgICAgdGhpcy5kYWlseW1vdGlvbi5pc0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgdmFyIGdyb3VwSW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgICAgIHJldHVybiBncm91cC5pZCA9PSBfdGhpczMwLmFjdGl2ZUdyb3VwOwogICAgICAgICAgfSk7CiAgICAgICAgICB2YXIgb3JkZXIgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOwogICAgICAgICAgdmFyIHN0cmVhbXMgPSBbewogICAgICAgICAgICBzb3VyY2Vfc3RyZWFtX3VybDogdGhpcy5kYWlseW1vdGlvbi51cmwsCiAgICAgICAgICAgIHN0cmVhbV90dmdfbmFtZTogdGhpcy5kYWlseW1vdGlvbi52aWRlby50aXRsZSwKICAgICAgICAgICAgc3RyZWFtX3R2Z19pZDogIiIsCiAgICAgICAgICAgIHN0cmVhbV90dmdfbG9nbzogdGhpcy5kYWlseW1vdGlvbi52aWRlby50aHVtYm5haWxfMTA4MF91cmwsCiAgICAgICAgICAgIHN0cmVhbV9vcmRlcjogb3JkZXIrKwogICAgICAgICAgfV07CiAgICAgICAgICBodHRwU2VydmljZS5wb3N0KCJlZGl0b3IvYWRkLXN0cmVhbXMvIi5jb25jYXQodGhpcy5hY3RpdmVHcm91cFR5cGUpLCB7CiAgICAgICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgICBncm91cF9pZDogdGhpcy5nZXRHcm91cFdpdGhJZCh0aGlzLmFjdGl2ZUdyb3VwKS5pZCwKICAgICAgICAgICAgc3RyZWFtczogc3RyZWFtcwogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICAgIF90aGlzMzAuZGFpbHltb3Rpb24uaXNMb2FkaW5nID0gZmFsc2U7CgogICAgICAgICAgICBpZiAocmVzLnN0YXR1cykgewogICAgICAgICAgICAgIF90aGlzMzAubG9hZFBsYXlsaXN0KF90aGlzMzAucGxheWxpc3RFZGl0b3IuaWQsIGdyb3VwSW5kZXgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIF90aGlzMzAuZGFpbHltb3Rpb24uaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuZGFpbHltb3Rpb24ubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGdldERhaWx5bW90aW9uQ29uZmlnOiBmdW5jdGlvbiBnZXREYWlseW1vdGlvbkNvbmZpZyh2aWRlb0lkKSB7CiAgICAgIHZhciBfdGhpczMxID0gdGhpczsKCiAgICAgIHRoaXMuZGFpbHltb3Rpb24uaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UucG9zdCgiZWRpdG9yL2RhaWx5bW90aW9uLXZpZGVvIiwgewogICAgICAgIHZpZGVvX2lkOiB2aWRlb0lkCiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgIF90aGlzMzEuZGFpbHltb3Rpb24udmlkZW8gPSByZXMuZGF0YTsKICAgICAgICBfdGhpczMxLmRhaWx5bW90aW9uLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9KTsKICAgIH0sCiAgICB0ZWRUYWxrc01vZGFsOiBmdW5jdGlvbiB0ZWRUYWxrc01vZGFsKHNob3cpIHsKICAgICAgdmFyIF90aGlzMzIgPSB0aGlzOwoKICAgICAgdmFyIHNhdmUgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IGZhbHNlOwoKICAgICAgaWYgKHNob3cpIHsKICAgICAgICB0aGlzLnRlZFRhbGtzLnVybCA9ICIiOwogICAgICAgIHRoaXMudGVkVGFsa3MudmlkZW8gPSBudWxsOwogICAgICAgIHRoaXMudGVkVGFsa3MuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgaWYgKHRoaXMudGVkVGFsa3MudmlkZW8pIHsKICAgICAgICAgIHRoaXMudGVkVGFsa3MuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgIHZhciBncm91cEluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KGZ1bmN0aW9uIChncm91cCkgewogICAgICAgICAgICByZXR1cm4gZ3JvdXAuaWQgPT0gX3RoaXMzMi5hY3RpdmVHcm91cDsKICAgICAgICAgIH0pOwogICAgICAgICAgdmFyIG9yZGVyID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsKICAgICAgICAgIHZhciBzdHJlYW1zID0gW3sKICAgICAgICAgICAgc291cmNlX3N0cmVhbV91cmw6IHRoaXMudGVkVGFsa3MudXJsLAogICAgICAgICAgICBzdHJlYW1fdHZnX25hbWU6IHRoaXMudGVkVGFsa3MudmlkZW8udGl0bGUsCiAgICAgICAgICAgIHN0cmVhbV90dmdfaWQ6ICIiLAogICAgICAgICAgICBzdHJlYW1fdHZnX2xvZ286IHRoaXMudGVkVGFsa3MudmlkZW8uaGVybywKICAgICAgICAgICAgc3RyZWFtX29yZGVyOiBvcmRlcisrCiAgICAgICAgICB9XTsKICAgICAgICAgIGh0dHBTZXJ2aWNlLnBvc3QoImVkaXRvci9hZGQtc3RyZWFtcy8iLmNvbmNhdCh0aGlzLmFjdGl2ZUdyb3VwVHlwZSksIHsKICAgICAgICAgICAgcGxheWxpc3RfaWQ6IHRoaXMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICAgIGdyb3VwX2lkOiB0aGlzLmdldEdyb3VwV2l0aElkKHRoaXMuYWN0aXZlR3JvdXApLmlkLAogICAgICAgICAgICBzdHJlYW1zOiBzdHJlYW1zCiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICAgICAgX3RoaXMzMi50ZWRUYWxrcy5pc0xvYWRpbmcgPSBmYWxzZTsKCiAgICAgICAgICAgIGlmIChyZXMuc3RhdHVzKSB7CiAgICAgICAgICAgICAgX3RoaXMzMi5sb2FkUGxheWxpc3QoX3RoaXMzMi5wbGF5bGlzdEVkaXRvci5pZCwgZ3JvdXBJbmRleCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgX3RoaXMzMi50ZWRUYWxrcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy50ZWRUYWxrcy5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgZ2V0VGVkVGFsa3NDb25maWc6IGZ1bmN0aW9uIGdldFRlZFRhbGtzQ29uZmlnKHVybCkgewogICAgICB2YXIgX3RoaXMzMyA9IHRoaXM7CgogICAgICB0aGlzLnRlZFRhbGtzLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGh0dHBTZXJ2aWNlLnBvc3QoImVkaXRvci90ZWQtdGFsa3MtdmlkZW8iLCB7CiAgICAgICAgdXJsOiB1cmwKICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgX3RoaXMzMy50ZWRUYWxrcy52aWRlbyA9IHJlcy5kYXRhLnRhbGtzLmxlbmd0aCA/IHJlcy5kYXRhLnRhbGtzWzBdIDogbnVsbDsKICAgICAgICBfdGhpczMzLnRlZFRhbGtzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9KTsKICAgIH0sCiAgICB4aGFtc3Rlck1vZGFsOiBmdW5jdGlvbiB4aGFtc3Rlck1vZGFsKHNob3cpIHsKICAgICAgdmFyIF90aGlzMzQgPSB0aGlzOwoKICAgICAgdmFyIHNhdmUgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IGZhbHNlOwoKICAgICAgaWYgKHNob3cpIHsKICAgICAgICB0aGlzLnhoYW1zdGVyLnVybCA9ICIiOwogICAgICAgIHRoaXMueGhhbXN0ZXIudmlkZW8gPSBudWxsOwogICAgICAgIHRoaXMueGhhbXN0ZXIuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgaWYgKHRoaXMueGhhbXN0ZXIudmlkZW8pIHsKICAgICAgICAgIHRoaXMueGhhbXN0ZXIuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgIHZhciBncm91cEluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KGZ1bmN0aW9uIChncm91cCkgewogICAgICAgICAgICByZXR1cm4gZ3JvdXAuaWQgPT0gX3RoaXMzNC5hY3RpdmVHcm91cDsKICAgICAgICAgIH0pOwogICAgICAgICAgdmFyIG9yZGVyID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsKICAgICAgICAgIHZhciBzdHJlYW1zID0gW3sKICAgICAgICAgICAgc291cmNlX3N0cmVhbV91cmw6IHRoaXMueGhhbXN0ZXIudXJsLAogICAgICAgICAgICBzdHJlYW1fdHZnX25hbWU6IHRoaXMueGhhbXN0ZXIudmlkZW8udmlkZW9FbnRpdHkudGl0bGUsCiAgICAgICAgICAgIHN0cmVhbV90dmdfaWQ6ICIiLAogICAgICAgICAgICBzdHJlYW1fdHZnX2xvZ286IHRoaXMueGhhbXN0ZXIudmlkZW8udmlkZW9FbnRpdHkudGh1bWJCaWcsCiAgICAgICAgICAgIHN0cmVhbV9vcmRlcjogb3JkZXIrKwogICAgICAgICAgfV07CiAgICAgICAgICBodHRwU2VydmljZS5wb3N0KCJlZGl0b3IvYWRkLXN0cmVhbXMvIi5jb25jYXQodGhpcy5hY3RpdmVHcm91cFR5cGUpLCB7CiAgICAgICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgICBncm91cF9pZDogdGhpcy5nZXRHcm91cFdpdGhJZCh0aGlzLmFjdGl2ZUdyb3VwKS5pZCwKICAgICAgICAgICAgc3RyZWFtczogc3RyZWFtcwogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICAgIF90aGlzMzQueGhhbXN0ZXIuaXNMb2FkaW5nID0gZmFsc2U7CgogICAgICAgICAgICBpZiAocmVzLnN0YXR1cykgewogICAgICAgICAgICAgIF90aGlzMzQubG9hZFBsYXlsaXN0KF90aGlzMzQucGxheWxpc3RFZGl0b3IuaWQsIGdyb3VwSW5kZXgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIF90aGlzMzQueGhhbXN0ZXIuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMueGhhbXN0ZXIubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGdldFhoYW1zdGVyQ29uZmlnOiBmdW5jdGlvbiBnZXRYaGFtc3RlckNvbmZpZyh1cmwpIHsKICAgICAgdmFyIF90aGlzMzUgPSB0aGlzOwoKICAgICAgdGhpcy54aGFtc3Rlci5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZS5wb3N0KCJlZGl0b3IveGhhbXN0ZXItdmlkZW8iLCB7CiAgICAgICAgdXJsOiB1cmwKICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgX3RoaXMzNS54aGFtc3Rlci52aWRlbyA9IHJlcy5kYXRhOwogICAgICAgIF90aGlzMzUueGhhbXN0ZXIuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0pOwogICAgfSwKICAgIGdyb3VwRG91YmxlQ2xpY2s6IGZ1bmN0aW9uIGdyb3VwRG91YmxlQ2xpY2soKSB7CiAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3Vwcy5sZW5ndGggPT09IDEpIHsKICAgICAgICB0aGlzLmVkaXRHcm91cE1vZGFsKHRydWUpOwogICAgICB9CiAgICB9LAogICAgc3RyZWFtRG91YmxlQ2xpY2s6IGZ1bmN0aW9uIHN0cmVhbURvdWJsZUNsaWNrKCkgewogICAgICBpZiAodGhpcy5hY3RpdmVTdHJlYW1zLmxlbmd0aCA9PT0gMSkgewogICAgICAgIHRoaXMuZWRpdFN0cmVhbU1vZGFsKHRydWUpOwogICAgICB9CiAgICB9LAogICAgbG9hZExvZ29Db3VudHJpZXM6IGZ1bmN0aW9uIGxvYWRMb2dvQ291bnRyaWVzKCkgewogICAgICB2YXIgX3RoaXMzNiA9IHRoaXM7CgogICAgICB0aGlzLmZpbmRMb2dvLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGh0dHBTZXJ2aWNlLmdldCgiZWRpdG9yL2xvZ28tY291bnRyaWVzIikudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgX3RoaXMzNi5maW5kTG9nby5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICBfdGhpczM2LmZpbmRMb2dvLmNvdW50cmllcyA9IHJlcy5kYXRhLm1hcChmdW5jdGlvbiAoY291bnRyeSkgewogICAgICAgICAgdmFyIGNuID0gX3RoaXMzNi5jb3VudHJpZXMuZmluZChmdW5jdGlvbiAoY250KSB7CiAgICAgICAgICAgIHJldHVybiBjbnQuY29kZS50b0xvd2VyQ2FzZSgpID09IGNvdW50cnkudG9Mb3dlckNhc2UoKTsKICAgICAgICAgIH0pOwoKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHRleHQ6IGNuID8gY24ubmFtZSA6IGNvdW50cnksCiAgICAgICAgICAgIHZhbHVlOiBjb3VudHJ5CiAgICAgICAgICB9OwogICAgICAgIH0pLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgIHJldHVybiBhLnRleHQudG9VcHBlckNhc2UoKSA8IGIudGV4dC50b1VwcGVyQ2FzZSgpID8gLTEgOiBhLnRleHQudG9VcHBlckNhc2UoKSA+IGIudGV4dC50b1VwcGVyQ2FzZSgpID8gMSA6IDA7CiAgICAgICAgfSk7CiAgICAgICAgX3RoaXMzNi5hc3NpZ25Mb2dvLmNvdW50cmllcyA9IF90b0NvbnN1bWFibGVBcnJheShfdGhpczM2LmZpbmRMb2dvLmNvdW50cmllcyk7CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczM2LmZpbmRMb2dvLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9KTsKICAgIH0sCiAgICBsb2FkVFZHSURDb3VudHJpZXM6IGZ1bmN0aW9uIGxvYWRUVkdJRENvdW50cmllcygpIHsKICAgICAgdmFyIF90aGlzMzcgPSB0aGlzOwoKICAgICAgdGhpcy5hc3NpZ25UVkdJRC5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZS5nZXQoImVkaXRvci90di1ndWlkZS1jb3VudHJpZXMiKS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICBfdGhpczM3LmFzc2lnblRWR0lELmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIF90aGlzMzcuYXNzaWduVFZHSUQuY291bnRyaWVzID0gcmVzLmRhdGEubWFwKGZ1bmN0aW9uIChjb3VudHJ5KSB7CiAgICAgICAgICB2YXIgY24gPSBfdGhpczM3LmNvdW50cmllcy5maW5kKGZ1bmN0aW9uIChjbnQpIHsKICAgICAgICAgICAgcmV0dXJuIGNudC5jb2RlLnRvTG93ZXJDYXNlKCkgPT0gY291bnRyeS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgfSk7CgogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgdGV4dDogY24gPyBjbi5uYW1lIDogY291bnRyeSwKICAgICAgICAgICAgdmFsdWU6IGNvdW50cnkKICAgICAgICAgIH07CiAgICAgICAgfSkuc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgcmV0dXJuIGEudGV4dC50b1VwcGVyQ2FzZSgpIDwgYi50ZXh0LnRvVXBwZXJDYXNlKCkgPyAtMSA6IGEudGV4dC50b1VwcGVyQ2FzZSgpID4gYi50ZXh0LnRvVXBwZXJDYXNlKCkgPyAxIDogMDsKICAgICAgICB9KTsKCiAgICAgICAgX3RoaXMzNy5hc3NpZ25UVkdJRC5jb3VudHJpZXMudW5zaGlmdCh7CiAgICAgICAgICB0ZXh0OiBfdGhpczM3LiR0KCJnZW5lcmFsLmFsbCIpLAogICAgICAgICAgdmFsdWU6ICJhbGwiCiAgICAgICAgfSk7CgogICAgICAgIF90aGlzMzcuZmluZFRWR0lELmNvdW50cmllcyA9IF90b0NvbnN1bWFibGVBcnJheShfdGhpczM3LmFzc2lnblRWR0lELmNvdW50cmllcyk7CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczM3LmFzc2lnblRWR0lELmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9KTsKICAgIH0sCiAgICBsb2FkTG9nb3NGaW5kOiBmdW5jdGlvbiBsb2FkTG9nb3NGaW5kKGNvdW50cnkpIHsKICAgICAgdmFyIF90aGlzMzggPSB0aGlzOwoKICAgICAgdGhpcy5maW5kTG9nby5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZS5nZXQoImVkaXRvci9sb2dvcy8iLmNvbmNhdChjb3VudHJ5KSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgX3RoaXMzOC5maW5kTG9nby5sb2dvID0gIiI7CiAgICAgICAgX3RoaXMzOC5maW5kTG9nby5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICBfdGhpczM4LmZpbmRMb2dvLmxvZ29zID0gcmVzLmRhdGEubWFwKGZ1bmN0aW9uIChsb2dvKSB7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICB0ZXh0OiBsb2dvLmxhYmVsLAogICAgICAgICAgICB2YWx1ZTogbG9nby5maWxlbmFtZQogICAgICAgICAgfTsKICAgICAgICB9KTsKICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzMzguZmluZExvZ28uaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0pOwogICAgfSwKICAgIGZpbmRMb2dvTW9kYWw6IGZ1bmN0aW9uIGZpbmRMb2dvTW9kYWwoc2hvdykgewogICAgICB2YXIgc2F2ZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogZmFsc2U7CiAgICAgIHZhciBzZWxlY3RlZCA9IHRoaXMuZ2V0U3RyZWFtV2l0aElkKHRoaXMuYWN0aXZlU3RyZWFtc1swXSk7CgogICAgICBpZiAoc2hvdykgewogICAgICAgIHRoaXMuZmluZExvZ28ubG9nbyA9ICIiOwogICAgICAgIHRoaXMuZmluZExvZ28udGl0bGUgPSBzZWxlY3RlZC5zdHJlYW1fdHZnX25hbWU7CiAgICAgIH0KCiAgICAgIHRoaXMuZmluZExvZ28uc2VhcmNoID0gIiI7CgogICAgICBpZiAoc2F2ZSkgewogICAgICAgIGlmIChzZWxlY3RlZCkgewogICAgICAgICAgc2VsZWN0ZWQuc3RyZWFtX3R2Z19sb2dvID0gImh0dHA6Ly9zdGF0aWMuaXB0di10b29scy5jb20vIi5jb25jYXQodGhpcy5maW5kTG9nby5jb3VudHJ5LCAiLyIpLmNvbmNhdCh0aGlzLmZpbmRMb2dvLmxvZ28pOwogICAgICAgICAgc2VsZWN0ZWQubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuZmluZExvZ28ubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGxvYWRMb2dvc0Fzc2lnbjogZnVuY3Rpb24gbG9hZExvZ29zQXNzaWduKGNvdW50cnkpIHsKICAgICAgdmFyIF90aGlzMzkgPSB0aGlzOwoKICAgICAgdGhpcy5hc3NpZ25Mb2dvLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGh0dHBTZXJ2aWNlLmdldCgiZWRpdG9yL2xvZ29zLyIuY29uY2F0KGNvdW50cnkpKS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICBfdGhpczM5LmFzc2lnbkxvZ28ubG9nbyA9ICIiOwogICAgICAgIF90aGlzMzkuYXNzaWduTG9nby5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICBfdGhpczM5LmFzc2lnbkxvZ28ubG9nb3MgPSByZXMuZGF0YS5tYXAoZnVuY3Rpb24gKGxvZ28pIHsKICAgICAgICAgIHJldHVybiBsb2dvLmZpbGVuYW1lOwogICAgICAgIH0pOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMzOS5hc3NpZ25Mb2dvLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9KTsKICAgIH0sCiAgICBhc3NpZ25Mb2dvTW9kYWw6IGZ1bmN0aW9uIGFzc2lnbkxvZ29Nb2RhbChzaG93KSB7CiAgICAgIHZhciBfdGhpczQwID0gdGhpczsKCiAgICAgIHZhciBzYXZlID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiBmYWxzZTsKCiAgICAgIGlmIChzaG93KSB7CiAgICAgICAgdGhpcy5hc3NpZ25Mb2dvLmxvZ28gPSAiIjsKICAgICAgfQoKICAgICAgaWYgKHNhdmUpIHsKICAgICAgICB2YXIgY2hhbmdlZCA9IGZhbHNlOwoKICAgICAgICB2YXIgc3RyaW5nU2ltaWxhcml0eSA9IHJlcXVpcmUoInN0cmluZy1zaW1pbGFyaXR5Iik7CgogICAgICAgIHZhciBzdHJlYW1zID0gW107CgogICAgICAgIGlmICh0aGlzLmFzc2lnbkxvZ28uYXNzaWduQWxsID09IDEpIHsKICAgICAgICAgIHN0cmVhbXMgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXM7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN0cmVhbXMgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMuZmlsdGVyKGZ1bmN0aW9uIChzdHJlYW0pIHsKICAgICAgICAgICAgcmV0dXJuICFzdHJlYW0uc3RyZWFtX3R2Z19sb2dvLmxlbmd0aDsKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgc3RyZWFtcy5tYXAoZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgICAgdmFyIG1hdGNoMSA9IHN0cmluZ1NpbWlsYXJpdHkuZmluZEJlc3RNYXRjaChTdHJpbmcoc3RyZWFtLnN0cmVhbV90dmdfbmFtZSkucmVwbGFjZSgvIGhkJC9pLCAiIiksIF90aGlzNDAuYXNzaWduTG9nby5sb2dvcykuYmVzdE1hdGNoOwogICAgICAgICAgdmFyIG1hdGNoMiA9IHN0cmluZ1NpbWlsYXJpdHkuZmluZEJlc3RNYXRjaChTdHJpbmcoc3RyZWFtLnN0cmVhbV90dmdfaWQpLCBfdGhpczQwLmFzc2lnbkxvZ28ubG9nb3MpLmJlc3RNYXRjaDsKCiAgICAgICAgICBpZiAobWF0Y2gxLnJhdGluZyA+PSAwLjMpIHsKICAgICAgICAgICAgY2hhbmdlZCA9IHRydWU7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX2xvZ28gPSAiaHR0cDovL3N0YXRpYy5pcHR2LXRvb2xzLmNvbS8iLmNvbmNhdChfdGhpczQwLmFzc2lnbkxvZ28uY291bnRyeSwgIi8iKS5jb25jYXQobWF0Y2gxLnRhcmdldCk7CiAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICB9IGVsc2UgaWYgKG1hdGNoMi5yYXRpbmcgPj0gMC41KSB7CiAgICAgICAgICAgIGNoYW5nZWQgPSB0cnVlOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19sb2dvID0gImh0dHA6Ly9zdGF0aWMuaXB0di10b29scy5jb20vIi5jb25jYXQoX3RoaXM0MC5hc3NpZ25Mb2dvLmNvdW50cnksICIvIikuY29uY2F0KG1hdGNoMi50YXJnZXQpOwogICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IGNoYW5nZWQ7CiAgICAgIH0KCiAgICAgIHRoaXMuYXNzaWduTG9nby5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgbG9hZFRWR0lEQXNzaWduOiBmdW5jdGlvbiBsb2FkVFZHSURBc3NpZ24oY291bnRyeSkgewogICAgICB2YXIgX3RoaXM0MSA9IHRoaXM7CgogICAgICB0aGlzLmFzc2lnblRWR0lELmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGh0dHBTZXJ2aWNlLmdldCgiZWRpdG9yL3R2LWd1aWRlLyIuY29uY2F0KGNvdW50cnkpKS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICBfdGhpczQxLmFzc2lnblRWR0lELmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIF90aGlzNDEuYXNzaWduVFZHSUQuY2hhbm5lbHMgPSByZXMuZGF0YTsKICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzNDEuYXNzaWduVFZHSUQuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0pOwogICAgfSwKICAgIGFzc2lnblRWR0lETW9kYWw6IGZ1bmN0aW9uIGFzc2lnblRWR0lETW9kYWwoc2hvdykgewogICAgICB2YXIgX3RoaXM0MiA9IHRoaXM7CgogICAgICB2YXIgc2F2ZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogZmFsc2U7CgogICAgICBpZiAoc2F2ZSkgewogICAgICAgIHZhciBjaGFuZ2VkID0gZmFsc2U7CgogICAgICAgIHZhciBzdHJpbmdTaW1pbGFyaXR5ID0gcmVxdWlyZSgic3RyaW5nLXNpbWlsYXJpdHkiKTsKCiAgICAgICAgdmFyIHN0cmVhbXMgPSBbXTsKCiAgICAgICAgaWYgKHRoaXMuYXNzaWduVFZHSUQuYXNzaWduQWxsID09IDEpIHsKICAgICAgICAgIHN0cmVhbXMgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXM7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN0cmVhbXMgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMuZmlsdGVyKGZ1bmN0aW9uIChzdHJlYW0pIHsKICAgICAgICAgICAgcmV0dXJuICFzdHJlYW0uc3RyZWFtX3R2Z19pZC5sZW5ndGggfHwgc3RyZWFtLnN0cmVhbV90dmdfaWQubGVuZ3RoID09IDA7CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIHZhciBjaGFubmVsTmFtZXMgPSB0aGlzLmFzc2lnblRWR0lELmNoYW5uZWxzLm1hcChmdW5jdGlvbiAoY2hhbm5lbCkgewogICAgICAgICAgcmV0dXJuIGNoYW5uZWwudHZnX25hbWU7CiAgICAgICAgfSk7CiAgICAgICAgdmFyIGNoYW5uZWxJZHMgPSB0aGlzLmFzc2lnblRWR0lELmNoYW5uZWxzLm1hcChmdW5jdGlvbiAoY2hhbm5lbCkgewogICAgICAgICAgcmV0dXJuIGNoYW5uZWwudHZnX2lkOwogICAgICAgIH0pOwogICAgICAgIHN0cmVhbXMubWFwKGZ1bmN0aW9uIChzdHJlYW0pIHsKICAgICAgICAgIHZhciBtYXRjaDEgPSBzdHJpbmdTaW1pbGFyaXR5LmZpbmRCZXN0TWF0Y2goU3RyaW5nKHN0cmVhbS5zdHJlYW1fdHZnX25hbWUpLCBjaGFubmVsTmFtZXMpLmJlc3RNYXRjaDsKICAgICAgICAgIHZhciBtYXRjaDIgPSBzdHJpbmdTaW1pbGFyaXR5LmZpbmRCZXN0TWF0Y2goU3RyaW5nKHN0cmVhbS5zdHJlYW1fdHZnX2lkKSwgY2hhbm5lbElkcykuYmVzdE1hdGNoOwogICAgICAgICAgdmFyIG1hdGNoMyA9IHN0cmluZ1NpbWlsYXJpdHkuZmluZEJlc3RNYXRjaChTdHJpbmcoc3RyZWFtLnN0cmVhbV90dmdfbmFtZSkucmVwbGFjZSgvIGhkJHwgZmhkJHwgaGV2YyR8IGgyNjUkfC9pLCAiIiksIGNoYW5uZWxOYW1lcykuYmVzdE1hdGNoOwoKICAgICAgICAgIGlmIChtYXRjaDIucmF0aW5nID49IDAuNzUpIHsKICAgICAgICAgICAgY2hhbmdlZCA9IHRydWU7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX2lkID0gbWF0Y2gyLnRhcmdldDsKICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgIH0gZWxzZSBpZiAobWF0Y2gxLnJhdGluZyA+PSAwLjc1KSB7CiAgICAgICAgICAgIGNoYW5nZWQgPSB0cnVlOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19pZCA9IF90aGlzNDIuYXNzaWduVFZHSUQuY2hhbm5lbHMuZmluZChmdW5jdGlvbiAoY2hhbm5lbCkgewogICAgICAgICAgICAgIHJldHVybiBjaGFubmVsLnR2Z19uYW1lID09PSBtYXRjaDEudGFyZ2V0OwogICAgICAgICAgICB9KS50dmdfaWQ7CiAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICB9IGVsc2UgaWYgKG1hdGNoMy5yYXRpbmcgPj0gMC43NSkgewogICAgICAgICAgICBjaGFuZ2VkID0gdHJ1ZTsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfaWQgPSBfdGhpczQyLmFzc2lnblRWR0lELmNoYW5uZWxzLmZpbmQoZnVuY3Rpb24gKGNoYW5uZWwpIHsKICAgICAgICAgICAgICByZXR1cm4gY2hhbm5lbC50dmdfbmFtZSA9PT0gbWF0Y2gxLnRhcmdldDsKICAgICAgICAgICAgfSkudHZnX2lkOwogICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY2hhbmdlZCA9IHRydWU7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX2lkID0gIiI7CiAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gY2hhbmdlZDsKICAgICAgfQoKICAgICAgdGhpcy5hc3NpZ25UVkdJRC5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgbG9hZFRWR0lERmluZDogZnVuY3Rpb24gbG9hZFRWR0lERmluZChjb3VudHJ5KSB7CiAgICAgIHZhciBfdGhpczQzID0gdGhpczsKCiAgICAgIHRoaXMuZmluZFRWR0lELmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGh0dHBTZXJ2aWNlLmdldCgiZWRpdG9yL3R2LWd1aWRlLyIuY29uY2F0KGNvdW50cnkpKS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICBfdGhpczQzLmZpbmRUVkdJRC5jaGFubmVsID0gIiI7CiAgICAgICAgX3RoaXM0My5maW5kVFZHSUQuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgX3RoaXM0My5maW5kVFZHSUQuY2hhbm5lbHMgPSByZXMuZGF0YS5tYXAoZnVuY3Rpb24gKGNoYW5uZWwpIHsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHRleHQ6IGNoYW5uZWwudHZnX25hbWUsCiAgICAgICAgICAgIHZhbHVlOiBjaGFubmVsLnR2Z19pZAogICAgICAgICAgfTsKICAgICAgICB9KTsKICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzNDMuZmluZFRWR0lELmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9KTsKICAgIH0sCiAgICBmaW5kVFZHSURNb2RhbDogZnVuY3Rpb24gZmluZFRWR0lETW9kYWwoc2hvdykgewogICAgICB2YXIgc2F2ZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogZmFsc2U7CiAgICAgIHZhciBzZWxlY3RlZCA9IHRoaXMuZ2V0U3RyZWFtV2l0aElkKHRoaXMuYWN0aXZlU3RyZWFtc1swXSk7CgogICAgICBpZiAoc2hvdykgewogICAgICAgIHRoaXMuZmluZFRWR0lELmNoYW5uZWwgPSAiIjsKICAgICAgICB0aGlzLmZpbmRUVkdJRC50aXRsZSA9IHNlbGVjdGVkLnN0cmVhbV90dmdfbmFtZTsKICAgICAgfQoKICAgICAgdGhpcy5maW5kVFZHSUQuc2VhcmNoID0gIiI7CgogICAgICBpZiAoc2F2ZSkgewogICAgICAgIGlmIChzZWxlY3RlZCkgewogICAgICAgICAgc2VsZWN0ZWQuc3RyZWFtX3R2Z19pZCA9IHRoaXMuZmluZFRWR0lELmNoYW5uZWw7CiAgICAgICAgICBzZWxlY3RlZC5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5maW5kVFZHSUQubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGltcG9ydE0zVU1vZGFsOiBmdW5jdGlvbiBpbXBvcnRNM1VNb2RhbChzaG93KSB7CiAgICAgIHZhciBfdGhpczQ0ID0gdGhpczsKCiAgICAgIHZhciBzYXZlID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiBmYWxzZTsKCiAgICAgIGlmIChzaG93KSB7CiAgICAgICAgdGhpcy5pbXBvcnRNM1UuZmlsZSA9IG51bGw7CiAgICAgICAgdGhpcy5pbXBvcnRNM1UubTN1ID0gbnVsbDsKICAgICAgICB0aGlzLmltcG9ydE0zVS5ncm91cHMgPSBbXTsKICAgICAgICB0aGlzLmltcG9ydE0zVS5pbXBvcnRHcm91cHMgPSBbXTsKICAgICAgfQoKICAgICAgaWYgKHNhdmUpIHsKICAgICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7CiAgICAgICAgdmFyIGdyb3VwSW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgICByZXR1cm4gZ3JvdXAuaWQgPT0gX3RoaXM0NC5hY3RpdmVHcm91cDsKICAgICAgICB9KTsKICAgICAgICBodHRwU2VydmljZS5wb3N0KCJlZGl0b3IvaW1wb3J0IiwgewogICAgICAgICAgcGxheWxpc3RfaWQ6IHRoaXMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICBpbXBvcnQ6IHRoaXMuaW1wb3J0TTNVLmdyb3Vwcy5maWx0ZXIoZnVuY3Rpb24gKGdyb3VwLCBpbmRleCkgewogICAgICAgICAgICByZXR1cm4gX3RoaXM0NC5pbXBvcnRNM1UuaW1wb3J0R3JvdXBzLmluY2x1ZGVzKGluZGV4KTsKICAgICAgICAgIH0pCiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICBfdGhpczQ0LmlzTG9hZGluZyA9IGZhbHNlOwoKICAgICAgICAgIGlmIChyZXMuc3RhdHVzKSB7CiAgICAgICAgICAgIF90aGlzNDQubG9hZFBsYXlsaXN0KF90aGlzNDQucGxheWxpc3RFZGl0b3IuaWQsIGdyb3VwSW5kZXgpOwogICAgICAgICAgfQogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIF90aGlzNDQuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHRoaXMuaW1wb3J0TTNVLm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICB1cGxvYWRNM1U6IGZ1bmN0aW9uIHVwbG9hZE0zVShldmVudCkgewogICAgICB2YXIgX3RoaXM0NSA9IHRoaXM7CgogICAgICB2YXIgaW5wdXQgPSBldmVudC50YXJnZXQ7CgogICAgICBpZiAoImZpbGVzIiBpbiBpbnB1dCAmJiBpbnB1dC5maWxlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgdGhpcy5pbXBvcnRNM1UuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgICB0aGlzLnJlYWRGaWxlQ29udGVudChpbnB1dC5maWxlc1swXSkudGhlbihmdW5jdGlvbiAoY29udGVudCkgewogICAgICAgICAgX3RoaXM0NS5pbXBvcnRNM1UuaXNMb2FkaW5nID0gZmFsc2U7CgogICAgICAgICAgX3RoaXM0NS5wYXJzZU0zVShjb250ZW50KTsKICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgICAgIF90aGlzNDUuJG5vdGlmeSgiZXJyb3IiLCBfdGhpczQ1LiR0KCJwcm9maWxlLmZhaWxlZCIpLCBlcnJvciwgImxhLXVzZXItc2hpZWxkIiwgewogICAgICAgICAgICBkdXJhdGlvbjogNTAwMCwKICAgICAgICAgICAgcGVybWFuZW50OiBmYWxzZQogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBwYXJzZU0zVTogZnVuY3Rpb24gcGFyc2VNM1UoY29udGVudCkgewogICAgICB2YXIgX3RoaXM0NiA9IHRoaXM7CgogICAgICB2YXIgdm0gPSB0aGlzOwogICAgICB2bS5pbXBvcnRNM1UuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgbTN1LnBhcnNlKGNvbnRlbnQsIHsKICAgICAgICB0YWc6ICJuYW1lIiwKICAgICAgICB0eXBlOiBbIk1vdmllIiwgIlNlcmllcyIsICJWT0QiLCAiTGl2ZSJdCiAgICAgIH0sIHRydWUpLnRoZW4oZnVuY3Rpb24gKHBsYXlsaXN0KSB7CiAgICAgICAgX3RoaXM0Ni5pbXBvcnRNM1UubTN1ID0gcGxheWxpc3Q7CiAgICAgICAgX3RoaXM0Ni5pbXBvcnRNM1UuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgX3RoaXM0Ni5pbXBvcnRNM1UuZ3JvdXBzID0gcGxheWxpc3QuZ3JvdXBzOwogICAgICAgIF90aGlzNDYuaW1wb3J0TTNVLmltcG9ydEdyb3VwcyA9IFtdOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgICB2bS5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICB2bS4kbm90aWZ5KCJlcnJvciIsIHZtLiR0KCJwcm9maWxlLmZhaWxlZCIpLCBlcnJvciwgImxhLXVzZXItc2hpZWxkIiwgewogICAgICAgICAgZHVyYXRpb246IDUwMDAsCiAgICAgICAgICBwZXJtYW5lbnQ6IGZhbHNlCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSwKICAgIHJlYWRGaWxlQ29udGVudDogZnVuY3Rpb24gcmVhZEZpbGVDb250ZW50KGZpbGUpIHsKICAgICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgcmV0dXJuIHJlc29sdmUoZXZlbnQudGFyZ2V0LnJlc3VsdCk7CiAgICAgICAgfTsKCiAgICAgICAgcmVhZGVyLm9uZXJyb3IgPSBmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgICAgIHJldHVybiByZWplY3QoZXJyb3IpOwogICAgICAgIH07CgogICAgICAgIHJlYWRlci5yZWFkQXNUZXh0KGZpbGUpOwogICAgICB9KTsKICAgIH0KICB9LAogIGJlZm9yZU1vdW50OiBmdW5jdGlvbiBiZWZvcmVNb3VudCgpIHsKICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmFkZCgicmlnaHQtbWVudSIpOwogICAgRXZlbnRCdXMuJG9uKCJzZWFyY2giLCB0aGlzLnNlYXJjaEVkaXRvcik7CiAgICBFdmVudEJ1cy4kb24oInByaW50IiwgdGhpcy5wcmludEVkaXRvcik7CiAgICBFdmVudEJ1cy4kb24oInRhYi1jaGFuZ2UiLCB0aGlzLmRvVGFiQ2hhbmdlKTsKICAgIEV2ZW50QnVzLiRvbigic2F2ZSIsIHRoaXMuZG9TYXZlKTsKICAgIEV2ZW50QnVzLiRvbigiY2FuY2VsIiwgdGhpcy5kb0NhbmNlbCk7CgogICAgaWYgKHRoaXMubW92aWVTZXJpZVBsYXlsaXN0KSB7CiAgICAgIHRoaXMubG9hZFBsYXlsaXN0KHRoaXMubW92aWVTZXJpZVBsYXlsaXN0KTsKICAgIH0KCiAgICB0aGlzLmxvYWRMb2dvQ291bnRyaWVzKCk7CiAgICB0aGlzLmxvYWRUVkdJRENvdW50cmllcygpOwogIH0sCiAgYmVmb3JlRGVzdHJveTogZnVuY3Rpb24gYmVmb3JlRGVzdHJveSgpIHsKICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnJlbW92ZSgicmlnaHQtbWVudSIpOwogICAgRXZlbnRCdXMuJG9mZigic2VhcmNoIiwgdGhpcy5zZWFyY2hFZGl0b3IpOwogICAgRXZlbnRCdXMuJG9mZigicHJpbnQiLCB0aGlzLnByaW50RWRpdG9yKTsKICAgIEV2ZW50QnVzLiRvZmYoInRhYi1jaGFuZ2UiLCB0aGlzLmRvVGFiQ2hhbmdlKTsKICAgIEV2ZW50QnVzLiRvZmYoInNhdmUiLCB0aGlzLmRvU2F2ZSk7CiAgICBFdmVudEJ1cy4kb2ZmKCJjYW5jZWwiLCB0aGlzLmRvQ2FuY2VsKTsKICB9LAogIHdhdGNoOiB7CiAgICBkcmFnU3RyZWFtOiBmdW5jdGlvbiBkcmFnU3RyZWFtKHZhbCkgewogICAgICBpZiAoIXZhbCkgewogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICAgIH0KICAgIH0sCiAgICBkcmFnR3JvdXA6IGZ1bmN0aW9uIGRyYWdHcm91cCh2YWwpIHsKICAgICAgaWYgKCF2YWwpIHsKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgICB9CiAgICB9LAogICAgYWN0aXZlR3JvdXA6IGZ1bmN0aW9uIGFjdGl2ZUdyb3VwKHZhbCkgewogICAgICBpZiAodGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkKSB7CiAgICAgICAgdGhpcy5zYXZlQ2hhbmdlc01vZGFsKHRydWUpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMubG9hZFN0cmVhbXMoKTsKICAgICAgfQogICAgfSwKICAgICJwbGF5bGlzdEVkaXRvci5jaGFuZ2VkIjogZnVuY3Rpb24gcGxheWxpc3RFZGl0b3JDaGFuZ2VkKHZhbCkgewogICAgICBFdmVudEJ1cy4kZW1pdCgiZWRpdG9yLWNoYW5nZXMiLCB2YWwpOwogICAgfSwKICAgICJyYWRpb0Jyb3dzZXIuc2VhcmNoIjogZnVuY3Rpb24gcmFkaW9Ccm93c2VyU2VhcmNoKHZhbCkgewogICAgICB2YXIgdm0gPSB0aGlzOwogICAgICBjbGVhclRpbWVvdXQodGhpcy5yYWRpb0Jyb3dzZXIuYm91bmNlKTsKICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuYm91bmNlID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgdm0uZmluZFJhZGlvYnJvd3Nlcih2YWwpOwogICAgICB9LCA1MDApOwogICAgfSwKICAgICJzb3VuZGNsb3VkLnVybCI6IGZ1bmN0aW9uIHNvdW5kY2xvdWRVcmwodmFsKSB7CiAgICAgIHZhciB2bSA9IHRoaXM7CiAgICAgIGNsZWFyVGltZW91dCh0aGlzLnJhZGlvQnJvd3Nlci5ib3VuY2UpOwogICAgICB0aGlzLnJhZGlvQnJvd3Nlci5ib3VuY2UgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICB2bS5nZXRTb3VuZGNsb3VkVHJhY2sodmFsLCB2bS5zb3VuZGNsb3VkQ2xpZW50SWQpOwogICAgICB9LCA1MDApOwogICAgfSwKICAgICJ5b3V0dWJlLnVybCI6IGZ1bmN0aW9uIHlvdXR1YmVVcmwodmFsKSB7CiAgICAgIGlmICghdmFsLmxlbmd0aCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKC95b3V0dVwuP2JlL2kudGVzdCh2YWwpKSB7CiAgICAgICAgdmFyIGk7CiAgICAgICAgdmFyIHBhdHRlcm5zID0gWy95b3V0dVwuYmVcLyhbXiMmP117MTF9KS8sIC8vIHlvdXR1LmJlLzxpZD4KICAgICAgICAvXD92PShbXiMmP117MTF9KS8sIC8vID92PTxpZD4KICAgICAgICAvJnY9KFteIyY/XXsxMX0pLywgLy8gJnY9PGlkPgogICAgICAgIC9lbWJlZFwvKFteIyY/XXsxMX0pLywgLy8gZW1iZWQvPGlkPgogICAgICAgIC9cL3ZcLyhbXiMmP117MTF9KS8gLy8gL3YvPGlkPgogICAgICAgIF07CgogICAgICAgIGZvciAoaSA9IDA7IGkgPCBwYXR0ZXJucy5sZW5ndGg7ICsraSkgewogICAgICAgICAgaWYgKHBhdHRlcm5zW2ldLnRlc3QodmFsKSkgewogICAgICAgICAgICB0aGlzLnlvdXR1YmUudmlkZW9JZCA9IHBhdHRlcm5zW2ldLmV4ZWModmFsKVsxXTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdmFyIHRva2VucyA9IHZhbC5zcGxpdCgvWy8mPz0jLlxzXS9nKTsKCiAgICAgICAgZm9yIChpID0gMDsgaSA8IHRva2Vucy5sZW5ndGg7ICsraSkgewogICAgICAgICAgaWYgKC9eW14jJj9dezExfSQvLnRlc3QodG9rZW5zW2ldKSkgewogICAgICAgICAgICB0aGlzLnlvdXR1YmUudmlkZW9JZCA9IHRva2Vuc1tpXTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdGhpcy55b3V0dWJlLnZpZGVvSWQgPSAiIjsKICAgICAgfSBlbHNlIHsKICAgICAgICB0cnkgewogICAgICAgICAgdmFyIHVybHAgPSBuZXcgVVJMKHZhbCk7CiAgICAgICAgICB0aGlzLnlvdXR1YmUudmlkZW9JZCA9IHVybHAuc2VhcmNoUGFyYW1zLmdldCgidiIpOwogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICB0aGlzLnlvdXR1YmUudmlkZW9JZCA9ICIiOwogICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgICJ5b3V0dWJlLnZpZGVvSWQiOiBmdW5jdGlvbiB5b3V0dWJlVmlkZW9JZCh2YWwpIHsKICAgICAgdmFyIHZtID0gdGhpczsKICAgICAgY2xlYXJUaW1lb3V0KHRoaXMueW91dHViZS5ib3VuY2UpOwogICAgICB0aGlzLnlvdXR1YmUuYm91bmNlID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKHZhbC5sZW5ndGgpIHsKICAgICAgICAgIHZtLmdldFlvdXR1YmVQYWdlKHZhbCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZtLnlvdXR1YmUudmlkZW8gPSBudWxsOwogICAgICAgIH0KICAgICAgfSwgNTAwKTsKICAgIH0sCiAgICAidmltZW8udXJsIjogZnVuY3Rpb24gdmltZW9VcmwodmFsKSB7CiAgICAgIGlmICgvdmltZW9cLmNvbS9pLnRlc3QodmFsKSkgewogICAgICAgIHZhciBtYXRjaCA9IHZhbC5tYXRjaCgvKD86d3d3XC58cGxheWVyXC4pP3ZpbWVvLmNvbVwvKD86Y2hhbm5lbHNcLyg/Olx3K1wvKT98Z3JvdXBzXC8oPzpbXi9dKilcL3ZpZGVvc1wvfGFsYnVtXC8oPzpcZCspXC92aWRlb1wvfHZpZGVvXC98KShcZCspKD86W2EtekEtWjAtOV8tXSspPy9pKTsKCiAgICAgICAgaWYgKG1hdGNoLmxlbmd0aCA+PSAyKSB7CiAgICAgICAgICB0aGlzLnZpbWVvLnZpZGVvSWQgPSBtYXRjaFsxXTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy52aW1lby52aWRlb0lkID0gIiI7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMudmltZW8udmlkZW9JZCA9ICIiOwogICAgICB9CiAgICB9LAogICAgInZpbWVvLnZpZGVvSWQiOiBmdW5jdGlvbiB2aW1lb1ZpZGVvSWQodmFsKSB7CiAgICAgIHZhciB2bSA9IHRoaXM7CiAgICAgIGNsZWFyVGltZW91dCh0aGlzLnZpbWVvLmJvdW5jZSk7CiAgICAgIHRoaXMudmltZW8uYm91bmNlID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKHZhbC5sZW5ndGgpIHsKICAgICAgICAgIHZtLmdldFZpbWVvQ29uZmlnKHZhbCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZtLnZpbWVvLnZpZGVvID0gbnVsbDsKICAgICAgICB9CiAgICAgIH0sIDUwMCk7CiAgICB9LAogICAgImRhaWx5bW90aW9uLnVybCI6IGZ1bmN0aW9uIGRhaWx5bW90aW9uVXJsKHZhbCkgewogICAgICBpZiAoL2RhaWx5bW90aW9uXC5jb20vaS50ZXN0KHZhbCkpIHsKICAgICAgICB2YXIgbWF0Y2ggPSB2YWwubWF0Y2goL14uK2RhaWx5bW90aW9uLmNvbVwvKHZpZGVvfGh1YilcLyhbXl9dKylbXiNdKigjdmlkZW89KFteXyZdKykpPy9pKTsKCiAgICAgICAgaWYgKG1hdGNoLmxlbmd0aCA+PSA0ICYmIG1hdGNoWzRdKSB7CiAgICAgICAgICB0aGlzLmRhaWx5bW90aW9uLnZpZGVvSWQgPSBtYXRjaFs0XTsKICAgICAgICB9IGVsc2UgaWYgKG1hdGNoLmxlbmd0aCA+PSAyKSB7CiAgICAgICAgICB0aGlzLmRhaWx5bW90aW9uLnZpZGVvSWQgPSBtYXRjaFsyXTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5kYWlseW1vdGlvbi52aWRlb0lkID0gIiI7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZGFpbHltb3Rpb24udmlkZW9JZCA9ICIiOwogICAgICB9CiAgICB9LAogICAgImRhaWx5bW90aW9uLnZpZGVvSWQiOiBmdW5jdGlvbiBkYWlseW1vdGlvblZpZGVvSWQodmFsKSB7CiAgICAgIHZhciB2bSA9IHRoaXM7CiAgICAgIGNsZWFyVGltZW91dCh0aGlzLmRhaWx5bW90aW9uLmJvdW5jZSk7CiAgICAgIHRoaXMuZGFpbHltb3Rpb24uYm91bmNlID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKHZhbC5sZW5ndGgpIHsKICAgICAgICAgIHZtLmdldERhaWx5bW90aW9uQ29uZmlnKHZhbCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZtLmRhaWx5bW90aW9uLnZpZGVvID0gbnVsbDsKICAgICAgICB9CiAgICAgIH0sIDUwMCk7CiAgICB9LAogICAgInRlZFRhbGtzLnVybCI6IGZ1bmN0aW9uIHRlZFRhbGtzVXJsKHZhbCkgewogICAgICBpZiAoL3RlZFwuY29tXC90YWxrcy9pLnRlc3QodmFsKSkgewogICAgICAgIHZhciB2bSA9IHRoaXM7CiAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMudGVkVGFsa3MuYm91bmNlKTsKICAgICAgICB0aGlzLnRlZFRhbGtzLmJvdW5jZSA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKHZhbC5sZW5ndGgpIHsKICAgICAgICAgICAgdm0uZ2V0VGVkVGFsa3NDb25maWcodmFsKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZtLnRlZFRhbGtzLnZpZGVvID0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICB9LCA1MDApOwogICAgICB9CiAgICB9LAogICAgInhoYW1zdGVyLnVybCI6IGZ1bmN0aW9uIHhoYW1zdGVyVXJsKHZhbCkgewogICAgICB2YXIgdm0gPSB0aGlzOwoKICAgICAgaWYgKC94aGFtc3RlclwuY29tXC92aWRlb3MvaS50ZXN0KHZhbCkpIHsKICAgICAgICBjbGVhclRpbWVvdXQodGhpcy54aGFtc3RlckJvdW5jZSk7CiAgICAgICAgdGhpcy54aGFtc3RlckJvdW5jZSA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKHZhbC5sZW5ndGgpIHsKICAgICAgICAgICAgdm0uZ2V0WGhhbXN0ZXJDb25maWcodmFsKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZtLnhoYW1zdGVyLnZpZGVvID0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICB9LCA1MDApOwogICAgICB9CiAgICB9LAogICAgImZpbmRMb2dvLmNvdW50cnkiOiBmdW5jdGlvbiBmaW5kTG9nb0NvdW50cnkodmFsKSB7CiAgICAgIGlmICh2YWwubGVuZ3RoKSB7CiAgICAgICAgdGhpcy5sb2FkTG9nb3NGaW5kKHZhbCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5maW5kTG9nby5sb2dvID0gIiI7CiAgICAgIH0KICAgIH0sCiAgICAiYXNzaWduTG9nby5jb3VudHJ5IjogZnVuY3Rpb24gYXNzaWduTG9nb0NvdW50cnkodmFsKSB7CiAgICAgIGlmICh2YWwubGVuZ3RoKSB7CiAgICAgICAgdGhpcy5sb2FkTG9nb3NBc3NpZ24odmFsKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmFzc2lnbkxvZ28ubG9nbyA9ICIiOwogICAgICB9CiAgICB9LAogICAgImZpbmRUVkdJRC5jb3VudHJ5IjogZnVuY3Rpb24gZmluZFRWR0lEQ291bnRyeSh2YWwpIHsKICAgICAgaWYgKHZhbC5sZW5ndGgpIHsKICAgICAgICB0aGlzLmxvYWRUVkdJREZpbmQodmFsKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmZpbmRUVkdJRC5jaGFubmVsID0gIiI7CiAgICAgIH0KICAgIH0sCiAgICAiYXNzaWduVFZHSUQuY291bnRyeSI6IGZ1bmN0aW9uIGFzc2lnblRWR0lEQ291bnRyeSh2YWwpIHsKICAgICAgaWYgKHZhbC5sZW5ndGgpIHsKICAgICAgICB0aGlzLmxvYWRUVkdJREFzc2lnbih2YWwpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYXNzaWduVFZHSUQuY2hhbm5lbHMgPSBbXTsKICAgICAgfQogICAgfSwKICAgIG1vdmllU2VyaWVQbGF5bGlzdDogZnVuY3Rpb24gbW92aWVTZXJpZVBsYXlsaXN0KHZhbCkgewogICAgICB0aGlzLmxvYWRQbGF5bGlzdCh2YWwpOwogICAgfQogIH0KfTs="},null]}