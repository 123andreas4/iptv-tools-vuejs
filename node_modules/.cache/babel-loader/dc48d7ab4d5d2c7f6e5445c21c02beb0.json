{"remainingRequest":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/thread-loader/dist/cjs.js!/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/babel-loader/lib/index.js!/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/cache-loader/dist/cjs.js??ref--0-0!/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/vue-loader/lib/index.js??vue-loader-options!/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/src/views/app/m3u/editor.vue?vue&type=script&lang=js&","dependencies":[{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/src/views/app/m3u/editor.vue","mtime":1625072775142},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF90b0NvbnN1bWFibGVBcnJheSBmcm9tICIvbWVkaWEvZXJuc3QvNjNiY2U0M2MtNWU1MS00YmYxLWE2MTEtM2FmZGYzMmFjNmY2L1Z1ZUpTL0lQVFYtVG9vbHMvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL3RvQ29uc3VtYWJsZUFycmF5IjsKaW1wb3J0IF9vYmplY3RTcHJlYWQgZnJvbSAiL21lZGlhL2VybnN0LzYzYmNlNDNjLTVlNTEtNGJmMS1hNjExLTNhZmRmMzJhYzZmNi9WdWVKUy9JUFRWLVRvb2xzL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9vYmplY3RTcHJlYWQyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc2VhcmNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmNvbnN0cnVjdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLnRvLXN0cmluZy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbHRlci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5tYXRjaC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbmQtaW5kZXguanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5tYXAuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5udW1iZXIuY29uc3RydWN0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuam9pbi5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pdGVyYXRvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuaXRlcmF0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zb3J0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5jbHVkZXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuaW5jbHVkZXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zcGxpY2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcucmVwbGFjZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmNvbmNhdC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmZ1bmN0aW9uLm5hbWUuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3Qua2V5cy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbmQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc3BsaXQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIudXJsLmpzIjsKLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCi8qIGVzbGludC1kaXNhYmxlIHZ1ZS9uby1zaWRlLWVmZmVjdHMtaW4tY29tcHV0ZWQtcHJvcGVydGllcyAqLwoKLyogZXNsaW50LWRpc2FibGUgbm8tdW51c2VkLXZhcnMgKi8KCi8qIGVzbGludC1kaXNhYmxlIG5vLXVzZWxlc3MtZXNjYXBlICovCmltcG9ydCB7IEV2ZW50QnVzIH0gZnJvbSAiLi4vLi4vLi4vc2VydmljZXMvZWJ1cyI7CmltcG9ydCB7IGh0dHBTZXJ2aWNlIH0gZnJvbSAiLi4vLi4vLi4vc2VydmljZXMvaHR0cCI7CmltcG9ydCB7IG1hcEdldHRlcnMgfSBmcm9tICJ2dWV4IjsKaW1wb3J0IGRyYWdnYWJsZSBmcm9tICJ2dWVkcmFnZ2FibGUiOwppbXBvcnQgeyBTdWJzY3JpcHRpb25UeXBlIH0gZnJvbSAiLi4vLi4vLi4vY29uc3RhbnRzL2NvbmZpZyI7CmltcG9ydCB7IGNvdW50cmllcyB9IGZyb20gIi4uLy4uLy4uL2hlbHBlcnMiOwppbXBvcnQgeyBtM3UgfSBmcm9tICIuLi8uLi8uLi9wbHVnaW5zL20zdSI7CmV4cG9ydCBkZWZhdWx0IHsKICBjb21wb25lbnRzOiB7CiAgICBkcmFnZ2FibGU6IGRyYWdnYWJsZQogIH0sCiAgZGF0YTogZnVuY3Rpb24gZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGNvdW50cmllczogY291bnRyaWVzLAogICAgICBhY3RpdmVUYWI6IDAsCiAgICAgIGFjdGl2ZUdyb3VwOiAtMSwKICAgICAgYWN0aXZlR3JvdXBzOiBbXSwKICAgICAgYWN0aXZlU3RyZWFtOiAtMSwKICAgICAgYWN0aXZlU3RyZWFtczogW10sCiAgICAgIGRyYWdHcm91cDogZmFsc2UsCiAgICAgIGRyYWdTdHJlYW06IGZhbHNlLAogICAgICBlZGl0b3I6IGZhbHNlLAogICAgICBzZWFyY2g6IG51bGwsCiAgICAgIGlzTG9hZGluZzogZmFsc2UsCiAgICAgIHBsYXlsaXN0RWRpdG9yOiB7CiAgICAgICAgaWQ6IHVuZGVmaW5lZCwKICAgICAgICBwbGF5bGlzdDogbnVsbCwKICAgICAgICBncm91cHM6IFtdLAogICAgICAgIHN0cmVhbXM6IFtdLAogICAgICAgIGNoYW5nZWQ6IGZhbHNlCiAgICAgIH0sCiAgICAgIGZpbmRSZXBsYWNlOiB7CiAgICAgICAgdHlwZTogMCwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgZnJvbTogIiIsCiAgICAgICAgdG86ICIiLAogICAgICAgIHJlcGxhY2VBbGw6IGZhbHNlLAogICAgICAgIGlnbm9yZUNhc2U6IGZhbHNlLAogICAgICAgIHNlbGVjdGVkT25seTogMAogICAgICB9LAogICAgICBwcmVmaXhTdWZmaXg6IHsKICAgICAgICB0eXBlOiAwLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBwcmVmaXg6ICIiLAogICAgICAgIHN1ZmZpeDogIiIsCiAgICAgICAgc2VsZWN0ZWRPbmx5OiAwCiAgICAgIH0sCiAgICAgIGNvbnZlcnRDYXNlOiB7CiAgICAgICAgdHlwZTogMCwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgbWV0aG9kOiAwLAogICAgICAgIHNlbGVjdGVkT25seTogMAogICAgICB9LAogICAgICBncm91cEVkaXRvcjogewogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBpZDogMCwKICAgICAgICBncm91cF9uYW1lOiAiIiwKICAgICAgICBncm91cF9wYXJlbnRfY29kZTogIiIsCiAgICAgICAgZ3JvdXBfdHlwZTogMSwKICAgICAgICBncm91cF9pc19oaWRkZW46IDAKICAgICAgfSwKICAgICAgc3RyZWFtRWRpdG9yOiB7CiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIGlkOiAtMSwKICAgICAgICBzdHJlYW1fdHZnX25hbWU6ICIiLAogICAgICAgIHN0cmVhbV90dmdfaWQ6ICIiLAogICAgICAgIHN0cmVhbV90dmdfbG9nbzogIiIsCiAgICAgICAgc3RyZWFtX3R2Z19jaG5vOiAiIiwKICAgICAgICBzdHJlYW1fdHZnX3NoaWZ0OiAiIiwKICAgICAgICBzdHJlYW1fcGFyZW50X2NvZGU6ICIiLAogICAgICAgIHN0cmVhbV9hdWRpb190cmFjazogIiIsCiAgICAgICAgc3RyZWFtX2FzcGVjdF9yYXRpbzogIiIsCiAgICAgICAgc3RyZWFtX3JhZGlvOiAwLAogICAgICAgIHN0cmVhbV9pc19oaWRkZW46IDAsCiAgICAgICAgc3RyZWFtX2lzX2N1c3RvbTogMCwKICAgICAgICBtb3ZpZV9uYW1lOiAiIiwKICAgICAgICBtb3ZpZV95ZWFyOiAiIiwKICAgICAgICBzZXJpZV9uYW1lOiAiIiwKICAgICAgICBzZXJpZV9zZWFzb246IDAsCiAgICAgICAgc2VyaWVfZXBpc29kZTogMCwKICAgICAgICBzb3VyY2Vfc3RyZWFtX3VybDogIiIKICAgICAgfSwKICAgICAgcmFkaW9Ccm93c2VyOiB7CiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgYm91bmNlOiBudWxsLAogICAgICAgIGFjdGl2ZTogW10sCiAgICAgICAgc2VhcmNoOiAiIiwKICAgICAgICByZXN1bHRzOiBbXQogICAgICB9LAogICAgICBzb3VuZGNsb3VkOiB7CiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgYm91bmNlOiBudWxsLAogICAgICAgIHVybDogIiIsCiAgICAgICAgdHJhY2s6IG51bGwKICAgICAgfSwKICAgICAgeW91dHViZTogewogICAgICAgIGlzTG9hZGluZzogZmFsc2UsCiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIGJvdW5jZTogbnVsbCwKICAgICAgICB1cmw6ICIiLAogICAgICAgIHZpZGVvSWQ6ICIiLAogICAgICAgIHZpZGVvOiBudWxsCiAgICAgIH0sCiAgICAgIHZpbWVvOiB7CiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgYm91bmNlOiBudWxsLAogICAgICAgIHVybDogIiIsCiAgICAgICAgdmlkZW9JZDogIiIsCiAgICAgICAgdmlkZW86IG51bGwKICAgICAgfSwKICAgICAgZGFpbHltb3Rpb246IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBib3VuY2U6IG51bGwsCiAgICAgICAgdXJsOiAiIiwKICAgICAgICB2aWRlb0lkOiAiIiwKICAgICAgICB2aWRlbzogbnVsbAogICAgICB9LAogICAgICB0ZWRUYWxrczogewogICAgICAgIGlzTG9hZGluZzogZmFsc2UsCiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIGJvdW5jZTogbnVsbCwKICAgICAgICB1cmw6ICIiLAogICAgICAgIHZpZGVvOiBudWxsCiAgICAgIH0sCiAgICAgIHhoYW1zdGVyOiB7CiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgYm91bmNlOiBudWxsLAogICAgICAgIHVybDogIiIsCiAgICAgICAgdmlkZW86IG51bGwKICAgICAgfSwKICAgICAgZmluZExvZ286IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBjb3VudHJpZXM6IFtdLAogICAgICAgIGNvdW50cnk6ICIiLAogICAgICAgIGxvZ29zOiBbXSwKICAgICAgICBsb2dvOiAiIiwKICAgICAgICBzZWFyY2g6ICIiLAogICAgICAgIHRpdGxlOiAiIgogICAgICB9LAogICAgICBhc3NpZ25Mb2dvOiB7CiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgY291bnRyaWVzOiBbXSwKICAgICAgICBjb3VudHJ5OiAiIiwKICAgICAgICBsb2dvczogW10sCiAgICAgICAgYXNzaWduQWxsOiAwCiAgICAgIH0sCiAgICAgIGltcG9ydE0zVTogewogICAgICAgIGlzTG9hZGluZzogZmFsc2UsCiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIGdyb3VwczogW10sCiAgICAgICAgaW1wb3J0R3JvdXBzOiBbXSwKICAgICAgICBtM3U6IG51bGwsCiAgICAgICAgZmlsZTogbnVsbAogICAgICB9LAogICAgICBmaW5kVFZHSUQ6IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBjb3VudHJpZXM6IFtdLAogICAgICAgIGNvdW50cnk6ICIiLAogICAgICAgIGNoYW5uZWxzOiBbXSwKICAgICAgICBjaGFubmVsOiAiIiwKICAgICAgICBzZWFyY2g6ICIiLAogICAgICAgIHRpdGxlOiAiIgogICAgICB9LAogICAgICBmaW5kU2lwdHY6IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBjb3VudHJpZXM6IFtdLAogICAgICAgIGNvdW50cnk6ICIiLAogICAgICAgIGNoYW5uZWxzOiBbXSwKICAgICAgICBjaGFubmVsOiAiIiwKICAgICAgICBzZWFyY2g6ICIiLAogICAgICAgIHRpdGxlOiAiIgogICAgICB9LAogICAgICBhc3NpZ25UVkdJRDogewogICAgICAgIGlzTG9hZGluZzogZmFsc2UsCiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIGNvdW50cmllczogW10sCiAgICAgICAgY291bnRyeTogIiIsCiAgICAgICAgY2hhbm5lbHM6IFtdLAogICAgICAgIGFzc2lnbkFsbDogMAogICAgICB9LAogICAgICBhc3NpZ25TSVBUVjogewogICAgICAgIGlzTG9hZGluZzogZmFsc2UsCiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIGNvdW50cmllczogW10sCiAgICAgICAgY291bnRyeTogIiIsCiAgICAgICAgY2hhbm5lbHM6IFtdLAogICAgICAgIGFzc2lnbkFsbDogMAogICAgICB9LAogICAgICBzYXZlQ2hhbmdlczogewogICAgICAgIG1vZGFsOiBmYWxzZQogICAgICB9LAogICAgICBncm91cFR5cGVzOiBbewogICAgICAgIHRleHQ6IHRoaXMuJHQoInh0cmVhbS5saXZlIiksCiAgICAgICAgdmFsdWU6IDEKICAgICAgfSwgewogICAgICAgIHRleHQ6IHRoaXMuJHQoInh0cmVhbS5tb3ZpZXMiKSwKICAgICAgICB2YWx1ZTogMgogICAgICB9LCB7CiAgICAgICAgdGV4dDogdGhpcy4kdCgieHRyZWFtLnNlcmllcyIpLAogICAgICAgIHZhbHVlOiAzCiAgICAgIH1dCiAgICB9OwogIH0sCiAgY29tcHV0ZWQ6IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgbWFwR2V0dGVycyhbImN1cnJlbnRVc2VyIiwgInNldHRpbmdzIiwgInNvdW5kY2xvdWRDbGllbnRJZCIsICJtb3ZpZVNlcmllUGxheWxpc3QiXSkpLCB7fSwgewogICAgc2VhcmNoRmlsdGVyZWQ6IGZ1bmN0aW9uIHNlYXJjaEZpbHRlcmVkKCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgaWYgKHRoaXMuc2VhcmNoID09PSBudWxsKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuYWNjb3VudHM7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIHJlID0gbmV3IFJlZ0V4cCh0aGlzLnNlYXJjaCwgImkiKTsKICAgICAgICByZXR1cm4gdGhpcy5hY2NvdW50cy5maWx0ZXIoZnVuY3Rpb24gKGFjY291bnQpIHsKICAgICAgICAgIHJldHVybiBTdHJpbmcoYWNjb3VudC50aXRsZSkubWF0Y2gocmUpIHx8IFN0cmluZyhhY2NvdW50Lmhvc3QpLm1hdGNoKHJlKSB8fCBTdHJpbmcoYWNjb3VudC5wb3J0KS5tYXRjaChyZSkgfHwgU3RyaW5nKGFjY291bnQudXNlcm5hbWUpLm1hdGNoKHJlKSB8fCBTdHJpbmcoYWNjb3VudC5wYXNzd29yZCkubWF0Y2gocmUpIHx8IF90aGlzLmZvcm1hdERhdGUoYWNjb3VudC5zeW5jZWRfYXQpLm1hdGNoKHJlKSB8fCBfdGhpcy4kdCgic3luYy1pbnRlcnZhbC4iLmNvbmNhdChhY2NvdW50LnN5bmNfaW50ZXJ2YWwpKS5tYXRjaChyZSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBwbGF5bGlzdFNlbGVjdGVkOiBmdW5jdGlvbiBwbGF5bGlzdFNlbGVjdGVkKCkgewogICAgICByZXR1cm4gdGhpcy5wbGF5bGlzdEVkaXRvci5pZCAhPT0gdW5kZWZpbmVkOwogICAgfSwKICAgIGxhc3RTZWxlY3RlZEdyb3VwOiBmdW5jdGlvbiBsYXN0U2VsZWN0ZWRHcm91cCgpIHsKICAgICAgcmV0dXJuIHRoaXMuYWN0aXZlR3JvdXBzW3RoaXMuYWN0aXZlR3JvdXBzLmxlbmd0aCAtIDFdOwogICAgfSwKICAgIGxhc3RTZWxlY3RlZFN0cmVhbTogZnVuY3Rpb24gbGFzdFNlbGVjdGVkU3RyZWFtKCkgewogICAgICByZXR1cm4gdGhpcy5hY3RpdmVTdHJlYW1zW3RoaXMuYWN0aXZlU3RyZWFtcy5sZW5ndGggLSAxXTsKICAgIH0sCiAgICBjYW5FZGl0R3JvdXBUeXBlOiBmdW5jdGlvbiBjYW5FZGl0R3JvdXBUeXBlKCkgewogICAgICByZXR1cm4gdGhpcy5ncm91cEVkaXRvci5pZCAmJiB0aGlzLmdldEdyb3VwV2l0aElkKHRoaXMuZ3JvdXBFZGl0b3IuaWQpLnN0cmVhbXMgPT0gMDsKICAgIH0sCiAgICBzdWJzY3JpcHRpb25MaW1pdGVkOiBmdW5jdGlvbiBzdWJzY3JpcHRpb25MaW1pdGVkKCkgewogICAgICByZXR1cm4gdGhpcy5jdXJyZW50VXNlci5zdWJzY3JpcHRpb24gJiYgdGhpcy5jdXJyZW50VXNlci5zdWJzY3JpcHRpb24uc3Vic2NyaXB0aW9uX3R5cGUgPT0gU3Vic2NyaXB0aW9uVHlwZS5FbnRodXNpYXN0OwogICAgfSwKICAgIGZpbHRlcmVkR3JvdXBzOiBmdW5jdGlvbiBmaWx0ZXJlZEdyb3VwcygpIHsKICAgICAgaWYgKHRoaXMuc3Vic2NyaXB0aW9uTGltaXRlZCkgewogICAgICAgIHJldHVybiB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maWx0ZXIoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgICByZXR1cm4gZ3JvdXAuZ3JvdXBfaXNfcmVtb3ZlZCAhPT0gMSAmJiBncm91cC5zb3VyY2VfZ3JvdXBfdHlwZSA9PSAxICYmIGdyb3VwLmdyb3VwX3R5cGUgPT0gMTsKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbHRlcihmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICByZXR1cm4gZ3JvdXAuZ3JvdXBfaXNfcmVtb3ZlZCAhPT0gMTsKICAgICAgfSk7CiAgICB9LAogICAgZmlsdGVyZWRTdHJlYW1zOiBmdW5jdGlvbiBmaWx0ZXJlZFN0cmVhbXMoKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMuZmlsdGVyKGZ1bmN0aW9uIChncm91cCkgewogICAgICAgIHJldHVybiBncm91cC5zdHJlYW1faXNfcmVtb3ZlZCAhPT0gMTsKICAgICAgfSk7CiAgICB9LAogICAgYWN0aXZlR3JvdXBUeXBlOiBmdW5jdGlvbiBhY3RpdmVHcm91cFR5cGUoKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgdmFyIGluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KGZ1bmN0aW9uIChncm91cCkgewogICAgICAgIHJldHVybiBncm91cC5pZCA9PSBfdGhpczIuYWN0aXZlR3JvdXA7CiAgICAgIH0pOwogICAgICByZXR1cm4gaW5kZXggPiAtMSA/IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2luZGV4XS5ncm91cF90eXBlIDogMDsKICAgIH0sCiAgICBmaWx0ZXJlZExvZ29zOiBmdW5jdGlvbiBmaWx0ZXJlZExvZ29zKCkgewogICAgICBpZiAoIXRoaXMuZmluZExvZ28uc2VhcmNoLmxlbmd0aCkgewogICAgICAgIHJldHVybiB0aGlzLmZpbmRMb2dvLmxvZ29zOwogICAgICB9CgogICAgICB2YXIgc2VsZWN0ZWRTdHJlYW0gPSB0aGlzLmdldFN0cmVhbVdpdGhJZCh0aGlzLmFjdGl2ZVN0cmVhbXNbMF0pOwogICAgICB2YXIgcmUgPSBuZXcgUmVnRXhwKHRoaXMuZmluZExvZ28uc2VhcmNoLCAiaSIpOwogICAgICByZXR1cm4gdGhpcy5maW5kTG9nby5sb2dvcy5maWx0ZXIoZnVuY3Rpb24gKGxvZ28pIHsKICAgICAgICByZXR1cm4gbG9nby50ZXh0Lm1hdGNoKHJlKTsKICAgICAgfSk7CiAgICB9LAogICAgZmlsdGVyZWRUVkdJRFM6IGZ1bmN0aW9uIGZpbHRlcmVkVFZHSURTKCkgewogICAgICBpZiAoIXRoaXMuZmluZFRWR0lELnNlYXJjaC5sZW5ndGgpIHsKICAgICAgICByZXR1cm4gdGhpcy5maW5kVFZHSUQuY2hhbm5lbHM7CiAgICAgIH0KCiAgICAgIHZhciBzZWxlY3RlZFN0cmVhbSA9IHRoaXMuZ2V0U3RyZWFtV2l0aElkKHRoaXMuYWN0aXZlU3RyZWFtc1swXSk7CiAgICAgIHZhciByZSA9IG5ldyBSZWdFeHAodGhpcy5maW5kVFZHSUQuc2VhcmNoLCAiaSIpOwogICAgICByZXR1cm4gdGhpcy5maW5kVFZHSUQuY2hhbm5lbHMuZmlsdGVyKGZ1bmN0aW9uIChjaGFubmVsKSB7CiAgICAgICAgcmV0dXJuIGNoYW5uZWwudGV4dC5tYXRjaChyZSk7CiAgICAgIH0pOwogICAgfSwKICAgIGZpbHRlcmVkU2lwdHZJRFM6IGZ1bmN0aW9uIGZpbHRlcmVkU2lwdHZJRFMoKSB7CiAgICAgIGlmICghdGhpcy5maW5kU2lwdHYuc2VhcmNoLmxlbmd0aCkgewogICAgICAgIHJldHVybiB0aGlzLmZpbmRTaXB0di5jaGFubmVsczsKICAgICAgfQoKICAgICAgdmFyIHNlbGVjdGVkU3RyZWFtID0gdGhpcy5nZXRTdHJlYW1XaXRoSWQodGhpcy5hY3RpdmVTdHJlYW1zWzBdKTsKICAgICAgdmFyIHJlID0gbmV3IFJlZ0V4cCh0aGlzLmZpbmRTaXB0di5zZWFyY2gsICJpIik7CiAgICAgIHJldHVybiB0aGlzLmZpbmRTaXB0di5jaGFubmVscy5maWx0ZXIoZnVuY3Rpb24gKGNoYW5uZWwpIHsKICAgICAgICByZXR1cm4gY2hhbm5lbC50ZXh0Lm1hdGNoKHJlKTsKICAgICAgfSk7CiAgICB9LAogICAgZ3JvdXBDb250ZXh0TWVudTogZnVuY3Rpb24gZ3JvdXBDb250ZXh0TWVudSgpIHsKICAgICAgdmFyIHZtID0gdGhpczsKICAgICAgcmV0dXJuIFt7CiAgICAgICAgaWNvbjogImxhLXBsdXMiLAogICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IuYWRkLWdyb3VwIiksCiAgICAgICAgb25DbGljazogdm0uYWRkR3JvdXAKICAgICAgfSwgewogICAgICAgIGRpc2FibGVkOiB2bS5hY3RpdmVHcm91cHMubGVuZ3RoICE9PSAxLAogICAgICAgIGljb246ICJsYS1lZGl0IiwKICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLmVkaXQtZ3JvdXAiKSwKICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgaWYgKHZtLmFjdGl2ZUdyb3Vwcy5sZW5ndGggPT09IDEpIHsKICAgICAgICAgICAgdm0uZWRpdEdyb3VwTW9kYWwodHJ1ZSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAgZGl2aWRlcjogdHJ1ZQogICAgICB9LCB7CiAgICAgICAgdGV4dDogdm0uJHQoImdlbmVyYWwuc2VsZWN0LWFsbCIpLAogICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICB2bS5hY3RpdmVHcm91cHMgPSBfdG9Db25zdW1hYmxlQXJyYXkodm0ucGxheWxpc3RFZGl0b3IuZ3JvdXBzLm1hcChmdW5jdGlvbiAoZykgewogICAgICAgICAgICByZXR1cm4gZy5pZDsKICAgICAgICAgIH0pKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICB0ZXh0OiB2bS4kdCgiZ2VuZXJhbC5zZWxlY3Qtbm9uZSIpLAogICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICB2bS5hY3RpdmVHcm91cHMgPSBbXTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBkaXZpZGVyOiB0cnVlCiAgICAgIH0sIHsKICAgICAgICBpY29uOiAibGEtc2VhcmNoIiwKICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLmZpbmQtcmVwbGFjZSIpLAogICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICB2bS5maW5kQW5kUmVwbGFjZU1vZGFsKHRydWUsIDEpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGljb246ICJsYS1wZW4iLAogICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IuYWRkLXByZWZpeC1zdWZmaXgiKSwKICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgdm0ucHJlZml4U3VmZml4TW9kYWwodHJ1ZSwgMSk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAgaWNvbjogImxhLWZvbnQiLAogICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IuY2hhbmdlLWNhc2UiKSwKICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgdm0uY29udmVydENhc2VNb2RhbCh0cnVlLCAxKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBkaXZpZGVyOiB0cnVlCiAgICAgIH0sIHsKICAgICAgICBkaXNhYmxlZDogdm0uYWN0aXZlR3JvdXBzLmxlbmd0aCA9PT0gMCwKICAgICAgICBpY29uOiAibGEtZXllIiwKICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLnRvZ2dsZS12aXNpYmlsaXR5IiksCiAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgIGlmICh2bS5hY3RpdmVHcm91cHMubGVuZ3RoKSB7CiAgICAgICAgICAgIHZtLnRvZ2dsZUdyb3VwVmlzaWJpbGl0eSgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGRpc2FibGVkOiB2bS5hY3RpdmVHcm91cHMubGVuZ3RoID09PSAwLAogICAgICAgIGljb246ICJsYS10cmFzaCIsCiAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5kZWxldGUiKSwKICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgaWYgKHZtLmFjdGl2ZUdyb3Vwcy5sZW5ndGgpIHsKICAgICAgICAgICAgdm0uZGVsZXRlU2VsZWN0ZWRHcm91cHMoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH1dOwogICAgfSwKICAgIHN0cmVhbUNvbnRleHRNZW51OiBmdW5jdGlvbiBzdHJlYW1Db250ZXh0TWVudSgpIHsKICAgICAgdmFyIHZtID0gdGhpczsKICAgICAgcmV0dXJuIFt7CiAgICAgICAgaWNvbjogImxhLXBsdXMiLAogICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IuYWRkLXN0cmVhbSIpLAogICAgICAgIG9uQ2xpY2s6IHZtLmFkZFN0cmVhbQogICAgICB9LCB7CiAgICAgICAgZGlzYWJsZWQ6IHZtLmFjdGl2ZVN0cmVhbXMubGVuZ3RoICE9PSAxLAogICAgICAgIGljb246ICJsYS1lZGl0IiwKICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLmVkaXQtc3RyZWFtIiksCiAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgIGlmICh2bS5hY3RpdmVTdHJlYW1zLmxlbmd0aCA9PT0gMSkgewogICAgICAgICAgICB2bS5lZGl0U3RyZWFtTW9kYWwodHJ1ZSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAgZGl2aWRlcjogdHJ1ZQogICAgICB9LCB7CiAgICAgICAgdGV4dDogdm0uJHQoImdlbmVyYWwuc2VsZWN0LWFsbCIpLAogICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICB2bS5hY3RpdmVTdHJlYW1zID0gX3RvQ29uc3VtYWJsZUFycmF5KHZtLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubWFwKGZ1bmN0aW9uIChnKSB7CiAgICAgICAgICAgIHJldHVybiBnLmlkOwogICAgICAgICAgfSkpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIHRleHQ6IHZtLiR0KCJnZW5lcmFsLnNlbGVjdC1ub25lIiksCiAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgIHZtLmFjdGl2ZVN0cmVhbXMgPSBbXTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBkaXZpZGVyOiB0cnVlCiAgICAgIH0sIHsKICAgICAgICBkaXNhYmxlZDogdm0uYWN0aXZlR3JvdXBzLmxlbmd0aCAhPT0gMSB8fCB2bS5hY3RpdmVTdHJlYW1zLmxlbmd0aCA9PT0gMCB8fCB2bS5nZXRHcm91cFdpdGhJZCh2bS5hY3RpdmVHcm91cHNbMF0pLmdyb3VwX3R5cGUgIT09IHZtLmFjdGl2ZUdyb3VwVHlwZSB8fCB2bS5hY3RpdmVHcm91cHNbMF0gPT09IHZtLmFjdGl2ZUdyb3VwLAogICAgICAgIGljb246ICJsYS1jaGV2cm9uLWxlZnQiLAogICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IubW92ZS10by1zZWxlY3RlZC1ncm91cCIpLAogICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICB2bS5tb3ZlVG9TZWxlY3RlZEdyb3VwKCk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAgZGl2aWRlcjogdHJ1ZQogICAgICB9LCB7CiAgICAgICAgaWNvbjogImxhLXNlYXJjaCIsCiAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5maW5kLXJlcGxhY2UiKSwKICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgdm0uZmluZEFuZFJlcGxhY2VNb2RhbCh0cnVlLCAyKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBpY29uOiAibGEtcGVuIiwKICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLmFkZC1wcmVmaXgtc3VmZml4IiksCiAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgIHZtLnByZWZpeFN1ZmZpeE1vZGFsKHRydWUsIDIpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGljb246ICJsYS1mb250IiwKICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLmNoYW5nZS1jYXNlIiksCiAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgIHZtLmNvbnZlcnRDYXNlTW9kYWwodHJ1ZSwgMik7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAgZGl2aWRlcjogdHJ1ZQogICAgICB9LCB7CiAgICAgICAgZGlzYWJsZWQ6IHZtLmFjdGl2ZVN0cmVhbXMubGVuZ3RoICE9PSAxIHx8IHZtLmFjdGl2ZUdyb3VwVHlwZSAhPT0gMSwKICAgICAgICBpY29uOiAibGEtcGhvdG8tdmlkZW8iLAogICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IuZmluZC1sb2dvIiksCiAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgIHZtLmZpbmRMb2dvTW9kYWwodHJ1ZSk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAgZGlzYWJsZWQ6IHZtLmFjdGl2ZVN0cmVhbXMubGVuZ3RoICE9PSAxIHx8IHZtLmFjdGl2ZUdyb3VwVHlwZSAhPT0gMSwKICAgICAgICBpY29uOiAibGEtdGgtbGlzdCIsCiAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5maW5kLXR2LWd1aWRlIiksCiAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgIHZtLmZpbmRUVkdJRE1vZGFsKHRydWUpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGRpc2FibGVkOiB2bS5hY3RpdmVTdHJlYW1zLmxlbmd0aCAhPT0gMSB8fCB2bS5hY3RpdmVHcm91cFR5cGUgIT09IDEsCiAgICAgICAgaWNvbjogImxhLXRoLWxpc3QiLAogICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IuZmluZC1zaXB0diIpLAogICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICB2bS5maW5kU2lwdHZNb2RhbCh0cnVlKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBkaXZpZGVyOiB0cnVlCiAgICAgIH0sIHsKICAgICAgICBkaXNhYmxlZDogdm0uYWN0aXZlU3RyZWFtcy5sZW5ndGggPT09IDAgfHwgdm0uYWN0aXZlR3JvdXBUeXBlICE9PSAxLAogICAgICAgIGljb246ICJsYS1tdXNpYyIsCiAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci50b2dnbGUtcmFkaW8iKSwKICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgaWYgKHZtLmFjdGl2ZVN0cmVhbXMubGVuZ3RoICYmIHZtLmFjdGl2ZUdyb3VwVHlwZSA9PSAxKSB7CiAgICAgICAgICAgIHZtLnRvZ2dsZVN0cmVhbVJhZGlvKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAgZGlzYWJsZWQ6IHZtLmFjdGl2ZVN0cmVhbXMubGVuZ3RoID09PSAwLAogICAgICAgIGljb246ICJsYS1leWUiLAogICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IudG9nZ2xlLXZpc2liaWxpdHkiKSwKICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgaWYgKHZtLmFjdGl2ZVN0cmVhbXMubGVuZ3RoKSB7CiAgICAgICAgICAgIHZtLnRvZ2dsZVN0cmVhbVZpc2liaWxpdHkoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBkaXZpZGVyOiB0cnVlCiAgICAgIH0sIHsKICAgICAgICBkaXNhYmxlZDogdm0uYWN0aXZlU3RyZWFtcy5sZW5ndGggPT09IDAsCiAgICAgICAgaWNvbjogImxhLXRyYXNoIiwKICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLmRlbGV0ZSIpLAogICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICBpZiAodm0uYWN0aXZlU3RyZWFtcy5sZW5ndGgpIHsKICAgICAgICAgICAgdm0uZGVsZXRlU2VsZWN0ZWRTdHJlYW1zKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9XTsKICAgIH0KICB9KSwKICBtZXRob2RzOiB7CiAgICBncm91cERyYWdDaGFuZ2VkOiBmdW5jdGlvbiBncm91cERyYWdDaGFuZ2VkKGcpIHsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmICh0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5ncm91cF9vcmRlciAhPSBpICsgMSkgewogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uZ3JvdXBfb3JkZXIgPSBpICsgMTsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBzdHJlYW1EcmFnQ2hhbmdlZDogZnVuY3Rpb24gc3RyZWFtRHJhZ0NoYW5nZWQoZykgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmICh0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uc3RyZWFtX29yZGVyICE9IGkgKyAxKSB7CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uc3RyZWFtX29yZGVyID0gaSArIDE7CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIG9wZW5Db250ZXh0OiBmdW5jdGlvbiBvcGVuQ29udGV4dChjb250ZXh0KSB7CiAgICAgIHRoaXMuJHJlZnNbY29udGV4dF0ub3BlbigpOwogICAgfSwKICAgIHNlYXJjaEVkaXRvcjogZnVuY3Rpb24gc2VhcmNoRWRpdG9yKHNlYXJjaCkgewogICAgICBpZiAoc2VhcmNoLmxlbmd0aCA9PT0gMCkgewogICAgICAgIHRoaXMuc2VhcmNoID0gbnVsbDsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNlYXJjaCA9IHNlYXJjaDsKICAgICAgfQogICAgfSwKICAgIHByaW50RWRpdG9yOiBmdW5jdGlvbiBwcmludEVkaXRvcigpIHsKICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVkaXRvciIpLnByaW50KCk7CiAgICB9LAogICAgZm9ybWF0TnVtYmVyOiBmdW5jdGlvbiBmb3JtYXROdW1iZXIobnVtYmVyKSB7CiAgICAgIHJldHVybiBuZXcgSW50bC5OdW1iZXJGb3JtYXQodGhpcy4kdCgiZGF0ZS5sb2NhbGUiKSkuZm9ybWF0KG51bWJlcik7CiAgICB9LAogICAgZm9ybWF0RGF0ZTogZnVuY3Rpb24gZm9ybWF0RGF0ZShkYXRlKSB7CiAgICAgIHJldHVybiBuZXcgRGF0ZShkYXRlKS50b0xvY2FsZVN0cmluZyh0aGlzLiR0KCJkYXRlLmxvY2FsZSIpLCB0aGlzLmRhdGVPcHRpb25zKTsKICAgIH0sCiAgICBmb3JtYXREYXRlWW91dHViZTogZnVuY3Rpb24gZm9ybWF0RGF0ZVlvdXR1YmUoZGF0ZSkgewogICAgICByZXR1cm4gbmV3IERhdGUoZGF0ZSkudG9Mb2NhbGVEYXRlU3RyaW5nKHRoaXMuJHQoImRhdGUubG9jYWxlIiksIHsKICAgICAgICB5ZWFyOiAibnVtZXJpYyIsCiAgICAgICAgbW9udGg6ICJzaG9ydCIsCiAgICAgICAgZGF5OiAibnVtZXJpYyIKICAgICAgfSk7CiAgICB9LAogICAgZm9ybWF0U2Vjb25kczogZnVuY3Rpb24gZm9ybWF0U2Vjb25kcyhzZWMpIHsKICAgICAgdmFyIGQgPSBOdW1iZXIoc2VjKTsKICAgICAgdmFyIGggPSBNYXRoLmZsb29yKGQgLyAzNjAwKTsKICAgICAgdmFyIG0gPSBNYXRoLmZsb29yKGQgJSAzNjAwIC8gNjApOwogICAgICB2YXIgcyA9IE1hdGguZmxvb3IoZCAlIDM2MDAgJSA2MCk7CiAgICAgIHZhciBob3VyID0gdGhpcy4kdCgiZ2VuZXJhbC5ob3VyIik7CiAgICAgIHZhciBob3VycyA9IHRoaXMuJHQoImdlbmVyYWwuaG91cnMiKTsKICAgICAgdmFyIG1pbnV0ZSA9IHRoaXMuJHQoImdlbmVyYWwubWludXRlIik7CiAgICAgIHZhciBtaW51dGVzID0gdGhpcy4kdCgiZ2VuZXJhbC5taW51dGVzIik7CiAgICAgIHZhciBzZWNvbmQgPSB0aGlzLiR0KCJnZW5lcmFsLnNlY29uZCIpOwogICAgICB2YXIgc2Vjb25kcyA9IHRoaXMuJHQoImdlbmVyYWwuc2Vjb25kcyIpOwogICAgICB2YXIgaERpc3BsYXkgPSBoID4gMCA/IGggKyAoaCA9PSAxID8gIiAiLmNvbmNhdChob3VyLCAiICIpIDogIiAiLmNvbmNhdChob3VycywgIiAiKSkgOiAiIjsKICAgICAgdmFyIG1EaXNwbGF5ID0gbSA+IDAgPyBtICsgKG0gPT0gMSA/ICIgIi5jb25jYXQobWludXRlLCAiICIpIDogIiAiLmNvbmNhdChtaW51dGVzLCAiICIpKSA6ICIiOwogICAgICB2YXIgc0Rpc3BsYXkgPSBzID4gMCA/IHMgKyAocyA9PSAxID8gIiAiLmNvbmNhdChzZWNvbmQsICIgIikgOiAiICIuY29uY2F0KHNlY29uZHMsICIgIikpIDogIiI7CiAgICAgIHJldHVybiBoRGlzcGxheSArIG1EaXNwbGF5ICsgc0Rpc3BsYXk7CiAgICB9LAogICAgZ2V0R3JvdXBXaXRoSWQ6IGZ1bmN0aW9uIGdldEdyb3VwV2l0aElkKGlkKSB7CiAgICAgIHZhciBpbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleChmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICByZXR1cm4gZ3JvdXAuaWQgPT0gaWQ7CiAgICAgIH0pOwogICAgICByZXR1cm4gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaW5kZXhdOwogICAgfSwKICAgIGdldFN0cmVhbVdpdGhJZDogZnVuY3Rpb24gZ2V0U3RyZWFtV2l0aElkKGlkKSB7CiAgICAgIHZhciBpbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5maW5kSW5kZXgoZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgIHJldHVybiBzdHJlYW0uaWQgPT0gaWQ7CiAgICAgIH0pOwogICAgICByZXR1cm4gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XTsKICAgIH0sCiAgICBkb1NhdmU6IGZ1bmN0aW9uIGRvU2F2ZSgpIHsKICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IGZhbHNlOwogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgICAgICB2YXIgaW5kZXggPSBfdGhpczMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleChmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICAgIHJldHVybiBncm91cC5pZCA9PSBfdGhpczMuYWN0aXZlR3JvdXA7CiAgICAgICAgfSk7CgogICAgICAgIHZhciB1cGRhdGVHcm91cHMgPSBfdGhpczMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbHRlcihmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICAgIHJldHVybiAhZ3JvdXAuZ3JvdXBfaXNfcmVtb3ZlZCAmJiBncm91cC5tb2RpZmllZDsKICAgICAgICB9KS5tYXAoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBpZDogZ3JvdXAuaWQsCiAgICAgICAgICAgIGdyb3VwX25hbWU6IGdyb3VwLmdyb3VwX25hbWUsCiAgICAgICAgICAgIGdyb3VwX29yZGVyOiBncm91cC5ncm91cF9vcmRlciwKICAgICAgICAgICAgZ3JvdXBfdHlwZTogZ3JvdXAuZ3JvdXBfdHlwZSwKICAgICAgICAgICAgZ3JvdXBfcGFyZW50X2NvZGU6IGdyb3VwLmdyb3VwX3BhcmVudF9jb2RlLAogICAgICAgICAgICBncm91cF9pc19oaWRkZW46IGdyb3VwLmdyb3VwX2lzX2hpZGRlbgogICAgICAgICAgfTsKICAgICAgICB9KTsKCiAgICAgICAgdmFyIGRlbGV0ZUdyb3VwcyA9IF90aGlzMy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmlsdGVyKGZ1bmN0aW9uIChncm91cCkgewogICAgICAgICAgcmV0dXJuIGdyb3VwLmdyb3VwX2lzX3JlbW92ZWQgJiYgZ3JvdXAubW9kaWZpZWQ7CiAgICAgICAgfSkubWFwKGZ1bmN0aW9uIChncm91cCkgewogICAgICAgICAgcmV0dXJuIGdyb3VwLmlkOwogICAgICAgIH0pLmpvaW4oKTsKCiAgICAgICAgdmFyIHVwZGF0ZVN0cmVhbXM7CgogICAgICAgIHN3aXRjaCAoX3RoaXMzLmFjdGl2ZUdyb3VwVHlwZSkgewogICAgICAgICAgLy8gTGl2ZSBzdHJlYW1zCiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIHVwZGF0ZVN0cmVhbXMgPSBfdGhpczMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5maWx0ZXIoZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgICAgICAgIHJldHVybiBzdHJlYW0uc3RyZWFtX2lzX3JlbW92ZWQgIT09IDEgJiYgc3RyZWFtLm1vZGlmaWVkOwogICAgICAgICAgICB9KS5tYXAoZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBpZDogc3RyZWFtLmlkLAogICAgICAgICAgICAgICAgc291cmNlX3N0cmVhbV91cmw6IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX3VybCwKICAgICAgICAgICAgICAgIHN0cmVhbV90dmdfbmFtZTogc3RyZWFtLnN0cmVhbV90dmdfbmFtZSwKICAgICAgICAgICAgICAgIHN0cmVhbV90dmdfaWQ6IHN0cmVhbS5zdHJlYW1fdHZnX2lkLAogICAgICAgICAgICAgICAgc3RyZWFtX3R2Z19sb2dvOiBzdHJlYW0uc3RyZWFtX3R2Z19sb2dvLAogICAgICAgICAgICAgICAgc3RyZWFtX3R2Z19jaG5vOiBzdHJlYW0uc3RyZWFtX3R2Z19jaG5vLAogICAgICAgICAgICAgICAgc3RyZWFtX3R2Z19zaGlmdDogc3RyZWFtLnN0cmVhbV90dmdfc2hpZnQsCiAgICAgICAgICAgICAgICBzdHJlYW1fcGFyZW50X2NvZGU6IHN0cmVhbS5zdHJlYW1fcGFyZW50X2NvZGUsCiAgICAgICAgICAgICAgICBzdHJlYW1fYXVkaW9fdHJhY2s6IHN0cmVhbS5zdHJlYW1fYXVkaW9fdHJhY2ssCiAgICAgICAgICAgICAgICBzdHJlYW1fYXNwZWN0X3JhdGlvOiBzdHJlYW0uc3RyZWFtX2FzcGVjdF9yYXRpbywKICAgICAgICAgICAgICAgIHN0cmVhbV9yYWRpbzogc3RyZWFtLnN0cmVhbV9yYWRpbywKICAgICAgICAgICAgICAgIHN0cmVhbV9pc19oaWRkZW46IHN0cmVhbS5zdHJlYW1faXNfaGlkZGVuLAogICAgICAgICAgICAgICAgc3RyZWFtX29yZGVyOiBzdHJlYW0uc3RyZWFtX29yZGVyCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgLy8gTW92aWVzCgogICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICB1cGRhdGVTdHJlYW1zID0gX3RoaXMzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMuZmlsdGVyKGZ1bmN0aW9uIChzdHJlYW0pIHsKICAgICAgICAgICAgICByZXR1cm4gc3RyZWFtLnN0cmVhbV9pc19yZW1vdmVkICE9PSAxICYmIHN0cmVhbS5tb2RpZmllZDsKICAgICAgICAgICAgfSkubWFwKGZ1bmN0aW9uIChzdHJlYW0pIHsKICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgaWQ6IHN0cmVhbS5pZCwKICAgICAgICAgICAgICAgIG1vdmllX25hbWU6IHN0cmVhbS5tb3ZpZV9uYW1lLAogICAgICAgICAgICAgICAgbW92aWVfeWVhcjogc3RyZWFtLm1vdmllX3llYXIsCiAgICAgICAgICAgICAgICB0bWRiX2lkOiBzdHJlYW0udG1kYl9pZCwKICAgICAgICAgICAgICAgIHNvdXJjZV9zdHJlYW1fdXJsOiBzdHJlYW0uc291cmNlX3N0cmVhbV91cmwsCiAgICAgICAgICAgICAgICBzdHJlYW1fdHZnX25hbWU6IHN0cmVhbS5zdHJlYW1fdHZnX25hbWUsCiAgICAgICAgICAgICAgICBzdHJlYW1fdHZnX2lkOiBzdHJlYW0uc3RyZWFtX3R2Z19pZCwKICAgICAgICAgICAgICAgIHN0cmVhbV90dmdfbG9nbzogc3RyZWFtLnN0cmVhbV90dmdfbG9nbywKICAgICAgICAgICAgICAgIHN0cmVhbV90dmdfY2hubzogc3RyZWFtLnN0cmVhbV90dmdfY2hubywKICAgICAgICAgICAgICAgIHN0cmVhbV90dmdfc2hpZnQ6IHN0cmVhbS5zdHJlYW1fdHZnX3NoaWZ0LAogICAgICAgICAgICAgICAgc3RyZWFtX3BhcmVudF9jb2RlOiBzdHJlYW0uc3RyZWFtX3BhcmVudF9jb2RlLAogICAgICAgICAgICAgICAgc3RyZWFtX2F1ZGlvX3RyYWNrOiBzdHJlYW0uc3RyZWFtX2F1ZGlvX3RyYWNrLAogICAgICAgICAgICAgICAgc3RyZWFtX2FzcGVjdF9yYXRpbzogc3RyZWFtLnN0cmVhbV9hc3BlY3RfcmF0aW8sCiAgICAgICAgICAgICAgICBzdHJlYW1faXNfaGlkZGVuOiBzdHJlYW0uc3RyZWFtX2lzX2hpZGRlbiwKICAgICAgICAgICAgICAgIHN0cmVhbV9vcmRlcjogc3RyZWFtLnN0cmVhbV9vcmRlcgogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIC8vIFNlcmllcwoKICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgdXBkYXRlU3RyZWFtcyA9IF90aGlzMy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmZpbHRlcihmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHN0cmVhbS5zdHJlYW1faXNfcmVtb3ZlZCAhPT0gMSAmJiBzdHJlYW0ubW9kaWZpZWQ7CiAgICAgICAgICAgIH0pLm1hcChmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGlkOiBzdHJlYW0uaWQsCiAgICAgICAgICAgICAgICBzZXJpZV9uYW1lOiBzdHJlYW0uc2VyaWVfbmFtZSwKICAgICAgICAgICAgICAgIHNlcmllX3NlYXNvbjogc3RyZWFtLnNlcmllX3NlYXNvbiwKICAgICAgICAgICAgICAgIHNlcmllX2VwaXNvZGU6IHN0cmVhbS5zZXJpZV9lcGlzb2RlLAogICAgICAgICAgICAgICAgdG1kYl9pZDogc3RyZWFtLnRtZGJfaWQsCiAgICAgICAgICAgICAgICBzb3VyY2Vfc3RyZWFtX3VybDogc3RyZWFtLnNvdXJjZV9zdHJlYW1fdXJsLAogICAgICAgICAgICAgICAgc3RyZWFtX3R2Z19uYW1lOiBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lLAogICAgICAgICAgICAgICAgc3RyZWFtX3R2Z19pZDogc3RyZWFtLnN0cmVhbV90dmdfaWQsCiAgICAgICAgICAgICAgICBzdHJlYW1fdHZnX2xvZ286IHN0cmVhbS5zdHJlYW1fdHZnX2xvZ28sCiAgICAgICAgICAgICAgICBzdHJlYW1fdHZnX2Nobm86IHN0cmVhbS5zdHJlYW1fdHZnX2Nobm8sCiAgICAgICAgICAgICAgICBzdHJlYW1fdHZnX3NoaWZ0OiBzdHJlYW0uc3RyZWFtX3R2Z19zaGlmdCwKICAgICAgICAgICAgICAgIHN0cmVhbV9wYXJlbnRfY29kZTogc3RyZWFtLnN0cmVhbV9wYXJlbnRfY29kZSwKICAgICAgICAgICAgICAgIHN0cmVhbV9hdWRpb190cmFjazogc3RyZWFtLnN0cmVhbV9hdWRpb190cmFjaywKICAgICAgICAgICAgICAgIHN0cmVhbV9hc3BlY3RfcmF0aW86IHN0cmVhbS5zdHJlYW1fYXNwZWN0X3JhdGlvLAogICAgICAgICAgICAgICAgc3RyZWFtX2lzX2hpZGRlbjogc3RyZWFtLnN0cmVhbV9pc19oaWRkZW4sCiAgICAgICAgICAgICAgICBzdHJlYW1fb3JkZXI6IHN0cmVhbS5zdHJlYW1fb3JkZXIKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICB2YXIgZGVsZXRlU3RyZWFtcyA9IF90aGlzMy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmZpbHRlcihmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAgICAgICByZXR1cm4gc3RyZWFtLnN0cmVhbV9pc19yZW1vdmVkID09PSAxICYmIHN0cmVhbS5tb2RpZmllZDsKICAgICAgICB9KS5tYXAoZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgICAgcmV0dXJuIHN0cmVhbS5pZDsKICAgICAgICB9KS5qb2luKCk7CgogICAgICAgIHZhciByZXF1ZXN0cyA9IFtdOwoKICAgICAgICBpZiAodXBkYXRlR3JvdXBzLmxlbmd0aCkgewogICAgICAgICAgcmVxdWVzdHMucHVzaChodHRwU2VydmljZS5wb3N0KCJlZGl0b3IvdXBkYXRlLWdyb3VwcyIsIHsKICAgICAgICAgICAgcGxheWxpc3RfaWQ6IF90aGlzMy5wbGF5bGlzdEVkaXRvci5pZCwKICAgICAgICAgICAgZ3JvdXBzOiB1cGRhdGVHcm91cHMKICAgICAgICAgIH0pKTsKICAgICAgICB9CgogICAgICAgIGlmIChkZWxldGVHcm91cHMubGVuZ3RoKSB7CiAgICAgICAgICBpbmRleCA9IDA7CiAgICAgICAgICByZXF1ZXN0cy5wdXNoKGh0dHBTZXJ2aWNlLnBvc3QoImVkaXRvci9kZWxldGUtZ3JvdXBzIiwgewogICAgICAgICAgICBwbGF5bGlzdF9pZDogX3RoaXMzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgICBncm91cHM6IGRlbGV0ZUdyb3VwcwogICAgICAgICAgfSkpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHVwZGF0ZVN0cmVhbXMubGVuZ3RoKSB7CiAgICAgICAgICByZXF1ZXN0cy5wdXNoKGh0dHBTZXJ2aWNlLnBvc3QoImVkaXRvci91cGRhdGUtc3RyZWFtcy8iLmNvbmNhdChfdGhpczMuYWN0aXZlR3JvdXBUeXBlKSwgewogICAgICAgICAgICBwbGF5bGlzdF9pZDogX3RoaXMzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgICBzdHJlYW1zOiB1cGRhdGVTdHJlYW1zCiAgICAgICAgICB9KSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoZGVsZXRlU3RyZWFtcy5sZW5ndGgpIHsKICAgICAgICAgIHJlcXVlc3RzLnB1c2goaHR0cFNlcnZpY2UucG9zdCgiZWRpdG9yL2RlbGV0ZS1zdHJlYW1zLyIuY29uY2F0KF90aGlzMy5hY3RpdmVHcm91cFR5cGUpLCB7CiAgICAgICAgICAgIHBsYXlsaXN0X2lkOiBfdGhpczMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICAgIHN0cmVhbXM6IGRlbGV0ZVN0cmVhbXMKICAgICAgICAgIH0pKTsKICAgICAgICB9CgogICAgICAgIFByb21pc2UuYWxsKHJlcXVlc3RzKS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICAgIF90aGlzMy5sb2FkUGxheWxpc3QoX3RoaXMzLnBsYXlsaXN0RWRpdG9yLmlkLCBpbmRleCk7CgogICAgICAgICAgcmVzb2x2ZShyZXMpOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0sCiAgICBkb0NhbmNlbDogZnVuY3Rpb24gZG9DYW5jZWwoKSB7CiAgICAgIHZhciBfdGhpczQgPSB0aGlzOwoKICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBQcm9taXNlLmFsbChbdGhpcy5yZXN0b3JlR3JvdXBzKCksIHRoaXMucmVzdG9yZVN0cmVhbXMoKV0pLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzNC5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gZmFsc2U7CiAgICAgICAgX3RoaXM0LmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9KTsKICAgIH0sCiAgICBkb1RhYkNoYW5nZTogZnVuY3Rpb24gZG9UYWJDaGFuZ2UodGFiKSB7CiAgICAgIHRoaXMuYWN0aXZlVGFiID0gdGFiOwogICAgfSwKICAgIHVwZGF0ZUdyb3VwT3JkZXI6IGZ1bmN0aW9uIHVwZGF0ZUdyb3VwT3JkZXIoc291cmNlKSB7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkgewogICAgICAgIHZhciBncm91cHMgPSBfdG9Db25zdW1hYmxlQXJyYXkoc291cmNlKTsKCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBncm91cHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGdyb3Vwc1tpXS5zb3VyY2VfZ3JvdXBfb3JkZXIgPSBpICsgMTsKICAgICAgICAgIGdyb3Vwc1tpXS5ncm91cF9vcmRlciA9IGkgKyAxOwogICAgICAgIH0KCiAgICAgICAgcmVzb2x2ZShncm91cHMpOwogICAgICB9KTsKICAgIH0sCiAgICB1cGRhdGVTdHJlYW1PcmRlcjogZnVuY3Rpb24gdXBkYXRlU3RyZWFtT3JkZXIoc291cmNlKSB7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkgewogICAgICAgIHZhciBzdHJlYW1zID0gX3RvQ29uc3VtYWJsZUFycmF5KHNvdXJjZSk7CgogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3RyZWFtcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgc3RyZWFtc1tpXS5zb3VyY2Vfc3RyZWFtX29yZGVyID0gaSArIDE7CiAgICAgICAgICBzdHJlYW1zW2ldLnN0cmVhbV9vcmRlciA9IGkgKyAxOwogICAgICAgIH0KCiAgICAgICAgcmVzb2x2ZShzdHJlYW1zKTsKICAgICAgfSk7CiAgICB9LAogICAgcmVzdG9yZUdyb3VwT3JkZXI6IGZ1bmN0aW9uIHJlc3RvcmVHcm91cE9yZGVyKCkgewogICAgICB2YXIgX3RoaXM1ID0gdGhpczsKCiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkgewogICAgICAgIF90aGlzNS5wbGF5bGlzdEVkaXRvci5ncm91cHMuc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgcmV0dXJuIGEuc291cmNlX2dyb3VwX29yZGVyID4gYi5zb3VyY2VfZ3JvdXBfb3JkZXIgPyAxIDogYi5zb3VyY2VfZ3JvdXBfb3JkZXIgPiBhLnNvdXJjZV9ncm91cF9vcmRlciA/IC0xIDogMDsKICAgICAgICB9KTsKCiAgICAgICAgcmVzb2x2ZSgpOwogICAgICB9KTsKICAgIH0sCiAgICByZXN0b3JlU3RyZWFtT3JkZXI6IGZ1bmN0aW9uIHJlc3RvcmVTdHJlYW1PcmRlcigpIHsKICAgICAgdmFyIF90aGlzNiA9IHRoaXM7CgogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgICAgICBfdGhpczYucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICByZXR1cm4gYS5zb3VyY2Vfc3RyZWFtX29yZGVyID4gYi5zb3VyY2Vfc3RyZWFtX29yZGVyID8gMSA6IGIuc291cmNlX3N0cmVhbV9vcmRlciA+IGEuc291cmNlX3N0cmVhbV9vcmRlciA/IC0xIDogMDsKICAgICAgICB9KTsKCiAgICAgICAgcmVzb2x2ZSgpOwogICAgICB9KTsKICAgIH0sCiAgICByZXN0b3JlR3JvdXBzOiBmdW5jdGlvbiByZXN0b3JlR3JvdXBzKCkgewogICAgICB2YXIgX3RoaXM3ID0gdGhpczsKCiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkgewogICAgICAgIF90aGlzNy5yZXN0b3JlR3JvdXBPcmRlcigpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIGdyb3VwOwoKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgX3RoaXM3LnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBncm91cCA9IF90aGlzNy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV07CiAgICAgICAgICAgIGdyb3VwLm1vZGlmaWVkID0gZmFsc2U7CiAgICAgICAgICAgIGdyb3VwLmdyb3VwX2lzX3JlbW92ZWQgPSAwOwogICAgICAgICAgICBncm91cC5ncm91cF90eXBlID0gZ3JvdXAuc291cmNlX2dyb3VwX3R5cGU7CiAgICAgICAgICAgIGdyb3VwLmdyb3VwX25hbWUgPSBncm91cC5zb3VyY2VfZ3JvdXBfbmFtZTsKICAgICAgICAgICAgZ3JvdXAucGFyZW50X2NvZGUgPSBncm91cC5zb3VyY2VfZ3JvdXBfcGFyZW50X2NvZGU7CiAgICAgICAgICAgIGdyb3VwLmdyb3VwX2lzX2hpZGRlbiA9IGdyb3VwLnNvdXJjZV9ncm91cF9pc19oaWRkZW47CiAgICAgICAgICB9CgogICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0sCiAgICByZXN0b3JlU3RyZWFtczogZnVuY3Rpb24gcmVzdG9yZVN0cmVhbXMoKSB7CiAgICAgIHZhciBfdGhpczggPSB0aGlzOwoKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgICAgX3RoaXM4LnJlc3RvcmVTdHJlYW1PcmRlcigpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIHN0cmVhbTsKCiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IF90aGlzOC5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHN0cmVhbSA9IF90aGlzOC5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldOwogICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSBmYWxzZTsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV9pc19yZW1vdmVkID0gMDsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfbmFtZSA9IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX3R2Z19uYW1lOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19pZCA9IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX3R2Z19pZDsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfbG9nbyA9IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX3R2Z19sb2dvOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19jaG5vID0gc3RyZWFtLnNvdXJjZV9zdHJlYW1fdHZnX2Nobm87CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX3NoaWZ0ID0gc3RyZWFtLnNvdXJjZV9zdHJlYW1fdHZnX3NoaWZ0OwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3BhcmVudF9jb2RlID0gc3RyZWFtLnNvdXJjZV9zdHJlYW1fcGFyZW50X2NvZGU7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fYXVkaW9fdHJhY2sgPSBzdHJlYW0uc291cmNlX3N0cmVhbV9hdWRpb190cmFjazsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV9hc3BlY3RfcmF0aW8gPSBzdHJlYW0uc291cmNlX3N0cmVhbV9hc3BlY3RfcmF0aW87CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fcmFkaW8gPSBzdHJlYW0uc291cmNlX3N0cmVhbV9yYWRpbzsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV9vcmRlciA9IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX29yZGVyOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX2lzX2hpZGRlbiA9IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX2lzX2hpZGRlbjsKCiAgICAgICAgICAgIGlmIChzdHJlYW0ubW92aWVfbmFtZSAhPT0gdW5kZWZpbmVkICYmIHN0cmVhbS5tb3ZpZV95ZWFyICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICBzdHJlYW0ubW92aWVfbmFtZSA9IHN0cmVhbS5zb3VyY2VfbW92aWVfbmFtZTsKICAgICAgICAgICAgICBzdHJlYW0ubW92aWVfeWVhciA9IHN0cmVhbS5zb3VyY2VfbW92aWVfeWVhcjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHN0cmVhbS5zZXJpZV9uYW1lICE9PSB1bmRlZmluZWQgJiYgc3RyZWFtLnNlcmllX3NlYXNvbiAhPT0gdW5kZWZpbmVkICYmIHN0cmVhbS5zZXJpZV9lcGlzb2RlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICBzdHJlYW0uc2VyaWVfbmFtZSA9IHN0cmVhbS5zb3VyY2Vfc2VyaWVfbmFtZTsKICAgICAgICAgICAgICBzdHJlYW0uc2VyaWVfc2Vhc29uID0gc3RyZWFtLnNvdXJjZV9zZXJpZV9zZWFzb247CiAgICAgICAgICAgICAgc3RyZWFtLnNlcmllX2VwaXNvZGUgPSBzdHJlYW0uc291cmNlX3NlcmllX2VwaXNvZGU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICByZXNvbHZlKCk7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSwKICAgIHRvZ2dsZUdyb3VwVmlzaWJpbGl0eTogZnVuY3Rpb24gdG9nZ2xlR3JvdXBWaXNpYmlsaXR5KCkgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBzLmluY2x1ZGVzKHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmlkKSkgewogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uZ3JvdXBfaXNfaGlkZGVuID0gIXRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmdyb3VwX2lzX2hpZGRlbjsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICB9LAogICAgdG9nZ2xlU3RyZWFtVmlzaWJpbGl0eTogZnVuY3Rpb24gdG9nZ2xlU3RyZWFtVmlzaWJpbGl0eSgpIHsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAodGhpcy5hY3RpdmVTdHJlYW1zLmluY2x1ZGVzKHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5pZCkpIHsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5zdHJlYW1faXNfaGlkZGVuID0gIXRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5zdHJlYW1faXNfaGlkZGVuOwogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICB9LAogICAgdG9nZ2xlU3RyZWFtUmFkaW86IGZ1bmN0aW9uIHRvZ2dsZVN0cmVhbVJhZGlvKCkgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmICh0aGlzLmFjdGl2ZVN0cmVhbXMuaW5jbHVkZXModGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLmlkKSkgewogICAgICAgICAgaWYgKHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5zdHJlYW1fcmFkaW8gPT0gMCkgewogICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uc3RyZWFtX3JhZGlvID0gMTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5zdHJlYW1fcmFkaW8gPSAwOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgfSwKICAgIGRlbGV0ZVNlbGVjdGVkR3JvdXBzOiBmdW5jdGlvbiBkZWxldGVTZWxlY3RlZEdyb3VwcygpIHsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3Vwcy5pbmNsdWRlcyh0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5pZCkpIHsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmdyb3VwX2lzX3JlbW92ZWQgPSAxOwogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgIH0sCiAgICBkZWxldGVTZWxlY3RlZFN0cmVhbXM6IGZ1bmN0aW9uIGRlbGV0ZVNlbGVjdGVkU3RyZWFtcygpIHsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAodGhpcy5hY3RpdmVTdHJlYW1zLmluY2x1ZGVzKHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5pZCkpIHsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5zdHJlYW1faXNfcmVtb3ZlZCA9IDE7CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgIH0sCiAgICBsb2FkUGxheWxpc3Q6IGZ1bmN0aW9uIGxvYWRQbGF5bGlzdCh2YWwpIHsKICAgICAgdmFyIF90aGlzOSA9IHRoaXM7CgogICAgICB2YXIgZ3JvdXBfaW5kZXggPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZDsKICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlOwoKICAgICAgaWYgKHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCkgewogICAgICAgIHRoaXMuZG9TYXZlKCk7CiAgICAgIH0KCiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuaWQgPSB2YWw7CiAgICAgIGh0dHBTZXJ2aWNlLmdldCgiZWRpdG9yL2dyb3Vwcy8iLmNvbmNhdCh2YWwpKS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICBpZiAocmVzLnN0YXR1cyA9PT0gdHJ1ZSkgewogICAgICAgICAgX3RoaXM5LnVwZGF0ZUdyb3VwT3JkZXIocmVzLmRhdGEpLnRoZW4oZnVuY3Rpb24gKGdyb3VwcykgewogICAgICAgICAgICBfdGhpczkucGxheWxpc3RFZGl0b3IuZ3JvdXBzID0gZ3JvdXBzLm1hcChmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICAgICAgICB2YXIgZ3JwID0gT2JqZWN0LmFzc2lnbih7fSwgZ3JvdXApOwogICAgICAgICAgICAgIGdycC5zb3VyY2VfZ3JvdXBfcGFyZW50X2NvZGUgPSBncm91cC5ncm91cF9wYXJlbnRfY29kZTsKICAgICAgICAgICAgICBncnAuc291cmNlX2dyb3VwX2lzX2hpZGRlbiA9IGdyb3VwLmdyb3VwX2lzX2hpZGRlbjsKICAgICAgICAgICAgICBncnAuc291cmNlX2dyb3VwX25hbWUgPSBncm91cC5ncm91cF9uYW1lOwogICAgICAgICAgICAgIGdycC5zb3VyY2VfZ3JvdXBfdHlwZSA9IGdyb3VwLmdyb3VwX3R5cGU7CiAgICAgICAgICAgICAgZ3JwLmdyb3VwX2lzX3JlbW92ZWQgPSBmYWxzZTsKICAgICAgICAgICAgICBncnAubW9kaWZpZWQgPSBmYWxzZTsKICAgICAgICAgICAgICByZXR1cm4gZ3JwOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGlmIChncm91cHMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgaWYgKGdyb3VwX2luZGV4ID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIF90aGlzOS5hY3RpdmVHcm91cCA9IF90aGlzOS5wbGF5bGlzdEVkaXRvci5ncm91cHNbMF0uaWQ7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIF90aGlzOS5hY3RpdmVHcm91cCA9IF90aGlzOS5wbGF5bGlzdEVkaXRvci5ncm91cHNbZ3JvdXBfaW5kZXhdLmlkOwoKICAgICAgICAgICAgICAgIF90aGlzOS5sb2FkU3RyZWFtcygpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBfdGhpczkuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczkuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0pOwogICAgfSwKICAgIHRvZ2dsZUdyb3VwU2VsZWN0aW9uOiBmdW5jdGlvbiB0b2dnbGVHcm91cFNlbGVjdGlvbihpdGVtKSB7CiAgICAgIHZhciBpZHggPSB0aGlzLmFjdGl2ZUdyb3Vwcy5pbmRleE9mKGl0ZW0pOwoKICAgICAgaWYgKGlkeCAhPT0gLTEpIHsKICAgICAgICB0aGlzLmFjdGl2ZUdyb3Vwcy5zcGxpY2UoaWR4LCAxKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmFjdGl2ZUdyb3Vwcy5wdXNoKGl0ZW0pOwogICAgICB9CiAgICB9LAogICAgdG9nZ2xlU3RyZWFtU2VsZWN0aW9uOiBmdW5jdGlvbiB0b2dnbGVTdHJlYW1TZWxlY3Rpb24oaXRlbSkgewogICAgICB2YXIgaWR4ID0gdGhpcy5hY3RpdmVTdHJlYW1zLmluZGV4T2YoaXRlbSk7CgogICAgICBpZiAoaWR4ICE9PSAtMSkgewogICAgICAgIHRoaXMuYWN0aXZlU3RyZWFtcy5zcGxpY2UoaWR4LCAxKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmFjdGl2ZVN0cmVhbXMucHVzaChpdGVtKTsKICAgICAgfQogICAgfSwKICAgIHRvZ2dsZVJhZGlvYnJvd3NlclNlbGVjdGlvbjogZnVuY3Rpb24gdG9nZ2xlUmFkaW9icm93c2VyU2VsZWN0aW9uKGl0ZW0pIHsKICAgICAgdmFyIGlkeCA9IHRoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZS5pbmRleE9mKGl0ZW0pOwoKICAgICAgaWYgKGlkeCAhPT0gLTEpIHsKICAgICAgICB0aGlzLnJhZGlvQnJvd3Nlci5hY3RpdmUuc3BsaWNlKGlkeCwgMSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuYWN0aXZlLnB1c2goaXRlbSk7CiAgICAgIH0KICAgIH0sCiAgICB0b2dnbGVJbXBvcnRNM1VTZWxlY3Rpb246IGZ1bmN0aW9uIHRvZ2dsZUltcG9ydE0zVVNlbGVjdGlvbihpdGVtKSB7CiAgICAgIHZhciBpZHggPSB0aGlzLmltcG9ydE0zVS5pbXBvcnRHcm91cHMuaW5kZXhPZihpdGVtKTsKCiAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgdGhpcy5pbXBvcnRNM1UuaW1wb3J0R3JvdXBzLnNwbGljZShpZHgsIDEpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuaW1wb3J0TTNVLmltcG9ydEdyb3Vwcy5wdXNoKGl0ZW0pOwogICAgICB9CiAgICB9LAogICAgaW5kZXhPZkdyb3VwOiBmdW5jdGlvbiBpbmRleE9mR3JvdXAoZ3JvdXApIHsKICAgICAgcmV0dXJuIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLm1hcChmdW5jdGlvbiAoZykgewogICAgICAgIHJldHVybiBnLmlkOwogICAgICB9KS5pbmRleE9mKGdyb3VwKTsKICAgIH0sCiAgICBzZWxlY3RHcm91cFJhbmdlU2VsZWN0aW9uOiBmdW5jdGlvbiBzZWxlY3RHcm91cFJhbmdlU2VsZWN0aW9uKGl0ZW0pIHsKICAgICAgdmFyIGxhc3RJbmRleCA9IHRoaXMuaW5kZXhPZkdyb3VwKHRoaXMubGFzdFNlbGVjdGVkR3JvdXApOwogICAgICB2YXIgaXRlbUluZGV4ID0gdGhpcy5pbmRleE9mR3JvdXAoaXRlbSk7CiAgICAgIHZhciBkaXIgPSBpdGVtSW5kZXggPiBsYXN0SW5kZXggPyAxIDogLTE7CgogICAgICBmb3IgKHZhciBpID0gbGFzdEluZGV4OyBpICE9IGl0ZW1JbmRleCArIGRpcjsgaSArPSBkaXIpIHsKICAgICAgICBpZiAoIXRoaXMuYWN0aXZlR3JvdXBzLmluY2x1ZGVzKHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmlkKSkgewogICAgICAgICAgdGhpcy5hY3RpdmVHcm91cHMucHVzaCh0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5pZCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgaW5kZXhPZlN0cmVhbTogZnVuY3Rpb24gaW5kZXhPZlN0cmVhbShzdHJlYW0pIHsKICAgICAgcmV0dXJuIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5tYXAoZnVuY3Rpb24gKGcpIHsKICAgICAgICByZXR1cm4gZy5pZDsKICAgICAgfSkuaW5kZXhPZihzdHJlYW0pOwogICAgfSwKICAgIHNlbGVjdFN0cmVhbVJhbmdlU2VsZWN0aW9uOiBmdW5jdGlvbiBzZWxlY3RTdHJlYW1SYW5nZVNlbGVjdGlvbihpdGVtKSB7CiAgICAgIHZhciBsYXN0SW5kZXggPSB0aGlzLmluZGV4T2ZTdHJlYW0odGhpcy5sYXN0U2VsZWN0ZWRTdHJlYW0pOwogICAgICB2YXIgaXRlbUluZGV4ID0gdGhpcy5pbmRleE9mU3RyZWFtKGl0ZW0pOwogICAgICB2YXIgZGlyID0gaXRlbUluZGV4ID4gbGFzdEluZGV4ID8gMSA6IC0xOwoKICAgICAgZm9yICh2YXIgaSA9IGxhc3RJbmRleDsgaSAhPSBpdGVtSW5kZXggKyBkaXI7IGkgKz0gZGlyKSB7CiAgICAgICAgaWYgKCF0aGlzLmFjdGl2ZVN0cmVhbXMuaW5jbHVkZXModGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLmlkKSkgewogICAgICAgICAgdGhpcy5hY3RpdmVTdHJlYW1zLnB1c2godGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLmlkKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBzZWxlY3RSYWRpb2Jyb3dzZXJSYW5nZVNlbGVjdGlvbjogZnVuY3Rpb24gc2VsZWN0UmFkaW9icm93c2VyUmFuZ2VTZWxlY3Rpb24oaW5kZXgpIHsKICAgICAgdmFyIGxhc3RJbmRleCA9IHRoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZVt0aGlzLnJhZGlvQnJvd3Nlci5hY3RpdmUubGVuZ3RoIC0gMV07CiAgICAgIHZhciBkaXIgPSBpbmRleCA+IGxhc3RJbmRleCA/IDEgOiAtMTsKCiAgICAgIGZvciAodmFyIGkgPSBsYXN0SW5kZXg7IGkgIT0gaW5kZXggKyBkaXI7IGkgKz0gZGlyKSB7CiAgICAgICAgaWYgKCF0aGlzLnJhZGlvQnJvd3Nlci5hY3RpdmUuaW5jbHVkZXMoaSkpIHsKICAgICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZS5wdXNoKGkpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHNlbGVjdEltcG9ydE0zVVJhbmdlU2VsZWN0aW9uOiBmdW5jdGlvbiBzZWxlY3RJbXBvcnRNM1VSYW5nZVNlbGVjdGlvbihpbmRleCkgewogICAgICB2YXIgbGFzdEluZGV4ID0gdGhpcy5pbXBvcnRNM1UuaW1wb3J0R3JvdXBzW3RoaXMuaW1wb3J0TTNVLmltcG9ydEdyb3Vwcy5sZW5ndGggLSAxXTsKICAgICAgdmFyIGRpciA9IGluZGV4ID4gbGFzdEluZGV4ID8gMSA6IC0xOwoKICAgICAgZm9yICh2YXIgaSA9IGxhc3RJbmRleDsgaSAhPSBpbmRleCArIGRpcjsgaSArPSBkaXIpIHsKICAgICAgICBpZiAoIXRoaXMuaW1wb3J0TTNVLmltcG9ydEdyb3Vwcy5pbmNsdWRlcyhpKSkgewogICAgICAgICAgdGhpcy5pbXBvcnRNM1UuaW1wb3J0R3JvdXBzLnB1c2goaSk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgc2VsZWN0R3JvdXBTZWxlY3Rpb246IGZ1bmN0aW9uIHNlbGVjdEdyb3VwU2VsZWN0aW9uKGl0ZW0pIHsKICAgICAgdGhpcy5hY3RpdmVHcm91cHMubGVuZ3RoID0gMDsKICAgICAgdGhpcy5hY3RpdmVHcm91cHMucHVzaChpdGVtKTsKICAgIH0sCiAgICBzZWxlY3RTdHJlYW1TZWxlY3Rpb246IGZ1bmN0aW9uIHNlbGVjdFN0cmVhbVNlbGVjdGlvbihpdGVtKSB7CiAgICAgIHRoaXMuYWN0aXZlU3RyZWFtcy5sZW5ndGggPSAwOwogICAgICB0aGlzLmFjdGl2ZVN0cmVhbXMucHVzaChpdGVtKTsKICAgIH0sCiAgICBzZWxlY3RSYWRpb2Jyb3dzZXJTZWxlY3Rpb246IGZ1bmN0aW9uIHNlbGVjdFJhZGlvYnJvd3NlclNlbGVjdGlvbihpdGVtKSB7CiAgICAgIHRoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZS5sZW5ndGggPSAwOwogICAgICB0aGlzLnJhZGlvQnJvd3Nlci5hY3RpdmUucHVzaChpdGVtKTsKICAgIH0sCiAgICBzZWxlY3RJbXBvcnRNM1VTZWxlY3Rpb246IGZ1bmN0aW9uIHNlbGVjdEltcG9ydE0zVVNlbGVjdGlvbihpdGVtKSB7CiAgICAgIHRoaXMuaW1wb3J0TTNVLmltcG9ydEdyb3Vwcy5sZW5ndGggPSAwOwogICAgICB0aGlzLmltcG9ydE0zVS5pbXBvcnRHcm91cHMucHVzaChpdGVtKTsKICAgIH0sCiAgICBmaW5kQW5kUmVwbGFjZU1vZGFsOiBmdW5jdGlvbiBmaW5kQW5kUmVwbGFjZU1vZGFsKHNob3cpIHsKICAgICAgdmFyIHR5cGUgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IDE7CiAgICAgIHRoaXMuZmluZFJlcGxhY2UudHlwZSA9IHR5cGU7CiAgICAgIHRoaXMuZmluZFJlcGxhY2UubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGZpbmRBbmRSZXBsYWNlOiBmdW5jdGlvbiBmaW5kQW5kUmVwbGFjZSgpIHsKICAgICAgdmFyIF90aGlzMTAgPSB0aGlzOwoKICAgICAgdmFyIG9wdGlvbnMgPSAiIjsKCiAgICAgIGlmICh0aGlzLmZpbmRSZXBsYWNlLnJlcGxhY2VBbGwpIHsKICAgICAgICBvcHRpb25zICs9ICJnIjsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuZmluZFJlcGxhY2UuaWdub3JlQ2FzZSkgewogICAgICAgIG9wdGlvbnMgKz0gImkiOwogICAgICB9CgogICAgICB2YXIgcmUgPSBuZXcgUmVnRXhwKHRoaXMuZmluZFJlcGxhY2UuZnJvbS5yZXBsYWNlKCJ8IiwgIlxcfCIpLCBvcHRpb25zKTsKCiAgICAgIHN3aXRjaCAocGFyc2VJbnQodGhpcy5maW5kUmVwbGFjZS50eXBlKSkgewogICAgICAgIC8vIEdyb3VwCiAgICAgICAgY2FzZSAxOgogICAgICAgICAgaWYgKHBhcnNlSW50KHRoaXMuZmluZFJlcGxhY2Uuc2VsZWN0ZWRPbmx5KSA9PT0gMSkgewogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBzLmluY2x1ZGVzKHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmlkKSkgewogICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uZ3JvdXBfbmFtZSA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmdyb3VwX25hbWUucmVwbGFjZShyZSwgdGhpcy5maW5kUmVwbGFjZS50byk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLmZpbHRlcmVkR3JvdXBzLm1hcChmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICAgICAgICBncm91cC5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgZ3JvdXAuZ3JvdXBfbmFtZSA9IGdyb3VwLmdyb3VwX25hbWUucmVwbGFjZShyZSwgX3RoaXMxMC5maW5kUmVwbGFjZS50byk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwogICAgICAgIC8vIFN0cmVhbXMKCiAgICAgICAgY2FzZSAyOgogICAgICAgICAgaWYgKHBhcnNlSW50KHRoaXMuZmluZFJlcGxhY2Uuc2VsZWN0ZWRPbmx5KSA9PT0gMSkgewogICAgICAgICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsgX2krKykgewogICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZVN0cmVhbXMuaW5jbHVkZXModGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW19pXS5pZCkpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMSkgewogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbX2ldLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW19pXS5zdHJlYW1fdHZnX25hbWUgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbX2ldLnN0cmVhbV90dmdfbmFtZS5yZXBsYWNlKHJlLCB0aGlzLmZpbmRSZXBsYWNlLnRvKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDIpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW19pXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tfaV0ubW92aWVfbmFtZSA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tfaV0ubW92aWVfbmFtZS5yZXBsYWNlKHJlLCB0aGlzLmZpbmRSZXBsYWNlLnRvKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDMpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW19pXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tfaV0uc2VyaWVfbmFtZSA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tfaV0uc2VyaWVfbmFtZS5yZXBsYWNlKHJlLCB0aGlzLmZpbmRSZXBsYWNlLnRvKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuZmlsdGVyZWRTdHJlYW1zLm1hcChmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAgICAgICAgICAgaWYgKF90aGlzMTAuYWN0aXZlR3JvdXBUeXBlID09PSAxKSB7CiAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfbmFtZSA9IHN0cmVhbS5zdHJlYW1fdHZnX25hbWUucmVwbGFjZShyZSwgX3RoaXMxMC5maW5kUmVwbGFjZS50byk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoX3RoaXMxMC5hY3RpdmVHcm91cFR5cGUgPT09IDIpIHsKICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICBzdHJlYW0ubW92aWVfbmFtZSA9IHN0cmVhbS5tb3ZpZV9uYW1lLnJlcGxhY2UocmUsIF90aGlzMTAuZmluZFJlcGxhY2UudG8pOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKF90aGlzMTAuYWN0aXZlR3JvdXBUeXBlID09PSAzKSB7CiAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgc3RyZWFtLnNlcmllX25hbWUgPSBzdHJlYW0uc2VyaWVfbmFtZS5yZXBsYWNlKHJlLCBfdGhpczEwLmZpbmRSZXBsYWNlLnRvKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwogICAgICB9CgogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgICB0aGlzLmZpbmRSZXBsYWNlLm1vZGFsID0gZmFsc2U7CiAgICB9LAogICAgcHJlZml4U3VmZml4TW9kYWw6IGZ1bmN0aW9uIHByZWZpeFN1ZmZpeE1vZGFsKHNob3cpIHsKICAgICAgdmFyIHR5cGUgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IDE7CiAgICAgIHRoaXMucHJlZml4U3VmZml4LnR5cGUgPSB0eXBlOwogICAgICB0aGlzLnByZWZpeFN1ZmZpeC5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgYWRkUHJlZml4U3VmZml4OiBmdW5jdGlvbiBhZGRQcmVmaXhTdWZmaXgoKSB7CiAgICAgIHZhciBwcmVmaXggPSB0aGlzLnByZWZpeFN1ZmZpeC5wcmVmaXg7CiAgICAgIHZhciBzdWZmaXggPSB0aGlzLnByZWZpeFN1ZmZpeC5zdWZmaXg7CgogICAgICBzd2l0Y2ggKHBhcnNlSW50KHRoaXMucHJlZml4U3VmZml4LnR5cGUpKSB7CiAgICAgICAgLy8gR3JvdXAKICAgICAgICBjYXNlIDE6CiAgICAgICAgICBpZiAocGFyc2VJbnQodGhpcy5wcmVmaXhTdWZmaXguc2VsZWN0ZWRPbmx5KSA9PT0gMSkgewogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBzLmluY2x1ZGVzKHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmlkKSkgewogICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uZ3JvdXBfbmFtZSA9IHByZWZpeCArIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmdyb3VwX25hbWUgKyBzdWZmaXg7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLmZpbHRlcmVkR3JvdXBzLm1hcChmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICAgICAgICBncm91cC5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgZ3JvdXAuZ3JvdXBfbmFtZSA9IHByZWZpeCArIGdyb3VwLmdyb3VwX25hbWUgKyBzdWZmaXg7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwogICAgICAgIC8vIFN0cmVhbQoKICAgICAgICBjYXNlIDI6CiAgICAgICAgICBpZiAocGFyc2VJbnQodGhpcy5wcmVmaXhTdWZmaXguc2VsZWN0ZWRPbmx5KSA9PT0gMSkgewogICAgICAgICAgICBmb3IgKHZhciBfaTIgPSAwOyBfaTIgPCB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOyBfaTIrKykgewogICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZVN0cmVhbXMuaW5jbHVkZXModGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW19pMl0uaWQpKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDEpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW19pMl0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbX2kyXS5zdHJlYW1fdHZnX25hbWUgPSBwcmVmaXggKyB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbX2kyXS5zdHJlYW1fdHZnX25hbWUgKyBzdWZmaXg7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tfaTJdLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW19pMl0ubW92aWVfbmFtZSA9IHByZWZpeCArIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tfaTJdLm1vdmllX25hbWUgKyBzdWZmaXg7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAzKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tfaTJdLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW19pMl0uc2VyaWVfbmFtZSA9IHByZWZpeCArIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tfaTJdLnNlcmllX25hbWUgKyBzdWZmaXg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDEpIHsKICAgICAgICAgICAgICB0aGlzLmZpbHRlcmVkU3RyZWFtcy5tYXAoZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX25hbWUgPSBwcmVmaXggKyBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lICsgc3VmZml4OwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDIpIHsKICAgICAgICAgICAgICB0aGlzLmZpbHRlcmVkU3RyZWFtcy5tYXAoZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHN0cmVhbS5tb3ZpZV9uYW1lID0gcHJlZml4ICsgc3RyZWFtLm1vdmllX25hbWUgKyBzdWZmaXg7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMykgewogICAgICAgICAgICAgIHRoaXMuZmlsdGVyZWRTdHJlYW1zLm1hcChmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgc3RyZWFtLnNlcmllX25hbWUgPSBwcmVmaXggKyBzdHJlYW0uc2VyaWVfbmFtZSArIHN1ZmZpeDsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwogICAgICB9CgogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgICB0aGlzLnByZWZpeFN1ZmZpeC5tb2RhbCA9IGZhbHNlOwogICAgfSwKICAgIGNvbnZlcnRDYXNlTW9kYWw6IGZ1bmN0aW9uIGNvbnZlcnRDYXNlTW9kYWwoc2hvdywgdHlwZSkgewogICAgICB0aGlzLmNvbnZlcnRDYXNlLnR5cGUgPSB0eXBlOwogICAgICB0aGlzLmNvbnZlcnRDYXNlLm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBjaGFuZ2VDYXNlOiBmdW5jdGlvbiBjaGFuZ2VDYXNlKCkgewogICAgICB2YXIgX3RoaXMxMSA9IHRoaXM7CgogICAgICB2YXIgbWV0aG9kID0gdGhpcy5jb252ZXJ0Q2FzZS5tZXRob2Q7CiAgICAgIHZhciBncm91cHM7CiAgICAgIHZhciBzdHJlYW1zOwoKICAgICAgaWYgKHBhcnNlSW50KHRoaXMuY29udmVydENhc2Uuc2VsZWN0ZWRPbmx5KSA9PT0gMSkgewogICAgICAgIGdyb3VwcyA9IHRoaXMuZmlsdGVyZWRHcm91cHMuZmlsdGVyKGZ1bmN0aW9uIChncm91cCkgewogICAgICAgICAgcmV0dXJuIF90aGlzMTEuYWN0aXZlR3JvdXBzLmluY2x1ZGVzKGdyb3VwLmlkKTsKICAgICAgICB9KTsKICAgICAgICBzdHJlYW1zID0gdGhpcy5maWx0ZXJlZFN0cmVhbXMuZmlsdGVyKGZ1bmN0aW9uIChzdHJlYW0pIHsKICAgICAgICAgIHJldHVybiBfdGhpczExLmFjdGl2ZVN0cmVhbXMuaW5jbHVkZXMoc3RyZWFtLmlkKTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBncm91cHMgPSB0aGlzLmZpbHRlcmVkR3JvdXBzOwogICAgICAgIHN0cmVhbXMgPSB0aGlzLmZpbHRlcmVkU3RyZWFtczsKICAgICAgfQoKICAgICAgc3dpdGNoIChwYXJzZUludCh0aGlzLmNvbnZlcnRDYXNlLnR5cGUpKSB7CiAgICAgICAgLy8gQ2F0ZWdvcmllcwogICAgICAgIGNhc2UgMToKICAgICAgICAgIGdyb3Vwcy5tYXAoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgICAgIHN3aXRjaCAocGFyc2VJbnQobWV0aG9kKSkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGdyb3VwLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGdyb3VwLmdyb3VwX25hbWUgPSBncm91cC5ncm91cF9uYW1lLnRpdGxlQ2FzZSgpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgIGdyb3VwLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGdyb3VwLmdyb3VwX25hbWUgPSBncm91cC5ncm91cF9uYW1lLnRvVXBwZXJDYXNlKCk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgZ3JvdXAubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgZ3JvdXAuZ3JvdXBfbmFtZSA9IGdyb3VwLmdyb3VwX25hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIC8vIFN0cmVhbXMKCiAgICAgICAgY2FzZSAyOgogICAgICAgICAgc3RyZWFtcy5tYXAoZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgICAgICBzd2l0Y2ggKHBhcnNlSW50KG1ldGhvZCkpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBpZiAoX3RoaXMxMS5hY3RpdmVHcm91cFR5cGUgPT09IDEpIHsKICAgICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfbmFtZSA9IHN0cmVhbS5zdHJlYW1fdHZnX25hbWUudGl0bGVDYXNlKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKF90aGlzMTEuYWN0aXZlR3JvdXBUeXBlID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5tb3ZpZV9uYW1lID0gc3RyZWFtLm1vdmllX25hbWUudGl0bGVDYXNlKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKF90aGlzMTEuYWN0aXZlR3JvdXBUeXBlID09PSAzKSB7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5zZXJpZV9uYW1lID0gc3RyZWFtLnNlcmllX25hbWUudGl0bGVDYXNlKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgIGlmIChfdGhpczExLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMSkgewogICAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lID0gc3RyZWFtLnN0cmVhbV90dmdfbmFtZS50b1VwcGVyQ2FzZSgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChfdGhpczExLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMikgewogICAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICBzdHJlYW0ubW92aWVfbmFtZSA9IHN0cmVhbS5tb3ZpZV9uYW1lLnRvVXBwZXJDYXNlKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKF90aGlzMTEuYWN0aXZlR3JvdXBUeXBlID09PSAzKSB7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5zZXJpZV9uYW1lID0gc3RyZWFtLnNlcmllX25hbWUudG9VcHBlckNhc2UoKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgaWYgKF90aGlzMTEuYWN0aXZlR3JvdXBUeXBlID09PSAxKSB7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX25hbWUgPSBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKF90aGlzMTEuYWN0aXZlR3JvdXBUeXBlID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5tb3ZpZV9uYW1lID0gc3RyZWFtLm1vdmllX25hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoX3RoaXMxMS5hY3RpdmVHcm91cFR5cGUgPT09IDMpIHsKICAgICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgc3RyZWFtLnNlcmllX25hbWUgPSBzdHJlYW0uc2VyaWVfbmFtZS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CgogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgICB0aGlzLmNvbnZlcnRDYXNlLm1vZGFsID0gZmFsc2U7CiAgICB9LAogICAgZWRpdEdyb3VwTW9kYWw6IGZ1bmN0aW9uIGVkaXRHcm91cE1vZGFsKHNob3cpIHsKICAgICAgdmFyIF90aGlzMTIgPSB0aGlzOwoKICAgICAgdmFyIGluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KGZ1bmN0aW9uIChncm91cCkgewogICAgICAgIHJldHVybiBncm91cC5pZCA9PT0gX3RoaXMxMi5hY3RpdmVHcm91cHNbMF07CiAgICAgIH0pOwogICAgICB2YXIgZ3JvdXAgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpbmRleF07CgogICAgICBpZiAoZ3JvdXApIHsKICAgICAgICB0aGlzLmdyb3VwRWRpdG9yLmlkID0gdGhpcy5hY3RpdmVHcm91cHNbMF07CiAgICAgICAgdGhpcy5ncm91cEVkaXRvci5ncm91cF90eXBlID0gZ3JvdXAuZ3JvdXBfdHlwZTsKICAgICAgICB0aGlzLmdyb3VwRWRpdG9yLmdyb3VwX25hbWUgPSBncm91cC5ncm91cF9uYW1lOwogICAgICAgIHRoaXMuZ3JvdXBFZGl0b3IuZ3JvdXBfaXNfaGlkZGVuID0gZ3JvdXAuZ3JvdXBfaXNfaGlkZGVuOwogICAgICAgIHRoaXMuZ3JvdXBFZGl0b3IuZ3JvdXBfcGFyZW50X2NvZGUgPSBncm91cC5ncm91cF9wYXJlbnRfY29kZTsKICAgICAgICB0aGlzLmdyb3VwRWRpdG9yLm1vZGFsID0gc2hvdzsKICAgICAgfQogICAgfSwKICAgIGVkaXRTdHJlYW1Nb2RhbDogZnVuY3Rpb24gZWRpdFN0cmVhbU1vZGFsKHNob3cpIHsKICAgICAgdmFyIF90aGlzMTMgPSB0aGlzOwoKICAgICAgdmFyIGluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmZpbmRJbmRleChmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAgICAgcmV0dXJuIHN0cmVhbS5pZCA9PT0gX3RoaXMxMy5hY3RpdmVTdHJlYW1zWzBdOwogICAgICB9KTsKICAgICAgdmFyIHN0cmVhbSA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF07CgogICAgICBpZiAoc3RyZWFtKSB7CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3IuaWQgPSB0aGlzLmFjdGl2ZVN0cmVhbXNbMF07CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX3R2Z19uYW1lID0gc3RyZWFtLnN0cmVhbV90dmdfbmFtZTsKICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1fdHZnX2lkID0gc3RyZWFtLnN0cmVhbV90dmdfaWQ7CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX3R2Z19sb2dvID0gc3RyZWFtLnN0cmVhbV90dmdfbG9nbzsKICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1fdHZnX2Nobm8gPSBzdHJlYW0uc3RyZWFtX3R2Z19jaG5vOwogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV90dmdfc2hpZnQgPSBzdHJlYW0uc3RyZWFtX3R2Z19zaGlmdDsKICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1fcGFyZW50X2NvZGUgPSBzdHJlYW0uc3RyZWFtX3BhcmVudF9jb2RlOwogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV9hdWRpb190cmFjayA9IHN0cmVhbS5zdHJlYW1fYXVkaW9fdHJhY2s7CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX2FzcGVjdF9yYXRpbyA9IHN0cmVhbS5zdHJlYW1fYXNwZWN0X3JhdGlvOwogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV9yYWRpbyA9IHN0cmVhbS5zdHJlYW1fcmFkaW87CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX2lzX2hpZGRlbiA9IHN0cmVhbS5zdHJlYW1faXNfaGlkZGVuOwogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnNvdXJjZV9zdHJlYW1fdXJsID0gc3RyZWFtLnNvdXJjZV9zdHJlYW1fdXJsOwogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV9pc19jdXN0b20gPSBzdHJlYW0uc3RyZWFtX2lzX2N1c3RvbTsKCiAgICAgICAgaWYgKHN0cmVhbS5tb3ZpZV9uYW1lICE9PSB1bmRlZmluZWQgJiYgc3RyZWFtLm1vdmllX3llYXIgIT09IHVuZGVmaW5lZCAmJiBzdHJlYW0udG1kYl9pZCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5tb3ZpZV9uYW1lID0gc3RyZWFtLm1vdmllX25hbWU7CiAgICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5tb3ZpZV95ZWFyID0gc3RyZWFtLm1vdmllX3llYXI7CiAgICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci50bWRiX2lkID0gc3RyZWFtLnRtZGJfaWQ7CiAgICAgICAgfQoKICAgICAgICBpZiAoc3RyZWFtLnNlcmllX25hbWUgIT09IHVuZGVmaW5lZCAmJiBzdHJlYW0uc2VyaWVfc2Vhc29uICE9PSB1bmRlZmluZWQgJiYgc3RyZWFtLnNlcmllX2VwaXNvZGUgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc2VyaWVfbmFtZSA9IHN0cmVhbS5zZXJpZV9uYW1lOwogICAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc2VyaWVfc2Vhc29uID0gc3RyZWFtLnNlcmllX3NlYXNvbjsKICAgICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnNlcmllX2VwaXNvZGUgPSBzdHJlYW0uc2VyaWVfZXBpc29kZTsKICAgICAgICB9CgogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLm1vZGFsID0gc2hvdzsKICAgICAgfQogICAgfSwKICAgIGVkaXRHcm91cDogZnVuY3Rpb24gZWRpdEdyb3VwKCkgewogICAgICB2YXIgX3RoaXMxNCA9IHRoaXM7CgogICAgICB2YXIgaW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgcmV0dXJuIGdyb3VwLmlkID09PSBfdGhpczE0Lmdyb3VwRWRpdG9yLmlkOwogICAgICB9KTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaW5kZXhdLmdyb3VwX3R5cGUgPSB0aGlzLmdyb3VwRWRpdG9yLmdyb3VwX3R5cGU7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2luZGV4XS5ncm91cF9uYW1lID0gdGhpcy5ncm91cEVkaXRvci5ncm91cF9uYW1lOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpbmRleF0uZ3JvdXBfaXNfaGlkZGVuID0gdGhpcy5ncm91cEVkaXRvci5ncm91cF9pc19oaWRkZW47CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2luZGV4XS5ncm91cF9wYXJlbnRfY29kZSA9IHRoaXMuZ3JvdXBFZGl0b3IuZ3JvdXBfcGFyZW50X2NvZGU7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2luZGV4XS5tb2RpZmllZCA9IHRydWU7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICAgIHRoaXMuZ3JvdXBFZGl0b3IubW9kYWwgPSBmYWxzZTsKICAgIH0sCiAgICBlZGl0U3RyZWFtOiBmdW5jdGlvbiBlZGl0U3RyZWFtKCkgewogICAgICB2YXIgX3RoaXMxNSA9IHRoaXM7CgogICAgICB2YXIgaW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMuZmluZEluZGV4KGZ1bmN0aW9uIChzdHJlYW0pIHsKICAgICAgICByZXR1cm4gc3RyZWFtLmlkID09PSBfdGhpczE1LmFjdGl2ZVN0cmVhbXNbMF07CiAgICAgIH0pOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnN0cmVhbV90dmdfbmFtZSA9IHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV90dmdfbmFtZTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zdHJlYW1fdHZnX2lkID0gdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX3R2Z19pZDsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zdHJlYW1fdHZnX2xvZ28gPSB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1fdHZnX2xvZ287CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc3RyZWFtX3R2Z19jaG5vID0gdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX3R2Z19jaG5vOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnN0cmVhbV90dmdfc2hpZnQgPSB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1fdHZnX3NoaWZ0OwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnN0cmVhbV9wYXJlbnRfY29kZSA9IHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV9wYXJlbnRfY29kZTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zdHJlYW1fYXVkaW9fdHJhY2sgPSB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1fYXVkaW9fdHJhY2s7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc3RyZWFtX2FzcGVjdF9yYXRpbyA9IHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV9hc3BlY3RfcmF0aW87CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc3RyZWFtX2lzX2hpZGRlbiA9IHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV9pc19oaWRkZW47CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc3RyZWFtX3JhZGlvID0gdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX3JhZGlvOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnNvdXJjZV9zdHJlYW1fdXJsID0gdGhpcy5zdHJlYW1FZGl0b3Iuc291cmNlX3N0cmVhbV91cmw7CgogICAgICBpZiAodGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5tb3ZpZV9uYW1lICE9PSB1bmRlZmluZWQgJiYgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5tb3ZpZV95ZWFyICE9PSB1bmRlZmluZWQgJiYgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS50bWRiX2lkICE9PSB1bmRlZmluZWQpIHsKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLm1vdmllX25hbWUgPSB0aGlzLnN0cmVhbUVkaXRvci5tb3ZpZV9uYW1lOwogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0ubW92aWVfeWVhciA9IHRoaXMuc3RyZWFtRWRpdG9yLm1vdmllX3llYXI7CiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS50bWRiX2lkID0gdGhpcy5zdHJlYW1FZGl0b3IudG1kYl9pZDsKICAgICAgfQoKICAgICAgaWYgKHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc2VyaWVfbmFtZSAhPT0gdW5kZWZpbmVkICYmIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc2VyaWVfc2Vhc29uICE9PSB1bmRlZmluZWQgJiYgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zZXJpZV9lcGlzb2RlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnNlcmllX25hbWUgPSB0aGlzLnN0cmVhbUVkaXRvci5zZXJpZV9uYW1lOwogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc2VyaWVfc2Vhc29uID0gdGhpcy5zdHJlYW1FZGl0b3Iuc2VyaWVfc2Vhc29uOwogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc2VyaWVfZXBpc29kZSA9IHRoaXMuc3RyZWFtRWRpdG9yLnNlcmllX2VwaXNvZGU7CiAgICAgIH0KCiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0ubW9kaWZpZWQgPSB0cnVlOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgICB0aGlzLnN0cmVhbUVkaXRvci5tb2RhbCA9IGZhbHNlOwogICAgfSwKICAgIHNvcnRHcm91cEFscGhhVXA6IGZ1bmN0aW9uIHNvcnRHcm91cEFscGhhVXAoKSB7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHJldHVybiBiLmdyb3VwX25hbWUgPiBhLmdyb3VwX25hbWUgPyAxIDogYS5ncm91cF9uYW1lID4gYi5ncm91cF9uYW1lID8gLTEgOiAwOwogICAgICB9KTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMubWFwKGZ1bmN0aW9uIChncm91cCkgewogICAgICAgIHJldHVybiBncm91cC5tb2RpZmllZCA9IHRydWU7CiAgICAgIH0pOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgfSwKICAgIHNvcnRHcm91cEFscGhhRG93bjogZnVuY3Rpb24gc29ydEdyb3VwQWxwaGFEb3duKCkgewogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3VwcyA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICByZXR1cm4gYS5ncm91cF9uYW1lID4gYi5ncm91cF9uYW1lID8gMSA6IGIuZ3JvdXBfbmFtZSA+IGEuZ3JvdXBfbmFtZSA/IC0xIDogMDsKICAgICAgfSk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLm1hcChmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICByZXR1cm4gZ3JvdXAubW9kaWZpZWQgPSB0cnVlOwogICAgICB9KTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgIH0sCiAgICBzb3J0R3JvdXBUeXBlVXA6IGZ1bmN0aW9uIHNvcnRHcm91cFR5cGVVcCgpIHsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgcmV0dXJuIGIuZ3JvdXBfdHlwZSA+IGEuZ3JvdXBfdHlwZSA/IDEgOiBhLmdyb3VwX3R5cGUgPiBiLmdyb3VwX3R5cGUgPyAtMSA6IDA7CiAgICAgIH0pOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5tYXAoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgcmV0dXJuIGdyb3VwLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgfSk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICB9LAogICAgc29ydEdyb3VwVHlwZURvd246IGZ1bmN0aW9uIHNvcnRHcm91cFR5cGVEb3duKCkgewogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3VwcyA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICByZXR1cm4gYS5ncm91cF90eXBlID4gYi5ncm91cF90eXBlID8gMSA6IGIuZ3JvdXBfdHlwZSA+IGEuZ3JvdXBfdHlwZSA/IC0xIDogMDsKICAgICAgfSk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLm1hcChmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICByZXR1cm4gZ3JvdXAubW9kaWZpZWQgPSB0cnVlOwogICAgICB9KTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgIH0sCiAgICBzb3J0U3RyZWFtQWxwaGFVcDogZnVuY3Rpb24gc29ydFN0cmVhbUFscGhhVXAoKSB7CiAgICAgIHZhciBfdGhpczE2ID0gdGhpczsKCiAgICAgIC8vRVJOU1QgSElFUgogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMuc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHN3aXRjaCAoX3RoaXMxNi5hY3RpdmVHcm91cFR5cGUpIHsKICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgcmV0dXJuIGIuc3RyZWFtX3R2Z19uYW1lID4gYS5zdHJlYW1fdHZnX25hbWUgPyAxIDogYS5zdHJlYW1fdHZnX25hbWUgPiBiLnN0cmVhbV90dmdfbmFtZSA/IC0xIDogMDsKCiAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgIHJldHVybiBiLm1vdmllX25hbWUgPiBhLm1vdmllX25hbWUgPyAxIDogYS5tb3ZpZV9uYW1lID4gYi5tb3ZpZV9uYW1lID8gLTEgOiAwOwoKICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgcmV0dXJuIGIuc2VyaWVfbmFtZSA+IGEuc2VyaWVfbmFtZSA/IDEgOiBhLnNlcmllX25hbWUgPiBiLnNlcmllX25hbWUgPyAtMSA6IDA7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLm1hcChmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAgICAgcmV0dXJuIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgIH0pOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgfSwKICAgIHNvcnRTdHJlYW1BbHBoYURvd246IGZ1bmN0aW9uIHNvcnRTdHJlYW1BbHBoYURvd24oKSB7CiAgICAgIHZhciBfdGhpczE3ID0gdGhpczsKCiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcyA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgc3dpdGNoIChfdGhpczE3LmFjdGl2ZUdyb3VwVHlwZSkgewogICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICByZXR1cm4gYS5zdHJlYW1fdHZnX25hbWUgPiBiLnN0cmVhbV90dmdfbmFtZSA/IDEgOiBiLnN0cmVhbV90dmdfbmFtZSA+IGEuc3RyZWFtX3R2Z19uYW1lID8gLTEgOiAwOwoKICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgcmV0dXJuIGEubW92aWVfbmFtZSA+IGIubW92aWVfbmFtZSA/IDEgOiBiLm1vdmllX25hbWUgPiBhLm1vdmllX25hbWUgPyAtMSA6IDA7CgogICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICByZXR1cm4gYS5zZXJpZV9uYW1lID4gYi5zZXJpZV9uYW1lID8gMSA6IGIuc2VyaWVfbmFtZSA+IGEuc2VyaWVfbmFtZSA/IC0xIDogMDsKICAgICAgICB9CiAgICAgIH0pOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubWFwKGZ1bmN0aW9uIChzdHJlYW0pIHsKICAgICAgICByZXR1cm4gc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgfSk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICB9LAogICAgc29ydFN0cmVhbUhpZGRlblVwOiBmdW5jdGlvbiBzb3J0U3RyZWFtSGlkZGVuVXAoKSB7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcyA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgcmV0dXJuIGIuc3RyZWFtX2lzX2hpZGRlbiA+IGEuc3RyZWFtX2lzX2hpZGRlbiA/IDEgOiBhLnN0cmVhbV9pc19oaWRkZW4gPiBiLnN0cmVhbV9pc19oaWRkZW4gPyAtMSA6IDA7CiAgICAgIH0pOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubWFwKGZ1bmN0aW9uIChncm91cCkgewogICAgICAgIHJldHVybiBncm91cC5tb2RpZmllZCA9IHRydWU7CiAgICAgIH0pOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgfSwKICAgIHNvcnRTdHJlYW1IaWRkZW5Eb3duOiBmdW5jdGlvbiBzb3J0U3RyZWFtSGlkZGVuRG93bigpIHsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICByZXR1cm4gYS5zdHJlYW1faXNfaGlkZGVuID4gYi5zdHJlYW1faXNfaGlkZGVuID8gMSA6IGIuc3RyZWFtX2lzX2hpZGRlbiA+IGEuc3RyZWFtX2lzX2hpZGRlbiA/IC0xIDogMDsKICAgICAgfSk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5tYXAoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgcmV0dXJuIGdyb3VwLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgfSk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICB9LAogICAgYWRkR3JvdXA6IGZ1bmN0aW9uIGFkZEdyb3VwKCkgewogICAgICB2YXIgX3RoaXMxOCA9IHRoaXM7CgogICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGh0dHBTZXJ2aWNlLnBvc3QoImVkaXRvci9hZGQtZ3JvdXAiLCB7CiAgICAgICAgcGxheWxpc3RfaWQ6IHRoaXMucGxheWxpc3RFZGl0b3IuaWQKICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgX3RoaXMxOC5pc0xvYWRpbmcgPSBmYWxzZTsKCiAgICAgICAgaWYgKHJlcy5zdGF0dXMgPT09IHRydWUgJiYgcmVzLmRhdGEpIHsKICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkgewogICAgICAgICAgICBfdGhpczE4LnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5wdXNoKHJlcy5kYXRhKTsKCiAgICAgICAgICAgIF90aGlzMTguYWN0aXZlR3JvdXAgPSBfdGhpczE4LnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tfdGhpczE4LnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5sZW5ndGggLSAxXS5pZDsKICAgICAgICAgICAgX3RoaXMxOC5hY3RpdmVHcm91cHMgPSBbX3RoaXMxOC5wbGF5bGlzdEVkaXRvci5ncm91cHNbX3RoaXMxOC5wbGF5bGlzdEVkaXRvci5ncm91cHMubGVuZ3RoIC0gMV0uaWRdOwogICAgICAgICAgICByZXNvbHZlKCk7CiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgX3RoaXMxOC5lZGl0R3JvdXBNb2RhbCh0cnVlKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzMTguaXNMb2FkaW5nID0gZmFsc2U7CgogICAgICAgIF90aGlzMTguJG5vdGlmeSgiZXJyb3IiLCBfdGhpczE4LiR0KCJwcm9maWxlLmZhaWxlZCIpLCBfdGhpczE4LiR0KCJlZGl0b3IuYWRkLWdyb3VwLWVycm9yIiksICJsYS11c2VyLXNoaWVsZCIsIHsKICAgICAgICAgIGR1cmF0aW9uOiA1MDAwLAogICAgICAgICAgcGVybWFuZW50OiBmYWxzZQogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0sCiAgICBhZGRTdHJlYW06IGZ1bmN0aW9uIGFkZFN0cmVhbSgpIHsKICAgICAgdmFyIF90aGlzMTkgPSB0aGlzOwoKICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZS5wb3N0KCJlZGl0b3IvYWRkLXN0cmVhbSIsIHsKICAgICAgICBwbGF5bGlzdF9pZDogdGhpcy5wbGF5bGlzdEVkaXRvci5pZCwKICAgICAgICBncm91cF9pZDogdGhpcy5nZXRHcm91cFdpdGhJZCh0aGlzLmFjdGl2ZUdyb3VwKS5pZCwKICAgICAgICBzdHJlYW1fdHlwZTogdGhpcy5nZXRHcm91cFdpdGhJZCh0aGlzLmFjdGl2ZUdyb3VwKS5ncm91cF90eXBlCiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgIF90aGlzMTkuaXNMb2FkaW5nID0gZmFsc2U7CgogICAgICAgIGlmIChyZXMuc3RhdHVzID09PSB0cnVlICYmIHJlcy5kYXRhKSB7CiAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgICAgICAgICAgX3RoaXMxOS5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLnVuc2hpZnQocmVzLmRhdGEpOwoKICAgICAgICAgICAgX3RoaXMxOS5hY3RpdmVTdHJlYW0gPSBfdGhpczE5LnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbX3RoaXMxOS5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aCAtIDFdLmlkOwogICAgICAgICAgICBfdGhpczE5LmFjdGl2ZVN0cmVhbXMgPSBbX3RoaXMxOS5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW190aGlzMTkucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGggLSAxXS5pZF07CiAgICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgICBfdGhpczE5LmVkaXRTdHJlYW1Nb2RhbCh0cnVlKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzMTkuaXNMb2FkaW5nID0gZmFsc2U7CgogICAgICAgIF90aGlzMTkuJG5vdGlmeSgiZXJyb3IiLCBfdGhpczE5LiR0KCJwcm9maWxlLmZhaWxlZCIpLCBfdGhpczE5LiR0KCJlZGl0b3IuYWRkLXN0cmVhbS1lcnJvciIpLCAibGEtdXNlci1zaGllbGQiLCB7CiAgICAgICAgICBkdXJhdGlvbjogNTAwMCwKICAgICAgICAgIHBlcm1hbmVudDogZmFsc2UKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LAogICAgbG9hZFN0cmVhbXM6IGZ1bmN0aW9uIGxvYWRTdHJlYW1zKCkgewogICAgICB2YXIgX3RoaXMyMCA9IHRoaXM7CgogICAgICB0aGlzLmFjdGl2ZVN0cmVhbSA9IC0xOwogICAgICB0aGlzLmFjdGl2ZVN0cmVhbXMgPSBbXTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zID0gW107CiAgICAgIHZhciBpbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleChmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICByZXR1cm4gZ3JvdXAuaWQgPT09IF90aGlzMjAuYWN0aXZlR3JvdXA7CiAgICAgIH0pOwogICAgICB2YXIgZ3JvdXAgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpbmRleF07CiAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UuZ2V0KCJlZGl0b3Ivc3RyZWFtcy8iLmNvbmNhdCh0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLCAiLyIpLmNvbmNhdChncm91cC5pZCwgIi8iKS5jb25jYXQoZ3JvdXAuZ3JvdXBfdHlwZSkpLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgIGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wID0gMDsKICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wID0gMDsKCiAgICAgICAgaWYgKHJlcy5zdGF0dXMgPT09IHRydWUpIHsKICAgICAgICAgIHZhciBzdHJlYW1zID0gcmVzLmRhdGEubWFwKGZ1bmN0aW9uIChzdHJlYW0pIHsKICAgICAgICAgICAgdmFyIHN0ciA9IE9iamVjdC5hc3NpZ24oe30sIHN0cmVhbSk7CiAgICAgICAgICAgIHN0ci5zb3VyY2Vfc3RyZWFtX3R2Z19uYW1lID0gc3RyZWFtLnN0cmVhbV90dmdfbmFtZTsKICAgICAgICAgICAgc3RyLnNvdXJjZV9zdHJlYW1fdHZnX2lkID0gc3RyZWFtLnN0cmVhbV90dmdfaWQ7CiAgICAgICAgICAgIHN0ci5zb3VyY2Vfc3RyZWFtX3R2Z19sb2dvID0gc3RyZWFtLnN0cmVhbV90dmdfbG9nbzsKICAgICAgICAgICAgc3RyLnNvdXJjZV9zdHJlYW1fdHZnX2Nobm8gPSBzdHJlYW0uc3RyZWFtX3R2Z19jaG5vOwogICAgICAgICAgICBzdHIuc291cmNlX3N0cmVhbV90dmdfc2hpZnQgPSBzdHJlYW0uc3RyZWFtX3R2Z19zaGlmdDsKICAgICAgICAgICAgc3RyLnNvdXJjZV9zdHJlYW1fcGFyZW50X2NvZGUgPSBzdHJlYW0uc3RyZWFtX3BhcmVudF9jb2RlOwogICAgICAgICAgICBzdHIuc291cmNlX3N0cmVhbV9hdWRpb190cmFjayA9IHN0cmVhbS5zdHJlYW1fYXVkaW9fdHJhY2s7CiAgICAgICAgICAgIHN0ci5zb3VyY2Vfc3RyZWFtX2FzcGVjdF9yYXRpbyA9IHN0cmVhbS5zdHJlYW1fYXNwZWN0X3JhdGlvOwogICAgICAgICAgICBzdHIuc291cmNlX3N0cmVhbV9yYWRpbyA9IHN0cmVhbS5zdHJlYW1fcmFkaW87CiAgICAgICAgICAgIHN0ci5zb3VyY2Vfc3RyZWFtX29yZGVyID0gc3RyZWFtLnN0cmVhbV9vcmRlcjsKICAgICAgICAgICAgc3RyLnNvdXJjZV9zdHJlYW1faXNfaGlkZGVuID0gc3RyZWFtLnN0cmVhbV9pc19oaWRkZW47CiAgICAgICAgICAgIHN0ci5tb2RpZmllZCA9IGZhbHNlOwogICAgICAgICAgICBzdHIuc3RyZWFtX2lzX3JlbW92ZWQgPSAwOwoKICAgICAgICAgICAgaWYgKGdyb3VwLmdyb3VwX3R5cGUgPT0gMikgewogICAgICAgICAgICAgIGlmIChzdHIubW92aWVfbmFtZSA9PSAiIikgewogICAgICAgICAgICAgICAgc3RyLm1vdmllX25hbWUgPSBzdHIuc3RyZWFtX3R2Z19uYW1lOwogICAgICAgICAgICAgICAgc3RyLnNvdXJjZV9tb3ZpZV9uYW1lID0gc3RyLnN0cmVhbV90dmdfbmFtZTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgc3RyLnNvdXJjZV9tb3ZpZV9uYW1lID0gc3RyZWFtLm1vdmllX25hbWU7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBzdHIuc291cmNlX21vdmllX3llYXIgPSBzdHJlYW0ubW92aWVfeWVhcjsKICAgICAgICAgICAgICBzdHIuc291cmNlX3RtZGJfaWQgPSBzdHJlYW0udG1kYl9pZDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGdyb3VwLmdyb3VwX3R5cGUgPT0gMykgewogICAgICAgICAgICAgIGlmIChzdHIuc2VyaWVfbmFtZSA9PSAiIikgewogICAgICAgICAgICAgICAgc3RyLnNlcmllX25hbWUgPSBzdHIuc3RyZWFtX3R2Z19uYW1lOwogICAgICAgICAgICAgICAgc3RyLnNvdXJjZV9zZXJpZV9uYW1lID0gc3RyLnN0cmVhbV90dmdfbmFtZTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgc3RyLnNvdXJjZV9zZXJpZV9uYW1lID0gc3RyZWFtLnNlcmllX25hbWU7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBzdHIuc291cmNlX3NlcmllX3NlYXNvbiA9IHN0cmVhbS5zZXJpZV9zZWFzb247CiAgICAgICAgICAgICAgc3RyLnNvdXJjZV9zZXJpZV9lcGlzb2RlID0gc3RyZWFtLnNlcmllX2VwaXNvZGU7CiAgICAgICAgICAgICAgc3RyLnNvdXJjZV90bWRiX2lkID0gc3RyZWFtLnRtZGJfaWQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBzdHI7CiAgICAgICAgICB9KTsKICAgICAgICAgIHN0cmVhbXMuc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgICByZXR1cm4gYS5zb3VyY2Vfc3RyZWFtX29yZGVyID4gYi5zb3VyY2Vfc3RyZWFtX29yZGVyID8gMSA6IGIuc291cmNlX3N0cmVhbV9vcmRlciA+IGEuc291cmNlX3N0cmVhbV9vcmRlciA/IC0xIDogMDsKICAgICAgICAgIH0pOwogICAgICAgICAgX3RoaXMyMC5wbGF5bGlzdEVkaXRvci5zdHJlYW1zID0gc3RyZWFtczsKICAgICAgICAgIF90aGlzMjAuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIF90aGlzMjAuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMyMC5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfSk7CiAgICB9LAogICAgbW92ZVRvU2VsZWN0ZWRHcm91cDogZnVuY3Rpb24gbW92ZVRvU2VsZWN0ZWRHcm91cCgpIHsKICAgICAgdmFyIF90aGlzMjEgPSB0aGlzOwoKICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlOwogICAgICB2YXIgc3RyZWFtcyA9IHRoaXMuYWN0aXZlU3RyZWFtcy5qb2luKCk7CiAgICAgIHZhciBpbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleChmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICByZXR1cm4gZ3JvdXAuaWQgPT0gX3RoaXMyMS5hY3RpdmVHcm91cDsKICAgICAgfSk7CiAgICAgIGh0dHBTZXJ2aWNlLnBvc3QoImVkaXRvci9tb3ZlLXRvLWdyb3VwLyIuY29uY2F0KHRoaXMuYWN0aXZlR3JvdXBUeXBlKSwgewogICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgIHN0cmVhbXM6IHN0cmVhbXMsCiAgICAgICAgZ3JvdXBfaWQ6IHRoaXMuYWN0aXZlR3JvdXBzWzBdCiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgIF90aGlzMjEuaXNMb2FkaW5nID0gZmFsc2U7CgogICAgICAgIGlmIChyZXMuc3RhdHVzICYmIHJlcy5kYXRhKSB7CiAgICAgICAgICBfdGhpczIxLmxvYWRQbGF5bGlzdChfdGhpczIxLnBsYXlsaXN0RWRpdG9yLmlkLCBpbmRleCk7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMyMS5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfSk7CiAgICB9LAogICAgc2F2ZUNoYW5nZXNNb2RhbDogZnVuY3Rpb24gc2F2ZUNoYW5nZXNNb2RhbChzaG93KSB7CiAgICAgIHZhciBzYXZlID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiBmYWxzZTsKICAgICAgdGhpcy5zYXZlQ2hhbmdlcy5tb2RhbCA9IHNob3c7CgogICAgICBpZiAoc2F2ZSkgewogICAgICAgIHRoaXMuZG9TYXZlKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5sb2FkU3RyZWFtcygpOwogICAgICB9CiAgICB9LAogICAgcmFkaW9Ccm93c2VyTW9kYWw6IGZ1bmN0aW9uIHJhZGlvQnJvd3Nlck1vZGFsKHNob3cpIHsKICAgICAgdmFyIF90aGlzMjIgPSB0aGlzOwoKICAgICAgdmFyIHNhdmUgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IGZhbHNlOwoKICAgICAgaWYgKHNob3cpIHsKICAgICAgICB0aGlzLnJhZGlvQnJvd3Nlci5zZWFyY2ggPSAiIjsKICAgICAgICB0aGlzLnJhZGlvQnJvd3Nlci5yZXN1bHRzID0gW107CiAgICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuYWN0aXZlID0gW107CiAgICAgIH0KCiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlOwogICAgICAgIHZhciBncm91cEluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KGZ1bmN0aW9uIChncm91cCkgewogICAgICAgICAgcmV0dXJuIGdyb3VwLmlkID09IF90aGlzMjIuYWN0aXZlR3JvdXA7CiAgICAgICAgfSk7CiAgICAgICAgdmFyIG9yZGVyID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsKICAgICAgICB2YXIgc3RyZWFtcyA9IHRoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZS5tYXAoZnVuY3Rpb24gKGluZGV4KSB7CiAgICAgICAgICB2YXIgcmFkaW8gPSBfdGhpczIyLnJhZGlvQnJvd3Nlci5yZXN1bHRzW2luZGV4XTsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHNvdXJjZV9zdHJlYW1fdXJsOiByYWRpby51cmwsCiAgICAgICAgICAgIHN0cmVhbV90dmdfbmFtZTogcmFkaW8ubmFtZSwKICAgICAgICAgICAgc3RyZWFtX3R2Z19pZDogIiIsCiAgICAgICAgICAgIHN0cmVhbV90dmdfbG9nbzogcmFkaW8uZmF2aWNvbiwKICAgICAgICAgICAgc3RyZWFtX3JhZGlvOiB0cnVlLAogICAgICAgICAgICBzdHJlYW1fb3JkZXI6IG9yZGVyKysKICAgICAgICAgIH07CiAgICAgICAgfSk7CiAgICAgICAgaHR0cFNlcnZpY2UucG9zdCgiZWRpdG9yL2FkZC1zdHJlYW1zLyIuY29uY2F0KHRoaXMuYWN0aXZlR3JvdXBUeXBlKSwgewogICAgICAgICAgcGxheWxpc3RfaWQ6IHRoaXMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICBncm91cF9pZDogdGhpcy5nZXRHcm91cFdpdGhJZCh0aGlzLmFjdGl2ZUdyb3VwKS5pZCwKICAgICAgICAgIHN0cmVhbXM6IHN0cmVhbXMKICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICAgIF90aGlzMjIuaXNMb2FkaW5nID0gZmFsc2U7CgogICAgICAgICAgaWYgKHJlcy5zdGF0dXMpIHsKICAgICAgICAgICAgX3RoaXMyMi5sb2FkUGxheWxpc3QoX3RoaXMyMi5wbGF5bGlzdEVkaXRvci5pZCwgZ3JvdXBJbmRleCk7CiAgICAgICAgICB9CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkgewogICAgICAgICAgX3RoaXMyMi5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGZpbmRSYWRpb2Jyb3dzZXI6IGZ1bmN0aW9uIGZpbmRSYWRpb2Jyb3dzZXIoc2VhcmNoKSB7CiAgICAgIHZhciBfdGhpczIzID0gdGhpczsKCiAgICAgIGlmIChzZWFyY2gubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIucmVzdWx0cyA9IFtdOwogICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZSA9IFtdOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLmlzTG9hZGluZyA9IHRydWU7CiAgICAgICAgaHR0cFNlcnZpY2UucG9zdCgiZWRpdG9yL2ZpbmQtcmFkaW9icm93c2VyIiwgewogICAgICAgICAgc2VhcmNoOiBzZWFyY2gKICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICAgIF90aGlzMjMucmFkaW9Ccm93c2VyLmFjdGl2ZSA9IFtdOwoKICAgICAgICAgIGlmIChyZXMuc3RhdHVzKSB7CiAgICAgICAgICAgIF90aGlzMjMucmFkaW9Ccm93c2VyLnJlc3VsdHMgPSByZXMuZGF0YTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF90aGlzMjMucmFkaW9Ccm93c2VyLnJlc3VsdHMgPSBbXTsKICAgICAgICAgIH0KCiAgICAgICAgICBfdGhpczIzLnJhZGlvQnJvd3Nlci5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBfdGhpczIzLnJhZGlvQnJvd3Nlci5hY3RpdmUgPSBbXTsKICAgICAgICAgIF90aGlzMjMucmFkaW9Ccm93c2VyLnJlc3VsdHMgPSBbXTsKICAgICAgICAgIF90aGlzMjMucmFkaW9Ccm93c2VyLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgc291bmRjbG91ZE1vZGFsOiBmdW5jdGlvbiBzb3VuZGNsb3VkTW9kYWwoc2hvdykgewogICAgICB2YXIgX3RoaXMyNCA9IHRoaXM7CgogICAgICB2YXIgc2F2ZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogZmFsc2U7CgogICAgICBpZiAoc2hvdykgewogICAgICAgIHRoaXMuc291bmRjbG91ZC51cmwgPSAiIjsKICAgICAgICB0aGlzLnNvdW5kY2xvdWQudHJhY2sgPSBudWxsOwogICAgICB9CgogICAgICBpZiAoc2F2ZSkgewogICAgICAgIGlmICh0aGlzLnNvdW5kY2xvdWQudHJhY2spIHsKICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgIHZhciBncm91cEluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KGZ1bmN0aW9uIChncm91cCkgewogICAgICAgICAgICByZXR1cm4gZ3JvdXAuaWQgPT0gX3RoaXMyNC5hY3RpdmVHcm91cDsKICAgICAgICAgIH0pOwogICAgICAgICAgdmFyIG9yZGVyID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsKICAgICAgICAgIHZhciBzdHJlYW1zID0gW3sKICAgICAgICAgICAgc291cmNlX3N0cmVhbV91cmw6IHRoaXMuc291bmRjbG91ZC51cmwsCiAgICAgICAgICAgIHN0cmVhbV90dmdfbmFtZTogdGhpcy5zb3VuZGNsb3VkLnRyYWNrLnRpdGxlLAogICAgICAgICAgICBzdHJlYW1fdHZnX2lkOiAiIiwKICAgICAgICAgICAgc3RyZWFtX3R2Z19sb2dvOiB0aGlzLnNvdW5kY2xvdWQudHJhY2suYXJ0d29ya191cmwucmVwbGFjZSgibGFyZ2UuanBnIiwgInQ1MDB4NTAwLmpwZyIpLAogICAgICAgICAgICBzdHJlYW1fcmFkaW86IHRydWUsCiAgICAgICAgICAgIHN0cmVhbV9vcmRlcjogb3JkZXIrKwogICAgICAgICAgfV07CiAgICAgICAgICBodHRwU2VydmljZS5wb3N0KCJlZGl0b3IvYWRkLXN0cmVhbXMvIi5jb25jYXQodGhpcy5hY3RpdmVHcm91cFR5cGUpLCB7CiAgICAgICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgICBncm91cF9pZDogdGhpcy5nZXRHcm91cFdpdGhJZCh0aGlzLmFjdGl2ZUdyb3VwKS5pZCwKICAgICAgICAgICAgc3RyZWFtczogc3RyZWFtcwogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICAgIF90aGlzMjQuaXNMb2FkaW5nID0gZmFsc2U7CgogICAgICAgICAgICBpZiAocmVzLnN0YXR1cykgewogICAgICAgICAgICAgIF90aGlzMjQubG9hZFBsYXlsaXN0KF90aGlzMjQucGxheWxpc3RFZGl0b3IuaWQsIGdyb3VwSW5kZXgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIF90aGlzMjQuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuc291bmRjbG91ZC5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgZ2V0U291bmRjbG91ZFRyYWNrOiBmdW5jdGlvbiBnZXRTb3VuZGNsb3VkVHJhY2sodXJsLCBjbGllbnRfaWQpIHsKICAgICAgdmFyIF90aGlzMjUgPSB0aGlzOwoKICAgICAgaWYgKHVybC5sZW5ndGggPT09IDAgfHwgIS9zb3VuZGNsb3VkXC5jb20vLnRlc3QodXJsKSkgewogICAgICAgIHRoaXMuc291bmRjbG91ZC51cmwgPSAiIjsKICAgICAgICB0aGlzLnNvdW5kY2xvdWQudHJhY2sgPSBudWxsOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc291bmRjbG91ZC5pc0xvYWRpbmcgPSB0cnVlOwogICAgICAgIGh0dHBTZXJ2aWNlLnBvc3QoImVkaXRvci9zb3VuZGNsb3VkLXRyYWNrIiwgewogICAgICAgICAgdXJsOiB1cmwsCiAgICAgICAgICBjbGllbnRfaWQ6IGNsaWVudF9pZAogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgICAgaWYgKHJlcy5zdGF0dXMgJiYgT2JqZWN0LmtleXMocmVzLmRhdGEpLmxlbmd0aCkgewogICAgICAgICAgICBfdGhpczI1LnNvdW5kY2xvdWQudHJhY2sgPSByZXMuZGF0YTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF90aGlzMjUuc291bmRjbG91ZC50cmFjayA9IG51bGw7CiAgICAgICAgICB9CgogICAgICAgICAgX3RoaXMyNS5zb3VuZGNsb3VkLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIF90aGlzMjUuc291bmRjbG91ZC50cmFjayA9IG51bGw7CiAgICAgICAgICBfdGhpczI1LnNvdW5kY2xvdWQuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICB5b3V0dWJlTW9kYWw6IGZ1bmN0aW9uIHlvdXR1YmVNb2RhbChzaG93KSB7CiAgICAgIHZhciBfdGhpczI2ID0gdGhpczsKCiAgICAgIHZhciBzYXZlID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiBmYWxzZTsKCiAgICAgIGlmIChzaG93KSB7CiAgICAgICAgdGhpcy55b3V0dWJlLnVybCA9ICIiOwogICAgICAgIHRoaXMueW91dHViZS52aWRlbyA9IG51bGw7CiAgICAgICAgdGhpcy55b3V0dWJlLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9CgogICAgICBpZiAoc2F2ZSkgewogICAgICAgIGlmICh0aGlzLnlvdXR1YmUudmlkZW8pIHsKICAgICAgICAgIHRoaXMueW91dHViZS5pc0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgdmFyIGdyb3VwSW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgICAgIHJldHVybiBncm91cC5pZCA9PSBfdGhpczI2LmFjdGl2ZUdyb3VwOwogICAgICAgICAgfSk7CiAgICAgICAgICB2YXIgb3JkZXIgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOwogICAgICAgICAgdmFyIHN0cmVhbXMgPSBbewogICAgICAgICAgICBzb3VyY2Vfc3RyZWFtX3VybDogdGhpcy55b3V0dWJlLnVybCwKICAgICAgICAgICAgc3RyZWFtX3R2Z19uYW1lOiB0aGlzLnlvdXR1YmUudmlkZW8udmlkZW9EZXRhaWxzLnRpdGxlLAogICAgICAgICAgICBzdHJlYW1fdHZnX2lkOiAiIiwKICAgICAgICAgICAgc3RyZWFtX3R2Z19sb2dvOiAiaHR0cDovL2kueXRpbWcuY29tL3ZpLyIuY29uY2F0KHRoaXMueW91dHViZS52aWRlb0lkLCAiL21heHJlc2RlZmF1bHQuanBnIiksCiAgICAgICAgICAgIHN0cmVhbV9vcmRlcjogb3JkZXIrKwogICAgICAgICAgfV07CiAgICAgICAgICBodHRwU2VydmljZS5wb3N0KCJlZGl0b3IvYWRkLXN0cmVhbXMvIi5jb25jYXQodGhpcy5hY3RpdmVHcm91cFR5cGUpLCB7CiAgICAgICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgICBncm91cF9pZDogdGhpcy5nZXRHcm91cFdpdGhJZCh0aGlzLmFjdGl2ZUdyb3VwKS5pZCwKICAgICAgICAgICAgc3RyZWFtczogc3RyZWFtcwogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICAgIF90aGlzMjYueW91dHViZS5pc0xvYWRpbmcgPSBmYWxzZTsKCiAgICAgICAgICAgIGlmIChyZXMuc3RhdHVzKSB7CiAgICAgICAgICAgICAgX3RoaXMyNi5sb2FkUGxheWxpc3QoX3RoaXMyNi5wbGF5bGlzdEVkaXRvci5pZCwgZ3JvdXBJbmRleCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgX3RoaXMyNi55b3V0dWJlLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLnlvdXR1YmUubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGdldFlvdXR1YmVQYWdlOiBmdW5jdGlvbiBnZXRZb3V0dWJlUGFnZSh2aWRlb0lkKSB7CiAgICAgIHZhciBfdGhpczI3ID0gdGhpczsKCiAgICAgIHRoaXMueW91dHViZS5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZS5wb3N0KCJlZGl0b3IveW91dHViZS12aWRlbyIsIHsKICAgICAgICB2aWRlb19pZDogdmlkZW9JZAogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICBpZiAocmVzLnN0YXR1cyAmJiBPYmplY3Qua2V5cyhyZXMuZGF0YSkubGVuZ3RoKSB7CiAgICAgICAgICBfdGhpczI3LnlvdXR1YmUudmlkZW8gPSByZXMuZGF0YTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgX3RoaXMyNy55b3V0dWJlLnZpZGVvID0gbnVsbDsKICAgICAgICB9CgogICAgICAgIF90aGlzMjcueW91dHViZS5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzMjcueW91dHViZS52aWRlbyA9IG51bGw7CiAgICAgICAgX3RoaXMyNy55b3V0dWJlLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9KTsKICAgIH0sCiAgICB2aW1lb01vZGFsOiBmdW5jdGlvbiB2aW1lb01vZGFsKHNob3cpIHsKICAgICAgdmFyIF90aGlzMjggPSB0aGlzOwoKICAgICAgdmFyIHNhdmUgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IGZhbHNlOwoKICAgICAgaWYgKHNob3cpIHsKICAgICAgICB0aGlzLnZpbWVvLnVybCA9ICIiOwogICAgICAgIHRoaXMudmltZW8udmlkZW8gPSBudWxsOwogICAgICAgIHRoaXMudmltZW8uaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgaWYgKHRoaXMudmltZW8udmlkZW8pIHsKICAgICAgICAgIHRoaXMudmltZW8uaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgIHZhciBncm91cEluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KGZ1bmN0aW9uIChncm91cCkgewogICAgICAgICAgICByZXR1cm4gZ3JvdXAuaWQgPT0gX3RoaXMyOC5hY3RpdmVHcm91cDsKICAgICAgICAgIH0pOwogICAgICAgICAgdmFyIG9yZGVyID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsKICAgICAgICAgIHZhciBzdHJlYW1zID0gW3sKICAgICAgICAgICAgc291cmNlX3N0cmVhbV91cmw6IHRoaXMudmltZW8udXJsLAogICAgICAgICAgICBzdHJlYW1fdHZnX25hbWU6IHRoaXMudmltZW8udmlkZW8udmlkZW8udGl0bGUsCiAgICAgICAgICAgIHN0cmVhbV90dmdfaWQ6ICIiLAogICAgICAgICAgICBzdHJlYW1fdHZnX2xvZ286IHRoaXMudmltZW8udmlkZW8udmlkZW8udGh1bWJzLmJhc2UsCiAgICAgICAgICAgIHN0cmVhbV9vcmRlcjogb3JkZXIrKwogICAgICAgICAgfV07CiAgICAgICAgICBodHRwU2VydmljZS5wb3N0KCJlZGl0b3IvYWRkLXN0cmVhbXMvIi5jb25jYXQodGhpcy5hY3RpdmVHcm91cFR5cGUpLCB7CiAgICAgICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgICBncm91cF9pZDogdGhpcy5nZXRHcm91cFdpdGhJZCh0aGlzLmFjdGl2ZUdyb3VwKS5pZCwKICAgICAgICAgICAgc3RyZWFtczogc3RyZWFtcwogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICAgIF90aGlzMjgudmltZW8uaXNMb2FkaW5nID0gZmFsc2U7CgogICAgICAgICAgICBpZiAocmVzLnN0YXR1cykgewogICAgICAgICAgICAgIF90aGlzMjgubG9hZFBsYXlsaXN0KF90aGlzMjgucGxheWxpc3RFZGl0b3IuaWQsIGdyb3VwSW5kZXgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIF90aGlzMjgudmltZW8uaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMudmltZW8ubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGdldFZpbWVvQ29uZmlnOiBmdW5jdGlvbiBnZXRWaW1lb0NvbmZpZyh2aWRlb0lkKSB7CiAgICAgIHZhciBfdGhpczI5ID0gdGhpczsKCiAgICAgIHRoaXMudmltZW8uaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UucG9zdCgiZWRpdG9yL3ZpbWVvLXZpZGVvIiwgewogICAgICAgIHZpZGVvX2lkOiB2aWRlb0lkCiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgIF90aGlzMjkudmltZW8udmlkZW8gPSByZXMuZGF0YTsKICAgICAgICBfdGhpczI5LnZpbWVvLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9KTsKICAgIH0sCiAgICBkYWlseW1vdGlvbk1vZGFsOiBmdW5jdGlvbiBkYWlseW1vdGlvbk1vZGFsKHNob3cpIHsKICAgICAgdmFyIF90aGlzMzAgPSB0aGlzOwoKICAgICAgdmFyIHNhdmUgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IGZhbHNlOwoKICAgICAgaWYgKHNob3cpIHsKICAgICAgICB0aGlzLmRhaWx5bW90aW9uLnVybCA9ICIiOwogICAgICAgIHRoaXMuZGFpbHltb3Rpb24udmlkZW8gPSBudWxsOwogICAgICAgIHRoaXMuZGFpbHltb3Rpb24uaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgaWYgKHRoaXMuZGFpbHltb3Rpb24udmlkZW8pIHsKICAgICAgICAgIHRoaXMuZGFpbHltb3Rpb24uaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgIHZhciBncm91cEluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KGZ1bmN0aW9uIChncm91cCkgewogICAgICAgICAgICByZXR1cm4gZ3JvdXAuaWQgPT0gX3RoaXMzMC5hY3RpdmVHcm91cDsKICAgICAgICAgIH0pOwogICAgICAgICAgdmFyIG9yZGVyID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsKICAgICAgICAgIHZhciBzdHJlYW1zID0gW3sKICAgICAgICAgICAgc291cmNlX3N0cmVhbV91cmw6IHRoaXMuZGFpbHltb3Rpb24udXJsLAogICAgICAgICAgICBzdHJlYW1fdHZnX25hbWU6IHRoaXMuZGFpbHltb3Rpb24udmlkZW8udGl0bGUsCiAgICAgICAgICAgIHN0cmVhbV90dmdfaWQ6ICIiLAogICAgICAgICAgICBzdHJlYW1fdHZnX2xvZ286IHRoaXMuZGFpbHltb3Rpb24udmlkZW8udGh1bWJuYWlsXzEwODBfdXJsLAogICAgICAgICAgICBzdHJlYW1fb3JkZXI6IG9yZGVyKysKICAgICAgICAgIH1dOwogICAgICAgICAgaHR0cFNlcnZpY2UucG9zdCgiZWRpdG9yL2FkZC1zdHJlYW1zLyIuY29uY2F0KHRoaXMuYWN0aXZlR3JvdXBUeXBlKSwgewogICAgICAgICAgICBwbGF5bGlzdF9pZDogdGhpcy5wbGF5bGlzdEVkaXRvci5pZCwKICAgICAgICAgICAgZ3JvdXBfaWQ6IHRoaXMuZ2V0R3JvdXBXaXRoSWQodGhpcy5hY3RpdmVHcm91cCkuaWQsCiAgICAgICAgICAgIHN0cmVhbXM6IHN0cmVhbXMKICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgICAgICBfdGhpczMwLmRhaWx5bW90aW9uLmlzTG9hZGluZyA9IGZhbHNlOwoKICAgICAgICAgICAgaWYgKHJlcy5zdGF0dXMpIHsKICAgICAgICAgICAgICBfdGhpczMwLmxvYWRQbGF5bGlzdChfdGhpczMwLnBsYXlsaXN0RWRpdG9yLmlkLCBncm91cEluZGV4KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkgewogICAgICAgICAgICBfdGhpczMwLmRhaWx5bW90aW9uLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmRhaWx5bW90aW9uLm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBnZXREYWlseW1vdGlvbkNvbmZpZzogZnVuY3Rpb24gZ2V0RGFpbHltb3Rpb25Db25maWcodmlkZW9JZCkgewogICAgICB2YXIgX3RoaXMzMSA9IHRoaXM7CgogICAgICB0aGlzLmRhaWx5bW90aW9uLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGh0dHBTZXJ2aWNlLnBvc3QoImVkaXRvci9kYWlseW1vdGlvbi12aWRlbyIsIHsKICAgICAgICB2aWRlb19pZDogdmlkZW9JZAogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICBfdGhpczMxLmRhaWx5bW90aW9uLnZpZGVvID0gcmVzLmRhdGE7CiAgICAgICAgX3RoaXMzMS5kYWlseW1vdGlvbi5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfSk7CiAgICB9LAogICAgdGVkVGFsa3NNb2RhbDogZnVuY3Rpb24gdGVkVGFsa3NNb2RhbChzaG93KSB7CiAgICAgIHZhciBfdGhpczMyID0gdGhpczsKCiAgICAgIHZhciBzYXZlID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiBmYWxzZTsKCiAgICAgIGlmIChzaG93KSB7CiAgICAgICAgdGhpcy50ZWRUYWxrcy51cmwgPSAiIjsKICAgICAgICB0aGlzLnRlZFRhbGtzLnZpZGVvID0gbnVsbDsKICAgICAgICB0aGlzLnRlZFRhbGtzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9CgogICAgICBpZiAoc2F2ZSkgewogICAgICAgIGlmICh0aGlzLnRlZFRhbGtzLnZpZGVvKSB7CiAgICAgICAgICB0aGlzLnRlZFRhbGtzLmlzTG9hZGluZyA9IHRydWU7CiAgICAgICAgICB2YXIgZ3JvdXBJbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleChmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICAgICAgcmV0dXJuIGdyb3VwLmlkID09IF90aGlzMzIuYWN0aXZlR3JvdXA7CiAgICAgICAgICB9KTsKICAgICAgICAgIHZhciBvcmRlciA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7CiAgICAgICAgICB2YXIgc3RyZWFtcyA9IFt7CiAgICAgICAgICAgIHNvdXJjZV9zdHJlYW1fdXJsOiB0aGlzLnRlZFRhbGtzLnVybCwKICAgICAgICAgICAgc3RyZWFtX3R2Z19uYW1lOiB0aGlzLnRlZFRhbGtzLnZpZGVvLnRpdGxlLAogICAgICAgICAgICBzdHJlYW1fdHZnX2lkOiAiIiwKICAgICAgICAgICAgc3RyZWFtX3R2Z19sb2dvOiB0aGlzLnRlZFRhbGtzLnZpZGVvLmhlcm8sCiAgICAgICAgICAgIHN0cmVhbV9vcmRlcjogb3JkZXIrKwogICAgICAgICAgfV07CiAgICAgICAgICBodHRwU2VydmljZS5wb3N0KCJlZGl0b3IvYWRkLXN0cmVhbXMvIi5jb25jYXQodGhpcy5hY3RpdmVHcm91cFR5cGUpLCB7CiAgICAgICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgICBncm91cF9pZDogdGhpcy5nZXRHcm91cFdpdGhJZCh0aGlzLmFjdGl2ZUdyb3VwKS5pZCwKICAgICAgICAgICAgc3RyZWFtczogc3RyZWFtcwogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICAgIF90aGlzMzIudGVkVGFsa3MuaXNMb2FkaW5nID0gZmFsc2U7CgogICAgICAgICAgICBpZiAocmVzLnN0YXR1cykgewogICAgICAgICAgICAgIF90aGlzMzIubG9hZFBsYXlsaXN0KF90aGlzMzIucGxheWxpc3RFZGl0b3IuaWQsIGdyb3VwSW5kZXgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIF90aGlzMzIudGVkVGFsa3MuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMudGVkVGFsa3MubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGdldFRlZFRhbGtzQ29uZmlnOiBmdW5jdGlvbiBnZXRUZWRUYWxrc0NvbmZpZyh1cmwpIHsKICAgICAgdmFyIF90aGlzMzMgPSB0aGlzOwoKICAgICAgdGhpcy50ZWRUYWxrcy5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZS5wb3N0KCJlZGl0b3IvdGVkLXRhbGtzLXZpZGVvIiwgewogICAgICAgIHVybDogdXJsCiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgIF90aGlzMzMudGVkVGFsa3MudmlkZW8gPSByZXMuZGF0YS50YWxrcy5sZW5ndGggPyByZXMuZGF0YS50YWxrc1swXSA6IG51bGw7CiAgICAgICAgX3RoaXMzMy50ZWRUYWxrcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfSk7CiAgICB9LAogICAgeGhhbXN0ZXJNb2RhbDogZnVuY3Rpb24geGhhbXN0ZXJNb2RhbChzaG93KSB7CiAgICAgIHZhciBfdGhpczM0ID0gdGhpczsKCiAgICAgIHZhciBzYXZlID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiBmYWxzZTsKCiAgICAgIGlmIChzaG93KSB7CiAgICAgICAgdGhpcy54aGFtc3Rlci51cmwgPSAiIjsKICAgICAgICB0aGlzLnhoYW1zdGVyLnZpZGVvID0gbnVsbDsKICAgICAgICB0aGlzLnhoYW1zdGVyLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9CgogICAgICBpZiAoc2F2ZSkgewogICAgICAgIGlmICh0aGlzLnhoYW1zdGVyLnZpZGVvKSB7CiAgICAgICAgICB0aGlzLnhoYW1zdGVyLmlzTG9hZGluZyA9IHRydWU7CiAgICAgICAgICB2YXIgZ3JvdXBJbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleChmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICAgICAgcmV0dXJuIGdyb3VwLmlkID09IF90aGlzMzQuYWN0aXZlR3JvdXA7CiAgICAgICAgICB9KTsKICAgICAgICAgIHZhciBvcmRlciA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7CiAgICAgICAgICB2YXIgc3RyZWFtcyA9IFt7CiAgICAgICAgICAgIHNvdXJjZV9zdHJlYW1fdXJsOiB0aGlzLnhoYW1zdGVyLnVybCwKICAgICAgICAgICAgc3RyZWFtX3R2Z19uYW1lOiB0aGlzLnhoYW1zdGVyLnZpZGVvLnZpZGVvRW50aXR5LnRpdGxlLAogICAgICAgICAgICBzdHJlYW1fdHZnX2lkOiAiIiwKICAgICAgICAgICAgc3RyZWFtX3R2Z19sb2dvOiB0aGlzLnhoYW1zdGVyLnZpZGVvLnZpZGVvRW50aXR5LnRodW1iQmlnLAogICAgICAgICAgICBzdHJlYW1fb3JkZXI6IG9yZGVyKysKICAgICAgICAgIH1dOwogICAgICAgICAgaHR0cFNlcnZpY2UucG9zdCgiZWRpdG9yL2FkZC1zdHJlYW1zLyIuY29uY2F0KHRoaXMuYWN0aXZlR3JvdXBUeXBlKSwgewogICAgICAgICAgICBwbGF5bGlzdF9pZDogdGhpcy5wbGF5bGlzdEVkaXRvci5pZCwKICAgICAgICAgICAgZ3JvdXBfaWQ6IHRoaXMuZ2V0R3JvdXBXaXRoSWQodGhpcy5hY3RpdmVHcm91cCkuaWQsCiAgICAgICAgICAgIHN0cmVhbXM6IHN0cmVhbXMKICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgICAgICBfdGhpczM0LnhoYW1zdGVyLmlzTG9hZGluZyA9IGZhbHNlOwoKICAgICAgICAgICAgaWYgKHJlcy5zdGF0dXMpIHsKICAgICAgICAgICAgICBfdGhpczM0LmxvYWRQbGF5bGlzdChfdGhpczM0LnBsYXlsaXN0RWRpdG9yLmlkLCBncm91cEluZGV4KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkgewogICAgICAgICAgICBfdGhpczM0LnhoYW1zdGVyLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLnhoYW1zdGVyLm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBnZXRYaGFtc3RlckNvbmZpZzogZnVuY3Rpb24gZ2V0WGhhbXN0ZXJDb25maWcodXJsKSB7CiAgICAgIHZhciBfdGhpczM1ID0gdGhpczsKCiAgICAgIHRoaXMueGhhbXN0ZXIuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UucG9zdCgiZWRpdG9yL3hoYW1zdGVyLXZpZGVvIiwgewogICAgICAgIHVybDogdXJsCiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgIF90aGlzMzUueGhhbXN0ZXIudmlkZW8gPSByZXMuZGF0YTsKICAgICAgICBfdGhpczM1LnhoYW1zdGVyLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9KTsKICAgIH0sCiAgICBncm91cERvdWJsZUNsaWNrOiBmdW5jdGlvbiBncm91cERvdWJsZUNsaWNrKCkgewogICAgICBpZiAodGhpcy5hY3RpdmVHcm91cHMubGVuZ3RoID09PSAxKSB7CiAgICAgICAgdGhpcy5lZGl0R3JvdXBNb2RhbCh0cnVlKTsKICAgICAgfQogICAgfSwKICAgIHN0cmVhbURvdWJsZUNsaWNrOiBmdW5jdGlvbiBzdHJlYW1Eb3VibGVDbGljaygpIHsKICAgICAgaWYgKHRoaXMuYWN0aXZlU3RyZWFtcy5sZW5ndGggPT09IDEpIHsKICAgICAgICB0aGlzLmVkaXRTdHJlYW1Nb2RhbCh0cnVlKTsKICAgICAgfQogICAgfSwKICAgIGxvYWRMb2dvQ291bnRyaWVzOiBmdW5jdGlvbiBsb2FkTG9nb0NvdW50cmllcygpIHsKICAgICAgdmFyIF90aGlzMzYgPSB0aGlzOwoKICAgICAgdGhpcy5maW5kTG9nby5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZS5nZXQoImVkaXRvci9sb2dvLWNvdW50cmllcyIpLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgIF90aGlzMzYuZmluZExvZ28uaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgX3RoaXMzNi5maW5kTG9nby5jb3VudHJpZXMgPSByZXMuZGF0YS5tYXAoZnVuY3Rpb24gKGNvdW50cnkpIHsKICAgICAgICAgIHZhciBjbiA9IF90aGlzMzYuY291bnRyaWVzLmZpbmQoZnVuY3Rpb24gKGNudCkgewogICAgICAgICAgICByZXR1cm4gY250LmNvZGUudG9Mb3dlckNhc2UoKSA9PSBjb3VudHJ5LnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICB9KTsKCiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICB0ZXh0OiBjbiA/IGNuLm5hbWUgOiBjb3VudHJ5LAogICAgICAgICAgICB2YWx1ZTogY291bnRyeQogICAgICAgICAgfTsKICAgICAgICB9KS5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICByZXR1cm4gYS50ZXh0LnRvVXBwZXJDYXNlKCkgPCBiLnRleHQudG9VcHBlckNhc2UoKSA/IC0xIDogYS50ZXh0LnRvVXBwZXJDYXNlKCkgPiBiLnRleHQudG9VcHBlckNhc2UoKSA/IDEgOiAwOwogICAgICAgIH0pOwogICAgICAgIF90aGlzMzYuYXNzaWduTG9nby5jb3VudHJpZXMgPSBfdG9Db25zdW1hYmxlQXJyYXkoX3RoaXMzNi5maW5kTG9nby5jb3VudHJpZXMpOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMzNi5maW5kTG9nby5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfSk7CiAgICB9LAogICAgbG9hZFRWR0lEQ291bnRyaWVzOiBmdW5jdGlvbiBsb2FkVFZHSURDb3VudHJpZXMoKSB7CiAgICAgIHZhciBfdGhpczM3ID0gdGhpczsKCiAgICAgIHRoaXMuYXNzaWduVFZHSUQuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UuZ2V0KCJlZGl0b3IvdHYtZ3VpZGUtY291bnRyaWVzIikudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgX3RoaXMzNy5hc3NpZ25UVkdJRC5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICBfdGhpczM3LmFzc2lnblRWR0lELmNvdW50cmllcyA9IHJlcy5kYXRhLm1hcChmdW5jdGlvbiAoY291bnRyeSkgewogICAgICAgICAgdmFyIGNuID0gX3RoaXMzNy5jb3VudHJpZXMuZmluZChmdW5jdGlvbiAoY250KSB7CiAgICAgICAgICAgIHJldHVybiBjbnQuY29kZS50b0xvd2VyQ2FzZSgpID09IGNvdW50cnkudG9Mb3dlckNhc2UoKTsKICAgICAgICAgIH0pOwoKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHRleHQ6IGNuID8gY24ubmFtZSA6IGNvdW50cnksCiAgICAgICAgICAgIHZhbHVlOiBjb3VudHJ5CiAgICAgICAgICB9OwogICAgICAgIH0pLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgIHJldHVybiBhLnRleHQudG9VcHBlckNhc2UoKSA8IGIudGV4dC50b1VwcGVyQ2FzZSgpID8gLTEgOiBhLnRleHQudG9VcHBlckNhc2UoKSA+IGIudGV4dC50b1VwcGVyQ2FzZSgpID8gMSA6IDA7CiAgICAgICAgfSk7CgogICAgICAgIF90aGlzMzcuYXNzaWduVFZHSUQuY291bnRyaWVzLnVuc2hpZnQoewogICAgICAgICAgdGV4dDogX3RoaXMzNy4kdCgiZ2VuZXJhbC5hbGwiKSwKICAgICAgICAgIHZhbHVlOiAiYWxsIgogICAgICAgIH0pOwoKICAgICAgICBfdGhpczM3LmZpbmRUVkdJRC5jb3VudHJpZXMgPSBfdG9Db25zdW1hYmxlQXJyYXkoX3RoaXMzNy5hc3NpZ25UVkdJRC5jb3VudHJpZXMpOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMzNy5hc3NpZ25UVkdJRC5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfSk7CiAgICB9LAogICAgbG9hZFNpcHR2Q291bnRyaWVzOiBmdW5jdGlvbiBsb2FkU2lwdHZDb3VudHJpZXMoKSB7CiAgICAgIHZhciBfdGhpczM4ID0gdGhpczsKCiAgICAgIHRoaXMuYXNzaWduU0lQVFYuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UuZ2V0KCJlZGl0b3Ivc21hcnQtaXB0di1jb3VudHJpZXMiKS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICBfdGhpczM4LmFzc2lnblNJUFRWLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIF90aGlzMzguYXNzaWduU0lQVFYuY291bnRyaWVzID0gcmVzLmRhdGE7CiAgICAgICAgX3RoaXMzOC5maW5kU2lwdHYuY291bnRyaWVzID0gX3RvQ29uc3VtYWJsZUFycmF5KF90aGlzMzguYXNzaWduU0lQVFYuY291bnRyaWVzKTsKICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzMzguYXNzaWduU0lQVFYuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0pOwogICAgfSwKICAgIGxvYWRMb2dvc0ZpbmQ6IGZ1bmN0aW9uIGxvYWRMb2dvc0ZpbmQoY291bnRyeSkgewogICAgICB2YXIgX3RoaXMzOSA9IHRoaXM7CgogICAgICB0aGlzLmZpbmRMb2dvLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGh0dHBTZXJ2aWNlLmdldCgiZWRpdG9yL2xvZ29zLyIuY29uY2F0KGNvdW50cnkpKS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICBfdGhpczM5LmZpbmRMb2dvLmxvZ28gPSAiIjsKICAgICAgICBfdGhpczM5LmZpbmRMb2dvLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIF90aGlzMzkuZmluZExvZ28ubG9nb3MgPSByZXMuZGF0YS5tYXAoZnVuY3Rpb24gKGxvZ28pIHsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHRleHQ6IGxvZ28ubGFiZWwsCiAgICAgICAgICAgIHZhbHVlOiBsb2dvLmZpbGVuYW1lCiAgICAgICAgICB9OwogICAgICAgIH0pOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMzOS5maW5kTG9nby5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfSk7CiAgICB9LAogICAgZmluZExvZ29Nb2RhbDogZnVuY3Rpb24gZmluZExvZ29Nb2RhbChzaG93KSB7CiAgICAgIHZhciBzYXZlID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiBmYWxzZTsKICAgICAgdmFyIHNlbGVjdGVkID0gdGhpcy5nZXRTdHJlYW1XaXRoSWQodGhpcy5hY3RpdmVTdHJlYW1zWzBdKTsKCiAgICAgIGlmIChzaG93KSB7CiAgICAgICAgdGhpcy5maW5kTG9nby5sb2dvID0gIiI7CiAgICAgICAgdGhpcy5maW5kTG9nby50aXRsZSA9IHNlbGVjdGVkLnN0cmVhbV90dmdfbmFtZTsKICAgICAgfQoKICAgICAgdGhpcy5maW5kTG9nby5zZWFyY2ggPSAiIjsKCiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgaWYgKHNlbGVjdGVkKSB7CiAgICAgICAgICBzZWxlY3RlZC5zdHJlYW1fdHZnX2xvZ28gPSAiaHR0cDovL3N0YXRpYy5pcHR2LXRvb2xzLmNvbS8iLmNvbmNhdCh0aGlzLmZpbmRMb2dvLmNvdW50cnksICIvIikuY29uY2F0KHRoaXMuZmluZExvZ28ubG9nbyk7CiAgICAgICAgICBzZWxlY3RlZC5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5maW5kTG9nby5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgbG9hZExvZ29zQXNzaWduOiBmdW5jdGlvbiBsb2FkTG9nb3NBc3NpZ24oY291bnRyeSkgewogICAgICB2YXIgX3RoaXM0MCA9IHRoaXM7CgogICAgICB0aGlzLmFzc2lnbkxvZ28uaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UuZ2V0KCJlZGl0b3IvbG9nb3MvIi5jb25jYXQoY291bnRyeSkpLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgIF90aGlzNDAuYXNzaWduTG9nby5sb2dvID0gIiI7CiAgICAgICAgX3RoaXM0MC5hc3NpZ25Mb2dvLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIF90aGlzNDAuYXNzaWduTG9nby5sb2dvcyA9IHJlcy5kYXRhLm1hcChmdW5jdGlvbiAobG9nbykgewogICAgICAgICAgcmV0dXJuIGxvZ28uZmlsZW5hbWU7CiAgICAgICAgfSk7CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczQwLmFzc2lnbkxvZ28uaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0pOwogICAgfSwKICAgIGFzc2lnbkxvZ29Nb2RhbDogZnVuY3Rpb24gYXNzaWduTG9nb01vZGFsKHNob3cpIHsKICAgICAgdmFyIF90aGlzNDEgPSB0aGlzOwoKICAgICAgdmFyIHNhdmUgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IGZhbHNlOwoKICAgICAgaWYgKHNob3cpIHsKICAgICAgICB0aGlzLmFzc2lnbkxvZ28ubG9nbyA9ICIiOwogICAgICB9CgogICAgICBpZiAoc2F2ZSkgewogICAgICAgIHZhciBjaGFuZ2VkID0gZmFsc2U7CgogICAgICAgIHZhciBzdHJpbmdTaW1pbGFyaXR5ID0gcmVxdWlyZSgic3RyaW5nLXNpbWlsYXJpdHkiKTsKCiAgICAgICAgdmFyIHN0cmVhbXMgPSBbXTsKCiAgICAgICAgaWYgKHRoaXMuYXNzaWduTG9nby5hc3NpZ25BbGwgPT0gMSkgewogICAgICAgICAgc3RyZWFtcyA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtczsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc3RyZWFtcyA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5maWx0ZXIoZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgICAgICByZXR1cm4gIXN0cmVhbS5zdHJlYW1fdHZnX2xvZ28ubGVuZ3RoOwogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBzdHJlYW1zLm1hcChmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAgICAgICB2YXIgbWF0Y2gxID0gc3RyaW5nU2ltaWxhcml0eS5maW5kQmVzdE1hdGNoKFN0cmluZyhzdHJlYW0uc3RyZWFtX3R2Z19uYW1lKS5yZXBsYWNlKC8gaGQkL2ksICIiKSwgX3RoaXM0MS5hc3NpZ25Mb2dvLmxvZ29zKS5iZXN0TWF0Y2g7CiAgICAgICAgICB2YXIgbWF0Y2gyID0gc3RyaW5nU2ltaWxhcml0eS5maW5kQmVzdE1hdGNoKFN0cmluZyhzdHJlYW0uc3RyZWFtX3R2Z19pZCksIF90aGlzNDEuYXNzaWduTG9nby5sb2dvcykuYmVzdE1hdGNoOwoKICAgICAgICAgIGlmIChtYXRjaDEucmF0aW5nID49IDAuMykgewogICAgICAgICAgICBjaGFuZ2VkID0gdHJ1ZTsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfbG9nbyA9ICJodHRwOi8vc3RhdGljLmlwdHYtdG9vbHMuY29tLyIuY29uY2F0KF90aGlzNDEuYXNzaWduTG9nby5jb3VudHJ5LCAiLyIpLmNvbmNhdChtYXRjaDEudGFyZ2V0KTsKICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgIH0gZWxzZSBpZiAobWF0Y2gyLnJhdGluZyA+PSAwLjUpIHsKICAgICAgICAgICAgY2hhbmdlZCA9IHRydWU7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX2xvZ28gPSAiaHR0cDovL3N0YXRpYy5pcHR2LXRvb2xzLmNvbS8iLmNvbmNhdChfdGhpczQxLmFzc2lnbkxvZ28uY291bnRyeSwgIi8iKS5jb25jYXQobWF0Y2gyLnRhcmdldCk7CiAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gY2hhbmdlZDsKICAgICAgfQoKICAgICAgdGhpcy5hc3NpZ25Mb2dvLm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBsb2FkVFZHSURBc3NpZ246IGZ1bmN0aW9uIGxvYWRUVkdJREFzc2lnbihjb3VudHJ5KSB7CiAgICAgIHZhciBfdGhpczQyID0gdGhpczsKCiAgICAgIHRoaXMuYXNzaWduVFZHSUQuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UuZ2V0KCJlZGl0b3IvdHYtZ3VpZGUvIi5jb25jYXQoY291bnRyeSkpLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgIF90aGlzNDIuYXNzaWduVFZHSUQuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgX3RoaXM0Mi5hc3NpZ25UVkdJRC5jaGFubmVscyA9IHJlcy5kYXRhOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXM0Mi5hc3NpZ25UVkdJRC5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfSk7CiAgICB9LAogICAgbG9hZFNpcHR2QXNzaWduOiBmdW5jdGlvbiBsb2FkU2lwdHZBc3NpZ24oY291bnRyeSkgewogICAgICB2YXIgX3RoaXM0MyA9IHRoaXM7CgogICAgICB0aGlzLmFzc2lnblNJUFRWLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGh0dHBTZXJ2aWNlLmdldCgiZWRpdG9yL3NtYXJ0LWlwdHYvIi5jb25jYXQoY291bnRyeSkpLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgIF90aGlzNDMuYXNzaWduU0lQVFYuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgX3RoaXM0My5hc3NpZ25TSVBUVi5jaGFubmVscyA9IHJlcy5kYXRhOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXM0My5hc3NpZ25TSVBUVi5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfSk7CiAgICB9LAogICAgYXNzaWduVFZHSURNb2RhbDogZnVuY3Rpb24gYXNzaWduVFZHSURNb2RhbChzaG93KSB7CiAgICAgIHZhciBfdGhpczQ0ID0gdGhpczsKCiAgICAgIHZhciBzYXZlID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiBmYWxzZTsKCiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgdmFyIGNoYW5nZWQgPSBmYWxzZTsKCiAgICAgICAgdmFyIHN0cmluZ1NpbWlsYXJpdHkgPSByZXF1aXJlKCJzdHJpbmctc2ltaWxhcml0eSIpOwoKICAgICAgICB2YXIgc3RyZWFtcyA9IFtdOwoKICAgICAgICBpZiAodGhpcy5hc3NpZ25UVkdJRC5hc3NpZ25BbGwgPT0gMSkgewogICAgICAgICAgc3RyZWFtcyA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtczsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc3RyZWFtcyA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5maWx0ZXIoZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgICAgICByZXR1cm4gIXN0cmVhbS5zdHJlYW1fdHZnX2lkLmxlbmd0aCB8fCBzdHJlYW0uc3RyZWFtX3R2Z19pZC5sZW5ndGggPT0gMDsKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgdmFyIGNoYW5uZWxOYW1lcyA9IHRoaXMuYXNzaWduVFZHSUQuY2hhbm5lbHMubWFwKGZ1bmN0aW9uIChjaGFubmVsKSB7CiAgICAgICAgICByZXR1cm4gY2hhbm5lbC50dmdfbmFtZTsKICAgICAgICB9KTsKICAgICAgICB2YXIgY2hhbm5lbElkcyA9IHRoaXMuYXNzaWduVFZHSUQuY2hhbm5lbHMubWFwKGZ1bmN0aW9uIChjaGFubmVsKSB7CiAgICAgICAgICByZXR1cm4gY2hhbm5lbC50dmdfaWQ7CiAgICAgICAgfSk7CiAgICAgICAgc3RyZWFtcy5tYXAoZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgICAgdmFyIG1hdGNoMSA9IHN0cmluZ1NpbWlsYXJpdHkuZmluZEJlc3RNYXRjaChTdHJpbmcoc3RyZWFtLnN0cmVhbV90dmdfbmFtZSksIGNoYW5uZWxOYW1lcykuYmVzdE1hdGNoOwogICAgICAgICAgdmFyIG1hdGNoMiA9IHN0cmluZ1NpbWlsYXJpdHkuZmluZEJlc3RNYXRjaChTdHJpbmcoc3RyZWFtLnN0cmVhbV90dmdfaWQpLCBjaGFubmVsSWRzKS5iZXN0TWF0Y2g7CiAgICAgICAgICB2YXIgbWF0Y2gzID0gc3RyaW5nU2ltaWxhcml0eS5maW5kQmVzdE1hdGNoKFN0cmluZyhzdHJlYW0uc3RyZWFtX3R2Z19uYW1lKS5yZXBsYWNlKC8gaGQkfCBmaGQkfCBoZXZjJHwgaDI2NSR8L2ksICIiKSwgY2hhbm5lbE5hbWVzKS5iZXN0TWF0Y2g7CgogICAgICAgICAgaWYgKG1hdGNoMi5yYXRpbmcgPj0gMC43NSkgewogICAgICAgICAgICBjaGFuZ2VkID0gdHJ1ZTsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfaWQgPSBtYXRjaDIudGFyZ2V0OwogICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgfSBlbHNlIGlmIChtYXRjaDEucmF0aW5nID49IDAuNzUpIHsKICAgICAgICAgICAgY2hhbmdlZCA9IHRydWU7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX2lkID0gX3RoaXM0NC5hc3NpZ25UVkdJRC5jaGFubmVscy5maW5kKGZ1bmN0aW9uIChjaGFubmVsKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGNoYW5uZWwudHZnX25hbWUgPT09IG1hdGNoMS50YXJnZXQ7CiAgICAgICAgICAgIH0pLnR2Z19pZDsKICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgIH0gZWxzZSBpZiAobWF0Y2gzLnJhdGluZyA+PSAwLjc1KSB7CiAgICAgICAgICAgIGNoYW5nZWQgPSB0cnVlOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19pZCA9IF90aGlzNDQuYXNzaWduVFZHSUQuY2hhbm5lbHMuZmluZChmdW5jdGlvbiAoY2hhbm5lbCkgewogICAgICAgICAgICAgIHJldHVybiBjaGFubmVsLnR2Z19uYW1lID09PSBtYXRjaDEudGFyZ2V0OwogICAgICAgICAgICB9KS50dmdfaWQ7CiAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjaGFuZ2VkID0gdHJ1ZTsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfaWQgPSAiIjsKICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSBjaGFuZ2VkOwogICAgICB9CgogICAgICB0aGlzLmFzc2lnblRWR0lELm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBhc3NpZ25TaXB0dk1vZGFsOiBmdW5jdGlvbiBhc3NpZ25TaXB0dk1vZGFsKHNob3cpIHsKICAgICAgdmFyIF90aGlzNDUgPSB0aGlzOwoKICAgICAgdmFyIHNhdmUgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IGZhbHNlOwoKICAgICAgaWYgKHNhdmUpIHsKICAgICAgICB2YXIgY2hhbmdlZCA9IGZhbHNlOwoKICAgICAgICB2YXIgc3RyaW5nU2ltaWxhcml0eSA9IHJlcXVpcmUoInN0cmluZy1zaW1pbGFyaXR5Iik7CgogICAgICAgIHZhciBzdHJlYW1zID0gW107CgogICAgICAgIGlmICh0aGlzLmFzc2lnblNJUFRWLmFzc2lnbkFsbCA9PSAxKSB7CiAgICAgICAgICBzdHJlYW1zID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzdHJlYW1zID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmZpbHRlcihmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAgICAgICAgIHJldHVybiAhc3RyZWFtLnN0cmVhbV90dmdfaWQubGVuZ3RoIHx8IHN0cmVhbS5zdHJlYW1fdHZnX2lkLmxlbmd0aCA9PSAwOwogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICB2YXIgY2hhbm5lbE5hbWVzID0gdGhpcy5hc3NpZ25TSVBUVi5jaGFubmVscy5tYXAoZnVuY3Rpb24gKGNoYW5uZWwpIHsKICAgICAgICAgIHJldHVybiBjaGFubmVsLnR2Z19uYW1lOwogICAgICAgIH0pOwogICAgICAgIHZhciBjaGFubmVsSWRzID0gdGhpcy5hc3NpZ25TSVBUVi5jaGFubmVscy5tYXAoZnVuY3Rpb24gKGNoYW5uZWwpIHsKICAgICAgICAgIHJldHVybiBjaGFubmVsLnR2Z19pZDsKICAgICAgICB9KTsKICAgICAgICBzdHJlYW1zLm1hcChmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAgICAgICB2YXIgbWF0Y2gxID0gc3RyaW5nU2ltaWxhcml0eS5maW5kQmVzdE1hdGNoKFN0cmluZyhzdHJlYW0uc3RyZWFtX3R2Z19uYW1lKSwgY2hhbm5lbE5hbWVzKS5iZXN0TWF0Y2g7CiAgICAgICAgICB2YXIgbWF0Y2gyID0gc3RyaW5nU2ltaWxhcml0eS5maW5kQmVzdE1hdGNoKFN0cmluZyhzdHJlYW0uc3RyZWFtX3R2Z19pZCksIGNoYW5uZWxJZHMpLmJlc3RNYXRjaDsKICAgICAgICAgIHZhciBtYXRjaDMgPSBzdHJpbmdTaW1pbGFyaXR5LmZpbmRCZXN0TWF0Y2goU3RyaW5nKHN0cmVhbS5zdHJlYW1fdHZnX25hbWUpLnJlcGxhY2UoLyBoZCR8IGZoZCR8IGhldmMkfCBoMjY1JHwvaSwgIiIpLCBjaGFubmVsTmFtZXMpLmJlc3RNYXRjaDsKCiAgICAgICAgICBpZiAobWF0Y2gyLnJhdGluZyA+PSAwLjc1KSB7CiAgICAgICAgICAgIGNoYW5nZWQgPSB0cnVlOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19pZCA9IG1hdGNoMi50YXJnZXQ7CiAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICB9IGVsc2UgaWYgKG1hdGNoMS5yYXRpbmcgPj0gMC43NSkgewogICAgICAgICAgICBjaGFuZ2VkID0gdHJ1ZTsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfaWQgPSBfdGhpczQ1LmFzc2lnblNJUFRWLmNoYW5uZWxzLmZpbmQoZnVuY3Rpb24gKGNoYW5uZWwpIHsKICAgICAgICAgICAgICByZXR1cm4gY2hhbm5lbC50dmdfbmFtZSA9PT0gbWF0Y2gxLnRhcmdldDsKICAgICAgICAgICAgfSkudHZnX2lkOwogICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgfSBlbHNlIGlmIChtYXRjaDMucmF0aW5nID49IDAuNzUpIHsKICAgICAgICAgICAgY2hhbmdlZCA9IHRydWU7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX2lkID0gX3RoaXM0NS5hc3NpZ25TSVBUVi5jaGFubmVscy5maW5kKGZ1bmN0aW9uIChjaGFubmVsKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGNoYW5uZWwudHZnX25hbWUgPT09IG1hdGNoMS50YXJnZXQ7CiAgICAgICAgICAgIH0pLnR2Z19pZDsKICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNoYW5nZWQgPSB0cnVlOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19pZCA9ICIiOwogICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IGNoYW5nZWQ7CiAgICAgIH0KCiAgICAgIHRoaXMuYXNzaWduU0lQVFYubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGxvYWRUVkdJREZpbmQ6IGZ1bmN0aW9uIGxvYWRUVkdJREZpbmQoY291bnRyeSkgewogICAgICB2YXIgX3RoaXM0NiA9IHRoaXM7CgogICAgICB0aGlzLmZpbmRUVkdJRC5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZS5nZXQoImVkaXRvci90di1ndWlkZS8iLmNvbmNhdChjb3VudHJ5KSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgX3RoaXM0Ni5maW5kVFZHSUQuY2hhbm5lbCA9ICIiOwogICAgICAgIF90aGlzNDYuZmluZFRWR0lELmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIF90aGlzNDYuZmluZFRWR0lELmNoYW5uZWxzID0gcmVzLmRhdGEubWFwKGZ1bmN0aW9uIChjaGFubmVsKSB7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICB0ZXh0OiBjaGFubmVsLnR2Z19uYW1lLAogICAgICAgICAgICB2YWx1ZTogY2hhbm5lbC50dmdfaWQKICAgICAgICAgIH07CiAgICAgICAgfSk7CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczQ2LmZpbmRUVkdJRC5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfSk7CiAgICB9LAogICAgbG9hZFNpcHR2RmluZDogZnVuY3Rpb24gbG9hZFNpcHR2RmluZChjb3VudHJ5KSB7CiAgICAgIHZhciBfdGhpczQ3ID0gdGhpczsKCiAgICAgIHRoaXMuZmluZFNpcHR2LmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGh0dHBTZXJ2aWNlLmdldCgiZWRpdG9yL3NtYXJ0LWlwdHYvIi5jb25jYXQoY291bnRyeSkpLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgIF90aGlzNDcuZmluZFNpcHR2LmNoYW5uZWwgPSAiIjsKICAgICAgICBfdGhpczQ3LmZpbmRTaXB0di5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICBfdGhpczQ3LmZpbmRTaXB0di5jaGFubmVscyA9IHJlcy5kYXRhLm1hcChmdW5jdGlvbiAoY2hhbm5lbCkgewogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgdGV4dDogY2hhbm5lbC50dmdfbmFtZSwKICAgICAgICAgICAgdmFsdWU6IGNoYW5uZWwudHZnX2lkCiAgICAgICAgICB9OwogICAgICAgIH0pOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXM0Ny5maW5kVFZHSUQuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0pOwogICAgfSwKICAgIGZpbmRUVkdJRE1vZGFsOiBmdW5jdGlvbiBmaW5kVFZHSURNb2RhbChzaG93KSB7CiAgICAgIHZhciBzYXZlID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiBmYWxzZTsKICAgICAgdmFyIHNlbGVjdGVkID0gdGhpcy5nZXRTdHJlYW1XaXRoSWQodGhpcy5hY3RpdmVTdHJlYW1zWzBdKTsKCiAgICAgIGlmIChzaG93KSB7CiAgICAgICAgdGhpcy5maW5kVFZHSUQuY2hhbm5lbCA9ICIiOwogICAgICAgIHRoaXMuZmluZFRWR0lELnRpdGxlID0gc2VsZWN0ZWQuc3RyZWFtX3R2Z19uYW1lOwogICAgICB9CgogICAgICB0aGlzLmZpbmRUVkdJRC5zZWFyY2ggPSAiIjsKCiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgaWYgKHNlbGVjdGVkKSB7CiAgICAgICAgICBzZWxlY3RlZC5zdHJlYW1fdHZnX2lkID0gdGhpcy5maW5kVFZHSUQuY2hhbm5lbDsKICAgICAgICAgIHNlbGVjdGVkLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmZpbmRUVkdJRC5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgZmluZFNpcHR2TW9kYWw6IGZ1bmN0aW9uIGZpbmRTaXB0dk1vZGFsKHNob3cpIHsKICAgICAgdmFyIHNhdmUgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IGZhbHNlOwogICAgICB2YXIgc2VsZWN0ZWQgPSB0aGlzLmdldFN0cmVhbVdpdGhJZCh0aGlzLmFjdGl2ZVN0cmVhbXNbMF0pOwoKICAgICAgaWYgKHNob3cpIHsKICAgICAgICB0aGlzLmZpbmRTaXB0di5jaGFubmVsID0gIiI7CiAgICAgICAgdGhpcy5maW5kU2lwdHYudGl0bGUgPSBzZWxlY3RlZC5zdHJlYW1fdHZnX25hbWU7CiAgICAgIH0KCiAgICAgIHRoaXMuZmluZFNpcHR2LnNlYXJjaCA9ICIiOwoKICAgICAgaWYgKHNhdmUpIHsKICAgICAgICBpZiAoc2VsZWN0ZWQpIHsKICAgICAgICAgIHNlbGVjdGVkLnN0cmVhbV90dmdfaWQgPSB0aGlzLmZpbmRTaXB0di5jaGFubmVsOwogICAgICAgICAgc2VsZWN0ZWQubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuZmluZFNpcHR2Lm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBpbXBvcnRNM1VNb2RhbDogZnVuY3Rpb24gaW1wb3J0TTNVTW9kYWwoc2hvdykgewogICAgICB2YXIgX3RoaXM0OCA9IHRoaXM7CgogICAgICB2YXIgc2F2ZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogZmFsc2U7CgogICAgICBpZiAoc2hvdykgewogICAgICAgIHRoaXMuaW1wb3J0TTNVLmZpbGUgPSBudWxsOwogICAgICAgIHRoaXMuaW1wb3J0TTNVLm0zdSA9IG51bGw7CiAgICAgICAgdGhpcy5pbXBvcnRNM1UuZ3JvdXBzID0gW107CiAgICAgICAgdGhpcy5pbXBvcnRNM1UuaW1wb3J0R3JvdXBzID0gW107CiAgICAgIH0KCiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlOwogICAgICAgIHZhciBncm91cEluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KGZ1bmN0aW9uIChncm91cCkgewogICAgICAgICAgcmV0dXJuIGdyb3VwLmlkID09IF90aGlzNDguYWN0aXZlR3JvdXA7CiAgICAgICAgfSk7CiAgICAgICAgaHR0cFNlcnZpY2UucG9zdCgiZWRpdG9yL2ltcG9ydCIsIHsKICAgICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgaW1wb3J0OiB0aGlzLmltcG9ydE0zVS5ncm91cHMuZmlsdGVyKGZ1bmN0aW9uIChncm91cCwgaW5kZXgpIHsKICAgICAgICAgICAgcmV0dXJuIF90aGlzNDguaW1wb3J0TTNVLmltcG9ydEdyb3Vwcy5pbmNsdWRlcyhpbmRleCk7CiAgICAgICAgICB9KQogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgICAgX3RoaXM0OC5pc0xvYWRpbmcgPSBmYWxzZTsKCiAgICAgICAgICBpZiAocmVzLnN0YXR1cykgewogICAgICAgICAgICBfdGhpczQ4LmxvYWRQbGF5bGlzdChfdGhpczQ4LnBsYXlsaXN0RWRpdG9yLmlkLCBncm91cEluZGV4KTsKICAgICAgICAgIH0KICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBfdGhpczQ4LmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0pOwogICAgICB9CgogICAgICB0aGlzLmltcG9ydE0zVS5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgdXBsb2FkTTNVOiBmdW5jdGlvbiB1cGxvYWRNM1UoZXZlbnQpIHsKICAgICAgdmFyIF90aGlzNDkgPSB0aGlzOwoKICAgICAgdmFyIGlucHV0ID0gZXZlbnQudGFyZ2V0OwoKICAgICAgaWYgKCJmaWxlcyIgaW4gaW5wdXQgJiYgaW5wdXQuZmlsZXMubGVuZ3RoID4gMCkgewogICAgICAgIHRoaXMuaW1wb3J0TTNVLmlzTG9hZGluZyA9IHRydWU7CiAgICAgICAgdGhpcy5yZWFkRmlsZUNvbnRlbnQoaW5wdXQuZmlsZXNbMF0pLnRoZW4oZnVuY3Rpb24gKGNvbnRlbnQpIHsKICAgICAgICAgIF90aGlzNDkuaW1wb3J0TTNVLmlzTG9hZGluZyA9IGZhbHNlOwoKICAgICAgICAgIF90aGlzNDkucGFyc2VNM1UoY29udGVudCk7CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgICBfdGhpczQ5LiRub3RpZnkoImVycm9yIiwgX3RoaXM0OS4kdCgicHJvZmlsZS5mYWlsZWQiKSwgZXJyb3IsICJsYS11c2VyLXNoaWVsZCIsIHsKICAgICAgICAgICAgZHVyYXRpb246IDUwMDAsCiAgICAgICAgICAgIHBlcm1hbmVudDogZmFsc2UKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgcGFyc2VNM1U6IGZ1bmN0aW9uIHBhcnNlTTNVKGNvbnRlbnQpIHsKICAgICAgdmFyIF90aGlzNTAgPSB0aGlzOwoKICAgICAgdmFyIHZtID0gdGhpczsKICAgICAgdm0uaW1wb3J0TTNVLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIG0zdS5wYXJzZShjb250ZW50LCB7CiAgICAgICAgdGFnOiAibmFtZSIsCiAgICAgICAgdHlwZTogWyJNb3ZpZSIsICJTZXJpZXMiLCAiVk9EIiwgIkxpdmUiXQogICAgICB9LCB0cnVlKS50aGVuKGZ1bmN0aW9uIChwbGF5bGlzdCkgewogICAgICAgIF90aGlzNTAuaW1wb3J0TTNVLm0zdSA9IHBsYXlsaXN0OwogICAgICAgIF90aGlzNTAuaW1wb3J0TTNVLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIF90aGlzNTAuaW1wb3J0TTNVLmdyb3VwcyA9IHBsYXlsaXN0Lmdyb3VwczsKICAgICAgICBfdGhpczUwLmltcG9ydE0zVS5pbXBvcnRHcm91cHMgPSBbXTsKICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgdm0uaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgdm0uJG5vdGlmeSgiZXJyb3IiLCB2bS4kdCgicHJvZmlsZS5mYWlsZWQiKSwgZXJyb3IsICJsYS11c2VyLXNoaWVsZCIsIHsKICAgICAgICAgIGR1cmF0aW9uOiA1MDAwLAogICAgICAgICAgcGVybWFuZW50OiBmYWxzZQogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0sCiAgICByZWFkRmlsZUNvbnRlbnQ6IGZ1bmN0aW9uIHJlYWRGaWxlQ29udGVudChmaWxlKSB7CiAgICAgIHZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgIHJldHVybiByZXNvbHZlKGV2ZW50LnRhcmdldC5yZXN1bHQpOwogICAgICAgIH07CgogICAgICAgIHJlYWRlci5vbmVycm9yID0gZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgICByZXR1cm4gcmVqZWN0KGVycm9yKTsKICAgICAgICB9OwoKICAgICAgICByZWFkZXIucmVhZEFzVGV4dChmaWxlKTsKICAgICAgfSk7CiAgICB9CiAgfSwKICBiZWZvcmVNb3VudDogZnVuY3Rpb24gYmVmb3JlTW91bnQoKSB7CiAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5hZGQoInJpZ2h0LW1lbnUiKTsKICAgIEV2ZW50QnVzLiRvbigic2VhcmNoIiwgdGhpcy5zZWFyY2hFZGl0b3IpOwogICAgRXZlbnRCdXMuJG9uKCJwcmludCIsIHRoaXMucHJpbnRFZGl0b3IpOwogICAgRXZlbnRCdXMuJG9uKCJ0YWItY2hhbmdlIiwgdGhpcy5kb1RhYkNoYW5nZSk7CiAgICBFdmVudEJ1cy4kb24oInNhdmUiLCB0aGlzLmRvU2F2ZSk7CiAgICBFdmVudEJ1cy4kb24oImNhbmNlbCIsIHRoaXMuZG9DYW5jZWwpOwoKICAgIGlmICh0aGlzLm1vdmllU2VyaWVQbGF5bGlzdCkgewogICAgICB0aGlzLmxvYWRQbGF5bGlzdCh0aGlzLm1vdmllU2VyaWVQbGF5bGlzdCk7CiAgICB9CgogICAgdGhpcy5sb2FkTG9nb0NvdW50cmllcygpOwogICAgdGhpcy5sb2FkVFZHSURDb3VudHJpZXMoKTsKICAgIHRoaXMubG9hZFNpcHR2Q291bnRyaWVzKCk7CiAgfSwKICBiZWZvcmVEZXN0cm95OiBmdW5jdGlvbiBiZWZvcmVEZXN0cm95KCkgewogICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QucmVtb3ZlKCJyaWdodC1tZW51Iik7CiAgICBFdmVudEJ1cy4kb2ZmKCJzZWFyY2giLCB0aGlzLnNlYXJjaEVkaXRvcik7CiAgICBFdmVudEJ1cy4kb2ZmKCJwcmludCIsIHRoaXMucHJpbnRFZGl0b3IpOwogICAgRXZlbnRCdXMuJG9mZigidGFiLWNoYW5nZSIsIHRoaXMuZG9UYWJDaGFuZ2UpOwogICAgRXZlbnRCdXMuJG9mZigic2F2ZSIsIHRoaXMuZG9TYXZlKTsKICAgIEV2ZW50QnVzLiRvZmYoImNhbmNlbCIsIHRoaXMuZG9DYW5jZWwpOwogIH0sCiAgd2F0Y2g6IHsKICAgIGRyYWdTdHJlYW06IGZ1bmN0aW9uIGRyYWdTdHJlYW0odmFsKSB7CiAgICAgIGlmICghdmFsKSB7CiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgICAgfQogICAgfSwKICAgIGRyYWdHcm91cDogZnVuY3Rpb24gZHJhZ0dyb3VwKHZhbCkgewogICAgICBpZiAoIXZhbCkgewogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICAgIH0KICAgIH0sCiAgICBhY3RpdmVHcm91cDogZnVuY3Rpb24gYWN0aXZlR3JvdXAodmFsKSB7CiAgICAgIGlmICh0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQpIHsKICAgICAgICB0aGlzLnNhdmVDaGFuZ2VzTW9kYWwodHJ1ZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5sb2FkU3RyZWFtcygpOwogICAgICB9CiAgICB9LAogICAgInBsYXlsaXN0RWRpdG9yLmNoYW5nZWQiOiBmdW5jdGlvbiBwbGF5bGlzdEVkaXRvckNoYW5nZWQodmFsKSB7CiAgICAgIEV2ZW50QnVzLiRlbWl0KCJlZGl0b3ItY2hhbmdlcyIsIHZhbCk7CiAgICB9LAogICAgInJhZGlvQnJvd3Nlci5zZWFyY2giOiBmdW5jdGlvbiByYWRpb0Jyb3dzZXJTZWFyY2godmFsKSB7CiAgICAgIHZhciB2bSA9IHRoaXM7CiAgICAgIGNsZWFyVGltZW91dCh0aGlzLnJhZGlvQnJvd3Nlci5ib3VuY2UpOwogICAgICB0aGlzLnJhZGlvQnJvd3Nlci5ib3VuY2UgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICB2bS5maW5kUmFkaW9icm93c2VyKHZhbCk7CiAgICAgIH0sIDUwMCk7CiAgICB9LAogICAgInNvdW5kY2xvdWQudXJsIjogZnVuY3Rpb24gc291bmRjbG91ZFVybCh2YWwpIHsKICAgICAgdmFyIHZtID0gdGhpczsKICAgICAgY2xlYXJUaW1lb3V0KHRoaXMucmFkaW9Ccm93c2VyLmJvdW5jZSk7CiAgICAgIHRoaXMucmFkaW9Ccm93c2VyLmJvdW5jZSA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgIHZtLmdldFNvdW5kY2xvdWRUcmFjayh2YWwsIHZtLnNvdW5kY2xvdWRDbGllbnRJZCk7CiAgICAgIH0sIDUwMCk7CiAgICB9LAogICAgInlvdXR1YmUudXJsIjogZnVuY3Rpb24geW91dHViZVVybCh2YWwpIHsKICAgICAgaWYgKCF2YWwubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoL3lvdXR1XC4/YmUvaS50ZXN0KHZhbCkpIHsKICAgICAgICB2YXIgaTsKICAgICAgICB2YXIgcGF0dGVybnMgPSBbL3lvdXR1XC5iZVwvKFteIyY/XXsxMX0pLywgLy8geW91dHUuYmUvPGlkPgogICAgICAgIC9cP3Y9KFteIyY/XXsxMX0pLywgLy8gP3Y9PGlkPgogICAgICAgIC8mdj0oW14jJj9dezExfSkvLCAvLyAmdj08aWQ+CiAgICAgICAgL2VtYmVkXC8oW14jJj9dezExfSkvLCAvLyBlbWJlZC88aWQ+CiAgICAgICAgL1wvdlwvKFteIyY/XXsxMX0pLyAvLyAvdi88aWQ+CiAgICAgICAgXTsKCiAgICAgICAgZm9yIChpID0gMDsgaSA8IHBhdHRlcm5zLmxlbmd0aDsgKytpKSB7CiAgICAgICAgICBpZiAocGF0dGVybnNbaV0udGVzdCh2YWwpKSB7CiAgICAgICAgICAgIHRoaXMueW91dHViZS52aWRlb0lkID0gcGF0dGVybnNbaV0uZXhlYyh2YWwpWzFdOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB2YXIgdG9rZW5zID0gdmFsLnNwbGl0KC9bLyY/PSMuXHNdL2cpOwoKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdG9rZW5zLmxlbmd0aDsgKytpKSB7CiAgICAgICAgICBpZiAoL15bXiMmP117MTF9JC8udGVzdCh0b2tlbnNbaV0pKSB7CiAgICAgICAgICAgIHRoaXMueW91dHViZS52aWRlb0lkID0gdG9rZW5zW2ldOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB0aGlzLnlvdXR1YmUudmlkZW9JZCA9ICIiOwogICAgICB9IGVsc2UgewogICAgICAgIHRyeSB7CiAgICAgICAgICB2YXIgdXJscCA9IG5ldyBVUkwodmFsKTsKICAgICAgICAgIHRoaXMueW91dHViZS52aWRlb0lkID0gdXJscC5zZWFyY2hQYXJhbXMuZ2V0KCJ2Iik7CiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgIHRoaXMueW91dHViZS52aWRlb0lkID0gIiI7CiAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgInlvdXR1YmUudmlkZW9JZCI6IGZ1bmN0aW9uIHlvdXR1YmVWaWRlb0lkKHZhbCkgewogICAgICB2YXIgdm0gPSB0aGlzOwogICAgICBjbGVhclRpbWVvdXQodGhpcy55b3V0dWJlLmJvdW5jZSk7CiAgICAgIHRoaXMueW91dHViZS5ib3VuY2UgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAodmFsLmxlbmd0aCkgewogICAgICAgICAgdm0uZ2V0WW91dHViZVBhZ2UodmFsKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdm0ueW91dHViZS52aWRlbyA9IG51bGw7CiAgICAgICAgfQogICAgICB9LCA1MDApOwogICAgfSwKICAgICJ2aW1lby51cmwiOiBmdW5jdGlvbiB2aW1lb1VybCh2YWwpIHsKICAgICAgaWYgKC92aW1lb1wuY29tL2kudGVzdCh2YWwpKSB7CiAgICAgICAgdmFyIG1hdGNoID0gdmFsLm1hdGNoKC8oPzp3d3dcLnxwbGF5ZXJcLik/dmltZW8uY29tXC8oPzpjaGFubmVsc1wvKD86XHcrXC8pP3xncm91cHNcLyg/OlteL10qKVwvdmlkZW9zXC98YWxidW1cLyg/OlxkKylcL3ZpZGVvXC98dmlkZW9cL3wpKFxkKykoPzpbYS16QS1aMC05Xy1dKyk/L2kpOwoKICAgICAgICBpZiAobWF0Y2gubGVuZ3RoID49IDIpIHsKICAgICAgICAgIHRoaXMudmltZW8udmlkZW9JZCA9IG1hdGNoWzFdOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLnZpbWVvLnZpZGVvSWQgPSAiIjsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy52aW1lby52aWRlb0lkID0gIiI7CiAgICAgIH0KICAgIH0sCiAgICAidmltZW8udmlkZW9JZCI6IGZ1bmN0aW9uIHZpbWVvVmlkZW9JZCh2YWwpIHsKICAgICAgdmFyIHZtID0gdGhpczsKICAgICAgY2xlYXJUaW1lb3V0KHRoaXMudmltZW8uYm91bmNlKTsKICAgICAgdGhpcy52aW1lby5ib3VuY2UgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAodmFsLmxlbmd0aCkgewogICAgICAgICAgdm0uZ2V0VmltZW9Db25maWcodmFsKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdm0udmltZW8udmlkZW8gPSBudWxsOwogICAgICAgIH0KICAgICAgfSwgNTAwKTsKICAgIH0sCiAgICAiZGFpbHltb3Rpb24udXJsIjogZnVuY3Rpb24gZGFpbHltb3Rpb25VcmwodmFsKSB7CiAgICAgIGlmICgvZGFpbHltb3Rpb25cLmNvbS9pLnRlc3QodmFsKSkgewogICAgICAgIHZhciBtYXRjaCA9IHZhbC5tYXRjaCgvXi4rZGFpbHltb3Rpb24uY29tXC8odmlkZW98aHViKVwvKFteX10rKVteI10qKCN2aWRlbz0oW15fJl0rKSk/L2kpOwoKICAgICAgICBpZiAobWF0Y2gubGVuZ3RoID49IDQgJiYgbWF0Y2hbNF0pIHsKICAgICAgICAgIHRoaXMuZGFpbHltb3Rpb24udmlkZW9JZCA9IG1hdGNoWzRdOwogICAgICAgIH0gZWxzZSBpZiAobWF0Y2gubGVuZ3RoID49IDIpIHsKICAgICAgICAgIHRoaXMuZGFpbHltb3Rpb24udmlkZW9JZCA9IG1hdGNoWzJdOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLmRhaWx5bW90aW9uLnZpZGVvSWQgPSAiIjsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5kYWlseW1vdGlvbi52aWRlb0lkID0gIiI7CiAgICAgIH0KICAgIH0sCiAgICAiZGFpbHltb3Rpb24udmlkZW9JZCI6IGZ1bmN0aW9uIGRhaWx5bW90aW9uVmlkZW9JZCh2YWwpIHsKICAgICAgdmFyIHZtID0gdGhpczsKICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuZGFpbHltb3Rpb24uYm91bmNlKTsKICAgICAgdGhpcy5kYWlseW1vdGlvbi5ib3VuY2UgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAodmFsLmxlbmd0aCkgewogICAgICAgICAgdm0uZ2V0RGFpbHltb3Rpb25Db25maWcodmFsKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdm0uZGFpbHltb3Rpb24udmlkZW8gPSBudWxsOwogICAgICAgIH0KICAgICAgfSwgNTAwKTsKICAgIH0sCiAgICAidGVkVGFsa3MudXJsIjogZnVuY3Rpb24gdGVkVGFsa3NVcmwodmFsKSB7CiAgICAgIGlmICgvdGVkXC5jb21cL3RhbGtzL2kudGVzdCh2YWwpKSB7CiAgICAgICAgdmFyIHZtID0gdGhpczsKICAgICAgICBjbGVhclRpbWVvdXQodGhpcy50ZWRUYWxrcy5ib3VuY2UpOwogICAgICAgIHRoaXMudGVkVGFsa3MuYm91bmNlID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBpZiAodmFsLmxlbmd0aCkgewogICAgICAgICAgICB2bS5nZXRUZWRUYWxrc0NvbmZpZyh2YWwpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdm0udGVkVGFsa3MudmlkZW8gPSBudWxsOwogICAgICAgICAgfQogICAgICAgIH0sIDUwMCk7CiAgICAgIH0KICAgIH0sCiAgICAieGhhbXN0ZXIudXJsIjogZnVuY3Rpb24geGhhbXN0ZXJVcmwodmFsKSB7CiAgICAgIHZhciB2bSA9IHRoaXM7CgogICAgICBpZiAoL3hoYW1zdGVyXC5jb21cL3ZpZGVvcy9pLnRlc3QodmFsKSkgewogICAgICAgIGNsZWFyVGltZW91dCh0aGlzLnhoYW1zdGVyQm91bmNlKTsKICAgICAgICB0aGlzLnhoYW1zdGVyQm91bmNlID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBpZiAodmFsLmxlbmd0aCkgewogICAgICAgICAgICB2bS5nZXRYaGFtc3RlckNvbmZpZyh2YWwpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdm0ueGhhbXN0ZXIudmlkZW8gPSBudWxsOwogICAgICAgICAgfQogICAgICAgIH0sIDUwMCk7CiAgICAgIH0KICAgIH0sCiAgICAiZmluZExvZ28uY291bnRyeSI6IGZ1bmN0aW9uIGZpbmRMb2dvQ291bnRyeSh2YWwpIHsKICAgICAgaWYgKHZhbC5sZW5ndGgpIHsKICAgICAgICB0aGlzLmxvYWRMb2dvc0ZpbmQodmFsKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmZpbmRMb2dvLmxvZ28gPSAiIjsKICAgICAgfQogICAgfSwKICAgICJhc3NpZ25Mb2dvLmNvdW50cnkiOiBmdW5jdGlvbiBhc3NpZ25Mb2dvQ291bnRyeSh2YWwpIHsKICAgICAgaWYgKHZhbC5sZW5ndGgpIHsKICAgICAgICB0aGlzLmxvYWRMb2dvc0Fzc2lnbih2YWwpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYXNzaWduTG9nby5sb2dvID0gIiI7CiAgICAgIH0KICAgIH0sCiAgICAiZmluZFRWR0lELmNvdW50cnkiOiBmdW5jdGlvbiBmaW5kVFZHSURDb3VudHJ5KHZhbCkgewogICAgICBpZiAodmFsLmxlbmd0aCkgewogICAgICAgIHRoaXMubG9hZFRWR0lERmluZCh2YWwpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZmluZFRWR0lELmNoYW5uZWwgPSAiIjsKICAgICAgfQogICAgfSwKICAgICJmaW5kU2lwdHYuY291bnRyeSI6IGZ1bmN0aW9uIGZpbmRTaXB0dkNvdW50cnkodmFsKSB7CiAgICAgIGlmICh2YWwubGVuZ3RoKSB7CiAgICAgICAgdGhpcy5sb2FkU2lwdHZGaW5kKHZhbCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5maW5kU2lwdHYuY2hhbm5lbCA9ICIiOwogICAgICB9CiAgICB9LAogICAgImFzc2lnblRWR0lELmNvdW50cnkiOiBmdW5jdGlvbiBhc3NpZ25UVkdJRENvdW50cnkodmFsKSB7CiAgICAgIGlmICh2YWwubGVuZ3RoKSB7CiAgICAgICAgdGhpcy5sb2FkVFZHSURBc3NpZ24odmFsKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmFzc2lnblRWR0lELmNoYW5uZWxzID0gW107CiAgICAgIH0KICAgIH0sCiAgICAiYXNzaWduU0lQVFYuY291bnRyeSI6IGZ1bmN0aW9uIGFzc2lnblNJUFRWQ291bnRyeSh2YWwpIHsKICAgICAgaWYgKHZhbC5sZW5ndGgpIHsKICAgICAgICB0aGlzLmxvYWRTaXB0dkFzc2lnbih2YWwpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYXNzaWduVFZHSUQuY2hhbm5lbHMgPSBbXTsKICAgICAgfQogICAgfSwKICAgIG1vdmllU2VyaWVQbGF5bGlzdDogZnVuY3Rpb24gbW92aWVTZXJpZVBsYXlsaXN0KHZhbCkgewogICAgICB0aGlzLmxvYWRQbGF5bGlzdCh2YWwpOwogICAgfQogIH0KfTs="},null]}