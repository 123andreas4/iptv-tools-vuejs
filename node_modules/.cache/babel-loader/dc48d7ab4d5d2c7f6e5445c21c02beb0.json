{"remainingRequest":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/thread-loader/dist/cjs.js!/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/babel-loader/lib/index.js!/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/cache-loader/dist/cjs.js??ref--0-0!/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/vue-loader/lib/index.js??vue-loader-options!/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/src/views/app/m3u/editor.vue?vue&type=script&lang=js&","dependencies":[{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/src/views/app/m3u/editor.vue","mtime":1625832793910},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF90b0NvbnN1bWFibGVBcnJheSBmcm9tICIvbWVkaWEvZXJuc3QvNjNiY2U0M2MtNWU1MS00YmYxLWE2MTEtM2FmZGYzMmFjNmY2L1Z1ZUpTL0lQVFYtVG9vbHMvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL3RvQ29uc3VtYWJsZUFycmF5IjsKaW1wb3J0IF9vYmplY3RTcHJlYWQgZnJvbSAiL21lZGlhL2VybnN0LzYzYmNlNDNjLTVlNTEtNGJmMS1hNjExLTNhZmRmMzJhYzZmNi9WdWVKUy9JUFRWLVRvb2xzL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9vYmplY3RTcHJlYWQyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc2VhcmNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmNvbnN0cnVjdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLnRvLXN0cmluZy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbHRlci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5tYXRjaC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbmQtaW5kZXguanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5tYXAuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5udW1iZXIuY29uc3RydWN0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuam9pbi5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pdGVyYXRvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuaXRlcmF0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zb3J0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5jbHVkZXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuaW5jbHVkZXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zcGxpY2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcucmVwbGFjZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmNvbmNhdC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmZ1bmN0aW9uLm5hbWUuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3Qua2V5cy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbmQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc3BsaXQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIudXJsLmpzIjsKLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCi8qIGVzbGludC1kaXNhYmxlIHZ1ZS9uby1zaWRlLWVmZmVjdHMtaW4tY29tcHV0ZWQtcHJvcGVydGllcyAqLwoKLyogZXNsaW50LWRpc2FibGUgbm8tdW51c2VkLXZhcnMgKi8KCi8qIGVzbGludC1kaXNhYmxlIG5vLXVzZWxlc3MtZXNjYXBlICovCmltcG9ydCB7IEV2ZW50QnVzIH0gZnJvbSAiLi4vLi4vLi4vc2VydmljZXMvZWJ1cyI7CmltcG9ydCB7IGh0dHBTZXJ2aWNlIH0gZnJvbSAiLi4vLi4vLi4vc2VydmljZXMvaHR0cCI7CmltcG9ydCB7IG1hcEdldHRlcnMgfSBmcm9tICJ2dWV4IjsKaW1wb3J0IGRyYWdnYWJsZSBmcm9tICJ2dWVkcmFnZ2FibGUiOwppbXBvcnQgeyBTdWJzY3JpcHRpb25UeXBlIH0gZnJvbSAiLi4vLi4vLi4vY29uc3RhbnRzL2NvbmZpZyI7CmltcG9ydCB7IGNvdW50cmllcyB9IGZyb20gIi4uLy4uLy4uL2hlbHBlcnMiOwppbXBvcnQgeyBtM3UgfSBmcm9tICIuLi8uLi8uLi9wbHVnaW5zL20zdSI7CmV4cG9ydCBkZWZhdWx0IHsKICBjb21wb25lbnRzOiB7CiAgICBkcmFnZ2FibGU6IGRyYWdnYWJsZQogIH0sCiAgZGF0YTogZnVuY3Rpb24gZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGRhdGVPcHRpb25zOiB7CiAgICAgICAgZGF5OiAiMi1kaWdpdCIsCiAgICAgICAgbW9udGg6ICJudW1lcmljIiwKICAgICAgICB5ZWFyOiAibnVtZXJpYyIKICAgICAgfSwKICAgICAgY291bnRyaWVzOiBjb3VudHJpZXMsCiAgICAgIGFjdGl2ZVRhYjogMCwKICAgICAgYWN0aXZlR3JvdXA6IC0xLAogICAgICBhY3RpdmVHcm91cHM6IFtdLAogICAgICBhY3RpdmVTdHJlYW06IC0xLAogICAgICBhY3RpdmVTdHJlYW1zOiBbXSwKICAgICAgZHJhZ0dyb3VwOiBmYWxzZSwKICAgICAgZHJhZ1N0cmVhbTogZmFsc2UsCiAgICAgIGVkaXRvcjogZmFsc2UsCiAgICAgIHNlYXJjaDogbnVsbCwKICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgcGxheWxpc3RFZGl0b3I6IHsKICAgICAgICBpZDogdW5kZWZpbmVkLAogICAgICAgIHBsYXlsaXN0OiBudWxsLAogICAgICAgIGdyb3VwczogW10sCiAgICAgICAgc3RyZWFtczogW10sCiAgICAgICAgY2hhbmdlZDogZmFsc2UKICAgICAgfSwKICAgICAgZmluZFJlcGxhY2U6IHsKICAgICAgICB0eXBlOiAwLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBmcm9tOiAiIiwKICAgICAgICB0bzogIiIsCiAgICAgICAgcmVwbGFjZUFsbDogZmFsc2UsCiAgICAgICAgaWdub3JlQ2FzZTogZmFsc2UsCiAgICAgICAgc2VsZWN0ZWRPbmx5OiAwCiAgICAgIH0sCiAgICAgIHByZWZpeFN1ZmZpeDogewogICAgICAgIHR5cGU6IDAsCiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIHByZWZpeDogIiIsCiAgICAgICAgc3VmZml4OiAiIiwKICAgICAgICBzZWxlY3RlZE9ubHk6IDAKICAgICAgfSwKICAgICAgY29udmVydENhc2U6IHsKICAgICAgICB0eXBlOiAwLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBtZXRob2Q6IDAsCiAgICAgICAgc2VsZWN0ZWRPbmx5OiAwCiAgICAgIH0sCiAgICAgIGdyb3VwRWRpdG9yOiB7CiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIGlkOiAwLAogICAgICAgIGdyb3VwX25hbWU6ICIiLAogICAgICAgIGdyb3VwX3BhcmVudF9jb2RlOiAiIiwKICAgICAgICBncm91cF90eXBlOiAxLAogICAgICAgIGdyb3VwX2lzX2hpZGRlbjogMAogICAgICB9LAogICAgICBzdHJlYW1FZGl0b3I6IHsKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgaWQ6IC0xLAogICAgICAgIHN0cmVhbV90dmdfbmFtZTogIiIsCiAgICAgICAgc3RyZWFtX3R2Z19pZDogIiIsCiAgICAgICAgc3RyZWFtX3R2Z19sb2dvOiAiIiwKICAgICAgICBzdHJlYW1fdHZnX2Nobm86ICIiLAogICAgICAgIHN0cmVhbV90dmdfc2hpZnQ6ICIiLAogICAgICAgIHN0cmVhbV9wYXJlbnRfY29kZTogIiIsCiAgICAgICAgc3RyZWFtX2F1ZGlvX3RyYWNrOiAiIiwKICAgICAgICBzdHJlYW1fYXNwZWN0X3JhdGlvOiAiIiwKICAgICAgICBzdHJlYW1fcmFkaW86IDAsCiAgICAgICAgc3RyZWFtX2lzX2hpZGRlbjogMCwKICAgICAgICBzdHJlYW1faXNfY3VzdG9tOiAwLAogICAgICAgIG1vdmllX25hbWU6ICIiLAogICAgICAgIG1vdmllX3llYXI6ICIiLAogICAgICAgIHNlcmllX25hbWU6ICIiLAogICAgICAgIHNlcmllX3NlYXNvbjogMCwKICAgICAgICBzZXJpZV9lcGlzb2RlOiAwLAogICAgICAgIHNvdXJjZV9zdHJlYW1fdXJsOiAiIgogICAgICB9LAogICAgICByYWRpb0Jyb3dzZXI6IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBib3VuY2U6IG51bGwsCiAgICAgICAgYWN0aXZlOiBbXSwKICAgICAgICBzZWFyY2g6ICIiLAogICAgICAgIHJlc3VsdHM6IFtdCiAgICAgIH0sCiAgICAgIHNvdW5kY2xvdWQ6IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBib3VuY2U6IG51bGwsCiAgICAgICAgdXJsOiAiIiwKICAgICAgICB0cmFjazogbnVsbAogICAgICB9LAogICAgICB5b3V0dWJlOiB7CiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgYm91bmNlOiBudWxsLAogICAgICAgIHVybDogIiIsCiAgICAgICAgdmlkZW9JZDogIiIsCiAgICAgICAgdmlkZW86IG51bGwKICAgICAgfSwKICAgICAgdmltZW86IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBib3VuY2U6IG51bGwsCiAgICAgICAgdXJsOiAiIiwKICAgICAgICB2aWRlb0lkOiAiIiwKICAgICAgICB2aWRlbzogbnVsbAogICAgICB9LAogICAgICBkYWlseW1vdGlvbjogewogICAgICAgIGlzTG9hZGluZzogZmFsc2UsCiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIGJvdW5jZTogbnVsbCwKICAgICAgICB1cmw6ICIiLAogICAgICAgIHZpZGVvSWQ6ICIiLAogICAgICAgIHZpZGVvOiBudWxsCiAgICAgIH0sCiAgICAgIHRlZFRhbGtzOiB7CiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgYm91bmNlOiBudWxsLAogICAgICAgIHVybDogIiIsCiAgICAgICAgdmlkZW86IG51bGwKICAgICAgfSwKICAgICAgeGhhbXN0ZXI6IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBib3VuY2U6IG51bGwsCiAgICAgICAgdXJsOiAiIiwKICAgICAgICB2aWRlbzogbnVsbAogICAgICB9LAogICAgICBmaW5kTG9nbzogewogICAgICAgIGlzTG9hZGluZzogZmFsc2UsCiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIGNvdW50cmllczogW10sCiAgICAgICAgY291bnRyeTogIiIsCiAgICAgICAgbG9nb3M6IFtdLAogICAgICAgIGxvZ286ICIiLAogICAgICAgIHNlYXJjaDogIiIsCiAgICAgICAgdGl0bGU6ICIiCiAgICAgIH0sCiAgICAgIGFzc2lnbkxvZ286IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBjb3VudHJpZXM6IFtdLAogICAgICAgIGNvdW50cnk6ICIiLAogICAgICAgIGxvZ29zOiBbXSwKICAgICAgICBhc3NpZ25BbGw6IDAKICAgICAgfSwKICAgICAgaW1wb3J0TTNVOiB7CiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgZ3JvdXBzOiBbXSwKICAgICAgICBpbXBvcnRHcm91cHM6IFtdLAogICAgICAgIG0zdTogbnVsbCwKICAgICAgICBmaWxlOiBudWxsCiAgICAgIH0sCiAgICAgIGZpbmRUVkdJRDogewogICAgICAgIGlzTG9hZGluZzogZmFsc2UsCiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIGNvdW50cmllczogW10sCiAgICAgICAgY291bnRyeTogIiIsCiAgICAgICAgY2hhbm5lbHM6IFtdLAogICAgICAgIGNoYW5uZWw6ICIiLAogICAgICAgIHNlYXJjaDogIiIsCiAgICAgICAgdGl0bGU6ICIiCiAgICAgIH0sCiAgICAgIGZpbmRTaXB0djogewogICAgICAgIGlzTG9hZGluZzogZmFsc2UsCiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIGNvdW50cmllczogW10sCiAgICAgICAgY291bnRyeTogIiIsCiAgICAgICAgY2hhbm5lbHM6IFtdLAogICAgICAgIGNoYW5uZWw6ICIiLAogICAgICAgIHNlYXJjaDogIiIsCiAgICAgICAgdGl0bGU6ICIiCiAgICAgIH0sCiAgICAgIGFzc2lnblRWR0lEOiB7CiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgY291bnRyaWVzOiBbXSwKICAgICAgICBjb3VudHJ5OiAiIiwKICAgICAgICBjaGFubmVsczogW10sCiAgICAgICAgYXNzaWduQWxsOiAwCiAgICAgIH0sCiAgICAgIGFzc2lnblNJUFRWOiB7CiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgY291bnRyaWVzOiBbXSwKICAgICAgICBjb3VudHJ5OiAiIiwKICAgICAgICBjaGFubmVsczogW10sCiAgICAgICAgYXNzaWduQWxsOiAwCiAgICAgIH0sCiAgICAgIHNhdmVDaGFuZ2VzOiB7CiAgICAgICAgbW9kYWw6IGZhbHNlCiAgICAgIH0sCiAgICAgIGdyb3VwVHlwZXM6IFt7CiAgICAgICAgdGV4dDogdGhpcy4kdCgieHRyZWFtLmxpdmUiKSwKICAgICAgICB2YWx1ZTogMQogICAgICB9LCB7CiAgICAgICAgdGV4dDogdGhpcy4kdCgieHRyZWFtLm1vdmllcyIpLAogICAgICAgIHZhbHVlOiAyCiAgICAgIH0sIHsKICAgICAgICB0ZXh0OiB0aGlzLiR0KCJ4dHJlYW0uc2VyaWVzIiksCiAgICAgICAgdmFsdWU6IDMKICAgICAgfV0KICAgIH07CiAgfSwKICBjb21wdXRlZDogX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBtYXBHZXR0ZXJzKFsiY3VycmVudFVzZXIiLCAic2V0dGluZ3MiLCAic291bmRjbG91ZENsaWVudElkIiwgIm1vdmllU2VyaWVQbGF5bGlzdCJdKSksIHt9LCB7CiAgICBzZWFyY2hGaWx0ZXJlZDogZnVuY3Rpb24gc2VhcmNoRmlsdGVyZWQoKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBpZiAodGhpcy5zZWFyY2ggPT09IG51bGwpIHsKICAgICAgICByZXR1cm4gdGhpcy5hY2NvdW50czsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgcmUgPSBuZXcgUmVnRXhwKHRoaXMuc2VhcmNoLCAiaSIpOwogICAgICAgIHJldHVybiB0aGlzLmFjY291bnRzLmZpbHRlcihmdW5jdGlvbiAoYWNjb3VudCkgewogICAgICAgICAgcmV0dXJuIFN0cmluZyhhY2NvdW50LnRpdGxlKS5tYXRjaChyZSkgfHwgU3RyaW5nKGFjY291bnQuaG9zdCkubWF0Y2gocmUpIHx8IFN0cmluZyhhY2NvdW50LnBvcnQpLm1hdGNoKHJlKSB8fCBTdHJpbmcoYWNjb3VudC51c2VybmFtZSkubWF0Y2gocmUpIHx8IFN0cmluZyhhY2NvdW50LnBhc3N3b3JkKS5tYXRjaChyZSkgfHwgX3RoaXMuZm9ybWF0RGF0ZShhY2NvdW50LnN5bmNlZF9hdCkubWF0Y2gocmUpIHx8IF90aGlzLiR0KCJzeW5jLWludGVydmFsLiIuY29uY2F0KGFjY291bnQuc3luY19pbnRlcnZhbCkpLm1hdGNoKHJlKTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIHBsYXlsaXN0U2VsZWN0ZWQ6IGZ1bmN0aW9uIHBsYXlsaXN0U2VsZWN0ZWQoKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkICE9PSB1bmRlZmluZWQ7CiAgICB9LAogICAgbGFzdFNlbGVjdGVkR3JvdXA6IGZ1bmN0aW9uIGxhc3RTZWxlY3RlZEdyb3VwKCkgewogICAgICByZXR1cm4gdGhpcy5hY3RpdmVHcm91cHNbdGhpcy5hY3RpdmVHcm91cHMubGVuZ3RoIC0gMV07CiAgICB9LAogICAgbGFzdFNlbGVjdGVkU3RyZWFtOiBmdW5jdGlvbiBsYXN0U2VsZWN0ZWRTdHJlYW0oKSB7CiAgICAgIHJldHVybiB0aGlzLmFjdGl2ZVN0cmVhbXNbdGhpcy5hY3RpdmVTdHJlYW1zLmxlbmd0aCAtIDFdOwogICAgfSwKICAgIGNhbkVkaXRHcm91cFR5cGU6IGZ1bmN0aW9uIGNhbkVkaXRHcm91cFR5cGUoKSB7CiAgICAgIHJldHVybiB0aGlzLmdyb3VwRWRpdG9yLmlkICYmIHRoaXMuZ2V0R3JvdXBXaXRoSWQodGhpcy5ncm91cEVkaXRvci5pZCkuc3RyZWFtcyA9PSAwOwogICAgfSwKICAgIHN1YnNjcmlwdGlvbkxpbWl0ZWQ6IGZ1bmN0aW9uIHN1YnNjcmlwdGlvbkxpbWl0ZWQoKSB7CiAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRVc2VyLnN1YnNjcmlwdGlvbiAmJiB0aGlzLmN1cnJlbnRVc2VyLnN1YnNjcmlwdGlvbi5zdWJzY3JpcHRpb25fdHlwZSA9PSBTdWJzY3JpcHRpb25UeXBlLkVudGh1c2lhc3Q7CiAgICB9LAogICAgZmlsdGVyZWRHcm91cHM6IGZ1bmN0aW9uIGZpbHRlcmVkR3JvdXBzKCkgewogICAgICBpZiAodGhpcy5zdWJzY3JpcHRpb25MaW1pdGVkKSB7CiAgICAgICAgcmV0dXJuIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbHRlcihmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICAgIHJldHVybiBncm91cC5ncm91cF9pc19yZW1vdmVkICE9PSAxICYmIGdyb3VwLnNvdXJjZV9ncm91cF90eXBlID09IDEgJiYgZ3JvdXAuZ3JvdXBfdHlwZSA9PSAxOwogICAgICAgIH0pOwogICAgICB9CgogICAgICByZXR1cm4gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmlsdGVyKGZ1bmN0aW9uIChncm91cCkgewogICAgICAgIHJldHVybiBncm91cC5ncm91cF9pc19yZW1vdmVkICE9PSAxOwogICAgICB9KTsKICAgIH0sCiAgICBmaWx0ZXJlZFN0cmVhbXM6IGZ1bmN0aW9uIGZpbHRlcmVkU3RyZWFtcygpIHsKICAgICAgcmV0dXJuIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5maWx0ZXIoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgcmV0dXJuIGdyb3VwLnN0cmVhbV9pc19yZW1vdmVkICE9PSAxOwogICAgICB9KTsKICAgIH0sCiAgICBhY3RpdmVHcm91cFR5cGU6IGZ1bmN0aW9uIGFjdGl2ZUdyb3VwVHlwZSgpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICB2YXIgaW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgcmV0dXJuIGdyb3VwLmlkID09IF90aGlzMi5hY3RpdmVHcm91cDsKICAgICAgfSk7CiAgICAgIHJldHVybiBpbmRleCA+IC0xID8gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaW5kZXhdLmdyb3VwX3R5cGUgOiAwOwogICAgfSwKICAgIGZpbHRlcmVkTG9nb3M6IGZ1bmN0aW9uIGZpbHRlcmVkTG9nb3MoKSB7CiAgICAgIGlmICghdGhpcy5maW5kTG9nby5zZWFyY2gubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZmluZExvZ28ubG9nb3M7CiAgICAgIH0KCiAgICAgIHZhciBzZWxlY3RlZFN0cmVhbSA9IHRoaXMuZ2V0U3RyZWFtV2l0aElkKHRoaXMuYWN0aXZlU3RyZWFtc1swXSk7CiAgICAgIHZhciByZSA9IG5ldyBSZWdFeHAodGhpcy5maW5kTG9nby5zZWFyY2gsICJpIik7CiAgICAgIHJldHVybiB0aGlzLmZpbmRMb2dvLmxvZ29zLmZpbHRlcihmdW5jdGlvbiAobG9nbykgewogICAgICAgIHJldHVybiBsb2dvLnRleHQubWF0Y2gocmUpOwogICAgICB9KTsKICAgIH0sCiAgICBmaWx0ZXJlZFRWR0lEUzogZnVuY3Rpb24gZmlsdGVyZWRUVkdJRFMoKSB7CiAgICAgIGlmICghdGhpcy5maW5kVFZHSUQuc2VhcmNoLmxlbmd0aCkgewogICAgICAgIHJldHVybiB0aGlzLmZpbmRUVkdJRC5jaGFubmVsczsKICAgICAgfQoKICAgICAgdmFyIHNlbGVjdGVkU3RyZWFtID0gdGhpcy5nZXRTdHJlYW1XaXRoSWQodGhpcy5hY3RpdmVTdHJlYW1zWzBdKTsKICAgICAgdmFyIHJlID0gbmV3IFJlZ0V4cCh0aGlzLmZpbmRUVkdJRC5zZWFyY2gsICJpIik7CiAgICAgIHJldHVybiB0aGlzLmZpbmRUVkdJRC5jaGFubmVscy5maWx0ZXIoZnVuY3Rpb24gKGNoYW5uZWwpIHsKICAgICAgICByZXR1cm4gY2hhbm5lbC50ZXh0Lm1hdGNoKHJlKTsKICAgICAgfSk7CiAgICB9LAogICAgZmlsdGVyZWRTaXB0dklEUzogZnVuY3Rpb24gZmlsdGVyZWRTaXB0dklEUygpIHsKICAgICAgaWYgKCF0aGlzLmZpbmRTaXB0di5zZWFyY2gubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZmluZFNpcHR2LmNoYW5uZWxzOwogICAgICB9CgogICAgICB2YXIgc2VsZWN0ZWRTdHJlYW0gPSB0aGlzLmdldFN0cmVhbVdpdGhJZCh0aGlzLmFjdGl2ZVN0cmVhbXNbMF0pOwogICAgICB2YXIgcmUgPSBuZXcgUmVnRXhwKHRoaXMuZmluZFNpcHR2LnNlYXJjaCwgImkiKTsKICAgICAgcmV0dXJuIHRoaXMuZmluZFNpcHR2LmNoYW5uZWxzLmZpbHRlcihmdW5jdGlvbiAoY2hhbm5lbCkgewogICAgICAgIHJldHVybiBjaGFubmVsLnRleHQubWF0Y2gocmUpOwogICAgICB9KTsKICAgIH0sCiAgICBncm91cENvbnRleHRNZW51OiBmdW5jdGlvbiBncm91cENvbnRleHRNZW51KCkgewogICAgICB2YXIgdm0gPSB0aGlzOwogICAgICByZXR1cm4gW3sKICAgICAgICBpY29uOiAibGEtcGx1cyIsCiAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5hZGQtZ3JvdXAiKSwKICAgICAgICBvbkNsaWNrOiB2bS5hZGRHcm91cAogICAgICB9LCB7CiAgICAgICAgZGlzYWJsZWQ6IHZtLmFjdGl2ZUdyb3Vwcy5sZW5ndGggIT09IDEsCiAgICAgICAgaWNvbjogImxhLWVkaXQiLAogICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IuZWRpdC1ncm91cCIpLAogICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICBpZiAodm0uYWN0aXZlR3JvdXBzLmxlbmd0aCA9PT0gMSkgewogICAgICAgICAgICB2bS5lZGl0R3JvdXBNb2RhbCh0cnVlKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBkaXZpZGVyOiB0cnVlCiAgICAgIH0sIHsKICAgICAgICB0ZXh0OiB2bS4kdCgiZ2VuZXJhbC5zZWxlY3QtYWxsIiksCiAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgIHZtLmFjdGl2ZUdyb3VwcyA9IF90b0NvbnN1bWFibGVBcnJheSh2bS5wbGF5bGlzdEVkaXRvci5ncm91cHMubWFwKGZ1bmN0aW9uIChnKSB7CiAgICAgICAgICAgIHJldHVybiBnLmlkOwogICAgICAgICAgfSkpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIHRleHQ6IHZtLiR0KCJnZW5lcmFsLnNlbGVjdC1ub25lIiksCiAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgIHZtLmFjdGl2ZUdyb3VwcyA9IFtdOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGRpdmlkZXI6IHRydWUKICAgICAgfSwgewogICAgICAgIGljb246ICJsYS1zZWFyY2giLAogICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IuZmluZC1yZXBsYWNlIiksCiAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgIHZtLmZpbmRBbmRSZXBsYWNlTW9kYWwodHJ1ZSwgMSk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAgaWNvbjogImxhLXBlbiIsCiAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5hZGQtcHJlZml4LXN1ZmZpeCIpLAogICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICB2bS5wcmVmaXhTdWZmaXhNb2RhbCh0cnVlLCAxKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBpY29uOiAibGEtZm9udCIsCiAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5jaGFuZ2UtY2FzZSIpLAogICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICB2bS5jb252ZXJ0Q2FzZU1vZGFsKHRydWUsIDEpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGRpdmlkZXI6IHRydWUKICAgICAgfSwgewogICAgICAgIGRpc2FibGVkOiB2bS5hY3RpdmVHcm91cHMubGVuZ3RoID09PSAwLAogICAgICAgIGljb246ICJsYS1leWUiLAogICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IudG9nZ2xlLXZpc2liaWxpdHkiKSwKICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgaWYgKHZtLmFjdGl2ZUdyb3Vwcy5sZW5ndGgpIHsKICAgICAgICAgICAgdm0udG9nZ2xlR3JvdXBWaXNpYmlsaXR5KCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAgZGlzYWJsZWQ6IHZtLmFjdGl2ZUdyb3Vwcy5sZW5ndGggPT09IDAsCiAgICAgICAgaWNvbjogImxhLXRyYXNoIiwKICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLmRlbGV0ZSIpLAogICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICBpZiAodm0uYWN0aXZlR3JvdXBzLmxlbmd0aCkgewogICAgICAgICAgICB2bS5kZWxldGVTZWxlY3RlZEdyb3VwcygpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfV07CiAgICB9LAogICAgc3RyZWFtQ29udGV4dE1lbnU6IGZ1bmN0aW9uIHN0cmVhbUNvbnRleHRNZW51KCkgewogICAgICB2YXIgdm0gPSB0aGlzOwogICAgICByZXR1cm4gW3sKICAgICAgICBpY29uOiAibGEtcGx1cyIsCiAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5hZGQtc3RyZWFtIiksCiAgICAgICAgb25DbGljazogdm0uYWRkU3RyZWFtCiAgICAgIH0sIHsKICAgICAgICBkaXNhYmxlZDogdm0uYWN0aXZlU3RyZWFtcy5sZW5ndGggIT09IDEsCiAgICAgICAgaWNvbjogImxhLWVkaXQiLAogICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IuZWRpdC1zdHJlYW0iKSwKICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgaWYgKHZtLmFjdGl2ZVN0cmVhbXMubGVuZ3RoID09PSAxKSB7CiAgICAgICAgICAgIHZtLmVkaXRTdHJlYW1Nb2RhbCh0cnVlKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBkaXZpZGVyOiB0cnVlCiAgICAgIH0sIHsKICAgICAgICB0ZXh0OiB2bS4kdCgiZ2VuZXJhbC5zZWxlY3QtYWxsIiksCiAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgIHZtLmFjdGl2ZVN0cmVhbXMgPSBfdG9Db25zdW1hYmxlQXJyYXkodm0ucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5tYXAoZnVuY3Rpb24gKGcpIHsKICAgICAgICAgICAgcmV0dXJuIGcuaWQ7CiAgICAgICAgICB9KSk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAgdGV4dDogdm0uJHQoImdlbmVyYWwuc2VsZWN0LW5vbmUiKSwKICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgdm0uYWN0aXZlU3RyZWFtcyA9IFtdOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGRpdmlkZXI6IHRydWUKICAgICAgfSwgewogICAgICAgIGRpc2FibGVkOiB2bS5hY3RpdmVHcm91cHMubGVuZ3RoICE9PSAxIHx8IHZtLmFjdGl2ZVN0cmVhbXMubGVuZ3RoID09PSAwIHx8IHZtLmdldEdyb3VwV2l0aElkKHZtLmFjdGl2ZUdyb3Vwc1swXSkuZ3JvdXBfdHlwZSAhPT0gdm0uYWN0aXZlR3JvdXBUeXBlIHx8IHZtLmFjdGl2ZUdyb3Vwc1swXSA9PT0gdm0uYWN0aXZlR3JvdXAsCiAgICAgICAgaWNvbjogImxhLWNoZXZyb24tbGVmdCIsCiAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5tb3ZlLXRvLXNlbGVjdGVkLWdyb3VwIiksCiAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgIHZtLm1vdmVUb1NlbGVjdGVkR3JvdXAoKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBkaXZpZGVyOiB0cnVlCiAgICAgIH0sIHsKICAgICAgICBpY29uOiAibGEtc2VhcmNoIiwKICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLmZpbmQtcmVwbGFjZSIpLAogICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICB2bS5maW5kQW5kUmVwbGFjZU1vZGFsKHRydWUsIDIpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGljb246ICJsYS1wZW4iLAogICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IuYWRkLXByZWZpeC1zdWZmaXgiKSwKICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgdm0ucHJlZml4U3VmZml4TW9kYWwodHJ1ZSwgMik7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAgaWNvbjogImxhLWZvbnQiLAogICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IuY2hhbmdlLWNhc2UiKSwKICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgdm0uY29udmVydENhc2VNb2RhbCh0cnVlLCAyKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBkaXZpZGVyOiB0cnVlCiAgICAgIH0sIHsKICAgICAgICBkaXNhYmxlZDogdm0uYWN0aXZlU3RyZWFtcy5sZW5ndGggIT09IDEgfHwgdm0uYWN0aXZlR3JvdXBUeXBlICE9PSAxLAogICAgICAgIGljb246ICJsYS1waG90by12aWRlbyIsCiAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5maW5kLWxvZ28iKSwKICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgdm0uZmluZExvZ29Nb2RhbCh0cnVlKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBkaXNhYmxlZDogdm0uYWN0aXZlU3RyZWFtcy5sZW5ndGggIT09IDEgfHwgdm0uYWN0aXZlR3JvdXBUeXBlICE9PSAxLAogICAgICAgIGljb246ICJsYS10aC1saXN0IiwKICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLmZpbmQtdHYtZ3VpZGUiKSwKICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgdm0uZmluZFRWR0lETW9kYWwodHJ1ZSk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAgZGlzYWJsZWQ6IHZtLmFjdGl2ZVN0cmVhbXMubGVuZ3RoICE9PSAxIHx8IHZtLmFjdGl2ZUdyb3VwVHlwZSAhPT0gMSwKICAgICAgICBpY29uOiAibGEtdGgtbGlzdCIsCiAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5maW5kLXNpcHR2IiksCiAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgIHZtLmZpbmRTaXB0dk1vZGFsKHRydWUpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGRpdmlkZXI6IHRydWUKICAgICAgfSwgewogICAgICAgIGRpc2FibGVkOiB2bS5hY3RpdmVTdHJlYW1zLmxlbmd0aCA9PT0gMCB8fCB2bS5hY3RpdmVHcm91cFR5cGUgIT09IDEsCiAgICAgICAgaWNvbjogImxhLW11c2ljIiwKICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLnRvZ2dsZS1yYWRpbyIpLAogICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICBpZiAodm0uYWN0aXZlU3RyZWFtcy5sZW5ndGggJiYgdm0uYWN0aXZlR3JvdXBUeXBlID09IDEpIHsKICAgICAgICAgICAgdm0udG9nZ2xlU3RyZWFtUmFkaW8oKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBkaXNhYmxlZDogdm0uYWN0aXZlU3RyZWFtcy5sZW5ndGggPT09IDAsCiAgICAgICAgaWNvbjogImxhLWV5ZSIsCiAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci50b2dnbGUtdmlzaWJpbGl0eSIpLAogICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICBpZiAodm0uYWN0aXZlU3RyZWFtcy5sZW5ndGgpIHsKICAgICAgICAgICAgdm0udG9nZ2xlU3RyZWFtVmlzaWJpbGl0eSgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGRpdmlkZXI6IHRydWUKICAgICAgfSwgewogICAgICAgIGRpc2FibGVkOiB2bS5hY3RpdmVTdHJlYW1zLmxlbmd0aCA9PT0gMCwKICAgICAgICBpY29uOiAibGEtdHJhc2giLAogICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IuZGVsZXRlIiksCiAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgIGlmICh2bS5hY3RpdmVTdHJlYW1zLmxlbmd0aCkgewogICAgICAgICAgICB2bS5kZWxldGVTZWxlY3RlZFN0cmVhbXMoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH1dOwogICAgfQogIH0pLAogIG1ldGhvZHM6IHsKICAgIGdyb3VwRHJhZ0NoYW5nZWQ6IGZ1bmN0aW9uIGdyb3VwRHJhZ0NoYW5nZWQoZykgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmdyb3VwX29yZGVyICE9IGkgKyAxKSB7CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5ncm91cF9vcmRlciA9IGkgKyAxOwogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHN0cmVhbURyYWdDaGFuZ2VkOiBmdW5jdGlvbiBzdHJlYW1EcmFnQ2hhbmdlZChnKSB7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5zdHJlYW1fb3JkZXIgIT0gaSArIDEpIHsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5zdHJlYW1fb3JkZXIgPSBpICsgMTsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgb3BlbkNvbnRleHQ6IGZ1bmN0aW9uIG9wZW5Db250ZXh0KGNvbnRleHQpIHsKICAgICAgdGhpcy4kcmVmc1tjb250ZXh0XS5vcGVuKCk7CiAgICB9LAogICAgc2VhcmNoRWRpdG9yOiBmdW5jdGlvbiBzZWFyY2hFZGl0b3Ioc2VhcmNoKSB7CiAgICAgIGlmIChzZWFyY2gubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhpcy5zZWFyY2ggPSBudWxsOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc2VhcmNoID0gc2VhcmNoOwogICAgICB9CiAgICB9LAogICAgcHJpbnRFZGl0b3I6IGZ1bmN0aW9uIHByaW50RWRpdG9yKCkgewogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZWRpdG9yIikucHJpbnQoKTsKICAgIH0sCiAgICBmb3JtYXROdW1iZXI6IGZ1bmN0aW9uIGZvcm1hdE51bWJlcihudW1iZXIpIHsKICAgICAgcmV0dXJuIG5ldyBJbnRsLk51bWJlckZvcm1hdCh0aGlzLiR0KCJkYXRlLmxvY2FsZSIpKS5mb3JtYXQobnVtYmVyKTsKICAgIH0sCiAgICBmb3JtYXREYXRlOiBmdW5jdGlvbiBmb3JtYXREYXRlKGRhdGUpIHsKICAgICAgcmV0dXJuIG5ldyBEYXRlKGRhdGUpLnRvTG9jYWxlU3RyaW5nKHRoaXMuJHQoImRhdGUubG9jYWxlIiksIHRoaXMuZGF0ZU9wdGlvbnMpOwogICAgfSwKICAgIGZvcm1hdERhdGVZb3V0dWJlOiBmdW5jdGlvbiBmb3JtYXREYXRlWW91dHViZShkYXRlKSB7CiAgICAgIHJldHVybiBuZXcgRGF0ZShkYXRlKS50b0xvY2FsZURhdGVTdHJpbmcodGhpcy4kdCgiZGF0ZS5sb2NhbGUiKSwgewogICAgICAgIHllYXI6ICJudW1lcmljIiwKICAgICAgICBtb250aDogInNob3J0IiwKICAgICAgICBkYXk6ICJudW1lcmljIgogICAgICB9KTsKICAgIH0sCiAgICBmb3JtYXRTZWNvbmRzOiBmdW5jdGlvbiBmb3JtYXRTZWNvbmRzKHNlYykgewogICAgICB2YXIgZCA9IE51bWJlcihzZWMpOwogICAgICB2YXIgaCA9IE1hdGguZmxvb3IoZCAvIDM2MDApOwogICAgICB2YXIgbSA9IE1hdGguZmxvb3IoZCAlIDM2MDAgLyA2MCk7CiAgICAgIHZhciBzID0gTWF0aC5mbG9vcihkICUgMzYwMCAlIDYwKTsKICAgICAgdmFyIGhvdXIgPSB0aGlzLiR0KCJnZW5lcmFsLmhvdXIiKTsKICAgICAgdmFyIGhvdXJzID0gdGhpcy4kdCgiZ2VuZXJhbC5ob3VycyIpOwogICAgICB2YXIgbWludXRlID0gdGhpcy4kdCgiZ2VuZXJhbC5taW51dGUiKTsKICAgICAgdmFyIG1pbnV0ZXMgPSB0aGlzLiR0KCJnZW5lcmFsLm1pbnV0ZXMiKTsKICAgICAgdmFyIHNlY29uZCA9IHRoaXMuJHQoImdlbmVyYWwuc2Vjb25kIik7CiAgICAgIHZhciBzZWNvbmRzID0gdGhpcy4kdCgiZ2VuZXJhbC5zZWNvbmRzIik7CiAgICAgIHZhciBoRGlzcGxheSA9IGggPiAwID8gaCArIChoID09IDEgPyAiICIuY29uY2F0KGhvdXIsICIgIikgOiAiICIuY29uY2F0KGhvdXJzLCAiICIpKSA6ICIiOwogICAgICB2YXIgbURpc3BsYXkgPSBtID4gMCA/IG0gKyAobSA9PSAxID8gIiAiLmNvbmNhdChtaW51dGUsICIgIikgOiAiICIuY29uY2F0KG1pbnV0ZXMsICIgIikpIDogIiI7CiAgICAgIHZhciBzRGlzcGxheSA9IHMgPiAwID8gcyArIChzID09IDEgPyAiICIuY29uY2F0KHNlY29uZCwgIiAiKSA6ICIgIi5jb25jYXQoc2Vjb25kcywgIiAiKSkgOiAiIjsKICAgICAgcmV0dXJuIGhEaXNwbGF5ICsgbURpc3BsYXkgKyBzRGlzcGxheTsKICAgIH0sCiAgICBnZXRHcm91cFdpdGhJZDogZnVuY3Rpb24gZ2V0R3JvdXBXaXRoSWQoaWQpIHsKICAgICAgdmFyIGluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KGZ1bmN0aW9uIChncm91cCkgewogICAgICAgIHJldHVybiBncm91cC5pZCA9PSBpZDsKICAgICAgfSk7CiAgICAgIHJldHVybiB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpbmRleF07CiAgICB9LAogICAgZ2V0U3RyZWFtV2l0aElkOiBmdW5jdGlvbiBnZXRTdHJlYW1XaXRoSWQoaWQpIHsKICAgICAgdmFyIGluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmZpbmRJbmRleChmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAgICAgcmV0dXJuIHN0cmVhbS5pZCA9PSBpZDsKICAgICAgfSk7CiAgICAgIHJldHVybiB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdOwogICAgfSwKICAgIGRvU2F2ZTogZnVuY3Rpb24gZG9TYXZlKCkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gZmFsc2U7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkgewogICAgICAgIHZhciBpbmRleCA9IF90aGlzMy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KGZ1bmN0aW9uIChncm91cCkgewogICAgICAgICAgcmV0dXJuIGdyb3VwLmlkID09IF90aGlzMy5hY3RpdmVHcm91cDsKICAgICAgICB9KTsKCiAgICAgICAgdmFyIHVwZGF0ZUdyb3VwcyA9IF90aGlzMy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmlsdGVyKGZ1bmN0aW9uIChncm91cCkgewogICAgICAgICAgcmV0dXJuICFncm91cC5ncm91cF9pc19yZW1vdmVkICYmIGdyb3VwLm1vZGlmaWVkOwogICAgICAgIH0pLm1hcChmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGlkOiBncm91cC5pZCwKICAgICAgICAgICAgZ3JvdXBfbmFtZTogZ3JvdXAuZ3JvdXBfbmFtZSwKICAgICAgICAgICAgZ3JvdXBfb3JkZXI6IGdyb3VwLmdyb3VwX29yZGVyLAogICAgICAgICAgICBncm91cF90eXBlOiBncm91cC5ncm91cF90eXBlLAogICAgICAgICAgICBncm91cF9wYXJlbnRfY29kZTogZ3JvdXAuZ3JvdXBfcGFyZW50X2NvZGUsCiAgICAgICAgICAgIGdyb3VwX2lzX2hpZGRlbjogZ3JvdXAuZ3JvdXBfaXNfaGlkZGVuCiAgICAgICAgICB9OwogICAgICAgIH0pOwoKICAgICAgICB2YXIgZGVsZXRlR3JvdXBzID0gX3RoaXMzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maWx0ZXIoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgICByZXR1cm4gZ3JvdXAuZ3JvdXBfaXNfcmVtb3ZlZCAmJiBncm91cC5tb2RpZmllZDsKICAgICAgICB9KS5tYXAoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgICByZXR1cm4gZ3JvdXAuaWQ7CiAgICAgICAgfSkuam9pbigpOwoKICAgICAgICB2YXIgdXBkYXRlU3RyZWFtczsKCiAgICAgICAgc3dpdGNoIChfdGhpczMuYWN0aXZlR3JvdXBUeXBlKSB7CiAgICAgICAgICAvLyBMaXZlIHN0cmVhbXMKICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgdXBkYXRlU3RyZWFtcyA9IF90aGlzMy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmZpbHRlcihmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHN0cmVhbS5zdHJlYW1faXNfcmVtb3ZlZCAhPT0gMSAmJiBzdHJlYW0ubW9kaWZpZWQ7CiAgICAgICAgICAgIH0pLm1hcChmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGlkOiBzdHJlYW0uaWQsCiAgICAgICAgICAgICAgICBzb3VyY2Vfc3RyZWFtX3VybDogc3RyZWFtLnNvdXJjZV9zdHJlYW1fdXJsLAogICAgICAgICAgICAgICAgc3RyZWFtX3R2Z19uYW1lOiBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lLAogICAgICAgICAgICAgICAgc3RyZWFtX3R2Z19pZDogc3RyZWFtLnN0cmVhbV90dmdfaWQsCiAgICAgICAgICAgICAgICBzdHJlYW1fdHZnX2xvZ286IHN0cmVhbS5zdHJlYW1fdHZnX2xvZ28sCiAgICAgICAgICAgICAgICBzdHJlYW1fdHZnX2Nobm86IHN0cmVhbS5zdHJlYW1fdHZnX2Nobm8sCiAgICAgICAgICAgICAgICBzdHJlYW1fdHZnX3NoaWZ0OiBzdHJlYW0uc3RyZWFtX3R2Z19zaGlmdCwKICAgICAgICAgICAgICAgIHN0cmVhbV9wYXJlbnRfY29kZTogc3RyZWFtLnN0cmVhbV9wYXJlbnRfY29kZSwKICAgICAgICAgICAgICAgIHN0cmVhbV9hdWRpb190cmFjazogc3RyZWFtLnN0cmVhbV9hdWRpb190cmFjaywKICAgICAgICAgICAgICAgIHN0cmVhbV9hc3BlY3RfcmF0aW86IHN0cmVhbS5zdHJlYW1fYXNwZWN0X3JhdGlvLAogICAgICAgICAgICAgICAgc3RyZWFtX3JhZGlvOiBzdHJlYW0uc3RyZWFtX3JhZGlvLAogICAgICAgICAgICAgICAgc3RyZWFtX2lzX2hpZGRlbjogc3RyZWFtLnN0cmVhbV9pc19oaWRkZW4sCiAgICAgICAgICAgICAgICBzdHJlYW1fb3JkZXI6IHN0cmVhbS5zdHJlYW1fb3JkZXIKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAvLyBNb3ZpZXMKCiAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgIHVwZGF0ZVN0cmVhbXMgPSBfdGhpczMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5maWx0ZXIoZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgICAgICAgIHJldHVybiBzdHJlYW0uc3RyZWFtX2lzX3JlbW92ZWQgIT09IDEgJiYgc3RyZWFtLm1vZGlmaWVkOwogICAgICAgICAgICB9KS5tYXAoZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBpZDogc3RyZWFtLmlkLAogICAgICAgICAgICAgICAgbW92aWVfbmFtZTogc3RyZWFtLm1vdmllX25hbWUsCiAgICAgICAgICAgICAgICBtb3ZpZV95ZWFyOiBzdHJlYW0ubW92aWVfeWVhciwKICAgICAgICAgICAgICAgIHRtZGJfaWQ6IHN0cmVhbS50bWRiX2lkLAogICAgICAgICAgICAgICAgc291cmNlX3N0cmVhbV91cmw6IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX3VybCwKICAgICAgICAgICAgICAgIHN0cmVhbV90dmdfbmFtZTogc3RyZWFtLnN0cmVhbV90dmdfbmFtZSwKICAgICAgICAgICAgICAgIHN0cmVhbV90dmdfaWQ6IHN0cmVhbS5zdHJlYW1fdHZnX2lkLAogICAgICAgICAgICAgICAgc3RyZWFtX3R2Z19sb2dvOiBzdHJlYW0uc3RyZWFtX3R2Z19sb2dvLAogICAgICAgICAgICAgICAgc3RyZWFtX3R2Z19jaG5vOiBzdHJlYW0uc3RyZWFtX3R2Z19jaG5vLAogICAgICAgICAgICAgICAgc3RyZWFtX3R2Z19zaGlmdDogc3RyZWFtLnN0cmVhbV90dmdfc2hpZnQsCiAgICAgICAgICAgICAgICBzdHJlYW1fcGFyZW50X2NvZGU6IHN0cmVhbS5zdHJlYW1fcGFyZW50X2NvZGUsCiAgICAgICAgICAgICAgICBzdHJlYW1fYXVkaW9fdHJhY2s6IHN0cmVhbS5zdHJlYW1fYXVkaW9fdHJhY2ssCiAgICAgICAgICAgICAgICBzdHJlYW1fYXNwZWN0X3JhdGlvOiBzdHJlYW0uc3RyZWFtX2FzcGVjdF9yYXRpbywKICAgICAgICAgICAgICAgIHN0cmVhbV9pc19oaWRkZW46IHN0cmVhbS5zdHJlYW1faXNfaGlkZGVuLAogICAgICAgICAgICAgICAgc3RyZWFtX29yZGVyOiBzdHJlYW0uc3RyZWFtX29yZGVyCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgLy8gU2VyaWVzCgogICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICB1cGRhdGVTdHJlYW1zID0gX3RoaXMzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMuZmlsdGVyKGZ1bmN0aW9uIChzdHJlYW0pIHsKICAgICAgICAgICAgICByZXR1cm4gc3RyZWFtLnN0cmVhbV9pc19yZW1vdmVkICE9PSAxICYmIHN0cmVhbS5tb2RpZmllZDsKICAgICAgICAgICAgfSkubWFwKGZ1bmN0aW9uIChzdHJlYW0pIHsKICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgaWQ6IHN0cmVhbS5pZCwKICAgICAgICAgICAgICAgIHNlcmllX25hbWU6IHN0cmVhbS5zZXJpZV9uYW1lLAogICAgICAgICAgICAgICAgc2VyaWVfc2Vhc29uOiBzdHJlYW0uc2VyaWVfc2Vhc29uLAogICAgICAgICAgICAgICAgc2VyaWVfZXBpc29kZTogc3RyZWFtLnNlcmllX2VwaXNvZGUsCiAgICAgICAgICAgICAgICB0bWRiX2lkOiBzdHJlYW0udG1kYl9pZCwKICAgICAgICAgICAgICAgIHNvdXJjZV9zdHJlYW1fdXJsOiBzdHJlYW0uc291cmNlX3N0cmVhbV91cmwsCiAgICAgICAgICAgICAgICBzdHJlYW1fdHZnX25hbWU6IHN0cmVhbS5zdHJlYW1fdHZnX25hbWUsCiAgICAgICAgICAgICAgICBzdHJlYW1fdHZnX2lkOiBzdHJlYW0uc3RyZWFtX3R2Z19pZCwKICAgICAgICAgICAgICAgIHN0cmVhbV90dmdfbG9nbzogc3RyZWFtLnN0cmVhbV90dmdfbG9nbywKICAgICAgICAgICAgICAgIHN0cmVhbV90dmdfY2hubzogc3RyZWFtLnN0cmVhbV90dmdfY2hubywKICAgICAgICAgICAgICAgIHN0cmVhbV90dmdfc2hpZnQ6IHN0cmVhbS5zdHJlYW1fdHZnX3NoaWZ0LAogICAgICAgICAgICAgICAgc3RyZWFtX3BhcmVudF9jb2RlOiBzdHJlYW0uc3RyZWFtX3BhcmVudF9jb2RlLAogICAgICAgICAgICAgICAgc3RyZWFtX2F1ZGlvX3RyYWNrOiBzdHJlYW0uc3RyZWFtX2F1ZGlvX3RyYWNrLAogICAgICAgICAgICAgICAgc3RyZWFtX2FzcGVjdF9yYXRpbzogc3RyZWFtLnN0cmVhbV9hc3BlY3RfcmF0aW8sCiAgICAgICAgICAgICAgICBzdHJlYW1faXNfaGlkZGVuOiBzdHJlYW0uc3RyZWFtX2lzX2hpZGRlbiwKICAgICAgICAgICAgICAgIHN0cmVhbV9vcmRlcjogc3RyZWFtLnN0cmVhbV9vcmRlcgogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICAgIHZhciBkZWxldGVTdHJlYW1zID0gX3RoaXMzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMuZmlsdGVyKGZ1bmN0aW9uIChzdHJlYW0pIHsKICAgICAgICAgIHJldHVybiBzdHJlYW0uc3RyZWFtX2lzX3JlbW92ZWQgPT09IDEgJiYgc3RyZWFtLm1vZGlmaWVkOwogICAgICAgIH0pLm1hcChmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAgICAgICByZXR1cm4gc3RyZWFtLmlkOwogICAgICAgIH0pLmpvaW4oKTsKCiAgICAgICAgdmFyIHJlcXVlc3RzID0gW107CgogICAgICAgIGlmICh1cGRhdGVHcm91cHMubGVuZ3RoKSB7CiAgICAgICAgICByZXF1ZXN0cy5wdXNoKGh0dHBTZXJ2aWNlLnBvc3QoImVkaXRvci91cGRhdGUtZ3JvdXBzIiwgewogICAgICAgICAgICBwbGF5bGlzdF9pZDogX3RoaXMzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgICBncm91cHM6IHVwZGF0ZUdyb3VwcwogICAgICAgICAgfSkpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGRlbGV0ZUdyb3Vwcy5sZW5ndGgpIHsKICAgICAgICAgIGluZGV4ID0gMDsKICAgICAgICAgIHJlcXVlc3RzLnB1c2goaHR0cFNlcnZpY2UucG9zdCgiZWRpdG9yL2RlbGV0ZS1ncm91cHMiLCB7CiAgICAgICAgICAgIHBsYXlsaXN0X2lkOiBfdGhpczMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICAgIGdyb3VwczogZGVsZXRlR3JvdXBzCiAgICAgICAgICB9KSk7CiAgICAgICAgfQoKICAgICAgICBpZiAodXBkYXRlU3RyZWFtcy5sZW5ndGgpIHsKICAgICAgICAgIHJlcXVlc3RzLnB1c2goaHR0cFNlcnZpY2UucG9zdCgiZWRpdG9yL3VwZGF0ZS1zdHJlYW1zLyIuY29uY2F0KF90aGlzMy5hY3RpdmVHcm91cFR5cGUpLCB7CiAgICAgICAgICAgIHBsYXlsaXN0X2lkOiBfdGhpczMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICAgIHN0cmVhbXM6IHVwZGF0ZVN0cmVhbXMKICAgICAgICAgIH0pKTsKICAgICAgICB9CgogICAgICAgIGlmIChkZWxldGVTdHJlYW1zLmxlbmd0aCkgewogICAgICAgICAgcmVxdWVzdHMucHVzaChodHRwU2VydmljZS5wb3N0KCJlZGl0b3IvZGVsZXRlLXN0cmVhbXMvIi5jb25jYXQoX3RoaXMzLmFjdGl2ZUdyb3VwVHlwZSksIHsKICAgICAgICAgICAgcGxheWxpc3RfaWQ6IF90aGlzMy5wbGF5bGlzdEVkaXRvci5pZCwKICAgICAgICAgICAgc3RyZWFtczogZGVsZXRlU3RyZWFtcwogICAgICAgICAgfSkpOwogICAgICAgIH0KCiAgICAgICAgUHJvbWlzZS5hbGwocmVxdWVzdHMpLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgICAgX3RoaXMzLmxvYWRQbGF5bGlzdChfdGhpczMucGxheWxpc3RFZGl0b3IuaWQsIGluZGV4KTsKCiAgICAgICAgICByZXNvbHZlKHJlcyk7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSwKICAgIGRvQ2FuY2VsOiBmdW5jdGlvbiBkb0NhbmNlbCgpIHsKICAgICAgdmFyIF90aGlzNCA9IHRoaXM7CgogICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIFByb21pc2UuYWxsKFt0aGlzLnJlc3RvcmVHcm91cHMoKSwgdGhpcy5yZXN0b3JlU3RyZWFtcygpXSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXM0LnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSBmYWxzZTsKICAgICAgICBfdGhpczQuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0pOwogICAgfSwKICAgIGRvVGFiQ2hhbmdlOiBmdW5jdGlvbiBkb1RhYkNoYW5nZSh0YWIpIHsKICAgICAgdGhpcy5hY3RpdmVUYWIgPSB0YWI7CiAgICB9LAogICAgdXBkYXRlR3JvdXBPcmRlcjogZnVuY3Rpb24gdXBkYXRlR3JvdXBPcmRlcihzb3VyY2UpIHsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgICAgdmFyIGdyb3VwcyA9IF90b0NvbnN1bWFibGVBcnJheShzb3VyY2UpOwoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGdyb3Vwcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgZ3JvdXBzW2ldLnNvdXJjZV9ncm91cF9vcmRlciA9IGkgKyAxOwogICAgICAgICAgZ3JvdXBzW2ldLmdyb3VwX29yZGVyID0gaSArIDE7CiAgICAgICAgfQoKICAgICAgICByZXNvbHZlKGdyb3Vwcyk7CiAgICAgIH0pOwogICAgfSwKICAgIHVwZGF0ZVN0cmVhbU9yZGVyOiBmdW5jdGlvbiB1cGRhdGVTdHJlYW1PcmRlcihzb3VyY2UpIHsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgICAgdmFyIHN0cmVhbXMgPSBfdG9Db25zdW1hYmxlQXJyYXkoc291cmNlKTsKCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzdHJlYW1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBzdHJlYW1zW2ldLnNvdXJjZV9zdHJlYW1fb3JkZXIgPSBpICsgMTsKICAgICAgICAgIHN0cmVhbXNbaV0uc3RyZWFtX29yZGVyID0gaSArIDE7CiAgICAgICAgfQoKICAgICAgICByZXNvbHZlKHN0cmVhbXMpOwogICAgICB9KTsKICAgIH0sCiAgICByZXN0b3JlR3JvdXBPcmRlcjogZnVuY3Rpb24gcmVzdG9yZUdyb3VwT3JkZXIoKSB7CiAgICAgIHZhciBfdGhpczUgPSB0aGlzOwoKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgICAgX3RoaXM1LnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICByZXR1cm4gYS5zb3VyY2VfZ3JvdXBfb3JkZXIgPiBiLnNvdXJjZV9ncm91cF9vcmRlciA/IDEgOiBiLnNvdXJjZV9ncm91cF9vcmRlciA+IGEuc291cmNlX2dyb3VwX29yZGVyID8gLTEgOiAwOwogICAgICAgIH0pOwoKICAgICAgICByZXNvbHZlKCk7CiAgICAgIH0pOwogICAgfSwKICAgIHJlc3RvcmVTdHJlYW1PcmRlcjogZnVuY3Rpb24gcmVzdG9yZVN0cmVhbU9yZGVyKCkgewogICAgICB2YXIgX3RoaXM2ID0gdGhpczsKCiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkgewogICAgICAgIF90aGlzNi5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgIHJldHVybiBhLnNvdXJjZV9zdHJlYW1fb3JkZXIgPiBiLnNvdXJjZV9zdHJlYW1fb3JkZXIgPyAxIDogYi5zb3VyY2Vfc3RyZWFtX29yZGVyID4gYS5zb3VyY2Vfc3RyZWFtX29yZGVyID8gLTEgOiAwOwogICAgICAgIH0pOwoKICAgICAgICByZXNvbHZlKCk7CiAgICAgIH0pOwogICAgfSwKICAgIHJlc3RvcmVHcm91cHM6IGZ1bmN0aW9uIHJlc3RvcmVHcm91cHMoKSB7CiAgICAgIHZhciBfdGhpczcgPSB0aGlzOwoKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgICAgX3RoaXM3LnJlc3RvcmVHcm91cE9yZGVyKCkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgZ3JvdXA7CgogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBfdGhpczcucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGdyb3VwID0gX3RoaXM3LnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXTsKICAgICAgICAgICAgZ3JvdXAubW9kaWZpZWQgPSBmYWxzZTsKICAgICAgICAgICAgZ3JvdXAuZ3JvdXBfaXNfcmVtb3ZlZCA9IDA7CiAgICAgICAgICAgIGdyb3VwLmdyb3VwX3R5cGUgPSBncm91cC5zb3VyY2VfZ3JvdXBfdHlwZTsKICAgICAgICAgICAgZ3JvdXAuZ3JvdXBfbmFtZSA9IGdyb3VwLnNvdXJjZV9ncm91cF9uYW1lOwogICAgICAgICAgICBncm91cC5wYXJlbnRfY29kZSA9IGdyb3VwLnNvdXJjZV9ncm91cF9wYXJlbnRfY29kZTsKICAgICAgICAgICAgZ3JvdXAuZ3JvdXBfaXNfaGlkZGVuID0gZ3JvdXAuc291cmNlX2dyb3VwX2lzX2hpZGRlbjsKICAgICAgICAgIH0KCiAgICAgICAgICByZXNvbHZlKCk7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSwKICAgIHJlc3RvcmVTdHJlYW1zOiBmdW5jdGlvbiByZXN0b3JlU3RyZWFtcygpIHsKICAgICAgdmFyIF90aGlzOCA9IHRoaXM7CgogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgICAgICBfdGhpczgucmVzdG9yZVN0cmVhbU9yZGVyKCkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgc3RyZWFtOwoKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgX3RoaXM4LnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgc3RyZWFtID0gX3RoaXM4LnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV07CiAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IGZhbHNlOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX2lzX3JlbW92ZWQgPSAwOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lID0gc3RyZWFtLnNvdXJjZV9zdHJlYW1fdHZnX25hbWU7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX2lkID0gc3RyZWFtLnNvdXJjZV9zdHJlYW1fdHZnX2lkOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19sb2dvID0gc3RyZWFtLnNvdXJjZV9zdHJlYW1fdHZnX2xvZ287CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX2Nobm8gPSBzdHJlYW0uc291cmNlX3N0cmVhbV90dmdfY2hubzsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfc2hpZnQgPSBzdHJlYW0uc291cmNlX3N0cmVhbV90dmdfc2hpZnQ7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fcGFyZW50X2NvZGUgPSBzdHJlYW0uc291cmNlX3N0cmVhbV9wYXJlbnRfY29kZTsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV9hdWRpb190cmFjayA9IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX2F1ZGlvX3RyYWNrOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX2FzcGVjdF9yYXRpbyA9IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX2FzcGVjdF9yYXRpbzsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV9yYWRpbyA9IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX3JhZGlvOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX29yZGVyID0gc3RyZWFtLnNvdXJjZV9zdHJlYW1fb3JkZXI7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1faXNfaGlkZGVuID0gc3RyZWFtLnNvdXJjZV9zdHJlYW1faXNfaGlkZGVuOwoKICAgICAgICAgICAgaWYgKHN0cmVhbS5tb3ZpZV9uYW1lICE9PSB1bmRlZmluZWQgJiYgc3RyZWFtLm1vdmllX3llYXIgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIHN0cmVhbS5tb3ZpZV9uYW1lID0gc3RyZWFtLnNvdXJjZV9tb3ZpZV9uYW1lOwogICAgICAgICAgICAgIHN0cmVhbS5tb3ZpZV95ZWFyID0gc3RyZWFtLnNvdXJjZV9tb3ZpZV95ZWFyOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoc3RyZWFtLnNlcmllX25hbWUgIT09IHVuZGVmaW5lZCAmJiBzdHJlYW0uc2VyaWVfc2Vhc29uICE9PSB1bmRlZmluZWQgJiYgc3RyZWFtLnNlcmllX2VwaXNvZGUgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIHN0cmVhbS5zZXJpZV9uYW1lID0gc3RyZWFtLnNvdXJjZV9zZXJpZV9uYW1lOwogICAgICAgICAgICAgIHN0cmVhbS5zZXJpZV9zZWFzb24gPSBzdHJlYW0uc291cmNlX3NlcmllX3NlYXNvbjsKICAgICAgICAgICAgICBzdHJlYW0uc2VyaWVfZXBpc29kZSA9IHN0cmVhbS5zb3VyY2Vfc2VyaWVfZXBpc29kZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LAogICAgdG9nZ2xlR3JvdXBWaXNpYmlsaXR5OiBmdW5jdGlvbiB0b2dnbGVHcm91cFZpc2liaWxpdHkoKSB7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cHMuaW5jbHVkZXModGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uaWQpKSB7CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5ncm91cF9pc19oaWRkZW4gPSAhdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uZ3JvdXBfaXNfaGlkZGVuOwogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgIH0sCiAgICB0b2dnbGVTdHJlYW1WaXNpYmlsaXR5OiBmdW5jdGlvbiB0b2dnbGVTdHJlYW1WaXNpYmlsaXR5KCkgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmICh0aGlzLmFjdGl2ZVN0cmVhbXMuaW5jbHVkZXModGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLmlkKSkgewogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLnN0cmVhbV9pc19oaWRkZW4gPSAhdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLnN0cmVhbV9pc19oaWRkZW47CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgIH0sCiAgICB0b2dnbGVTdHJlYW1SYWRpbzogZnVuY3Rpb24gdG9nZ2xlU3RyZWFtUmFkaW8oKSB7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHRoaXMuYWN0aXZlU3RyZWFtcy5pbmNsdWRlcyh0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uaWQpKSB7CiAgICAgICAgICBpZiAodGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLnN0cmVhbV9yYWRpbyA9PSAwKSB7CiAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5zdHJlYW1fcmFkaW8gPSAxOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLnN0cmVhbV9yYWRpbyA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICB9LAogICAgZGVsZXRlU2VsZWN0ZWRHcm91cHM6IGZ1bmN0aW9uIGRlbGV0ZVNlbGVjdGVkR3JvdXBzKCkgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBzLmluY2x1ZGVzKHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmlkKSkgewogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uZ3JvdXBfaXNfcmVtb3ZlZCA9IDE7CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgfSwKICAgIGRlbGV0ZVNlbGVjdGVkU3RyZWFtczogZnVuY3Rpb24gZGVsZXRlU2VsZWN0ZWRTdHJlYW1zKCkgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmICh0aGlzLmFjdGl2ZVN0cmVhbXMuaW5jbHVkZXModGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLmlkKSkgewogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLnN0cmVhbV9pc19yZW1vdmVkID0gMTsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgfSwKICAgIGxvYWRQbGF5bGlzdDogZnVuY3Rpb24gbG9hZFBsYXlsaXN0KHZhbCkgewogICAgICB2YXIgX3RoaXM5ID0gdGhpczsKCiAgICAgIHZhciBncm91cF9pbmRleCA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkOwogICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7CgogICAgICBpZiAodGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkKSB7CiAgICAgICAgdGhpcy5kb1NhdmUoKTsKICAgICAgfQoKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5pZCA9IHZhbDsKICAgICAgaHR0cFNlcnZpY2UuZ2V0KCJlZGl0b3IvZ3JvdXBzLyIuY29uY2F0KHZhbCkpLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgIGlmIChyZXMuc3RhdHVzID09PSB0cnVlKSB7CiAgICAgICAgICBfdGhpczkudXBkYXRlR3JvdXBPcmRlcihyZXMuZGF0YSkudGhlbihmdW5jdGlvbiAoZ3JvdXBzKSB7CiAgICAgICAgICAgIF90aGlzOS5wbGF5bGlzdEVkaXRvci5ncm91cHMgPSBncm91cHMubWFwKGZ1bmN0aW9uIChncm91cCkgewogICAgICAgICAgICAgIHZhciBncnAgPSBPYmplY3QuYXNzaWduKHt9LCBncm91cCk7CiAgICAgICAgICAgICAgZ3JwLnNvdXJjZV9ncm91cF9wYXJlbnRfY29kZSA9IGdyb3VwLmdyb3VwX3BhcmVudF9jb2RlOwogICAgICAgICAgICAgIGdycC5zb3VyY2VfZ3JvdXBfaXNfaGlkZGVuID0gZ3JvdXAuZ3JvdXBfaXNfaGlkZGVuOwogICAgICAgICAgICAgIGdycC5zb3VyY2VfZ3JvdXBfbmFtZSA9IGdyb3VwLmdyb3VwX25hbWU7CiAgICAgICAgICAgICAgZ3JwLnNvdXJjZV9ncm91cF90eXBlID0gZ3JvdXAuZ3JvdXBfdHlwZTsKICAgICAgICAgICAgICBncnAuZ3JvdXBfaXNfcmVtb3ZlZCA9IGZhbHNlOwogICAgICAgICAgICAgIGdycC5tb2RpZmllZCA9IGZhbHNlOwogICAgICAgICAgICAgIHJldHVybiBncnA7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaWYgKGdyb3Vwcy5sZW5ndGgpIHsKICAgICAgICAgICAgICBpZiAoZ3JvdXBfaW5kZXggPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgX3RoaXM5LmFjdGl2ZUdyb3VwID0gX3RoaXM5LnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1swXS5pZDsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgX3RoaXM5LmFjdGl2ZUdyb3VwID0gX3RoaXM5LnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tncm91cF9pbmRleF0uaWQ7CgogICAgICAgICAgICAgICAgX3RoaXM5LmxvYWRTdHJlYW1zKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIF90aGlzOS5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzOS5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfSk7CiAgICB9LAogICAgdG9nZ2xlR3JvdXBTZWxlY3Rpb246IGZ1bmN0aW9uIHRvZ2dsZUdyb3VwU2VsZWN0aW9uKGl0ZW0pIHsKICAgICAgdmFyIGlkeCA9IHRoaXMuYWN0aXZlR3JvdXBzLmluZGV4T2YoaXRlbSk7CgogICAgICBpZiAoaWR4ICE9PSAtMSkgewogICAgICAgIHRoaXMuYWN0aXZlR3JvdXBzLnNwbGljZShpZHgsIDEpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYWN0aXZlR3JvdXBzLnB1c2goaXRlbSk7CiAgICAgIH0KICAgIH0sCiAgICB0b2dnbGVTdHJlYW1TZWxlY3Rpb246IGZ1bmN0aW9uIHRvZ2dsZVN0cmVhbVNlbGVjdGlvbihpdGVtKSB7CiAgICAgIHZhciBpZHggPSB0aGlzLmFjdGl2ZVN0cmVhbXMuaW5kZXhPZihpdGVtKTsKCiAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgdGhpcy5hY3RpdmVTdHJlYW1zLnNwbGljZShpZHgsIDEpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYWN0aXZlU3RyZWFtcy5wdXNoKGl0ZW0pOwogICAgICB9CiAgICB9LAogICAgdG9nZ2xlUmFkaW9icm93c2VyU2VsZWN0aW9uOiBmdW5jdGlvbiB0b2dnbGVSYWRpb2Jyb3dzZXJTZWxlY3Rpb24oaXRlbSkgewogICAgICB2YXIgaWR4ID0gdGhpcy5yYWRpb0Jyb3dzZXIuYWN0aXZlLmluZGV4T2YoaXRlbSk7CgogICAgICBpZiAoaWR4ICE9PSAtMSkgewogICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZS5zcGxpY2UoaWR4LCAxKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnJhZGlvQnJvd3Nlci5hY3RpdmUucHVzaChpdGVtKTsKICAgICAgfQogICAgfSwKICAgIHRvZ2dsZUltcG9ydE0zVVNlbGVjdGlvbjogZnVuY3Rpb24gdG9nZ2xlSW1wb3J0TTNVU2VsZWN0aW9uKGl0ZW0pIHsKICAgICAgdmFyIGlkeCA9IHRoaXMuaW1wb3J0TTNVLmltcG9ydEdyb3Vwcy5pbmRleE9mKGl0ZW0pOwoKICAgICAgaWYgKGlkeCAhPT0gLTEpIHsKICAgICAgICB0aGlzLmltcG9ydE0zVS5pbXBvcnRHcm91cHMuc3BsaWNlKGlkeCwgMSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5pbXBvcnRNM1UuaW1wb3J0R3JvdXBzLnB1c2goaXRlbSk7CiAgICAgIH0KICAgIH0sCiAgICBpbmRleE9mR3JvdXA6IGZ1bmN0aW9uIGluZGV4T2ZHcm91cChncm91cCkgewogICAgICByZXR1cm4gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMubWFwKGZ1bmN0aW9uIChnKSB7CiAgICAgICAgcmV0dXJuIGcuaWQ7CiAgICAgIH0pLmluZGV4T2YoZ3JvdXApOwogICAgfSwKICAgIHNlbGVjdEdyb3VwUmFuZ2VTZWxlY3Rpb246IGZ1bmN0aW9uIHNlbGVjdEdyb3VwUmFuZ2VTZWxlY3Rpb24oaXRlbSkgewogICAgICB2YXIgbGFzdEluZGV4ID0gdGhpcy5pbmRleE9mR3JvdXAodGhpcy5sYXN0U2VsZWN0ZWRHcm91cCk7CiAgICAgIHZhciBpdGVtSW5kZXggPSB0aGlzLmluZGV4T2ZHcm91cChpdGVtKTsKICAgICAgdmFyIGRpciA9IGl0ZW1JbmRleCA+IGxhc3RJbmRleCA/IDEgOiAtMTsKCiAgICAgIGZvciAodmFyIGkgPSBsYXN0SW5kZXg7IGkgIT0gaXRlbUluZGV4ICsgZGlyOyBpICs9IGRpcikgewogICAgICAgIGlmICghdGhpcy5hY3RpdmVHcm91cHMuaW5jbHVkZXModGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uaWQpKSB7CiAgICAgICAgICB0aGlzLmFjdGl2ZUdyb3Vwcy5wdXNoKHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmlkKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBpbmRleE9mU3RyZWFtOiBmdW5jdGlvbiBpbmRleE9mU3RyZWFtKHN0cmVhbSkgewogICAgICByZXR1cm4gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLm1hcChmdW5jdGlvbiAoZykgewogICAgICAgIHJldHVybiBnLmlkOwogICAgICB9KS5pbmRleE9mKHN0cmVhbSk7CiAgICB9LAogICAgc2VsZWN0U3RyZWFtUmFuZ2VTZWxlY3Rpb246IGZ1bmN0aW9uIHNlbGVjdFN0cmVhbVJhbmdlU2VsZWN0aW9uKGl0ZW0pIHsKICAgICAgdmFyIGxhc3RJbmRleCA9IHRoaXMuaW5kZXhPZlN0cmVhbSh0aGlzLmxhc3RTZWxlY3RlZFN0cmVhbSk7CiAgICAgIHZhciBpdGVtSW5kZXggPSB0aGlzLmluZGV4T2ZTdHJlYW0oaXRlbSk7CiAgICAgIHZhciBkaXIgPSBpdGVtSW5kZXggPiBsYXN0SW5kZXggPyAxIDogLTE7CgogICAgICBmb3IgKHZhciBpID0gbGFzdEluZGV4OyBpICE9IGl0ZW1JbmRleCArIGRpcjsgaSArPSBkaXIpIHsKICAgICAgICBpZiAoIXRoaXMuYWN0aXZlU3RyZWFtcy5pbmNsdWRlcyh0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uaWQpKSB7CiAgICAgICAgICB0aGlzLmFjdGl2ZVN0cmVhbXMucHVzaCh0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uaWQpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHNlbGVjdFJhZGlvYnJvd3NlclJhbmdlU2VsZWN0aW9uOiBmdW5jdGlvbiBzZWxlY3RSYWRpb2Jyb3dzZXJSYW5nZVNlbGVjdGlvbihpbmRleCkgewogICAgICB2YXIgbGFzdEluZGV4ID0gdGhpcy5yYWRpb0Jyb3dzZXIuYWN0aXZlW3RoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZS5sZW5ndGggLSAxXTsKICAgICAgdmFyIGRpciA9IGluZGV4ID4gbGFzdEluZGV4ID8gMSA6IC0xOwoKICAgICAgZm9yICh2YXIgaSA9IGxhc3RJbmRleDsgaSAhPSBpbmRleCArIGRpcjsgaSArPSBkaXIpIHsKICAgICAgICBpZiAoIXRoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZS5pbmNsdWRlcyhpKSkgewogICAgICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuYWN0aXZlLnB1c2goaSk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgc2VsZWN0SW1wb3J0TTNVUmFuZ2VTZWxlY3Rpb246IGZ1bmN0aW9uIHNlbGVjdEltcG9ydE0zVVJhbmdlU2VsZWN0aW9uKGluZGV4KSB7CiAgICAgIHZhciBsYXN0SW5kZXggPSB0aGlzLmltcG9ydE0zVS5pbXBvcnRHcm91cHNbdGhpcy5pbXBvcnRNM1UuaW1wb3J0R3JvdXBzLmxlbmd0aCAtIDFdOwogICAgICB2YXIgZGlyID0gaW5kZXggPiBsYXN0SW5kZXggPyAxIDogLTE7CgogICAgICBmb3IgKHZhciBpID0gbGFzdEluZGV4OyBpICE9IGluZGV4ICsgZGlyOyBpICs9IGRpcikgewogICAgICAgIGlmICghdGhpcy5pbXBvcnRNM1UuaW1wb3J0R3JvdXBzLmluY2x1ZGVzKGkpKSB7CiAgICAgICAgICB0aGlzLmltcG9ydE0zVS5pbXBvcnRHcm91cHMucHVzaChpKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBzZWxlY3RHcm91cFNlbGVjdGlvbjogZnVuY3Rpb24gc2VsZWN0R3JvdXBTZWxlY3Rpb24oaXRlbSkgewogICAgICB0aGlzLmFjdGl2ZUdyb3Vwcy5sZW5ndGggPSAwOwogICAgICB0aGlzLmFjdGl2ZUdyb3Vwcy5wdXNoKGl0ZW0pOwogICAgfSwKICAgIHNlbGVjdFN0cmVhbVNlbGVjdGlvbjogZnVuY3Rpb24gc2VsZWN0U3RyZWFtU2VsZWN0aW9uKGl0ZW0pIHsKICAgICAgdGhpcy5hY3RpdmVTdHJlYW1zLmxlbmd0aCA9IDA7CiAgICAgIHRoaXMuYWN0aXZlU3RyZWFtcy5wdXNoKGl0ZW0pOwogICAgfSwKICAgIHNlbGVjdFJhZGlvYnJvd3NlclNlbGVjdGlvbjogZnVuY3Rpb24gc2VsZWN0UmFkaW9icm93c2VyU2VsZWN0aW9uKGl0ZW0pIHsKICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuYWN0aXZlLmxlbmd0aCA9IDA7CiAgICAgIHRoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZS5wdXNoKGl0ZW0pOwogICAgfSwKICAgIHNlbGVjdEltcG9ydE0zVVNlbGVjdGlvbjogZnVuY3Rpb24gc2VsZWN0SW1wb3J0TTNVU2VsZWN0aW9uKGl0ZW0pIHsKICAgICAgdGhpcy5pbXBvcnRNM1UuaW1wb3J0R3JvdXBzLmxlbmd0aCA9IDA7CiAgICAgIHRoaXMuaW1wb3J0TTNVLmltcG9ydEdyb3Vwcy5wdXNoKGl0ZW0pOwogICAgfSwKICAgIGZpbmRBbmRSZXBsYWNlTW9kYWw6IGZ1bmN0aW9uIGZpbmRBbmRSZXBsYWNlTW9kYWwoc2hvdykgewogICAgICB2YXIgdHlwZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogMTsKICAgICAgdGhpcy5maW5kUmVwbGFjZS50eXBlID0gdHlwZTsKICAgICAgdGhpcy5maW5kUmVwbGFjZS5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgZmluZEFuZFJlcGxhY2U6IGZ1bmN0aW9uIGZpbmRBbmRSZXBsYWNlKCkgewogICAgICB2YXIgX3RoaXMxMCA9IHRoaXM7CgogICAgICB2YXIgb3B0aW9ucyA9ICIiOwoKICAgICAgaWYgKHRoaXMuZmluZFJlcGxhY2UucmVwbGFjZUFsbCkgewogICAgICAgIG9wdGlvbnMgKz0gImciOwogICAgICB9CgogICAgICBpZiAodGhpcy5maW5kUmVwbGFjZS5pZ25vcmVDYXNlKSB7CiAgICAgICAgb3B0aW9ucyArPSAiaSI7CiAgICAgIH0KCiAgICAgIHZhciByZSA9IG5ldyBSZWdFeHAodGhpcy5maW5kUmVwbGFjZS5mcm9tLnJlcGxhY2UoInwiLCAiXFx8IiksIG9wdGlvbnMpOwoKICAgICAgc3dpdGNoIChwYXJzZUludCh0aGlzLmZpbmRSZXBsYWNlLnR5cGUpKSB7CiAgICAgICAgLy8gR3JvdXAKICAgICAgICBjYXNlIDE6CiAgICAgICAgICBpZiAocGFyc2VJbnQodGhpcy5maW5kUmVwbGFjZS5zZWxlY3RlZE9ubHkpID09PSAxKSB7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cHMuaW5jbHVkZXModGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uaWQpKSB7CiAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5ncm91cF9uYW1lID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uZ3JvdXBfbmFtZS5yZXBsYWNlKHJlLCB0aGlzLmZpbmRSZXBsYWNlLnRvKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuZmlsdGVyZWRHcm91cHMubWFwKGZ1bmN0aW9uIChncm91cCkgewogICAgICAgICAgICAgIGdyb3VwLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICBncm91cC5ncm91cF9uYW1lID0gZ3JvdXAuZ3JvdXBfbmFtZS5yZXBsYWNlKHJlLCBfdGhpczEwLmZpbmRSZXBsYWNlLnRvKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgYnJlYWs7CiAgICAgICAgLy8gU3RyZWFtcwoKICAgICAgICBjYXNlIDI6CiAgICAgICAgICBpZiAocGFyc2VJbnQodGhpcy5maW5kUmVwbGFjZS5zZWxlY3RlZE9ubHkpID09PSAxKSB7CiAgICAgICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOyBfaSsrKSB7CiAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlU3RyZWFtcy5pbmNsdWRlcyh0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbX2ldLmlkKSkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAxKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tfaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbX2ldLnN0cmVhbV90dmdfbmFtZSA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tfaV0uc3RyZWFtX3R2Z19uYW1lLnJlcGxhY2UocmUsIHRoaXMuZmluZFJlcGxhY2UudG8pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMikgewogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbX2ldLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW19pXS5tb3ZpZV9uYW1lID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW19pXS5tb3ZpZV9uYW1lLnJlcGxhY2UocmUsIHRoaXMuZmluZFJlcGxhY2UudG8pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMykgewogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbX2ldLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW19pXS5zZXJpZV9uYW1lID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW19pXS5zZXJpZV9uYW1lLnJlcGxhY2UocmUsIHRoaXMuZmluZFJlcGxhY2UudG8pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5maWx0ZXJlZFN0cmVhbXMubWFwKGZ1bmN0aW9uIChzdHJlYW0pIHsKICAgICAgICAgICAgICBpZiAoX3RoaXMxMC5hY3RpdmVHcm91cFR5cGUgPT09IDEpIHsKICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lID0gc3RyZWFtLnN0cmVhbV90dmdfbmFtZS5yZXBsYWNlKHJlLCBfdGhpczEwLmZpbmRSZXBsYWNlLnRvKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChfdGhpczEwLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMikgewogICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHN0cmVhbS5tb3ZpZV9uYW1lID0gc3RyZWFtLm1vdmllX25hbWUucmVwbGFjZShyZSwgX3RoaXMxMC5maW5kUmVwbGFjZS50byk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoX3RoaXMxMC5hY3RpdmVHcm91cFR5cGUgPT09IDMpIHsKICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICBzdHJlYW0uc2VyaWVfbmFtZSA9IHN0cmVhbS5zZXJpZV9uYW1lLnJlcGxhY2UocmUsIF90aGlzMTAuZmluZFJlcGxhY2UudG8pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgYnJlYWs7CiAgICAgIH0KCiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICAgIHRoaXMuZmluZFJlcGxhY2UubW9kYWwgPSBmYWxzZTsKICAgIH0sCiAgICBwcmVmaXhTdWZmaXhNb2RhbDogZnVuY3Rpb24gcHJlZml4U3VmZml4TW9kYWwoc2hvdykgewogICAgICB2YXIgdHlwZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogMTsKICAgICAgdGhpcy5wcmVmaXhTdWZmaXgudHlwZSA9IHR5cGU7CiAgICAgIHRoaXMucHJlZml4U3VmZml4Lm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBhZGRQcmVmaXhTdWZmaXg6IGZ1bmN0aW9uIGFkZFByZWZpeFN1ZmZpeCgpIHsKICAgICAgdmFyIHByZWZpeCA9IHRoaXMucHJlZml4U3VmZml4LnByZWZpeDsKICAgICAgdmFyIHN1ZmZpeCA9IHRoaXMucHJlZml4U3VmZml4LnN1ZmZpeDsKCiAgICAgIHN3aXRjaCAocGFyc2VJbnQodGhpcy5wcmVmaXhTdWZmaXgudHlwZSkpIHsKICAgICAgICAvLyBHcm91cAogICAgICAgIGNhc2UgMToKICAgICAgICAgIGlmIChwYXJzZUludCh0aGlzLnByZWZpeFN1ZmZpeC5zZWxlY3RlZE9ubHkpID09PSAxKSB7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cHMuaW5jbHVkZXModGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uaWQpKSB7CiAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5ncm91cF9uYW1lID0gcHJlZml4ICsgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uZ3JvdXBfbmFtZSArIHN1ZmZpeDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuZmlsdGVyZWRHcm91cHMubWFwKGZ1bmN0aW9uIChncm91cCkgewogICAgICAgICAgICAgIGdyb3VwLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICBncm91cC5ncm91cF9uYW1lID0gcHJlZml4ICsgZ3JvdXAuZ3JvdXBfbmFtZSArIHN1ZmZpeDsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgYnJlYWs7CiAgICAgICAgLy8gU3RyZWFtCgogICAgICAgIGNhc2UgMjoKICAgICAgICAgIGlmIChwYXJzZUludCh0aGlzLnByZWZpeFN1ZmZpeC5zZWxlY3RlZE9ubHkpID09PSAxKSB7CiAgICAgICAgICAgIGZvciAodmFyIF9pMiA9IDA7IF9pMiA8IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7IF9pMisrKSB7CiAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlU3RyZWFtcy5pbmNsdWRlcyh0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbX2kyXS5pZCkpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMSkgewogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbX2kyXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tfaTJdLnN0cmVhbV90dmdfbmFtZSA9IHByZWZpeCArIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tfaTJdLnN0cmVhbV90dmdfbmFtZSArIHN1ZmZpeDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDIpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW19pMl0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbX2kyXS5tb3ZpZV9uYW1lID0gcHJlZml4ICsgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW19pMl0ubW92aWVfbmFtZSArIHN1ZmZpeDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDMpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW19pMl0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbX2kyXS5zZXJpZV9uYW1lID0gcHJlZml4ICsgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW19pMl0uc2VyaWVfbmFtZSArIHN1ZmZpeDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMSkgewogICAgICAgICAgICAgIHRoaXMuZmlsdGVyZWRTdHJlYW1zLm1hcChmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfbmFtZSA9IHByZWZpeCArIHN0cmVhbS5zdHJlYW1fdHZnX25hbWUgKyBzdWZmaXg7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMikgewogICAgICAgICAgICAgIHRoaXMuZmlsdGVyZWRTdHJlYW1zLm1hcChmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgc3RyZWFtLm1vdmllX25hbWUgPSBwcmVmaXggKyBzdHJlYW0ubW92aWVfbmFtZSArIHN1ZmZpeDsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAzKSB7CiAgICAgICAgICAgICAgdGhpcy5maWx0ZXJlZFN0cmVhbXMubWFwKGZ1bmN0aW9uIChzdHJlYW0pIHsKICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICBzdHJlYW0uc2VyaWVfbmFtZSA9IHByZWZpeCArIHN0cmVhbS5zZXJpZV9uYW1lICsgc3VmZml4OwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgYnJlYWs7CiAgICAgIH0KCiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICAgIHRoaXMucHJlZml4U3VmZml4Lm1vZGFsID0gZmFsc2U7CiAgICB9LAogICAgY29udmVydENhc2VNb2RhbDogZnVuY3Rpb24gY29udmVydENhc2VNb2RhbChzaG93LCB0eXBlKSB7CiAgICAgIHRoaXMuY29udmVydENhc2UudHlwZSA9IHR5cGU7CiAgICAgIHRoaXMuY29udmVydENhc2UubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGNoYW5nZUNhc2U6IGZ1bmN0aW9uIGNoYW5nZUNhc2UoKSB7CiAgICAgIHZhciBfdGhpczExID0gdGhpczsKCiAgICAgIHZhciBtZXRob2QgPSB0aGlzLmNvbnZlcnRDYXNlLm1ldGhvZDsKICAgICAgdmFyIGdyb3VwczsKICAgICAgdmFyIHN0cmVhbXM7CgogICAgICBpZiAocGFyc2VJbnQodGhpcy5jb252ZXJ0Q2FzZS5zZWxlY3RlZE9ubHkpID09PSAxKSB7CiAgICAgICAgZ3JvdXBzID0gdGhpcy5maWx0ZXJlZEdyb3Vwcy5maWx0ZXIoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgICByZXR1cm4gX3RoaXMxMS5hY3RpdmVHcm91cHMuaW5jbHVkZXMoZ3JvdXAuaWQpOwogICAgICAgIH0pOwogICAgICAgIHN0cmVhbXMgPSB0aGlzLmZpbHRlcmVkU3RyZWFtcy5maWx0ZXIoZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgICAgcmV0dXJuIF90aGlzMTEuYWN0aXZlU3RyZWFtcy5pbmNsdWRlcyhzdHJlYW0uaWQpOwogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIGdyb3VwcyA9IHRoaXMuZmlsdGVyZWRHcm91cHM7CiAgICAgICAgc3RyZWFtcyA9IHRoaXMuZmlsdGVyZWRTdHJlYW1zOwogICAgICB9CgogICAgICBzd2l0Y2ggKHBhcnNlSW50KHRoaXMuY29udmVydENhc2UudHlwZSkpIHsKICAgICAgICAvLyBDYXRlZ29yaWVzCiAgICAgICAgY2FzZSAxOgogICAgICAgICAgZ3JvdXBzLm1hcChmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICAgICAgc3dpdGNoIChwYXJzZUludChtZXRob2QpKSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgZ3JvdXAubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgZ3JvdXAuZ3JvdXBfbmFtZSA9IGdyb3VwLmdyb3VwX25hbWUudGl0bGVDYXNlKCk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgZ3JvdXAubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgZ3JvdXAuZ3JvdXBfbmFtZSA9IGdyb3VwLmdyb3VwX25hbWUudG9VcHBlckNhc2UoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICBncm91cC5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICBncm91cC5ncm91cF9uYW1lID0gZ3JvdXAuZ3JvdXBfbmFtZS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgLy8gU3RyZWFtcwoKICAgICAgICBjYXNlIDI6CiAgICAgICAgICBzdHJlYW1zLm1hcChmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAgICAgICAgIHN3aXRjaCAocGFyc2VJbnQobWV0aG9kKSkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGlmIChfdGhpczExLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMSkgewogICAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lID0gc3RyZWFtLnN0cmVhbV90dmdfbmFtZS50aXRsZUNhc2UoKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoX3RoaXMxMS5hY3RpdmVHcm91cFR5cGUgPT09IDIpIHsKICAgICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgc3RyZWFtLm1vdmllX25hbWUgPSBzdHJlYW0ubW92aWVfbmFtZS50aXRsZUNhc2UoKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoX3RoaXMxMS5hY3RpdmVHcm91cFR5cGUgPT09IDMpIHsKICAgICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgc3RyZWFtLnNlcmllX25hbWUgPSBzdHJlYW0uc2VyaWVfbmFtZS50aXRsZUNhc2UoKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgaWYgKF90aGlzMTEuYWN0aXZlR3JvdXBUeXBlID09PSAxKSB7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX25hbWUgPSBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lLnRvVXBwZXJDYXNlKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKF90aGlzMTEuYWN0aXZlR3JvdXBUeXBlID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5tb3ZpZV9uYW1lID0gc3RyZWFtLm1vdmllX25hbWUudG9VcHBlckNhc2UoKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoX3RoaXMxMS5hY3RpdmVHcm91cFR5cGUgPT09IDMpIHsKICAgICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgc3RyZWFtLnNlcmllX25hbWUgPSBzdHJlYW0uc2VyaWVfbmFtZS50b1VwcGVyQ2FzZSgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICBpZiAoX3RoaXMxMS5hY3RpdmVHcm91cFR5cGUgPT09IDEpIHsKICAgICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfbmFtZSA9IHN0cmVhbS5zdHJlYW1fdHZnX25hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoX3RoaXMxMS5hY3RpdmVHcm91cFR5cGUgPT09IDIpIHsKICAgICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgc3RyZWFtLm1vdmllX25hbWUgPSBzdHJlYW0ubW92aWVfbmFtZS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChfdGhpczExLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMykgewogICAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICBzdHJlYW0uc2VyaWVfbmFtZSA9IHN0cmVhbS5zZXJpZV9uYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KCiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICAgIHRoaXMuY29udmVydENhc2UubW9kYWwgPSBmYWxzZTsKICAgIH0sCiAgICBlZGl0R3JvdXBNb2RhbDogZnVuY3Rpb24gZWRpdEdyb3VwTW9kYWwoc2hvdykgewogICAgICB2YXIgX3RoaXMxMiA9IHRoaXM7CgogICAgICB2YXIgaW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgcmV0dXJuIGdyb3VwLmlkID09PSBfdGhpczEyLmFjdGl2ZUdyb3Vwc1swXTsKICAgICAgfSk7CiAgICAgIHZhciBncm91cCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2luZGV4XTsKCiAgICAgIGlmIChncm91cCkgewogICAgICAgIHRoaXMuZ3JvdXBFZGl0b3IuaWQgPSB0aGlzLmFjdGl2ZUdyb3Vwc1swXTsKICAgICAgICB0aGlzLmdyb3VwRWRpdG9yLmdyb3VwX3R5cGUgPSBncm91cC5ncm91cF90eXBlOwogICAgICAgIHRoaXMuZ3JvdXBFZGl0b3IuZ3JvdXBfbmFtZSA9IGdyb3VwLmdyb3VwX25hbWU7CiAgICAgICAgdGhpcy5ncm91cEVkaXRvci5ncm91cF9pc19oaWRkZW4gPSBncm91cC5ncm91cF9pc19oaWRkZW47CiAgICAgICAgdGhpcy5ncm91cEVkaXRvci5ncm91cF9wYXJlbnRfY29kZSA9IGdyb3VwLmdyb3VwX3BhcmVudF9jb2RlOwogICAgICAgIHRoaXMuZ3JvdXBFZGl0b3IubW9kYWwgPSBzaG93OwogICAgICB9CiAgICB9LAogICAgZWRpdFN0cmVhbU1vZGFsOiBmdW5jdGlvbiBlZGl0U3RyZWFtTW9kYWwoc2hvdykgewogICAgICB2YXIgX3RoaXMxMyA9IHRoaXM7CgogICAgICB2YXIgaW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMuZmluZEluZGV4KGZ1bmN0aW9uIChzdHJlYW0pIHsKICAgICAgICByZXR1cm4gc3RyZWFtLmlkID09PSBfdGhpczEzLmFjdGl2ZVN0cmVhbXNbMF07CiAgICAgIH0pOwogICAgICB2YXIgc3RyZWFtID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XTsKCiAgICAgIGlmIChzdHJlYW0pIHsKICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5pZCA9IHRoaXMuYWN0aXZlU3RyZWFtc1swXTsKICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1fdHZnX25hbWUgPSBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lOwogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV90dmdfaWQgPSBzdHJlYW0uc3RyZWFtX3R2Z19pZDsKICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1fdHZnX2xvZ28gPSBzdHJlYW0uc3RyZWFtX3R2Z19sb2dvOwogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV90dmdfY2hubyA9IHN0cmVhbS5zdHJlYW1fdHZnX2Nobm87CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX3R2Z19zaGlmdCA9IHN0cmVhbS5zdHJlYW1fdHZnX3NoaWZ0OwogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV9wYXJlbnRfY29kZSA9IHN0cmVhbS5zdHJlYW1fcGFyZW50X2NvZGU7CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX2F1ZGlvX3RyYWNrID0gc3RyZWFtLnN0cmVhbV9hdWRpb190cmFjazsKICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1fYXNwZWN0X3JhdGlvID0gc3RyZWFtLnN0cmVhbV9hc3BlY3RfcmF0aW87CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX3JhZGlvID0gc3RyZWFtLnN0cmVhbV9yYWRpbzsKICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1faXNfaGlkZGVuID0gc3RyZWFtLnN0cmVhbV9pc19oaWRkZW47CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc291cmNlX3N0cmVhbV91cmwgPSBzdHJlYW0uc291cmNlX3N0cmVhbV91cmw7CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX2lzX2N1c3RvbSA9IHN0cmVhbS5zdHJlYW1faXNfY3VzdG9tOwoKICAgICAgICBpZiAoc3RyZWFtLm1vdmllX25hbWUgIT09IHVuZGVmaW5lZCAmJiBzdHJlYW0ubW92aWVfeWVhciAhPT0gdW5kZWZpbmVkICYmIHN0cmVhbS50bWRiX2lkICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLm1vdmllX25hbWUgPSBzdHJlYW0ubW92aWVfbmFtZTsKICAgICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLm1vdmllX3llYXIgPSBzdHJlYW0ubW92aWVfeWVhcjsKICAgICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnRtZGJfaWQgPSBzdHJlYW0udG1kYl9pZDsKICAgICAgICB9CgogICAgICAgIGlmIChzdHJlYW0uc2VyaWVfbmFtZSAhPT0gdW5kZWZpbmVkICYmIHN0cmVhbS5zZXJpZV9zZWFzb24gIT09IHVuZGVmaW5lZCAmJiBzdHJlYW0uc2VyaWVfZXBpc29kZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zZXJpZV9uYW1lID0gc3RyZWFtLnNlcmllX25hbWU7CiAgICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zZXJpZV9zZWFzb24gPSBzdHJlYW0uc2VyaWVfc2Vhc29uOwogICAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc2VyaWVfZXBpc29kZSA9IHN0cmVhbS5zZXJpZV9lcGlzb2RlOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3IubW9kYWwgPSBzaG93OwogICAgICB9CiAgICB9LAogICAgZWRpdEdyb3VwOiBmdW5jdGlvbiBlZGl0R3JvdXAoKSB7CiAgICAgIHZhciBfdGhpczE0ID0gdGhpczsKCiAgICAgIHZhciBpbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleChmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICByZXR1cm4gZ3JvdXAuaWQgPT09IF90aGlzMTQuZ3JvdXBFZGl0b3IuaWQ7CiAgICAgIH0pOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpbmRleF0uZ3JvdXBfdHlwZSA9IHRoaXMuZ3JvdXBFZGl0b3IuZ3JvdXBfdHlwZTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaW5kZXhdLmdyb3VwX25hbWUgPSB0aGlzLmdyb3VwRWRpdG9yLmdyb3VwX25hbWU7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2luZGV4XS5ncm91cF9pc19oaWRkZW4gPSB0aGlzLmdyb3VwRWRpdG9yLmdyb3VwX2lzX2hpZGRlbjsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaW5kZXhdLmdyb3VwX3BhcmVudF9jb2RlID0gdGhpcy5ncm91cEVkaXRvci5ncm91cF9wYXJlbnRfY29kZTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaW5kZXhdLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgICAgdGhpcy5ncm91cEVkaXRvci5tb2RhbCA9IGZhbHNlOwogICAgfSwKICAgIGVkaXRTdHJlYW06IGZ1bmN0aW9uIGVkaXRTdHJlYW0oKSB7CiAgICAgIHZhciBfdGhpczE1ID0gdGhpczsKCiAgICAgIHZhciBpbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5maW5kSW5kZXgoZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgIHJldHVybiBzdHJlYW0uaWQgPT09IF90aGlzMTUuYWN0aXZlU3RyZWFtc1swXTsKICAgICAgfSk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc3RyZWFtX3R2Z19uYW1lID0gdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX3R2Z19uYW1lOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnN0cmVhbV90dmdfaWQgPSB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1fdHZnX2lkOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnN0cmVhbV90dmdfbG9nbyA9IHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV90dmdfbG9nbzsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zdHJlYW1fdHZnX2Nobm8gPSB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1fdHZnX2Nobm87CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc3RyZWFtX3R2Z19zaGlmdCA9IHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV90dmdfc2hpZnQ7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc3RyZWFtX3BhcmVudF9jb2RlID0gdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX3BhcmVudF9jb2RlOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnN0cmVhbV9hdWRpb190cmFjayA9IHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV9hdWRpb190cmFjazsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zdHJlYW1fYXNwZWN0X3JhdGlvID0gdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX2FzcGVjdF9yYXRpbzsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zdHJlYW1faXNfaGlkZGVuID0gdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX2lzX2hpZGRlbjsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zdHJlYW1fcmFkaW8gPSB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1fcmFkaW87CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc291cmNlX3N0cmVhbV91cmwgPSB0aGlzLnN0cmVhbUVkaXRvci5zb3VyY2Vfc3RyZWFtX3VybDsKCiAgICAgIGlmICh0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLm1vdmllX25hbWUgIT09IHVuZGVmaW5lZCAmJiB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLm1vdmllX3llYXIgIT09IHVuZGVmaW5lZCAmJiB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnRtZGJfaWQgIT09IHVuZGVmaW5lZCkgewogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0ubW92aWVfbmFtZSA9IHRoaXMuc3RyZWFtRWRpdG9yLm1vdmllX25hbWU7CiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5tb3ZpZV95ZWFyID0gdGhpcy5zdHJlYW1FZGl0b3IubW92aWVfeWVhcjsKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnRtZGJfaWQgPSB0aGlzLnN0cmVhbUVkaXRvci50bWRiX2lkOwogICAgICB9CgogICAgICBpZiAodGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zZXJpZV9uYW1lICE9PSB1bmRlZmluZWQgJiYgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zZXJpZV9zZWFzb24gIT09IHVuZGVmaW5lZCAmJiB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnNlcmllX2VwaXNvZGUgIT09IHVuZGVmaW5lZCkgewogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc2VyaWVfbmFtZSA9IHRoaXMuc3RyZWFtRWRpdG9yLnNlcmllX25hbWU7CiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zZXJpZV9zZWFzb24gPSB0aGlzLnN0cmVhbUVkaXRvci5zZXJpZV9zZWFzb247CiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zZXJpZV9lcGlzb2RlID0gdGhpcy5zdHJlYW1FZGl0b3Iuc2VyaWVfZXBpc29kZTsKICAgICAgfQoKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5tb2RpZmllZCA9IHRydWU7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLm1vZGFsID0gZmFsc2U7CiAgICB9LAogICAgc29ydEdyb3VwQWxwaGFVcDogZnVuY3Rpb24gc29ydEdyb3VwQWxwaGFVcCgpIHsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgcmV0dXJuIGIuZ3JvdXBfbmFtZSA+IGEuZ3JvdXBfbmFtZSA/IDEgOiBhLmdyb3VwX25hbWUgPiBiLmdyb3VwX25hbWUgPyAtMSA6IDA7CiAgICAgIH0pOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5tYXAoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgcmV0dXJuIGdyb3VwLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgfSk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICB9LAogICAgc29ydEdyb3VwQWxwaGFEb3duOiBmdW5jdGlvbiBzb3J0R3JvdXBBbHBoYURvd24oKSB7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHJldHVybiBhLmdyb3VwX25hbWUgPiBiLmdyb3VwX25hbWUgPyAxIDogYi5ncm91cF9uYW1lID4gYS5ncm91cF9uYW1lID8gLTEgOiAwOwogICAgICB9KTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMubWFwKGZ1bmN0aW9uIChncm91cCkgewogICAgICAgIHJldHVybiBncm91cC5tb2RpZmllZCA9IHRydWU7CiAgICAgIH0pOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgfSwKICAgIHNvcnRHcm91cFR5cGVVcDogZnVuY3Rpb24gc29ydEdyb3VwVHlwZVVwKCkgewogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3VwcyA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICByZXR1cm4gYi5ncm91cF90eXBlID4gYS5ncm91cF90eXBlID8gMSA6IGEuZ3JvdXBfdHlwZSA+IGIuZ3JvdXBfdHlwZSA/IC0xIDogMDsKICAgICAgfSk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLm1hcChmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICByZXR1cm4gZ3JvdXAubW9kaWZpZWQgPSB0cnVlOwogICAgICB9KTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgIH0sCiAgICBzb3J0R3JvdXBUeXBlRG93bjogZnVuY3Rpb24gc29ydEdyb3VwVHlwZURvd24oKSB7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHJldHVybiBhLmdyb3VwX3R5cGUgPiBiLmdyb3VwX3R5cGUgPyAxIDogYi5ncm91cF90eXBlID4gYS5ncm91cF90eXBlID8gLTEgOiAwOwogICAgICB9KTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMubWFwKGZ1bmN0aW9uIChncm91cCkgewogICAgICAgIHJldHVybiBncm91cC5tb2RpZmllZCA9IHRydWU7CiAgICAgIH0pOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgfSwKICAgIHNvcnRTdHJlYW1BbHBoYVVwOiBmdW5jdGlvbiBzb3J0U3RyZWFtQWxwaGFVcCgpIHsKICAgICAgdmFyIF90aGlzMTYgPSB0aGlzOwoKICAgICAgLy9FUk5TVCBISUVSCiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcyA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgc3dpdGNoIChfdGhpczE2LmFjdGl2ZUdyb3VwVHlwZSkgewogICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICByZXR1cm4gYi5zdHJlYW1fdHZnX25hbWUgPiBhLnN0cmVhbV90dmdfbmFtZSA/IDEgOiBhLnN0cmVhbV90dmdfbmFtZSA+IGIuc3RyZWFtX3R2Z19uYW1lID8gLTEgOiAwOwoKICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgcmV0dXJuIGIubW92aWVfbmFtZSA+IGEubW92aWVfbmFtZSA/IDEgOiBhLm1vdmllX25hbWUgPiBiLm1vdmllX25hbWUgPyAtMSA6IDA7CgogICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICByZXR1cm4gYi5zZXJpZV9uYW1lID4gYS5zZXJpZV9uYW1lID8gMSA6IGEuc2VyaWVfbmFtZSA+IGIuc2VyaWVfbmFtZSA/IC0xIDogMDsKICAgICAgICB9CiAgICAgIH0pOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubWFwKGZ1bmN0aW9uIChzdHJlYW0pIHsKICAgICAgICByZXR1cm4gc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgfSk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICB9LAogICAgc29ydFN0cmVhbUFscGhhRG93bjogZnVuY3Rpb24gc29ydFN0cmVhbUFscGhhRG93bigpIHsKICAgICAgdmFyIF90aGlzMTcgPSB0aGlzOwoKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICBzd2l0Y2ggKF90aGlzMTcuYWN0aXZlR3JvdXBUeXBlKSB7CiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIHJldHVybiBhLnN0cmVhbV90dmdfbmFtZSA+IGIuc3RyZWFtX3R2Z19uYW1lID8gMSA6IGIuc3RyZWFtX3R2Z19uYW1lID4gYS5zdHJlYW1fdHZnX25hbWUgPyAtMSA6IDA7CgogICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICByZXR1cm4gYS5tb3ZpZV9uYW1lID4gYi5tb3ZpZV9uYW1lID8gMSA6IGIubW92aWVfbmFtZSA+IGEubW92aWVfbmFtZSA/IC0xIDogMDsKCiAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgIHJldHVybiBhLnNlcmllX25hbWUgPiBiLnNlcmllX25hbWUgPyAxIDogYi5zZXJpZV9uYW1lID4gYS5zZXJpZV9uYW1lID8gLTEgOiAwOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5tYXAoZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgIHJldHVybiBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICB9KTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgIH0sCiAgICBzb3J0U3RyZWFtSGlkZGVuVXA6IGZ1bmN0aW9uIHNvcnRTdHJlYW1IaWRkZW5VcCgpIHsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICByZXR1cm4gYi5zdHJlYW1faXNfaGlkZGVuID4gYS5zdHJlYW1faXNfaGlkZGVuID8gMSA6IGEuc3RyZWFtX2lzX2hpZGRlbiA+IGIuc3RyZWFtX2lzX2hpZGRlbiA/IC0xIDogMDsKICAgICAgfSk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5tYXAoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgcmV0dXJuIGdyb3VwLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgfSk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICB9LAogICAgc29ydFN0cmVhbUhpZGRlbkRvd246IGZ1bmN0aW9uIHNvcnRTdHJlYW1IaWRkZW5Eb3duKCkgewogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMuc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHJldHVybiBhLnN0cmVhbV9pc19oaWRkZW4gPiBiLnN0cmVhbV9pc19oaWRkZW4gPyAxIDogYi5zdHJlYW1faXNfaGlkZGVuID4gYS5zdHJlYW1faXNfaGlkZGVuID8gLTEgOiAwOwogICAgICB9KTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLm1hcChmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICByZXR1cm4gZ3JvdXAubW9kaWZpZWQgPSB0cnVlOwogICAgICB9KTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgIH0sCiAgICBhZGRHcm91cDogZnVuY3Rpb24gYWRkR3JvdXAoKSB7CiAgICAgIHZhciBfdGhpczE4ID0gdGhpczsKCiAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UucG9zdCgiZWRpdG9yL2FkZC1ncm91cCIsIHsKICAgICAgICBwbGF5bGlzdF9pZDogdGhpcy5wbGF5bGlzdEVkaXRvci5pZAogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICBfdGhpczE4LmlzTG9hZGluZyA9IGZhbHNlOwoKICAgICAgICBpZiAocmVzLnN0YXR1cyA9PT0gdHJ1ZSAmJiByZXMuZGF0YSkgewogICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgICAgICAgIF90aGlzMTgucGxheWxpc3RFZGl0b3IuZ3JvdXBzLnB1c2gocmVzLmRhdGEpOwoKICAgICAgICAgICAgX3RoaXMxOC5hY3RpdmVHcm91cCA9IF90aGlzMTgucGxheWxpc3RFZGl0b3IuZ3JvdXBzW190aGlzMTgucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmxlbmd0aCAtIDFdLmlkOwogICAgICAgICAgICBfdGhpczE4LmFjdGl2ZUdyb3VwcyA9IFtfdGhpczE4LnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tfdGhpczE4LnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5sZW5ndGggLSAxXS5pZF07CiAgICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgICBfdGhpczE4LmVkaXRHcm91cE1vZGFsKHRydWUpOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMxOC5pc0xvYWRpbmcgPSBmYWxzZTsKCiAgICAgICAgX3RoaXMxOC4kbm90aWZ5KCJlcnJvciIsIF90aGlzMTguJHQoInByb2ZpbGUuZmFpbGVkIiksIF90aGlzMTguJHQoImVkaXRvci5hZGQtZ3JvdXAtZXJyb3IiKSwgImxhLXVzZXItc2hpZWxkIiwgewogICAgICAgICAgZHVyYXRpb246IDUwMDAsCiAgICAgICAgICBwZXJtYW5lbnQ6IGZhbHNlCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSwKICAgIGFkZFN0cmVhbTogZnVuY3Rpb24gYWRkU3RyZWFtKCkgewogICAgICB2YXIgX3RoaXMxOSA9IHRoaXM7CgogICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGh0dHBTZXJ2aWNlLnBvc3QoImVkaXRvci9hZGQtc3RyZWFtIiwgewogICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgIGdyb3VwX2lkOiB0aGlzLmdldEdyb3VwV2l0aElkKHRoaXMuYWN0aXZlR3JvdXApLmlkLAogICAgICAgIHN0cmVhbV90eXBlOiB0aGlzLmdldEdyb3VwV2l0aElkKHRoaXMuYWN0aXZlR3JvdXApLmdyb3VwX3R5cGUKICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgX3RoaXMxOS5pc0xvYWRpbmcgPSBmYWxzZTsKCiAgICAgICAgaWYgKHJlcy5zdGF0dXMgPT09IHRydWUgJiYgcmVzLmRhdGEpIHsKICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkgewogICAgICAgICAgICBfdGhpczE5LnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMudW5zaGlmdChyZXMuZGF0YSk7CgogICAgICAgICAgICBfdGhpczE5LmFjdGl2ZVN0cmVhbSA9IF90aGlzMTkucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tfdGhpczE5LnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoIC0gMV0uaWQ7CiAgICAgICAgICAgIF90aGlzMTkuYWN0aXZlU3RyZWFtcyA9IFtfdGhpczE5LnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbX3RoaXMxOS5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aCAtIDFdLmlkXTsKICAgICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIF90aGlzMTkuZWRpdFN0cmVhbU1vZGFsKHRydWUpOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMxOS5pc0xvYWRpbmcgPSBmYWxzZTsKCiAgICAgICAgX3RoaXMxOS4kbm90aWZ5KCJlcnJvciIsIF90aGlzMTkuJHQoInByb2ZpbGUuZmFpbGVkIiksIF90aGlzMTkuJHQoImVkaXRvci5hZGQtc3RyZWFtLWVycm9yIiksICJsYS11c2VyLXNoaWVsZCIsIHsKICAgICAgICAgIGR1cmF0aW9uOiA1MDAwLAogICAgICAgICAgcGVybWFuZW50OiBmYWxzZQogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0sCiAgICBsb2FkU3RyZWFtczogZnVuY3Rpb24gbG9hZFN0cmVhbXMoKSB7CiAgICAgIHZhciBfdGhpczIwID0gdGhpczsKCiAgICAgIHRoaXMuYWN0aXZlU3RyZWFtID0gLTE7CiAgICAgIHRoaXMuYWN0aXZlU3RyZWFtcyA9IFtdOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMgPSBbXTsKICAgICAgdmFyIGluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KGZ1bmN0aW9uIChncm91cCkgewogICAgICAgIHJldHVybiBncm91cC5pZCA9PT0gX3RoaXMyMC5hY3RpdmVHcm91cDsKICAgICAgfSk7CiAgICAgIHZhciBncm91cCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2luZGV4XTsKICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZS5nZXQoImVkaXRvci9zdHJlYW1zLyIuY29uY2F0KHRoaXMucGxheWxpc3RFZGl0b3IuaWQsICIvIikuY29uY2F0KGdyb3VwLmlkLCAiLyIpLmNvbmNhdChncm91cC5ncm91cF90eXBlKSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgZG9jdW1lbnQuYm9keS5zY3JvbGxUb3AgPSAwOwogICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3AgPSAwOwoKICAgICAgICBpZiAocmVzLnN0YXR1cyA9PT0gdHJ1ZSkgewogICAgICAgICAgdmFyIHN0cmVhbXMgPSByZXMuZGF0YS5tYXAoZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgICAgICB2YXIgc3RyID0gT2JqZWN0LmFzc2lnbih7fSwgc3RyZWFtKTsKICAgICAgICAgICAgc3RyLnNvdXJjZV9zdHJlYW1fdHZnX25hbWUgPSBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lOwogICAgICAgICAgICBzdHIuc291cmNlX3N0cmVhbV90dmdfaWQgPSBzdHJlYW0uc3RyZWFtX3R2Z19pZDsKICAgICAgICAgICAgc3RyLnNvdXJjZV9zdHJlYW1fdHZnX2xvZ28gPSBzdHJlYW0uc3RyZWFtX3R2Z19sb2dvOwogICAgICAgICAgICBzdHIuc291cmNlX3N0cmVhbV90dmdfY2hubyA9IHN0cmVhbS5zdHJlYW1fdHZnX2Nobm87CiAgICAgICAgICAgIHN0ci5zb3VyY2Vfc3RyZWFtX3R2Z19zaGlmdCA9IHN0cmVhbS5zdHJlYW1fdHZnX3NoaWZ0OwogICAgICAgICAgICBzdHIuc291cmNlX3N0cmVhbV9wYXJlbnRfY29kZSA9IHN0cmVhbS5zdHJlYW1fcGFyZW50X2NvZGU7CiAgICAgICAgICAgIHN0ci5zb3VyY2Vfc3RyZWFtX2F1ZGlvX3RyYWNrID0gc3RyZWFtLnN0cmVhbV9hdWRpb190cmFjazsKICAgICAgICAgICAgc3RyLnNvdXJjZV9zdHJlYW1fYXNwZWN0X3JhdGlvID0gc3RyZWFtLnN0cmVhbV9hc3BlY3RfcmF0aW87CiAgICAgICAgICAgIHN0ci5zb3VyY2Vfc3RyZWFtX3JhZGlvID0gc3RyZWFtLnN0cmVhbV9yYWRpbzsKICAgICAgICAgICAgc3RyLnNvdXJjZV9zdHJlYW1fb3JkZXIgPSBzdHJlYW0uc3RyZWFtX29yZGVyOwogICAgICAgICAgICBzdHIuc291cmNlX3N0cmVhbV9pc19oaWRkZW4gPSBzdHJlYW0uc3RyZWFtX2lzX2hpZGRlbjsKICAgICAgICAgICAgc3RyLm1vZGlmaWVkID0gZmFsc2U7CiAgICAgICAgICAgIHN0ci5zdHJlYW1faXNfcmVtb3ZlZCA9IDA7CgogICAgICAgICAgICBpZiAoZ3JvdXAuZ3JvdXBfdHlwZSA9PSAyKSB7CiAgICAgICAgICAgICAgaWYgKHN0ci5tb3ZpZV9uYW1lID09ICIiKSB7CiAgICAgICAgICAgICAgICBzdHIubW92aWVfbmFtZSA9IHN0ci5zdHJlYW1fdHZnX25hbWU7CiAgICAgICAgICAgICAgICBzdHIuc291cmNlX21vdmllX25hbWUgPSBzdHIuc3RyZWFtX3R2Z19uYW1lOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBzdHIuc291cmNlX21vdmllX25hbWUgPSBzdHJlYW0ubW92aWVfbmFtZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHN0ci5zb3VyY2VfbW92aWVfeWVhciA9IHN0cmVhbS5tb3ZpZV95ZWFyOwogICAgICAgICAgICAgIHN0ci5zb3VyY2VfdG1kYl9pZCA9IHN0cmVhbS50bWRiX2lkOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZ3JvdXAuZ3JvdXBfdHlwZSA9PSAzKSB7CiAgICAgICAgICAgICAgaWYgKHN0ci5zZXJpZV9uYW1lID09ICIiKSB7CiAgICAgICAgICAgICAgICBzdHIuc2VyaWVfbmFtZSA9IHN0ci5zdHJlYW1fdHZnX25hbWU7CiAgICAgICAgICAgICAgICBzdHIuc291cmNlX3NlcmllX25hbWUgPSBzdHIuc3RyZWFtX3R2Z19uYW1lOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBzdHIuc291cmNlX3NlcmllX25hbWUgPSBzdHJlYW0uc2VyaWVfbmFtZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHN0ci5zb3VyY2Vfc2VyaWVfc2Vhc29uID0gc3RyZWFtLnNlcmllX3NlYXNvbjsKICAgICAgICAgICAgICBzdHIuc291cmNlX3NlcmllX2VwaXNvZGUgPSBzdHJlYW0uc2VyaWVfZXBpc29kZTsKICAgICAgICAgICAgICBzdHIuc291cmNlX3RtZGJfaWQgPSBzdHJlYW0udG1kYl9pZDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHN0cjsKICAgICAgICAgIH0pOwogICAgICAgICAgc3RyZWFtcy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICAgIHJldHVybiBhLnNvdXJjZV9zdHJlYW1fb3JkZXIgPiBiLnNvdXJjZV9zdHJlYW1fb3JkZXIgPyAxIDogYi5zb3VyY2Vfc3RyZWFtX29yZGVyID4gYS5zb3VyY2Vfc3RyZWFtX29yZGVyID8gLTEgOiAwOwogICAgICAgICAgfSk7CiAgICAgICAgICBfdGhpczIwLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMgPSBzdHJlYW1zOwogICAgICAgICAgX3RoaXMyMC5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgX3RoaXMyMC5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczIwLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9KTsKICAgIH0sCiAgICBtb3ZlVG9TZWxlY3RlZEdyb3VwOiBmdW5jdGlvbiBtb3ZlVG9TZWxlY3RlZEdyb3VwKCkgewogICAgICB2YXIgX3RoaXMyMSA9IHRoaXM7CgogICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIHZhciBzdHJlYW1zID0gdGhpcy5hY3RpdmVTdHJlYW1zLmpvaW4oKTsKICAgICAgdmFyIGluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KGZ1bmN0aW9uIChncm91cCkgewogICAgICAgIHJldHVybiBncm91cC5pZCA9PSBfdGhpczIxLmFjdGl2ZUdyb3VwOwogICAgICB9KTsKICAgICAgaHR0cFNlcnZpY2UucG9zdCgiZWRpdG9yL21vdmUtdG8tZ3JvdXAvIi5jb25jYXQodGhpcy5hY3RpdmVHcm91cFR5cGUpLCB7CiAgICAgICAgcGxheWxpc3RfaWQ6IHRoaXMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgc3RyZWFtczogc3RyZWFtcywKICAgICAgICBncm91cF9pZDogdGhpcy5hY3RpdmVHcm91cHNbMF0KICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgX3RoaXMyMS5pc0xvYWRpbmcgPSBmYWxzZTsKCiAgICAgICAgaWYgKHJlcy5zdGF0dXMgJiYgcmVzLmRhdGEpIHsKICAgICAgICAgIF90aGlzMjEubG9hZFBsYXlsaXN0KF90aGlzMjEucGxheWxpc3RFZGl0b3IuaWQsIGluZGV4KTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczIxLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9KTsKICAgIH0sCiAgICBzYXZlQ2hhbmdlc01vZGFsOiBmdW5jdGlvbiBzYXZlQ2hhbmdlc01vZGFsKHNob3cpIHsKICAgICAgdmFyIHNhdmUgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IGZhbHNlOwogICAgICB0aGlzLnNhdmVDaGFuZ2VzLm1vZGFsID0gc2hvdzsKCiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgdGhpcy5kb1NhdmUoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmxvYWRTdHJlYW1zKCk7CiAgICAgIH0KICAgIH0sCiAgICByYWRpb0Jyb3dzZXJNb2RhbDogZnVuY3Rpb24gcmFkaW9Ccm93c2VyTW9kYWwoc2hvdykgewogICAgICB2YXIgX3RoaXMyMiA9IHRoaXM7CgogICAgICB2YXIgc2F2ZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogZmFsc2U7CgogICAgICBpZiAoc2hvdykgewogICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLnNlYXJjaCA9ICIiOwogICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLnJlc3VsdHMgPSBbXTsKICAgICAgICB0aGlzLnJhZGlvQnJvd3Nlci5hY3RpdmUgPSBbXTsKICAgICAgfQoKICAgICAgaWYgKHNhdmUpIHsKICAgICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7CiAgICAgICAgdmFyIGdyb3VwSW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgICByZXR1cm4gZ3JvdXAuaWQgPT0gX3RoaXMyMi5hY3RpdmVHcm91cDsKICAgICAgICB9KTsKICAgICAgICB2YXIgb3JkZXIgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOwogICAgICAgIHZhciBzdHJlYW1zID0gdGhpcy5yYWRpb0Jyb3dzZXIuYWN0aXZlLm1hcChmdW5jdGlvbiAoaW5kZXgpIHsKICAgICAgICAgIHZhciByYWRpbyA9IF90aGlzMjIucmFkaW9Ccm93c2VyLnJlc3VsdHNbaW5kZXhdOwogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgc291cmNlX3N0cmVhbV91cmw6IHJhZGlvLnVybCwKICAgICAgICAgICAgc3RyZWFtX3R2Z19uYW1lOiByYWRpby5uYW1lLAogICAgICAgICAgICBzdHJlYW1fdHZnX2lkOiAiIiwKICAgICAgICAgICAgc3RyZWFtX3R2Z19sb2dvOiByYWRpby5mYXZpY29uLAogICAgICAgICAgICBzdHJlYW1fcmFkaW86IHRydWUsCiAgICAgICAgICAgIHN0cmVhbV9vcmRlcjogb3JkZXIrKwogICAgICAgICAgfTsKICAgICAgICB9KTsKICAgICAgICBodHRwU2VydmljZS5wb3N0KCJlZGl0b3IvYWRkLXN0cmVhbXMvIi5jb25jYXQodGhpcy5hY3RpdmVHcm91cFR5cGUpLCB7CiAgICAgICAgICBwbGF5bGlzdF9pZDogdGhpcy5wbGF5bGlzdEVkaXRvci5pZCwKICAgICAgICAgIGdyb3VwX2lkOiB0aGlzLmdldEdyb3VwV2l0aElkKHRoaXMuYWN0aXZlR3JvdXApLmlkLAogICAgICAgICAgc3RyZWFtczogc3RyZWFtcwogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgICAgX3RoaXMyMi5pc0xvYWRpbmcgPSBmYWxzZTsKCiAgICAgICAgICBpZiAocmVzLnN0YXR1cykgewogICAgICAgICAgICBfdGhpczIyLmxvYWRQbGF5bGlzdChfdGhpczIyLnBsYXlsaXN0RWRpdG9yLmlkLCBncm91cEluZGV4KTsKICAgICAgICAgIH0KICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBfdGhpczIyLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0pOwogICAgICB9CgogICAgICB0aGlzLnJhZGlvQnJvd3Nlci5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgZmluZFJhZGlvYnJvd3NlcjogZnVuY3Rpb24gZmluZFJhZGlvYnJvd3NlcihzZWFyY2gpIHsKICAgICAgdmFyIF90aGlzMjMgPSB0aGlzOwoKICAgICAgaWYgKHNlYXJjaC5sZW5ndGggPT09IDApIHsKICAgICAgICB0aGlzLnJhZGlvQnJvd3Nlci5yZXN1bHRzID0gW107CiAgICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuYWN0aXZlID0gW107CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgICBodHRwU2VydmljZS5wb3N0KCJlZGl0b3IvZmluZC1yYWRpb2Jyb3dzZXIiLCB7CiAgICAgICAgICBzZWFyY2g6IHNlYXJjaAogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgICAgX3RoaXMyMy5yYWRpb0Jyb3dzZXIuYWN0aXZlID0gW107CgogICAgICAgICAgaWYgKHJlcy5zdGF0dXMpIHsKICAgICAgICAgICAgX3RoaXMyMy5yYWRpb0Jyb3dzZXIucmVzdWx0cyA9IHJlcy5kYXRhOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgX3RoaXMyMy5yYWRpb0Jyb3dzZXIucmVzdWx0cyA9IFtdOwogICAgICAgICAgfQoKICAgICAgICAgIF90aGlzMjMucmFkaW9Ccm93c2VyLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIF90aGlzMjMucmFkaW9Ccm93c2VyLmFjdGl2ZSA9IFtdOwogICAgICAgICAgX3RoaXMyMy5yYWRpb0Jyb3dzZXIucmVzdWx0cyA9IFtdOwogICAgICAgICAgX3RoaXMyMy5yYWRpb0Jyb3dzZXIuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBzb3VuZGNsb3VkTW9kYWw6IGZ1bmN0aW9uIHNvdW5kY2xvdWRNb2RhbChzaG93KSB7CiAgICAgIHZhciBfdGhpczI0ID0gdGhpczsKCiAgICAgIHZhciBzYXZlID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiBmYWxzZTsKCiAgICAgIGlmIChzaG93KSB7CiAgICAgICAgdGhpcy5zb3VuZGNsb3VkLnVybCA9ICIiOwogICAgICAgIHRoaXMuc291bmRjbG91ZC50cmFjayA9IG51bGw7CiAgICAgIH0KCiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgaWYgKHRoaXMuc291bmRjbG91ZC50cmFjaykgewogICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgdmFyIGdyb3VwSW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgICAgIHJldHVybiBncm91cC5pZCA9PSBfdGhpczI0LmFjdGl2ZUdyb3VwOwogICAgICAgICAgfSk7CiAgICAgICAgICB2YXIgb3JkZXIgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOwogICAgICAgICAgdmFyIHN0cmVhbXMgPSBbewogICAgICAgICAgICBzb3VyY2Vfc3RyZWFtX3VybDogdGhpcy5zb3VuZGNsb3VkLnVybCwKICAgICAgICAgICAgc3RyZWFtX3R2Z19uYW1lOiB0aGlzLnNvdW5kY2xvdWQudHJhY2sudGl0bGUsCiAgICAgICAgICAgIHN0cmVhbV90dmdfaWQ6ICIiLAogICAgICAgICAgICBzdHJlYW1fdHZnX2xvZ286IHRoaXMuc291bmRjbG91ZC50cmFjay5hcnR3b3JrX3VybC5yZXBsYWNlKCJsYXJnZS5qcGciLCAidDUwMHg1MDAuanBnIiksCiAgICAgICAgICAgIHN0cmVhbV9yYWRpbzogdHJ1ZSwKICAgICAgICAgICAgc3RyZWFtX29yZGVyOiBvcmRlcisrCiAgICAgICAgICB9XTsKICAgICAgICAgIGh0dHBTZXJ2aWNlLnBvc3QoImVkaXRvci9hZGQtc3RyZWFtcy8iLmNvbmNhdCh0aGlzLmFjdGl2ZUdyb3VwVHlwZSksIHsKICAgICAgICAgICAgcGxheWxpc3RfaWQ6IHRoaXMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICAgIGdyb3VwX2lkOiB0aGlzLmdldEdyb3VwV2l0aElkKHRoaXMuYWN0aXZlR3JvdXApLmlkLAogICAgICAgICAgICBzdHJlYW1zOiBzdHJlYW1zCiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICAgICAgX3RoaXMyNC5pc0xvYWRpbmcgPSBmYWxzZTsKCiAgICAgICAgICAgIGlmIChyZXMuc3RhdHVzKSB7CiAgICAgICAgICAgICAgX3RoaXMyNC5sb2FkUGxheWxpc3QoX3RoaXMyNC5wbGF5bGlzdEVkaXRvci5pZCwgZ3JvdXBJbmRleCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgX3RoaXMyNC5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5zb3VuZGNsb3VkLm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBnZXRTb3VuZGNsb3VkVHJhY2s6IGZ1bmN0aW9uIGdldFNvdW5kY2xvdWRUcmFjayh1cmwsIGNsaWVudF9pZCkgewogICAgICB2YXIgX3RoaXMyNSA9IHRoaXM7CgogICAgICBpZiAodXJsLmxlbmd0aCA9PT0gMCB8fCAhL3NvdW5kY2xvdWRcLmNvbS8udGVzdCh1cmwpKSB7CiAgICAgICAgdGhpcy5zb3VuZGNsb3VkLnVybCA9ICIiOwogICAgICAgIHRoaXMuc291bmRjbG91ZC50cmFjayA9IG51bGw7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zb3VuZGNsb3VkLmlzTG9hZGluZyA9IHRydWU7CiAgICAgICAgaHR0cFNlcnZpY2UucG9zdCgiZWRpdG9yL3NvdW5kY2xvdWQtdHJhY2siLCB7CiAgICAgICAgICB1cmw6IHVybCwKICAgICAgICAgIGNsaWVudF9pZDogY2xpZW50X2lkCiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICBpZiAocmVzLnN0YXR1cyAmJiBPYmplY3Qua2V5cyhyZXMuZGF0YSkubGVuZ3RoKSB7CiAgICAgICAgICAgIF90aGlzMjUuc291bmRjbG91ZC50cmFjayA9IHJlcy5kYXRhOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgX3RoaXMyNS5zb3VuZGNsb3VkLnRyYWNrID0gbnVsbDsKICAgICAgICAgIH0KCiAgICAgICAgICBfdGhpczI1LnNvdW5kY2xvdWQuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkgewogICAgICAgICAgX3RoaXMyNS5zb3VuZGNsb3VkLnRyYWNrID0gbnVsbDsKICAgICAgICAgIF90aGlzMjUuc291bmRjbG91ZC5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIHlvdXR1YmVNb2RhbDogZnVuY3Rpb24geW91dHViZU1vZGFsKHNob3cpIHsKICAgICAgdmFyIF90aGlzMjYgPSB0aGlzOwoKICAgICAgdmFyIHNhdmUgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IGZhbHNlOwoKICAgICAgaWYgKHNob3cpIHsKICAgICAgICB0aGlzLnlvdXR1YmUudXJsID0gIiI7CiAgICAgICAgdGhpcy55b3V0dWJlLnZpZGVvID0gbnVsbDsKICAgICAgICB0aGlzLnlvdXR1YmUuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgaWYgKHRoaXMueW91dHViZS52aWRlbykgewogICAgICAgICAgdGhpcy55b3V0dWJlLmlzTG9hZGluZyA9IHRydWU7CiAgICAgICAgICB2YXIgZ3JvdXBJbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleChmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICAgICAgcmV0dXJuIGdyb3VwLmlkID09IF90aGlzMjYuYWN0aXZlR3JvdXA7CiAgICAgICAgICB9KTsKICAgICAgICAgIHZhciBvcmRlciA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7CiAgICAgICAgICB2YXIgc3RyZWFtcyA9IFt7CiAgICAgICAgICAgIHNvdXJjZV9zdHJlYW1fdXJsOiB0aGlzLnlvdXR1YmUudXJsLAogICAgICAgICAgICBzdHJlYW1fdHZnX25hbWU6IHRoaXMueW91dHViZS52aWRlby52aWRlb0RldGFpbHMudGl0bGUsCiAgICAgICAgICAgIHN0cmVhbV90dmdfaWQ6ICIiLAogICAgICAgICAgICBzdHJlYW1fdHZnX2xvZ286ICJodHRwOi8vaS55dGltZy5jb20vdmkvIi5jb25jYXQodGhpcy55b3V0dWJlLnZpZGVvSWQsICIvbWF4cmVzZGVmYXVsdC5qcGciKSwKICAgICAgICAgICAgc3RyZWFtX29yZGVyOiBvcmRlcisrCiAgICAgICAgICB9XTsKICAgICAgICAgIGh0dHBTZXJ2aWNlLnBvc3QoImVkaXRvci9hZGQtc3RyZWFtcy8iLmNvbmNhdCh0aGlzLmFjdGl2ZUdyb3VwVHlwZSksIHsKICAgICAgICAgICAgcGxheWxpc3RfaWQ6IHRoaXMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICAgIGdyb3VwX2lkOiB0aGlzLmdldEdyb3VwV2l0aElkKHRoaXMuYWN0aXZlR3JvdXApLmlkLAogICAgICAgICAgICBzdHJlYW1zOiBzdHJlYW1zCiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICAgICAgX3RoaXMyNi55b3V0dWJlLmlzTG9hZGluZyA9IGZhbHNlOwoKICAgICAgICAgICAgaWYgKHJlcy5zdGF0dXMpIHsKICAgICAgICAgICAgICBfdGhpczI2LmxvYWRQbGF5bGlzdChfdGhpczI2LnBsYXlsaXN0RWRpdG9yLmlkLCBncm91cEluZGV4KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkgewogICAgICAgICAgICBfdGhpczI2LnlvdXR1YmUuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMueW91dHViZS5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgZ2V0WW91dHViZVBhZ2U6IGZ1bmN0aW9uIGdldFlvdXR1YmVQYWdlKHZpZGVvSWQpIHsKICAgICAgdmFyIF90aGlzMjcgPSB0aGlzOwoKICAgICAgdGhpcy55b3V0dWJlLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGh0dHBTZXJ2aWNlLnBvc3QoImVkaXRvci95b3V0dWJlLXZpZGVvIiwgewogICAgICAgIHZpZGVvX2lkOiB2aWRlb0lkCiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgIGlmIChyZXMuc3RhdHVzICYmIE9iamVjdC5rZXlzKHJlcy5kYXRhKS5sZW5ndGgpIHsKICAgICAgICAgIF90aGlzMjcueW91dHViZS52aWRlbyA9IHJlcy5kYXRhOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBfdGhpczI3LnlvdXR1YmUudmlkZW8gPSBudWxsOwogICAgICAgIH0KCiAgICAgICAgX3RoaXMyNy55b3V0dWJlLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMyNy55b3V0dWJlLnZpZGVvID0gbnVsbDsKICAgICAgICBfdGhpczI3LnlvdXR1YmUuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0pOwogICAgfSwKICAgIHZpbWVvTW9kYWw6IGZ1bmN0aW9uIHZpbWVvTW9kYWwoc2hvdykgewogICAgICB2YXIgX3RoaXMyOCA9IHRoaXM7CgogICAgICB2YXIgc2F2ZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogZmFsc2U7CgogICAgICBpZiAoc2hvdykgewogICAgICAgIHRoaXMudmltZW8udXJsID0gIiI7CiAgICAgICAgdGhpcy52aW1lby52aWRlbyA9IG51bGw7CiAgICAgICAgdGhpcy52aW1lby5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfQoKICAgICAgaWYgKHNhdmUpIHsKICAgICAgICBpZiAodGhpcy52aW1lby52aWRlbykgewogICAgICAgICAgdGhpcy52aW1lby5pc0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgdmFyIGdyb3VwSW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgICAgIHJldHVybiBncm91cC5pZCA9PSBfdGhpczI4LmFjdGl2ZUdyb3VwOwogICAgICAgICAgfSk7CiAgICAgICAgICB2YXIgb3JkZXIgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOwogICAgICAgICAgdmFyIHN0cmVhbXMgPSBbewogICAgICAgICAgICBzb3VyY2Vfc3RyZWFtX3VybDogdGhpcy52aW1lby51cmwsCiAgICAgICAgICAgIHN0cmVhbV90dmdfbmFtZTogdGhpcy52aW1lby52aWRlby52aWRlby50aXRsZSwKICAgICAgICAgICAgc3RyZWFtX3R2Z19pZDogIiIsCiAgICAgICAgICAgIHN0cmVhbV90dmdfbG9nbzogdGhpcy52aW1lby52aWRlby52aWRlby50aHVtYnMuYmFzZSwKICAgICAgICAgICAgc3RyZWFtX29yZGVyOiBvcmRlcisrCiAgICAgICAgICB9XTsKICAgICAgICAgIGh0dHBTZXJ2aWNlLnBvc3QoImVkaXRvci9hZGQtc3RyZWFtcy8iLmNvbmNhdCh0aGlzLmFjdGl2ZUdyb3VwVHlwZSksIHsKICAgICAgICAgICAgcGxheWxpc3RfaWQ6IHRoaXMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICAgIGdyb3VwX2lkOiB0aGlzLmdldEdyb3VwV2l0aElkKHRoaXMuYWN0aXZlR3JvdXApLmlkLAogICAgICAgICAgICBzdHJlYW1zOiBzdHJlYW1zCiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICAgICAgX3RoaXMyOC52aW1lby5pc0xvYWRpbmcgPSBmYWxzZTsKCiAgICAgICAgICAgIGlmIChyZXMuc3RhdHVzKSB7CiAgICAgICAgICAgICAgX3RoaXMyOC5sb2FkUGxheWxpc3QoX3RoaXMyOC5wbGF5bGlzdEVkaXRvci5pZCwgZ3JvdXBJbmRleCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgX3RoaXMyOC52aW1lby5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy52aW1lby5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgZ2V0VmltZW9Db25maWc6IGZ1bmN0aW9uIGdldFZpbWVvQ29uZmlnKHZpZGVvSWQpIHsKICAgICAgdmFyIF90aGlzMjkgPSB0aGlzOwoKICAgICAgdGhpcy52aW1lby5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZS5wb3N0KCJlZGl0b3IvdmltZW8tdmlkZW8iLCB7CiAgICAgICAgdmlkZW9faWQ6IHZpZGVvSWQKICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgX3RoaXMyOS52aW1lby52aWRlbyA9IHJlcy5kYXRhOwogICAgICAgIF90aGlzMjkudmltZW8uaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0pOwogICAgfSwKICAgIGRhaWx5bW90aW9uTW9kYWw6IGZ1bmN0aW9uIGRhaWx5bW90aW9uTW9kYWwoc2hvdykgewogICAgICB2YXIgX3RoaXMzMCA9IHRoaXM7CgogICAgICB2YXIgc2F2ZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogZmFsc2U7CgogICAgICBpZiAoc2hvdykgewogICAgICAgIHRoaXMuZGFpbHltb3Rpb24udXJsID0gIiI7CiAgICAgICAgdGhpcy5kYWlseW1vdGlvbi52aWRlbyA9IG51bGw7CiAgICAgICAgdGhpcy5kYWlseW1vdGlvbi5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfQoKICAgICAgaWYgKHNhdmUpIHsKICAgICAgICBpZiAodGhpcy5kYWlseW1vdGlvbi52aWRlbykgewogICAgICAgICAgdGhpcy5kYWlseW1vdGlvbi5pc0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgdmFyIGdyb3VwSW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgICAgICAgIHJldHVybiBncm91cC5pZCA9PSBfdGhpczMwLmFjdGl2ZUdyb3VwOwogICAgICAgICAgfSk7CiAgICAgICAgICB2YXIgb3JkZXIgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOwogICAgICAgICAgdmFyIHN0cmVhbXMgPSBbewogICAgICAgICAgICBzb3VyY2Vfc3RyZWFtX3VybDogdGhpcy5kYWlseW1vdGlvbi51cmwsCiAgICAgICAgICAgIHN0cmVhbV90dmdfbmFtZTogdGhpcy5kYWlseW1vdGlvbi52aWRlby50aXRsZSwKICAgICAgICAgICAgc3RyZWFtX3R2Z19pZDogIiIsCiAgICAgICAgICAgIHN0cmVhbV90dmdfbG9nbzogdGhpcy5kYWlseW1vdGlvbi52aWRlby50aHVtYm5haWxfMTA4MF91cmwsCiAgICAgICAgICAgIHN0cmVhbV9vcmRlcjogb3JkZXIrKwogICAgICAgICAgfV07CiAgICAgICAgICBodHRwU2VydmljZS5wb3N0KCJlZGl0b3IvYWRkLXN0cmVhbXMvIi5jb25jYXQodGhpcy5hY3RpdmVHcm91cFR5cGUpLCB7CiAgICAgICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgICBncm91cF9pZDogdGhpcy5nZXRHcm91cFdpdGhJZCh0aGlzLmFjdGl2ZUdyb3VwKS5pZCwKICAgICAgICAgICAgc3RyZWFtczogc3RyZWFtcwogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICAgIF90aGlzMzAuZGFpbHltb3Rpb24uaXNMb2FkaW5nID0gZmFsc2U7CgogICAgICAgICAgICBpZiAocmVzLnN0YXR1cykgewogICAgICAgICAgICAgIF90aGlzMzAubG9hZFBsYXlsaXN0KF90aGlzMzAucGxheWxpc3RFZGl0b3IuaWQsIGdyb3VwSW5kZXgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIF90aGlzMzAuZGFpbHltb3Rpb24uaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuZGFpbHltb3Rpb24ubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGdldERhaWx5bW90aW9uQ29uZmlnOiBmdW5jdGlvbiBnZXREYWlseW1vdGlvbkNvbmZpZyh2aWRlb0lkKSB7CiAgICAgIHZhciBfdGhpczMxID0gdGhpczsKCiAgICAgIHRoaXMuZGFpbHltb3Rpb24uaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UucG9zdCgiZWRpdG9yL2RhaWx5bW90aW9uLXZpZGVvIiwgewogICAgICAgIHZpZGVvX2lkOiB2aWRlb0lkCiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgIF90aGlzMzEuZGFpbHltb3Rpb24udmlkZW8gPSByZXMuZGF0YTsKICAgICAgICBfdGhpczMxLmRhaWx5bW90aW9uLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9KTsKICAgIH0sCiAgICB0ZWRUYWxrc01vZGFsOiBmdW5jdGlvbiB0ZWRUYWxrc01vZGFsKHNob3cpIHsKICAgICAgdmFyIF90aGlzMzIgPSB0aGlzOwoKICAgICAgdmFyIHNhdmUgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IGZhbHNlOwoKICAgICAgaWYgKHNob3cpIHsKICAgICAgICB0aGlzLnRlZFRhbGtzLnVybCA9ICIiOwogICAgICAgIHRoaXMudGVkVGFsa3MudmlkZW8gPSBudWxsOwogICAgICAgIHRoaXMudGVkVGFsa3MuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgaWYgKHRoaXMudGVkVGFsa3MudmlkZW8pIHsKICAgICAgICAgIHRoaXMudGVkVGFsa3MuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgIHZhciBncm91cEluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KGZ1bmN0aW9uIChncm91cCkgewogICAgICAgICAgICByZXR1cm4gZ3JvdXAuaWQgPT0gX3RoaXMzMi5hY3RpdmVHcm91cDsKICAgICAgICAgIH0pOwogICAgICAgICAgdmFyIG9yZGVyID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsKICAgICAgICAgIHZhciBzdHJlYW1zID0gW3sKICAgICAgICAgICAgc291cmNlX3N0cmVhbV91cmw6IHRoaXMudGVkVGFsa3MudXJsLAogICAgICAgICAgICBzdHJlYW1fdHZnX25hbWU6IHRoaXMudGVkVGFsa3MudmlkZW8udGl0bGUsCiAgICAgICAgICAgIHN0cmVhbV90dmdfaWQ6ICIiLAogICAgICAgICAgICBzdHJlYW1fdHZnX2xvZ286IHRoaXMudGVkVGFsa3MudmlkZW8uaGVybywKICAgICAgICAgICAgc3RyZWFtX29yZGVyOiBvcmRlcisrCiAgICAgICAgICB9XTsKICAgICAgICAgIGh0dHBTZXJ2aWNlLnBvc3QoImVkaXRvci9hZGQtc3RyZWFtcy8iLmNvbmNhdCh0aGlzLmFjdGl2ZUdyb3VwVHlwZSksIHsKICAgICAgICAgICAgcGxheWxpc3RfaWQ6IHRoaXMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICAgIGdyb3VwX2lkOiB0aGlzLmdldEdyb3VwV2l0aElkKHRoaXMuYWN0aXZlR3JvdXApLmlkLAogICAgICAgICAgICBzdHJlYW1zOiBzdHJlYW1zCiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICAgICAgX3RoaXMzMi50ZWRUYWxrcy5pc0xvYWRpbmcgPSBmYWxzZTsKCiAgICAgICAgICAgIGlmIChyZXMuc3RhdHVzKSB7CiAgICAgICAgICAgICAgX3RoaXMzMi5sb2FkUGxheWxpc3QoX3RoaXMzMi5wbGF5bGlzdEVkaXRvci5pZCwgZ3JvdXBJbmRleCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgX3RoaXMzMi50ZWRUYWxrcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy50ZWRUYWxrcy5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgZ2V0VGVkVGFsa3NDb25maWc6IGZ1bmN0aW9uIGdldFRlZFRhbGtzQ29uZmlnKHVybCkgewogICAgICB2YXIgX3RoaXMzMyA9IHRoaXM7CgogICAgICB0aGlzLnRlZFRhbGtzLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGh0dHBTZXJ2aWNlLnBvc3QoImVkaXRvci90ZWQtdGFsa3MtdmlkZW8iLCB7CiAgICAgICAgdXJsOiB1cmwKICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgX3RoaXMzMy50ZWRUYWxrcy52aWRlbyA9IHJlcy5kYXRhLnRhbGtzLmxlbmd0aCA/IHJlcy5kYXRhLnRhbGtzWzBdIDogbnVsbDsKICAgICAgICBfdGhpczMzLnRlZFRhbGtzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9KTsKICAgIH0sCiAgICB4aGFtc3Rlck1vZGFsOiBmdW5jdGlvbiB4aGFtc3Rlck1vZGFsKHNob3cpIHsKICAgICAgdmFyIF90aGlzMzQgPSB0aGlzOwoKICAgICAgdmFyIHNhdmUgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IGZhbHNlOwoKICAgICAgaWYgKHNob3cpIHsKICAgICAgICB0aGlzLnhoYW1zdGVyLnVybCA9ICIiOwogICAgICAgIHRoaXMueGhhbXN0ZXIudmlkZW8gPSBudWxsOwogICAgICAgIHRoaXMueGhhbXN0ZXIuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgaWYgKHRoaXMueGhhbXN0ZXIudmlkZW8pIHsKICAgICAgICAgIHRoaXMueGhhbXN0ZXIuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgIHZhciBncm91cEluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KGZ1bmN0aW9uIChncm91cCkgewogICAgICAgICAgICByZXR1cm4gZ3JvdXAuaWQgPT0gX3RoaXMzNC5hY3RpdmVHcm91cDsKICAgICAgICAgIH0pOwogICAgICAgICAgdmFyIG9yZGVyID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsKICAgICAgICAgIHZhciBzdHJlYW1zID0gW3sKICAgICAgICAgICAgc291cmNlX3N0cmVhbV91cmw6IHRoaXMueGhhbXN0ZXIudXJsLAogICAgICAgICAgICBzdHJlYW1fdHZnX25hbWU6IHRoaXMueGhhbXN0ZXIudmlkZW8udmlkZW9FbnRpdHkudGl0bGUsCiAgICAgICAgICAgIHN0cmVhbV90dmdfaWQ6ICIiLAogICAgICAgICAgICBzdHJlYW1fdHZnX2xvZ286IHRoaXMueGhhbXN0ZXIudmlkZW8udmlkZW9FbnRpdHkudGh1bWJCaWcsCiAgICAgICAgICAgIHN0cmVhbV9vcmRlcjogb3JkZXIrKwogICAgICAgICAgfV07CiAgICAgICAgICBodHRwU2VydmljZS5wb3N0KCJlZGl0b3IvYWRkLXN0cmVhbXMvIi5jb25jYXQodGhpcy5hY3RpdmVHcm91cFR5cGUpLCB7CiAgICAgICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgICBncm91cF9pZDogdGhpcy5nZXRHcm91cFdpdGhJZCh0aGlzLmFjdGl2ZUdyb3VwKS5pZCwKICAgICAgICAgICAgc3RyZWFtczogc3RyZWFtcwogICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICAgIF90aGlzMzQueGhhbXN0ZXIuaXNMb2FkaW5nID0gZmFsc2U7CgogICAgICAgICAgICBpZiAocmVzLnN0YXR1cykgewogICAgICAgICAgICAgIF90aGlzMzQubG9hZFBsYXlsaXN0KF90aGlzMzQucGxheWxpc3RFZGl0b3IuaWQsIGdyb3VwSW5kZXgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIF90aGlzMzQueGhhbXN0ZXIuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMueGhhbXN0ZXIubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGdldFhoYW1zdGVyQ29uZmlnOiBmdW5jdGlvbiBnZXRYaGFtc3RlckNvbmZpZyh1cmwpIHsKICAgICAgdmFyIF90aGlzMzUgPSB0aGlzOwoKICAgICAgdGhpcy54aGFtc3Rlci5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZS5wb3N0KCJlZGl0b3IveGhhbXN0ZXItdmlkZW8iLCB7CiAgICAgICAgdXJsOiB1cmwKICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgX3RoaXMzNS54aGFtc3Rlci52aWRlbyA9IHJlcy5kYXRhOwogICAgICAgIF90aGlzMzUueGhhbXN0ZXIuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0pOwogICAgfSwKICAgIGdyb3VwRG91YmxlQ2xpY2s6IGZ1bmN0aW9uIGdyb3VwRG91YmxlQ2xpY2soKSB7CiAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3Vwcy5sZW5ndGggPT09IDEpIHsKICAgICAgICB0aGlzLmVkaXRHcm91cE1vZGFsKHRydWUpOwogICAgICB9CiAgICB9LAogICAgc3RyZWFtRG91YmxlQ2xpY2s6IGZ1bmN0aW9uIHN0cmVhbURvdWJsZUNsaWNrKCkgewogICAgICBpZiAodGhpcy5hY3RpdmVTdHJlYW1zLmxlbmd0aCA9PT0gMSkgewogICAgICAgIHRoaXMuZWRpdFN0cmVhbU1vZGFsKHRydWUpOwogICAgICB9CiAgICB9LAogICAgbG9hZExvZ29Db3VudHJpZXM6IGZ1bmN0aW9uIGxvYWRMb2dvQ291bnRyaWVzKCkgewogICAgICB2YXIgX3RoaXMzNiA9IHRoaXM7CgogICAgICB0aGlzLmZpbmRMb2dvLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGh0dHBTZXJ2aWNlLmdldCgiZWRpdG9yL2xvZ28tY291bnRyaWVzIikudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgX3RoaXMzNi5maW5kTG9nby5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICBfdGhpczM2LmZpbmRMb2dvLmNvdW50cmllcyA9IHJlcy5kYXRhLm1hcChmdW5jdGlvbiAoY291bnRyeSkgewogICAgICAgICAgdmFyIGNuID0gX3RoaXMzNi5jb3VudHJpZXMuZmluZChmdW5jdGlvbiAoY250KSB7CiAgICAgICAgICAgIHJldHVybiBjbnQuY29kZS50b0xvd2VyQ2FzZSgpID09IGNvdW50cnkudG9Mb3dlckNhc2UoKTsKICAgICAgICAgIH0pOwoKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHRleHQ6IGNuID8gY24ubmFtZSA6IGNvdW50cnksCiAgICAgICAgICAgIHZhbHVlOiBjb3VudHJ5CiAgICAgICAgICB9OwogICAgICAgIH0pLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgIHJldHVybiBhLnRleHQudG9VcHBlckNhc2UoKSA8IGIudGV4dC50b1VwcGVyQ2FzZSgpID8gLTEgOiBhLnRleHQudG9VcHBlckNhc2UoKSA+IGIudGV4dC50b1VwcGVyQ2FzZSgpID8gMSA6IDA7CiAgICAgICAgfSk7CiAgICAgICAgX3RoaXMzNi5hc3NpZ25Mb2dvLmNvdW50cmllcyA9IF90b0NvbnN1bWFibGVBcnJheShfdGhpczM2LmZpbmRMb2dvLmNvdW50cmllcyk7CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczM2LmZpbmRMb2dvLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9KTsKICAgIH0sCiAgICBsb2FkVFZHSURDb3VudHJpZXM6IGZ1bmN0aW9uIGxvYWRUVkdJRENvdW50cmllcygpIHsKICAgICAgdmFyIF90aGlzMzcgPSB0aGlzOwoKICAgICAgdGhpcy5hc3NpZ25UVkdJRC5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZS5nZXQoImVkaXRvci90di1ndWlkZS1jb3VudHJpZXMiKS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICBfdGhpczM3LmFzc2lnblRWR0lELmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIF90aGlzMzcuYXNzaWduVFZHSUQuY291bnRyaWVzID0gcmVzLmRhdGEubWFwKGZ1bmN0aW9uIChjb3VudHJ5KSB7CiAgICAgICAgICB2YXIgY24gPSBfdGhpczM3LmNvdW50cmllcy5maW5kKGZ1bmN0aW9uIChjbnQpIHsKICAgICAgICAgICAgcmV0dXJuIGNudC5jb2RlLnRvTG93ZXJDYXNlKCkgPT0gY291bnRyeS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgfSk7CgogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgdGV4dDogY24gPyBjbi5uYW1lIDogY291bnRyeSwKICAgICAgICAgICAgdmFsdWU6IGNvdW50cnkKICAgICAgICAgIH07CiAgICAgICAgfSkuc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgcmV0dXJuIGEudGV4dC50b1VwcGVyQ2FzZSgpIDwgYi50ZXh0LnRvVXBwZXJDYXNlKCkgPyAtMSA6IGEudGV4dC50b1VwcGVyQ2FzZSgpID4gYi50ZXh0LnRvVXBwZXJDYXNlKCkgPyAxIDogMDsKICAgICAgICB9KTsKCiAgICAgICAgX3RoaXMzNy5hc3NpZ25UVkdJRC5jb3VudHJpZXMudW5zaGlmdCh7CiAgICAgICAgICB0ZXh0OiBfdGhpczM3LiR0KCJnZW5lcmFsLmFsbCIpLAogICAgICAgICAgdmFsdWU6ICJhbGwiCiAgICAgICAgfSk7CgogICAgICAgIF90aGlzMzcuZmluZFRWR0lELmNvdW50cmllcyA9IF90b0NvbnN1bWFibGVBcnJheShfdGhpczM3LmFzc2lnblRWR0lELmNvdW50cmllcyk7CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczM3LmFzc2lnblRWR0lELmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9KTsKICAgIH0sCiAgICBsb2FkU2lwdHZDb3VudHJpZXM6IGZ1bmN0aW9uIGxvYWRTaXB0dkNvdW50cmllcygpIHsKICAgICAgdmFyIF90aGlzMzggPSB0aGlzOwoKICAgICAgdGhpcy5hc3NpZ25TSVBUVi5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZS5nZXQoImVkaXRvci9zbWFydC1pcHR2LWNvdW50cmllcyIpLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgIF90aGlzMzguYXNzaWduU0lQVFYuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgX3RoaXMzOC5hc3NpZ25TSVBUVi5jb3VudHJpZXMgPSByZXMuZGF0YTsKICAgICAgICBfdGhpczM4LmZpbmRTaXB0di5jb3VudHJpZXMgPSBfdG9Db25zdW1hYmxlQXJyYXkoX3RoaXMzOC5hc3NpZ25TSVBUVi5jb3VudHJpZXMpOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMzOC5hc3NpZ25TSVBUVi5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfSk7CiAgICB9LAogICAgbG9hZExvZ29zRmluZDogZnVuY3Rpb24gbG9hZExvZ29zRmluZChjb3VudHJ5KSB7CiAgICAgIHZhciBfdGhpczM5ID0gdGhpczsKCiAgICAgIHRoaXMuZmluZExvZ28uaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UuZ2V0KCJlZGl0b3IvbG9nb3MvIi5jb25jYXQoY291bnRyeSkpLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgIF90aGlzMzkuZmluZExvZ28ubG9nbyA9ICIiOwogICAgICAgIF90aGlzMzkuZmluZExvZ28uaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgX3RoaXMzOS5maW5kTG9nby5sb2dvcyA9IHJlcy5kYXRhLm1hcChmdW5jdGlvbiAobG9nbykgewogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgdGV4dDogbG9nby5sYWJlbCwKICAgICAgICAgICAgdmFsdWU6IGxvZ28uZmlsZW5hbWUKICAgICAgICAgIH07CiAgICAgICAgfSk7CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczM5LmZpbmRMb2dvLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9KTsKICAgIH0sCiAgICBmaW5kTG9nb01vZGFsOiBmdW5jdGlvbiBmaW5kTG9nb01vZGFsKHNob3cpIHsKICAgICAgdmFyIHNhdmUgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IGZhbHNlOwogICAgICB2YXIgc2VsZWN0ZWQgPSB0aGlzLmdldFN0cmVhbVdpdGhJZCh0aGlzLmFjdGl2ZVN0cmVhbXNbMF0pOwoKICAgICAgaWYgKHNob3cpIHsKICAgICAgICB0aGlzLmZpbmRMb2dvLmxvZ28gPSAiIjsKICAgICAgICB0aGlzLmZpbmRMb2dvLnRpdGxlID0gc2VsZWN0ZWQuc3RyZWFtX3R2Z19uYW1lOwogICAgICB9CgogICAgICB0aGlzLmZpbmRMb2dvLnNlYXJjaCA9ICIiOwoKICAgICAgaWYgKHNhdmUpIHsKICAgICAgICBpZiAoc2VsZWN0ZWQpIHsKICAgICAgICAgIHNlbGVjdGVkLnN0cmVhbV90dmdfbG9nbyA9ICJodHRwOi8vc3RhdGljLmlwdHYtdG9vbHMuY29tLyIuY29uY2F0KHRoaXMuZmluZExvZ28uY291bnRyeSwgIi8iKS5jb25jYXQodGhpcy5maW5kTG9nby5sb2dvKTsKICAgICAgICAgIHNlbGVjdGVkLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmZpbmRMb2dvLm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBsb2FkTG9nb3NBc3NpZ246IGZ1bmN0aW9uIGxvYWRMb2dvc0Fzc2lnbihjb3VudHJ5KSB7CiAgICAgIHZhciBfdGhpczQwID0gdGhpczsKCiAgICAgIHRoaXMuYXNzaWduTG9nby5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZS5nZXQoImVkaXRvci9sb2dvcy8iLmNvbmNhdChjb3VudHJ5KSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgX3RoaXM0MC5hc3NpZ25Mb2dvLmxvZ28gPSAiIjsKICAgICAgICBfdGhpczQwLmFzc2lnbkxvZ28uaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgX3RoaXM0MC5hc3NpZ25Mb2dvLmxvZ29zID0gcmVzLmRhdGEubWFwKGZ1bmN0aW9uIChsb2dvKSB7CiAgICAgICAgICByZXR1cm4gbG9nby5maWxlbmFtZTsKICAgICAgICB9KTsKICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzNDAuYXNzaWduTG9nby5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfSk7CiAgICB9LAogICAgYXNzaWduTG9nb01vZGFsOiBmdW5jdGlvbiBhc3NpZ25Mb2dvTW9kYWwoc2hvdykgewogICAgICB2YXIgX3RoaXM0MSA9IHRoaXM7CgogICAgICB2YXIgc2F2ZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogZmFsc2U7CgogICAgICBpZiAoc2hvdykgewogICAgICAgIHRoaXMuYXNzaWduTG9nby5sb2dvID0gIiI7CiAgICAgIH0KCiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgdmFyIGNoYW5nZWQgPSBmYWxzZTsKCiAgICAgICAgdmFyIHN0cmluZ1NpbWlsYXJpdHkgPSByZXF1aXJlKCJzdHJpbmctc2ltaWxhcml0eSIpOwoKICAgICAgICB2YXIgc3RyZWFtcyA9IFtdOwoKICAgICAgICBpZiAodGhpcy5hc3NpZ25Mb2dvLmFzc2lnbkFsbCA9PSAxKSB7CiAgICAgICAgICBzdHJlYW1zID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzdHJlYW1zID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmZpbHRlcihmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAgICAgICAgIHJldHVybiAhc3RyZWFtLnN0cmVhbV90dmdfbG9nby5sZW5ndGg7CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIHN0cmVhbXMubWFwKGZ1bmN0aW9uIChzdHJlYW0pIHsKICAgICAgICAgIHZhciBtYXRjaDEgPSBzdHJpbmdTaW1pbGFyaXR5LmZpbmRCZXN0TWF0Y2goU3RyaW5nKHN0cmVhbS5zdHJlYW1fdHZnX25hbWUpLnJlcGxhY2UoLyBoZCQvaSwgIiIpLCBfdGhpczQxLmFzc2lnbkxvZ28ubG9nb3MpLmJlc3RNYXRjaDsKICAgICAgICAgIHZhciBtYXRjaDIgPSBzdHJpbmdTaW1pbGFyaXR5LmZpbmRCZXN0TWF0Y2goU3RyaW5nKHN0cmVhbS5zdHJlYW1fdHZnX2lkKSwgX3RoaXM0MS5hc3NpZ25Mb2dvLmxvZ29zKS5iZXN0TWF0Y2g7CgogICAgICAgICAgaWYgKG1hdGNoMS5yYXRpbmcgPj0gMC4zKSB7CiAgICAgICAgICAgIGNoYW5nZWQgPSB0cnVlOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19sb2dvID0gImh0dHA6Ly9zdGF0aWMuaXB0di10b29scy5jb20vIi5jb25jYXQoX3RoaXM0MS5hc3NpZ25Mb2dvLmNvdW50cnksICIvIikuY29uY2F0KG1hdGNoMS50YXJnZXQpOwogICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgfSBlbHNlIGlmIChtYXRjaDIucmF0aW5nID49IDAuNSkgewogICAgICAgICAgICBjaGFuZ2VkID0gdHJ1ZTsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfbG9nbyA9ICJodHRwOi8vc3RhdGljLmlwdHYtdG9vbHMuY29tLyIuY29uY2F0KF90aGlzNDEuYXNzaWduTG9nby5jb3VudHJ5LCAiLyIpLmNvbmNhdChtYXRjaDIudGFyZ2V0KTsKICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSBjaGFuZ2VkOwogICAgICB9CgogICAgICB0aGlzLmFzc2lnbkxvZ28ubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGxvYWRUVkdJREFzc2lnbjogZnVuY3Rpb24gbG9hZFRWR0lEQXNzaWduKGNvdW50cnkpIHsKICAgICAgdmFyIF90aGlzNDIgPSB0aGlzOwoKICAgICAgdGhpcy5hc3NpZ25UVkdJRC5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZS5nZXQoImVkaXRvci90di1ndWlkZS8iLmNvbmNhdChjb3VudHJ5KSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgX3RoaXM0Mi5hc3NpZ25UVkdJRC5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICBfdGhpczQyLmFzc2lnblRWR0lELmNoYW5uZWxzID0gcmVzLmRhdGE7CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczQyLmFzc2lnblRWR0lELmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9KTsKICAgIH0sCiAgICBsb2FkU2lwdHZBc3NpZ246IGZ1bmN0aW9uIGxvYWRTaXB0dkFzc2lnbihjb3VudHJ5KSB7CiAgICAgIHZhciBfdGhpczQzID0gdGhpczsKCiAgICAgIHRoaXMuYXNzaWduU0lQVFYuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UuZ2V0KCJlZGl0b3Ivc21hcnQtaXB0di8iLmNvbmNhdChjb3VudHJ5KSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgX3RoaXM0My5hc3NpZ25TSVBUVi5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICBfdGhpczQzLmFzc2lnblNJUFRWLmNoYW5uZWxzID0gcmVzLmRhdGE7CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczQzLmFzc2lnblNJUFRWLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9KTsKICAgIH0sCiAgICBhc3NpZ25UVkdJRE1vZGFsOiBmdW5jdGlvbiBhc3NpZ25UVkdJRE1vZGFsKHNob3cpIHsKICAgICAgdmFyIF90aGlzNDQgPSB0aGlzOwoKICAgICAgdmFyIHNhdmUgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IGZhbHNlOwoKICAgICAgaWYgKHNhdmUpIHsKICAgICAgICB2YXIgY2hhbmdlZCA9IGZhbHNlOwoKICAgICAgICB2YXIgc3RyaW5nU2ltaWxhcml0eSA9IHJlcXVpcmUoInN0cmluZy1zaW1pbGFyaXR5Iik7CgogICAgICAgIHZhciBzdHJlYW1zID0gW107CgogICAgICAgIGlmICh0aGlzLmFzc2lnblRWR0lELmFzc2lnbkFsbCA9PSAxKSB7CiAgICAgICAgICBzdHJlYW1zID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzdHJlYW1zID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmZpbHRlcihmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAgICAgICAgIHJldHVybiAhc3RyZWFtLnN0cmVhbV90dmdfaWQubGVuZ3RoIHx8IHN0cmVhbS5zdHJlYW1fdHZnX2lkLmxlbmd0aCA9PSAwOwogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICB2YXIgY2hhbm5lbE5hbWVzID0gdGhpcy5hc3NpZ25UVkdJRC5jaGFubmVscy5tYXAoZnVuY3Rpb24gKGNoYW5uZWwpIHsKICAgICAgICAgIHJldHVybiBjaGFubmVsLnR2Z19uYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgfSk7CiAgICAgICAgdmFyIGNoYW5uZWxJZHMgPSB0aGlzLmFzc2lnblRWR0lELmNoYW5uZWxzLm1hcChmdW5jdGlvbiAoY2hhbm5lbCkgewogICAgICAgICAgcmV0dXJuIGNoYW5uZWwudHZnX2lkLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgfSk7CiAgICAgICAgc3RyZWFtcy5tYXAoZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgICAgdmFyIG1hdGNoMSA9IHN0cmluZ1NpbWlsYXJpdHkuZmluZEJlc3RNYXRjaChTdHJpbmcoc3RyZWFtLnN0cmVhbV90dmdfbmFtZSkudG9Mb3dlckNhc2UoKSwgY2hhbm5lbE5hbWVzKS5iZXN0TWF0Y2g7CiAgICAgICAgICB2YXIgbWF0Y2gyID0gc3RyaW5nU2ltaWxhcml0eS5maW5kQmVzdE1hdGNoKFN0cmluZyhzdHJlYW0uc3RyZWFtX3R2Z19pZCkudG9Mb3dlckNhc2UoKSwgY2hhbm5lbElkcykuYmVzdE1hdGNoOwogICAgICAgICAgdmFyIG1hdGNoMyA9IHN0cmluZ1NpbWlsYXJpdHkuZmluZEJlc3RNYXRjaChTdHJpbmcoc3RyZWFtLnN0cmVhbV90dmdfbmFtZSkucmVwbGFjZSgvIGhkJHwgZmhkJHwgaGV2YyR8IGgyNjUkfC9pLCAiIikudG9Mb3dlckNhc2UoKSwgY2hhbm5lbE5hbWVzKS5iZXN0TWF0Y2g7CgogICAgICAgICAgaWYgKG1hdGNoMi5yYXRpbmcgPj0gMC43NSkgewogICAgICAgICAgICBjaGFuZ2VkID0gdHJ1ZTsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfaWQgPSBtYXRjaDIudGFyZ2V0OwogICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgfSBlbHNlIGlmIChtYXRjaDEucmF0aW5nID49IDAuNzUpIHsKICAgICAgICAgICAgY2hhbmdlZCA9IHRydWU7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX2lkID0gX3RoaXM0NC5hc3NpZ25UVkdJRC5jaGFubmVscy5maW5kKGZ1bmN0aW9uIChjaGFubmVsKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGNoYW5uZWwudHZnX25hbWUudG9Mb3dlckNhc2UoKSA9PT0gbWF0Y2gxLnRhcmdldDsKICAgICAgICAgICAgfSkudHZnX2lkOwogICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgfSBlbHNlIGlmIChtYXRjaDMucmF0aW5nID49IDAuNzUpIHsKICAgICAgICAgICAgY2hhbmdlZCA9IHRydWU7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX2lkID0gX3RoaXM0NC5hc3NpZ25UVkdJRC5jaGFubmVscy5maW5kKGZ1bmN0aW9uIChjaGFubmVsKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGNoYW5uZWwudHZnX25hbWUudG9Mb3dlckNhc2UoKSA9PT0gbWF0Y2gxLnRhcmdldDsKICAgICAgICAgICAgfSkudHZnX2lkOwogICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY2hhbmdlZCA9IHRydWU7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX2lkID0gIiI7CiAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gY2hhbmdlZDsKICAgICAgfQoKICAgICAgdGhpcy5hc3NpZ25UVkdJRC5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgYXNzaWduU2lwdHZNb2RhbDogZnVuY3Rpb24gYXNzaWduU2lwdHZNb2RhbChzaG93KSB7CiAgICAgIHZhciBfdGhpczQ1ID0gdGhpczsKCiAgICAgIHZhciBzYXZlID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiBmYWxzZTsKCiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgdmFyIGNoYW5nZWQgPSBmYWxzZTsKCiAgICAgICAgdmFyIHN0cmluZ1NpbWlsYXJpdHkgPSByZXF1aXJlKCJzdHJpbmctc2ltaWxhcml0eSIpOwoKICAgICAgICB2YXIgc3RyZWFtcyA9IFtdOwoKICAgICAgICBpZiAodGhpcy5hc3NpZ25TSVBUVi5hc3NpZ25BbGwgPT0gMSkgewogICAgICAgICAgc3RyZWFtcyA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtczsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc3RyZWFtcyA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5maWx0ZXIoZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgICAgICByZXR1cm4gIXN0cmVhbS5zdHJlYW1fdHZnX2lkLmxlbmd0aCB8fCBzdHJlYW0uc3RyZWFtX3R2Z19pZC5sZW5ndGggPT0gMDsKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgdmFyIGNoYW5uZWxOYW1lcyA9IHRoaXMuYXNzaWduU0lQVFYuY2hhbm5lbHMubWFwKGZ1bmN0aW9uIChjaGFubmVsKSB7CiAgICAgICAgICByZXR1cm4gY2hhbm5lbC50dmdfbmFtZTsKICAgICAgICB9KTsKICAgICAgICB2YXIgY2hhbm5lbElkcyA9IHRoaXMuYXNzaWduU0lQVFYuY2hhbm5lbHMubWFwKGZ1bmN0aW9uIChjaGFubmVsKSB7CiAgICAgICAgICByZXR1cm4gY2hhbm5lbC50dmdfaWQ7CiAgICAgICAgfSk7CiAgICAgICAgc3RyZWFtcy5tYXAoZnVuY3Rpb24gKHN0cmVhbSkgewogICAgICAgICAgdmFyIG1hdGNoMSA9IHN0cmluZ1NpbWlsYXJpdHkuZmluZEJlc3RNYXRjaChTdHJpbmcoc3RyZWFtLnN0cmVhbV90dmdfbmFtZSksIGNoYW5uZWxOYW1lcykuYmVzdE1hdGNoOwogICAgICAgICAgdmFyIG1hdGNoMiA9IHN0cmluZ1NpbWlsYXJpdHkuZmluZEJlc3RNYXRjaChTdHJpbmcoc3RyZWFtLnN0cmVhbV90dmdfaWQpLCBjaGFubmVsSWRzKS5iZXN0TWF0Y2g7CiAgICAgICAgICB2YXIgbWF0Y2gzID0gc3RyaW5nU2ltaWxhcml0eS5maW5kQmVzdE1hdGNoKFN0cmluZyhzdHJlYW0uc3RyZWFtX3R2Z19uYW1lKS5yZXBsYWNlKC8gaGQkfCBmaGQkfCBoZXZjJHwgaDI2NSR8L2ksICIiKSwgY2hhbm5lbE5hbWVzKS5iZXN0TWF0Y2g7CgogICAgICAgICAgaWYgKG1hdGNoMi5yYXRpbmcgPj0gMC43NSkgewogICAgICAgICAgICBjaGFuZ2VkID0gdHJ1ZTsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfaWQgPSBtYXRjaDIudGFyZ2V0OwogICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgfSBlbHNlIGlmIChtYXRjaDEucmF0aW5nID49IDAuNzUpIHsKICAgICAgICAgICAgY2hhbmdlZCA9IHRydWU7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX2lkID0gX3RoaXM0NS5hc3NpZ25TSVBUVi5jaGFubmVscy5maW5kKGZ1bmN0aW9uIChjaGFubmVsKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGNoYW5uZWwudHZnX25hbWUgPT09IG1hdGNoMS50YXJnZXQ7CiAgICAgICAgICAgIH0pLnR2Z19pZDsKICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgIH0gZWxzZSBpZiAobWF0Y2gzLnJhdGluZyA+PSAwLjc1KSB7CiAgICAgICAgICAgIGNoYW5nZWQgPSB0cnVlOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19pZCA9IF90aGlzNDUuYXNzaWduU0lQVFYuY2hhbm5lbHMuZmluZChmdW5jdGlvbiAoY2hhbm5lbCkgewogICAgICAgICAgICAgIHJldHVybiBjaGFubmVsLnR2Z19uYW1lID09PSBtYXRjaDEudGFyZ2V0OwogICAgICAgICAgICB9KS50dmdfaWQ7CiAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjaGFuZ2VkID0gdHJ1ZTsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfaWQgPSAiIjsKICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSBjaGFuZ2VkOwogICAgICB9CgogICAgICB0aGlzLmFzc2lnblNJUFRWLm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBsb2FkVFZHSURGaW5kOiBmdW5jdGlvbiBsb2FkVFZHSURGaW5kKGNvdW50cnkpIHsKICAgICAgdmFyIF90aGlzNDYgPSB0aGlzOwoKICAgICAgdGhpcy5maW5kVFZHSUQuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UuZ2V0KCJlZGl0b3IvdHYtZ3VpZGUvIi5jb25jYXQoY291bnRyeSkpLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgIF90aGlzNDYuZmluZFRWR0lELmNoYW5uZWwgPSAiIjsKICAgICAgICBfdGhpczQ2LmZpbmRUVkdJRC5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICBfdGhpczQ2LmZpbmRUVkdJRC5jaGFubmVscyA9IHJlcy5kYXRhLm1hcChmdW5jdGlvbiAoY2hhbm5lbCkgewogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgdGV4dDogY2hhbm5lbC50dmdfbmFtZSwKICAgICAgICAgICAgdmFsdWU6IGNoYW5uZWwudHZnX2lkCiAgICAgICAgICB9OwogICAgICAgIH0pOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXM0Ni5maW5kVFZHSUQuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0pOwogICAgfSwKICAgIGxvYWRTaXB0dkZpbmQ6IGZ1bmN0aW9uIGxvYWRTaXB0dkZpbmQoY291bnRyeSkgewogICAgICB2YXIgX3RoaXM0NyA9IHRoaXM7CgogICAgICB0aGlzLmZpbmRTaXB0di5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZS5nZXQoImVkaXRvci9zbWFydC1pcHR2LyIuY29uY2F0KGNvdW50cnkpKS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICBfdGhpczQ3LmZpbmRTaXB0di5jaGFubmVsID0gIiI7CiAgICAgICAgX3RoaXM0Ny5maW5kU2lwdHYuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgX3RoaXM0Ny5maW5kU2lwdHYuY2hhbm5lbHMgPSByZXMuZGF0YS5tYXAoZnVuY3Rpb24gKGNoYW5uZWwpIHsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHRleHQ6IGNoYW5uZWwudHZnX25hbWUsCiAgICAgICAgICAgIHZhbHVlOiBjaGFubmVsLnR2Z19pZAogICAgICAgICAgfTsKICAgICAgICB9KTsKICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzNDcuZmluZFRWR0lELmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9KTsKICAgIH0sCiAgICBmaW5kVFZHSURNb2RhbDogZnVuY3Rpb24gZmluZFRWR0lETW9kYWwoc2hvdykgewogICAgICB2YXIgc2F2ZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogZmFsc2U7CiAgICAgIHZhciBzZWxlY3RlZCA9IHRoaXMuZ2V0U3RyZWFtV2l0aElkKHRoaXMuYWN0aXZlU3RyZWFtc1swXSk7CgogICAgICBpZiAoc2hvdykgewogICAgICAgIHRoaXMuZmluZFRWR0lELmNoYW5uZWwgPSAiIjsKICAgICAgICB0aGlzLmZpbmRUVkdJRC50aXRsZSA9IHNlbGVjdGVkLnN0cmVhbV90dmdfbmFtZTsKICAgICAgfQoKICAgICAgdGhpcy5maW5kVFZHSUQuc2VhcmNoID0gIiI7CgogICAgICBpZiAoc2F2ZSkgewogICAgICAgIGlmIChzZWxlY3RlZCkgewogICAgICAgICAgc2VsZWN0ZWQuc3RyZWFtX3R2Z19pZCA9IHRoaXMuZmluZFRWR0lELmNoYW5uZWw7CiAgICAgICAgICBzZWxlY3RlZC5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5maW5kVFZHSUQubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGZpbmRTaXB0dk1vZGFsOiBmdW5jdGlvbiBmaW5kU2lwdHZNb2RhbChzaG93KSB7CiAgICAgIHZhciBzYXZlID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiBmYWxzZTsKICAgICAgdmFyIHNlbGVjdGVkID0gdGhpcy5nZXRTdHJlYW1XaXRoSWQodGhpcy5hY3RpdmVTdHJlYW1zWzBdKTsKCiAgICAgIGlmIChzaG93KSB7CiAgICAgICAgdGhpcy5maW5kU2lwdHYuY2hhbm5lbCA9ICIiOwogICAgICAgIHRoaXMuZmluZFNpcHR2LnRpdGxlID0gc2VsZWN0ZWQuc3RyZWFtX3R2Z19uYW1lOwogICAgICB9CgogICAgICB0aGlzLmZpbmRTaXB0di5zZWFyY2ggPSAiIjsKCiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgaWYgKHNlbGVjdGVkKSB7CiAgICAgICAgICBzZWxlY3RlZC5zdHJlYW1fdHZnX2lkID0gdGhpcy5maW5kU2lwdHYuY2hhbm5lbDsKICAgICAgICAgIHNlbGVjdGVkLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmZpbmRTaXB0di5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgaW1wb3J0TTNVTW9kYWw6IGZ1bmN0aW9uIGltcG9ydE0zVU1vZGFsKHNob3cpIHsKICAgICAgdmFyIF90aGlzNDggPSB0aGlzOwoKICAgICAgdmFyIHNhdmUgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IGZhbHNlOwoKICAgICAgaWYgKHNob3cpIHsKICAgICAgICB0aGlzLmltcG9ydE0zVS5maWxlID0gbnVsbDsKICAgICAgICB0aGlzLmltcG9ydE0zVS5tM3UgPSBudWxsOwogICAgICAgIHRoaXMuaW1wb3J0TTNVLmdyb3VwcyA9IFtdOwogICAgICAgIHRoaXMuaW1wb3J0TTNVLmltcG9ydEdyb3VwcyA9IFtdOwogICAgICB9CgogICAgICBpZiAoc2F2ZSkgewogICAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgICB2YXIgZ3JvdXBJbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleChmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICAgIHJldHVybiBncm91cC5pZCA9PSBfdGhpczQ4LmFjdGl2ZUdyb3VwOwogICAgICAgIH0pOwogICAgICAgIGh0dHBTZXJ2aWNlLnBvc3QoImVkaXRvci9pbXBvcnQiLCB7CiAgICAgICAgICBwbGF5bGlzdF9pZDogdGhpcy5wbGF5bGlzdEVkaXRvci5pZCwKICAgICAgICAgIGltcG9ydDogdGhpcy5pbXBvcnRNM1UuZ3JvdXBzLmZpbHRlcihmdW5jdGlvbiAoZ3JvdXAsIGluZGV4KSB7CiAgICAgICAgICAgIHJldHVybiBfdGhpczQ4LmltcG9ydE0zVS5pbXBvcnRHcm91cHMuaW5jbHVkZXMoaW5kZXgpOwogICAgICAgICAgfSkKICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICAgIF90aGlzNDguaXNMb2FkaW5nID0gZmFsc2U7CgogICAgICAgICAgaWYgKHJlcy5zdGF0dXMpIHsKICAgICAgICAgICAgX3RoaXM0OC5sb2FkUGxheWxpc3QoX3RoaXM0OC5wbGF5bGlzdEVkaXRvci5pZCwgZ3JvdXBJbmRleCk7CiAgICAgICAgICB9CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkgewogICAgICAgICAgX3RoaXM0OC5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgdGhpcy5pbXBvcnRNM1UubW9kYWwgPSBzaG93OwogICAgfSwKICAgIHVwbG9hZE0zVTogZnVuY3Rpb24gdXBsb2FkTTNVKGV2ZW50KSB7CiAgICAgIHZhciBfdGhpczQ5ID0gdGhpczsKCiAgICAgIHZhciBpbnB1dCA9IGV2ZW50LnRhcmdldDsKCiAgICAgIGlmICgiZmlsZXMiIGluIGlucHV0ICYmIGlucHV0LmZpbGVzLmxlbmd0aCA+IDApIHsKICAgICAgICB0aGlzLmltcG9ydE0zVS5pc0xvYWRpbmcgPSB0cnVlOwogICAgICAgIHRoaXMucmVhZEZpbGVDb250ZW50KGlucHV0LmZpbGVzWzBdKS50aGVuKGZ1bmN0aW9uIChjb250ZW50KSB7CiAgICAgICAgICBfdGhpczQ5LmltcG9ydE0zVS5pc0xvYWRpbmcgPSBmYWxzZTsKCiAgICAgICAgICBfdGhpczQ5LnBhcnNlTTNVKGNvbnRlbnQpOwogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewogICAgICAgICAgX3RoaXM0OS4kbm90aWZ5KCJlcnJvciIsIF90aGlzNDkuJHQoInByb2ZpbGUuZmFpbGVkIiksIGVycm9yLCAibGEtdXNlci1zaGllbGQiLCB7CiAgICAgICAgICAgIGR1cmF0aW9uOiA1MDAwLAogICAgICAgICAgICBwZXJtYW5lbnQ6IGZhbHNlCiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIHBhcnNlTTNVOiBmdW5jdGlvbiBwYXJzZU0zVShjb250ZW50KSB7CiAgICAgIHZhciBfdGhpczUwID0gdGhpczsKCiAgICAgIHZhciB2bSA9IHRoaXM7CiAgICAgIHZtLmltcG9ydE0zVS5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBtM3UucGFyc2UoY29udGVudCwgewogICAgICAgIHRhZzogIm5hbWUiLAogICAgICAgIHR5cGU6IFsiTW92aWUiLCAiU2VyaWVzIiwgIlZPRCIsICJMaXZlIl0KICAgICAgfSwgdHJ1ZSkudGhlbihmdW5jdGlvbiAocGxheWxpc3QpIHsKICAgICAgICBfdGhpczUwLmltcG9ydE0zVS5tM3UgPSBwbGF5bGlzdDsKICAgICAgICBfdGhpczUwLmltcG9ydE0zVS5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICBfdGhpczUwLmltcG9ydE0zVS5ncm91cHMgPSBwbGF5bGlzdC5ncm91cHM7CiAgICAgICAgX3RoaXM1MC5pbXBvcnRNM1UuaW1wb3J0R3JvdXBzID0gW107CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewogICAgICAgIHZtLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIHZtLiRub3RpZnkoImVycm9yIiwgdm0uJHQoInByb2ZpbGUuZmFpbGVkIiksIGVycm9yLCAibGEtdXNlci1zaGllbGQiLCB7CiAgICAgICAgICBkdXJhdGlvbjogNTAwMCwKICAgICAgICAgIHBlcm1hbmVudDogZmFsc2UKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LAogICAgcmVhZEZpbGVDb250ZW50OiBmdW5jdGlvbiByZWFkRmlsZUNvbnRlbnQoZmlsZSkgewogICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICByZXR1cm4gcmVzb2x2ZShldmVudC50YXJnZXQucmVzdWx0KTsKICAgICAgICB9OwoKICAgICAgICByZWFkZXIub25lcnJvciA9IGZ1bmN0aW9uIChlcnJvcikgewogICAgICAgICAgcmV0dXJuIHJlamVjdChlcnJvcik7CiAgICAgICAgfTsKCiAgICAgICAgcmVhZGVyLnJlYWRBc1RleHQoZmlsZSk7CiAgICAgIH0pOwogICAgfQogIH0sCiAgYmVmb3JlTW91bnQ6IGZ1bmN0aW9uIGJlZm9yZU1vdW50KCkgewogICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QuYWRkKCJyaWdodC1tZW51Iik7CiAgICBFdmVudEJ1cy4kb24oInNlYXJjaCIsIHRoaXMuc2VhcmNoRWRpdG9yKTsKICAgIEV2ZW50QnVzLiRvbigicHJpbnQiLCB0aGlzLnByaW50RWRpdG9yKTsKICAgIEV2ZW50QnVzLiRvbigidGFiLWNoYW5nZSIsIHRoaXMuZG9UYWJDaGFuZ2UpOwogICAgRXZlbnRCdXMuJG9uKCJzYXZlIiwgdGhpcy5kb1NhdmUpOwogICAgRXZlbnRCdXMuJG9uKCJjYW5jZWwiLCB0aGlzLmRvQ2FuY2VsKTsKCiAgICBpZiAodGhpcy5tb3ZpZVNlcmllUGxheWxpc3QpIHsKICAgICAgdGhpcy5sb2FkUGxheWxpc3QodGhpcy5tb3ZpZVNlcmllUGxheWxpc3QpOwogICAgfQoKICAgIHRoaXMubG9hZExvZ29Db3VudHJpZXMoKTsKICAgIHRoaXMubG9hZFRWR0lEQ291bnRyaWVzKCk7CiAgICB0aGlzLmxvYWRTaXB0dkNvdW50cmllcygpOwogIH0sCiAgYmVmb3JlRGVzdHJveTogZnVuY3Rpb24gYmVmb3JlRGVzdHJveSgpIHsKICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnJlbW92ZSgicmlnaHQtbWVudSIpOwogICAgRXZlbnRCdXMuJG9mZigic2VhcmNoIiwgdGhpcy5zZWFyY2hFZGl0b3IpOwogICAgRXZlbnRCdXMuJG9mZigicHJpbnQiLCB0aGlzLnByaW50RWRpdG9yKTsKICAgIEV2ZW50QnVzLiRvZmYoInRhYi1jaGFuZ2UiLCB0aGlzLmRvVGFiQ2hhbmdlKTsKICAgIEV2ZW50QnVzLiRvZmYoInNhdmUiLCB0aGlzLmRvU2F2ZSk7CiAgICBFdmVudEJ1cy4kb2ZmKCJjYW5jZWwiLCB0aGlzLmRvQ2FuY2VsKTsKICB9LAogIHdhdGNoOiB7CiAgICBkcmFnU3RyZWFtOiBmdW5jdGlvbiBkcmFnU3RyZWFtKHZhbCkgewogICAgICBpZiAoIXZhbCkgewogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICAgIH0KICAgIH0sCiAgICBkcmFnR3JvdXA6IGZ1bmN0aW9uIGRyYWdHcm91cCh2YWwpIHsKICAgICAgaWYgKCF2YWwpIHsKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgICB9CiAgICB9LAogICAgYWN0aXZlR3JvdXA6IGZ1bmN0aW9uIGFjdGl2ZUdyb3VwKHZhbCkgewogICAgICBpZiAodGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkKSB7CiAgICAgICAgdGhpcy5zYXZlQ2hhbmdlc01vZGFsKHRydWUpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMubG9hZFN0cmVhbXMoKTsKICAgICAgfQogICAgfSwKICAgICJwbGF5bGlzdEVkaXRvci5jaGFuZ2VkIjogZnVuY3Rpb24gcGxheWxpc3RFZGl0b3JDaGFuZ2VkKHZhbCkgewogICAgICBFdmVudEJ1cy4kZW1pdCgiZWRpdG9yLWNoYW5nZXMiLCB2YWwpOwogICAgfSwKICAgICJyYWRpb0Jyb3dzZXIuc2VhcmNoIjogZnVuY3Rpb24gcmFkaW9Ccm93c2VyU2VhcmNoKHZhbCkgewogICAgICB2YXIgdm0gPSB0aGlzOwogICAgICBjbGVhclRpbWVvdXQodGhpcy5yYWRpb0Jyb3dzZXIuYm91bmNlKTsKICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuYm91bmNlID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgdm0uZmluZFJhZGlvYnJvd3Nlcih2YWwpOwogICAgICB9LCA1MDApOwogICAgfSwKICAgICJzb3VuZGNsb3VkLnVybCI6IGZ1bmN0aW9uIHNvdW5kY2xvdWRVcmwodmFsKSB7CiAgICAgIHZhciB2bSA9IHRoaXM7CiAgICAgIGNsZWFyVGltZW91dCh0aGlzLnJhZGlvQnJvd3Nlci5ib3VuY2UpOwogICAgICB0aGlzLnJhZGlvQnJvd3Nlci5ib3VuY2UgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICB2bS5nZXRTb3VuZGNsb3VkVHJhY2sodmFsLCB2bS5zb3VuZGNsb3VkQ2xpZW50SWQpOwogICAgICB9LCA1MDApOwogICAgfSwKICAgICJ5b3V0dWJlLnVybCI6IGZ1bmN0aW9uIHlvdXR1YmVVcmwodmFsKSB7CiAgICAgIGlmICghdmFsLmxlbmd0aCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKC95b3V0dVwuP2JlL2kudGVzdCh2YWwpKSB7CiAgICAgICAgdmFyIGk7CiAgICAgICAgdmFyIHBhdHRlcm5zID0gWy95b3V0dVwuYmVcLyhbXiMmP117MTF9KS8sIC8vIHlvdXR1LmJlLzxpZD4KICAgICAgICAvXD92PShbXiMmP117MTF9KS8sIC8vID92PTxpZD4KICAgICAgICAvJnY9KFteIyY/XXsxMX0pLywgLy8gJnY9PGlkPgogICAgICAgIC9lbWJlZFwvKFteIyY/XXsxMX0pLywgLy8gZW1iZWQvPGlkPgogICAgICAgIC9cL3ZcLyhbXiMmP117MTF9KS8gLy8gL3YvPGlkPgogICAgICAgIF07CgogICAgICAgIGZvciAoaSA9IDA7IGkgPCBwYXR0ZXJucy5sZW5ndGg7ICsraSkgewogICAgICAgICAgaWYgKHBhdHRlcm5zW2ldLnRlc3QodmFsKSkgewogICAgICAgICAgICB0aGlzLnlvdXR1YmUudmlkZW9JZCA9IHBhdHRlcm5zW2ldLmV4ZWModmFsKVsxXTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdmFyIHRva2VucyA9IHZhbC5zcGxpdCgvWy8mPz0jLlxzXS9nKTsKCiAgICAgICAgZm9yIChpID0gMDsgaSA8IHRva2Vucy5sZW5ndGg7ICsraSkgewogICAgICAgICAgaWYgKC9eW14jJj9dezExfSQvLnRlc3QodG9rZW5zW2ldKSkgewogICAgICAgICAgICB0aGlzLnlvdXR1YmUudmlkZW9JZCA9IHRva2Vuc1tpXTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdGhpcy55b3V0dWJlLnZpZGVvSWQgPSAiIjsKICAgICAgfSBlbHNlIHsKICAgICAgICB0cnkgewogICAgICAgICAgdmFyIHVybHAgPSBuZXcgVVJMKHZhbCk7CiAgICAgICAgICB0aGlzLnlvdXR1YmUudmlkZW9JZCA9IHVybHAuc2VhcmNoUGFyYW1zLmdldCgidiIpOwogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICB0aGlzLnlvdXR1YmUudmlkZW9JZCA9ICIiOwogICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgICJ5b3V0dWJlLnZpZGVvSWQiOiBmdW5jdGlvbiB5b3V0dWJlVmlkZW9JZCh2YWwpIHsKICAgICAgdmFyIHZtID0gdGhpczsKICAgICAgY2xlYXJUaW1lb3V0KHRoaXMueW91dHViZS5ib3VuY2UpOwogICAgICB0aGlzLnlvdXR1YmUuYm91bmNlID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKHZhbC5sZW5ndGgpIHsKICAgICAgICAgIHZtLmdldFlvdXR1YmVQYWdlKHZhbCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZtLnlvdXR1YmUudmlkZW8gPSBudWxsOwogICAgICAgIH0KICAgICAgfSwgNTAwKTsKICAgIH0sCiAgICAidmltZW8udXJsIjogZnVuY3Rpb24gdmltZW9VcmwodmFsKSB7CiAgICAgIGlmICgvdmltZW9cLmNvbS9pLnRlc3QodmFsKSkgewogICAgICAgIHZhciBtYXRjaCA9IHZhbC5tYXRjaCgvKD86d3d3XC58cGxheWVyXC4pP3ZpbWVvLmNvbVwvKD86Y2hhbm5lbHNcLyg/Olx3K1wvKT98Z3JvdXBzXC8oPzpbXi9dKilcL3ZpZGVvc1wvfGFsYnVtXC8oPzpcZCspXC92aWRlb1wvfHZpZGVvXC98KShcZCspKD86W2EtekEtWjAtOV8tXSspPy9pKTsKCiAgICAgICAgaWYgKG1hdGNoLmxlbmd0aCA+PSAyKSB7CiAgICAgICAgICB0aGlzLnZpbWVvLnZpZGVvSWQgPSBtYXRjaFsxXTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy52aW1lby52aWRlb0lkID0gIiI7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMudmltZW8udmlkZW9JZCA9ICIiOwogICAgICB9CiAgICB9LAogICAgInZpbWVvLnZpZGVvSWQiOiBmdW5jdGlvbiB2aW1lb1ZpZGVvSWQodmFsKSB7CiAgICAgIHZhciB2bSA9IHRoaXM7CiAgICAgIGNsZWFyVGltZW91dCh0aGlzLnZpbWVvLmJvdW5jZSk7CiAgICAgIHRoaXMudmltZW8uYm91bmNlID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKHZhbC5sZW5ndGgpIHsKICAgICAgICAgIHZtLmdldFZpbWVvQ29uZmlnKHZhbCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZtLnZpbWVvLnZpZGVvID0gbnVsbDsKICAgICAgICB9CiAgICAgIH0sIDUwMCk7CiAgICB9LAogICAgImRhaWx5bW90aW9uLnVybCI6IGZ1bmN0aW9uIGRhaWx5bW90aW9uVXJsKHZhbCkgewogICAgICBpZiAoL2RhaWx5bW90aW9uXC5jb20vaS50ZXN0KHZhbCkpIHsKICAgICAgICB2YXIgbWF0Y2ggPSB2YWwubWF0Y2goL14uK2RhaWx5bW90aW9uLmNvbVwvKHZpZGVvfGh1YilcLyhbXl9dKylbXiNdKigjdmlkZW89KFteXyZdKykpPy9pKTsKCiAgICAgICAgaWYgKG1hdGNoLmxlbmd0aCA+PSA0ICYmIG1hdGNoWzRdKSB7CiAgICAgICAgICB0aGlzLmRhaWx5bW90aW9uLnZpZGVvSWQgPSBtYXRjaFs0XTsKICAgICAgICB9IGVsc2UgaWYgKG1hdGNoLmxlbmd0aCA+PSAyKSB7CiAgICAgICAgICB0aGlzLmRhaWx5bW90aW9uLnZpZGVvSWQgPSBtYXRjaFsyXTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5kYWlseW1vdGlvbi52aWRlb0lkID0gIiI7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZGFpbHltb3Rpb24udmlkZW9JZCA9ICIiOwogICAgICB9CiAgICB9LAogICAgImRhaWx5bW90aW9uLnZpZGVvSWQiOiBmdW5jdGlvbiBkYWlseW1vdGlvblZpZGVvSWQodmFsKSB7CiAgICAgIHZhciB2bSA9IHRoaXM7CiAgICAgIGNsZWFyVGltZW91dCh0aGlzLmRhaWx5bW90aW9uLmJvdW5jZSk7CiAgICAgIHRoaXMuZGFpbHltb3Rpb24uYm91bmNlID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKHZhbC5sZW5ndGgpIHsKICAgICAgICAgIHZtLmdldERhaWx5bW90aW9uQ29uZmlnKHZhbCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZtLmRhaWx5bW90aW9uLnZpZGVvID0gbnVsbDsKICAgICAgICB9CiAgICAgIH0sIDUwMCk7CiAgICB9LAogICAgInRlZFRhbGtzLnVybCI6IGZ1bmN0aW9uIHRlZFRhbGtzVXJsKHZhbCkgewogICAgICBpZiAoL3RlZFwuY29tXC90YWxrcy9pLnRlc3QodmFsKSkgewogICAgICAgIHZhciB2bSA9IHRoaXM7CiAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMudGVkVGFsa3MuYm91bmNlKTsKICAgICAgICB0aGlzLnRlZFRhbGtzLmJvdW5jZSA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKHZhbC5sZW5ndGgpIHsKICAgICAgICAgICAgdm0uZ2V0VGVkVGFsa3NDb25maWcodmFsKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZtLnRlZFRhbGtzLnZpZGVvID0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICB9LCA1MDApOwogICAgICB9CiAgICB9LAogICAgInhoYW1zdGVyLnVybCI6IGZ1bmN0aW9uIHhoYW1zdGVyVXJsKHZhbCkgewogICAgICB2YXIgdm0gPSB0aGlzOwoKICAgICAgaWYgKC94aGFtc3RlclwuY29tXC92aWRlb3MvaS50ZXN0KHZhbCkpIHsKICAgICAgICBjbGVhclRpbWVvdXQodGhpcy54aGFtc3RlckJvdW5jZSk7CiAgICAgICAgdGhpcy54aGFtc3RlckJvdW5jZSA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKHZhbC5sZW5ndGgpIHsKICAgICAgICAgICAgdm0uZ2V0WGhhbXN0ZXJDb25maWcodmFsKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZtLnhoYW1zdGVyLnZpZGVvID0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICB9LCA1MDApOwogICAgICB9CiAgICB9LAogICAgImZpbmRMb2dvLmNvdW50cnkiOiBmdW5jdGlvbiBmaW5kTG9nb0NvdW50cnkodmFsKSB7CiAgICAgIGlmICh2YWwubGVuZ3RoKSB7CiAgICAgICAgdGhpcy5sb2FkTG9nb3NGaW5kKHZhbCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5maW5kTG9nby5sb2dvID0gIiI7CiAgICAgIH0KICAgIH0sCiAgICAiYXNzaWduTG9nby5jb3VudHJ5IjogZnVuY3Rpb24gYXNzaWduTG9nb0NvdW50cnkodmFsKSB7CiAgICAgIGlmICh2YWwubGVuZ3RoKSB7CiAgICAgICAgdGhpcy5sb2FkTG9nb3NBc3NpZ24odmFsKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmFzc2lnbkxvZ28ubG9nbyA9ICIiOwogICAgICB9CiAgICB9LAogICAgImZpbmRUVkdJRC5jb3VudHJ5IjogZnVuY3Rpb24gZmluZFRWR0lEQ291bnRyeSh2YWwpIHsKICAgICAgaWYgKHZhbC5sZW5ndGgpIHsKICAgICAgICB0aGlzLmxvYWRUVkdJREZpbmQodmFsKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmZpbmRUVkdJRC5jaGFubmVsID0gIiI7CiAgICAgIH0KICAgIH0sCiAgICAiZmluZFNpcHR2LmNvdW50cnkiOiBmdW5jdGlvbiBmaW5kU2lwdHZDb3VudHJ5KHZhbCkgewogICAgICBpZiAodmFsLmxlbmd0aCkgewogICAgICAgIHRoaXMubG9hZFNpcHR2RmluZCh2YWwpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZmluZFNpcHR2LmNoYW5uZWwgPSAiIjsKICAgICAgfQogICAgfSwKICAgICJhc3NpZ25UVkdJRC5jb3VudHJ5IjogZnVuY3Rpb24gYXNzaWduVFZHSURDb3VudHJ5KHZhbCkgewogICAgICBpZiAodmFsLmxlbmd0aCkgewogICAgICAgIHRoaXMubG9hZFRWR0lEQXNzaWduKHZhbCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5hc3NpZ25UVkdJRC5jaGFubmVscyA9IFtdOwogICAgICB9CiAgICB9LAogICAgImFzc2lnblNJUFRWLmNvdW50cnkiOiBmdW5jdGlvbiBhc3NpZ25TSVBUVkNvdW50cnkodmFsKSB7CiAgICAgIGlmICh2YWwubGVuZ3RoKSB7CiAgICAgICAgdGhpcy5sb2FkU2lwdHZBc3NpZ24odmFsKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmFzc2lnblRWR0lELmNoYW5uZWxzID0gW107CiAgICAgIH0KICAgIH0sCiAgICBtb3ZpZVNlcmllUGxheWxpc3Q6IGZ1bmN0aW9uIG1vdmllU2VyaWVQbGF5bGlzdCh2YWwpIHsKICAgICAgdGhpcy5sb2FkUGxheWxpc3QodmFsKTsKICAgIH0KICB9Cn07"},null]}