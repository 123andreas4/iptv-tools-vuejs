{"remainingRequest":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/thread-loader/dist/cjs.js!/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/babel-loader/lib/index.js!/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/bootstrap-vue/esm/components/modal/modal.js","dependencies":[{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/bootstrap-vue/esm/components/modal/modal.js","mtime":499162500000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/babel-loader/lib/index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmtleXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zeW1ib2wuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5maWx0ZXIuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuZ2V0LW93bi1wcm9wZXJ0eS1kZXNjcmlwdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5mb3ItZWFjaC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5nZXQtb3duLXByb3BlcnR5LWRlc2NyaXB0b3JzLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnRyaW0uanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5qb2luLmpzIjsKCmZ1bmN0aW9uIG93bktleXMob2JqZWN0LCBlbnVtZXJhYmxlT25seSkgewogIHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqZWN0KTsKCiAgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsKICAgIHZhciBzeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmplY3QpOwogICAgaWYgKGVudW1lcmFibGVPbmx5KSBzeW1ib2xzID0gc3ltYm9scy5maWx0ZXIoZnVuY3Rpb24gKHN5bSkgewogICAgICByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHN5bSkuZW51bWVyYWJsZTsKICAgIH0pOwogICAga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOwogIH0KCiAgcmV0dXJuIGtleXM7Cn0KCmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQodGFyZ2V0KSB7CiAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKICAgIHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV0gIT0gbnVsbCA/IGFyZ3VtZW50c1tpXSA6IHt9OwoKICAgIGlmIChpICUgMikgewogICAgICBvd25LZXlzKE9iamVjdChzb3VyY2UpLCB0cnVlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICBfZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsKICAgICAgfSk7CiAgICB9IGVsc2UgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKSB7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMoc291cmNlKSk7CiAgICB9IGVsc2UgewogICAgICBvd25LZXlzKE9iamVjdChzb3VyY2UpKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsKICAgICAgfSk7CiAgICB9CiAgfQoKICByZXR1cm4gdGFyZ2V0Owp9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7CiAgaWYgKGtleSBpbiBvYmopIHsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgewogICAgICB2YWx1ZTogdmFsdWUsCiAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgd3JpdGFibGU6IHRydWUKICAgIH0pOwogIH0gZWxzZSB7CiAgICBvYmpba2V5XSA9IHZhbHVlOwogIH0KCiAgcmV0dXJuIG9iajsKfQoKaW1wb3J0IHsgQ09NUE9ORU5UX1VJRF9LRVksIFZ1ZSB9IGZyb20gJy4uLy4uL3Z1ZSc7CmltcG9ydCB7IE5BTUVfTU9EQUwgfSBmcm9tICcuLi8uLi9jb25zdGFudHMvY29tcG9uZW50cyc7CmltcG9ydCB7IElTX0JST1dTRVIgfSBmcm9tICcuLi8uLi9jb25zdGFudHMvZW52JzsKaW1wb3J0IHsgRVZFTlRfTkFNRV9DQU5DRUwsIEVWRU5UX05BTUVfQ0hBTkdFLCBFVkVOVF9OQU1FX0NMT1NFLCBFVkVOVF9OQU1FX0hJRERFTiwgRVZFTlRfTkFNRV9ISURFLCBFVkVOVF9OQU1FX09LLCBFVkVOVF9OQU1FX1NIT1csIEVWRU5UX05BTUVfU0hPV04sIEVWRU5UX05BTUVfVE9HR0xFLCBFVkVOVF9PUFRJT05TX05PX0NBUFRVUkUgfSBmcm9tICcuLi8uLi9jb25zdGFudHMvZXZlbnRzJzsKaW1wb3J0IHsgQ09ERV9FU0MgfSBmcm9tICcuLi8uLi9jb25zdGFudHMva2V5LWNvZGVzJzsKaW1wb3J0IHsgUFJPUF9UWVBFX0FSUkFZX09CSkVDVF9TVFJJTkcsIFBST1BfVFlQRV9BUlJBWV9TVFJJTkcsIFBST1BfVFlQRV9CT09MRUFOLCBQUk9QX1RZUEVfT0JKRUNULCBQUk9QX1RZUEVfU1RSSU5HIH0gZnJvbSAnLi4vLi4vY29uc3RhbnRzL3Byb3BzJzsKaW1wb3J0IHsgSFRNTEVsZW1lbnQgfSBmcm9tICcuLi8uLi9jb25zdGFudHMvc2FmZS10eXBlcyc7CmltcG9ydCB7IFNMT1RfTkFNRV9ERUZBVUxULCBTTE9UX05BTUVfTU9EQUxfQkFDS0RST1AsIFNMT1RfTkFNRV9NT0RBTF9DQU5DRUwsIFNMT1RfTkFNRV9NT0RBTF9GT09URVIsIFNMT1RfTkFNRV9NT0RBTF9IRUFERVIsIFNMT1RfTkFNRV9NT0RBTF9IRUFERVJfQ0xPU0UsIFNMT1RfTkFNRV9NT0RBTF9PSywgU0xPVF9OQU1FX01PREFMX1RJVExFIH0gZnJvbSAnLi4vLi4vY29uc3RhbnRzL3Nsb3RzJzsKaW1wb3J0IHsgYXJyYXlJbmNsdWRlcywgY29uY2F0IH0gZnJvbSAnLi4vLi4vdXRpbHMvYXJyYXknOwppbXBvcnQgeyBhdHRlbXB0Rm9jdXMsIGNsb3Nlc3QsIGNvbnRhaW5zLCBnZXRBY3RpdmVFbGVtZW50IGFzIF9nZXRBY3RpdmVFbGVtZW50LCBnZXRUYWJhYmxlcywgcmVxdWVzdEFGLCBzZWxlY3QgfSBmcm9tICcuLi8uLi91dGlscy9kb20nOwppbXBvcnQgeyBnZXRSb290QWN0aW9uRXZlbnROYW1lLCBnZXRSb290RXZlbnROYW1lLCBldmVudE9uLCBldmVudE9mZiB9IGZyb20gJy4uLy4uL3V0aWxzL2V2ZW50cyc7CmltcG9ydCB7IGh0bWxPclRleHQgfSBmcm9tICcuLi8uLi91dGlscy9odG1sJzsKaW1wb3J0IHsgaWRlbnRpdHkgfSBmcm9tICcuLi8uLi91dGlscy9pZGVudGl0eSc7CmltcG9ydCB7IGlzU3RyaW5nLCBpc1VuZGVmaW5lZE9yTnVsbCB9IGZyb20gJy4uLy4uL3V0aWxzL2luc3BlY3QnOwppbXBvcnQgeyBtYWtlTW9kZWxNaXhpbiB9IGZyb20gJy4uLy4uL3V0aWxzL21vZGVsJzsKaW1wb3J0IHsgc29ydEtleXMgfSBmcm9tICcuLi8uLi91dGlscy9vYmplY3QnOwppbXBvcnQgeyBvYnNlcnZlRG9tIH0gZnJvbSAnLi4vLi4vdXRpbHMvb2JzZXJ2ZS1kb20nOwppbXBvcnQgeyBtYWtlUHJvcCwgbWFrZVByb3BzQ29uZmlndXJhYmxlIH0gZnJvbSAnLi4vLi4vdXRpbHMvcHJvcHMnOwppbXBvcnQgeyBhdHRyc01peGluIH0gZnJvbSAnLi4vLi4vbWl4aW5zL2F0dHJzJzsKaW1wb3J0IHsgaWRNaXhpbiwgcHJvcHMgYXMgaWRQcm9wcyB9IGZyb20gJy4uLy4uL21peGlucy9pZCc7CmltcG9ydCB7IGxpc3Rlbk9uRG9jdW1lbnRNaXhpbiB9IGZyb20gJy4uLy4uL21peGlucy9saXN0ZW4tb24tZG9jdW1lbnQnOwppbXBvcnQgeyBsaXN0ZW5PblJvb3RNaXhpbiB9IGZyb20gJy4uLy4uL21peGlucy9saXN0ZW4tb24tcm9vdCc7CmltcG9ydCB7IGxpc3Rlbk9uV2luZG93TWl4aW4gfSBmcm9tICcuLi8uLi9taXhpbnMvbGlzdGVuLW9uLXdpbmRvdyc7CmltcG9ydCB7IG5vcm1hbGl6ZVNsb3RNaXhpbiB9IGZyb20gJy4uLy4uL21peGlucy9ub3JtYWxpemUtc2xvdCc7CmltcG9ydCB7IHNjb3BlZFN0eWxlTWl4aW4gfSBmcm9tICcuLi8uLi9taXhpbnMvc2NvcGVkLXN0eWxlJzsKaW1wb3J0IHsgQkJ1dHRvbiB9IGZyb20gJy4uL2J1dHRvbi9idXR0b24nOwppbXBvcnQgeyBCQnV0dG9uQ2xvc2UgfSBmcm9tICcuLi9idXR0b24vYnV0dG9uLWNsb3NlJzsKaW1wb3J0IHsgQlZUcmFuc2l0aW9uIH0gZnJvbSAnLi4vdHJhbnNpdGlvbi9idi10cmFuc2l0aW9uJzsKaW1wb3J0IHsgQlZUcmFuc3BvcnRlciB9IGZyb20gJy4uL3RyYW5zcG9ydGVyL3RyYW5zcG9ydGVyJzsKaW1wb3J0IHsgQnZNb2RhbEV2ZW50IH0gZnJvbSAnLi9oZWxwZXJzL2J2LW1vZGFsLWV2ZW50LmNsYXNzJzsKaW1wb3J0IHsgbW9kYWxNYW5hZ2VyIH0gZnJvbSAnLi9oZWxwZXJzL21vZGFsLW1hbmFnZXInOyAvLyAtLS0gQ29uc3RhbnRzIC0tLQoKdmFyIF9tYWtlTW9kZWxNaXhpbiA9IG1ha2VNb2RlbE1peGluKCd2aXNpYmxlJywgewogIHR5cGU6IFBST1BfVFlQRV9CT09MRUFOLAogIGRlZmF1bHRWYWx1ZTogZmFsc2UsCiAgZXZlbnQ6IEVWRU5UX05BTUVfQ0hBTkdFCn0pLAogICAgbW9kZWxNaXhpbiA9IF9tYWtlTW9kZWxNaXhpbi5taXhpbiwKICAgIG1vZGVsUHJvcHMgPSBfbWFrZU1vZGVsTWl4aW4ucHJvcHMsCiAgICBNT0RFTF9QUk9QX05BTUUgPSBfbWFrZU1vZGVsTWl4aW4ucHJvcCwKICAgIE1PREVMX0VWRU5UX05BTUUgPSBfbWFrZU1vZGVsTWl4aW4uZXZlbnQ7Cgp2YXIgVFJJR0dFUl9CQUNLRFJPUCA9ICdiYWNrZHJvcCc7CnZhciBUUklHR0VSX0VTQyA9ICdlc2MnOwp2YXIgVFJJR0dFUl9GT1JDRSA9ICdGT1JDRSc7CnZhciBUUklHR0VSX1RPR0dMRSA9ICd0b2dnbGUnOwp2YXIgQlVUVE9OX0NBTkNFTCA9ICdjYW5jZWwnOyAvLyBUT0RPOiBUaGlzIHNob3VsZCBiZSByZW5hbWVkIHRvICdjbG9zZScKCnZhciBCVVRUT05fQ0xPU0UgPSAnaGVhZGVyY2xvc2UnOwp2YXIgQlVUVE9OX09LID0gJ29rJzsKdmFyIEJVVFRPTlMgPSBbQlVUVE9OX0NBTkNFTCwgQlVUVE9OX0NMT1NFLCBCVVRUT05fT0tdOyAvLyBgT2JzZXJ2ZURvbWAgY29uZmlnIHRvIGRldGVjdCBjaGFuZ2VzIGluIG1vZGFsIGNvbnRlbnQKLy8gc28gdGhhdCB3ZSBjYW4gYWRqdXN0IHRoZSBtb2RhbCBwYWRkaW5nIGlmIG5lZWRlZAoKdmFyIE9CU0VSVkVSX0NPTkZJRyA9IHsKICBzdWJ0cmVlOiB0cnVlLAogIGNoaWxkTGlzdDogdHJ1ZSwKICBjaGFyYWN0ZXJEYXRhOiB0cnVlLAogIGF0dHJpYnV0ZXM6IHRydWUsCiAgYXR0cmlidXRlRmlsdGVyOiBbJ3N0eWxlJywgJ2NsYXNzJ10KfTsgLy8gLS0tIFByb3BzIC0tLQoKZXhwb3J0IHZhciBwcm9wcyA9IG1ha2VQcm9wc0NvbmZpZ3VyYWJsZShzb3J0S2V5cyhfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgaWRQcm9wcyksIG1vZGVsUHJvcHMpLCB7fSwgewogIGFyaWFMYWJlbDogbWFrZVByb3AoUFJPUF9UWVBFX1NUUklORyksCiAgYXV0b0ZvY3VzQnV0dG9uOiBtYWtlUHJvcChQUk9QX1RZUEVfU1RSSU5HLCBudWxsLAogIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgZnVuY3Rpb24gKHZhbHVlKSB7CiAgICByZXR1cm4gaXNVbmRlZmluZWRPck51bGwodmFsdWUpIHx8IGFycmF5SW5jbHVkZXMoQlVUVE9OUywgdmFsdWUpOwogIH0pLAogIGJvZHlCZ1ZhcmlhbnQ6IG1ha2VQcm9wKFBST1BfVFlQRV9TVFJJTkcpLAogIGJvZHlDbGFzczogbWFrZVByb3AoUFJPUF9UWVBFX0FSUkFZX09CSkVDVF9TVFJJTkcpLAogIGJvZHlUZXh0VmFyaWFudDogbWFrZVByb3AoUFJPUF9UWVBFX1NUUklORyksCiAgYnVzeTogbWFrZVByb3AoUFJPUF9UWVBFX0JPT0xFQU4sIGZhbHNlKSwKICBidXR0b25TaXplOiBtYWtlUHJvcChQUk9QX1RZUEVfU1RSSU5HKSwKICBjYW5jZWxEaXNhYmxlZDogbWFrZVByb3AoUFJPUF9UWVBFX0JPT0xFQU4sIGZhbHNlKSwKICBjYW5jZWxUaXRsZTogbWFrZVByb3AoUFJPUF9UWVBFX1NUUklORywgJ0NhbmNlbCcpLAogIGNhbmNlbFRpdGxlSHRtbDogbWFrZVByb3AoUFJPUF9UWVBFX1NUUklORyksCiAgY2FuY2VsVmFyaWFudDogbWFrZVByb3AoUFJPUF9UWVBFX1NUUklORywgJ3NlY29uZGFyeScpLAogIGNlbnRlcmVkOiBtYWtlUHJvcChQUk9QX1RZUEVfQk9PTEVBTiwgZmFsc2UpLAogIGNvbnRlbnRDbGFzczogbWFrZVByb3AoUFJPUF9UWVBFX0FSUkFZX09CSkVDVF9TVFJJTkcpLAogIGRpYWxvZ0NsYXNzOiBtYWtlUHJvcChQUk9QX1RZUEVfQVJSQVlfT0JKRUNUX1NUUklORyksCiAgZm9vdGVyQmdWYXJpYW50OiBtYWtlUHJvcChQUk9QX1RZUEVfU1RSSU5HKSwKICBmb290ZXJCb3JkZXJWYXJpYW50OiBtYWtlUHJvcChQUk9QX1RZUEVfU1RSSU5HKSwKICBmb290ZXJDbGFzczogbWFrZVByb3AoUFJPUF9UWVBFX0FSUkFZX09CSkVDVF9TVFJJTkcpLAogIGZvb3RlclRleHRWYXJpYW50OiBtYWtlUHJvcChQUk9QX1RZUEVfU1RSSU5HKSwKICBoZWFkZXJCZ1ZhcmlhbnQ6IG1ha2VQcm9wKFBST1BfVFlQRV9TVFJJTkcpLAogIGhlYWRlckJvcmRlclZhcmlhbnQ6IG1ha2VQcm9wKFBST1BfVFlQRV9TVFJJTkcpLAogIGhlYWRlckNsYXNzOiBtYWtlUHJvcChQUk9QX1RZUEVfQVJSQVlfT0JKRUNUX1NUUklORyksCiAgaGVhZGVyQ2xvc2VDb250ZW50OiBtYWtlUHJvcChQUk9QX1RZUEVfU1RSSU5HLCAnJnRpbWVzOycpLAogIGhlYWRlckNsb3NlTGFiZWw6IG1ha2VQcm9wKFBST1BfVFlQRV9TVFJJTkcsICdDbG9zZScpLAogIGhlYWRlckNsb3NlVmFyaWFudDogbWFrZVByb3AoUFJPUF9UWVBFX1NUUklORyksCiAgaGVhZGVyVGV4dFZhcmlhbnQ6IG1ha2VQcm9wKFBST1BfVFlQRV9TVFJJTkcpLAogIC8vIFRPRE86IFJlbmFtZSB0byBgbm9CYWNrZHJvcGAgYW5kIGRlcHJlY2F0ZSBgaGlkZUJhY2tkcm9wYAogIGhpZGVCYWNrZHJvcDogbWFrZVByb3AoUFJPUF9UWVBFX0JPT0xFQU4sIGZhbHNlKSwKICAvLyBUT0RPOiBSZW5hbWUgdG8gYG5vRm9vdGVyYCBhbmQgZGVwcmVjYXRlIGBoaWRlRm9vdGVyYAogIGhpZGVGb290ZXI6IG1ha2VQcm9wKFBST1BfVFlQRV9CT09MRUFOLCBmYWxzZSksCiAgLy8gVE9ETzogUmVuYW1lIHRvIGBub0hlYWRlcmAgYW5kIGRlcHJlY2F0ZSBgaGlkZUhlYWRlcmAKICBoaWRlSGVhZGVyOiBtYWtlUHJvcChQUk9QX1RZUEVfQk9PTEVBTiwgZmFsc2UpLAogIC8vIFRPRE86IFJlbmFtZSB0byBgbm9IZWFkZXJDbG9zZWAgYW5kIGRlcHJlY2F0ZSBgaGlkZUhlYWRlckNsb3NlYAogIGhpZGVIZWFkZXJDbG9zZTogbWFrZVByb3AoUFJPUF9UWVBFX0JPT0xFQU4sIGZhbHNlKSwKICBpZ25vcmVFbmZvcmNlRm9jdXNTZWxlY3RvcjogbWFrZVByb3AoUFJPUF9UWVBFX0FSUkFZX1NUUklORyksCiAgbGF6eTogbWFrZVByb3AoUFJPUF9UWVBFX0JPT0xFQU4sIGZhbHNlKSwKICBtb2RhbENsYXNzOiBtYWtlUHJvcChQUk9QX1RZUEVfQVJSQVlfT0JKRUNUX1NUUklORyksCiAgbm9DbG9zZU9uQmFja2Ryb3A6IG1ha2VQcm9wKFBST1BfVFlQRV9CT09MRUFOLCBmYWxzZSksCiAgbm9DbG9zZU9uRXNjOiBtYWtlUHJvcChQUk9QX1RZUEVfQk9PTEVBTiwgZmFsc2UpLAogIG5vRW5mb3JjZUZvY3VzOiBtYWtlUHJvcChQUk9QX1RZUEVfQk9PTEVBTiwgZmFsc2UpLAogIG5vRmFkZTogbWFrZVByb3AoUFJPUF9UWVBFX0JPT0xFQU4sIGZhbHNlKSwKICBub1N0YWNraW5nOiBtYWtlUHJvcChQUk9QX1RZUEVfQk9PTEVBTiwgZmFsc2UpLAogIG9rRGlzYWJsZWQ6IG1ha2VQcm9wKFBST1BfVFlQRV9CT09MRUFOLCBmYWxzZSksCiAgb2tPbmx5OiBtYWtlUHJvcChQUk9QX1RZUEVfQk9PTEVBTiwgZmFsc2UpLAogIG9rVGl0bGU6IG1ha2VQcm9wKFBST1BfVFlQRV9TVFJJTkcsICdPSycpLAogIG9rVGl0bGVIdG1sOiBtYWtlUHJvcChQUk9QX1RZUEVfU1RSSU5HKSwKICBva1ZhcmlhbnQ6IG1ha2VQcm9wKFBST1BfVFlQRV9TVFJJTkcsICdwcmltYXJ5JyksCiAgLy8gSFRNTCBFbGVtZW50LCBDU1Mgc2VsZWN0b3Igc3RyaW5nIG9yIFZ1ZSBjb21wb25lbnQgaW5zdGFuY2UKICByZXR1cm5Gb2N1czogbWFrZVByb3AoW0hUTUxFbGVtZW50LCBQUk9QX1RZUEVfT0JKRUNULCBQUk9QX1RZUEVfU1RSSU5HXSksCiAgc2Nyb2xsYWJsZTogbWFrZVByb3AoUFJPUF9UWVBFX0JPT0xFQU4sIGZhbHNlKSwKICBzaXplOiBtYWtlUHJvcChQUk9QX1RZUEVfU1RSSU5HLCAnbWQnKSwKICBzdGF0aWM6IG1ha2VQcm9wKFBST1BfVFlQRV9CT09MRUFOLCBmYWxzZSksCiAgdGl0bGU6IG1ha2VQcm9wKFBST1BfVFlQRV9TVFJJTkcpLAogIHRpdGxlQ2xhc3M6IG1ha2VQcm9wKFBST1BfVFlQRV9BUlJBWV9PQkpFQ1RfU1RSSU5HKSwKICB0aXRsZUh0bWw6IG1ha2VQcm9wKFBST1BfVFlQRV9TVFJJTkcpLAogIHRpdGxlU3JPbmx5OiBtYWtlUHJvcChQUk9QX1RZUEVfQk9PTEVBTiwgZmFsc2UpLAogIHRpdGxlVGFnOiBtYWtlUHJvcChQUk9QX1RZUEVfU1RSSU5HLCAnaDUnKQp9KSksIE5BTUVfTU9EQUwpOyAvLyAtLS0gTWFpbiBjb21wb25lbnQgLS0tCi8vIEB2dWUvY29tcG9uZW50CgpleHBvcnQgdmFyIEJNb2RhbCA9IC8qI19fUFVSRV9fKi9WdWUuZXh0ZW5kKHsKICBuYW1lOiBOQU1FX01PREFMLAogIG1peGluczogW2F0dHJzTWl4aW4sIGlkTWl4aW4sIG1vZGVsTWl4aW4sIGxpc3Rlbk9uRG9jdW1lbnRNaXhpbiwgbGlzdGVuT25Sb290TWl4aW4sIGxpc3Rlbk9uV2luZG93TWl4aW4sIG5vcm1hbGl6ZVNsb3RNaXhpbiwgc2NvcGVkU3R5bGVNaXhpbl0sCiAgaW5oZXJpdEF0dHJzOiBmYWxzZSwKICBwcm9wczogcHJvcHMsCiAgZGF0YTogZnVuY3Rpb24gZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGlzSGlkZGVuOiB0cnVlLAogICAgICAvLyBJZiBtb2RhbCBzaG91bGQgbm90IGJlIGluIGRvY3VtZW50CiAgICAgIGlzVmlzaWJsZTogZmFsc2UsCiAgICAgIC8vIENvbnRyb2xzIG1vZGFsIHZpc2libGUgc3RhdGUKICAgICAgaXNUcmFuc2l0aW9uaW5nOiBmYWxzZSwKICAgICAgLy8gVXNlZCBmb3Igc3R5bGUgY29udHJvbAogICAgICBpc1Nob3c6IGZhbHNlLAogICAgICAvLyBVc2VkIGZvciBzdHlsZSBjb250cm9sCiAgICAgIGlzQmxvY2s6IGZhbHNlLAogICAgICAvLyBVc2VkIGZvciBzdHlsZSBjb250cm9sCiAgICAgIGlzT3BlbmluZzogZmFsc2UsCiAgICAgIC8vIFRvIHNpZ25hbCB0aGF0IHRoZSBtb2RhbCBpcyBpbiB0aGUgcHJvY2VzcyBvZiBvcGVuaW5nCiAgICAgIGlzQ2xvc2luZzogZmFsc2UsCiAgICAgIC8vIFRvIHNpZ25hbCB0aGF0IHRoZSBtb2RhbCBpcyBpbiB0aGUgcHJvY2VzcyBvZiBjbG9zaW5nCiAgICAgIGlnbm9yZUJhY2tkcm9wQ2xpY2s6IGZhbHNlLAogICAgICAvLyBVc2VkIHRvIHNpZ25pZnkgaWYgY2xpY2sgb3V0IGxpc3RlbmVyIHNob3VsZCBpZ25vcmUgdGhlIGNsaWNrCiAgICAgIGlzTW9kYWxPdmVyZmxvd2luZzogZmFsc2UsCiAgICAgIC8vIFRoZSBmb2xsb3dpbmcgaXRlbXMgYXJlIGNvbnRyb2xsZWQgYnkgdGhlIG1vZGFsTWFuYWdlciBpbnN0YW5jZQogICAgICBzY3JvbGxiYXJXaWR0aDogMCwKICAgICAgekluZGV4OiBtb2RhbE1hbmFnZXIuZ2V0QmFzZVpJbmRleCgpLAogICAgICBpc1RvcDogdHJ1ZSwKICAgICAgaXNCb2R5T3ZlcmZsb3dpbmc6IGZhbHNlCiAgICB9OwogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIG1vZGFsSWQ6IGZ1bmN0aW9uIG1vZGFsSWQoKSB7CiAgICAgIHJldHVybiB0aGlzLnNhZmVJZCgpOwogICAgfSwKICAgIG1vZGFsT3V0ZXJJZDogZnVuY3Rpb24gbW9kYWxPdXRlcklkKCkgewogICAgICByZXR1cm4gdGhpcy5zYWZlSWQoJ19fQlZfbW9kYWxfb3V0ZXJfJyk7CiAgICB9LAogICAgbW9kYWxIZWFkZXJJZDogZnVuY3Rpb24gbW9kYWxIZWFkZXJJZCgpIHsKICAgICAgcmV0dXJuIHRoaXMuc2FmZUlkKCdfX0JWX21vZGFsX2hlYWRlcl8nKTsKICAgIH0sCiAgICBtb2RhbEJvZHlJZDogZnVuY3Rpb24gbW9kYWxCb2R5SWQoKSB7CiAgICAgIHJldHVybiB0aGlzLnNhZmVJZCgnX19CVl9tb2RhbF9ib2R5XycpOwogICAgfSwKICAgIG1vZGFsVGl0bGVJZDogZnVuY3Rpb24gbW9kYWxUaXRsZUlkKCkgewogICAgICByZXR1cm4gdGhpcy5zYWZlSWQoJ19fQlZfbW9kYWxfdGl0bGVfJyk7CiAgICB9LAogICAgbW9kYWxDb250ZW50SWQ6IGZ1bmN0aW9uIG1vZGFsQ29udGVudElkKCkgewogICAgICByZXR1cm4gdGhpcy5zYWZlSWQoJ19fQlZfbW9kYWxfY29udGVudF8nKTsKICAgIH0sCiAgICBtb2RhbEZvb3RlcklkOiBmdW5jdGlvbiBtb2RhbEZvb3RlcklkKCkgewogICAgICByZXR1cm4gdGhpcy5zYWZlSWQoJ19fQlZfbW9kYWxfZm9vdGVyXycpOwogICAgfSwKICAgIG1vZGFsQmFja2Ryb3BJZDogZnVuY3Rpb24gbW9kYWxCYWNrZHJvcElkKCkgewogICAgICByZXR1cm4gdGhpcy5zYWZlSWQoJ19fQlZfbW9kYWxfYmFja2Ryb3BfJyk7CiAgICB9LAogICAgbW9kYWxDbGFzc2VzOiBmdW5jdGlvbiBtb2RhbENsYXNzZXMoKSB7CiAgICAgIHJldHVybiBbewogICAgICAgIGZhZGU6ICF0aGlzLm5vRmFkZSwKICAgICAgICBzaG93OiB0aGlzLmlzU2hvdwogICAgICB9LCB0aGlzLm1vZGFsQ2xhc3NdOwogICAgfSwKICAgIG1vZGFsU3R5bGVzOiBmdW5jdGlvbiBtb2RhbFN0eWxlcygpIHsKICAgICAgdmFyIHNiV2lkdGggPSAiIi5jb25jYXQodGhpcy5zY3JvbGxiYXJXaWR0aCwgInB4Iik7CiAgICAgIHJldHVybiB7CiAgICAgICAgcGFkZGluZ0xlZnQ6ICF0aGlzLmlzQm9keU92ZXJmbG93aW5nICYmIHRoaXMuaXNNb2RhbE92ZXJmbG93aW5nID8gc2JXaWR0aCA6ICcnLAogICAgICAgIHBhZGRpbmdSaWdodDogdGhpcy5pc0JvZHlPdmVyZmxvd2luZyAmJiAhdGhpcy5pc01vZGFsT3ZlcmZsb3dpbmcgPyBzYldpZHRoIDogJycsCiAgICAgICAgLy8gTmVlZGVkIHRvIGZpeCBpc3N1ZSBodHRwczovL2dpdGh1Yi5jb20vYm9vdHN0cmFwLXZ1ZS9ib290c3RyYXAtdnVlL2lzc3Vlcy8zNDU3CiAgICAgICAgLy8gRXZlbiB0aG91Z2ggd2UgYXJlIHVzaW5nIHYtc2hvdywgd2UgbXVzdCBlbnN1cmUgJ25vbmUnIGlzIHJlc3RvcmVkIGluIHRoZSBzdHlsZXMKICAgICAgICBkaXNwbGF5OiB0aGlzLmlzQmxvY2sgPyAnYmxvY2snIDogJ25vbmUnCiAgICAgIH07CiAgICB9LAogICAgZGlhbG9nQ2xhc3NlczogZnVuY3Rpb24gZGlhbG9nQ2xhc3NlcygpIHsKICAgICAgdmFyIF9yZWY7CgogICAgICByZXR1cm4gWyhfcmVmID0ge30sIF9kZWZpbmVQcm9wZXJ0eShfcmVmLCAibW9kYWwtIi5jb25jYXQodGhpcy5zaXplKSwgdGhpcy5zaXplKSwgX2RlZmluZVByb3BlcnR5KF9yZWYsICdtb2RhbC1kaWFsb2ctY2VudGVyZWQnLCB0aGlzLmNlbnRlcmVkKSwgX2RlZmluZVByb3BlcnR5KF9yZWYsICdtb2RhbC1kaWFsb2ctc2Nyb2xsYWJsZScsIHRoaXMuc2Nyb2xsYWJsZSksIF9yZWYpLCB0aGlzLmRpYWxvZ0NsYXNzXTsKICAgIH0sCiAgICBoZWFkZXJDbGFzc2VzOiBmdW5jdGlvbiBoZWFkZXJDbGFzc2VzKCkgewogICAgICB2YXIgX3JlZjI7CgogICAgICByZXR1cm4gWyhfcmVmMiA9IHt9LCBfZGVmaW5lUHJvcGVydHkoX3JlZjIsICJiZy0iLmNvbmNhdCh0aGlzLmhlYWRlckJnVmFyaWFudCksIHRoaXMuaGVhZGVyQmdWYXJpYW50KSwgX2RlZmluZVByb3BlcnR5KF9yZWYyLCAidGV4dC0iLmNvbmNhdCh0aGlzLmhlYWRlclRleHRWYXJpYW50KSwgdGhpcy5oZWFkZXJUZXh0VmFyaWFudCksIF9kZWZpbmVQcm9wZXJ0eShfcmVmMiwgImJvcmRlci0iLmNvbmNhdCh0aGlzLmhlYWRlckJvcmRlclZhcmlhbnQpLCB0aGlzLmhlYWRlckJvcmRlclZhcmlhbnQpLCBfcmVmMiksIHRoaXMuaGVhZGVyQ2xhc3NdOwogICAgfSwKICAgIHRpdGxlQ2xhc3NlczogZnVuY3Rpb24gdGl0bGVDbGFzc2VzKCkgewogICAgICByZXR1cm4gW3sKICAgICAgICAnc3Itb25seSc6IHRoaXMudGl0bGVTck9ubHkKICAgICAgfSwgdGhpcy50aXRsZUNsYXNzXTsKICAgIH0sCiAgICBib2R5Q2xhc3NlczogZnVuY3Rpb24gYm9keUNsYXNzZXMoKSB7CiAgICAgIHZhciBfcmVmMzsKCiAgICAgIHJldHVybiBbKF9yZWYzID0ge30sIF9kZWZpbmVQcm9wZXJ0eShfcmVmMywgImJnLSIuY29uY2F0KHRoaXMuYm9keUJnVmFyaWFudCksIHRoaXMuYm9keUJnVmFyaWFudCksIF9kZWZpbmVQcm9wZXJ0eShfcmVmMywgInRleHQtIi5jb25jYXQodGhpcy5ib2R5VGV4dFZhcmlhbnQpLCB0aGlzLmJvZHlUZXh0VmFyaWFudCksIF9yZWYzKSwgdGhpcy5ib2R5Q2xhc3NdOwogICAgfSwKICAgIGZvb3RlckNsYXNzZXM6IGZ1bmN0aW9uIGZvb3RlckNsYXNzZXMoKSB7CiAgICAgIHZhciBfcmVmNDsKCiAgICAgIHJldHVybiBbKF9yZWY0ID0ge30sIF9kZWZpbmVQcm9wZXJ0eShfcmVmNCwgImJnLSIuY29uY2F0KHRoaXMuZm9vdGVyQmdWYXJpYW50KSwgdGhpcy5mb290ZXJCZ1ZhcmlhbnQpLCBfZGVmaW5lUHJvcGVydHkoX3JlZjQsICJ0ZXh0LSIuY29uY2F0KHRoaXMuZm9vdGVyVGV4dFZhcmlhbnQpLCB0aGlzLmZvb3RlclRleHRWYXJpYW50KSwgX2RlZmluZVByb3BlcnR5KF9yZWY0LCAiYm9yZGVyLSIuY29uY2F0KHRoaXMuZm9vdGVyQm9yZGVyVmFyaWFudCksIHRoaXMuZm9vdGVyQm9yZGVyVmFyaWFudCksIF9yZWY0KSwgdGhpcy5mb290ZXJDbGFzc107CiAgICB9LAogICAgbW9kYWxPdXRlclN0eWxlOiBmdW5jdGlvbiBtb2RhbE91dGVyU3R5bGUoKSB7CiAgICAgIC8vIFN0eWxlcyBuZWVkZWQgZm9yIHByb3BlciBzdGFja2luZyBvZiBtb2RhbHMKICAgICAgcmV0dXJuIHsKICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJywKICAgICAgICB6SW5kZXg6IHRoaXMuekluZGV4CiAgICAgIH07CiAgICB9LAogICAgc2xvdFNjb3BlOiBmdW5jdGlvbiBzbG90U2NvcGUoKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgY2FuY2VsOiB0aGlzLm9uQ2FuY2VsLAogICAgICAgIGNsb3NlOiB0aGlzLm9uQ2xvc2UsCiAgICAgICAgaGlkZTogdGhpcy5oaWRlLAogICAgICAgIG9rOiB0aGlzLm9uT2ssCiAgICAgICAgdmlzaWJsZTogdGhpcy5pc1Zpc2libGUKICAgICAgfTsKICAgIH0sCiAgICBjb21wdXRlSWdub3JlRW5mb3JjZUZvY3VzU2VsZWN0b3I6IGZ1bmN0aW9uIGNvbXB1dGVJZ25vcmVFbmZvcmNlRm9jdXNTZWxlY3RvcigpIHsKICAgICAgLy8gTm9ybWFsaXplIHRvIGFuIHNpbmdsZSBzZWxlY3RvciB3aXRoIHNlbGVjdG9ycyBzZXBhcmF0ZWQgYnkgYCxgCiAgICAgIHJldHVybiBjb25jYXQodGhpcy5pZ25vcmVFbmZvcmNlRm9jdXNTZWxlY3RvcikuZmlsdGVyKGlkZW50aXR5KS5qb2luKCcsJykudHJpbSgpOwogICAgfSwKICAgIGNvbXB1dGVkQXR0cnM6IGZ1bmN0aW9uIGNvbXB1dGVkQXR0cnMoKSB7CiAgICAgIC8vIElmIHRoZSBwYXJlbnQgaGFzIGEgc2NvcGVkIHN0eWxlIGF0dHJpYnV0ZSwgYW5kIHRoZSBtb2RhbAogICAgICAvLyBpcyBwb3J0YWxsZWQsIGFkZCB0aGUgc2NvcGVkIGF0dHJpYnV0ZSB0byB0aGUgbW9kYWwgd3JhcHBlcgogICAgICB2YXIgc2NvcGVkU3R5bGVBdHRycyA9ICF0aGlzLnN0YXRpYyA/IHRoaXMuc2NvcGVkU3R5bGVBdHRycyA6IHt9OwogICAgICByZXR1cm4gX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIHNjb3BlZFN0eWxlQXR0cnMpLCB0aGlzLmJ2QXR0cnMpLCB7fSwgewogICAgICAgIGlkOiB0aGlzLm1vZGFsT3V0ZXJJZAogICAgICB9KTsKICAgIH0sCiAgICBjb21wdXRlZE1vZGFsQXR0cnM6IGZ1bmN0aW9uIGNvbXB1dGVkTW9kYWxBdHRycygpIHsKICAgICAgdmFyIGlzVmlzaWJsZSA9IHRoaXMuaXNWaXNpYmxlLAogICAgICAgICAgYXJpYUxhYmVsID0gdGhpcy5hcmlhTGFiZWw7CiAgICAgIHJldHVybiB7CiAgICAgICAgaWQ6IHRoaXMubW9kYWxJZCwKICAgICAgICByb2xlOiAnZGlhbG9nJywKICAgICAgICAnYXJpYS1oaWRkZW4nOiBpc1Zpc2libGUgPyBudWxsIDogJ3RydWUnLAogICAgICAgICdhcmlhLW1vZGFsJzogaXNWaXNpYmxlID8gJ3RydWUnIDogbnVsbCwKICAgICAgICAnYXJpYS1sYWJlbCc6IGFyaWFMYWJlbCwKICAgICAgICAnYXJpYS1sYWJlbGxlZGJ5JzogdGhpcy5oaWRlSGVhZGVyIHx8IGFyaWFMYWJlbCB8fCAvLyBUT0RPOiBSZW5hbWUgc2xvdCB0byBgdGl0bGVgIGFuZCBkZXByZWNhdGUgYG1vZGFsLXRpdGxlYAogICAgICAgICEodGhpcy5oYXNOb3JtYWxpemVkU2xvdChTTE9UX05BTUVfTU9EQUxfVElUTEUpIHx8IHRoaXMudGl0bGVIdG1sIHx8IHRoaXMudGl0bGUpID8gbnVsbCA6IHRoaXMubW9kYWxUaXRsZUlkLAogICAgICAgICdhcmlhLWRlc2NyaWJlZGJ5JzogdGhpcy5tb2RhbEJvZHlJZAogICAgICB9OwogICAgfQogIH0sCiAgd2F0Y2g6IF9kZWZpbmVQcm9wZXJ0eSh7fSwgTU9ERUxfUFJPUF9OQU1FLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7CiAgICBpZiAobmV3VmFsdWUgIT09IG9sZFZhbHVlKSB7CiAgICAgIHRoaXNbbmV3VmFsdWUgPyAnc2hvdycgOiAnaGlkZSddKCk7CiAgICB9CiAgfSksCiAgY3JlYXRlZDogZnVuY3Rpb24gY3JlYXRlZCgpIHsKICAgIC8vIERlZmluZSBub24tcmVhY3RpdmUgcHJvcGVydGllcwogICAgdGhpcy4kX29ic2VydmVyID0gbnVsbDsKICAgIHRoaXMuJF9yZXR1cm5Gb2N1cyA9IHRoaXMucmV0dXJuRm9jdXMgfHwgbnVsbDsKICB9LAogIG1vdW50ZWQ6IGZ1bmN0aW9uIG1vdW50ZWQoKSB7CiAgICAvLyBTZXQgaW5pdGlhbCB6LWluZGV4IGFzIHF1ZXJpZWQgZnJvbSB0aGUgRE9NCiAgICB0aGlzLnpJbmRleCA9IG1vZGFsTWFuYWdlci5nZXRCYXNlWkluZGV4KCk7IC8vIExpc3RlbiBmb3IgZXZlbnRzIGZyb20gb3RoZXJzIHRvIGVpdGhlciBvcGVuIG9yIGNsb3NlIG91cnNlbHZlcwogICAgLy8gYW5kIGxpc3RlbiB0byBhbGwgbW9kYWxzIHRvIGVuYWJsZS9kaXNhYmxlIGVuZm9yY2UgZm9jdXMKCiAgICB0aGlzLmxpc3Rlbk9uUm9vdChnZXRSb290QWN0aW9uRXZlbnROYW1lKE5BTUVfTU9EQUwsIEVWRU5UX05BTUVfU0hPVyksIHRoaXMuc2hvd0hhbmRsZXIpOwogICAgdGhpcy5saXN0ZW5PblJvb3QoZ2V0Um9vdEFjdGlvbkV2ZW50TmFtZShOQU1FX01PREFMLCBFVkVOVF9OQU1FX0hJREUpLCB0aGlzLmhpZGVIYW5kbGVyKTsKICAgIHRoaXMubGlzdGVuT25Sb290KGdldFJvb3RBY3Rpb25FdmVudE5hbWUoTkFNRV9NT0RBTCwgRVZFTlRfTkFNRV9UT0dHTEUpLCB0aGlzLnRvZ2dsZUhhbmRsZXIpOyAvLyBMaXN0ZW4gZm9yIGBidjptb2RhbDo6c2hvdyBldmVudHNgLCBhbmQgY2xvc2Ugb3Vyc2VsdmVzIGlmIHRoZQogICAgLy8gb3BlbmluZyBtb2RhbCBub3QgdXMKCiAgICB0aGlzLmxpc3Rlbk9uUm9vdChnZXRSb290RXZlbnROYW1lKE5BTUVfTU9EQUwsIEVWRU5UX05BTUVfU0hPVyksIHRoaXMubW9kYWxMaXN0ZW5lcik7IC8vIEluaXRpYWxseSBzaG93IG1vZGFsPwoKICAgIGlmICh0aGlzW01PREVMX1BST1BfTkFNRV0gPT09IHRydWUpIHsKICAgICAgdGhpcy4kbmV4dFRpY2sodGhpcy5zaG93KTsKICAgIH0KICB9LAogIGJlZm9yZURlc3Ryb3k6IGZ1bmN0aW9uIGJlZm9yZURlc3Ryb3koKSB7CiAgICAvLyBFbnN1cmUgZXZlcnl0aGluZyBpcyBiYWNrIHRvIG5vcm1hbAogICAgdGhpcy5zZXRPYnNlcnZlcihmYWxzZSk7CgogICAgaWYgKHRoaXMuaXNWaXNpYmxlKSB7CiAgICAgIHRoaXMuaXNWaXNpYmxlID0gZmFsc2U7CiAgICAgIHRoaXMuaXNTaG93ID0gZmFsc2U7CiAgICAgIHRoaXMuaXNUcmFuc2l0aW9uaW5nID0gZmFsc2U7CiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICBzZXRPYnNlcnZlcjogZnVuY3Rpb24gc2V0T2JzZXJ2ZXIoKSB7CiAgICAgIHZhciBvbiA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogZmFsc2U7CiAgICAgIHRoaXMuJF9vYnNlcnZlciAmJiB0aGlzLiRfb2JzZXJ2ZXIuZGlzY29ubmVjdCgpOwogICAgICB0aGlzLiRfb2JzZXJ2ZXIgPSBudWxsOwoKICAgICAgaWYgKG9uKSB7CiAgICAgICAgdGhpcy4kX29ic2VydmVyID0gb2JzZXJ2ZURvbSh0aGlzLiRyZWZzLmNvbnRlbnQsIHRoaXMuY2hlY2tNb2RhbE92ZXJmbG93LmJpbmQodGhpcyksIE9CU0VSVkVSX0NPTkZJRyk7CiAgICAgIH0KICAgIH0sCiAgICAvLyBQcml2YXRlIG1ldGhvZCB0byB1cGRhdGUgdGhlIHYtbW9kZWwKICAgIHVwZGF0ZU1vZGVsOiBmdW5jdGlvbiB1cGRhdGVNb2RlbCh2YWx1ZSkgewogICAgICBpZiAodmFsdWUgIT09IHRoaXNbTU9ERUxfUFJPUF9OQU1FXSkgewogICAgICAgIHRoaXMuJGVtaXQoTU9ERUxfRVZFTlRfTkFNRSwgdmFsdWUpOwogICAgICB9CiAgICB9LAogICAgLy8gUHJpdmF0ZSBtZXRob2QgdG8gY3JlYXRlIGEgQnZNb2RhbEV2ZW50IG9iamVjdAogICAgYnVpbGRFdmVudDogZnVuY3Rpb24gYnVpbGRFdmVudCh0eXBlKSB7CiAgICAgIHZhciBvcHRpb25zID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB7fTsKICAgICAgcmV0dXJuIG5ldyBCdk1vZGFsRXZlbnQodHlwZSwgX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHsKICAgICAgICAvLyBEZWZhdWx0IG9wdGlvbnMKICAgICAgICBjYW5jZWxhYmxlOiBmYWxzZSwKICAgICAgICB0YXJnZXQ6IHRoaXMuJHJlZnMubW9kYWwgfHwgdGhpcy4kZWwgfHwgbnVsbCwKICAgICAgICByZWxhdGVkVGFyZ2V0OiBudWxsLAogICAgICAgIHRyaWdnZXI6IG51bGwKICAgICAgfSwgb3B0aW9ucyksIHt9LCB7CiAgICAgICAgLy8gT3B0aW9ucyB0aGF0IGNhbid0IGJlIG92ZXJyaWRkZW4KICAgICAgICB2dWVUYXJnZXQ6IHRoaXMsCiAgICAgICAgY29tcG9uZW50SWQ6IHRoaXMubW9kYWxJZAogICAgICB9KSk7CiAgICB9LAogICAgLy8gUHVibGljIG1ldGhvZCB0byBzaG93IG1vZGFsCiAgICBzaG93OiBmdW5jdGlvbiBzaG93KCkgewogICAgICBpZiAodGhpcy5pc1Zpc2libGUgfHwgdGhpcy5pc09wZW5pbmcpIHsKICAgICAgICAvLyBJZiBhbHJlYWR5IG9wZW4sIG9yIGluIHRoZSBwcm9jZXNzIG9mIG9wZW5pbmcsIGRvIG5vdGhpbmcKCiAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8KICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8KCgogICAgICBpZiAodGhpcy5pc0Nsb3NpbmcpIHsKICAgICAgICAvLyBJZiB3ZSBhcmUgaW4gdGhlIHByb2Nlc3Mgb2YgY2xvc2luZywgd2FpdCB1bnRpbCBoaWRkZW4gYmVmb3JlIHJlLW9wZW5pbmcKCiAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8KICAgICAgICB0aGlzLiRvbmNlKEVWRU5UX05BTUVfSElEREVOLCB0aGlzLnNob3cpOwogICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCgogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy5pc09wZW5pbmcgPSB0cnVlOyAvLyBTZXQgdGhlIGVsZW1lbnQgdG8gcmV0dXJuIGZvY3VzIHRvIHdoZW4gY2xvc2VkCgogICAgICB0aGlzLiRfcmV0dXJuRm9jdXMgPSB0aGlzLiRfcmV0dXJuRm9jdXMgfHwgdGhpcy5nZXRBY3RpdmVFbGVtZW50KCk7CiAgICAgIHZhciBzaG93RXZ0ID0gdGhpcy5idWlsZEV2ZW50KEVWRU5UX05BTUVfU0hPVywgewogICAgICAgIGNhbmNlbGFibGU6IHRydWUKICAgICAgfSk7CiAgICAgIHRoaXMuZW1pdEV2ZW50KHNob3dFdnQpOyAvLyBEb24ndCBzaG93IGlmIGNhbmNlbGVkCgogICAgICBpZiAoc2hvd0V2dC5kZWZhdWx0UHJldmVudGVkIHx8IHRoaXMuaXNWaXNpYmxlKSB7CiAgICAgICAgdGhpcy5pc09wZW5pbmcgPSBmYWxzZTsgLy8gRW5zdXJlIHRoZSB2LW1vZGVsIHJlZmxlY3RzIHRoZSBjdXJyZW50IHN0YXRlCgogICAgICAgIHRoaXMudXBkYXRlTW9kZWwoZmFsc2UpOwogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBTaG93IHRoZSBtb2RhbAoKCiAgICAgIHRoaXMuZG9TaG93KCk7CiAgICB9LAogICAgLy8gUHVibGljIG1ldGhvZCB0byBoaWRlIG1vZGFsCiAgICBoaWRlOiBmdW5jdGlvbiBoaWRlKCkgewogICAgICB2YXIgdHJpZ2dlciA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogJyc7CgogICAgICBpZiAoIXRoaXMuaXNWaXNpYmxlIHx8IHRoaXMuaXNDbG9zaW5nKSB7CiAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8KICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMuaXNDbG9zaW5nID0gdHJ1ZTsKICAgICAgdmFyIGhpZGVFdnQgPSB0aGlzLmJ1aWxkRXZlbnQoRVZFTlRfTkFNRV9ISURFLCB7CiAgICAgICAgY2FuY2VsYWJsZTogdHJpZ2dlciAhPT0gVFJJR0dFUl9GT1JDRSwKICAgICAgICB0cmlnZ2VyOiB0cmlnZ2VyIHx8IG51bGwKICAgICAgfSk7IC8vIFdlIGVtaXQgc3BlY2lmaWMgZXZlbnQgZm9yIG9uZSBvZiB0aGUgdGhyZWUgYnVpbHQtaW4gYnV0dG9ucwoKICAgICAgaWYgKHRyaWdnZXIgPT09IEJVVFRPTl9PSykgewogICAgICAgIHRoaXMuJGVtaXQoRVZFTlRfTkFNRV9PSywgaGlkZUV2dCk7CiAgICAgIH0gZWxzZSBpZiAodHJpZ2dlciA9PT0gQlVUVE9OX0NBTkNFTCkgewogICAgICAgIHRoaXMuJGVtaXQoRVZFTlRfTkFNRV9DQU5DRUwsIGhpZGVFdnQpOwogICAgICB9IGVsc2UgaWYgKHRyaWdnZXIgPT09IEJVVFRPTl9DTE9TRSkgewogICAgICAgIHRoaXMuJGVtaXQoRVZFTlRfTkFNRV9DTE9TRSwgaGlkZUV2dCk7CiAgICAgIH0KCiAgICAgIHRoaXMuZW1pdEV2ZW50KGhpZGVFdnQpOyAvLyBIaWRlIGlmIG5vdCBjYW5jZWxlZAoKICAgICAgaWYgKGhpZGVFdnQuZGVmYXVsdFByZXZlbnRlZCB8fCAhdGhpcy5pc1Zpc2libGUpIHsKICAgICAgICB0aGlzLmlzQ2xvc2luZyA9IGZhbHNlOyAvLyBFbnN1cmUgdi1tb2RlbCByZWZsZWN0cyBjdXJyZW50IHN0YXRlCgogICAgICAgIHRoaXMudXBkYXRlTW9kZWwodHJ1ZSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIFN0b3Agb2JzZXJ2aW5nIGZvciBjb250ZW50IGNoYW5nZXMKCgogICAgICB0aGlzLnNldE9ic2VydmVyKGZhbHNlKTsgLy8gVHJpZ2dlciB0aGUgaGlkZSB0cmFuc2l0aW9uCgogICAgICB0aGlzLmlzVmlzaWJsZSA9IGZhbHNlOyAvLyBVcGRhdGUgdGhlIHYtbW9kZWwKCiAgICAgIHRoaXMudXBkYXRlTW9kZWwoZmFsc2UpOwogICAgfSwKICAgIC8vIFB1YmxpYyBtZXRob2QgdG8gdG9nZ2xlIG1vZGFsIHZpc2liaWxpdHkKICAgIHRvZ2dsZTogZnVuY3Rpb24gdG9nZ2xlKHRyaWdnZXJFbCkgewogICAgICBpZiAodHJpZ2dlckVsKSB7CiAgICAgICAgdGhpcy4kX3JldHVybkZvY3VzID0gdHJpZ2dlckVsOwogICAgICB9CgogICAgICBpZiAodGhpcy5pc1Zpc2libGUpIHsKICAgICAgICB0aGlzLmhpZGUoVFJJR0dFUl9UT0dHTEUpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc2hvdygpOwogICAgICB9CiAgICB9LAogICAgLy8gUHJpdmF0ZSBtZXRob2QgdG8gZ2V0IHRoZSBjdXJyZW50IGRvY3VtZW50IGFjdGl2ZSBlbGVtZW50CiAgICBnZXRBY3RpdmVFbGVtZW50OiBmdW5jdGlvbiBnZXRBY3RpdmVFbGVtZW50KCkgewogICAgICAvLyBSZXR1cm5pbmcgZm9jdXMgdG8gYGRvY3VtZW50LmJvZHlgIG1heSBjYXVzZSB1bndhbnRlZCBzY3JvbGxzLAogICAgICAvLyBzbyB3ZSBleGNsdWRlIHNldHRpbmcgZm9jdXMgb24gYm9keQogICAgICB2YXIgYWN0aXZlRWxlbWVudCA9IF9nZXRBY3RpdmVFbGVtZW50KElTX0JST1dTRVIgPyBbZG9jdW1lbnQuYm9keV0gOiBbXSk7IC8vIFByZXNldCB0aGUgZmFsbGJhY2sgcmV0dXJuIGZvY3VzIHZhbHVlIGlmIGl0IGlzIG5vdCBzZXQKICAgICAgLy8gYGRvY3VtZW50LmFjdGl2ZUVsZW1lbnRgIHNob3VsZCBiZSB0aGUgdHJpZ2dlciBlbGVtZW50IHRoYXQgd2FzIGNsaWNrZWQgb3IKICAgICAgLy8gaW4gdGhlIGNhc2Ugb2YgdXNpbmcgdGhlIHYtbW9kZWwsIHdoaWNoIGV2ZXIgZWxlbWVudCBoYXMgY3VycmVudCBmb2N1cwogICAgICAvLyBXaWxsIGJlIG92ZXJyaWRkZW4gYnkgc29tZSBjb21tYW5kcyBzdWNoIGFzIHRvZ2dsZSwgZXRjLgogICAgICAvLyBOb3RlOiBPbiBJRSAxMSwgYGRvY3VtZW50LmFjdGl2ZUVsZW1lbnRgIG1heSBiZSBgbnVsbGAKICAgICAgLy8gU28gd2UgdGVzdCBpdCBmb3IgdHJ1dGhpbmVzcyBmaXJzdAogICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vYm9vdHN0cmFwLXZ1ZS9ib290c3RyYXAtdnVlL2lzc3Vlcy8zMjA2CgoKICAgICAgcmV0dXJuIGFjdGl2ZUVsZW1lbnQgJiYgYWN0aXZlRWxlbWVudC5mb2N1cyA/IGFjdGl2ZUVsZW1lbnQgOiBudWxsOwogICAgfSwKICAgIC8vIFByaXZhdGUgbWV0aG9kIHRvIGZpbmlzaCBzaG93aW5nIG1vZGFsCiAgICBkb1Nob3c6IGZ1bmN0aW9uIGRvU2hvdygpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQ6IGNvbW1lbnRpbmcgb3V0IGZvciBub3cgdW50aWwgd2UgY2FuIHRlc3Qgc3RhY2tpbmcgKi8KCgogICAgICBpZiAobW9kYWxNYW5hZ2VyLm1vZGFsc0FyZU9wZW4gJiYgdGhpcy5ub1N0YWNraW5nKSB7CiAgICAgICAgLy8gSWYgYW5vdGhlciBtb2RhbChzKSBpcyBhbHJlYWR5IG9wZW4sIHdhaXQgZm9yIGl0KHRoZW0pIHRvIGNsb3NlCiAgICAgICAgdGhpcy5saXN0ZW5PblJvb3RPbmNlKGdldFJvb3RFdmVudE5hbWUoTkFNRV9NT0RBTCwgRVZFTlRfTkFNRV9ISURERU4pLCB0aGlzLmRvU2hvdyk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBtb2RhbE1hbmFnZXIucmVnaXN0ZXJNb2RhbCh0aGlzKTsgLy8gUGxhY2UgbW9kYWwgaW4gRE9NCgogICAgICB0aGlzLmlzSGlkZGVuID0gZmFsc2U7CiAgICAgIHRoaXMuJG5leHRUaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAvLyBXZSBkbyB0aGlzIGluIGAkbmV4dFRpY2soKWAgdG8gZW5zdXJlIHRoZSBtb2RhbCBpcyBpbiBET00gZmlyc3QKICAgICAgICAvLyBiZWZvcmUgd2Ugc2hvdyBpdAogICAgICAgIF90aGlzLmlzVmlzaWJsZSA9IHRydWU7CiAgICAgICAgX3RoaXMuaXNPcGVuaW5nID0gZmFsc2U7IC8vIFVwZGF0ZSB0aGUgdi1tb2RlbAoKICAgICAgICBfdGhpcy51cGRhdGVNb2RlbCh0cnVlKTsKCiAgICAgICAgX3RoaXMuJG5leHRUaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIC8vIE9ic2VydmUgY2hhbmdlcyBpbiBtb2RhbCBjb250ZW50IGFuZCBhZGp1c3QgaWYgbmVjZXNzYXJ5CiAgICAgICAgICAvLyBJbiBhIGAkbmV4dFRpY2soKWAgaW4gY2FzZSBtb2RhbCBjb250ZW50IGlzIGxhenkKICAgICAgICAgIF90aGlzLnNldE9ic2VydmVyKHRydWUpOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0sCiAgICAvLyBUcmFuc2l0aW9uIGhhbmRsZXJzCiAgICBvbkJlZm9yZUVudGVyOiBmdW5jdGlvbiBvbkJlZm9yZUVudGVyKCkgewogICAgICB0aGlzLmlzVHJhbnNpdGlvbmluZyA9IHRydWU7CiAgICAgIHRoaXMuc2V0UmVzaXplRXZlbnQodHJ1ZSk7CiAgICB9LAogICAgb25FbnRlcjogZnVuY3Rpb24gb25FbnRlcigpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICB0aGlzLmlzQmxvY2sgPSB0cnVlOyAvLyBXZSBhZGQgdGhlIGBzaG93YCBjbGFzcyAxIGZyYW1lIGxhdGVyCiAgICAgIC8vIGByZXF1ZXN0QUYoKWAgcnVucyB0aGUgY2FsbGJhY2sgYmVmb3JlIHRoZSBuZXh0IHJlcGFpbnQsIHNvIHdlIG5lZWQKICAgICAgLy8gdHdvIGNhbGxzIHRvIGd1YXJhbnRlZSB0aGUgbmV4dCBmcmFtZSBoYXMgYmVlbiByZW5kZXJlZAoKICAgICAgcmVxdWVzdEFGKGZ1bmN0aW9uICgpIHsKICAgICAgICByZXF1ZXN0QUYoZnVuY3Rpb24gKCkgewogICAgICAgICAgX3RoaXMyLmlzU2hvdyA9IHRydWU7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSwKICAgIG9uQWZ0ZXJFbnRlcjogZnVuY3Rpb24gb25BZnRlckVudGVyKCkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIHRoaXMuY2hlY2tNb2RhbE92ZXJmbG93KCk7CiAgICAgIHRoaXMuaXNUcmFuc2l0aW9uaW5nID0gZmFsc2U7IC8vIFdlIHVzZSBgcmVxdWVzdEFGKClgIHRvIGFsbG93IHRyYW5zaXRpb24gaG9va3MgdG8gY29tcGxldGUKICAgICAgLy8gYmVmb3JlIHBhc3NpbmcgY29udHJvbCBvdmVyIHRvIHRoZSBvdGhlciBoYW5kbGVycwogICAgICAvLyBUaGlzIHdpbGwgYWxsb3cgdXNlcnMgdG8gbm90IGhhdmUgdG8gdXNlIGAkbmV4dFRpY2soKWAgb3IgYHJlcXVlc3RBRigpYAogICAgICAvLyB3aGVuIHRyeWluZyB0byBwcmUtZm9jdXMgYW4gZWxlbWVudAoKICAgICAgcmVxdWVzdEFGKGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczMuZW1pdEV2ZW50KF90aGlzMy5idWlsZEV2ZW50KEVWRU5UX05BTUVfU0hPV04pKTsKCiAgICAgICAgX3RoaXMzLnNldEVuZm9yY2VGb2N1cyh0cnVlKTsKCiAgICAgICAgX3RoaXMzLiRuZXh0VGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAvLyBEZWxheWVkIGluIGEgYCRuZXh0VGljaygpYCB0byBhbGxvdyB1c2VycyB0aW1lIHRvIHByZS1mb2N1cwogICAgICAgICAgLy8gYW4gZWxlbWVudCBpZiB0aGUgd2lzaAogICAgICAgICAgX3RoaXMzLmZvY3VzRmlyc3QoKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LAogICAgb25CZWZvcmVMZWF2ZTogZnVuY3Rpb24gb25CZWZvcmVMZWF2ZSgpIHsKICAgICAgdGhpcy5pc1RyYW5zaXRpb25pbmcgPSB0cnVlOwogICAgICB0aGlzLnNldFJlc2l6ZUV2ZW50KGZhbHNlKTsKICAgICAgdGhpcy5zZXRFbmZvcmNlRm9jdXMoZmFsc2UpOwogICAgfSwKICAgIG9uTGVhdmU6IGZ1bmN0aW9uIG9uTGVhdmUoKSB7CiAgICAgIC8vIFJlbW92ZSB0aGUgJ3Nob3cnIGNsYXNzCiAgICAgIHRoaXMuaXNTaG93ID0gZmFsc2U7CiAgICB9LAogICAgb25BZnRlckxlYXZlOiBmdW5jdGlvbiBvbkFmdGVyTGVhdmUoKSB7CiAgICAgIHZhciBfdGhpczQgPSB0aGlzOwoKICAgICAgdGhpcy5pc0Jsb2NrID0gZmFsc2U7CiAgICAgIHRoaXMuaXNUcmFuc2l0aW9uaW5nID0gZmFsc2U7CiAgICAgIHRoaXMuaXNNb2RhbE92ZXJmbG93aW5nID0gZmFsc2U7CiAgICAgIHRoaXMuaXNIaWRkZW4gPSB0cnVlOwogICAgICB0aGlzLiRuZXh0VGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXM0LmlzQ2xvc2luZyA9IGZhbHNlOwogICAgICAgIG1vZGFsTWFuYWdlci51bnJlZ2lzdGVyTW9kYWwoX3RoaXM0KTsKCiAgICAgICAgX3RoaXM0LnJldHVybkZvY3VzVG8oKTsgLy8gVE9ETzogTmVlZCB0byBmaW5kIGEgd2F5IHRvIHBhc3MgdGhlIGB0cmlnZ2VyYCBwcm9wZXJ0eQogICAgICAgIC8vICAgICAgIHRvIHRoZSBgaGlkZGVuYCBldmVudCwgbm90IGp1c3Qgb25seSB0aGUgYGhpZGVgIGV2ZW50CgoKICAgICAgICBfdGhpczQuZW1pdEV2ZW50KF90aGlzNC5idWlsZEV2ZW50KEVWRU5UX05BTUVfSElEREVOKSk7CiAgICAgIH0pOwogICAgfSwKICAgIGVtaXRFdmVudDogZnVuY3Rpb24gZW1pdEV2ZW50KGJ2RXZlbnQpIHsKICAgICAgdmFyIHR5cGUgPSBidkV2ZW50LnR5cGU7IC8vIFdlIGVtaXQgb24gYCRyb290YCBmaXJzdCBpbiBjYXNlIGEgZ2xvYmFsIGxpc3RlbmVyIHdhbnRzIHRvIGNhbmNlbAogICAgICAvLyB0aGUgZXZlbnQgZmlyc3QgYmVmb3JlIHRoZSBpbnN0YW5jZSBlbWl0cyBpdHMgZXZlbnQKCiAgICAgIHRoaXMuZW1pdE9uUm9vdChnZXRSb290RXZlbnROYW1lKE5BTUVfTU9EQUwsIHR5cGUpLCBidkV2ZW50LCBidkV2ZW50LmNvbXBvbmVudElkKTsKICAgICAgdGhpcy4kZW1pdCh0eXBlLCBidkV2ZW50KTsKICAgIH0sCiAgICAvLyBVSSBldmVudCBoYW5kbGVycwogICAgb25EaWFsb2dNb3VzZWRvd246IGZ1bmN0aW9uIG9uRGlhbG9nTW91c2Vkb3duKCkgewogICAgICB2YXIgX3RoaXM1ID0gdGhpczsgLy8gV2F0Y2ggdG8gc2VlIGlmIHRoZSBtYXRjaGluZyBtb3VzZXVwIGV2ZW50IG9jY3VycyBvdXRzaWRlIHRoZSBkaWFsb2cKICAgICAgLy8gQW5kIGlmIGl0IGRvZXMsIGNhbmNlbCB0aGUgY2xpY2tPdXQgaGFuZGxlcgoKCiAgICAgIHZhciBtb2RhbCA9IHRoaXMuJHJlZnMubW9kYWw7CgogICAgICB2YXIgb25jZU1vZGFsTW91c2V1cCA9IGZ1bmN0aW9uIG9uY2VNb2RhbE1vdXNldXAoZXZlbnQpIHsKICAgICAgICBldmVudE9mZihtb2RhbCwgJ21vdXNldXAnLCBvbmNlTW9kYWxNb3VzZXVwLCBFVkVOVF9PUFRJT05TX05PX0NBUFRVUkUpOwoKICAgICAgICBpZiAoZXZlbnQudGFyZ2V0ID09PSBtb2RhbCkgewogICAgICAgICAgX3RoaXM1Lmlnbm9yZUJhY2tkcm9wQ2xpY2sgPSB0cnVlOwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIGV2ZW50T24obW9kYWwsICdtb3VzZXVwJywgb25jZU1vZGFsTW91c2V1cCwgRVZFTlRfT1BUSU9OU19OT19DQVBUVVJFKTsKICAgIH0sCiAgICBvbkNsaWNrT3V0OiBmdW5jdGlvbiBvbkNsaWNrT3V0KGV2ZW50KSB7CiAgICAgIGlmICh0aGlzLmlnbm9yZUJhY2tkcm9wQ2xpY2spIHsKICAgICAgICAvLyBDbGljayB3YXMgaW5pdGlhdGVkIGluc2lkZSB0aGUgbW9kYWwgY29udGVudCwgYnV0IGZpbmlzaGVkIG91dHNpZGUuCiAgICAgICAgLy8gU2V0IGJ5IHRoZSBhYm92ZSBvbkRpYWxvZ01vdXNlZG93biBoYW5kbGVyCiAgICAgICAgdGhpcy5pZ25vcmVCYWNrZHJvcENsaWNrID0gZmFsc2U7CiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIERvIG5vdGhpbmcgaWYgbm90IHZpc2libGUsIGJhY2tkcm9wIGNsaWNrIGRpc2FibGVkLCBvciBlbGVtZW50CiAgICAgIC8vIHRoYXQgZ2VuZXJhdGVkIGNsaWNrIGV2ZW50IGlzIG5vIGxvbmdlciBpbiBkb2N1bWVudCBib2R5CgoKICAgICAgaWYgKCF0aGlzLmlzVmlzaWJsZSB8fCB0aGlzLm5vQ2xvc2VPbkJhY2tkcm9wIHx8ICFjb250YWlucyhkb2N1bWVudC5ib2R5LCBldmVudC50YXJnZXQpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIElmIGJhY2tkcm9wIGNsaWNrZWQsIGhpZGUgbW9kYWwKCgogICAgICBpZiAoIWNvbnRhaW5zKHRoaXMuJHJlZnMuY29udGVudCwgZXZlbnQudGFyZ2V0KSkgewogICAgICAgIHRoaXMuaGlkZShUUklHR0VSX0JBQ0tEUk9QKTsKICAgICAgfQogICAgfSwKICAgIG9uT2s6IGZ1bmN0aW9uIG9uT2soKSB7CiAgICAgIHRoaXMuaGlkZShCVVRUT05fT0spOwogICAgfSwKICAgIG9uQ2FuY2VsOiBmdW5jdGlvbiBvbkNhbmNlbCgpIHsKICAgICAgdGhpcy5oaWRlKEJVVFRPTl9DQU5DRUwpOwogICAgfSwKICAgIG9uQ2xvc2U6IGZ1bmN0aW9uIG9uQ2xvc2UoKSB7CiAgICAgIHRoaXMuaGlkZShCVVRUT05fQ0xPU0UpOwogICAgfSwKICAgIG9uRXNjOiBmdW5jdGlvbiBvbkVzYyhldmVudCkgewogICAgICAvLyBJZiBFU0MgcHJlc3NlZCwgaGlkZSBtb2RhbAogICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PT0gQ09ERV9FU0MgJiYgdGhpcy5pc1Zpc2libGUgJiYgIXRoaXMubm9DbG9zZU9uRXNjKSB7CiAgICAgICAgdGhpcy5oaWRlKFRSSUdHRVJfRVNDKTsKICAgICAgfQogICAgfSwKICAgIC8vIERvY3VtZW50IGZvY3VzaW4gbGlzdGVuZXIKICAgIGZvY3VzSGFuZGxlcjogZnVuY3Rpb24gZm9jdXNIYW5kbGVyKGV2ZW50KSB7CiAgICAgIC8vIElmIGZvY3VzIGxlYXZlcyBtb2RhbCBjb250ZW50LCBicmluZyBpdCBiYWNrCiAgICAgIHZhciBjb250ZW50ID0gdGhpcy4kcmVmcy5jb250ZW50OwogICAgICB2YXIgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0OwoKICAgICAgaWYgKHRoaXMubm9FbmZvcmNlRm9jdXMgfHwgIXRoaXMuaXNUb3AgfHwgIXRoaXMuaXNWaXNpYmxlIHx8ICFjb250ZW50IHx8IGRvY3VtZW50ID09PSB0YXJnZXQgfHwgY29udGFpbnMoY29udGVudCwgdGFyZ2V0KSB8fCB0aGlzLmNvbXB1dGVJZ25vcmVFbmZvcmNlRm9jdXNTZWxlY3RvciAmJiBjbG9zZXN0KHRoaXMuY29tcHV0ZUlnbm9yZUVuZm9yY2VGb2N1c1NlbGVjdG9yLCB0YXJnZXQsIHRydWUpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgdGFiYWJsZXMgPSBnZXRUYWJhYmxlcyh0aGlzLiRyZWZzLmNvbnRlbnQpOwogICAgICB2YXIgYm90dG9tVHJhcCA9IHRoaXMuJHJlZnNbJ2JvdHRvbS10cmFwJ107CiAgICAgIHZhciB0b3BUcmFwID0gdGhpcy4kcmVmc1sndG9wLXRyYXAnXTsKCiAgICAgIGlmIChib3R0b21UcmFwICYmIHRhcmdldCA9PT0gYm90dG9tVHJhcCkgewogICAgICAgIC8vIElmIHVzZXIgcHJlc3NlZCBUQUIgb3V0IG9mIG1vZGFsIGludG8gb3VyIGJvdHRvbSB0cmFiIHRyYXAgZWxlbWVudAogICAgICAgIC8vIEZpbmQgdGhlIGZpcnN0IHRhYmFibGUgZWxlbWVudCBpbiB0aGUgbW9kYWwgY29udGVudCBhbmQgZm9jdXMgaXQKICAgICAgICBpZiAoYXR0ZW1wdEZvY3VzKHRhYmFibGVzWzBdKSkgewogICAgICAgICAgLy8gRm9jdXMgd2FzIHN1Y2Nlc3NmdWwKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodG9wVHJhcCAmJiB0YXJnZXQgPT09IHRvcFRyYXApIHsKICAgICAgICAvLyBJZiB1c2VyIHByZXNzZWQgQ1RSTC1UQUIgb3V0IG9mIG1vZGFsIGFuZCBpbnRvIG91ciB0b3AgdGFiIHRyYXAgZWxlbWVudAogICAgICAgIC8vIEZpbmQgdGhlIGxhc3QgdGFiYWJsZSBlbGVtZW50IGluIHRoZSBtb2RhbCBjb250ZW50IGFuZCBmb2N1cyBpdAogICAgICAgIGlmIChhdHRlbXB0Rm9jdXModGFiYWJsZXNbdGFiYWJsZXMubGVuZ3RoIC0gMV0pKSB7CiAgICAgICAgICAvLyBGb2N1cyB3YXMgc3VjY2Vzc2Z1bAogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfSAvLyBPdGhlcndpc2UgZm9jdXMgdGhlIG1vZGFsIGNvbnRlbnQgY29udGFpbmVyCgoKICAgICAgYXR0ZW1wdEZvY3VzKGNvbnRlbnQsIHsKICAgICAgICBwcmV2ZW50U2Nyb2xsOiB0cnVlCiAgICAgIH0pOwogICAgfSwKICAgIC8vIFR1cm4gb24vb2ZmIGZvY3VzaW4gbGlzdGVuZXIKICAgIHNldEVuZm9yY2VGb2N1czogZnVuY3Rpb24gc2V0RW5mb3JjZUZvY3VzKG9uKSB7CiAgICAgIHRoaXMubGlzdGVuRG9jdW1lbnQob24sICdmb2N1c2luJywgdGhpcy5mb2N1c0hhbmRsZXIpOwogICAgfSwKICAgIC8vIFJlc2l6ZSBsaXN0ZW5lcgogICAgc2V0UmVzaXplRXZlbnQ6IGZ1bmN0aW9uIHNldFJlc2l6ZUV2ZW50KG9uKSB7CiAgICAgIHRoaXMubGlzdGVuV2luZG93KG9uLCAncmVzaXplJywgdGhpcy5jaGVja01vZGFsT3ZlcmZsb3cpOwogICAgICB0aGlzLmxpc3RlbldpbmRvdyhvbiwgJ29yaWVudGF0aW9uY2hhbmdlJywgdGhpcy5jaGVja01vZGFsT3ZlcmZsb3cpOwogICAgfSwKICAgIC8vIFJvb3QgbGlzdGVuZXIgaGFuZGxlcnMKICAgIHNob3dIYW5kbGVyOiBmdW5jdGlvbiBzaG93SGFuZGxlcihpZCwgdHJpZ2dlckVsKSB7CiAgICAgIGlmIChpZCA9PT0gdGhpcy5tb2RhbElkKSB7CiAgICAgICAgdGhpcy4kX3JldHVybkZvY3VzID0gdHJpZ2dlckVsIHx8IHRoaXMuZ2V0QWN0aXZlRWxlbWVudCgpOwogICAgICAgIHRoaXMuc2hvdygpOwogICAgICB9CiAgICB9LAogICAgaGlkZUhhbmRsZXI6IGZ1bmN0aW9uIGhpZGVIYW5kbGVyKGlkKSB7CiAgICAgIGlmIChpZCA9PT0gdGhpcy5tb2RhbElkKSB7CiAgICAgICAgdGhpcy5oaWRlKCdldmVudCcpOwogICAgICB9CiAgICB9LAogICAgdG9nZ2xlSGFuZGxlcjogZnVuY3Rpb24gdG9nZ2xlSGFuZGxlcihpZCwgdHJpZ2dlckVsKSB7CiAgICAgIGlmIChpZCA9PT0gdGhpcy5tb2RhbElkKSB7CiAgICAgICAgdGhpcy50b2dnbGUodHJpZ2dlckVsKTsKICAgICAgfQogICAgfSwKICAgIG1vZGFsTGlzdGVuZXI6IGZ1bmN0aW9uIG1vZGFsTGlzdGVuZXIoYnZFdmVudCkgewogICAgICAvLyBJZiBhbm90aGVyIG1vZGFsIG9wZW5zLCBjbG9zZSB0aGlzIG9uZSBpZiBzdGFja2luZyBub3QgcGVybWl0dGVkCiAgICAgIGlmICh0aGlzLm5vU3RhY2tpbmcgJiYgYnZFdmVudC52dWVUYXJnZXQgIT09IHRoaXMpIHsKICAgICAgICB0aGlzLmhpZGUoKTsKICAgICAgfQogICAgfSwKICAgIC8vIEZvY3VzIGNvbnRyb2wgaGFuZGxlcnMKICAgIGZvY3VzRmlyc3Q6IGZ1bmN0aW9uIGZvY3VzRmlyc3QoKSB7CiAgICAgIHZhciBfdGhpczYgPSB0aGlzOyAvLyBEb24ndCB0cnkgYW5kIGZvY3VzIGlmIHdlIGFyZSBTU1IKCgogICAgICBpZiAoSVNfQlJPV1NFUikgewogICAgICAgIHJlcXVlc3RBRihmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgbW9kYWwgPSBfdGhpczYuJHJlZnMubW9kYWw7CiAgICAgICAgICB2YXIgY29udGVudCA9IF90aGlzNi4kcmVmcy5jb250ZW50OwoKICAgICAgICAgIHZhciBhY3RpdmVFbGVtZW50ID0gX3RoaXM2LmdldEFjdGl2ZUVsZW1lbnQoKTsgLy8gSWYgdGhlIG1vZGFsIGNvbnRhaW5zIHRoZSBhY3RpdmVFbGVtZW50LCB3ZSBkb24ndCBkbyBhbnl0aGluZwoKCiAgICAgICAgICBpZiAobW9kYWwgJiYgY29udGVudCAmJiAhKGFjdGl2ZUVsZW1lbnQgJiYgY29udGFpbnMoY29udGVudCwgYWN0aXZlRWxlbWVudCkpKSB7CiAgICAgICAgICAgIHZhciBvayA9IF90aGlzNi4kcmVmc1snb2stYnV0dG9uJ107CiAgICAgICAgICAgIHZhciBjYW5jZWwgPSBfdGhpczYuJHJlZnNbJ2NhbmNlbC1idXR0b24nXTsKICAgICAgICAgICAgdmFyIGNsb3NlID0gX3RoaXM2LiRyZWZzWydjbG9zZS1idXR0b24nXTsgLy8gRm9jdXMgdGhlIGFwcHJvcHJpYXRlIGJ1dHRvbiBvciBtb2RhbCBjb250ZW50IHdyYXBwZXIKCiAgICAgICAgICAgIHZhciBhdXRvRm9jdXMgPSBfdGhpczYuYXV0b0ZvY3VzQnV0dG9uOwogICAgICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwoKICAgICAgICAgICAgdmFyIGVsID0gYXV0b0ZvY3VzID09PSBCVVRUT05fT0sgJiYgb2sgPyBvay4kZWwgfHwgb2sgOiBhdXRvRm9jdXMgPT09IEJVVFRPTl9DQU5DRUwgJiYgY2FuY2VsID8gY2FuY2VsLiRlbCB8fCBjYW5jZWwgOiBhdXRvRm9jdXMgPT09IEJVVFRPTl9DTE9TRSAmJiBjbG9zZSA/IGNsb3NlLiRlbCB8fCBjbG9zZSA6IGNvbnRlbnQ7IC8vIEZvY3VzIHRoZSBlbGVtZW50CgogICAgICAgICAgICBhdHRlbXB0Rm9jdXMoZWwpOwoKICAgICAgICAgICAgaWYgKGVsID09PSBjb250ZW50KSB7CiAgICAgICAgICAgICAgLy8gTWFrZSBzdXJlIHRvcCBvZiBtb2RhbCBpcyBzaG93aW5nIChpZiBsb25nZXIgdGhhbiB0aGUgdmlld3BvcnQpCiAgICAgICAgICAgICAgX3RoaXM2LiRuZXh0VGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBtb2RhbC5zY3JvbGxUb3AgPSAwOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICByZXR1cm5Gb2N1c1RvOiBmdW5jdGlvbiByZXR1cm5Gb2N1c1RvKCkgewogICAgICAvLyBQcmVmZXIgYHJldHVybkZvY3VzYCBwcm9wIG92ZXIgZXZlbnQgc3BlY2lmaWVkCiAgICAgIC8vIGByZXR1cm5fZm9jdXNgIHZhbHVlCiAgICAgIHZhciBlbCA9IHRoaXMucmV0dXJuRm9jdXMgfHwgdGhpcy4kX3JldHVybkZvY3VzIHx8IG51bGw7CiAgICAgIHRoaXMuJF9yZXR1cm5Gb2N1cyA9IG51bGw7CiAgICAgIHRoaXMuJG5leHRUaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAvLyBJcyBlbCBhIHN0cmluZyBDU1Mgc2VsZWN0b3I/CiAgICAgICAgZWwgPSBpc1N0cmluZyhlbCkgPyBzZWxlY3QoZWwpIDogZWw7CgogICAgICAgIGlmIChlbCkgewogICAgICAgICAgLy8gUG9zc2libHkgY291bGQgYmUgYSBjb21wb25lbnQgcmVmZXJlbmNlCiAgICAgICAgICBlbCA9IGVsLiRlbCB8fCBlbDsKICAgICAgICAgIGF0dGVtcHRGb2N1cyhlbCk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBjaGVja01vZGFsT3ZlcmZsb3c6IGZ1bmN0aW9uIGNoZWNrTW9kYWxPdmVyZmxvdygpIHsKICAgICAgaWYgKHRoaXMuaXNWaXNpYmxlKSB7CiAgICAgICAgdmFyIG1vZGFsID0gdGhpcy4kcmVmcy5tb2RhbDsKICAgICAgICB0aGlzLmlzTW9kYWxPdmVyZmxvd2luZyA9IG1vZGFsLnNjcm9sbEhlaWdodCA+IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQ7CiAgICAgIH0KICAgIH0sCiAgICBtYWtlTW9kYWw6IGZ1bmN0aW9uIG1ha2VNb2RhbChoKSB7CiAgICAgIC8vIE1vZGFsIGhlYWRlcgogICAgICB2YXIgJGhlYWRlciA9IGgoKTsKCiAgICAgIGlmICghdGhpcy5oaWRlSGVhZGVyKSB7CiAgICAgICAgLy8gVE9ETzogUmVuYW1lIHNsb3QgdG8gYGhlYWRlcmAgYW5kIGRlcHJlY2F0ZSBgbW9kYWwtaGVhZGVyYAogICAgICAgIHZhciAkbW9kYWxIZWFkZXIgPSB0aGlzLm5vcm1hbGl6ZVNsb3QoU0xPVF9OQU1FX01PREFMX0hFQURFUiwgdGhpcy5zbG90U2NvcGUpOwoKICAgICAgICBpZiAoISRtb2RhbEhlYWRlcikgewogICAgICAgICAgdmFyICRjbG9zZUJ1dHRvbiA9IGgoKTsKCiAgICAgICAgICBpZiAoIXRoaXMuaGlkZUhlYWRlckNsb3NlKSB7CiAgICAgICAgICAgICRjbG9zZUJ1dHRvbiA9IGgoQkJ1dHRvbkNsb3NlLCB7CiAgICAgICAgICAgICAgcHJvcHM6IHsKICAgICAgICAgICAgICAgIGNvbnRlbnQ6IHRoaXMuaGVhZGVyQ2xvc2VDb250ZW50LAogICAgICAgICAgICAgICAgZGlzYWJsZWQ6IHRoaXMuaXNUcmFuc2l0aW9uaW5nLAogICAgICAgICAgICAgICAgYXJpYUxhYmVsOiB0aGlzLmhlYWRlckNsb3NlTGFiZWwsCiAgICAgICAgICAgICAgICB0ZXh0VmFyaWFudDogdGhpcy5oZWFkZXJDbG9zZVZhcmlhbnQgfHwgdGhpcy5oZWFkZXJUZXh0VmFyaWFudAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgb246IHsKICAgICAgICAgICAgICAgIGNsaWNrOiB0aGlzLm9uQ2xvc2UKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHJlZjogJ2Nsb3NlLWJ1dHRvbicKICAgICAgICAgICAgfSwgLy8gVE9ETzogUmVuYW1lIHNsb3QgdG8gYGhlYWRlci1jbG9zZWAgYW5kIGRlcHJlY2F0ZSBgbW9kYWwtaGVhZGVyLWNsb3NlYAogICAgICAgICAgICBbdGhpcy5ub3JtYWxpemVTbG90KFNMT1RfTkFNRV9NT0RBTF9IRUFERVJfQ0xPU0UpXSk7CiAgICAgICAgICB9CgogICAgICAgICAgJG1vZGFsSGVhZGVyID0gW2godGhpcy50aXRsZVRhZywgewogICAgICAgICAgICBzdGF0aWNDbGFzczogJ21vZGFsLXRpdGxlJywKICAgICAgICAgICAgY2xhc3M6IHRoaXMudGl0bGVDbGFzc2VzLAogICAgICAgICAgICBhdHRyczogewogICAgICAgICAgICAgIGlkOiB0aGlzLm1vZGFsVGl0bGVJZAogICAgICAgICAgICB9LAogICAgICAgICAgICAvLyBUT0RPOiBSZW5hbWUgc2xvdCB0byBgdGl0bGVgIGFuZCBkZXByZWNhdGUgYG1vZGFsLXRpdGxlYAogICAgICAgICAgICBkb21Qcm9wczogdGhpcy5oYXNOb3JtYWxpemVkU2xvdChTTE9UX05BTUVfTU9EQUxfVElUTEUpID8ge30gOiBodG1sT3JUZXh0KHRoaXMudGl0bGVIdG1sLCB0aGlzLnRpdGxlKQogICAgICAgICAgfSwgLy8gVE9ETzogUmVuYW1lIHNsb3QgdG8gYHRpdGxlYCBhbmQgZGVwcmVjYXRlIGBtb2RhbC10aXRsZWAKICAgICAgICAgIHRoaXMubm9ybWFsaXplU2xvdChTTE9UX05BTUVfTU9EQUxfVElUTEUsIHRoaXMuc2xvdFNjb3BlKSksICRjbG9zZUJ1dHRvbl07CiAgICAgICAgfQoKICAgICAgICAkaGVhZGVyID0gaCgnaGVhZGVyJywgewogICAgICAgICAgc3RhdGljQ2xhc3M6ICdtb2RhbC1oZWFkZXInLAogICAgICAgICAgY2xhc3M6IHRoaXMuaGVhZGVyQ2xhc3NlcywKICAgICAgICAgIGF0dHJzOiB7CiAgICAgICAgICAgIGlkOiB0aGlzLm1vZGFsSGVhZGVySWQKICAgICAgICAgIH0sCiAgICAgICAgICByZWY6ICdoZWFkZXInCiAgICAgICAgfSwgWyRtb2RhbEhlYWRlcl0pOwogICAgICB9IC8vIE1vZGFsIGJvZHkKCgogICAgICB2YXIgJGJvZHkgPSBoKCdkaXYnLCB7CiAgICAgICAgc3RhdGljQ2xhc3M6ICdtb2RhbC1ib2R5JywKICAgICAgICBjbGFzczogdGhpcy5ib2R5Q2xhc3NlcywKICAgICAgICBhdHRyczogewogICAgICAgICAgaWQ6IHRoaXMubW9kYWxCb2R5SWQKICAgICAgICB9LAogICAgICAgIHJlZjogJ2JvZHknCiAgICAgIH0sIHRoaXMubm9ybWFsaXplU2xvdChTTE9UX05BTUVfREVGQVVMVCwgdGhpcy5zbG90U2NvcGUpKTsgLy8gTW9kYWwgZm9vdGVyCgogICAgICB2YXIgJGZvb3RlciA9IGgoKTsKCiAgICAgIGlmICghdGhpcy5oaWRlRm9vdGVyKSB7CiAgICAgICAgLy8gVE9ETzogUmVuYW1lIHNsb3QgdG8gYGZvb3RlcmAgYW5kIGRlcHJlY2F0ZSBgbW9kYWwtZm9vdGVyYAogICAgICAgIHZhciAkbW9kYWxGb290ZXIgPSB0aGlzLm5vcm1hbGl6ZVNsb3QoU0xPVF9OQU1FX01PREFMX0ZPT1RFUiwgdGhpcy5zbG90U2NvcGUpOwoKICAgICAgICBpZiAoISRtb2RhbEZvb3RlcikgewogICAgICAgICAgdmFyICRjYW5jZWxCdXR0b24gPSBoKCk7CgogICAgICAgICAgaWYgKCF0aGlzLm9rT25seSkgewogICAgICAgICAgICAkY2FuY2VsQnV0dG9uID0gaChCQnV0dG9uLCB7CiAgICAgICAgICAgICAgcHJvcHM6IHsKICAgICAgICAgICAgICAgIHZhcmlhbnQ6IHRoaXMuY2FuY2VsVmFyaWFudCwKICAgICAgICAgICAgICAgIHNpemU6IHRoaXMuYnV0dG9uU2l6ZSwKICAgICAgICAgICAgICAgIGRpc2FibGVkOiB0aGlzLmNhbmNlbERpc2FibGVkIHx8IHRoaXMuYnVzeSB8fCB0aGlzLmlzVHJhbnNpdGlvbmluZwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgLy8gVE9ETzogUmVuYW1lIHNsb3QgdG8gYGNhbmNlbC1idXR0b25gIGFuZCBkZXByZWNhdGUgYG1vZGFsLWNhbmNlbGAKICAgICAgICAgICAgICBkb21Qcm9wczogdGhpcy5oYXNOb3JtYWxpemVkU2xvdChTTE9UX05BTUVfTU9EQUxfQ0FOQ0VMKSA/IHt9IDogaHRtbE9yVGV4dCh0aGlzLmNhbmNlbFRpdGxlSHRtbCwgdGhpcy5jYW5jZWxUaXRsZSksCiAgICAgICAgICAgICAgb246IHsKICAgICAgICAgICAgICAgIGNsaWNrOiB0aGlzLm9uQ2FuY2VsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICByZWY6ICdjYW5jZWwtYnV0dG9uJwogICAgICAgICAgICB9LCAvLyBUT0RPOiBSZW5hbWUgc2xvdCB0byBgY2FuY2VsLWJ1dHRvbmAgYW5kIGRlcHJlY2F0ZSBgbW9kYWwtY2FuY2VsYAogICAgICAgICAgICB0aGlzLm5vcm1hbGl6ZVNsb3QoU0xPVF9OQU1FX01PREFMX0NBTkNFTCkpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciAkb2tCdXR0b24gPSBoKEJCdXR0b24sIHsKICAgICAgICAgICAgcHJvcHM6IHsKICAgICAgICAgICAgICB2YXJpYW50OiB0aGlzLm9rVmFyaWFudCwKICAgICAgICAgICAgICBzaXplOiB0aGlzLmJ1dHRvblNpemUsCiAgICAgICAgICAgICAgZGlzYWJsZWQ6IHRoaXMub2tEaXNhYmxlZCB8fCB0aGlzLmJ1c3kgfHwgdGhpcy5pc1RyYW5zaXRpb25pbmcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgLy8gVE9ETzogUmVuYW1lIHNsb3QgdG8gYG9rLWJ1dHRvbmAgYW5kIGRlcHJlY2F0ZSBgbW9kYWwtb2tgCiAgICAgICAgICAgIGRvbVByb3BzOiB0aGlzLmhhc05vcm1hbGl6ZWRTbG90KFNMT1RfTkFNRV9NT0RBTF9PSykgPyB7fSA6IGh0bWxPclRleHQodGhpcy5va1RpdGxlSHRtbCwgdGhpcy5va1RpdGxlKSwKICAgICAgICAgICAgb246IHsKICAgICAgICAgICAgICBjbGljazogdGhpcy5vbk9rCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHJlZjogJ29rLWJ1dHRvbicKICAgICAgICAgIH0sIC8vIFRPRE86IFJlbmFtZSBzbG90IHRvIGBvay1idXR0b25gIGFuZCBkZXByZWNhdGUgYG1vZGFsLW9rYAogICAgICAgICAgdGhpcy5ub3JtYWxpemVTbG90KFNMT1RfTkFNRV9NT0RBTF9PSykpOwogICAgICAgICAgJG1vZGFsRm9vdGVyID0gWyRjYW5jZWxCdXR0b24sICRva0J1dHRvbl07CiAgICAgICAgfQoKICAgICAgICAkZm9vdGVyID0gaCgnZm9vdGVyJywgewogICAgICAgICAgc3RhdGljQ2xhc3M6ICdtb2RhbC1mb290ZXInLAogICAgICAgICAgY2xhc3M6IHRoaXMuZm9vdGVyQ2xhc3NlcywKICAgICAgICAgIGF0dHJzOiB7CiAgICAgICAgICAgIGlkOiB0aGlzLm1vZGFsRm9vdGVySWQKICAgICAgICAgIH0sCiAgICAgICAgICByZWY6ICdmb290ZXInCiAgICAgICAgfSwgWyRtb2RhbEZvb3Rlcl0pOwogICAgICB9IC8vIEFzc2VtYmxlIG1vZGFsIGNvbnRlbnQKCgogICAgICB2YXIgJG1vZGFsQ29udGVudCA9IGgoJ2RpdicsIHsKICAgICAgICBzdGF0aWNDbGFzczogJ21vZGFsLWNvbnRlbnQnLAogICAgICAgIGNsYXNzOiB0aGlzLmNvbnRlbnRDbGFzcywKICAgICAgICBhdHRyczogewogICAgICAgICAgaWQ6IHRoaXMubW9kYWxDb250ZW50SWQsCiAgICAgICAgICB0YWJpbmRleDogJy0xJwogICAgICAgIH0sCiAgICAgICAgcmVmOiAnY29udGVudCcKICAgICAgfSwgWyRoZWFkZXIsICRib2R5LCAkZm9vdGVyXSk7IC8vIFRhYiB0cmFwcyB0byBwcmV2ZW50IHBhZ2UgZnJvbSBzY3JvbGxpbmcgdG8gbmV4dCBlbGVtZW50IGluCiAgICAgIC8vIHRhYiBpbmRleCBkdXJpbmcgZW5mb3JjZS1mb2N1cyB0YWIgY3ljbGUKCiAgICAgIHZhciAkdGFiVHJhcFRvcCA9IGgoKTsKICAgICAgdmFyICR0YWJUcmFwQm90dG9tID0gaCgpOwoKICAgICAgaWYgKHRoaXMuaXNWaXNpYmxlICYmICF0aGlzLm5vRW5mb3JjZUZvY3VzKSB7CiAgICAgICAgJHRhYlRyYXBUb3AgPSBoKCdzcGFuJywgewogICAgICAgICAgYXR0cnM6IHsKICAgICAgICAgICAgdGFiaW5kZXg6ICcwJwogICAgICAgICAgfSwKICAgICAgICAgIHJlZjogJ3RvcC10cmFwJwogICAgICAgIH0pOwogICAgICAgICR0YWJUcmFwQm90dG9tID0gaCgnc3BhbicsIHsKICAgICAgICAgIGF0dHJzOiB7CiAgICAgICAgICAgIHRhYmluZGV4OiAnMCcKICAgICAgICAgIH0sCiAgICAgICAgICByZWY6ICdib3R0b20tdHJhcCcKICAgICAgICB9KTsKICAgICAgfSAvLyBNb2RhbCBkaWFsb2cgd3JhcHBlcgoKCiAgICAgIHZhciAkbW9kYWxEaWFsb2cgPSBoKCdkaXYnLCB7CiAgICAgICAgc3RhdGljQ2xhc3M6ICdtb2RhbC1kaWFsb2cnLAogICAgICAgIGNsYXNzOiB0aGlzLmRpYWxvZ0NsYXNzZXMsCiAgICAgICAgb246IHsKICAgICAgICAgIG1vdXNlZG93bjogdGhpcy5vbkRpYWxvZ01vdXNlZG93bgogICAgICAgIH0sCiAgICAgICAgcmVmOiAnZGlhbG9nJwogICAgICB9LCBbJHRhYlRyYXBUb3AsICRtb2RhbENvbnRlbnQsICR0YWJUcmFwQm90dG9tXSk7IC8vIE1vZGFsCgogICAgICB2YXIgJG1vZGFsID0gaCgnZGl2JywgewogICAgICAgIHN0YXRpY0NsYXNzOiAnbW9kYWwnLAogICAgICAgIGNsYXNzOiB0aGlzLm1vZGFsQ2xhc3NlcywKICAgICAgICBzdHlsZTogdGhpcy5tb2RhbFN0eWxlcywKICAgICAgICBhdHRyczogdGhpcy5jb21wdXRlZE1vZGFsQXR0cnMsCiAgICAgICAgb246IHsKICAgICAgICAgIGtleWRvd246IHRoaXMub25Fc2MsCiAgICAgICAgICBjbGljazogdGhpcy5vbkNsaWNrT3V0CiAgICAgICAgfSwKICAgICAgICBkaXJlY3RpdmVzOiBbewogICAgICAgICAgbmFtZTogJ3Nob3cnLAogICAgICAgICAgdmFsdWU6IHRoaXMuaXNWaXNpYmxlCiAgICAgICAgfV0sCiAgICAgICAgcmVmOiAnbW9kYWwnCiAgICAgIH0sIFskbW9kYWxEaWFsb2ddKTsgLy8gV3JhcCBtb2RhbCBpbiB0cmFuc2l0aW9uCiAgICAgIC8vIFNhZGx5LCB3ZSBjYW4ndCB1c2UgYEJWVHJhbnNpdGlvbmAgaGVyZSBkdWUgdG8gdGhlIGRpZmZlcmVuY2VzIGluCiAgICAgIC8vIHRyYW5zaXRpb24gZHVyYXRpb25zIGZvciBgLm1vZGFsYCBhbmQgYC5tb2RhbC1kaWFsb2dgCiAgICAgIC8vIEF0IGxlYXN0IHVudGlsIGh0dHBzOi8vZ2l0aHViLmNvbS92dWVqcy92dWUvaXNzdWVzLzk5ODYgaXMgcmVzb2x2ZWQKCiAgICAgICRtb2RhbCA9IGgoJ3RyYW5zaXRpb24nLCB7CiAgICAgICAgcHJvcHM6IHsKICAgICAgICAgIGVudGVyQ2xhc3M6ICcnLAogICAgICAgICAgZW50ZXJUb0NsYXNzOiAnJywKICAgICAgICAgIGVudGVyQWN0aXZlQ2xhc3M6ICcnLAogICAgICAgICAgbGVhdmVDbGFzczogJycsCiAgICAgICAgICBsZWF2ZUFjdGl2ZUNsYXNzOiAnJywKICAgICAgICAgIGxlYXZlVG9DbGFzczogJycKICAgICAgICB9LAogICAgICAgIG9uOiB7CiAgICAgICAgICBiZWZvcmVFbnRlcjogdGhpcy5vbkJlZm9yZUVudGVyLAogICAgICAgICAgZW50ZXI6IHRoaXMub25FbnRlciwKICAgICAgICAgIGFmdGVyRW50ZXI6IHRoaXMub25BZnRlckVudGVyLAogICAgICAgICAgYmVmb3JlTGVhdmU6IHRoaXMub25CZWZvcmVMZWF2ZSwKICAgICAgICAgIGxlYXZlOiB0aGlzLm9uTGVhdmUsCiAgICAgICAgICBhZnRlckxlYXZlOiB0aGlzLm9uQWZ0ZXJMZWF2ZQogICAgICAgIH0KICAgICAgfSwgWyRtb2RhbF0pOyAvLyBNb2RhbCBiYWNrZHJvcAoKICAgICAgdmFyICRiYWNrZHJvcCA9IGgoKTsKCiAgICAgIGlmICghdGhpcy5oaWRlQmFja2Ryb3AgJiYgdGhpcy5pc1Zpc2libGUpIHsKICAgICAgICAkYmFja2Ryb3AgPSBoKCdkaXYnLCB7CiAgICAgICAgICBzdGF0aWNDbGFzczogJ21vZGFsLWJhY2tkcm9wJywKICAgICAgICAgIGF0dHJzOiB7CiAgICAgICAgICAgIGlkOiB0aGlzLm1vZGFsQmFja2Ryb3BJZAogICAgICAgICAgfQogICAgICAgIH0sIC8vIFRPRE86IFJlbmFtZSBzbG90IHRvIGBiYWNrZHJvcGAgYW5kIGRlcHJlY2F0ZSBgbW9kYWwtYmFja2Ryb3BgCiAgICAgICAgdGhpcy5ub3JtYWxpemVTbG90KFNMT1RfTkFNRV9NT0RBTF9CQUNLRFJPUCkpOwogICAgICB9CgogICAgICAkYmFja2Ryb3AgPSBoKEJWVHJhbnNpdGlvbiwgewogICAgICAgIHByb3BzOiB7CiAgICAgICAgICBub0ZhZGU6IHRoaXMubm9GYWRlCiAgICAgICAgfQogICAgICB9LCBbJGJhY2tkcm9wXSk7IC8vIEFzc2VtYmxlIG1vZGFsIGFuZCBiYWNrZHJvcCBpbiBhbiBvdXRlciA8ZGl2PgoKICAgICAgcmV0dXJuIGgoJ2RpdicsIHsKICAgICAgICBzdHlsZTogdGhpcy5tb2RhbE91dGVyU3R5bGUsCiAgICAgICAgYXR0cnM6IHRoaXMuY29tcHV0ZWRBdHRycywKICAgICAgICBrZXk6ICJtb2RhbC1vdXRlci0iLmNvbmNhdCh0aGlzW0NPTVBPTkVOVF9VSURfS0VZXSkKICAgICAgfSwgWyRtb2RhbCwgJGJhY2tkcm9wXSk7CiAgICB9CiAgfSwKICByZW5kZXI6IGZ1bmN0aW9uIHJlbmRlcihoKSB7CiAgICBpZiAodGhpcy5zdGF0aWMpIHsKICAgICAgcmV0dXJuIHRoaXMubGF6eSAmJiB0aGlzLmlzSGlkZGVuID8gaCgpIDogdGhpcy5tYWtlTW9kYWwoaCk7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gdGhpcy5pc0hpZGRlbiA/IGgoKSA6IGgoQlZUcmFuc3BvcnRlciwgW3RoaXMubWFrZU1vZGFsKGgpXSk7CiAgICB9CiAgfQp9KTs="},null]}