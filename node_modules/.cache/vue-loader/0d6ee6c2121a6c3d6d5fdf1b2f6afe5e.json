{"remainingRequest":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/vue-loader/lib/index.js??vue-loader-options!/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/src/views/app/xtream/editor.vue?vue&type=script&lang=js&","dependencies":[{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/src/views/app/xtream/editor.vue","mtime":1623696595045},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCi8qIGVzbGludC1kaXNhYmxlIHZ1ZS9uby1zaWRlLWVmZmVjdHMtaW4tY29tcHV0ZWQtcHJvcGVydGllcyAqLwovKiBlc2xpbnQtZGlzYWJsZSBuby11bnVzZWQtdmFycyAqLwovKiBlc2xpbnQtZGlzYWJsZSBuby11c2VsZXNzLWVzY2FwZSAqLwoKaW1wb3J0IHsgRXZlbnRCdXMgfSBmcm9tICIuLi8uLi8uLi9zZXJ2aWNlcy9lYnVzIjsKaW1wb3J0IHsgaHR0cFNlcnZpY2UgfSBmcm9tICIuLi8uLi8uLi9zZXJ2aWNlcy9odHRwIjsKaW1wb3J0IHsgbWFwR2V0dGVycyB9IGZyb20gInZ1ZXgiOwppbXBvcnQgZHJhZ2dhYmxlIGZyb20gInZ1ZWRyYWdnYWJsZSI7CmltcG9ydCB7IFN1YnNjcmlwdGlvblR5cGUgfSBmcm9tICIuLi8uLi8uLi9jb25zdGFudHMvY29uZmlnIjsKaW1wb3J0IHsgY291bnRyaWVzIH0gZnJvbSAiLi4vLi4vLi4vaGVscGVycyI7CgpleHBvcnQgZGVmYXVsdCB7CiAgY29tcG9uZW50czogewogICAgZHJhZ2dhYmxlLAogIH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGNvdW50cmllcywKICAgICAgYWN0aXZlVGFiOiAwLAogICAgICBhY3RpdmVHcm91cDogLTEsCiAgICAgIGFjdGl2ZUdyb3VwczogW10sCiAgICAgIGFjdGl2ZVN0cmVhbTogLTEsCiAgICAgIGFjdGl2ZVN0cmVhbXM6IFtdLAogICAgICBkcmFnR3JvdXA6IGZhbHNlLAogICAgICBkcmFnU3RyZWFtOiBmYWxzZSwKICAgICAgZWRpdG9yOiBmYWxzZSwKICAgICAgc2VhcmNoOiBudWxsLAogICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICBwbGF5bGlzdEVkaXRvcjogewogICAgICAgIGlkOiB1bmRlZmluZWQsCiAgICAgICAgcGxheWxpc3Q6IG51bGwsCiAgICAgICAgZ3JvdXBzOiBbXSwKICAgICAgICBzdHJlYW1zOiBbXSwKICAgICAgICBjaGFuZ2VkOiBmYWxzZSwKICAgICAgfSwKICAgICAgZmluZFJlcGxhY2U6IHsKICAgICAgICB0eXBlOiAwLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBmcm9tOiAiIiwKICAgICAgICB0bzogIiIsCiAgICAgICAgcmVwbGFjZUFsbDogZmFsc2UsCiAgICAgICAgaWdub3JlQ2FzZTogZmFsc2UsCiAgICAgICAgc2VsZWN0ZWRPbmx5OiAwLAogICAgICB9LAogICAgICBwcmVmaXhTdWZmaXg6IHsKICAgICAgICB0eXBlOiAwLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBwcmVmaXg6ICIiLAogICAgICAgIHN1ZmZpeDogIiIsCiAgICAgICAgc2VsZWN0ZWRPbmx5OiAwLAogICAgICB9LAogICAgICBjb252ZXJ0Q2FzZTogewogICAgICAgIHR5cGU6IDAsCiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIG1ldGhvZDogMCwKICAgICAgICBzZWxlY3RlZE9ubHk6IDAsCiAgICAgIH0sCiAgICAgIGdyb3VwRWRpdG9yOiB7CiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIGlkOiAwLAogICAgICAgIGdyb3VwX25hbWU6ICIiLAogICAgICAgIGdyb3VwX3BhcmVudF9jb2RlOiAiIiwKICAgICAgICBncm91cF90eXBlOiAxLAogICAgICAgIGdyb3VwX2lzX2hpZGRlbjogMCwKICAgICAgfSwKICAgICAgc3RyZWFtRWRpdG9yOiB7CiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIGlkOiAtMSwKICAgICAgICBzdHJlYW1fdHZnX25hbWU6ICIiLAogICAgICAgIHN0cmVhbV90dmdfaWQ6ICIiLAogICAgICAgIHN0cmVhbV90dmdfbG9nbzogIiIsCiAgICAgICAgc3RyZWFtX3BhcmVudF9jb2RlOiAiIiwKICAgICAgICBzdHJlYW1fcmFkaW86IDAsCiAgICAgICAgc3RyZWFtX2lzX2hpZGRlbjogMCwKICAgICAgICBzdHJlYW1faXNfY3VzdG9tOiAwLAogICAgICAgIG1vdmllX25hbWU6ICIiLAogICAgICAgIG1vdmllX3llYXI6ICIiLAogICAgICAgIHNlcmllX25hbWU6ICIiLAogICAgICAgIHNlcmllX3NlYXNvbjogMCwKICAgICAgICBzZXJpZV9lcGlzb2RlOiAwLAogICAgICAgIHNvdXJjZV9zdHJlYW1fdXJsOiAiIiwKICAgICAgfSwKICAgICAgcmFkaW9Ccm93c2VyOiB7CiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgYm91bmNlOiBudWxsLAogICAgICAgIGFjdGl2ZTogW10sCiAgICAgICAgc2VhcmNoOiAiIiwKICAgICAgICByZXN1bHRzOiBbXSwKICAgICAgfSwKICAgICAgc291bmRjbG91ZDogewogICAgICAgIGlzTG9hZGluZzogZmFsc2UsCiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIGJvdW5jZTogbnVsbCwKICAgICAgICB1cmw6ICIiLAogICAgICAgIHRyYWNrOiBudWxsLAogICAgICB9LAogICAgICB5b3V0dWJlOiB7CiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgYm91bmNlOiBudWxsLAogICAgICAgIHVybDogIiIsCiAgICAgICAgdmlkZW9JZDogIiIsCiAgICAgICAgdmlkZW86IG51bGwsCiAgICAgIH0sCiAgICAgIHZpbWVvOiB7CiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgYm91bmNlOiBudWxsLAogICAgICAgIHVybDogIiIsCiAgICAgICAgdmlkZW9JZDogIiIsCiAgICAgICAgdmlkZW86IG51bGwsCiAgICAgIH0sCiAgICAgIGRhaWx5bW90aW9uOiB7CiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgYm91bmNlOiBudWxsLAogICAgICAgIHVybDogIiIsCiAgICAgICAgdmlkZW9JZDogIiIsCiAgICAgICAgdmlkZW86IG51bGwsCiAgICAgIH0sCiAgICAgIHRlZFRhbGtzOiB7CiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgYm91bmNlOiBudWxsLAogICAgICAgIHVybDogIiIsCiAgICAgICAgdmlkZW86IG51bGwsCiAgICAgIH0sCiAgICAgIHhoYW1zdGVyOiB7CiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgYm91bmNlOiBudWxsLAogICAgICAgIHVybDogIiIsCiAgICAgICAgdmlkZW86IG51bGwsCiAgICAgIH0sCiAgICAgIGZpbmRMb2dvOiB7CiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgY291bnRyaWVzOiBbXSwKICAgICAgICBjb3VudHJ5OiAiIiwKICAgICAgICBsb2dvczogW10sCiAgICAgICAgbG9nbzogIiIsCiAgICAgICAgc2VhcmNoOiAiIiwKICAgICAgfSwKICAgICAgYXNzaWduTG9nbzogewogICAgICAgIGlzTG9hZGluZzogZmFsc2UsCiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIGNvdW50cmllczogW10sCiAgICAgICAgY291bnRyeTogIiIsCiAgICAgICAgbG9nb3M6IFtdLAogICAgICAgIGFzc2lnbkFsbDogMCwKICAgICAgfSwKICAgICAgc2F2ZUNoYW5nZXM6IHsKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgIH0sCiAgICAgIGdyb3VwVHlwZXM6IFsKICAgICAgICB7IHRleHQ6IHRoaXMuJHQoInh0cmVhbS5saXZlIiksIHZhbHVlOiAxIH0sCiAgICAgICAgeyB0ZXh0OiB0aGlzLiR0KCJ4dHJlYW0ubW92aWVzIiksIHZhbHVlOiAyIH0sCiAgICAgICAgeyB0ZXh0OiB0aGlzLiR0KCJ4dHJlYW0uc2VyaWVzIiksIHZhbHVlOiAzIH0sCiAgICAgIF0sCiAgICB9OwogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIC4uLm1hcEdldHRlcnMoWyJjdXJyZW50VXNlciIsICJzZXR0aW5ncyIsICJzb3VuZGNsb3VkQ2xpZW50SWQiXSksCiAgICBzZWFyY2hGaWx0ZXJlZCgpIHsKICAgICAgaWYgKHRoaXMuc2VhcmNoID09PSBudWxsKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuYWNjb3VudHM7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIHJlID0gbmV3IFJlZ0V4cCh0aGlzLnNlYXJjaCwgImkiKTsKICAgICAgICByZXR1cm4gdGhpcy5hY2NvdW50cy5maWx0ZXIoKGFjY291bnQpID0+IHsKICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgIFN0cmluZyhhY2NvdW50LnRpdGxlKS5tYXRjaChyZSkgfHwKICAgICAgICAgICAgU3RyaW5nKGFjY291bnQuaG9zdCkubWF0Y2gocmUpIHx8CiAgICAgICAgICAgIFN0cmluZyhhY2NvdW50LnBvcnQpLm1hdGNoKHJlKSB8fAogICAgICAgICAgICBTdHJpbmcoYWNjb3VudC51c2VybmFtZSkubWF0Y2gocmUpIHx8CiAgICAgICAgICAgIFN0cmluZyhhY2NvdW50LnBhc3N3b3JkKS5tYXRjaChyZSkgfHwKICAgICAgICAgICAgdGhpcy5mb3JtYXREYXRlKGFjY291bnQuc3luY2VkX2F0KS5tYXRjaChyZSkgfHwKICAgICAgICAgICAgdGhpcy4kdChgc3luYy1pbnRlcnZhbC4ke2FjY291bnQuc3luY19pbnRlcnZhbH1gKS5tYXRjaChyZSkKICAgICAgICAgICk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBwbGF5bGlzdFNlbGVjdGVkKCkgewogICAgICByZXR1cm4gdGhpcy5wbGF5bGlzdEVkaXRvci5pZCAhPT0gdW5kZWZpbmVkOwogICAgfSwKICAgIGxhc3RTZWxlY3RlZEdyb3VwKCkgewogICAgICByZXR1cm4gdGhpcy5hY3RpdmVHcm91cHNbdGhpcy5hY3RpdmVHcm91cHMubGVuZ3RoIC0gMV07CiAgICB9LAogICAgbGFzdFNlbGVjdGVkU3RyZWFtKCkgewogICAgICByZXR1cm4gdGhpcy5hY3RpdmVTdHJlYW1zW3RoaXMuYWN0aXZlU3RyZWFtcy5sZW5ndGggLSAxXTsKICAgIH0sCiAgICBjYW5FZGl0R3JvdXBUeXBlKCkgewogICAgICByZXR1cm4gKAogICAgICAgIHRoaXMuZ3JvdXBFZGl0b3IuaWQgJiYKICAgICAgICB0aGlzLmdldEdyb3VwV2l0aElkKHRoaXMuZ3JvdXBFZGl0b3IuaWQpLnN0cmVhbXMgPT0gMAogICAgICApOwogICAgfSwKICAgIHN1YnNjcmlwdGlvbkxpbWl0ZWQoKSB7CiAgICAgIHJldHVybiAoCiAgICAgICAgdGhpcy5jdXJyZW50VXNlci5zdWJzY3JpcHRpb24gJiYKICAgICAgICB0aGlzLmN1cnJlbnRVc2VyLnN1YnNjcmlwdGlvbi5zdWJzY3JpcHRpb25fdHlwZSA9PQogICAgICAgICAgU3Vic2NyaXB0aW9uVHlwZS5FbnRodXNpYXN0CiAgICAgICk7CiAgICB9LAogICAgZmlsdGVyZWRHcm91cHMoKSB7CiAgICAgIGlmICh0aGlzLnN1YnNjcmlwdGlvbkxpbWl0ZWQpIHsKICAgICAgICByZXR1cm4gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmlsdGVyKAogICAgICAgICAgKGdyb3VwKSA9PgogICAgICAgICAgICBncm91cC5ncm91cF9pc19yZW1vdmVkICE9PSAxICYmCiAgICAgICAgICAgIGdyb3VwLnNvdXJjZV9ncm91cF90eXBlID09IDEgJiYKICAgICAgICAgICAgZ3JvdXAuZ3JvdXBfdHlwZSA9PSAxCiAgICAgICAgKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmlsdGVyKAogICAgICAgIChncm91cCkgPT4gZ3JvdXAuZ3JvdXBfaXNfcmVtb3ZlZCAhPT0gMQogICAgICApOwogICAgfSwKICAgIGZpbHRlcmVkU3RyZWFtcygpIHsKICAgICAgcmV0dXJuIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5maWx0ZXIoCiAgICAgICAgKGdyb3VwKSA9PiBncm91cC5zdHJlYW1faXNfcmVtb3ZlZCAhPT0gMQogICAgICApOwogICAgfSwKICAgIGFjdGl2ZUdyb3VwVHlwZSgpIHsKICAgICAgbGV0IGluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KAogICAgICAgIChncm91cCkgPT4gZ3JvdXAuaWQgPT0gdGhpcy5hY3RpdmVHcm91cAogICAgICApOwogICAgICByZXR1cm4gaW5kZXggPiAtMSA/IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2luZGV4XS5ncm91cF90eXBlIDogMDsKICAgIH0sCiAgICBmaWx0ZXJlZExvZ29zKCkgewogICAgICBpZiAoIXRoaXMuZmluZExvZ28uc2VhcmNoLmxlbmd0aCkgewogICAgICAgIHJldHVybiB0aGlzLmZpbmRMb2dvLmxvZ29zOwogICAgICB9CiAgICAgIGxldCBzZWxlY3RlZFN0cmVhbSA9IHRoaXMuZ2V0U3RyZWFtV2l0aElkKHRoaXMuYWN0aXZlU3RyZWFtc1swXSk7CiAgICAgIGxldCByZSA9IG5ldyBSZWdFeHAodGhpcy5maW5kTG9nby5zZWFyY2gsICJpIik7CiAgICAgIHJldHVybiB0aGlzLmZpbmRMb2dvLmxvZ29zLmZpbHRlcigobG9nbykgPT4gewogICAgICAgIHJldHVybiBsb2dvLnRleHQubWF0Y2gocmUpOwogICAgICB9KTsKICAgIH0sCiAgICBncm91cENvbnRleHRNZW51KCkgewogICAgICBsZXQgdm0gPSB0aGlzOwogICAgICByZXR1cm4gWwogICAgICAgIHsKICAgICAgICAgIGljb246ICJsYS1wbHVzIiwKICAgICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IuYWRkLWdyb3VwIiksCiAgICAgICAgICBvbkNsaWNrOiB2bS5hZGRHcm91cCwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGRpc2FibGVkOiB2bS5hY3RpdmVHcm91cHMubGVuZ3RoICE9PSAxLAogICAgICAgICAgaWNvbjogImxhLWVkaXQiLAogICAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5lZGl0LWdyb3VwIiksCiAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmICh2bS5hY3RpdmVHcm91cHMubGVuZ3RoID09PSAxKSB7CiAgICAgICAgICAgICAgdm0uZWRpdEdyb3VwTW9kYWwodHJ1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBkaXZpZGVyOiB0cnVlLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgdGV4dDogdm0uJHQoImdlbmVyYWwuc2VsZWN0LWFsbCIpLAogICAgICAgICAgb25DbGljazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2bS5hY3RpdmVHcm91cHMgPSBbLi4udm0ucGxheWxpc3RFZGl0b3IuZ3JvdXBzLm1hcCgoZykgPT4gZy5pZCldOwogICAgICAgICAgfSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIHRleHQ6IHZtLiR0KCJnZW5lcmFsLnNlbGVjdC1ub25lIiksCiAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZtLmFjdGl2ZUdyb3VwcyA9IFtdOwogICAgICAgICAgfSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGRpdmlkZXI6IHRydWUsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBpY29uOiAibGEtc2VhcmNoIiwKICAgICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IuZmluZC1yZXBsYWNlIiksCiAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZtLmZpbmRBbmRSZXBsYWNlTW9kYWwodHJ1ZSwgMSk7CiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgaWNvbjogImxhLXBlbiIsCiAgICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLmFkZC1wcmVmaXgtc3VmZml4IiksCiAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZtLnByZWZpeFN1ZmZpeE1vZGFsKHRydWUsIDEpOwogICAgICAgICAgfSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGljb246ICJsYS1mb250IiwKICAgICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IuY2hhbmdlLWNhc2UiKSwKICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdm0uY29udmVydENhc2VNb2RhbCh0cnVlLCAxKTsKICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBkaXZpZGVyOiB0cnVlLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgZGlzYWJsZWQ6IHZtLmFjdGl2ZUdyb3Vwcy5sZW5ndGggPT09IDAsCiAgICAgICAgICBpY29uOiAibGEtZXllIiwKICAgICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IudG9nZ2xlLXZpc2liaWxpdHkiKSwKICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKHZtLmFjdGl2ZUdyb3Vwcy5sZW5ndGgpIHsKICAgICAgICAgICAgICB2bS50b2dnbGVHcm91cFZpc2liaWxpdHkoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGRpc2FibGVkOiB2bS5hY3RpdmVHcm91cHMubGVuZ3RoID09PSAwLAogICAgICAgICAgaWNvbjogImxhLXRyYXNoIiwKICAgICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IuZGVsZXRlIiksCiAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmICh2bS5hY3RpdmVHcm91cHMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgdm0uZGVsZXRlU2VsZWN0ZWRHcm91cHMoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICB9LAogICAgICBdOwogICAgfSwKICAgIHN0cmVhbUNvbnRleHRNZW51KCkgewogICAgICBsZXQgdm0gPSB0aGlzOwogICAgICByZXR1cm4gWwogICAgICAgIHsKICAgICAgICAgIGljb246ICJsYS1wbHVzIiwKICAgICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IuYWRkLXN0cmVhbSIpLAogICAgICAgICAgb25DbGljazogdm0uYWRkU3RyZWFtLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgZGlzYWJsZWQ6IHZtLmFjdGl2ZVN0cmVhbXMubGVuZ3RoICE9PSAxLAogICAgICAgICAgaWNvbjogImxhLWVkaXQiLAogICAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5lZGl0LXN0cmVhbSIpLAogICAgICAgICAgb25DbGljazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICBpZiAodm0uYWN0aXZlU3RyZWFtcy5sZW5ndGggPT09IDEpIHsKICAgICAgICAgICAgICB2bS5lZGl0U3RyZWFtTW9kYWwodHJ1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBkaXZpZGVyOiB0cnVlLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgdGV4dDogdm0uJHQoImdlbmVyYWwuc2VsZWN0LWFsbCIpLAogICAgICAgICAgb25DbGljazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2bS5hY3RpdmVTdHJlYW1zID0gWy4uLnZtLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubWFwKChnKSA9PiBnLmlkKV07CiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgdGV4dDogdm0uJHQoImdlbmVyYWwuc2VsZWN0LW5vbmUiKSwKICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdm0uYWN0aXZlU3RyZWFtcyA9IFtdOwogICAgICAgICAgfSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGRpdmlkZXI6IHRydWUsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBkaXNhYmxlZDoKICAgICAgICAgICAgdm0uYWN0aXZlR3JvdXBzLmxlbmd0aCAhPT0gMSB8fAogICAgICAgICAgICB2bS5hY3RpdmVTdHJlYW1zLmxlbmd0aCA9PT0gMCB8fAogICAgICAgICAgICB2bS5nZXRHcm91cFdpdGhJZCh2bS5hY3RpdmVHcm91cHNbMF0pLmdyb3VwX3R5cGUgIT09CiAgICAgICAgICAgICAgdm0uYWN0aXZlR3JvdXBUeXBlIHx8CiAgICAgICAgICAgIHZtLmFjdGl2ZUdyb3Vwc1swXSA9PT0gdm0uYWN0aXZlR3JvdXAsCiAgICAgICAgICBpY29uOiAibGEtY2hldnJvbi1sZWZ0IiwKICAgICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IubW92ZS10by1zZWxlY3RlZC1ncm91cCIpLAogICAgICAgICAgb25DbGljazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2bS5tb3ZlVG9TZWxlY3RlZEdyb3VwKCk7CiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgZGl2aWRlcjogdHJ1ZSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGljb246ICJsYS1zZWFyY2giLAogICAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5maW5kLXJlcGxhY2UiKSwKICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdm0uZmluZEFuZFJlcGxhY2VNb2RhbCh0cnVlLCAyKTsKICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBpY29uOiAibGEtcGVuIiwKICAgICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IuYWRkLXByZWZpeC1zdWZmaXgiKSwKICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdm0ucHJlZml4U3VmZml4TW9kYWwodHJ1ZSwgMik7CiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgaWNvbjogImxhLWZvbnQiLAogICAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5jaGFuZ2UtY2FzZSIpLAogICAgICAgICAgb25DbGljazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2bS5jb252ZXJ0Q2FzZU1vZGFsKHRydWUsIDIpOwogICAgICAgICAgfSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGRpc2FibGVkOiB2bS5hY3RpdmVTdHJlYW1zLmxlbmd0aCAhPT0gMSB8fCB2bS5hY3RpdmVHcm91cFR5cGUgIT09IDEsCiAgICAgICAgICBpY29uOiAibGEtcGhvdG8tdmlkZW8iLAogICAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5maW5kLWxvZ28iKSwKICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdm0uZmluZExvZ29Nb2RhbCh0cnVlKTsKICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBkaXZpZGVyOiB0cnVlLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgZGlzYWJsZWQ6IHZtLmFjdGl2ZVN0cmVhbXMubGVuZ3RoID09PSAwIHx8IHZtLmFjdGl2ZUdyb3VwVHlwZSAhPT0gMSwKICAgICAgICAgIGljb246ICJsYS1tdXNpYyIsCiAgICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLnRvZ2dsZS1yYWRpbyIpLAogICAgICAgICAgb25DbGljazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICBpZiAodm0uYWN0aXZlU3RyZWFtcy5sZW5ndGggJiYgdm0uYWN0aXZlR3JvdXBUeXBlID09IDEpIHsKICAgICAgICAgICAgICB2bS50b2dnbGVTdHJlYW1SYWRpbygpOwogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgZGlzYWJsZWQ6IHZtLmFjdGl2ZVN0cmVhbXMubGVuZ3RoID09PSAwLAogICAgICAgICAgaWNvbjogImxhLWV5ZSIsCiAgICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLnRvZ2dsZS12aXNpYmlsaXR5IiksCiAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmICh2bS5hY3RpdmVTdHJlYW1zLmxlbmd0aCkgewogICAgICAgICAgICAgIHZtLnRvZ2dsZVN0cmVhbVZpc2liaWxpdHkoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGRpdmlkZXI6IHRydWUsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBkaXNhYmxlZDogdm0uYWN0aXZlU3RyZWFtcy5sZW5ndGggPT09IDAsCiAgICAgICAgICBpY29uOiAibGEtdHJhc2giLAogICAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5kZWxldGUiKSwKICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKHZtLmFjdGl2ZVN0cmVhbXMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgdm0uZGVsZXRlU2VsZWN0ZWRTdHJlYW1zKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgICAgXTsKICAgIH0sCiAgfSwKICBtZXRob2RzOiB7CiAgICBncm91cERyYWdDaGFuZ2VkKGcpIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmICh0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5ncm91cF9vcmRlciAhPSBpICsgMSkgewogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uZ3JvdXBfb3JkZXIgPSBpICsgMTsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBzdHJlYW1EcmFnQ2hhbmdlZChnKSB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5zdHJlYW1fb3JkZXIgIT0gaSArIDEpIHsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5zdHJlYW1fb3JkZXIgPSBpICsgMTsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgb3BlbkNvbnRleHQoY29udGV4dCkgewogICAgICB0aGlzLiRyZWZzW2NvbnRleHRdLm9wZW4oKTsKICAgIH0sCiAgICBzZWFyY2hFZGl0b3Ioc2VhcmNoKSB7CiAgICAgIGlmIChzZWFyY2gubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhpcy5zZWFyY2ggPSBudWxsOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc2VhcmNoID0gc2VhcmNoOwogICAgICB9CiAgICB9LAogICAgcHJpbnRFZGl0b3IoKSB7CiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlZGl0b3IiKS5wcmludCgpOwogICAgfSwKICAgIGZvcm1hdE51bWJlcihudW1iZXIpIHsKICAgICAgcmV0dXJuIG5ldyBJbnRsLk51bWJlckZvcm1hdCh0aGlzLiR0KCJkYXRlLmxvY2FsZSIpKS5mb3JtYXQobnVtYmVyKTsKICAgIH0sCiAgICBmb3JtYXREYXRlKGRhdGUpIHsKICAgICAgcmV0dXJuIG5ldyBEYXRlKGRhdGUpLnRvTG9jYWxlU3RyaW5nKAogICAgICAgIHRoaXMuJHQoImRhdGUubG9jYWxlIiksCiAgICAgICAgdGhpcy5kYXRlT3B0aW9ucwogICAgICApOwogICAgfSwKICAgIGZvcm1hdERhdGVZb3V0dWJlKGRhdGUpIHsKICAgICAgcmV0dXJuIG5ldyBEYXRlKGRhdGUpLnRvTG9jYWxlRGF0ZVN0cmluZyh0aGlzLiR0KCJkYXRlLmxvY2FsZSIpLCB7CiAgICAgICAgeWVhcjogIm51bWVyaWMiLAogICAgICAgIG1vbnRoOiAic2hvcnQiLAogICAgICAgIGRheTogIm51bWVyaWMiLAogICAgICB9KTsKICAgIH0sCiAgICBmb3JtYXRTZWNvbmRzKHNlYykgewogICAgICB2YXIgZCA9IE51bWJlcihzZWMpOwogICAgICB2YXIgaCA9IE1hdGguZmxvb3IoZCAvIDM2MDApOwogICAgICB2YXIgbSA9IE1hdGguZmxvb3IoKGQgJSAzNjAwKSAvIDYwKTsKICAgICAgdmFyIHMgPSBNYXRoLmZsb29yKChkICUgMzYwMCkgJSA2MCk7CgogICAgICB2YXIgaG91ciA9IHRoaXMuJHQoImdlbmVyYWwuaG91ciIpOwogICAgICB2YXIgaG91cnMgPSB0aGlzLiR0KCJnZW5lcmFsLmhvdXJzIik7CiAgICAgIHZhciBtaW51dGUgPSB0aGlzLiR0KCJnZW5lcmFsLm1pbnV0ZSIpOwogICAgICB2YXIgbWludXRlcyA9IHRoaXMuJHQoImdlbmVyYWwubWludXRlcyIpOwogICAgICB2YXIgc2Vjb25kID0gdGhpcy4kdCgiZ2VuZXJhbC5zZWNvbmQiKTsKICAgICAgdmFyIHNlY29uZHMgPSB0aGlzLiR0KCJnZW5lcmFsLnNlY29uZHMiKTsKCiAgICAgIHZhciBoRGlzcGxheSA9IGggPiAwID8gaCArIChoID09IDEgPyBgICR7aG91cn0gYCA6IGAgJHtob3Vyc30gYCkgOiAiIjsKICAgICAgdmFyIG1EaXNwbGF5ID0gbSA+IDAgPyBtICsgKG0gPT0gMSA/IGAgJHttaW51dGV9IGAgOiBgICR7bWludXRlc30gYCkgOiAiIjsKICAgICAgdmFyIHNEaXNwbGF5ID0gcyA+IDAgPyBzICsgKHMgPT0gMSA/IGAgJHtzZWNvbmR9IGAgOiBgICR7c2Vjb25kc30gYCkgOiAiIjsKICAgICAgcmV0dXJuIGhEaXNwbGF5ICsgbURpc3BsYXkgKyBzRGlzcGxheTsKICAgIH0sCgogICAgZ2V0R3JvdXBXaXRoSWQoaWQpIHsKICAgICAgbGV0IGluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KAogICAgICAgIChncm91cCkgPT4gZ3JvdXAuaWQgPT0gaWQKICAgICAgKTsKICAgICAgcmV0dXJuIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2luZGV4XTsKICAgIH0sCiAgICBnZXRTdHJlYW1XaXRoSWQoaWQpIHsKICAgICAgbGV0IGluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmZpbmRJbmRleCgKICAgICAgICAoc3RyZWFtKSA9PiBzdHJlYW0uaWQgPT0gaWQKICAgICAgKTsKICAgICAgcmV0dXJuIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF07CiAgICB9LAogICAgZG9TYXZlKCkgewogICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IGZhbHNlOwogICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICBsZXQgaW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoKGdyb3VwKSA9PiB7CiAgICAgICAgICByZXR1cm4gZ3JvdXAuaWQgPT0gdGhpcy5hY3RpdmVHcm91cDsKICAgICAgICB9KTsKICAgICAgICBsZXQgdXBkYXRlR3JvdXBzID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMKICAgICAgICAgIC5maWx0ZXIoKGdyb3VwKSA9PiAhZ3JvdXAuZ3JvdXBfaXNfcmVtb3ZlZCAmJiBncm91cC5tb2RpZmllZCkKICAgICAgICAgIC5tYXAoKGdyb3VwKSA9PiB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgaWQ6IGdyb3VwLmlkLAogICAgICAgICAgICAgIGdyb3VwX25hbWU6IGdyb3VwLmdyb3VwX25hbWUsCiAgICAgICAgICAgICAgZ3JvdXBfb3JkZXI6IGdyb3VwLmdyb3VwX29yZGVyLAogICAgICAgICAgICAgIGdyb3VwX3R5cGU6IGdyb3VwLmdyb3VwX3R5cGUsCiAgICAgICAgICAgICAgZ3JvdXBfcGFyZW50X2NvZGU6IGdyb3VwLmdyb3VwX3BhcmVudF9jb2RlLAogICAgICAgICAgICAgIGdyb3VwX2lzX2hpZGRlbjogZ3JvdXAuZ3JvdXBfaXNfaGlkZGVuLAogICAgICAgICAgICB9OwogICAgICAgICAgfSk7CiAgICAgICAgbGV0IGRlbGV0ZUdyb3VwcyA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzCiAgICAgICAgICAuZmlsdGVyKChncm91cCkgPT4gZ3JvdXAuZ3JvdXBfaXNfcmVtb3ZlZCAmJiBncm91cC5tb2RpZmllZCkKICAgICAgICAgIC5tYXAoKGdyb3VwKSA9PiBncm91cC5pZCkKICAgICAgICAgIC5qb2luKCk7CgogICAgICAgIGxldCB1cGRhdGVTdHJlYW1zOwogICAgICAgIHN3aXRjaCAodGhpcy5hY3RpdmVHcm91cFR5cGUpIHsKICAgICAgICAgIC8vIExpdmUgc3RyZWFtcwogICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICB1cGRhdGVTdHJlYW1zID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zCiAgICAgICAgICAgICAgLmZpbHRlcigKICAgICAgICAgICAgICAgIChzdHJlYW0pID0+IHN0cmVhbS5zdHJlYW1faXNfcmVtb3ZlZCAhPT0gMSAmJiBzdHJlYW0ubW9kaWZpZWQKICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgLm1hcCgoc3RyZWFtKSA9PiB7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICBpZDogc3RyZWFtLmlkLAogICAgICAgICAgICAgICAgICBzdHJlYW1fdHZnX25hbWU6IHN0cmVhbS5zdHJlYW1fdHZnX25hbWUsCiAgICAgICAgICAgICAgICAgIHN0cmVhbV90dmdfaWQ6IHN0cmVhbS5zdHJlYW1fdHZnX2lkLAogICAgICAgICAgICAgICAgICBzdHJlYW1fdHZnX2xvZ286IHN0cmVhbS5zdHJlYW1fdHZnX2xvZ28sCiAgICAgICAgICAgICAgICAgIHN0cmVhbV9wYXJlbnRfY29kZTogc3RyZWFtLnN0cmVhbV9wYXJlbnRfY29kZSwKICAgICAgICAgICAgICAgICAgc3RyZWFtX3JhZGlvOiBzdHJlYW0uc3RyZWFtX3JhZGlvLAogICAgICAgICAgICAgICAgICBzdHJlYW1faXNfaGlkZGVuOiBzdHJlYW0uc3RyZWFtX2lzX2hpZGRlbiwKICAgICAgICAgICAgICAgICAgc3RyZWFtX29yZGVyOiBzdHJlYW0uc3RyZWFtX29yZGVyLAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAvLyBNb3ZpZXMKICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgdXBkYXRlU3RyZWFtcyA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcwogICAgICAgICAgICAgIC5maWx0ZXIoCiAgICAgICAgICAgICAgICAoc3RyZWFtKSA9PiBzdHJlYW0uc3RyZWFtX2lzX3JlbW92ZWQgIT09IDEgJiYgc3RyZWFtLm1vZGlmaWVkCiAgICAgICAgICAgICAgKQogICAgICAgICAgICAgIC5tYXAoKHN0cmVhbSkgPT4gewogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgaWQ6IHN0cmVhbS5pZCwKICAgICAgICAgICAgICAgICAgbW92aWVfbmFtZTogc3RyZWFtLm1vdmllX25hbWUsCiAgICAgICAgICAgICAgICAgIG1vdmllX3llYXI6IHN0cmVhbS5tb3ZpZV95ZWFyLAogICAgICAgICAgICAgICAgICB0bWRiX2lkOiBzdHJlYW0udG1kYl9pZCwKICAgICAgICAgICAgICAgICAgc3RyZWFtX3R2Z19sb2dvOiBzdHJlYW0uc3RyZWFtX3R2Z19sb2dvLAogICAgICAgICAgICAgICAgICBzdHJlYW1faXNfaGlkZGVuOiBzdHJlYW0uc3RyZWFtX2lzX2hpZGRlbiwKICAgICAgICAgICAgICAgICAgc3RyZWFtX29yZGVyOiBzdHJlYW0uc3RyZWFtX29yZGVyLAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAvLyBTZXJpZXMKICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgdXBkYXRlU3RyZWFtcyA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcwogICAgICAgICAgICAgIC5maWx0ZXIoCiAgICAgICAgICAgICAgICAoc3RyZWFtKSA9PiBzdHJlYW0uc3RyZWFtX2lzX3JlbW92ZWQgIT09IDEgJiYgc3RyZWFtLm1vZGlmaWVkCiAgICAgICAgICAgICAgKQogICAgICAgICAgICAgIC5tYXAoKHN0cmVhbSkgPT4gewogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgaWQ6IHN0cmVhbS5pZCwKICAgICAgICAgICAgICAgICAgc2VyaWVfbmFtZTogc3RyZWFtLnNlcmllX25hbWUsCiAgICAgICAgICAgICAgICAgIHNlcmllX3NlYXNvbjogc3RyZWFtLnNlcmllX3NlYXNvbiwKICAgICAgICAgICAgICAgICAgc2VyaWVfZXBpc29kZTogc3RyZWFtLnNlcmllX2VwaXNvZGUsCiAgICAgICAgICAgICAgICAgIHRtZGJfaWQ6IHN0cmVhbS50bWRiX2lkLAogICAgICAgICAgICAgICAgICBzdHJlYW1fdHZnX2xvZ286IHN0cmVhbS5zdHJlYW1fdHZnX2xvZ28sCiAgICAgICAgICAgICAgICAgIHN0cmVhbV9pc19oaWRkZW46IHN0cmVhbS5zdHJlYW1faXNfaGlkZGVuLAogICAgICAgICAgICAgICAgICBzdHJlYW1fb3JkZXI6IHN0cmVhbS5zdHJlYW1fb3JkZXIsCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgbGV0IGRlbGV0ZVN0cmVhbXMgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMKICAgICAgICAgIC5maWx0ZXIoKHN0cmVhbSkgPT4gc3RyZWFtLnN0cmVhbV9pc19yZW1vdmVkID09PSAxICYmIHN0cmVhbS5tb2RpZmllZCkKICAgICAgICAgIC5tYXAoKHN0cmVhbSkgPT4gc3RyZWFtLmlkKQogICAgICAgICAgLmpvaW4oKTsKCiAgICAgICAgbGV0IHJlcXVlc3RzID0gW107CiAgICAgICAgaWYgKHVwZGF0ZUdyb3Vwcy5sZW5ndGgpIHsKICAgICAgICAgIHJlcXVlc3RzLnB1c2goCiAgICAgICAgICAgIGh0dHBTZXJ2aWNlLnBvc3QoImVkaXRvci91cGRhdGUtZ3JvdXBzIiwgewogICAgICAgICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgICAgIGdyb3VwczogdXBkYXRlR3JvdXBzLAogICAgICAgICAgICB9KQogICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgaWYgKGRlbGV0ZUdyb3Vwcy5sZW5ndGgpIHsKICAgICAgICAgIGluZGV4ID0gMDsKICAgICAgICAgIHJlcXVlc3RzLnB1c2goCiAgICAgICAgICAgIGh0dHBTZXJ2aWNlLnBvc3QoImVkaXRvci9kZWxldGUtZ3JvdXBzIiwgewogICAgICAgICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgICAgIGdyb3VwczogZGVsZXRlR3JvdXBzLAogICAgICAgICAgICB9KQogICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgaWYgKHVwZGF0ZVN0cmVhbXMubGVuZ3RoKSB7CiAgICAgICAgICByZXF1ZXN0cy5wdXNoKAogICAgICAgICAgICBodHRwU2VydmljZS5wb3N0KGBlZGl0b3IvdXBkYXRlLXN0cmVhbXMvJHt0aGlzLmFjdGl2ZUdyb3VwVHlwZX1gLCB7CiAgICAgICAgICAgICAgcGxheWxpc3RfaWQ6IHRoaXMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICAgICAgc3RyZWFtczogdXBkYXRlU3RyZWFtcywKICAgICAgICAgICAgfSkKICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIGlmIChkZWxldGVTdHJlYW1zLmxlbmd0aCkgewogICAgICAgICAgcmVxdWVzdHMucHVzaCgKICAgICAgICAgICAgaHR0cFNlcnZpY2UucG9zdChgZWRpdG9yL2RlbGV0ZS1zdHJlYW1zLyR7dGhpcy5hY3RpdmVHcm91cFR5cGV9YCwgewogICAgICAgICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgICAgIHN0cmVhbXM6IGRlbGV0ZVN0cmVhbXMsCiAgICAgICAgICAgIH0pCiAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICBQcm9taXNlLmFsbChyZXF1ZXN0cykudGhlbigocmVzKSA9PiB7CiAgICAgICAgICB0aGlzLmxvYWRQbGF5bGlzdCh0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLCBpbmRleCk7CiAgICAgICAgICByZXNvbHZlKHJlcyk7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSwKICAgIGRvQ2FuY2VsKCkgewogICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIFByb21pc2UuYWxsKFt0aGlzLnJlc3RvcmVHcm91cHMoKSwgdGhpcy5yZXN0b3JlU3RyZWFtcygpXSkudGhlbigoKSA9PiB7CiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gZmFsc2U7CiAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfSk7CiAgICB9LAogICAgZG9UYWJDaGFuZ2UodGFiKSB7CiAgICAgIHRoaXMuYWN0aXZlVGFiID0gdGFiOwogICAgfSwKICAgIHVwZGF0ZUdyb3VwT3JkZXIoc291cmNlKSB7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgIGxldCBncm91cHMgPSBbLi4uc291cmNlXTsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGdyb3Vwcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgZ3JvdXBzW2ldLnNvdXJjZV9ncm91cF9vcmRlciA9IGkgKyAxOwogICAgICAgICAgZ3JvdXBzW2ldLmdyb3VwX29yZGVyID0gaSArIDE7CiAgICAgICAgfQogICAgICAgIHJlc29sdmUoZ3JvdXBzKTsKICAgICAgfSk7CiAgICB9LAogICAgdXBkYXRlU3RyZWFtT3JkZXIoc291cmNlKSB7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgIGxldCBzdHJlYW1zID0gWy4uLnNvdXJjZV07CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdHJlYW1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBzdHJlYW1zW2ldLnNvdXJjZV9zdHJlYW1fb3JkZXIgPSBpICsgMTsKICAgICAgICAgIHN0cmVhbXNbaV0uc3RyZWFtX29yZGVyID0gaSArIDE7CiAgICAgICAgfQogICAgICAgIHJlc29sdmUoc3RyZWFtcyk7CiAgICAgIH0pOwogICAgfSwKICAgIHJlc3RvcmVHcm91cE9yZGVyKCkgewogICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5zb3J0KChhLCBiKSA9PgogICAgICAgICAgYS5zb3VyY2VfZ3JvdXBfb3JkZXIgPiBiLnNvdXJjZV9ncm91cF9vcmRlcgogICAgICAgICAgICA/IDEKICAgICAgICAgICAgOiBiLnNvdXJjZV9ncm91cF9vcmRlciA+IGEuc291cmNlX2dyb3VwX29yZGVyCiAgICAgICAgICAgID8gLTEKICAgICAgICAgICAgOiAwCiAgICAgICAgKTsKICAgICAgICByZXNvbHZlKCk7CiAgICAgIH0pOwogICAgfSwKICAgIHJlc3RvcmVTdHJlYW1PcmRlcigpIHsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLnNvcnQoKGEsIGIpID0+CiAgICAgICAgICBhLnNvdXJjZV9zdHJlYW1fb3JkZXIgPiBiLnNvdXJjZV9zdHJlYW1fb3JkZXIKICAgICAgICAgICAgPyAxCiAgICAgICAgICAgIDogYi5zb3VyY2Vfc3RyZWFtX29yZGVyID4gYS5zb3VyY2Vfc3RyZWFtX29yZGVyCiAgICAgICAgICAgID8gLTEKICAgICAgICAgICAgOiAwCiAgICAgICAgKTsKICAgICAgICByZXNvbHZlKCk7CiAgICAgIH0pOwogICAgfSwKICAgIHJlc3RvcmVHcm91cHMoKSB7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgIHRoaXMucmVzdG9yZUdyb3VwT3JkZXIoKS50aGVuKCgpID0+IHsKICAgICAgICAgIGxldCBncm91cDsKICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgZ3JvdXAgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXTsKICAgICAgICAgICAgZ3JvdXAubW9kaWZpZWQgPSBmYWxzZTsKICAgICAgICAgICAgZ3JvdXAuZ3JvdXBfaXNfcmVtb3ZlZCA9IDA7CiAgICAgICAgICAgIGdyb3VwLmdyb3VwX3R5cGUgPSBncm91cC5zb3VyY2VfZ3JvdXBfdHlwZTsKICAgICAgICAgICAgZ3JvdXAuZ3JvdXBfbmFtZSA9IGdyb3VwLnNvdXJjZV9ncm91cF9uYW1lOwogICAgICAgICAgICBncm91cC5wYXJlbnRfY29kZSA9IGdyb3VwLnNvdXJjZV9ncm91cF9wYXJlbnRfY29kZTsKICAgICAgICAgICAgZ3JvdXAuZ3JvdXBfaXNfaGlkZGVuID0gZ3JvdXAuc291cmNlX2dyb3VwX2lzX2hpZGRlbjsKICAgICAgICAgIH0KICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LAogICAgcmVzdG9yZVN0cmVhbXMoKSB7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgIHRoaXMucmVzdG9yZVN0cmVhbU9yZGVyKCkudGhlbigoKSA9PiB7CiAgICAgICAgICBsZXQgc3RyZWFtOwogICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgc3RyZWFtID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldOwogICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSBmYWxzZTsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV9pc19yZW1vdmVkID0gMDsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfbmFtZSA9IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX3R2Z19uYW1lOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19pZCA9IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX3R2Z19pZDsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfbG9nbyA9IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX3R2Z19sb2dvOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19jaG5vID0gc3RyZWFtLnNvdXJjZV9zdHJlYW1fdHZnX2Nobm87CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX3NoaWZ0ID0gc3RyZWFtLnNvdXJjZV9zdHJlYW1fdHZnX3NoaWZ0OwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3BhcmVudF9jb2RlID0gc3RyZWFtLnNvdXJjZV9zdHJlYW1fcGFyZW50X2NvZGU7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fYXVkaW9fdHJhY2sgPSBzdHJlYW0uc291cmNlX3N0cmVhbV9hdWRpb190cmFjazsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV9hc3BlY3RfcmF0aW8gPSBzdHJlYW0uc291cmNlX3N0cmVhbV9hc3BlY3RfcmF0aW87CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fcmFkaW8gPSBzdHJlYW0uc291cmNlX3N0cmVhbV9yYWRpbzsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV9vcmRlciA9IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX29yZGVyOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX2lzX2hpZGRlbiA9IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX2lzX2hpZGRlbjsKICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgIHN0cmVhbS5tb3ZpZV9uYW1lICE9PSB1bmRlZmluZWQgJiYKICAgICAgICAgICAgICBzdHJlYW0ubW92aWVfeWVhciAhPT0gdW5kZWZpbmVkCiAgICAgICAgICAgICkgewogICAgICAgICAgICAgIHN0cmVhbS5tb3ZpZV9uYW1lID0gc3RyZWFtLnNvdXJjZV9tb3ZpZV9uYW1lOwogICAgICAgICAgICAgIHN0cmVhbS5tb3ZpZV95ZWFyID0gc3RyZWFtLnNvdXJjZV9tb3ZpZV95ZWFyOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICBzdHJlYW0uc2VyaWVfbmFtZSAhPT0gdW5kZWZpbmVkICYmCiAgICAgICAgICAgICAgc3RyZWFtLnNlcmllX3NlYXNvbiAhPT0gdW5kZWZpbmVkICYmCiAgICAgICAgICAgICAgc3RyZWFtLnNlcmllX2VwaXNvZGUgIT09IHVuZGVmaW5lZAogICAgICAgICAgICApIHsKICAgICAgICAgICAgICBzdHJlYW0uc2VyaWVfbmFtZSA9IHN0cmVhbS5zb3VyY2Vfc2VyaWVfbmFtZTsKICAgICAgICAgICAgICBzdHJlYW0uc2VyaWVfc2Vhc29uID0gc3RyZWFtLnNvdXJjZV9zZXJpZV9zZWFzb247CiAgICAgICAgICAgICAgc3RyZWFtLnNlcmllX2VwaXNvZGUgPSBzdHJlYW0uc291cmNlX3NlcmllX2VwaXNvZGU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LAogICAgdG9nZ2xlR3JvdXBWaXNpYmlsaXR5KCkgewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBzLmluY2x1ZGVzKHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmlkKSkgewogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uZ3JvdXBfaXNfaGlkZGVuID0KICAgICAgICAgICAgIXRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmdyb3VwX2lzX2hpZGRlbjsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgIH0sCiAgICB0b2dnbGVTdHJlYW1WaXNpYmlsaXR5KCkgewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmICh0aGlzLmFjdGl2ZVN0cmVhbXMuaW5jbHVkZXModGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLmlkKSkgewogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLnN0cmVhbV9pc19oaWRkZW4gPQogICAgICAgICAgICAhdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLnN0cmVhbV9pc19oaWRkZW47CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgfSwKICAgIHRvZ2dsZVN0cmVhbVJhZGlvKCkgewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmICh0aGlzLmFjdGl2ZVN0cmVhbXMuaW5jbHVkZXModGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLmlkKSkgewogICAgICAgICAgaWYgKHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5zdHJlYW1fcmFkaW8gPT0gMCkgewogICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uc3RyZWFtX3JhZGlvID0gMTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5zdHJlYW1fcmFkaW8gPSAwOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgIH0sCiAgICBkZWxldGVTZWxlY3RlZEdyb3VwcygpIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3Vwcy5pbmNsdWRlcyh0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5pZCkpIHsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmdyb3VwX2lzX3JlbW92ZWQgPSAxOwogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgfSwKICAgIGRlbGV0ZVNlbGVjdGVkU3RyZWFtcygpIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAodGhpcy5hY3RpdmVTdHJlYW1zLmluY2x1ZGVzKHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5pZCkpIHsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5zdHJlYW1faXNfcmVtb3ZlZCA9IDE7CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgfSwKICAgIGxvYWRQbGF5bGlzdCh2YWwsIGdyb3VwX2luZGV4ID0gdW5kZWZpbmVkKSB7CiAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaWYgKHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCkgewogICAgICAgIHRoaXMuZG9TYXZlKCk7CiAgICAgIH0KICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5pZCA9IHZhbDsKICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAuZ2V0KGBlZGl0b3IvZ3JvdXBzLyR7dmFsfWApCiAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgaWYgKHJlcy5zdGF0dXMgPT09IHRydWUpIHsKICAgICAgICAgICAgdGhpcy51cGRhdGVHcm91cE9yZGVyKHJlcy5kYXRhKS50aGVuKChncm91cHMpID0+IHsKICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3VwcyA9IGdyb3Vwcy5tYXAoKGdyb3VwKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBncnAgPSBPYmplY3QuYXNzaWduKHt9LCBncm91cCk7CiAgICAgICAgICAgICAgICBncnAuc291cmNlX2dyb3VwX3BhcmVudF9jb2RlID0gZ3JvdXAuZ3JvdXBfcGFyZW50X2NvZGU7CiAgICAgICAgICAgICAgICBncnAuc291cmNlX2dyb3VwX2lzX2hpZGRlbiA9IGdyb3VwLmdyb3VwX2lzX2hpZGRlbjsKICAgICAgICAgICAgICAgIGdycC5zb3VyY2VfZ3JvdXBfbmFtZSA9IGdyb3VwLmdyb3VwX25hbWU7CiAgICAgICAgICAgICAgICBncnAuc291cmNlX2dyb3VwX3R5cGUgPSBncm91cC5ncm91cF90eXBlOwogICAgICAgICAgICAgICAgZ3JwLmdyb3VwX2lzX3JlbW92ZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIGdycC5tb2RpZmllZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgcmV0dXJuIGdycDsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBpZiAoZ3JvdXBzLmxlbmd0aCkgewogICAgICAgICAgICAgICAgaWYgKGdyb3VwX2luZGV4ID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5hY3RpdmVHcm91cCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzWzBdLmlkOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgdGhpcy5hY3RpdmVHcm91cCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2dyb3VwX2luZGV4XS5pZDsKICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkU3RyZWFtcygpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgfSk7CiAgICB9LAogICAgdG9nZ2xlR3JvdXBTZWxlY3Rpb24oaXRlbSkgewogICAgICBsZXQgaWR4ID0gdGhpcy5hY3RpdmVHcm91cHMuaW5kZXhPZihpdGVtKTsKICAgICAgaWYgKGlkeCAhPT0gLTEpIHsKICAgICAgICB0aGlzLmFjdGl2ZUdyb3Vwcy5zcGxpY2UoaWR4LCAxKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmFjdGl2ZUdyb3Vwcy5wdXNoKGl0ZW0pOwogICAgICB9CiAgICB9LAogICAgdG9nZ2xlU3RyZWFtU2VsZWN0aW9uKGl0ZW0pIHsKICAgICAgbGV0IGlkeCA9IHRoaXMuYWN0aXZlU3RyZWFtcy5pbmRleE9mKGl0ZW0pOwogICAgICBpZiAoaWR4ICE9PSAtMSkgewogICAgICAgIHRoaXMuYWN0aXZlU3RyZWFtcy5zcGxpY2UoaWR4LCAxKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmFjdGl2ZVN0cmVhbXMucHVzaChpdGVtKTsKICAgICAgfQogICAgfSwKICAgIHRvZ2dsZVJhZGlvYnJvd3NlclNlbGVjdGlvbihpdGVtKSB7CiAgICAgIGxldCBpZHggPSB0aGlzLnJhZGlvQnJvd3Nlci5hY3RpdmUuaW5kZXhPZihpdGVtKTsKICAgICAgaWYgKGlkeCAhPT0gLTEpIHsKICAgICAgICB0aGlzLnJhZGlvQnJvd3Nlci5hY3RpdmUuc3BsaWNlKGlkeCwgMSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuYWN0aXZlLnB1c2goaXRlbSk7CiAgICAgIH0KICAgIH0sCiAgICBpbmRleE9mR3JvdXAoZ3JvdXApIHsKICAgICAgcmV0dXJuIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLm1hcCgoZykgPT4gZy5pZCkuaW5kZXhPZihncm91cCk7CiAgICB9LAogICAgc2VsZWN0R3JvdXBSYW5nZVNlbGVjdGlvbihpdGVtKSB7CiAgICAgIGNvbnN0IGxhc3RJbmRleCA9IHRoaXMuaW5kZXhPZkdyb3VwKHRoaXMubGFzdFNlbGVjdGVkR3JvdXApOwogICAgICBjb25zdCBpdGVtSW5kZXggPSB0aGlzLmluZGV4T2ZHcm91cChpdGVtKTsKICAgICAgY29uc3QgZGlyID0gaXRlbUluZGV4ID4gbGFzdEluZGV4ID8gMSA6IC0xOwogICAgICBmb3IgKGxldCBpID0gbGFzdEluZGV4OyBpICE9IGl0ZW1JbmRleCArIGRpcjsgaSArPSBkaXIpIHsKICAgICAgICBpZiAoIXRoaXMuYWN0aXZlR3JvdXBzLmluY2x1ZGVzKHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmlkKSkgewogICAgICAgICAgdGhpcy5hY3RpdmVHcm91cHMucHVzaCh0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5pZCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgaW5kZXhPZlN0cmVhbShzdHJlYW0pIHsKICAgICAgcmV0dXJuIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5tYXAoKGcpID0+IGcuaWQpLmluZGV4T2Yoc3RyZWFtKTsKICAgIH0sCiAgICBzZWxlY3RTdHJlYW1SYW5nZVNlbGVjdGlvbihpdGVtKSB7CiAgICAgIGNvbnN0IGxhc3RJbmRleCA9IHRoaXMuaW5kZXhPZlN0cmVhbSh0aGlzLmxhc3RTZWxlY3RlZFN0cmVhbSk7CiAgICAgIGNvbnN0IGl0ZW1JbmRleCA9IHRoaXMuaW5kZXhPZlN0cmVhbShpdGVtKTsKICAgICAgY29uc3QgZGlyID0gaXRlbUluZGV4ID4gbGFzdEluZGV4ID8gMSA6IC0xOwogICAgICBmb3IgKGxldCBpID0gbGFzdEluZGV4OyBpICE9IGl0ZW1JbmRleCArIGRpcjsgaSArPSBkaXIpIHsKICAgICAgICBpZiAoIXRoaXMuYWN0aXZlU3RyZWFtcy5pbmNsdWRlcyh0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uaWQpKSB7CiAgICAgICAgICB0aGlzLmFjdGl2ZVN0cmVhbXMucHVzaCh0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uaWQpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHNlbGVjdFJhZGlvYnJvd3NlclJhbmdlU2VsZWN0aW9uKGluZGV4KSB7CiAgICAgIGNvbnN0IGxhc3RJbmRleCA9CiAgICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuYWN0aXZlW3RoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZS5sZW5ndGggLSAxXTsKICAgICAgY29uc3QgZGlyID0gaW5kZXggPiBsYXN0SW5kZXggPyAxIDogLTE7CiAgICAgIGZvciAobGV0IGkgPSBsYXN0SW5kZXg7IGkgIT0gaW5kZXggKyBkaXI7IGkgKz0gZGlyKSB7CiAgICAgICAgaWYgKCF0aGlzLnJhZGlvQnJvd3Nlci5hY3RpdmUuaW5jbHVkZXMoaSkpIHsKICAgICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZS5wdXNoKGkpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHNlbGVjdEdyb3VwU2VsZWN0aW9uKGl0ZW0pIHsKICAgICAgdGhpcy5hY3RpdmVHcm91cHMubGVuZ3RoID0gMDsKICAgICAgdGhpcy5hY3RpdmVHcm91cHMucHVzaChpdGVtKTsKICAgIH0sCiAgICBzZWxlY3RTdHJlYW1TZWxlY3Rpb24oaXRlbSkgewogICAgICB0aGlzLmFjdGl2ZVN0cmVhbXMubGVuZ3RoID0gMDsKICAgICAgdGhpcy5hY3RpdmVTdHJlYW1zLnB1c2goaXRlbSk7CiAgICB9LAogICAgc2VsZWN0UmFkaW9icm93c2VyU2VsZWN0aW9uKGl0ZW0pIHsKICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuYWN0aXZlLmxlbmd0aCA9IDA7CiAgICAgIHRoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZS5wdXNoKGl0ZW0pOwogICAgfSwKICAgIGZpbmRBbmRSZXBsYWNlTW9kYWwoc2hvdywgdHlwZSA9IDEpIHsKICAgICAgdGhpcy5maW5kUmVwbGFjZS50eXBlID0gdHlwZTsKICAgICAgdGhpcy5maW5kUmVwbGFjZS5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgZmluZEFuZFJlcGxhY2UoKSB7CiAgICAgIGxldCBvcHRpb25zID0gIiI7CiAgICAgIGlmICh0aGlzLmZpbmRSZXBsYWNlLnJlcGxhY2VBbGwpIHsKICAgICAgICBvcHRpb25zICs9ICJnIjsKICAgICAgfQogICAgICBpZiAodGhpcy5maW5kUmVwbGFjZS5pZ25vcmVDYXNlKSB7CiAgICAgICAgb3B0aW9ucyArPSAiaSI7CiAgICAgIH0KICAgICAgbGV0IHJlID0gbmV3IFJlZ0V4cCh0aGlzLmZpbmRSZXBsYWNlLmZyb20ucmVwbGFjZSgifCIsICJcXHwiKSwgb3B0aW9ucyk7CiAgICAgIHN3aXRjaCAocGFyc2VJbnQodGhpcy5maW5kUmVwbGFjZS50eXBlKSkgewogICAgICAgIC8vIEdyb3VwCiAgICAgICAgY2FzZSAxOgogICAgICAgICAgaWYgKHBhcnNlSW50KHRoaXMuZmluZFJlcGxhY2Uuc2VsZWN0ZWRPbmx5KSA9PT0gMSkgewogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgdGhpcy5hY3RpdmVHcm91cHMuaW5jbHVkZXModGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uaWQpCiAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5ncm91cF9uYW1lID0KICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uZ3JvdXBfbmFtZS5yZXBsYWNlKAogICAgICAgICAgICAgICAgICAgIHJlLAogICAgICAgICAgICAgICAgICAgIHRoaXMuZmluZFJlcGxhY2UudG8KICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuZmlsdGVyZWRHcm91cHMubWFwKChncm91cCkgPT4gewogICAgICAgICAgICAgIGdyb3VwLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICBncm91cC5ncm91cF9uYW1lID0gZ3JvdXAuZ3JvdXBfbmFtZS5yZXBsYWNlKAogICAgICAgICAgICAgICAgcmUsCiAgICAgICAgICAgICAgICB0aGlzLmZpbmRSZXBsYWNlLnRvCiAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKCiAgICAgICAgLy8gU3RyZWFtcwogICAgICAgIGNhc2UgMjoKICAgICAgICAgIGlmIChwYXJzZUludCh0aGlzLmZpbmRSZXBsYWNlLnNlbGVjdGVkT25seSkgPT09IDEpIHsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZVN0cmVhbXMuaW5jbHVkZXModGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLmlkKQogICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAxKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5zdHJlYW1fdHZnX25hbWUgPQogICAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5zdHJlYW1fdHZnX25hbWUucmVwbGFjZSgKICAgICAgICAgICAgICAgICAgICAgIHJlLAogICAgICAgICAgICAgICAgICAgICAgdGhpcy5maW5kUmVwbGFjZS50bwogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDIpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLm1vdmllX25hbWUgPQogICAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5tb3ZpZV9uYW1lLnJlcGxhY2UoCiAgICAgICAgICAgICAgICAgICAgICByZSwKICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmluZFJlcGxhY2UudG8KICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAzKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5zZXJpZV9uYW1lID0KICAgICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uc2VyaWVfbmFtZS5yZXBsYWNlKAogICAgICAgICAgICAgICAgICAgICAgcmUsCiAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZpbmRSZXBsYWNlLnRvCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuZmlsdGVyZWRTdHJlYW1zLm1hcCgoc3RyZWFtKSA9PiB7CiAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAxKSB7CiAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfbmFtZSA9IHN0cmVhbS5zdHJlYW1fdHZnX25hbWUucmVwbGFjZSgKICAgICAgICAgICAgICAgICAgcmUsCiAgICAgICAgICAgICAgICAgIHRoaXMuZmluZFJlcGxhY2UudG8KICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMikgewogICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHN0cmVhbS5tb3ZpZV9uYW1lID0gc3RyZWFtLm1vdmllX25hbWUucmVwbGFjZSgKICAgICAgICAgICAgICAgICAgcmUsCiAgICAgICAgICAgICAgICAgIHRoaXMuZmluZFJlcGxhY2UudG8KICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMykgewogICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHN0cmVhbS5zZXJpZV9uYW1lID0gc3RyZWFtLnNlcmllX25hbWUucmVwbGFjZSgKICAgICAgICAgICAgICAgICAgcmUsCiAgICAgICAgICAgICAgICAgIHRoaXMuZmluZFJlcGxhY2UudG8KICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICAgIHRoaXMuZmluZFJlcGxhY2UubW9kYWwgPSBmYWxzZTsKICAgIH0sCiAgICBwcmVmaXhTdWZmaXhNb2RhbChzaG93LCB0eXBlID0gMSkgewogICAgICB0aGlzLnByZWZpeFN1ZmZpeC50eXBlID0gdHlwZTsKICAgICAgdGhpcy5wcmVmaXhTdWZmaXgubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGFkZFByZWZpeFN1ZmZpeCgpIHsKICAgICAgbGV0IHByZWZpeCA9IHRoaXMucHJlZml4U3VmZml4LnByZWZpeDsKICAgICAgbGV0IHN1ZmZpeCA9IHRoaXMucHJlZml4U3VmZml4LnN1ZmZpeDsKICAgICAgc3dpdGNoIChwYXJzZUludCh0aGlzLnByZWZpeFN1ZmZpeC50eXBlKSkgewogICAgICAgIC8vIEdyb3VwCiAgICAgICAgY2FzZSAxOgogICAgICAgICAgaWYgKHBhcnNlSW50KHRoaXMucHJlZml4U3VmZml4LnNlbGVjdGVkT25seSkgPT09IDEpIHsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlR3JvdXBzLmluY2x1ZGVzKHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmlkKQogICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uZ3JvdXBfbmFtZSA9CiAgICAgICAgICAgICAgICAgIHByZWZpeCArIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmdyb3VwX25hbWUgKyBzdWZmaXg7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLmZpbHRlcmVkR3JvdXBzLm1hcCgoZ3JvdXApID0+IHsKICAgICAgICAgICAgICBncm91cC5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgZ3JvdXAuZ3JvdXBfbmFtZSA9IHByZWZpeCArIGdyb3VwLmdyb3VwX25hbWUgKyBzdWZmaXg7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CgogICAgICAgIC8vIFN0cmVhbQogICAgICAgIGNhc2UgMjoKICAgICAgICAgIGlmIChwYXJzZUludCh0aGlzLnByZWZpeFN1ZmZpeC5zZWxlY3RlZE9ubHkpID09PSAxKSB7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgdGhpcy5hY3RpdmVTdHJlYW1zLmluY2x1ZGVzKHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5pZCkKICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMSkgewogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uc3RyZWFtX3R2Z19uYW1lID0KICAgICAgICAgICAgICAgICAgICBwcmVmaXggKwogICAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5zdHJlYW1fdHZnX25hbWUgKwogICAgICAgICAgICAgICAgICAgIHN1ZmZpeDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMikgewogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0ubW92aWVfbmFtZSA9CiAgICAgICAgICAgICAgICAgICAgcHJlZml4ICsgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLm1vdmllX25hbWUgKyBzdWZmaXg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDMpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLnNlcmllX25hbWUgPQogICAgICAgICAgICAgICAgICAgIHByZWZpeCArIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5zZXJpZV9uYW1lICsgc3VmZml4OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAxKSB7CiAgICAgICAgICAgICAgdGhpcy5maWx0ZXJlZFN0cmVhbXMubWFwKChzdHJlYW0pID0+IHsKICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lID0KICAgICAgICAgICAgICAgICAgcHJlZml4ICsgc3RyZWFtLnN0cmVhbV90dmdfbmFtZSArIHN1ZmZpeDsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDIpIHsKICAgICAgICAgICAgICB0aGlzLmZpbHRlcmVkU3RyZWFtcy5tYXAoKHN0cmVhbSkgPT4gewogICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHN0cmVhbS5tb3ZpZV9uYW1lID0gcHJlZml4ICsgc3RyZWFtLm1vdmllX25hbWUgKyBzdWZmaXg7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAzKSB7CiAgICAgICAgICAgICAgdGhpcy5maWx0ZXJlZFN0cmVhbXMubWFwKChzdHJlYW0pID0+IHsKICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICBzdHJlYW0uc2VyaWVfbmFtZSA9IHByZWZpeCArIHN0cmVhbS5zZXJpZV9uYW1lICsgc3VmZml4OwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgICB0aGlzLnByZWZpeFN1ZmZpeC5tb2RhbCA9IGZhbHNlOwogICAgfSwKICAgIGNvbnZlcnRDYXNlTW9kYWwoc2hvdywgdHlwZSkgewogICAgICB0aGlzLmNvbnZlcnRDYXNlLnR5cGUgPSB0eXBlOwogICAgICB0aGlzLmNvbnZlcnRDYXNlLm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBjaGFuZ2VDYXNlKCkgewogICAgICBsZXQgbWV0aG9kID0gdGhpcy5jb252ZXJ0Q2FzZS5tZXRob2Q7CiAgICAgIGxldCBncm91cHM7CiAgICAgIGxldCBzdHJlYW1zOwogICAgICBpZiAocGFyc2VJbnQodGhpcy5jb252ZXJ0Q2FzZS5zZWxlY3RlZE9ubHkpID09PSAxKSB7CiAgICAgICAgZ3JvdXBzID0gdGhpcy5maWx0ZXJlZEdyb3Vwcy5maWx0ZXIoKGdyb3VwKSA9PiB7CiAgICAgICAgICByZXR1cm4gdGhpcy5hY3RpdmVHcm91cHMuaW5jbHVkZXMoZ3JvdXAuaWQpOwogICAgICAgIH0pOwogICAgICAgIHN0cmVhbXMgPSB0aGlzLmZpbHRlcmVkU3RyZWFtcy5maWx0ZXIoKHN0cmVhbSkgPT4gewogICAgICAgICAgcmV0dXJuIHRoaXMuYWN0aXZlU3RyZWFtcy5pbmNsdWRlcyhzdHJlYW0uaWQpOwogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIGdyb3VwcyA9IHRoaXMuZmlsdGVyZWRHcm91cHM7CiAgICAgICAgc3RyZWFtcyA9IHRoaXMuZmlsdGVyZWRTdHJlYW1zOwogICAgICB9CiAgICAgIHN3aXRjaCAocGFyc2VJbnQodGhpcy5jb252ZXJ0Q2FzZS50eXBlKSkgewogICAgICAgIC8vIENhdGVnb3JpZXMKICAgICAgICBjYXNlIDE6CiAgICAgICAgICBncm91cHMubWFwKChncm91cCkgPT4gewogICAgICAgICAgICBzd2l0Y2ggKHBhcnNlSW50KG1ldGhvZCkpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBncm91cC5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICBncm91cC5ncm91cF9uYW1lID0gZ3JvdXAuZ3JvdXBfbmFtZS50aXRsZUNhc2UoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgIGdyb3VwLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGdyb3VwLmdyb3VwX25hbWUgPSBncm91cC5ncm91cF9uYW1lLnRvVXBwZXJDYXNlKCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICBncm91cC5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICBncm91cC5ncm91cF9uYW1lID0gZ3JvdXAuZ3JvdXBfbmFtZS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIC8vIFN0cmVhbXMKICAgICAgICBjYXNlIDI6CiAgICAgICAgICBzdHJlYW1zLm1hcCgoc3RyZWFtKSA9PiB7CiAgICAgICAgICAgIHN3aXRjaCAocGFyc2VJbnQobWV0aG9kKSkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMSkgewogICAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lID0gc3RyZWFtLnN0cmVhbV90dmdfbmFtZS50aXRsZUNhc2UoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMikgewogICAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICBzdHJlYW0ubW92aWVfbmFtZSA9IHN0cmVhbS5tb3ZpZV9uYW1lLnRpdGxlQ2FzZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAzKSB7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5zZXJpZV9uYW1lID0gc3RyZWFtLnNlcmllX25hbWUudGl0bGVDYXNlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDEpIHsKICAgICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfbmFtZSA9IHN0cmVhbS5zdHJlYW1fdHZnX25hbWUudG9VcHBlckNhc2UoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMikgewogICAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICBzdHJlYW0ubW92aWVfbmFtZSA9IHN0cmVhbS5tb3ZpZV9uYW1lLnRvVXBwZXJDYXNlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDMpIHsKICAgICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgc3RyZWFtLnNlcmllX25hbWUgPSBzdHJlYW0uc2VyaWVfbmFtZS50b1VwcGVyQ2FzZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAxKSB7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX25hbWUgPSBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDIpIHsKICAgICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgc3RyZWFtLm1vdmllX25hbWUgPSBzdHJlYW0ubW92aWVfbmFtZS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAzKSB7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5zZXJpZV9uYW1lID0gc3RyZWFtLnNlcmllX25hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICAgIHRoaXMuY29udmVydENhc2UubW9kYWwgPSBmYWxzZTsKICAgIH0sCiAgICBlZGl0R3JvdXBNb2RhbChzaG93KSB7CiAgICAgIGxldCBpbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleCgKICAgICAgICAoZ3JvdXApID0+IGdyb3VwLmlkID09PSB0aGlzLmFjdGl2ZUdyb3Vwc1swXQogICAgICApOwogICAgICBsZXQgZ3JvdXAgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpbmRleF07CiAgICAgIGlmIChncm91cCkgewogICAgICAgIHRoaXMuZ3JvdXBFZGl0b3IuaWQgPSB0aGlzLmFjdGl2ZUdyb3Vwc1swXTsKICAgICAgICB0aGlzLmdyb3VwRWRpdG9yLmdyb3VwX3R5cGUgPSBncm91cC5ncm91cF90eXBlOwogICAgICAgIHRoaXMuZ3JvdXBFZGl0b3IuZ3JvdXBfbmFtZSA9IGdyb3VwLmdyb3VwX25hbWU7CiAgICAgICAgdGhpcy5ncm91cEVkaXRvci5ncm91cF9pc19oaWRkZW4gPSBncm91cC5ncm91cF9pc19oaWRkZW47CiAgICAgICAgdGhpcy5ncm91cEVkaXRvci5ncm91cF9wYXJlbnRfY29kZSA9IGdyb3VwLmdyb3VwX3BhcmVudF9jb2RlOwogICAgICAgIHRoaXMuZ3JvdXBFZGl0b3IubW9kYWwgPSBzaG93OwogICAgICB9CiAgICB9LAogICAgZWRpdFN0cmVhbU1vZGFsKHNob3cpIHsKICAgICAgbGV0IGluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmZpbmRJbmRleCgKICAgICAgICAoc3RyZWFtKSA9PiBzdHJlYW0uaWQgPT09IHRoaXMuYWN0aXZlU3RyZWFtc1swXQogICAgICApOwogICAgICBsZXQgc3RyZWFtID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XTsKICAgICAgaWYgKHN0cmVhbSkgewogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLmlkID0gdGhpcy5hY3RpdmVTdHJlYW1zWzBdOwogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV90dmdfbmFtZSA9IHN0cmVhbS5zdHJlYW1fdHZnX25hbWU7CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX3R2Z19pZCA9IHN0cmVhbS5zdHJlYW1fdHZnX2lkOwogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV90dmdfbG9nbyA9IHN0cmVhbS5zdHJlYW1fdHZnX2xvZ287CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX3BhcmVudF9jb2RlID0gc3RyZWFtLnN0cmVhbV9wYXJlbnRfY29kZTsKICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1fcmFkaW8gPSBzdHJlYW0uc3RyZWFtX3JhZGlvOwogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV9pc19oaWRkZW4gPSBzdHJlYW0uc3RyZWFtX2lzX2hpZGRlbjsKICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zb3VyY2Vfc3RyZWFtX3VybCA9IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX3VybDsKICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1faXNfY3VzdG9tID0gc3RyZWFtLnN0cmVhbV9pc19jdXN0b207CiAgICAgICAgaWYgKAogICAgICAgICAgc3RyZWFtLm1vdmllX25hbWUgIT09IHVuZGVmaW5lZCAmJgogICAgICAgICAgc3RyZWFtLm1vdmllX3llYXIgIT09IHVuZGVmaW5lZCAmJgogICAgICAgICAgc3RyZWFtLnRtZGJfaWQgIT09IHVuZGVmaW5lZAogICAgICAgICkgewogICAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3IubW92aWVfbmFtZSA9IHN0cmVhbS5tb3ZpZV9uYW1lOwogICAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3IubW92aWVfeWVhciA9IHN0cmVhbS5tb3ZpZV95ZWFyOwogICAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3IudG1kYl9pZCA9IHN0cmVhbS50bWRiX2lkOwogICAgICAgIH0KICAgICAgICBpZiAoCiAgICAgICAgICBzdHJlYW0uc2VyaWVfbmFtZSAhPT0gdW5kZWZpbmVkICYmCiAgICAgICAgICBzdHJlYW0uc2VyaWVfc2Vhc29uICE9PSB1bmRlZmluZWQgJiYKICAgICAgICAgIHN0cmVhbS5zZXJpZV9lcGlzb2RlICE9PSB1bmRlZmluZWQKICAgICAgICApIHsKICAgICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnNlcmllX25hbWUgPSBzdHJlYW0uc2VyaWVfbmFtZTsKICAgICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnNlcmllX3NlYXNvbiA9IHN0cmVhbS5zZXJpZV9zZWFzb247CiAgICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zZXJpZV9lcGlzb2RlID0gc3RyZWFtLnNlcmllX2VwaXNvZGU7CiAgICAgICAgfQogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLm1vZGFsID0gc2hvdzsKICAgICAgfQogICAgfSwKICAgIGVkaXRHcm91cCgpIHsKICAgICAgbGV0IGluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KAogICAgICAgIChncm91cCkgPT4gZ3JvdXAuaWQgPT09IHRoaXMuZ3JvdXBFZGl0b3IuaWQKICAgICAgKTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaW5kZXhdLmdyb3VwX3R5cGUgPQogICAgICAgIHRoaXMuZ3JvdXBFZGl0b3IuZ3JvdXBfdHlwZTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaW5kZXhdLmdyb3VwX25hbWUgPQogICAgICAgIHRoaXMuZ3JvdXBFZGl0b3IuZ3JvdXBfbmFtZTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaW5kZXhdLmdyb3VwX2lzX2hpZGRlbiA9CiAgICAgICAgdGhpcy5ncm91cEVkaXRvci5ncm91cF9pc19oaWRkZW47CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2luZGV4XS5ncm91cF9wYXJlbnRfY29kZSA9CiAgICAgICAgdGhpcy5ncm91cEVkaXRvci5ncm91cF9wYXJlbnRfY29kZTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaW5kZXhdLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgICAgdGhpcy5ncm91cEVkaXRvci5tb2RhbCA9IGZhbHNlOwogICAgfSwKICAgIGVkaXRTdHJlYW0oKSB7CiAgICAgIGxldCBpbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5maW5kSW5kZXgoCiAgICAgICAgKHN0cmVhbSkgPT4gc3RyZWFtLmlkID09PSB0aGlzLmFjdGl2ZVN0cmVhbXNbMF0KICAgICAgKTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zdHJlYW1fdHZnX25hbWUgPQogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV90dmdfbmFtZTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zdHJlYW1fdHZnX2lkID0KICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1fdHZnX2lkOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnN0cmVhbV90dmdfbG9nbyA9CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX3R2Z19sb2dvOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnN0cmVhbV9wYXJlbnRfY29kZSA9CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX3BhcmVudF9jb2RlOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnN0cmVhbV9pc19oaWRkZW4gPQogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV9pc19oaWRkZW47CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc3RyZWFtX3JhZGlvID0KICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1fcmFkaW87CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc291cmNlX3N0cmVhbV91cmwgPQogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnNvdXJjZV9zdHJlYW1fdXJsOwogICAgICBpZiAoCiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5tb3ZpZV9uYW1lICE9PSB1bmRlZmluZWQgJiYKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLm1vdmllX3llYXIgIT09IHVuZGVmaW5lZCAmJgogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0udG1kYl9pZCAhPT0gdW5kZWZpbmVkCiAgICAgICkgewogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0ubW92aWVfbmFtZSA9CiAgICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5tb3ZpZV9uYW1lOwogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0ubW92aWVfeWVhciA9CiAgICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5tb3ZpZV95ZWFyOwogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0udG1kYl9pZCA9IHRoaXMuc3RyZWFtRWRpdG9yLnRtZGJfaWQ7CiAgICAgIH0KICAgICAgaWYgKAogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc2VyaWVfbmFtZSAhPT0gdW5kZWZpbmVkICYmCiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zZXJpZV9zZWFzb24gIT09IHVuZGVmaW5lZCAmJgogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc2VyaWVfZXBpc29kZSAhPT0gdW5kZWZpbmVkCiAgICAgICkgewogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc2VyaWVfbmFtZSA9CiAgICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zZXJpZV9uYW1lOwogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc2VyaWVfc2Vhc29uID0KICAgICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnNlcmllX3NlYXNvbjsKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnNlcmllX2VwaXNvZGUgPQogICAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc2VyaWVfZXBpc29kZTsKICAgICAgfQogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgICAgdGhpcy5zdHJlYW1FZGl0b3IubW9kYWwgPSBmYWxzZTsKICAgIH0sCiAgICBzb3J0R3JvdXBBbHBoYVVwKCkgewogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3VwcyA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLnNvcnQoKGEsIGIpID0+CiAgICAgICAgYi5ncm91cF9uYW1lID4gYS5ncm91cF9uYW1lID8gMSA6IGEuZ3JvdXBfbmFtZSA+IGIuZ3JvdXBfbmFtZSA/IC0xIDogMAogICAgICApOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5tYXAoKGdyb3VwKSA9PiAoZ3JvdXAubW9kaWZpZWQgPSB0cnVlKSk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICB9LAogICAgc29ydEdyb3VwQWxwaGFEb3duKCkgewogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3VwcyA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLnNvcnQoKGEsIGIpID0+CiAgICAgICAgYS5ncm91cF9uYW1lID4gYi5ncm91cF9uYW1lID8gMSA6IGIuZ3JvdXBfbmFtZSA+IGEuZ3JvdXBfbmFtZSA/IC0xIDogMAogICAgICApOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5tYXAoKGdyb3VwKSA9PiAoZ3JvdXAubW9kaWZpZWQgPSB0cnVlKSk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICB9LAogICAgc29ydEdyb3VwVHlwZVVwKCkgewogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3VwcyA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLnNvcnQoKGEsIGIpID0+CiAgICAgICAgYi5ncm91cF90eXBlID4gYS5ncm91cF90eXBlID8gMSA6IGEuZ3JvdXBfdHlwZSA+IGIuZ3JvdXBfdHlwZSA/IC0xIDogMAogICAgICApOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5tYXAoKGdyb3VwKSA9PiAoZ3JvdXAubW9kaWZpZWQgPSB0cnVlKSk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICB9LAogICAgc29ydEdyb3VwVHlwZURvd24oKSB7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuc29ydCgoYSwgYikgPT4KICAgICAgICBhLmdyb3VwX3R5cGUgPiBiLmdyb3VwX3R5cGUgPyAxIDogYi5ncm91cF90eXBlID4gYS5ncm91cF90eXBlID8gLTEgOiAwCiAgICAgICk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLm1hcCgoZ3JvdXApID0+IChncm91cC5tb2RpZmllZCA9IHRydWUpKTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgIH0sCiAgICBzb3J0U3RyZWFtQWxwaGFVcCgpIHsKICAgICAgLy9FUk5TVCBISUVSCiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcyA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5zb3J0KChhLCBiKSA9PiB7CiAgICAgICAgc3dpdGNoICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSkgewogICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICByZXR1cm4gYi5zdHJlYW1fdHZnX25hbWUgPiBhLnN0cmVhbV90dmdfbmFtZQogICAgICAgICAgICAgID8gMQogICAgICAgICAgICAgIDogYS5zdHJlYW1fdHZnX25hbWUgPiBiLnN0cmVhbV90dmdfbmFtZQogICAgICAgICAgICAgID8gLTEKICAgICAgICAgICAgICA6IDA7CiAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgIHJldHVybiBiLm1vdmllX25hbWUgPiBhLm1vdmllX25hbWUKICAgICAgICAgICAgICA/IDEKICAgICAgICAgICAgICA6IGEubW92aWVfbmFtZSA+IGIubW92aWVfbmFtZQogICAgICAgICAgICAgID8gLTEKICAgICAgICAgICAgICA6IDA7CiAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgIHJldHVybiBiLnNlcmllX25hbWUgPiBhLnNlcmllX25hbWUKICAgICAgICAgICAgICA/IDEKICAgICAgICAgICAgICA6IGEuc2VyaWVfbmFtZSA+IGIuc2VyaWVfbmFtZQogICAgICAgICAgICAgID8gLTEKICAgICAgICAgICAgICA6IDA7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLm1hcCgoc3RyZWFtKSA9PiAoc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZSkpOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgfSwKICAgIHNvcnRTdHJlYW1BbHBoYURvd24oKSB7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcyA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5zb3J0KChhLCBiKSA9PiB7CiAgICAgICAgc3dpdGNoICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSkgewogICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICByZXR1cm4gYS5zdHJlYW1fdHZnX25hbWUgPiBiLnN0cmVhbV90dmdfbmFtZQogICAgICAgICAgICAgID8gMQogICAgICAgICAgICAgIDogYi5zdHJlYW1fdHZnX25hbWUgPiBhLnN0cmVhbV90dmdfbmFtZQogICAgICAgICAgICAgID8gLTEKICAgICAgICAgICAgICA6IDA7CiAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgIHJldHVybiBhLm1vdmllX25hbWUgPiBiLm1vdmllX25hbWUKICAgICAgICAgICAgICA/IDEKICAgICAgICAgICAgICA6IGIubW92aWVfbmFtZSA+IGEubW92aWVfbmFtZQogICAgICAgICAgICAgID8gLTEKICAgICAgICAgICAgICA6IDA7CiAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgIHJldHVybiBhLnNlcmllX25hbWUgPiBiLnNlcmllX25hbWUKICAgICAgICAgICAgICA/IDEKICAgICAgICAgICAgICA6IGIuc2VyaWVfbmFtZSA+IGEuc2VyaWVfbmFtZQogICAgICAgICAgICAgID8gLTEKICAgICAgICAgICAgICA6IDA7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLm1hcCgoc3RyZWFtKSA9PiAoc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZSkpOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgfSwKICAgIHNvcnRTdHJlYW1IaWRkZW5VcCgpIHsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLnNvcnQoKGEsIGIpID0+CiAgICAgICAgYi5zdHJlYW1faXNfaGlkZGVuID4gYS5zdHJlYW1faXNfaGlkZGVuCiAgICAgICAgICA/IDEKICAgICAgICAgIDogYS5zdHJlYW1faXNfaGlkZGVuID4gYi5zdHJlYW1faXNfaGlkZGVuCiAgICAgICAgICA/IC0xCiAgICAgICAgICA6IDAKICAgICAgKTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLm1hcCgoZ3JvdXApID0+IChncm91cC5tb2RpZmllZCA9IHRydWUpKTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgIH0sCiAgICBzb3J0U3RyZWFtSGlkZGVuRG93bigpIHsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLnNvcnQoKGEsIGIpID0+CiAgICAgICAgYS5zdHJlYW1faXNfaGlkZGVuID4gYi5zdHJlYW1faXNfaGlkZGVuCiAgICAgICAgICA/IDEKICAgICAgICAgIDogYi5zdHJlYW1faXNfaGlkZGVuID4gYS5zdHJlYW1faXNfaGlkZGVuCiAgICAgICAgICA/IC0xCiAgICAgICAgICA6IDAKICAgICAgKTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLm1hcCgoZ3JvdXApID0+IChncm91cC5tb2RpZmllZCA9IHRydWUpKTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgIH0sCiAgICBhZGRHcm91cCgpIHsKICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZQogICAgICAgIC5wb3N0KCJlZGl0b3IvYWRkLWdyb3VwIiwgeyBwbGF5bGlzdF9pZDogdGhpcy5wbGF5bGlzdEVkaXRvci5pZCB9KQogICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICBpZiAocmVzLnN0YXR1cyA9PT0gdHJ1ZSAmJiByZXMuZGF0YSkgewogICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5wdXNoKHJlcy5kYXRhKTsKICAgICAgICAgICAgICB0aGlzLmFjdGl2ZUdyb3VwID0KICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzWwogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5sZW5ndGggLSAxCiAgICAgICAgICAgICAgICBdLmlkOwogICAgICAgICAgICAgIHRoaXMuYWN0aXZlR3JvdXBzID0gWwogICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbCiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmxlbmd0aCAtIDEKICAgICAgICAgICAgICAgIF0uaWQsCiAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgICByZXNvbHZlKCk7CiAgICAgICAgICAgIH0pLnRoZW4oKCkgPT4gewogICAgICAgICAgICAgIHRoaXMuZWRpdEdyb3VwTW9kYWwodHJ1ZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB0aGlzLiRub3RpZnkoCiAgICAgICAgICAgICJlcnJvciIsCiAgICAgICAgICAgIHRoaXMuJHQoInByb2ZpbGUuZmFpbGVkIiksCiAgICAgICAgICAgIHRoaXMuJHQoImVkaXRvci5hZGQtZ3JvdXAtZXJyb3IiKSwKICAgICAgICAgICAgImxhLXVzZXItc2hpZWxkIiwKICAgICAgICAgICAgeyBkdXJhdGlvbjogNTAwMCwgcGVybWFuZW50OiBmYWxzZSB9CiAgICAgICAgICApOwogICAgICAgIH0pOwogICAgfSwKICAgIGFkZFN0cmVhbSgpIHsKICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZQogICAgICAgIC5wb3N0KCJlZGl0b3IvYWRkLXN0cmVhbSIsIHsKICAgICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgZ3JvdXBfaWQ6IHRoaXMuZ2V0R3JvdXBXaXRoSWQodGhpcy5hY3RpdmVHcm91cCkuaWQsCiAgICAgICAgICBzdHJlYW1fdHlwZTogdGhpcy5nZXRHcm91cFdpdGhJZCh0aGlzLmFjdGl2ZUdyb3VwKS5ncm91cF90eXBlLAogICAgICAgIH0pCiAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIGlmIChyZXMuc3RhdHVzID09PSB0cnVlICYmIHJlcy5kYXRhKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy51bnNoaWZ0KHJlcy5kYXRhKTsKICAgICAgICAgICAgICB0aGlzLmFjdGl2ZVN0cmVhbSA9CiAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbCiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGggLSAxCiAgICAgICAgICAgICAgICBdLmlkOwogICAgICAgICAgICAgIHRoaXMuYWN0aXZlU3RyZWFtcyA9IFsKICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1sKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aCAtIDEKICAgICAgICAgICAgICAgIF0uaWQsCiAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgICByZXNvbHZlKCk7CiAgICAgICAgICAgIH0pLnRoZW4oKCkgPT4gewogICAgICAgICAgICAgIHRoaXMuZWRpdFN0cmVhbU1vZGFsKHRydWUpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgdGhpcy4kbm90aWZ5KAogICAgICAgICAgICAiZXJyb3IiLAogICAgICAgICAgICB0aGlzLiR0KCJwcm9maWxlLmZhaWxlZCIpLAogICAgICAgICAgICB0aGlzLiR0KCJlZGl0b3IuYWRkLXN0cmVhbS1lcnJvciIpLAogICAgICAgICAgICAibGEtdXNlci1zaGllbGQiLAogICAgICAgICAgICB7IGR1cmF0aW9uOiA1MDAwLCBwZXJtYW5lbnQ6IGZhbHNlIH0KICAgICAgICAgICk7CiAgICAgICAgfSk7CiAgICB9LAogICAgbG9hZFN0cmVhbXMoKSB7CiAgICAgIHRoaXMuYWN0aXZlU3RyZWFtID0gLTE7CiAgICAgIHRoaXMuYWN0aXZlU3RyZWFtcyA9IFtdOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMgPSBbXTsKICAgICAgbGV0IGluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KAogICAgICAgIChncm91cCkgPT4gZ3JvdXAuaWQgPT09IHRoaXMuYWN0aXZlR3JvdXAKICAgICAgKTsKICAgICAgbGV0IGdyb3VwID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaW5kZXhdOwogICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGh0dHBTZXJ2aWNlCiAgICAgICAgLmdldCgKICAgICAgICAgIGBlZGl0b3Ivc3RyZWFtcy8ke3RoaXMucGxheWxpc3RFZGl0b3IuaWR9LyR7Z3JvdXAuaWR9LyR7Z3JvdXAuZ3JvdXBfdHlwZX1gCiAgICAgICAgKQogICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgIGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wID0gMDsKICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3AgPSAwOwogICAgICAgICAgaWYgKHJlcy5zdGF0dXMgPT09IHRydWUpIHsKICAgICAgICAgICAgbGV0IHN0cmVhbXMgPSByZXMuZGF0YS5tYXAoKHN0cmVhbSkgPT4gewogICAgICAgICAgICAgIGNvbnN0IHN0ciA9IE9iamVjdC5hc3NpZ24oe30sIHN0cmVhbSk7CiAgICAgICAgICAgICAgc3RyLnNvdXJjZV9zdHJlYW1fdHZnX25hbWUgPSBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lOwogICAgICAgICAgICAgIHN0ci5zb3VyY2Vfc3RyZWFtX3R2Z19pZCA9IHN0cmVhbS5zdHJlYW1fdHZnX2lkOwogICAgICAgICAgICAgIHN0ci5zb3VyY2Vfc3RyZWFtX3R2Z19sb2dvID0gc3RyZWFtLnN0cmVhbV90dmdfbG9nbzsKICAgICAgICAgICAgICBzdHIuc291cmNlX3N0cmVhbV90dmdfY2hubyA9IHN0cmVhbS5zdHJlYW1fdHZnX2Nobm87CiAgICAgICAgICAgICAgc3RyLnNvdXJjZV9zdHJlYW1fdHZnX3NoaWZ0ID0gc3RyZWFtLnN0cmVhbV90dmdfc2hpZnQ7CiAgICAgICAgICAgICAgc3RyLnNvdXJjZV9zdHJlYW1fcGFyZW50X2NvZGUgPSBzdHJlYW0uc3RyZWFtX3BhcmVudF9jb2RlOwogICAgICAgICAgICAgIHN0ci5zb3VyY2Vfc3RyZWFtX2F1ZGlvX3RyYWNrID0gc3RyZWFtLnN0cmVhbV9hdWRpb190cmFjazsKICAgICAgICAgICAgICBzdHIuc291cmNlX3N0cmVhbV9hc3BlY3RfcmF0aW8gPSBzdHJlYW0uc3RyZWFtX2FzcGVjdF9yYXRpbzsKICAgICAgICAgICAgICBzdHIuc291cmNlX3N0cmVhbV9yYWRpbyA9IHN0cmVhbS5zdHJlYW1fcmFkaW87CiAgICAgICAgICAgICAgc3RyLnNvdXJjZV9zdHJlYW1fb3JkZXIgPSBzdHJlYW0uc3RyZWFtX29yZGVyOwogICAgICAgICAgICAgIHN0ci5zb3VyY2Vfc3RyZWFtX2lzX2hpZGRlbiA9IHN0cmVhbS5zdHJlYW1faXNfaGlkZGVuOwogICAgICAgICAgICAgIHN0ci5tb2RpZmllZCA9IGZhbHNlOwogICAgICAgICAgICAgIHN0ci5zdHJlYW1faXNfcmVtb3ZlZCA9IDA7CiAgICAgICAgICAgICAgaWYgKGdyb3VwLmdyb3VwX3R5cGUgPT0gMikgewogICAgICAgICAgICAgICAgaWYgKHN0ci5tb3ZpZV9uYW1lID09ICIiKSB7CiAgICAgICAgICAgICAgICAgIHN0ci5tb3ZpZV9uYW1lID0gc3RyLnN0cmVhbV90dmdfbmFtZTsKICAgICAgICAgICAgICAgICAgc3RyLnNvdXJjZV9tb3ZpZV9uYW1lID0gc3RyLnN0cmVhbV90dmdfbmFtZTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHN0ci5zb3VyY2VfbW92aWVfbmFtZSA9IHN0cmVhbS5tb3ZpZV9uYW1lOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc3RyLnNvdXJjZV9tb3ZpZV95ZWFyID0gc3RyZWFtLm1vdmllX3llYXI7CiAgICAgICAgICAgICAgICBzdHIuc291cmNlX3RtZGJfaWQgPSBzdHJlYW0udG1kYl9pZDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKGdyb3VwLmdyb3VwX3R5cGUgPT0gMykgewogICAgICAgICAgICAgICAgaWYgKHN0ci5zZXJpZV9uYW1lID09ICIiKSB7CiAgICAgICAgICAgICAgICAgIHN0ci5zZXJpZV9uYW1lID0gc3RyLnN0cmVhbV90dmdfbmFtZTsKICAgICAgICAgICAgICAgICAgc3RyLnNvdXJjZV9zZXJpZV9uYW1lID0gc3RyLnN0cmVhbV90dmdfbmFtZTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHN0ci5zb3VyY2Vfc2VyaWVfbmFtZSA9IHN0cmVhbS5zZXJpZV9uYW1lOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc3RyLnNvdXJjZV9zZXJpZV9zZWFzb24gPSBzdHJlYW0uc2VyaWVfc2Vhc29uOwogICAgICAgICAgICAgICAgc3RyLnNvdXJjZV9zZXJpZV9lcGlzb2RlID0gc3RyZWFtLnNlcmllX2VwaXNvZGU7CiAgICAgICAgICAgICAgICBzdHIuc291cmNlX3RtZGJfaWQgPSBzdHJlYW0udG1kYl9pZDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIHN0cjsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHN0cmVhbXMuc29ydCgoYSwgYikgPT4KICAgICAgICAgICAgICBhLnNvdXJjZV9zdHJlYW1fb3JkZXIgPiBiLnNvdXJjZV9zdHJlYW1fb3JkZXIKICAgICAgICAgICAgICAgID8gMQogICAgICAgICAgICAgICAgOiBiLnNvdXJjZV9zdHJlYW1fb3JkZXIgPiBhLnNvdXJjZV9zdHJlYW1fb3JkZXIKICAgICAgICAgICAgICAgID8gLTEKICAgICAgICAgICAgICAgIDogMAogICAgICAgICAgICApOwogICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMgPSBzdHJlYW1zOwogICAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0pOwogICAgfSwKICAgIG1vdmVUb1NlbGVjdGVkR3JvdXAoKSB7CiAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgbGV0IHN0cmVhbXMgPSB0aGlzLmFjdGl2ZVN0cmVhbXMuam9pbigpOwogICAgICBsZXQgaW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoKGdyb3VwKSA9PiB7CiAgICAgICAgcmV0dXJuIGdyb3VwLmlkID09IHRoaXMuYWN0aXZlR3JvdXA7CiAgICAgIH0pOwogICAgICBodHRwU2VydmljZQogICAgICAgIC5wb3N0KGBlZGl0b3IvbW92ZS10by1ncm91cC8ke3RoaXMuYWN0aXZlR3JvdXBUeXBlfWAsIHsKICAgICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgc3RyZWFtczogc3RyZWFtcywKICAgICAgICAgIGdyb3VwX2lkOiB0aGlzLmFjdGl2ZUdyb3Vwc1swXSwKICAgICAgICB9KQogICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICBpZiAocmVzLnN0YXR1cyAmJiByZXMuZGF0YSkgewogICAgICAgICAgICB0aGlzLmxvYWRQbGF5bGlzdCh0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLCBpbmRleCk7CiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICB9KTsKICAgIH0sCiAgICBzYXZlQ2hhbmdlc01vZGFsKHNob3csIHNhdmUgPSBmYWxzZSkgewogICAgICB0aGlzLnNhdmVDaGFuZ2VzLm1vZGFsID0gc2hvdzsKICAgICAgaWYgKHNhdmUpIHsKICAgICAgICB0aGlzLmRvU2F2ZSgpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMubG9hZFN0cmVhbXMoKTsKICAgICAgfQogICAgfSwKICAgIHJhZGlvQnJvd3Nlck1vZGFsKHNob3csIHNhdmUgPSBmYWxzZSkgewogICAgICBpZiAoc2hvdykgewogICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLnNlYXJjaCA9ICIiOwogICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLnJlc3VsdHMgPSBbXTsKICAgICAgICB0aGlzLnJhZGlvQnJvd3Nlci5hY3RpdmUgPSBbXTsKICAgICAgfQogICAgICBpZiAoc2F2ZSkgewogICAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgICBsZXQgZ3JvdXBJbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleCgoZ3JvdXApID0+IHsKICAgICAgICAgIHJldHVybiBncm91cC5pZCA9PSB0aGlzLmFjdGl2ZUdyb3VwOwogICAgICAgIH0pOwogICAgICAgIGxldCBvcmRlciA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7CiAgICAgICAgY29uc3Qgc3RyZWFtcyA9IHRoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZS5tYXAoKGluZGV4KSA9PiB7CiAgICAgICAgICBsZXQgcmFkaW8gPSB0aGlzLnJhZGlvQnJvd3Nlci5yZXN1bHRzW2luZGV4XTsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHNvdXJjZV9zdHJlYW1fdXJsOiByYWRpby51cmwsCiAgICAgICAgICAgIHN0cmVhbV90dmdfbmFtZTogcmFkaW8ubmFtZSwKICAgICAgICAgICAgc3RyZWFtX3R2Z19pZDogIiIsCiAgICAgICAgICAgIHN0cmVhbV90dmdfbG9nbzogcmFkaW8uZmF2aWNvbiwKICAgICAgICAgICAgc3RyZWFtX3JhZGlvOiB0cnVlLAogICAgICAgICAgICBzdHJlYW1fb3JkZXI6IG9yZGVyKyssCiAgICAgICAgICB9OwogICAgICAgIH0pOwogICAgICAgIGh0dHBTZXJ2aWNlCiAgICAgICAgICAucG9zdChgZWRpdG9yL2FkZC1zdHJlYW1zLyR7dGhpcy5hY3RpdmVHcm91cFR5cGV9YCwgewogICAgICAgICAgICBwbGF5bGlzdF9pZDogdGhpcy5wbGF5bGlzdEVkaXRvci5pZCwKICAgICAgICAgICAgZ3JvdXBfaWQ6IHRoaXMuZ2V0R3JvdXBXaXRoSWQodGhpcy5hY3RpdmVHcm91cCkuaWQsCiAgICAgICAgICAgIHN0cmVhbXM6IHN0cmVhbXMsCiAgICAgICAgICB9KQogICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICBpZiAocmVzLnN0YXR1cykgewogICAgICAgICAgICAgIHRoaXMubG9hZFBsYXlsaXN0KHRoaXMucGxheWxpc3RFZGl0b3IuaWQsIGdyb3VwSW5kZXgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIH0pOwogICAgICB9CiAgICAgIHRoaXMucmFkaW9Ccm93c2VyLm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBmaW5kUmFkaW9icm93c2VyKHNlYXJjaCkgewogICAgICBpZiAoc2VhcmNoLmxlbmd0aCA9PT0gMCkgewogICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLnJlc3VsdHMgPSBbXTsKICAgICAgICB0aGlzLnJhZGlvQnJvd3Nlci5hY3RpdmUgPSBbXTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnJhZGlvQnJvd3Nlci5pc0xvYWRpbmcgPSB0cnVlOwogICAgICAgIGh0dHBTZXJ2aWNlCiAgICAgICAgICAucG9zdCgiZWRpdG9yL2ZpbmQtcmFkaW9icm93c2VyIiwgewogICAgICAgICAgICBzZWFyY2g6IHNlYXJjaCwKICAgICAgICAgIH0pCiAgICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZSA9IFtdOwogICAgICAgICAgICBpZiAocmVzLnN0YXR1cykgewogICAgICAgICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLnJlc3VsdHMgPSByZXMuZGF0YTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0aGlzLnJhZGlvQnJvd3Nlci5yZXN1bHRzID0gW107CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuYWN0aXZlID0gW107CiAgICAgICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLnJlc3VsdHMgPSBbXTsKICAgICAgICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIHNvdW5kY2xvdWRNb2RhbChzaG93LCBzYXZlID0gZmFsc2UpIHsKICAgICAgaWYgKHNob3cpIHsKICAgICAgICB0aGlzLnNvdW5kY2xvdWQudXJsID0gIiI7CiAgICAgICAgdGhpcy5zb3VuZGNsb3VkLnRyYWNrID0gbnVsbDsKICAgICAgfQogICAgICBpZiAoc2F2ZSkgewogICAgICAgIGlmICh0aGlzLnNvdW5kY2xvdWQudHJhY2spIHsKICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgIGxldCBncm91cEluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KChncm91cCkgPT4gewogICAgICAgICAgICByZXR1cm4gZ3JvdXAuaWQgPT0gdGhpcy5hY3RpdmVHcm91cDsKICAgICAgICAgIH0pOwogICAgICAgICAgbGV0IG9yZGVyID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsKICAgICAgICAgIGNvbnN0IHN0cmVhbXMgPSBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBzb3VyY2Vfc3RyZWFtX3VybDogdGhpcy5zb3VuZGNsb3VkLnVybCwKICAgICAgICAgICAgICBzdHJlYW1fdHZnX25hbWU6IHRoaXMuc291bmRjbG91ZC50cmFjay50aXRsZSwKICAgICAgICAgICAgICBzdHJlYW1fdHZnX2lkOiAiIiwKICAgICAgICAgICAgICBzdHJlYW1fdHZnX2xvZ286IHRoaXMuc291bmRjbG91ZC50cmFjay5hcnR3b3JrX3VybC5yZXBsYWNlKAogICAgICAgICAgICAgICAgImxhcmdlLmpwZyIsCiAgICAgICAgICAgICAgICAidDUwMHg1MDAuanBnIgogICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgc3RyZWFtX3JhZGlvOiB0cnVlLAogICAgICAgICAgICAgIHN0cmVhbV9vcmRlcjogb3JkZXIrKywKICAgICAgICAgICAgfSwKICAgICAgICAgIF07CiAgICAgICAgICBodHRwU2VydmljZQogICAgICAgICAgICAucG9zdChgZWRpdG9yL2FkZC1zdHJlYW1zLyR7dGhpcy5hY3RpdmVHcm91cFR5cGV9YCwgewogICAgICAgICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgICAgIGdyb3VwX2lkOiB0aGlzLmdldEdyb3VwV2l0aElkKHRoaXMuYWN0aXZlR3JvdXApLmlkLAogICAgICAgICAgICAgIHN0cmVhbXM6IHN0cmVhbXMsCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgIGlmIChyZXMuc3RhdHVzKSB7CiAgICAgICAgICAgICAgICB0aGlzLmxvYWRQbGF5bGlzdCh0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLCBncm91cEluZGV4KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMuc291bmRjbG91ZC5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgZ2V0U291bmRjbG91ZFRyYWNrKHVybCwgY2xpZW50X2lkKSB7CiAgICAgIGlmICh1cmwubGVuZ3RoID09PSAwIHx8ICEvc291bmRjbG91ZFwuY29tLy50ZXN0KHVybCkpIHsKICAgICAgICB0aGlzLnNvdW5kY2xvdWQudXJsID0gIiI7CiAgICAgICAgdGhpcy5zb3VuZGNsb3VkLnRyYWNrID0gbnVsbDsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNvdW5kY2xvdWQuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgICBodHRwU2VydmljZQogICAgICAgICAgLnBvc3QoImVkaXRvci9zb3VuZGNsb3VkLXRyYWNrIiwgewogICAgICAgICAgICB1cmw6IHVybCwKICAgICAgICAgICAgY2xpZW50X2lkOiBjbGllbnRfaWQsCiAgICAgICAgICB9KQogICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICBpZiAocmVzLnN0YXR1cyAmJiBPYmplY3Qua2V5cyhyZXMuZGF0YSkubGVuZ3RoKSB7CiAgICAgICAgICAgICAgdGhpcy5zb3VuZGNsb3VkLnRyYWNrID0gcmVzLmRhdGE7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGhpcy5zb3VuZGNsb3VkLnRyYWNrID0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnNvdW5kY2xvdWQuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgICAgdGhpcy5zb3VuZGNsb3VkLnRyYWNrID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5zb3VuZGNsb3VkLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICB5b3V0dWJlTW9kYWwoc2hvdywgc2F2ZSA9IGZhbHNlKSB7CiAgICAgIGlmIChzaG93KSB7CiAgICAgICAgdGhpcy55b3V0dWJlLnVybCA9ICIiOwogICAgICAgIHRoaXMueW91dHViZS52aWRlbyA9IG51bGw7CiAgICAgICAgdGhpcy55b3V0dWJlLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9CiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgaWYgKHRoaXMueW91dHViZS52aWRlbykgewogICAgICAgICAgdGhpcy55b3V0dWJlLmlzTG9hZGluZyA9IHRydWU7CiAgICAgICAgICBsZXQgZ3JvdXBJbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleCgoZ3JvdXApID0+IHsKICAgICAgICAgICAgcmV0dXJuIGdyb3VwLmlkID09IHRoaXMuYWN0aXZlR3JvdXA7CiAgICAgICAgICB9KTsKICAgICAgICAgIGxldCBvcmRlciA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7CiAgICAgICAgICBjb25zdCBzdHJlYW1zID0gWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgc291cmNlX3N0cmVhbV91cmw6IHRoaXMueW91dHViZS51cmwsCiAgICAgICAgICAgICAgc3RyZWFtX3R2Z19uYW1lOiB0aGlzLnlvdXR1YmUudmlkZW8udmlkZW9EZXRhaWxzLnRpdGxlLAogICAgICAgICAgICAgIHN0cmVhbV90dmdfaWQ6ICIiLAogICAgICAgICAgICAgIHN0cmVhbV90dmdfbG9nbzogYGh0dHA6Ly9pLnl0aW1nLmNvbS92aS8ke3RoaXMueW91dHViZS52aWRlb0lkfS9tYXhyZXNkZWZhdWx0LmpwZ2AsCiAgICAgICAgICAgICAgc3RyZWFtX29yZGVyOiBvcmRlcisrLAogICAgICAgICAgICB9LAogICAgICAgICAgXTsKICAgICAgICAgIGh0dHBTZXJ2aWNlCiAgICAgICAgICAgIC5wb3N0KGBlZGl0b3IvYWRkLXN0cmVhbXMvJHt0aGlzLmFjdGl2ZUdyb3VwVHlwZX1gLCB7CiAgICAgICAgICAgICAgcGxheWxpc3RfaWQ6IHRoaXMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICAgICAgZ3JvdXBfaWQ6IHRoaXMuZ2V0R3JvdXBXaXRoSWQodGhpcy5hY3RpdmVHcm91cCkuaWQsCiAgICAgICAgICAgICAgc3RyZWFtczogc3RyZWFtcywKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgIHRoaXMueW91dHViZS5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICBpZiAocmVzLnN0YXR1cykgewogICAgICAgICAgICAgICAgdGhpcy5sb2FkUGxheWxpc3QodGhpcy5wbGF5bGlzdEVkaXRvci5pZCwgZ3JvdXBJbmRleCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgICAgIHRoaXMueW91dHViZS5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMueW91dHViZS5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgZ2V0WW91dHViZVBhZ2UodmlkZW9JZCkgewogICAgICB0aGlzLnlvdXR1YmUuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UueW91dHViZSh2aWRlb0lkKS50aGVuKChyZXMpID0+IHsKICAgICAgICB0aGlzLnlvdXR1YmUudmlkZW8gPSByZXM7CiAgICAgICAgdGhpcy55b3V0dWJlLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9KTsKICAgIH0sCiAgICB2aW1lb01vZGFsKHNob3csIHNhdmUgPSBmYWxzZSkgewogICAgICBpZiAoc2hvdykgewogICAgICAgIHRoaXMudmltZW8udXJsID0gIiI7CiAgICAgICAgdGhpcy52aW1lby52aWRlbyA9IG51bGw7CiAgICAgICAgdGhpcy52aW1lby5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfQogICAgICBpZiAoc2F2ZSkgewogICAgICAgIGlmICh0aGlzLnZpbWVvLnZpZGVvKSB7CiAgICAgICAgICB0aGlzLnZpbWVvLmlzTG9hZGluZyA9IHRydWU7CiAgICAgICAgICBsZXQgZ3JvdXBJbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleCgoZ3JvdXApID0+IHsKICAgICAgICAgICAgcmV0dXJuIGdyb3VwLmlkID09IHRoaXMuYWN0aXZlR3JvdXA7CiAgICAgICAgICB9KTsKICAgICAgICAgIGxldCBvcmRlciA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7CiAgICAgICAgICBjb25zdCBzdHJlYW1zID0gWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgc291cmNlX3N0cmVhbV91cmw6IHRoaXMudmltZW8udXJsLAogICAgICAgICAgICAgIHN0cmVhbV90dmdfbmFtZTogdGhpcy52aW1lby52aWRlby52aWRlby50aXRsZSwKICAgICAgICAgICAgICBzdHJlYW1fdHZnX2lkOiAiIiwKICAgICAgICAgICAgICBzdHJlYW1fdHZnX2xvZ286IHRoaXMudmltZW8udmlkZW8udmlkZW8udGh1bWJzLmJhc2UsCiAgICAgICAgICAgICAgc3RyZWFtX29yZGVyOiBvcmRlcisrLAogICAgICAgICAgICB9LAogICAgICAgICAgXTsKICAgICAgICAgIGh0dHBTZXJ2aWNlCiAgICAgICAgICAgIC5wb3N0KGBlZGl0b3IvYWRkLXN0cmVhbXMvJHt0aGlzLmFjdGl2ZUdyb3VwVHlwZX1gLCB7CiAgICAgICAgICAgICAgcGxheWxpc3RfaWQ6IHRoaXMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICAgICAgZ3JvdXBfaWQ6IHRoaXMuZ2V0R3JvdXBXaXRoSWQodGhpcy5hY3RpdmVHcm91cCkuaWQsCiAgICAgICAgICAgICAgc3RyZWFtczogc3RyZWFtcywKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgIHRoaXMudmltZW8uaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgaWYgKHJlcy5zdGF0dXMpIHsKICAgICAgICAgICAgICAgIHRoaXMubG9hZFBsYXlsaXN0KHRoaXMucGxheWxpc3RFZGl0b3IuaWQsIGdyb3VwSW5kZXgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgICAgICB0aGlzLnZpbWVvLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy52aW1lby5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgZ2V0VmltZW9Db25maWcodmlkZW9JZCkgewogICAgICB0aGlzLnZpbWVvLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGh0dHBTZXJ2aWNlCiAgICAgICAgLnBvc3QoImVkaXRvci92aW1lby12aWRlbyIsIHsgdmlkZW9faWQ6IHZpZGVvSWQgfSkKICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICB0aGlzLnZpbWVvLnZpZGVvID0gcmVzLmRhdGE7CiAgICAgICAgICB0aGlzLnZpbWVvLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0pOwogICAgfSwKICAgIGRhaWx5bW90aW9uTW9kYWwoc2hvdywgc2F2ZSA9IGZhbHNlKSB7CiAgICAgIGlmIChzaG93KSB7CiAgICAgICAgdGhpcy5kYWlseW1vdGlvbi51cmwgPSAiIjsKICAgICAgICB0aGlzLmRhaWx5bW90aW9uLnZpZGVvID0gbnVsbDsKICAgICAgICB0aGlzLmRhaWx5bW90aW9uLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9CiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgaWYgKHRoaXMuZGFpbHltb3Rpb24udmlkZW8pIHsKICAgICAgICAgIHRoaXMuZGFpbHltb3Rpb24uaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgIGxldCBncm91cEluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KChncm91cCkgPT4gewogICAgICAgICAgICByZXR1cm4gZ3JvdXAuaWQgPT0gdGhpcy5hY3RpdmVHcm91cDsKICAgICAgICAgIH0pOwogICAgICAgICAgbGV0IG9yZGVyID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsKICAgICAgICAgIGNvbnN0IHN0cmVhbXMgPSBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBzb3VyY2Vfc3RyZWFtX3VybDogdGhpcy5kYWlseW1vdGlvbi51cmwsCiAgICAgICAgICAgICAgc3RyZWFtX3R2Z19uYW1lOiB0aGlzLmRhaWx5bW90aW9uLnZpZGVvLnRpdGxlLAogICAgICAgICAgICAgIHN0cmVhbV90dmdfaWQ6ICIiLAogICAgICAgICAgICAgIHN0cmVhbV90dmdfbG9nbzogdGhpcy5kYWlseW1vdGlvbi52aWRlby50aHVtYm5haWxfMTA4MF91cmwsCiAgICAgICAgICAgICAgc3RyZWFtX29yZGVyOiBvcmRlcisrLAogICAgICAgICAgICB9LAogICAgICAgICAgXTsKICAgICAgICAgIGh0dHBTZXJ2aWNlCiAgICAgICAgICAgIC5wb3N0KGBlZGl0b3IvYWRkLXN0cmVhbXMvJHt0aGlzLmFjdGl2ZUdyb3VwVHlwZX1gLCB7CiAgICAgICAgICAgICAgcGxheWxpc3RfaWQ6IHRoaXMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICAgICAgZ3JvdXBfaWQ6IHRoaXMuZ2V0R3JvdXBXaXRoSWQodGhpcy5hY3RpdmVHcm91cCkuaWQsCiAgICAgICAgICAgICAgc3RyZWFtczogc3RyZWFtcywKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgIHRoaXMuZGFpbHltb3Rpb24uaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgaWYgKHJlcy5zdGF0dXMpIHsKICAgICAgICAgICAgICAgIHRoaXMubG9hZFBsYXlsaXN0KHRoaXMucGxheWxpc3RFZGl0b3IuaWQsIGdyb3VwSW5kZXgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgICAgICB0aGlzLmRhaWx5bW90aW9uLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy5kYWlseW1vdGlvbi5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgZ2V0RGFpbHltb3Rpb25Db25maWcodmlkZW9JZCkgewogICAgICB0aGlzLmRhaWx5bW90aW9uLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGh0dHBTZXJ2aWNlCiAgICAgICAgLnBvc3QoImVkaXRvci9kYWlseW1vdGlvbi12aWRlbyIsIHsgdmlkZW9faWQ6IHZpZGVvSWQgfSkKICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICB0aGlzLmRhaWx5bW90aW9uLnZpZGVvID0gcmVzLmRhdGE7CiAgICAgICAgICB0aGlzLmRhaWx5bW90aW9uLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0pOwogICAgfSwKICAgIHRlZFRhbGtzTW9kYWwoc2hvdywgc2F2ZSA9IGZhbHNlKSB7CiAgICAgIGlmIChzaG93KSB7CiAgICAgICAgdGhpcy50ZWRUYWxrcy51cmwgPSAiIjsKICAgICAgICB0aGlzLnRlZFRhbGtzLnZpZGVvID0gbnVsbDsKICAgICAgICB0aGlzLnRlZFRhbGtzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9CiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgaWYgKHRoaXMudGVkVGFsa3MudmlkZW8pIHsKICAgICAgICAgIHRoaXMudGVkVGFsa3MuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgIGxldCBncm91cEluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KChncm91cCkgPT4gewogICAgICAgICAgICByZXR1cm4gZ3JvdXAuaWQgPT0gdGhpcy5hY3RpdmVHcm91cDsKICAgICAgICAgIH0pOwogICAgICAgICAgbGV0IG9yZGVyID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsKICAgICAgICAgIGNvbnN0IHN0cmVhbXMgPSBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBzb3VyY2Vfc3RyZWFtX3VybDogdGhpcy50ZWRUYWxrcy51cmwsCiAgICAgICAgICAgICAgc3RyZWFtX3R2Z19uYW1lOiB0aGlzLnRlZFRhbGtzLnZpZGVvLnRpdGxlLAogICAgICAgICAgICAgIHN0cmVhbV90dmdfaWQ6ICIiLAogICAgICAgICAgICAgIHN0cmVhbV90dmdfbG9nbzogdGhpcy50ZWRUYWxrcy52aWRlby5oZXJvLAogICAgICAgICAgICAgIHN0cmVhbV9vcmRlcjogb3JkZXIrKywKICAgICAgICAgICAgfSwKICAgICAgICAgIF07CiAgICAgICAgICBodHRwU2VydmljZQogICAgICAgICAgICAucG9zdChgZWRpdG9yL2FkZC1zdHJlYW1zLyR7dGhpcy5hY3RpdmVHcm91cFR5cGV9YCwgewogICAgICAgICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgICAgIGdyb3VwX2lkOiB0aGlzLmdldEdyb3VwV2l0aElkKHRoaXMuYWN0aXZlR3JvdXApLmlkLAogICAgICAgICAgICAgIHN0cmVhbXM6IHN0cmVhbXMsCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICB0aGlzLnRlZFRhbGtzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgIGlmIChyZXMuc3RhdHVzKSB7CiAgICAgICAgICAgICAgICB0aGlzLmxvYWRQbGF5bGlzdCh0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLCBncm91cEluZGV4KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICAgICAgdGhpcy50ZWRUYWxrcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMudGVkVGFsa3MubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGdldFRlZFRhbGtzQ29uZmlnKHVybCkgewogICAgICB0aGlzLnRlZFRhbGtzLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGh0dHBTZXJ2aWNlLnBvc3QoImVkaXRvci90ZWQtdGFsa3MtdmlkZW8iLCB7IHVybDogdXJsIH0pLnRoZW4oKHJlcykgPT4gewogICAgICAgIHRoaXMudGVkVGFsa3MudmlkZW8gPSByZXMuZGF0YS50YWxrcy5sZW5ndGggPyByZXMuZGF0YS50YWxrc1swXSA6IG51bGw7CiAgICAgICAgdGhpcy50ZWRUYWxrcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfSk7CiAgICB9LAogICAgeGhhbXN0ZXJNb2RhbChzaG93LCBzYXZlID0gZmFsc2UpIHsKICAgICAgaWYgKHNob3cpIHsKICAgICAgICB0aGlzLnhoYW1zdGVyLnVybCA9ICIiOwogICAgICAgIHRoaXMueGhhbXN0ZXIudmlkZW8gPSBudWxsOwogICAgICAgIHRoaXMueGhhbXN0ZXIuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0KICAgICAgaWYgKHNhdmUpIHsKICAgICAgICBpZiAodGhpcy54aGFtc3Rlci52aWRlbykgewogICAgICAgICAgdGhpcy54aGFtc3Rlci5pc0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgbGV0IGdyb3VwSW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoKGdyb3VwKSA9PiB7CiAgICAgICAgICAgIHJldHVybiBncm91cC5pZCA9PSB0aGlzLmFjdGl2ZUdyb3VwOwogICAgICAgICAgfSk7CiAgICAgICAgICBsZXQgb3JkZXIgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOwogICAgICAgICAgY29uc3Qgc3RyZWFtcyA9IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgIHNvdXJjZV9zdHJlYW1fdXJsOiB0aGlzLnhoYW1zdGVyLnVybCwKICAgICAgICAgICAgICBzdHJlYW1fdHZnX25hbWU6IHRoaXMueGhhbXN0ZXIudmlkZW8udmlkZW9FbnRpdHkudGl0bGUsCiAgICAgICAgICAgICAgc3RyZWFtX3R2Z19pZDogIiIsCiAgICAgICAgICAgICAgc3RyZWFtX3R2Z19sb2dvOiB0aGlzLnhoYW1zdGVyLnZpZGVvLnZpZGVvRW50aXR5LnRodW1iQmlnLAogICAgICAgICAgICAgIHN0cmVhbV9vcmRlcjogb3JkZXIrKywKICAgICAgICAgICAgfSwKICAgICAgICAgIF07CiAgICAgICAgICBodHRwU2VydmljZQogICAgICAgICAgICAucG9zdChgZWRpdG9yL2FkZC1zdHJlYW1zLyR7dGhpcy5hY3RpdmVHcm91cFR5cGV9YCwgewogICAgICAgICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgICAgIGdyb3VwX2lkOiB0aGlzLmdldEdyb3VwV2l0aElkKHRoaXMuYWN0aXZlR3JvdXApLmlkLAogICAgICAgICAgICAgIHN0cmVhbXM6IHN0cmVhbXMsCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICB0aGlzLnhoYW1zdGVyLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgIGlmIChyZXMuc3RhdHVzKSB7CiAgICAgICAgICAgICAgICB0aGlzLmxvYWRQbGF5bGlzdCh0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLCBncm91cEluZGV4KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICAgICAgdGhpcy54aGFtc3Rlci5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMueGhhbXN0ZXIubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGdldFhoYW1zdGVyQ29uZmlnKHVybCkgewogICAgICB0aGlzLnhoYW1zdGVyLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGh0dHBTZXJ2aWNlLnBvc3QoImVkaXRvci94aGFtc3Rlci12aWRlbyIsIHsgdXJsOiB1cmwgfSkudGhlbigocmVzKSA9PiB7CiAgICAgICAgdGhpcy54aGFtc3Rlci52aWRlbyA9IHJlcy5kYXRhOwogICAgICAgIHRoaXMueGhhbXN0ZXIuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0pOwogICAgfSwKICAgIGdyb3VwRG91YmxlQ2xpY2soKSB7CiAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3Vwcy5sZW5ndGggPT09IDEpIHsKICAgICAgICB0aGlzLmVkaXRHcm91cE1vZGFsKHRydWUpOwogICAgICB9CiAgICB9LAogICAgc3RyZWFtRG91YmxlQ2xpY2soKSB7CiAgICAgIGlmICh0aGlzLmFjdGl2ZVN0cmVhbXMubGVuZ3RoID09PSAxKSB7CiAgICAgICAgdGhpcy5lZGl0U3RyZWFtTW9kYWwodHJ1ZSk7CiAgICAgIH0KICAgIH0sCiAgICBsb2FkTG9nb0NvdW50cmllcygpIHsKICAgICAgdGhpcy5maW5kTG9nby5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZQogICAgICAgIC5nZXQoImVkaXRvci9sb2dvLWNvdW50cmllcyIpCiAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgdGhpcy5maW5kTG9nby5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIHRoaXMuZmluZExvZ28uY291bnRyaWVzID0gcmVzLmRhdGEKICAgICAgICAgICAgLm1hcCgoY291bnRyeSkgPT4gewogICAgICAgICAgICAgIGxldCBjbiA9IHRoaXMuY291bnRyaWVzLmZpbmQoCiAgICAgICAgICAgICAgICAoY250KSA9PiBjbnQuY29kZS50b0xvd2VyQ2FzZSgpID09IGNvdW50cnkudG9Mb3dlckNhc2UoKQogICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHRleHQ6IGNuID8gY24ubmFtZSA6IGNvdW50cnksCiAgICAgICAgICAgICAgICB2YWx1ZTogY291bnRyeSwKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9KQogICAgICAgICAgICAuc29ydCgoYSwgYikgPT4gewogICAgICAgICAgICAgIHJldHVybiBhLnRleHQudG9VcHBlckNhc2UoKSA8IGIudGV4dC50b1VwcGVyQ2FzZSgpCiAgICAgICAgICAgICAgICA/IC0xCiAgICAgICAgICAgICAgICA6IGEudGV4dC50b1VwcGVyQ2FzZSgpID4gYi50ZXh0LnRvVXBwZXJDYXNlKCkKICAgICAgICAgICAgICAgID8gMQogICAgICAgICAgICAgICAgOiAwOwogICAgICAgICAgICB9KTsKICAgICAgICAgIHRoaXMuYXNzaWduTG9nby5jb3VudHJpZXMgPSBbLi4udGhpcy5maW5kTG9nby5jb3VudHJpZXNdOwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgIHRoaXMuZmluZExvZ28uaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgfSk7CiAgICB9LAogICAgbG9hZExvZ29zRmluZChjb3VudHJ5KSB7CiAgICAgIHRoaXMuZmluZExvZ28uaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAuZ2V0KGBlZGl0b3IvbG9nb3MvJHtjb3VudHJ5fWApCiAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgdGhpcy5maW5kTG9nby5sb2dvID0gIiI7CiAgICAgICAgICB0aGlzLmZpbmRMb2dvLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgdGhpcy5maW5kTG9nby5sb2dvcyA9IHJlcy5kYXRhLm1hcCgobG9nbykgPT4gewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIHRleHQ6IGxvZ28ubGFiZWwsCiAgICAgICAgICAgICAgdmFsdWU6IGxvZ28uZmlsZW5hbWUsCiAgICAgICAgICAgIH07CiAgICAgICAgICB9KTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICB0aGlzLmZpbmRMb2dvLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0pOwogICAgfSwKICAgIGZpbmRMb2dvTW9kYWwoc2hvdywgc2F2ZSA9IGZhbHNlKSB7CiAgICAgIGlmIChzaG93KSB7CiAgICAgICAgdGhpcy5maW5kTG9nby5sb2dvID0gIiI7CiAgICAgIH0KICAgICAgdGhpcy5maW5kTG9nby5zZWFyY2ggPSAiIjsKICAgICAgaWYgKHNhdmUpIHsKICAgICAgICBsZXQgc2VsZWN0ZWQgPSB0aGlzLmdldFN0cmVhbVdpdGhJZCh0aGlzLmFjdGl2ZVN0cmVhbXNbMF0pOwogICAgICAgIGlmIChzZWxlY3RlZCkgewogICAgICAgICAgc2VsZWN0ZWQuc3RyZWFtX3R2Z19sb2dvID0gYGh0dHA6Ly9zdGF0aWMuaXB0di10b29scy5jb20vJHt0aGlzLmZpbmRMb2dvLmNvdW50cnl9LyR7dGhpcy5maW5kTG9nby5sb2dvfWA7CiAgICAgICAgICBzZWxlY3RlZC5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLmZpbmRMb2dvLm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBsb2FkTG9nb3NBc3NpZ24oY291bnRyeSkgewogICAgICB0aGlzLmFzc2lnbkxvZ28uaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAuZ2V0KGBlZGl0b3IvbG9nb3MvJHtjb3VudHJ5fWApCiAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgdGhpcy5hc3NpZ25Mb2dvLmxvZ28gPSAiIjsKICAgICAgICAgIHRoaXMuYXNzaWduTG9nby5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIHRoaXMuYXNzaWduTG9nby5sb2dvcyA9IHJlcy5kYXRhLm1hcCgobG9nbykgPT4gbG9nby5maWxlbmFtZSk7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgdGhpcy5hc3NpZ25Mb2dvLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0pOwogICAgfSwKICAgIGFzc2lnbkxvZ29Nb2RhbChzaG93LCBzYXZlID0gZmFsc2UpIHsKICAgICAgaWYgKHNob3cpIHsKICAgICAgICB0aGlzLmFzc2lnbkxvZ28ubG9nbyA9ICIiOwogICAgICB9CiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgdmFyIGNoYW5nZWQgPSBmYWxzZTsKICAgICAgICB2YXIgc3RyaW5nU2ltaWxhcml0eSA9IHJlcXVpcmUoInN0cmluZy1zaW1pbGFyaXR5Iik7CiAgICAgICAgbGV0IHN0cmVhbXMgPSBbXTsKICAgICAgICBpZiAodGhpcy5hc3NpZ25Mb2dvLmFzc2lnbkFsbCkgewogICAgICAgICAgc3RyZWFtcyA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtczsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc3RyZWFtcyA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5maWx0ZXIoKHN0cmVhbSkgPT4gewogICAgICAgICAgICByZXR1cm4gIXN0cmVhbS5zdHJlYW1fdHZnX2xvZ28ubGVuZ3RoOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIHN0cmVhbXMubWFwKChzdHJlYW0pID0+IHsKICAgICAgICAgIGxldCBtYXRjaDEgPSBzdHJpbmdTaW1pbGFyaXR5LmZpbmRCZXN0TWF0Y2goCiAgICAgICAgICAgIFN0cmluZyhzdHJlYW0uc3RyZWFtX3R2Z19uYW1lKS5yZXBsYWNlKC8gaGQkL2ksICIiKSwKICAgICAgICAgICAgdGhpcy5hc3NpZ25Mb2dvLmxvZ29zCiAgICAgICAgICApLmJlc3RNYXRjaDsKICAgICAgICAgIGxldCBtYXRjaDIgPSBzdHJpbmdTaW1pbGFyaXR5LmZpbmRCZXN0TWF0Y2goCiAgICAgICAgICAgIFN0cmluZyhzdHJlYW0uc3RyZWFtX3R2Z19pZCksCiAgICAgICAgICAgIHRoaXMuYXNzaWduTG9nby5sb2dvcwogICAgICAgICAgKS5iZXN0TWF0Y2g7CiAgICAgICAgICBpZiAobWF0Y2gxLnJhdGluZyA+PSAwLjMpIHsKICAgICAgICAgICAgY2hhbmdlZCA9IHRydWU7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX2xvZ28gPSBgaHR0cDovL3N0YXRpYy5pcHR2LXRvb2xzLmNvbS8ke3RoaXMuYXNzaWduTG9nby5jb3VudHJ5fS8ke21hdGNoMS50YXJnZXR9YDsKICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgIH0gZWxzZSBpZiAobWF0Y2gyLnJhdGluZyA+PSAwLjUpIHsKICAgICAgICAgICAgY2hhbmdlZCA9IHRydWU7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX2xvZ28gPSBgaHR0cDovL3N0YXRpYy5pcHR2LXRvb2xzLmNvbS8ke3RoaXMuYXNzaWduTG9nby5jb3VudHJ5fS8ke21hdGNoMi50YXJnZXR9YDsKICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSBjaGFuZ2VkOwogICAgICB9CiAgICAgIHRoaXMuYXNzaWduTG9nby5tb2RhbCA9IHNob3c7CiAgICB9LAogIH0sCiAgYmVmb3JlTW91bnQoKSB7CiAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5hZGQoInJpZ2h0LW1lbnUiKTsKICAgIEV2ZW50QnVzLiRvbigic2VhcmNoIiwgdGhpcy5zZWFyY2hFZGl0b3IpOwogICAgRXZlbnRCdXMuJG9uKCJwcmludCIsIHRoaXMucHJpbnRFZGl0b3IpOwogICAgRXZlbnRCdXMuJG9uKCJ0YWItY2hhbmdlIiwgdGhpcy5kb1RhYkNoYW5nZSk7CiAgICBFdmVudEJ1cy4kb24oInNhdmUiLCB0aGlzLmRvU2F2ZSk7CiAgICBFdmVudEJ1cy4kb24oImNhbmNlbCIsIHRoaXMuZG9DYW5jZWwpOwogICAgRXZlbnRCdXMuJG9uKCJlZGl0b3ItcGxheWxpc3QiLCB0aGlzLmxvYWRQbGF5bGlzdCk7CiAgICB0aGlzLmxvYWRMb2dvQ291bnRyaWVzKCk7CiAgfSwKICBiZWZvcmVEZXN0cm95KCkgewogICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QucmVtb3ZlKCJyaWdodC1tZW51Iik7CiAgICBFdmVudEJ1cy4kb2ZmKCJzZWFyY2giLCB0aGlzLnNlYXJjaEVkaXRvcik7CiAgICBFdmVudEJ1cy4kb2ZmKCJwcmludCIsIHRoaXMucHJpbnRFZGl0b3IpOwogICAgRXZlbnRCdXMuJG9mZigidGFiLWNoYW5nZSIsIHRoaXMuZG9UYWJDaGFuZ2UpOwogICAgRXZlbnRCdXMuJG9mZigic2F2ZSIsIHRoaXMuZG9TYXZlKTsKICAgIEV2ZW50QnVzLiRvZmYoImNhbmNlbCIsIHRoaXMuZG9DYW5jZWwpOwogICAgRXZlbnRCdXMuJG9mZigiZWRpdG9yLXBsYXlsaXN0IiwgdGhpcy5sb2FkUGxheWxpc3QpOwogIH0sCiAgd2F0Y2g6IHsKICAgIGRyYWdTdHJlYW06IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgaWYgKCF2YWwpIHsKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgICB9CiAgICB9LAogICAgZHJhZ0dyb3VwOiBmdW5jdGlvbiAodmFsKSB7CiAgICAgIGlmICghdmFsKSB7CiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgICAgfQogICAgfSwKICAgIGFjdGl2ZUdyb3VwOiBmdW5jdGlvbiAodmFsKSB7CiAgICAgIGlmICh0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQpIHsKICAgICAgICB0aGlzLnNhdmVDaGFuZ2VzTW9kYWwodHJ1ZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5sb2FkU3RyZWFtcygpOwogICAgICB9CiAgICB9LAogICAgInBsYXlsaXN0RWRpdG9yLmNoYW5nZWQiOiBmdW5jdGlvbiAodmFsKSB7CiAgICAgIEV2ZW50QnVzLiRlbWl0KCJlZGl0b3ItY2hhbmdlcyIsIHZhbCk7CiAgICB9LAogICAgInJhZGlvQnJvd3Nlci5zZWFyY2giOiBmdW5jdGlvbiAodmFsKSB7CiAgICAgIGxldCB2bSA9IHRoaXM7CiAgICAgIGNsZWFyVGltZW91dCh0aGlzLnJhZGlvQnJvd3Nlci5ib3VuY2UpOwogICAgICB0aGlzLnJhZGlvQnJvd3Nlci5ib3VuY2UgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICB2bS5maW5kUmFkaW9icm93c2VyKHZhbCk7CiAgICAgIH0sIDUwMCk7CiAgICB9LAogICAgInNvdW5kY2xvdWQudXJsIjogZnVuY3Rpb24gKHZhbCkgewogICAgICBsZXQgdm0gPSB0aGlzOwogICAgICBjbGVhclRpbWVvdXQodGhpcy5yYWRpb0Jyb3dzZXIuYm91bmNlKTsKICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuYm91bmNlID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgdm0uZ2V0U291bmRjbG91ZFRyYWNrKHZhbCwgdm0uc291bmRjbG91ZENsaWVudElkKTsKICAgICAgfSwgNTAwKTsKICAgIH0sCiAgICAieW91dHViZS51cmwiOiBmdW5jdGlvbiAodmFsKSB7CiAgICAgIGlmICghdmFsLmxlbmd0aCkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAoL3lvdXR1XC4/YmUvaS50ZXN0KHZhbCkpIHsKICAgICAgICB2YXIgaTsKICAgICAgICB2YXIgcGF0dGVybnMgPSBbCiAgICAgICAgICAveW91dHVcLmJlXC8oW14jJj9dezExfSkvLCAvLyB5b3V0dS5iZS88aWQ+CiAgICAgICAgICAvXD92PShbXiMmP117MTF9KS8sIC8vID92PTxpZD4KICAgICAgICAgIC8mdj0oW14jJj9dezExfSkvLCAvLyAmdj08aWQ+CiAgICAgICAgICAvZW1iZWRcLyhbXiMmP117MTF9KS8sIC8vIGVtYmVkLzxpZD4KICAgICAgICAgIC9cL3ZcLyhbXiMmP117MTF9KS8sIC8vIC92LzxpZD4KICAgICAgICBdOwoKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcGF0dGVybnMubGVuZ3RoOyArK2kpIHsKICAgICAgICAgIGlmIChwYXR0ZXJuc1tpXS50ZXN0KHZhbCkpIHsKICAgICAgICAgICAgdGhpcy55b3V0dWJlLnZpZGVvSWQgPSBwYXR0ZXJuc1tpXS5leGVjKHZhbClbMV07CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHZhciB0b2tlbnMgPSB2YWwuc3BsaXQoL1svJj89Iy5cc10vZyk7CiAgICAgICAgZm9yIChpID0gMDsgaSA8IHRva2Vucy5sZW5ndGg7ICsraSkgewogICAgICAgICAgaWYgKC9eW14jJj9dezExfSQvLnRlc3QodG9rZW5zW2ldKSkgewogICAgICAgICAgICB0aGlzLnlvdXR1YmUudmlkZW9JZCA9IHRva2Vuc1tpXTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdGhpcy55b3V0dWJlLnZpZGVvSWQgPSAiIjsKICAgICAgfSBlbHNlIHsKICAgICAgICB0cnkgewogICAgICAgICAgdmFyIHVybHAgPSBuZXcgVVJMKHZhbCk7CiAgICAgICAgICB0aGlzLnlvdXR1YmUudmlkZW9JZCA9IHVybHAuc2VhcmNoUGFyYW1zLmdldCgidiIpOwogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICB0aGlzLnlvdXR1YmUudmlkZW9JZCA9ICIiOwogICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgICJ5b3V0dWJlLnZpZGVvSWQiOiBmdW5jdGlvbiAodmFsKSB7CiAgICAgIGxldCB2bSA9IHRoaXM7CiAgICAgIGNsZWFyVGltZW91dCh0aGlzLnlvdXR1YmUuYm91bmNlKTsKICAgICAgdGhpcy55b3V0dWJlLmJvdW5jZSA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgIGlmICh2YWwubGVuZ3RoKSB7CiAgICAgICAgICB2bS5nZXRZb3V0dWJlUGFnZSh2YWwpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2bS55b3V0dWJlLnZpZGVvID0gbnVsbDsKICAgICAgICB9CiAgICAgIH0sIDUwMCk7CiAgICB9LAogICAgInZpbWVvLnVybCI6IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgaWYgKC92aW1lb1wuY29tL2kudGVzdCh2YWwpKSB7CiAgICAgICAgbGV0IG1hdGNoID0gdmFsLm1hdGNoKAogICAgICAgICAgLyg/Ond3d1wufHBsYXllclwuKT92aW1lby5jb21cLyg/OmNoYW5uZWxzXC8oPzpcdytcLyk/fGdyb3Vwc1wvKD86W14vXSopXC92aWRlb3NcL3xhbGJ1bVwvKD86XGQrKVwvdmlkZW9cL3x2aWRlb1wvfCkoXGQrKSg/OlthLXpBLVowLTlfLV0rKT8vaQogICAgICAgICk7CiAgICAgICAgaWYgKG1hdGNoLmxlbmd0aCA+PSAyKSB7CiAgICAgICAgICB0aGlzLnZpbWVvLnZpZGVvSWQgPSBtYXRjaFsxXTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy52aW1lby52aWRlb0lkID0gIiI7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMudmltZW8udmlkZW9JZCA9ICIiOwogICAgICB9CiAgICB9LAogICAgInZpbWVvLnZpZGVvSWQiOiBmdW5jdGlvbiAodmFsKSB7CiAgICAgIGxldCB2bSA9IHRoaXM7CiAgICAgIGNsZWFyVGltZW91dCh0aGlzLnZpbWVvLmJvdW5jZSk7CiAgICAgIHRoaXMudmltZW8uYm91bmNlID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKHZhbC5sZW5ndGgpIHsKICAgICAgICAgIHZtLmdldFZpbWVvQ29uZmlnKHZhbCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZtLnZpbWVvLnZpZGVvID0gbnVsbDsKICAgICAgICB9CiAgICAgIH0sIDUwMCk7CiAgICB9LAogICAgImRhaWx5bW90aW9uLnVybCI6IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgaWYgKC9kYWlseW1vdGlvblwuY29tL2kudGVzdCh2YWwpKSB7CiAgICAgICAgbGV0IG1hdGNoID0gdmFsLm1hdGNoKAogICAgICAgICAgL14uK2RhaWx5bW90aW9uLmNvbVwvKHZpZGVvfGh1YilcLyhbXl9dKylbXiNdKigjdmlkZW89KFteXyZdKykpPy9pCiAgICAgICAgKTsKICAgICAgICBpZiAobWF0Y2gubGVuZ3RoID49IDQgJiYgbWF0Y2hbNF0pIHsKICAgICAgICAgIHRoaXMuZGFpbHltb3Rpb24udmlkZW9JZCA9IG1hdGNoWzRdOwogICAgICAgIH0gZWxzZSBpZiAobWF0Y2gubGVuZ3RoID49IDIpIHsKICAgICAgICAgIHRoaXMuZGFpbHltb3Rpb24udmlkZW9JZCA9IG1hdGNoWzJdOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLmRhaWx5bW90aW9uLnZpZGVvSWQgPSAiIjsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5kYWlseW1vdGlvbi52aWRlb0lkID0gIiI7CiAgICAgIH0KICAgIH0sCiAgICAiZGFpbHltb3Rpb24udmlkZW9JZCI6IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgbGV0IHZtID0gdGhpczsKICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuZGFpbHltb3Rpb24uYm91bmNlKTsKICAgICAgdGhpcy5kYWlseW1vdGlvbi5ib3VuY2UgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAodmFsLmxlbmd0aCkgewogICAgICAgICAgdm0uZ2V0RGFpbHltb3Rpb25Db25maWcodmFsKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdm0uZGFpbHltb3Rpb24udmlkZW8gPSBudWxsOwogICAgICAgIH0KICAgICAgfSwgNTAwKTsKICAgIH0sCiAgICAidGVkVGFsa3MudXJsIjogZnVuY3Rpb24gKHZhbCkgewogICAgICBpZiAoL3RlZFwuY29tXC90YWxrcy9pLnRlc3QodmFsKSkgewogICAgICAgIGxldCB2bSA9IHRoaXM7CiAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMudGVkVGFsa3MuYm91bmNlKTsKICAgICAgICB0aGlzLnRlZFRhbGtzLmJvdW5jZSA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKHZhbC5sZW5ndGgpIHsKICAgICAgICAgICAgdm0uZ2V0VGVkVGFsa3NDb25maWcodmFsKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZtLnRlZFRhbGtzLnZpZGVvID0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICB9LCA1MDApOwogICAgICB9CiAgICB9LAogICAgInhoYW1zdGVyLnVybCI6IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgbGV0IHZtID0gdGhpczsKICAgICAgaWYgKC94aGFtc3RlclwuY29tXC92aWRlb3MvaS50ZXN0KHZhbCkpIHsKICAgICAgICBjbGVhclRpbWVvdXQodGhpcy54aGFtc3RlckJvdW5jZSk7CiAgICAgICAgdGhpcy54aGFtc3RlckJvdW5jZSA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKHZhbC5sZW5ndGgpIHsKICAgICAgICAgICAgdm0uZ2V0WGhhbXN0ZXJDb25maWcodmFsKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZtLnhoYW1zdGVyLnZpZGVvID0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICB9LCA1MDApOwogICAgICB9CiAgICB9LAogICAgImZpbmRMb2dvLmNvdW50cnkiOiBmdW5jdGlvbiAodmFsKSB7CiAgICAgIGlmICh2YWwubGVuZ3RoKSB7CiAgICAgICAgdGhpcy5sb2FkTG9nb3NGaW5kKHZhbCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5maW5kTG9nby5sb2dvID0gIiI7CiAgICAgIH0KICAgIH0sCiAgICAiYXNzaWduTG9nby5jb3VudHJ5IjogZnVuY3Rpb24gKHZhbCkgewogICAgICBpZiAodmFsLmxlbmd0aCkgewogICAgICAgIHRoaXMubG9hZExvZ29zQXNzaWduKHZhbCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5hc3NpZ25Mb2dvLmxvZ28gPSAiIjsKICAgICAgfQogICAgfSwKICB9LAp9Owo="},{"version":3,"sources":["editor.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAo4CA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"editor.vue","sourceRoot":"src/views/app/xtream","sourcesContent":["<template>\n  <erd-row class=\"m-0 p-0\" id=\"editor\">\n    <erd-spinner v-if=\"isLoading\" size=\"lg\" overlay absolute></erd-spinner>\n    <!--  \n\n      FIND / REPLACE\n\n    -->\n    <erd-modal\n      v-show=\"findReplace.modal\"\n      @close=\"findAndReplaceModal(false)\"\n      :title=\"$t('editor.find-replace')\"\n      class=\"select-none\"\n      small\n    >\n      <div class=\"px-2\">\n        <label class=\"w-100\">{{ $t(\"editor.search-for\") }}</label>\n        <erd-input\n          class=\"mt-1 mb-2 w-100\"\n          v-model=\"findReplace.from\"\n        ></erd-input>\n        <label class=\"w-100\">{{ $t(\"editor.replace-with\") }}</label>\n        <erd-input class=\"mt-1 mb-2 w-100\" v-model=\"findReplace.to\"></erd-input>\n        <label class=\"w-100\">{{ $t(\"editor.options\") }}</label>\n        <erd-checkbox class=\"mt-1\" v-model=\"findReplace.replaceAll\">{{\n          $t(\"editor.replace-all-occurences\")\n        }}</erd-checkbox>\n        <erd-checkbox class=\"mb-2\" v-model=\"findReplace.ignoreCase\">{{\n          $t(\"editor.ignore-case\")\n        }}</erd-checkbox>\n        <template v-if=\"findReplace.type === 1\">\n          <label class=\"w-100\">{{ $t(\"xtream.group\") }}</label>\n          <erd-radiobutton\n            class=\"mt-1\"\n            :value=\"1\"\n            v-model=\"findReplace.selectedOnly\"\n            >{{ $t(\"editor.selected-groups-only\") }}</erd-radiobutton\n          >\n          <erd-radiobutton :value=\"0\" v-model=\"findReplace.selectedOnly\">{{\n            $t(\"editor.all-groups\")\n          }}</erd-radiobutton>\n        </template>\n        <template v-if=\"findReplace.type === 2\">\n          <label class=\"w-100\">{{ $t(\"xtream.streams\") }}</label>\n          <erd-radiobutton\n            class=\"mt-1\"\n            :value=\"1\"\n            v-model=\"findReplace.selectedOnly\"\n            >{{ $t(\"editor.selected-streams-only\") }}</erd-radiobutton\n          >\n          <erd-radiobutton :value=\"0\" v-model=\"findReplace.selectedOnly\">{{\n            $t(\"editor.all-streams\")\n          }}</erd-radiobutton>\n        </template>\n      </div>\n      <template v-slot:footer>\n        <erd-button\n          @click=\"findAndReplaceModal(false)\"\n          icon=\"la-times\"\n          class=\"mr-1\"\n          variant=\"danger\"\n          >{{ $t(\"general.cancel\") }}</erd-button\n        >\n        <erd-button icon=\"la-check\" variant=\"success\" @click=\"findAndReplace\">{{\n          $t(\"general.ok\")\n        }}</erd-button>\n      </template>\n    </erd-modal>\n    <!--  \n\n      PREFIX / SUFFIX\n\n    -->\n    <erd-modal\n      v-show=\"prefixSuffix.modal\"\n      @close=\"prefixSuffixModal(false)\"\n      :title=\"$t('editor.add-prefix-suffix')\"\n      class=\"select-none\"\n      small\n    >\n      <div class=\"px-2\">\n        <label class=\"w-100\">{{ $t(\"editor.prefix\") }}</label>\n        <erd-input\n          class=\"mt-1 mb-2 w-100\"\n          v-model=\"prefixSuffix.prefix\"\n        ></erd-input>\n        <label class=\"w-100\">{{ $t(\"editor.suffix\") }}</label>\n        <erd-input\n          class=\"mt-1 mb-2 w-100\"\n          v-model=\"prefixSuffix.suffix\"\n        ></erd-input>\n        <template v-if=\"prefixSuffix.type === 1\">\n          <label class=\"w-100\">{{ $t(\"xtream.group\") }}</label>\n          <erd-radiobutton\n            class=\"mt-1\"\n            :value=\"1\"\n            v-model=\"prefixSuffix.selectedOnly\"\n            >{{ $t(\"editor.selected-groups-only\") }}</erd-radiobutton\n          >\n          <erd-radiobutton :value=\"0\" v-model=\"prefixSuffix.selectedOnly\">{{\n            $t(\"editor.all-groups\")\n          }}</erd-radiobutton>\n        </template>\n        <template v-if=\"prefixSuffix.type === 2\">\n          <label class=\"w-100\">{{ $t(\"xtream.streams\") }}</label>\n          <erd-radiobutton\n            class=\"mt-1\"\n            :value=\"1\"\n            v-model=\"prefixSuffix.selectedOnly\"\n            >{{ $t(\"editor.selected-streams-only\") }}</erd-radiobutton\n          >\n          <erd-radiobutton :value=\"0\" v-model=\"prefixSuffix.selectedOnly\">{{\n            $t(\"editor.all-streams\")\n          }}</erd-radiobutton>\n        </template>\n      </div>\n      <template v-slot:footer>\n        <erd-button\n          @click=\"prefixSuffixModal(false)\"\n          icon=\"la-times\"\n          class=\"mr-1\"\n          variant=\"danger\"\n          >{{ $t(\"general.cancel\") }}</erd-button\n        >\n        <erd-button\n          icon=\"la-check\"\n          variant=\"success\"\n          @click=\"addPrefixSuffix\"\n          >{{ $t(\"general.ok\") }}</erd-button\n        >\n      </template>\n    </erd-modal>\n    <!--  \n\n      CONVERT CASE\n\n    -->\n    <erd-modal\n      v-show=\"convertCase.modal\"\n      @close=\"convertCaseModal(false)\"\n      :title=\"$t('editor.change-case')\"\n      class=\"select-none\"\n      small\n    >\n      <div class=\"px-2\">\n        <label class=\"d-block mb-2\">{{ $t(\"editor.options\") }}</label>\n        <erd-radiobutton :value=\"0\" v-model=\"convertCase.method\">{{\n          $t(\"editor.title-case\")\n        }}</erd-radiobutton>\n        <erd-radiobutton :value=\"1\" v-model=\"convertCase.method\">{{\n          $t(\"editor.upper-case\")\n        }}</erd-radiobutton>\n        <erd-radiobutton class=\"mb-2\" :value=\"2\" v-model=\"convertCase.method\">{{\n          $t(\"editor.lower-case\")\n        }}</erd-radiobutton>\n        <template v-if=\"convertCase.type === 1\">\n          <label class=\"w-100\">{{ $t(\"xtream.group\") }}</label>\n          <erd-radiobutton\n            class=\"mt-1\"\n            :value=\"1\"\n            v-model=\"convertCase.selectedOnly\"\n            >{{ $t(\"editor.selected-groups-only\") }}</erd-radiobutton\n          >\n          <erd-radiobutton :value=\"0\" v-model=\"convertCase.selectedOnly\">{{\n            $t(\"editor.all-groups\")\n          }}</erd-radiobutton>\n        </template>\n        <template v-if=\"convertCase.type === 2\">\n          <label class=\"w-100\">{{ $t(\"xtream.streams\") }}</label>\n          <erd-radiobutton\n            class=\"mt-1\"\n            :value=\"1\"\n            v-model=\"convertCase.selectedOnly\"\n            >{{ $t(\"editor.selected-streams-only\") }}</erd-radiobutton\n          >\n          <erd-radiobutton :value=\"0\" v-model=\"convertCase.selectedOnly\">{{\n            $t(\"editor.all-streams\")\n          }}</erd-radiobutton>\n        </template>\n      </div>\n      <template v-slot:footer>\n        <erd-button\n          @click=\"convertCaseModal(false)\"\n          icon=\"la-times\"\n          class=\"mr-1\"\n          variant=\"danger\"\n          >{{ $t(\"general.cancel\") }}</erd-button\n        >\n        <erd-button icon=\"la-check\" variant=\"success\" @click=\"changeCase\">{{\n          $t(\"general.ok\")\n        }}</erd-button>\n      </template>\n    </erd-modal>\n    <!--  \n\n      EDIT GROUP\n\n    -->\n    <erd-modal\n      v-show=\"groupEditor.modal\"\n      @close=\"editGroupModal(false)\"\n      :title=\"$t('editor.edit-group')\"\n      class=\"select-none\"\n      small\n    >\n      <div class=\"px-2\">\n        <template v-if=\"canEditGroupType\">\n          <label class=\"w-100\">{{ $t(\"editor.group-type\") }}</label>\n          <erd-select\n            class=\"w-100 mt-1 mb-2\"\n            :items=\"groupTypes\"\n            v-model=\"groupEditor.group_type\"\n            v-if=\"groupEditor.modal\"\n          ></erd-select>\n        </template>\n        <label class=\"w-100\">{{ $t(\"editor.group-name\") }}</label>\n        <erd-input\n          class=\"mt-1 mb-2 w-100\"\n          v-model=\"groupEditor.group_name\"\n        ></erd-input>\n        <label class=\"w-100\">{{ $t(\"editor.parent-code\") }}</label>\n        <erd-input\n          class=\"mt-1 mb-2 w-100\"\n          v-model=\"groupEditor.group_parent_code\"\n        ></erd-input>\n        <erd-checkbox class=\"mb-2\" v-model=\"groupEditor.group_is_hidden\">{{\n          $t(\"editor.hidden\")\n        }}</erd-checkbox>\n      </div>\n      <template v-slot:footer>\n        <erd-button\n          @click=\"editGroupModal(false)\"\n          icon=\"la-times\"\n          class=\"mr-1\"\n          variant=\"danger\"\n          >{{ $t(\"general.cancel\") }}</erd-button\n        >\n        <erd-button icon=\"la-check\" variant=\"success\" @click=\"editGroup\">{{\n          $t(\"general.ok\")\n        }}</erd-button>\n      </template>\n    </erd-modal>\n    <!--  \n\n      EDIT STREAM\n\n    -->\n    <erd-modal\n      v-show=\"streamEditor.modal\"\n      @close=\"editStreamModal(false)\"\n      :title=\"$t('editor.edit-stream')\"\n      class=\"select-none\"\n      small\n    >\n      <div class=\"px-2\">\n        <template v-if=\"activeGroupType === 1\">\n          <label class=\"w-100\">{{ $t(\"editor.name-placeholder\") }}</label>\n          <erd-input\n            class=\"mt-1 mb-2 w-100\"\n            v-model=\"streamEditor.stream_tvg_name\"\n          ></erd-input>\n          <label class=\"w-100\">{{ $t(\"editor.epg-channel-id\") }}</label>\n          <erd-input\n            class=\"mt-1 mb-2 w-100\"\n            v-model=\"streamEditor.stream_tvg_id\"\n          ></erd-input>\n          <label class=\"w-100\">{{ $t(\"editor.stream-icon\") }}</label>\n          <erd-input\n            class=\"mt-1 mb-2 w-100\"\n            v-model=\"streamEditor.stream_tvg_logo\"\n          ></erd-input>\n          <div\n            class=\"form-control text-center mb-2\"\n            v-if=\"streamEditor.stream_tvg_logo\"\n          >\n            <a :href=\"streamEditor.stream_tvg_logo\" target=\"_blank\"\n              ><img\n                class=\"editor-stream-icon\"\n                :src=\"streamEditor.stream_tvg_logo\"\n            /></a>\n          </div>\n          <label class=\"w-100\" v-if=\"streamEditor.stream_is_custom == 1\">{{\n            $t(\"editor.stream-url\")\n          }}</label>\n          <erd-input\n            v-if=\"streamEditor.stream_is_custom == 1\"\n            class=\"mt-1 mb-2 w-100\"\n            v-model=\"streamEditor.source_stream_url\"\n          ></erd-input>\n          <label class=\"w-100\">{{ $t(\"editor.parent-code\") }}</label>\n          <erd-input\n            class=\"mt-1 mb-3 w-100\"\n            v-model=\"streamEditor.stream_parent_code\"\n          ></erd-input>\n          <erd-checkbox\n            class=\"mb-1\"\n            v-model=\"streamEditor.stream_radio\"\n            :true-value=\"1\"\n            :false-value=\"0\"\n            >{{ $t(\"editor.radio\") }}</erd-checkbox\n          >\n        </template>\n        <template v-if=\"activeGroupType === 2\">\n          <label class=\"w-100\">{{ $t(\"xtream.movie-name\") }}</label>\n          <erd-input\n            class=\"mt-1 mb-2 w-100\"\n            v-model=\"streamEditor.movie_name\"\n          ></erd-input>\n          <label class=\"w-100\">{{ $t(\"xtream.movie-year\") }}</label>\n          <erd-input\n            class=\"mt-1 mb-2 w-100\"\n            v-model=\"streamEditor.movie_year\"\n          ></erd-input>\n          <label class=\"w-100\">{{ $t(\"xtream.tmdb-id\") }}</label>\n          <erd-input\n            class=\"mt-1 mb-2 w-100\"\n            v-model=\"streamEditor.tmdb_id\"\n          ></erd-input>\n          <label class=\"w-100\" v-if=\"streamEditor.stream_is_custom == 1\">{{\n            $t(\"editor.stream-url\")\n          }}</label>\n          <erd-input\n            v-if=\"streamEditor.stream_is_custom == 1\"\n            class=\"mt-1 mb-2 w-100\"\n            v-model=\"streamEditor.source_stream_url\"\n          ></erd-input>\n          <label class=\"w-100\">{{ $t(\"xtream.movie-poster\") }}</label>\n          <erd-input\n            class=\"mt-1 mb-2 w-100\"\n            v-model=\"streamEditor.stream_tvg_logo\"\n          ></erd-input>\n          <div\n            class=\"form-control text-center mb-2\"\n            v-if=\"streamEditor.stream_tvg_logo\"\n          >\n            <a :href=\"streamEditor.stream_tvg_logo\" target=\"_blank\"\n              ><img\n                class=\"editor-movie-poster\"\n                :src=\"streamEditor.stream_tvg_logo\"\n            /></a>\n          </div>\n        </template>\n        <template v-if=\"activeGroupType === 3\">\n          <label class=\"w-100\">{{ $t(\"xtream.name\") }}</label>\n          <erd-input\n            class=\"mt-1 mb-2 w-100\"\n            v-model=\"streamEditor.serie_name\"\n          ></erd-input>\n          <label class=\"w-100\">{{ $t(\"xtream.season\") }}</label>\n          <erd-input\n            class=\"mt-1 mb-2 w-100\"\n            v-model=\"streamEditor.serie_season\"\n            type=\"number\"\n          ></erd-input>\n          <label class=\"w-100\">{{ $t(\"xtream.episode\") }}</label>\n          <erd-input\n            class=\"mt-1 mb-2 w-100\"\n            v-model=\"streamEditor.serie_episode\"\n            type=\"number\"\n          ></erd-input>\n          <label class=\"w-100\">{{ $t(\"xtream.tmdb-id\") }}</label>\n          <erd-input\n            class=\"mt-1 mb-2 w-100\"\n            v-model=\"streamEditor.tmdb_id\"\n          ></erd-input>\n          <label class=\"w-100\" v-if=\"streamEditor.stream_is_custom == 1\">{{\n            $t(\"editor.stream-url\")\n          }}</label>\n          <erd-input\n            v-if=\"streamEditor.stream_is_custom == 1\"\n            class=\"mt-1 mb-2 w-100\"\n            v-model=\"streamEditor.source_stream_url\"\n          ></erd-input>\n          <label class=\"w-100\">{{ $t(\"xtream.serie-poster\") }}</label>\n          <erd-input\n            class=\"mt-1 mb-2 w-100\"\n            v-model=\"streamEditor.stream_tvg_logo\"\n          ></erd-input>\n          <div\n            class=\"form-control text-center mb-2\"\n            v-if=\"streamEditor.stream_tvg_logo\"\n          >\n            <a :href=\"streamEditor.stream_tvg_logo\" target=\"_blank\"\n              ><img\n                class=\"editor-movie-poster\"\n                :src=\"streamEditor.stream_tvg_logo\"\n            /></a>\n          </div>\n        </template>\n        <erd-checkbox class=\"mb-1\" v-model=\"streamEditor.stream_is_hidden\">{{\n          $t(\"editor.hidden\")\n        }}</erd-checkbox>\n      </div>\n      <template v-slot:footer>\n        <erd-button\n          @click=\"editStreamModal(false)\"\n          icon=\"la-times\"\n          class=\"mr-1\"\n          variant=\"danger\"\n          >{{ $t(\"general.cancel\") }}</erd-button\n        >\n        <erd-button icon=\"la-check\" variant=\"success\" @click=\"editStream\">{{\n          $t(\"general.ok\")\n        }}</erd-button>\n      </template>\n    </erd-modal>\n    <!--  \n\n      SAVE CHANGES\n\n    -->\n    <erd-modal\n      v-show=\"saveChanges.modal\"\n      @close=\"saveChangesModal(false)\"\n      :title=\"$t('editor.save-changes')\"\n      class=\"select-none\"\n      small\n    >\n      <div class=\"px-2\">\n        <p>{{ $t(\"editor.save-changes-text\") }}</p>\n      </div>\n      <template v-slot:footer>\n        <erd-button\n          @click=\"saveChangesModal(false)\"\n          icon=\"la-times\"\n          class=\"mr-1\"\n          variant=\"danger\"\n          >{{ $t(\"general.cancel\") }}</erd-button\n        >\n        <erd-button\n          icon=\"la-check\"\n          variant=\"success\"\n          @click=\"saveChangesModal(false, true)\"\n          >{{ $t(\"general.ok\") }}</erd-button\n        >\n      </template>\n    </erd-modal>\n    <!--  \n\n      RADIOBROWSER\n\n    -->\n    <erd-modal\n      v-show=\"radioBrowser.modal\"\n      @close=\"radioBrowserModal(false)\"\n      :title=\"$t('editor.import-radiobrowser')\"\n      class=\"select-none\"\n    >\n      <div class=\"px-2\">\n        <label class=\"w-100\" for=\"radiobrowser-search\">{{\n          $t(\"menu.search\")\n        }}</label>\n        <erd-input\n          id=\"radiobrowser-search\"\n          class=\"mt-1 mb-2 w-100\"\n          v-model=\"radioBrowser.search\"\n          autocomplete=\"off\"\n          :placeholder=\"$t('menu.search')\"\n        ></erd-input>\n        <div class=\"radiobrowser-stations\">\n          <erd-spinner\n            v-if=\"radioBrowser.isLoading\"\n            size=\"lg\"\n            overlay\n            absolute\n          ></erd-spinner>\n          <p class=\"mb-1 pb-0\" v-if=\"radioBrowser.results.length\">\n            {{ $t(\"editor.select-radio-stations\") }}\n          </p>\n          <perfect-scrollbar\n            :settings=\"{ suppressScrollX: true, wheelPropagation: false }\"\n          >\n            <div\n              class=\"form-control radiobrowser-station\"\n              :class=\"{ selected: radioBrowser.active.includes(index) }\"\n              v-for=\"(station, index) in radioBrowser.results\"\n              :key=\"`radiobrowser-station-${index}-${station.name}`\"\n              @click.ctrl=\"toggleRadiobrowserSelection(index)\"\n              @click.shift=\"selectRadiobrowserRangeSelection(index)\"\n              @click.exact=\"selectRadiobrowserSelection(index)\"\n            >\n              <span class=\"station-name\">{{ station.name }}</span>\n              <span class=\"text-muted text-small ml-1\">{{\n                station.language.replace(/\\b\\w/g, (l) => l.toUpperCase())\n              }}</span>\n              <span class=\"text-muted text-small float-right\"\n                >{{ station.codec }} - {{ station.bitrate }}</span\n              >\n            </div>\n          </perfect-scrollbar>\n        </div>\n      </div>\n      <template v-slot:footer>\n        <erd-button\n          @click=\"radioBrowserModal(false)\"\n          icon=\"la-times\"\n          class=\"mr-1\"\n          variant=\"danger\"\n          >{{ $t(\"general.cancel\") }}</erd-button\n        >\n        <erd-button\n          icon=\"la-check\"\n          variant=\"success\"\n          @click=\"radioBrowserModal(false, true)\"\n          :disabled=\"\n            radioBrowser.isLoading || radioBrowser.results.length === 0\n          \"\n          >{{ $t(\"general.ok\") }}</erd-button\n        >\n      </template>\n    </erd-modal>\n    <!--  \n\n      SOUNDCLOUD\n\n    -->\n    <erd-modal\n      v-show=\"soundcloud.modal\"\n      @close=\"soundcloudModal(false)\"\n      :title=\"$t('editor.import-soundcloud')\"\n      class=\"select-none\"\n    >\n      <div class=\"px-2\">\n        <erd-spinner\n          v-if=\"soundcloud.isLoading\"\n          size=\"lg\"\n          overlay\n          absolute\n        ></erd-spinner>\n        <label class=\"w-100\" for=\"soundcloud-url\">{{\n          $t(\"radio.soundcloud-url\")\n        }}</label>\n        <erd-input\n          id=\"soundcloud-url\"\n          class=\"mt-1 mb-2 w-100\"\n          v-model=\"soundcloud.url\"\n          autocomplete=\"off\"\n          :placeholder=\"$t('radio.soundcloud-url-placeholder')\"\n        ></erd-input>\n        <div\n          class=\"soundcloud-info form-control mb-2 w-100 text-center\"\n          v-if=\"soundcloud.track\"\n        >\n          <img\n            :src=\"\n              soundcloud.track.artwork_url.replace('large.jpg', 't500x500.jpg')\n            \"\n            class=\"cover mt-2\"\n          />\n          <div class=\"info\">\n            <h5 class=\"mb-1\">{{ soundcloud.track.title }}</h5>\n            <p class=\"p-0 m-0 text-muted\">\n              {{ formatNumber(soundcloud.track.likes_count) }}\n              {{ $t(\"radio.likes\") }} <small></small>\n              {{ formatDateYoutube(soundcloud.track.display_date) }}\n              <small></small>\n              {{ formatSeconds(soundcloud.track.duration / 1000) }}\n            </p>\n          </div>\n        </div>\n      </div>\n      <template v-slot:footer>\n        <erd-button\n          @click=\"soundcloudModal(false)\"\n          icon=\"la-times\"\n          class=\"mr-1\"\n          variant=\"danger\"\n          >{{ $t(\"general.cancel\") }}</erd-button\n        >\n        <erd-button\n          icon=\"la-check\"\n          variant=\"success\"\n          @click=\"soundcloudModal(false, true)\"\n          :disabled=\"soundcloud.isLoading || soundcloud.track === null\"\n          >{{ $t(\"general.ok\") }}</erd-button\n        >\n      </template>\n    </erd-modal>\n    <!--  \n\n      YOUTUBE\n\n    -->\n    <erd-modal\n      v-show=\"youtube.modal\"\n      @close=\"youtubeModal(false)\"\n      :title=\"$t('editor.import-youtube')\"\n      class=\"select-none\"\n    >\n      <div class=\"px-2\">\n        <erd-spinner\n          v-if=\"youtube.isLoading\"\n          size=\"lg\"\n          overlay\n          absolute\n        ></erd-spinner>\n        <label class=\"w-100\" for=\"youtube-url\">{{\n          $t(\"editor.youtube-url\")\n        }}</label>\n        <erd-input\n          id=\"youtube-url\"\n          class=\"mt-1 mb-2 w-100\"\n          v-model=\"youtube.url\"\n          autocomplete=\"off\"\n          :placeholder=\"$t('editor.youtube-url-placeholder')\"\n        ></erd-input>\n        <div\n          class=\"soundcloud-info form-control mb-2 w-100 text-center\"\n          v-if=\"youtube.video\"\n        >\n          <img\n            :src=\"`https://i.ytimg.com/vi/${youtube.videoId}/maxresdefault.jpg`\"\n            class=\"cover mt-2\"\n          />\n          <div class=\"info\">\n            <h5 class=\"mb-1\">{{ youtube.video.videoDetails.title }}</h5>\n            <p class=\"p-0 m-0 text-muted\">\n              {{ formatNumber(youtube.video.videoDetails.viewCount) }}\n              {{ $t(\"editor.views\") }} <small></small>\n              {{ formatSeconds(youtube.video.videoDetails.lengthSeconds) }}\n            </p>\n          </div>\n        </div>\n      </div>\n      <template v-slot:footer>\n        <erd-button\n          @click=\"youtubeModal(false)\"\n          icon=\"la-times\"\n          class=\"mr-1\"\n          variant=\"danger\"\n          >{{ $t(\"general.cancel\") }}</erd-button\n        >\n        <erd-button\n          icon=\"la-check\"\n          variant=\"success\"\n          @click=\"youtubeModal(false, true)\"\n          :disabled=\"youtube.isLoading || youtube.video === null\"\n          >{{ $t(\"general.ok\") }}</erd-button\n        >\n      </template>\n    </erd-modal>\n    <!--  \n\n      VIMEO\n\n    -->\n    <erd-modal\n      v-show=\"vimeo.modal\"\n      @close=\"vimeoModal(false)\"\n      :title=\"$t('editor.import-vimeo')\"\n      class=\"select-none\"\n    >\n      <div class=\"px-2\">\n        <erd-spinner\n          v-if=\"vimeo.isLoading\"\n          size=\"lg\"\n          overlay\n          absolute\n        ></erd-spinner>\n        <label class=\"w-100\" for=\"vimeo-url\">{{\n          $t(\"editor.vimeo-url\")\n        }}</label>\n        <erd-input\n          id=\"vimeo-url\"\n          class=\"mt-1 mb-2 w-100\"\n          v-model=\"vimeo.url\"\n          autocomplete=\"off\"\n          :placeholder=\"$t('editor.vimeo-url-placeholder')\"\n        ></erd-input>\n        <div\n          class=\"soundcloud-info form-control mb-2 w-100 text-center\"\n          v-if=\"vimeo.video\"\n        >\n          <img :src=\"vimeo.video.video.thumbs.base\" class=\"cover mt-2\" />\n          <div class=\"info\">\n            <h5 class=\"mb-1\">{{ vimeo.video.video.title }}</h5>\n            <p class=\"p-0 m-0 text-muted\">\n              {{ formatSeconds(vimeo.video.video.duration) }}\n            </p>\n          </div>\n        </div>\n      </div>\n      <template v-slot:footer>\n        <erd-button\n          @click=\"vimeoModal(false)\"\n          icon=\"la-times\"\n          class=\"mr-1\"\n          variant=\"danger\"\n          >{{ $t(\"general.cancel\") }}</erd-button\n        >\n        <erd-button\n          icon=\"la-check\"\n          variant=\"success\"\n          @click=\"vimeoModal(false, true)\"\n          :disabled=\"vimeo.isLoading || vimeo.video === null\"\n          >{{ $t(\"general.ok\") }}</erd-button\n        >\n      </template>\n    </erd-modal>\n    <!--  \n\n      DAILYMOTION\n\n    -->\n    <erd-modal\n      v-show=\"dailymotion.modal\"\n      @close=\"dailymotionModal(false)\"\n      :title=\"$t('editor.import-dailymotion')\"\n      class=\"select-none\"\n    >\n      <div class=\"px-2\">\n        <erd-spinner\n          v-if=\"dailymotion.isLoading\"\n          size=\"lg\"\n          overlay\n          absolute\n        ></erd-spinner>\n        <label class=\"w-100\" for=\"dailymotion-url\">{{\n          $t(\"editor.dailymotion-url\")\n        }}</label>\n        <erd-input\n          id=\"dailymotion-url\"\n          class=\"mt-1 mb-2 w-100\"\n          v-model=\"dailymotion.url\"\n          autocomplete=\"off\"\n          :placeholder=\"$t('editor.dailymotion-url-placeholder')\"\n        ></erd-input>\n        <div\n          class=\"soundcloud-info form-control mb-2 w-100 text-center\"\n          v-if=\"dailymotion.video\"\n        >\n          <img :src=\"dailymotion.video.thumbnail_1080_url\" class=\"cover mt-2\" />\n          <div class=\"info\">\n            <h5 class=\"mb-1\">{{ dailymotion.video.title }}</h5>\n            <p class=\"p-0 m-0 text-muted\">\n              {{ formatNumber(dailymotion.video.views_total) }}\n              {{ $t(\"editor.views\") }} <small></small>\n              {{ formatSeconds(dailymotion.video.duration) }}\n            </p>\n          </div>\n        </div>\n      </div>\n      <template v-slot:footer>\n        <erd-button\n          @click=\"dailymotionModal(false)\"\n          icon=\"la-times\"\n          class=\"mr-1\"\n          variant=\"danger\"\n          >{{ $t(\"general.cancel\") }}</erd-button\n        >\n        <erd-button\n          icon=\"la-check\"\n          variant=\"success\"\n          @click=\"dailymotionModal(false, true)\"\n          :disabled=\"dailymotion.isLoading || dailymotion.video === null\"\n          >{{ $t(\"general.ok\") }}</erd-button\n        >\n      </template>\n    </erd-modal>\n    <!--  \n\n      TED-TALKS\n\n    -->\n    <erd-modal\n      v-show=\"tedTalks.modal\"\n      @close=\"tedTalksModal(false)\"\n      :title=\"$t('editor.import-ted-talks')\"\n      class=\"select-none\"\n    >\n      <div class=\"px-2\">\n        <erd-spinner\n          v-if=\"tedTalks.isLoading\"\n          size=\"lg\"\n          overlay\n          absolute\n        ></erd-spinner>\n        <label class=\"w-100\" for=\"tedTalks-url\">{{\n          $t(\"editor.ted-talks-url\")\n        }}</label>\n        <erd-input\n          id=\"tedTalks-url\"\n          class=\"mt-1 mb-2 w-100\"\n          v-model=\"tedTalks.url\"\n          autocomplete=\"off\"\n          :placeholder=\"$t('editor.ted-talks-url-placeholder')\"\n        ></erd-input>\n        <div\n          class=\"soundcloud-info form-control mb-2 w-100 text-center\"\n          v-if=\"tedTalks.video\"\n        >\n          <img :src=\"tedTalks.video.hero\" class=\"cover mt-2\" />\n          <div class=\"info\">\n            <h5 class=\"mb-1\">{{ tedTalks.video.title }}</h5>\n            <p class=\"p-0 m-0 text-muted\">\n              {{ formatNumber(tedTalks.video.viewed_count) }}\n              {{ $t(\"editor.views\") }} <small></small>\n              {{ formatSeconds(tedTalks.video.duration) }}\n            </p>\n          </div>\n        </div>\n      </div>\n      <template v-slot:footer>\n        <erd-button\n          @click=\"tedTalksModal(false)\"\n          icon=\"la-times\"\n          class=\"mr-1\"\n          variant=\"danger\"\n          >{{ $t(\"general.cancel\") }}</erd-button\n        >\n        <erd-button\n          icon=\"la-check\"\n          variant=\"success\"\n          @click=\"tedTalksModal(false, true)\"\n          :disabled=\"tedTalks.isLoading || tedTalks.video === null\"\n          >{{ $t(\"general.ok\") }}</erd-button\n        >\n      </template>\n    </erd-modal>\n    <!--  \n\n      XHAMSTER\n\n    -->\n    <erd-modal\n      v-show=\"xhamster.modal\"\n      @close=\"xhamsterModal(false)\"\n      :title=\"$t('editor.import-xhamster')\"\n      class=\"select-none\"\n    >\n      <div class=\"px-2\">\n        <erd-spinner\n          v-if=\"xhamster.isLoading\"\n          size=\"lg\"\n          overlay\n          absolute\n        ></erd-spinner>\n        <label class=\"w-100\" for=\"xhamster-url\">{{\n          $t(\"editor.xhamster-url\")\n        }}</label>\n        <erd-input\n          id=\"xhamster-url\"\n          class=\"mt-1 mb-2 w-100\"\n          v-model=\"xhamster.url\"\n          autocomplete=\"off\"\n          :placeholder=\"$t('editor.xhamster-url-placeholder')\"\n        ></erd-input>\n        <div\n          class=\"soundcloud-info form-control mb-2 w-100 text-center\"\n          v-if=\"xhamster.video\"\n        >\n          <img :src=\"xhamster.video.videoEntity.thumbBig\" class=\"cover mt-2\" />\n          <div class=\"info\">\n            <h5 class=\"mb-1\">{{ xhamster.video.videoEntity.title }}</h5>\n            <p class=\"p-0 m-0 text-muted\">\n              {{ formatSeconds(xhamster.video.videoEntity.duration) }}\n            </p>\n          </div>\n        </div>\n      </div>\n      <template v-slot:footer>\n        <erd-button\n          @click=\"xhamsterModal(false)\"\n          icon=\"la-times\"\n          class=\"mr-1\"\n          variant=\"danger\"\n          >{{ $t(\"general.cancel\") }}</erd-button\n        >\n        <erd-button\n          icon=\"la-check\"\n          variant=\"success\"\n          @click=\"xhamsterModal(false, true)\"\n          :disabled=\"xhamster.isLoading || xhamster.video === null\"\n          >{{ $t(\"general.ok\") }}</erd-button\n        >\n      </template>\n    </erd-modal>\n    <!--  \n\n      FIND LOGO\n\n    -->\n    <erd-modal\n      v-show=\"findLogo.modal\"\n      @close=\"findLogoModal(false)\"\n      :title=\"$t('editor.find-logo')\"\n      class=\"select-none\"\n      small\n    >\n      <div class=\"px-2\">\n        <erd-spinner\n          v-if=\"findLogo.isLoading\"\n          size=\"lg\"\n          overlay\n          absolute\n        ></erd-spinner>\n        <label class=\"w-100\" for=\"logo-country\">{{\n          $t(\"editor.logo-country\")\n        }}</label>\n        <erd-select\n          v-if=\"findLogo.modal\"\n          ref=\"logo-countries\"\n          id=\"logo-country\"\n          class=\"w-100 mt-1 mb-2\"\n          :items=\"findLogo.countries\"\n          v-model=\"findLogo.country\"\n        ></erd-select>\n        <label class=\"w-100\" for=\"find-logo-search\">{{\n          $t(\"editor.find-logo-search\")\n        }}</label>\n        <erd-input\n          id=\"find-logo-search\"\n          class=\"mt-1 mb-2 w-100\"\n          v-model=\"findLogo.search\"\n          autocomplete=\"off\"\n          :placeholder=\"$t('menu.search')\"\n        ></erd-input>\n        <label class=\"w-100\" for=\"logos\">{{ $t(\"editor.logos\") }}</label>\n        <erd-select\n          v-if=\"findLogo.modal\"\n          ref=\"logo-logos\"\n          id=\"logos\"\n          class=\"w-100 mt-1 mb-2\"\n          :items=\"filteredLogos\"\n          v-model=\"findLogo.logo\"\n        ></erd-select>\n        <div class=\"find-logo form-control mb-2 w-100 text-center\">\n          <a\n            :href=\"`http://static.iptv-tools.com/${findLogo.country}/${findLogo.logo}`\"\n            target=\"_blank\"\n          >\n            <img\n              v-if=\"findLogo.logo.length\"\n              :src=\"`http://static.iptv-tools.com/${findLogo.country}/${findLogo.logo}`\"\n              class=\"stream-logo mt-2\"\n          /></a>\n        </div>\n      </div>\n      <template v-slot:footer>\n        <erd-button\n          @click=\"findLogoModal(false)\"\n          icon=\"la-times\"\n          class=\"mr-1\"\n          variant=\"danger\"\n          >{{ $t(\"general.cancel\") }}</erd-button\n        >\n        <erd-button\n          icon=\"la-check\"\n          variant=\"success\"\n          @click=\"findLogoModal(false, true)\"\n          :disabled=\"findLogo.isLoading || findLogo.logos.length === 0\"\n          >{{ $t(\"general.ok\") }}</erd-button\n        >\n      </template>\n    </erd-modal>\n    <!--  \n\n      ASSIGN LOGOS\n\n    -->\n    <erd-modal\n      v-show=\"assignLogo.modal\"\n      @close=\"assignLogoModal(false)\"\n      :title=\"$t('editor.assign-stream-logos')\"\n      class=\"select-none\"\n      small\n    >\n      <div class=\"px-2 assign-logo\">\n        <erd-spinner\n          v-if=\"assignLogo.isLoading\"\n          size=\"lg\"\n          overlay\n          absolute\n        ></erd-spinner>\n        <label class=\"w-100\" for=\"assign-logo-country\">{{\n          $t(\"editor.logo-country\")\n        }}</label>\n        <erd-select\n          v-if=\"assignLogo.modal\"\n          ref=\"assign-logo-countries\"\n          id=\"assign-logo-country\"\n          class=\"w-100 mt-1 mb-2\"\n          :items=\"assignLogo.countries\"\n          v-model=\"assignLogo.country\"\n        ></erd-select>\n        <erd-radiobutton\n          class=\"mt-1\"\n          :value=\"1\"\n          v-model=\"assignLogo.assignAll\"\n          >{{ $t(\"editor.assign-all-streams\") }}</erd-radiobutton\n        >\n        <erd-radiobutton :value=\"0\" v-model=\"assignLogo.assignAll\">{{\n          $t(\"editor.assign-missing-only\")\n        }}</erd-radiobutton>\n      </div>\n      <template v-slot:footer>\n        <erd-button\n          @click=\"assignLogoModal(false)\"\n          icon=\"la-times\"\n          class=\"mr-1\"\n          variant=\"danger\"\n          >{{ $t(\"general.cancel\") }}</erd-button\n        >\n        <erd-button\n          icon=\"la-check\"\n          variant=\"success\"\n          @click=\"assignLogoModal(false, true)\"\n          :disabled=\"assignLogo.isLoading || assignLogo.country.length === 0\"\n          >{{ $t(\"general.ok\") }}</erd-button\n        >\n      </template>\n    </erd-modal>\n    <!--  \n\n      APP MENU\n\n    -->\n    <erd-app-menu icon=\"la-tools\">\n      <div class=\"pt-3 select-none\" v-if=\"playlistSelected\">\n        <erd-collapse :title=\"$t('editor.import-m3u')\" key=\"import-m3u\" small>\n          <ul class=\"list-unstyled mb-0\">\n            <li class=\"nav-item\">\n              <a href=\"#\" @click.prevent\n                ><i class=\"las la-file-import mr-1\"></i\n                >{{ $t(\"editor.import-file\") }}</a\n              >\n            </li>\n            <li class=\"nav-item\">\n              <a href=\"#\" @click.prevent\n                ><i class=\"las la-globe mr-1\"></i\n                >{{ $t(\"editor.import-url\") }}</a\n              >\n            </li>\n          </ul>\n        </erd-collapse>\n        <erd-collapse :title=\"$t('editor.sort-groups')\" key=\"sort-groups\" small>\n          <ul class=\"list-unstyled mb-0\">\n            <li class=\"nav-item\">\n              <a href=\"#\" @click.prevent=\"sortGroupAlphaUp\"\n                ><i class=\"las la-sort-alpha-up mr-1\"></i\n                >{{ $t(\"editor.sort-alpha-up\") }}</a\n              >\n            </li>\n            <li class=\"nav-item\">\n              <a href=\"#\" @click.prevent=\"sortGroupAlphaDown\"\n                ><i class=\"las la-sort-alpha-down mr-1\"></i\n                >{{ $t(\"editor.sort-alpha-down\") }}</a\n              >\n            </li>\n            <li class=\"nav-item\">\n              <a href=\"#\" @click.prevent=\"sortGroupTypeUp\"\n                ><i class=\"las la-sort-numeric-up mr-1\"></i\n                >{{ $t(\"editor.sort-type-up\") }}</a\n              >\n            </li>\n            <li class=\"nav-item\">\n              <a href=\"#\" @click.prevent=\"sortGroupTypeDown\"\n                ><i class=\"las la-sort-numeric-down mr-1\"></i\n                >{{ $t(\"editor.sort-type-down\") }}</a\n              >\n            </li>\n          </ul>\n        </erd-collapse>\n        <erd-collapse\n          :title=\"$t('editor.sort-streams')\"\n          key=\"sort-streams\"\n          small\n        >\n          <ul class=\"list-unstyled mb-0\">\n            <li class=\"nav-item\">\n              <a href=\"#\" @click.prevent=\"sortStreamAlphaUp\"\n                ><i class=\"las la-sort-alpha-up mr-1\"></i\n                >{{ $t(\"editor.sort-alpha-up\") }}</a\n              >\n            </li>\n            <li class=\"nav-item\">\n              <a href=\"#\" @click.prevent=\"sortStreamAlphaDown\"\n                ><i class=\"las la-sort-alpha-down mr-1\"></i\n                >{{ $t(\"editor.sort-alpha-down\") }}</a\n              >\n            </li>\n            <li class=\"nav-item\">\n              <a href=\"#\" @click.prevent=\"sortStreamHiddenUp\"\n                ><i class=\"las la-eye-slash mr-1\"></i\n                >{{ $t(\"editor.sort-hidden-up\") }}</a\n              >\n            </li>\n            <li class=\"nav-item\">\n              <a href=\"#\" @click.prevent=\"sortStreamHiddenDown\"\n                ><i class=\"las la-eye-slash mr-1\"></i\n                >{{ $t(\"editor.sort-hidden-down\") }}</a\n              >\n            </li>\n          </ul>\n        </erd-collapse>\n        <erd-collapse\n          v-if=\"activeGroupType == 1\"\n          :title=\"$t('editor.import-radio')\"\n          key=\"import-radio\"\n          small\n        >\n          <ul class=\"list-unstyled mb-0\">\n            <li class=\"nav-item\">\n              <a href=\"#\" @click.prevent=\"radioBrowserModal(true)\"\n                ><i class=\"las la-broadcast-tower mr-1\"></i\n                >{{ $t(\"editor.import-radiobrowser\") }}</a\n              >\n            </li>\n          </ul>\n        </erd-collapse>\n        <erd-collapse\n          v-if=\"activeGroupType == 1\"\n          :title=\"$t('editor.import-music')\"\n          key=\"import-music\"\n          small\n        >\n          <ul class=\"list-unstyled mb-0\">\n            <li class=\"nav-item\">\n              <a href=\"#\" @click.prevent=\"soundcloudModal(true)\"\n                ><i class=\"lab la-soundcloud mr-1\"></i\n                >{{ $t(\"editor.import-soundcloud\") }}</a\n              >\n            </li>\n          </ul>\n        </erd-collapse>\n        <erd-collapse\n          :title=\"$t('editor.import-video')\"\n          key=\"import-video\"\n          small\n        >\n          <ul class=\"list-unstyled mb-0\">\n            <li class=\"nav-item\">\n              <a href=\"#\" @click.prevent=\"youtubeModal(true)\"\n                ><i class=\"lab la-youtube mr-1\"></i\n                >{{ $t(\"editor.import-youtube\") }}</a\n              >\n            </li>\n            <li class=\"nav-item\">\n              <a href=\"#\" @click.prevent=\"vimeoModal(true)\"\n                ><i class=\"lab la-vimeo mr-1\"></i\n                >{{ $t(\"editor.import-vimeo\") }}</a\n              >\n            </li>\n            <li class=\"nav-item\">\n              <a href=\"#\" @click.prevent=\"dailymotionModal(true)\"\n                ><i class=\"lab la-youtube mr-1\"></i\n                >{{ $t(\"editor.import-dailymotion\") }}</a\n              >\n            </li>\n            <li class=\"nav-item\">\n              <a href=\"#\" @click.prevent=\"tedTalksModal(true)\"\n                ><i class=\"las la-comments mr-1\"></i\n                >{{ $t(\"editor.import-ted-talks\") }}</a\n              >\n            </li>\n            <li class=\"nav-item\">\n              <a href=\"#\" @click.prevent=\"xhamsterModal(true)\"\n                ><i class=\"las la-heart mr-1\"></i\n                >{{ $t(\"editor.import-xhamster\") }}</a\n              >\n            </li>\n          </ul>\n        </erd-collapse>\n        <erd-collapse\n          :title=\"$t('editor.assign-logos')\"\n          key=\"assign-logos\"\n          small\n          v-if=\"activeGroupType == 1\"\n        >\n          <ul class=\"list-unstyled mb-0\">\n            <li class=\"nav-item\">\n              <a href=\"#\" @click.prevent=\"assignLogoModal(true)\"\n                ><i class=\"las la-photo-video mr-1\"></i\n                >{{ $t(\"editor.assign-stream-logos\") }}</a\n              >\n            </li>\n          </ul>\n        </erd-collapse>\n      </div>\n    </erd-app-menu>\n    <erd-row class=\"m-0 p-0\" v-if=\"playlistSelected\">\n      <!--  \n\n        GROUPS\n\n      -->\n      <erd-col xl=\"4\" lg=\"4\" md=\"12\" class=\"pr-lg-0\">\n        <div class=\"form-control\">\n          <span class=\"mr-1\">{{ $t(\"xtream.groups\") }}</span>\n          <span class=\"font-weight-bold\">{{ filteredGroups.length }}</span>\n        </div>\n        <erd-context-menu\n          :items=\"groupContextMenu\"\n          depth=\"1\"\n          ref=\"context-group\"\n        ></erd-context-menu>\n        <div @contextmenu.prevent=\"openContext('context-group')\">\n          <draggable\n            v-model=\"playlistEditor.groups\"\n            @start=\"dragGroup = true\"\n            @end=\"dragGroup = false\"\n            @change=\"groupDragChanged\"\n            animation=\"200\"\n            group=\"groups\"\n            ghost-class=\"ghost\"\n            scroll-sensitivity=\"200\"\n            selected-class=\"selected\"\n            handle=\".handle\"\n            :force-fallback=\"true\"\n            :multi-drag=\"true\"\n          >\n            <transition-group\n              type=\"transition\"\n              :name=\"!dragGroup ? 'flip-list' : null\"\n            >\n              <div\n                class=\"form-control editor-group\"\n                :class=\"{\n                  selected: activeGroups.includes(group.id),\n                  active: activeGroup === group.id,\n                  hidden: group.group_is_hidden,\n                }\"\n                v-for=\"(group, index) in filteredGroups\"\n                :key=\"`group-${index}`\"\n                @click.ctrl=\"toggleGroupSelection(group.id)\"\n                @click.shift=\"selectGroupRangeSelection(group.id)\"\n                @click.exact=\"selectGroupSelection(group.id)\"\n                @dblclick=\"groupDoubleClick\"\n              >\n                <i class=\"las la-braille handle mr-2\"></i>\n                <a href=\"#\" @click.prevent=\"activeGroup = group.id\">{{\n                  group.group_name\n                }}</a>\n                <span class=\"float-right\">{{ group.streams }}</span>\n              </div>\n            </transition-group>\n          </draggable>\n        </div>\n      </erd-col>\n      <!--  \n\n        STREAMS\n\n      -->\n      <erd-col xl=\"8\" lg=\"8\" md=\"12\">\n        <div class=\"form-control\">\n          <span class=\"mr-1\">{{ $t(\"xtream.streams\") }}</span>\n          <span class=\"font-weight-bold\">{{ filteredStreams.length }}</span>\n        </div>\n        <erd-context-menu\n          :items=\"streamContextMenu\"\n          depth=\"1\"\n          ref=\"context-stream\"\n        ></erd-context-menu>\n        <!-- LIVE -->\n        <template v-if=\"activeGroupType === 1 && !isLoading\">\n          <div @contextmenu.prevent=\"openContext('context-stream')\">\n            <draggable\n              v-model=\"playlistEditor.streams\"\n              @start=\"dragStream = true\"\n              @end=\"dragStream = false\"\n              @change=\"streamDragChanged\"\n              animation=\"200\"\n              group=\"streams\"\n              ghost-class=\"ghost\"\n              scroll-sensitivity=\"200\"\n              selected-class=\"selected\"\n              handle=\".handle\"\n              :force-fallback=\"true\"\n              :multi-drag=\"true\"\n            >\n              <transition-group\n                type=\"transition\"\n                :name=\"!dragStream ? 'flip-list' : null\"\n              >\n                <div\n                  class=\"form-control editor-stream\"\n                  :class=\"{\n                    selected: activeStreams.includes(stream.id),\n                    active: activeStream === stream.id,\n                    hidden: stream.stream_is_hidden,\n                  }\"\n                  v-for=\"(stream, index) in filteredStreams\"\n                  :key=\"`stream-${index}-${stream.id}`\"\n                  @click.ctrl=\"toggleStreamSelection(stream.id)\"\n                  @click.shift=\"selectStreamRangeSelection(stream.id)\"\n                  @click.exact=\"selectStreamSelection(stream.id)\"\n                  @dblclick=\"streamDoubleClick\"\n                >\n                  <i class=\"las la-braille handle mr-2\"></i>\n                  <span class=\"mr-2\">{{ stream.stream_tvg_name }}</span>\n                  <span class=\"text-muted\">{{ stream.stream_tvg_id }}</span>\n                  <i class=\"ml-2 las la-music\" v-if=\"stream.stream_radio\"></i>\n                  <img\n                    class=\"stream-icon\"\n                    v-if=\"stream.stream_tvg_logo\"\n                    :src=\"stream.stream_tvg_logo\"\n                  />\n                </div>\n              </transition-group>\n            </draggable>\n          </div>\n        </template>\n        <!-- MOVIES -->\n        <template v-if=\"activeGroupType === 2 && !isLoading\">\n          <div @contextmenu.prevent=\"openContext('context-stream')\">\n            <draggable\n              v-model=\"playlistEditor.streams\"\n              @start=\"dragStream = true\"\n              @end=\"dragStream = false\"\n              @change=\"streamDragChanged\"\n              animation=\"200\"\n              group=\"streams\"\n              ghost-class=\"ghost\"\n              scroll-sensitivity=\"200\"\n              selected-class=\"selected\"\n              handle=\".handle\"\n              :force-fallback=\"true\"\n              :multi-drag=\"true\"\n            >\n              <transition-group\n                type=\"transition\"\n                :name=\"!dragStream ? 'flip-list' : null\"\n              >\n                <div\n                  class=\"form-control editor-stream\"\n                  :class=\"{\n                    selected: activeStreams.includes(stream.id),\n                    active: activeStream === stream.id,\n                    hidden: stream.stream_is_hidden,\n                    success: stream.sync_is_new,\n                    danger: stream.sync_is_removed,\n                  }\"\n                  v-for=\"(stream, index) in filteredStreams\"\n                  :key=\"`stream-${index}`\"\n                  @click.ctrl=\"toggleStreamSelection(stream.id)\"\n                  @click.shift=\"selectStreamRangeSelection(stream.id)\"\n                  @click.exact=\"selectStreamSelection(stream.id)\"\n                  @dblclick=\"streamDoubleClick\"\n                >\n                  <i class=\"las la-braille handle mr-2\"></i>\n                  <span class=\"mr-2\">{{\n                    stream.movie_name && stream.movie_name.length\n                      ? stream.movie_name\n                      : stream.stream_tvg_name\n                  }}</span>\n                  <span class=\"text-muted\">{{ stream.movie_year }}</span>\n                </div>\n              </transition-group>\n            </draggable>\n          </div>\n        </template>\n        <!-- SERIES -->\n        <template v-if=\"activeGroupType === 3 && !isLoading\">\n          <div @contextmenu.prevent=\"openContext('context-stream')\">\n            <draggable\n              v-model=\"playlistEditor.streams\"\n              @start=\"dragStream = true\"\n              @end=\"dragStream = false\"\n              @change=\"streamDragChanged\"\n              animation=\"200\"\n              group=\"streams\"\n              ghost-class=\"ghost\"\n              scroll-sensitivity=\"200\"\n              selected-class=\"selected\"\n              handle=\".handle\"\n              :force-fallback=\"true\"\n              :multi-drag=\"true\"\n            >\n              <transition-group\n                type=\"transition\"\n                :name=\"!dragStream ? 'flip-list' : null\"\n              >\n                <div\n                  class=\"form-control editor-stream\"\n                  :class=\"{\n                    selected: activeStreams.includes(stream.id),\n                    active: activeStream === stream.id,\n                    hidden: stream.stream_is_hidden,\n                    success: stream.sync_is_new,\n                    danger: stream.sync_is_removed,\n                  }\"\n                  v-for=\"(stream, index) in filteredStreams\"\n                  :key=\"`stream-${index}`\"\n                  @click.ctrl=\"toggleStreamSelection(stream.id)\"\n                  @click.shift=\"selectStreamRangeSelection(stream.id)\"\n                  @click.exact=\"selectStreamSelection(stream.id)\"\n                  @dblclick=\"streamDoubleClick\"\n                >\n                  <i class=\"las la-braille handle mr-2\"></i>\n                  <span class=\"mr-2\">{{\n                    stream.serie_name && stream.serie_name.length\n                      ? stream.serie_name\n                      : stream.stream_tvg_name\n                  }}</span>\n                  <span class=\"text-muted mr-1\">{{\n                    $t(\"editor.season\").format(stream.serie_season)\n                  }}</span>\n                  <span class=\"text-muted\">{{\n                    $t(\"editor.episode\").format(stream.serie_episode)\n                  }}</span>\n                </div>\n              </transition-group>\n            </draggable>\n          </div>\n        </template>\n      </erd-col>\n    </erd-row>\n  </erd-row>\n</template>\n\n<script>\n/* eslint-disable vue/no-side-effects-in-computed-properties */\n/* eslint-disable no-unused-vars */\n/* eslint-disable no-useless-escape */\n\nimport { EventBus } from \"../../../services/ebus\";\nimport { httpService } from \"../../../services/http\";\nimport { mapGetters } from \"vuex\";\nimport draggable from \"vuedraggable\";\nimport { SubscriptionType } from \"../../../constants/config\";\nimport { countries } from \"../../../helpers\";\n\nexport default {\n  components: {\n    draggable,\n  },\n  data() {\n    return {\n      countries,\n      activeTab: 0,\n      activeGroup: -1,\n      activeGroups: [],\n      activeStream: -1,\n      activeStreams: [],\n      dragGroup: false,\n      dragStream: false,\n      editor: false,\n      search: null,\n      isLoading: false,\n      playlistEditor: {\n        id: undefined,\n        playlist: null,\n        groups: [],\n        streams: [],\n        changed: false,\n      },\n      findReplace: {\n        type: 0,\n        modal: false,\n        from: \"\",\n        to: \"\",\n        replaceAll: false,\n        ignoreCase: false,\n        selectedOnly: 0,\n      },\n      prefixSuffix: {\n        type: 0,\n        modal: false,\n        prefix: \"\",\n        suffix: \"\",\n        selectedOnly: 0,\n      },\n      convertCase: {\n        type: 0,\n        modal: false,\n        method: 0,\n        selectedOnly: 0,\n      },\n      groupEditor: {\n        modal: false,\n        id: 0,\n        group_name: \"\",\n        group_parent_code: \"\",\n        group_type: 1,\n        group_is_hidden: 0,\n      },\n      streamEditor: {\n        modal: false,\n        id: -1,\n        stream_tvg_name: \"\",\n        stream_tvg_id: \"\",\n        stream_tvg_logo: \"\",\n        stream_parent_code: \"\",\n        stream_radio: 0,\n        stream_is_hidden: 0,\n        stream_is_custom: 0,\n        movie_name: \"\",\n        movie_year: \"\",\n        serie_name: \"\",\n        serie_season: 0,\n        serie_episode: 0,\n        source_stream_url: \"\",\n      },\n      radioBrowser: {\n        isLoading: false,\n        modal: false,\n        bounce: null,\n        active: [],\n        search: \"\",\n        results: [],\n      },\n      soundcloud: {\n        isLoading: false,\n        modal: false,\n        bounce: null,\n        url: \"\",\n        track: null,\n      },\n      youtube: {\n        isLoading: false,\n        modal: false,\n        bounce: null,\n        url: \"\",\n        videoId: \"\",\n        video: null,\n      },\n      vimeo: {\n        isLoading: false,\n        modal: false,\n        bounce: null,\n        url: \"\",\n        videoId: \"\",\n        video: null,\n      },\n      dailymotion: {\n        isLoading: false,\n        modal: false,\n        bounce: null,\n        url: \"\",\n        videoId: \"\",\n        video: null,\n      },\n      tedTalks: {\n        isLoading: false,\n        modal: false,\n        bounce: null,\n        url: \"\",\n        video: null,\n      },\n      xhamster: {\n        isLoading: false,\n        modal: false,\n        bounce: null,\n        url: \"\",\n        video: null,\n      },\n      findLogo: {\n        isLoading: false,\n        modal: false,\n        countries: [],\n        country: \"\",\n        logos: [],\n        logo: \"\",\n        search: \"\",\n      },\n      assignLogo: {\n        isLoading: false,\n        modal: false,\n        countries: [],\n        country: \"\",\n        logos: [],\n        assignAll: 0,\n      },\n      saveChanges: {\n        modal: false,\n      },\n      groupTypes: [\n        { text: this.$t(\"xtream.live\"), value: 1 },\n        { text: this.$t(\"xtream.movies\"), value: 2 },\n        { text: this.$t(\"xtream.series\"), value: 3 },\n      ],\n    };\n  },\n  computed: {\n    ...mapGetters([\"currentUser\", \"settings\", \"soundcloudClientId\"]),\n    searchFiltered() {\n      if (this.search === null) {\n        return this.accounts;\n      } else {\n        var re = new RegExp(this.search, \"i\");\n        return this.accounts.filter((account) => {\n          return (\n            String(account.title).match(re) ||\n            String(account.host).match(re) ||\n            String(account.port).match(re) ||\n            String(account.username).match(re) ||\n            String(account.password).match(re) ||\n            this.formatDate(account.synced_at).match(re) ||\n            this.$t(`sync-interval.${account.sync_interval}`).match(re)\n          );\n        });\n      }\n    },\n    playlistSelected() {\n      return this.playlistEditor.id !== undefined;\n    },\n    lastSelectedGroup() {\n      return this.activeGroups[this.activeGroups.length - 1];\n    },\n    lastSelectedStream() {\n      return this.activeStreams[this.activeStreams.length - 1];\n    },\n    canEditGroupType() {\n      return (\n        this.groupEditor.id &&\n        this.getGroupWithId(this.groupEditor.id).streams == 0\n      );\n    },\n    subscriptionLimited() {\n      return (\n        this.currentUser.subscription &&\n        this.currentUser.subscription.subscription_type ==\n          SubscriptionType.Enthusiast\n      );\n    },\n    filteredGroups() {\n      if (this.subscriptionLimited) {\n        return this.playlistEditor.groups.filter(\n          (group) =>\n            group.group_is_removed !== 1 &&\n            group.source_group_type == 1 &&\n            group.group_type == 1\n        );\n      }\n      return this.playlistEditor.groups.filter(\n        (group) => group.group_is_removed !== 1\n      );\n    },\n    filteredStreams() {\n      return this.playlistEditor.streams.filter(\n        (group) => group.stream_is_removed !== 1\n      );\n    },\n    activeGroupType() {\n      let index = this.playlistEditor.groups.findIndex(\n        (group) => group.id == this.activeGroup\n      );\n      return index > -1 ? this.playlistEditor.groups[index].group_type : 0;\n    },\n    filteredLogos() {\n      if (!this.findLogo.search.length) {\n        return this.findLogo.logos;\n      }\n      let selectedStream = this.getStreamWithId(this.activeStreams[0]);\n      let re = new RegExp(this.findLogo.search, \"i\");\n      return this.findLogo.logos.filter((logo) => {\n        return logo.text.match(re);\n      });\n    },\n    groupContextMenu() {\n      let vm = this;\n      return [\n        {\n          icon: \"la-plus\",\n          text: vm.$t(\"editor.add-group\"),\n          onClick: vm.addGroup,\n        },\n        {\n          disabled: vm.activeGroups.length !== 1,\n          icon: \"la-edit\",\n          text: vm.$t(\"editor.edit-group\"),\n          onClick: function () {\n            if (vm.activeGroups.length === 1) {\n              vm.editGroupModal(true);\n            }\n          },\n        },\n        {\n          divider: true,\n        },\n        {\n          text: vm.$t(\"general.select-all\"),\n          onClick: function () {\n            vm.activeGroups = [...vm.playlistEditor.groups.map((g) => g.id)];\n          },\n        },\n        {\n          text: vm.$t(\"general.select-none\"),\n          onClick: function () {\n            vm.activeGroups = [];\n          },\n        },\n        {\n          divider: true,\n        },\n        {\n          icon: \"la-search\",\n          text: vm.$t(\"editor.find-replace\"),\n          onClick: function () {\n            vm.findAndReplaceModal(true, 1);\n          },\n        },\n        {\n          icon: \"la-pen\",\n          text: vm.$t(\"editor.add-prefix-suffix\"),\n          onClick: function () {\n            vm.prefixSuffixModal(true, 1);\n          },\n        },\n        {\n          icon: \"la-font\",\n          text: vm.$t(\"editor.change-case\"),\n          onClick: function () {\n            vm.convertCaseModal(true, 1);\n          },\n        },\n        {\n          divider: true,\n        },\n        {\n          disabled: vm.activeGroups.length === 0,\n          icon: \"la-eye\",\n          text: vm.$t(\"editor.toggle-visibility\"),\n          onClick: function () {\n            if (vm.activeGroups.length) {\n              vm.toggleGroupVisibility();\n            }\n          },\n        },\n        {\n          disabled: vm.activeGroups.length === 0,\n          icon: \"la-trash\",\n          text: vm.$t(\"editor.delete\"),\n          onClick: function () {\n            if (vm.activeGroups.length) {\n              vm.deleteSelectedGroups();\n            }\n          },\n        },\n      ];\n    },\n    streamContextMenu() {\n      let vm = this;\n      return [\n        {\n          icon: \"la-plus\",\n          text: vm.$t(\"editor.add-stream\"),\n          onClick: vm.addStream,\n        },\n        {\n          disabled: vm.activeStreams.length !== 1,\n          icon: \"la-edit\",\n          text: vm.$t(\"editor.edit-stream\"),\n          onClick: function () {\n            if (vm.activeStreams.length === 1) {\n              vm.editStreamModal(true);\n            }\n          },\n        },\n        {\n          divider: true,\n        },\n        {\n          text: vm.$t(\"general.select-all\"),\n          onClick: function () {\n            vm.activeStreams = [...vm.playlistEditor.streams.map((g) => g.id)];\n          },\n        },\n        {\n          text: vm.$t(\"general.select-none\"),\n          onClick: function () {\n            vm.activeStreams = [];\n          },\n        },\n        {\n          divider: true,\n        },\n        {\n          disabled:\n            vm.activeGroups.length !== 1 ||\n            vm.activeStreams.length === 0 ||\n            vm.getGroupWithId(vm.activeGroups[0]).group_type !==\n              vm.activeGroupType ||\n            vm.activeGroups[0] === vm.activeGroup,\n          icon: \"la-chevron-left\",\n          text: vm.$t(\"editor.move-to-selected-group\"),\n          onClick: function () {\n            vm.moveToSelectedGroup();\n          },\n        },\n        {\n          divider: true,\n        },\n        {\n          icon: \"la-search\",\n          text: vm.$t(\"editor.find-replace\"),\n          onClick: function () {\n            vm.findAndReplaceModal(true, 2);\n          },\n        },\n        {\n          icon: \"la-pen\",\n          text: vm.$t(\"editor.add-prefix-suffix\"),\n          onClick: function () {\n            vm.prefixSuffixModal(true, 2);\n          },\n        },\n        {\n          icon: \"la-font\",\n          text: vm.$t(\"editor.change-case\"),\n          onClick: function () {\n            vm.convertCaseModal(true, 2);\n          },\n        },\n        {\n          disabled: vm.activeStreams.length !== 1 || vm.activeGroupType !== 1,\n          icon: \"la-photo-video\",\n          text: vm.$t(\"editor.find-logo\"),\n          onClick: function () {\n            vm.findLogoModal(true);\n          },\n        },\n        {\n          divider: true,\n        },\n        {\n          disabled: vm.activeStreams.length === 0 || vm.activeGroupType !== 1,\n          icon: \"la-music\",\n          text: vm.$t(\"editor.toggle-radio\"),\n          onClick: function () {\n            if (vm.activeStreams.length && vm.activeGroupType == 1) {\n              vm.toggleStreamRadio();\n            }\n          },\n        },\n        {\n          disabled: vm.activeStreams.length === 0,\n          icon: \"la-eye\",\n          text: vm.$t(\"editor.toggle-visibility\"),\n          onClick: function () {\n            if (vm.activeStreams.length) {\n              vm.toggleStreamVisibility();\n            }\n          },\n        },\n        {\n          divider: true,\n        },\n        {\n          disabled: vm.activeStreams.length === 0,\n          icon: \"la-trash\",\n          text: vm.$t(\"editor.delete\"),\n          onClick: function () {\n            if (vm.activeStreams.length) {\n              vm.deleteSelectedStreams();\n            }\n          },\n        },\n      ];\n    },\n  },\n  methods: {\n    groupDragChanged(g) {\n      for (let i = 0; i < this.playlistEditor.groups.length; i++) {\n        if (this.playlistEditor.groups[i].group_order != i + 1) {\n          this.playlistEditor.groups[i].group_order = i + 1;\n          this.playlistEditor.groups[i].modified = true;\n        }\n      }\n    },\n    streamDragChanged(g) {\n      for (let i = 0; i < this.playlistEditor.streams.length; i++) {\n        if (this.playlistEditor.streams[i].stream_order != i + 1) {\n          this.playlistEditor.streams[i].stream_order = i + 1;\n          this.playlistEditor.streams[i].modified = true;\n        }\n      }\n    },\n    openContext(context) {\n      this.$refs[context].open();\n    },\n    searchEditor(search) {\n      if (search.length === 0) {\n        this.search = null;\n      } else {\n        this.search = search;\n      }\n    },\n    printEditor() {\n      document.getElementById(\"editor\").print();\n    },\n    formatNumber(number) {\n      return new Intl.NumberFormat(this.$t(\"date.locale\")).format(number);\n    },\n    formatDate(date) {\n      return new Date(date).toLocaleString(\n        this.$t(\"date.locale\"),\n        this.dateOptions\n      );\n    },\n    formatDateYoutube(date) {\n      return new Date(date).toLocaleDateString(this.$t(\"date.locale\"), {\n        year: \"numeric\",\n        month: \"short\",\n        day: \"numeric\",\n      });\n    },\n    formatSeconds(sec) {\n      var d = Number(sec);\n      var h = Math.floor(d / 3600);\n      var m = Math.floor((d % 3600) / 60);\n      var s = Math.floor((d % 3600) % 60);\n\n      var hour = this.$t(\"general.hour\");\n      var hours = this.$t(\"general.hours\");\n      var minute = this.$t(\"general.minute\");\n      var minutes = this.$t(\"general.minutes\");\n      var second = this.$t(\"general.second\");\n      var seconds = this.$t(\"general.seconds\");\n\n      var hDisplay = h > 0 ? h + (h == 1 ? ` ${hour} ` : ` ${hours} `) : \"\";\n      var mDisplay = m > 0 ? m + (m == 1 ? ` ${minute} ` : ` ${minutes} `) : \"\";\n      var sDisplay = s > 0 ? s + (s == 1 ? ` ${second} ` : ` ${seconds} `) : \"\";\n      return hDisplay + mDisplay + sDisplay;\n    },\n\n    getGroupWithId(id) {\n      let index = this.playlistEditor.groups.findIndex(\n        (group) => group.id == id\n      );\n      return this.playlistEditor.groups[index];\n    },\n    getStreamWithId(id) {\n      let index = this.playlistEditor.streams.findIndex(\n        (stream) => stream.id == id\n      );\n      return this.playlistEditor.streams[index];\n    },\n    doSave() {\n      this.isLoading = true;\n      this.playlistEditor.changed = false;\n      return new Promise((resolve) => {\n        let index = this.playlistEditor.groups.findIndex((group) => {\n          return group.id == this.activeGroup;\n        });\n        let updateGroups = this.playlistEditor.groups\n          .filter((group) => !group.group_is_removed && group.modified)\n          .map((group) => {\n            return {\n              id: group.id,\n              group_name: group.group_name,\n              group_order: group.group_order,\n              group_type: group.group_type,\n              group_parent_code: group.group_parent_code,\n              group_is_hidden: group.group_is_hidden,\n            };\n          });\n        let deleteGroups = this.playlistEditor.groups\n          .filter((group) => group.group_is_removed && group.modified)\n          .map((group) => group.id)\n          .join();\n\n        let updateStreams;\n        switch (this.activeGroupType) {\n          // Live streams\n          case 1:\n            updateStreams = this.playlistEditor.streams\n              .filter(\n                (stream) => stream.stream_is_removed !== 1 && stream.modified\n              )\n              .map((stream) => {\n                return {\n                  id: stream.id,\n                  stream_tvg_name: stream.stream_tvg_name,\n                  stream_tvg_id: stream.stream_tvg_id,\n                  stream_tvg_logo: stream.stream_tvg_logo,\n                  stream_parent_code: stream.stream_parent_code,\n                  stream_radio: stream.stream_radio,\n                  stream_is_hidden: stream.stream_is_hidden,\n                  stream_order: stream.stream_order,\n                };\n              });\n            break;\n          // Movies\n          case 2:\n            updateStreams = this.playlistEditor.streams\n              .filter(\n                (stream) => stream.stream_is_removed !== 1 && stream.modified\n              )\n              .map((stream) => {\n                return {\n                  id: stream.id,\n                  movie_name: stream.movie_name,\n                  movie_year: stream.movie_year,\n                  tmdb_id: stream.tmdb_id,\n                  stream_tvg_logo: stream.stream_tvg_logo,\n                  stream_is_hidden: stream.stream_is_hidden,\n                  stream_order: stream.stream_order,\n                };\n              });\n            break;\n          // Series\n          case 3:\n            updateStreams = this.playlistEditor.streams\n              .filter(\n                (stream) => stream.stream_is_removed !== 1 && stream.modified\n              )\n              .map((stream) => {\n                return {\n                  id: stream.id,\n                  serie_name: stream.serie_name,\n                  serie_season: stream.serie_season,\n                  serie_episode: stream.serie_episode,\n                  tmdb_id: stream.tmdb_id,\n                  stream_tvg_logo: stream.stream_tvg_logo,\n                  stream_is_hidden: stream.stream_is_hidden,\n                  stream_order: stream.stream_order,\n                };\n              });\n            break;\n        }\n        let deleteStreams = this.playlistEditor.streams\n          .filter((stream) => stream.stream_is_removed === 1 && stream.modified)\n          .map((stream) => stream.id)\n          .join();\n\n        let requests = [];\n        if (updateGroups.length) {\n          requests.push(\n            httpService.post(\"editor/update-groups\", {\n              playlist_id: this.playlistEditor.id,\n              groups: updateGroups,\n            })\n          );\n        }\n        if (deleteGroups.length) {\n          index = 0;\n          requests.push(\n            httpService.post(\"editor/delete-groups\", {\n              playlist_id: this.playlistEditor.id,\n              groups: deleteGroups,\n            })\n          );\n        }\n        if (updateStreams.length) {\n          requests.push(\n            httpService.post(`editor/update-streams/${this.activeGroupType}`, {\n              playlist_id: this.playlistEditor.id,\n              streams: updateStreams,\n            })\n          );\n        }\n        if (deleteStreams.length) {\n          requests.push(\n            httpService.post(`editor/delete-streams/${this.activeGroupType}`, {\n              playlist_id: this.playlistEditor.id,\n              streams: deleteStreams,\n            })\n          );\n        }\n        Promise.all(requests).then((res) => {\n          this.loadPlaylist(this.playlistEditor.id, index);\n          resolve(res);\n        });\n      });\n    },\n    doCancel() {\n      this.isLoading = true;\n      Promise.all([this.restoreGroups(), this.restoreStreams()]).then(() => {\n        this.playlistEditor.changed = false;\n        this.isLoading = false;\n      });\n    },\n    doTabChange(tab) {\n      this.activeTab = tab;\n    },\n    updateGroupOrder(source) {\n      return new Promise((resolve) => {\n        let groups = [...source];\n        for (let i = 0; i < groups.length; i++) {\n          groups[i].source_group_order = i + 1;\n          groups[i].group_order = i + 1;\n        }\n        resolve(groups);\n      });\n    },\n    updateStreamOrder(source) {\n      return new Promise((resolve) => {\n        let streams = [...source];\n        for (let i = 0; i < streams.length; i++) {\n          streams[i].source_stream_order = i + 1;\n          streams[i].stream_order = i + 1;\n        }\n        resolve(streams);\n      });\n    },\n    restoreGroupOrder() {\n      return new Promise((resolve) => {\n        this.playlistEditor.groups.sort((a, b) =>\n          a.source_group_order > b.source_group_order\n            ? 1\n            : b.source_group_order > a.source_group_order\n            ? -1\n            : 0\n        );\n        resolve();\n      });\n    },\n    restoreStreamOrder() {\n      return new Promise((resolve) => {\n        this.playlistEditor.streams.sort((a, b) =>\n          a.source_stream_order > b.source_stream_order\n            ? 1\n            : b.source_stream_order > a.source_stream_order\n            ? -1\n            : 0\n        );\n        resolve();\n      });\n    },\n    restoreGroups() {\n      return new Promise((resolve) => {\n        this.restoreGroupOrder().then(() => {\n          let group;\n          for (let i = 0; i < this.playlistEditor.groups.length; i++) {\n            group = this.playlistEditor.groups[i];\n            group.modified = false;\n            group.group_is_removed = 0;\n            group.group_type = group.source_group_type;\n            group.group_name = group.source_group_name;\n            group.parent_code = group.source_group_parent_code;\n            group.group_is_hidden = group.source_group_is_hidden;\n          }\n          resolve();\n        });\n      });\n    },\n    restoreStreams() {\n      return new Promise((resolve) => {\n        this.restoreStreamOrder().then(() => {\n          let stream;\n          for (let i = 0; i < this.playlistEditor.streams.length; i++) {\n            stream = this.playlistEditor.streams[i];\n            stream.modified = false;\n            stream.stream_is_removed = 0;\n            stream.stream_tvg_name = stream.source_stream_tvg_name;\n            stream.stream_tvg_id = stream.source_stream_tvg_id;\n            stream.stream_tvg_logo = stream.source_stream_tvg_logo;\n            stream.stream_tvg_chno = stream.source_stream_tvg_chno;\n            stream.stream_tvg_shift = stream.source_stream_tvg_shift;\n            stream.stream_parent_code = stream.source_stream_parent_code;\n            stream.stream_audio_track = stream.source_stream_audio_track;\n            stream.stream_aspect_ratio = stream.source_stream_aspect_ratio;\n            stream.stream_radio = stream.source_stream_radio;\n            stream.stream_order = stream.source_stream_order;\n            stream.stream_is_hidden = stream.source_stream_is_hidden;\n            if (\n              stream.movie_name !== undefined &&\n              stream.movie_year !== undefined\n            ) {\n              stream.movie_name = stream.source_movie_name;\n              stream.movie_year = stream.source_movie_year;\n            }\n            if (\n              stream.serie_name !== undefined &&\n              stream.serie_season !== undefined &&\n              stream.serie_episode !== undefined\n            ) {\n              stream.serie_name = stream.source_serie_name;\n              stream.serie_season = stream.source_serie_season;\n              stream.serie_episode = stream.source_serie_episode;\n            }\n          }\n          resolve();\n        });\n      });\n    },\n    toggleGroupVisibility() {\n      for (let i = 0; i < this.playlistEditor.groups.length; i++) {\n        if (this.activeGroups.includes(this.playlistEditor.groups[i].id)) {\n          this.playlistEditor.groups[i].group_is_hidden =\n            !this.playlistEditor.groups[i].group_is_hidden;\n          this.playlistEditor.groups[i].modified = true;\n        }\n      }\n      this.playlistEditor.changed = true;\n    },\n    toggleStreamVisibility() {\n      for (let i = 0; i < this.playlistEditor.streams.length; i++) {\n        if (this.activeStreams.includes(this.playlistEditor.streams[i].id)) {\n          this.playlistEditor.streams[i].stream_is_hidden =\n            !this.playlistEditor.streams[i].stream_is_hidden;\n          this.playlistEditor.streams[i].modified = true;\n        }\n      }\n      this.playlistEditor.changed = true;\n    },\n    toggleStreamRadio() {\n      for (let i = 0; i < this.playlistEditor.streams.length; i++) {\n        if (this.activeStreams.includes(this.playlistEditor.streams[i].id)) {\n          if (this.playlistEditor.streams[i].stream_radio == 0) {\n            this.playlistEditor.streams[i].stream_radio = 1;\n          } else {\n            this.playlistEditor.streams[i].stream_radio = 0;\n          }\n          this.playlistEditor.streams[i].modified = true;\n        }\n      }\n      this.playlistEditor.changed = true;\n    },\n    deleteSelectedGroups() {\n      for (let i = 0; i < this.playlistEditor.groups.length; i++) {\n        if (this.activeGroups.includes(this.playlistEditor.groups[i].id)) {\n          this.playlistEditor.groups[i].group_is_removed = 1;\n          this.playlistEditor.groups[i].modified = true;\n        }\n      }\n      this.playlistEditor.changed = true;\n    },\n    deleteSelectedStreams() {\n      for (let i = 0; i < this.playlistEditor.streams.length; i++) {\n        if (this.activeStreams.includes(this.playlistEditor.streams[i].id)) {\n          this.playlistEditor.streams[i].stream_is_removed = 1;\n          this.playlistEditor.streams[i].modified = true;\n        }\n      }\n      this.playlistEditor.changed = true;\n    },\n    loadPlaylist(val, group_index = undefined) {\n      this.isLoading = true;\n      if (this.playlistEditor.changed) {\n        this.doSave();\n      }\n      this.playlistEditor.id = val;\n      httpService\n        .get(`editor/groups/${val}`)\n        .then((res) => {\n          if (res.status === true) {\n            this.updateGroupOrder(res.data).then((groups) => {\n              this.playlistEditor.groups = groups.map((group) => {\n                const grp = Object.assign({}, group);\n                grp.source_group_parent_code = group.group_parent_code;\n                grp.source_group_is_hidden = group.group_is_hidden;\n                grp.source_group_name = group.group_name;\n                grp.source_group_type = group.group_type;\n                grp.group_is_removed = false;\n                grp.modified = false;\n                return grp;\n              });\n              if (groups.length) {\n                if (group_index === undefined) {\n                  this.activeGroup = this.playlistEditor.groups[0].id;\n                } else {\n                  this.activeGroup = this.playlistEditor.groups[group_index].id;\n                  this.loadStreams();\n                }\n              }\n            });\n          }\n          this.isLoading = false;\n        })\n        .catch(() => {\n          this.isLoading = false;\n        });\n    },\n    toggleGroupSelection(item) {\n      let idx = this.activeGroups.indexOf(item);\n      if (idx !== -1) {\n        this.activeGroups.splice(idx, 1);\n      } else {\n        this.activeGroups.push(item);\n      }\n    },\n    toggleStreamSelection(item) {\n      let idx = this.activeStreams.indexOf(item);\n      if (idx !== -1) {\n        this.activeStreams.splice(idx, 1);\n      } else {\n        this.activeStreams.push(item);\n      }\n    },\n    toggleRadiobrowserSelection(item) {\n      let idx = this.radioBrowser.active.indexOf(item);\n      if (idx !== -1) {\n        this.radioBrowser.active.splice(idx, 1);\n      } else {\n        this.radioBrowser.active.push(item);\n      }\n    },\n    indexOfGroup(group) {\n      return this.playlistEditor.groups.map((g) => g.id).indexOf(group);\n    },\n    selectGroupRangeSelection(item) {\n      const lastIndex = this.indexOfGroup(this.lastSelectedGroup);\n      const itemIndex = this.indexOfGroup(item);\n      const dir = itemIndex > lastIndex ? 1 : -1;\n      for (let i = lastIndex; i != itemIndex + dir; i += dir) {\n        if (!this.activeGroups.includes(this.playlistEditor.groups[i].id)) {\n          this.activeGroups.push(this.playlistEditor.groups[i].id);\n        }\n      }\n    },\n    indexOfStream(stream) {\n      return this.playlistEditor.streams.map((g) => g.id).indexOf(stream);\n    },\n    selectStreamRangeSelection(item) {\n      const lastIndex = this.indexOfStream(this.lastSelectedStream);\n      const itemIndex = this.indexOfStream(item);\n      const dir = itemIndex > lastIndex ? 1 : -1;\n      for (let i = lastIndex; i != itemIndex + dir; i += dir) {\n        if (!this.activeStreams.includes(this.playlistEditor.streams[i].id)) {\n          this.activeStreams.push(this.playlistEditor.streams[i].id);\n        }\n      }\n    },\n    selectRadiobrowserRangeSelection(index) {\n      const lastIndex =\n        this.radioBrowser.active[this.radioBrowser.active.length - 1];\n      const dir = index > lastIndex ? 1 : -1;\n      for (let i = lastIndex; i != index + dir; i += dir) {\n        if (!this.radioBrowser.active.includes(i)) {\n          this.radioBrowser.active.push(i);\n        }\n      }\n    },\n    selectGroupSelection(item) {\n      this.activeGroups.length = 0;\n      this.activeGroups.push(item);\n    },\n    selectStreamSelection(item) {\n      this.activeStreams.length = 0;\n      this.activeStreams.push(item);\n    },\n    selectRadiobrowserSelection(item) {\n      this.radioBrowser.active.length = 0;\n      this.radioBrowser.active.push(item);\n    },\n    findAndReplaceModal(show, type = 1) {\n      this.findReplace.type = type;\n      this.findReplace.modal = show;\n    },\n    findAndReplace() {\n      let options = \"\";\n      if (this.findReplace.replaceAll) {\n        options += \"g\";\n      }\n      if (this.findReplace.ignoreCase) {\n        options += \"i\";\n      }\n      let re = new RegExp(this.findReplace.from.replace(\"|\", \"\\\\|\"), options);\n      switch (parseInt(this.findReplace.type)) {\n        // Group\n        case 1:\n          if (parseInt(this.findReplace.selectedOnly) === 1) {\n            for (let i = 0; i < this.playlistEditor.groups.length; i++) {\n              if (\n                this.activeGroups.includes(this.playlistEditor.groups[i].id)\n              ) {\n                this.playlistEditor.groups[i].modified = true;\n                this.playlistEditor.groups[i].group_name =\n                  this.playlistEditor.groups[i].group_name.replace(\n                    re,\n                    this.findReplace.to\n                  );\n              }\n            }\n          } else {\n            this.filteredGroups.map((group) => {\n              group.modified = true;\n              group.group_name = group.group_name.replace(\n                re,\n                this.findReplace.to\n              );\n            });\n          }\n          break;\n\n        // Streams\n        case 2:\n          if (parseInt(this.findReplace.selectedOnly) === 1) {\n            for (let i = 0; i < this.playlistEditor.streams.length; i++) {\n              if (\n                this.activeStreams.includes(this.playlistEditor.streams[i].id)\n              ) {\n                if (this.activeGroupType === 1) {\n                  this.playlistEditor.streams[i].modified = true;\n                  this.playlistEditor.streams[i].stream_tvg_name =\n                    this.playlistEditor.streams[i].stream_tvg_name.replace(\n                      re,\n                      this.findReplace.to\n                    );\n                }\n                if (this.activeGroupType === 2) {\n                  this.playlistEditor.streams[i].modified = true;\n                  this.playlistEditor.streams[i].movie_name =\n                    this.playlistEditor.streams[i].movie_name.replace(\n                      re,\n                      this.findReplace.to\n                    );\n                }\n                if (this.activeGroupType === 3) {\n                  this.playlistEditor.streams[i].modified = true;\n                  this.playlistEditor.streams[i].serie_name =\n                    this.playlistEditor.streams[i].serie_name.replace(\n                      re,\n                      this.findReplace.to\n                    );\n                }\n              }\n            }\n          } else {\n            this.filteredStreams.map((stream) => {\n              if (this.activeGroupType === 1) {\n                stream.modified = true;\n                stream.stream_tvg_name = stream.stream_tvg_name.replace(\n                  re,\n                  this.findReplace.to\n                );\n              }\n              if (this.activeGroupType === 2) {\n                stream.modified = true;\n                stream.movie_name = stream.movie_name.replace(\n                  re,\n                  this.findReplace.to\n                );\n              }\n              if (this.activeGroupType === 3) {\n                stream.modified = true;\n                stream.serie_name = stream.serie_name.replace(\n                  re,\n                  this.findReplace.to\n                );\n              }\n            });\n          }\n          break;\n      }\n      this.playlistEditor.changed = true;\n      this.findReplace.modal = false;\n    },\n    prefixSuffixModal(show, type = 1) {\n      this.prefixSuffix.type = type;\n      this.prefixSuffix.modal = show;\n    },\n    addPrefixSuffix() {\n      let prefix = this.prefixSuffix.prefix;\n      let suffix = this.prefixSuffix.suffix;\n      switch (parseInt(this.prefixSuffix.type)) {\n        // Group\n        case 1:\n          if (parseInt(this.prefixSuffix.selectedOnly) === 1) {\n            for (let i = 0; i < this.playlistEditor.groups.length; i++) {\n              if (\n                this.activeGroups.includes(this.playlistEditor.groups[i].id)\n              ) {\n                this.playlistEditor.groups[i].modified = true;\n                this.playlistEditor.groups[i].group_name =\n                  prefix + this.playlistEditor.groups[i].group_name + suffix;\n              }\n            }\n          } else {\n            this.filteredGroups.map((group) => {\n              group.modified = true;\n              group.group_name = prefix + group.group_name + suffix;\n            });\n          }\n          break;\n\n        // Stream\n        case 2:\n          if (parseInt(this.prefixSuffix.selectedOnly) === 1) {\n            for (let i = 0; i < this.playlistEditor.streams.length; i++) {\n              if (\n                this.activeStreams.includes(this.playlistEditor.streams[i].id)\n              ) {\n                if (this.activeGroupType === 1) {\n                  this.playlistEditor.streams[i].modified = true;\n                  this.playlistEditor.streams[i].stream_tvg_name =\n                    prefix +\n                    this.playlistEditor.streams[i].stream_tvg_name +\n                    suffix;\n                }\n                if (this.activeGroupType === 2) {\n                  this.playlistEditor.streams[i].modified = true;\n                  this.playlistEditor.streams[i].movie_name =\n                    prefix + this.playlistEditor.streams[i].movie_name + suffix;\n                }\n                if (this.activeGroupType === 3) {\n                  this.playlistEditor.streams[i].modified = true;\n                  this.playlistEditor.streams[i].serie_name =\n                    prefix + this.playlistEditor.streams[i].serie_name + suffix;\n                }\n              }\n            }\n          } else {\n            if (this.activeGroupType === 1) {\n              this.filteredStreams.map((stream) => {\n                stream.modified = true;\n                stream.stream_tvg_name =\n                  prefix + stream.stream_tvg_name + suffix;\n              });\n            }\n            if (this.activeGroupType === 2) {\n              this.filteredStreams.map((stream) => {\n                stream.modified = true;\n                stream.movie_name = prefix + stream.movie_name + suffix;\n              });\n            }\n            if (this.activeGroupType === 3) {\n              this.filteredStreams.map((stream) => {\n                stream.modified = true;\n                stream.serie_name = prefix + stream.serie_name + suffix;\n              });\n            }\n          }\n          break;\n      }\n      this.playlistEditor.changed = true;\n      this.prefixSuffix.modal = false;\n    },\n    convertCaseModal(show, type) {\n      this.convertCase.type = type;\n      this.convertCase.modal = show;\n    },\n    changeCase() {\n      let method = this.convertCase.method;\n      let groups;\n      let streams;\n      if (parseInt(this.convertCase.selectedOnly) === 1) {\n        groups = this.filteredGroups.filter((group) => {\n          return this.activeGroups.includes(group.id);\n        });\n        streams = this.filteredStreams.filter((stream) => {\n          return this.activeStreams.includes(stream.id);\n        });\n      } else {\n        groups = this.filteredGroups;\n        streams = this.filteredStreams;\n      }\n      switch (parseInt(this.convertCase.type)) {\n        // Categories\n        case 1:\n          groups.map((group) => {\n            switch (parseInt(method)) {\n              case 0:\n                group.modified = true;\n                group.group_name = group.group_name.titleCase();\n                break;\n              case 1:\n                group.modified = true;\n                group.group_name = group.group_name.toUpperCase();\n                break;\n              case 2:\n                group.modified = true;\n                group.group_name = group.group_name.toLowerCase();\n                break;\n            }\n          });\n          break;\n\n        // Streams\n        case 2:\n          streams.map((stream) => {\n            switch (parseInt(method)) {\n              case 0:\n                if (this.activeGroupType === 1) {\n                  stream.modified = true;\n                  stream.stream_tvg_name = stream.stream_tvg_name.titleCase();\n                }\n                if (this.activeGroupType === 2) {\n                  stream.modified = true;\n                  stream.movie_name = stream.movie_name.titleCase();\n                }\n                if (this.activeGroupType === 3) {\n                  stream.modified = true;\n                  stream.serie_name = stream.serie_name.titleCase();\n                }\n                break;\n              case 1:\n                if (this.activeGroupType === 1) {\n                  stream.modified = true;\n                  stream.stream_tvg_name = stream.stream_tvg_name.toUpperCase();\n                }\n                if (this.activeGroupType === 2) {\n                  stream.modified = true;\n                  stream.movie_name = stream.movie_name.toUpperCase();\n                }\n                if (this.activeGroupType === 3) {\n                  stream.modified = true;\n                  stream.serie_name = stream.serie_name.toUpperCase();\n                }\n                break;\n              case 2:\n                if (this.activeGroupType === 1) {\n                  stream.modified = true;\n                  stream.stream_tvg_name = stream.stream_tvg_name.toLowerCase();\n                }\n                if (this.activeGroupType === 2) {\n                  stream.modified = true;\n                  stream.movie_name = stream.movie_name.toLowerCase();\n                }\n                if (this.activeGroupType === 3) {\n                  stream.modified = true;\n                  stream.serie_name = stream.serie_name.toLowerCase();\n                }\n                break;\n            }\n          });\n          break;\n      }\n      this.playlistEditor.changed = true;\n      this.convertCase.modal = false;\n    },\n    editGroupModal(show) {\n      let index = this.playlistEditor.groups.findIndex(\n        (group) => group.id === this.activeGroups[0]\n      );\n      let group = this.playlistEditor.groups[index];\n      if (group) {\n        this.groupEditor.id = this.activeGroups[0];\n        this.groupEditor.group_type = group.group_type;\n        this.groupEditor.group_name = group.group_name;\n        this.groupEditor.group_is_hidden = group.group_is_hidden;\n        this.groupEditor.group_parent_code = group.group_parent_code;\n        this.groupEditor.modal = show;\n      }\n    },\n    editStreamModal(show) {\n      let index = this.playlistEditor.streams.findIndex(\n        (stream) => stream.id === this.activeStreams[0]\n      );\n      let stream = this.playlistEditor.streams[index];\n      if (stream) {\n        this.streamEditor.id = this.activeStreams[0];\n        this.streamEditor.stream_tvg_name = stream.stream_tvg_name;\n        this.streamEditor.stream_tvg_id = stream.stream_tvg_id;\n        this.streamEditor.stream_tvg_logo = stream.stream_tvg_logo;\n        this.streamEditor.stream_parent_code = stream.stream_parent_code;\n        this.streamEditor.stream_radio = stream.stream_radio;\n        this.streamEditor.stream_is_hidden = stream.stream_is_hidden;\n        this.streamEditor.source_stream_url = stream.source_stream_url;\n        this.streamEditor.stream_is_custom = stream.stream_is_custom;\n        if (\n          stream.movie_name !== undefined &&\n          stream.movie_year !== undefined &&\n          stream.tmdb_id !== undefined\n        ) {\n          this.streamEditor.movie_name = stream.movie_name;\n          this.streamEditor.movie_year = stream.movie_year;\n          this.streamEditor.tmdb_id = stream.tmdb_id;\n        }\n        if (\n          stream.serie_name !== undefined &&\n          stream.serie_season !== undefined &&\n          stream.serie_episode !== undefined\n        ) {\n          this.streamEditor.serie_name = stream.serie_name;\n          this.streamEditor.serie_season = stream.serie_season;\n          this.streamEditor.serie_episode = stream.serie_episode;\n        }\n        this.streamEditor.modal = show;\n      }\n    },\n    editGroup() {\n      let index = this.playlistEditor.groups.findIndex(\n        (group) => group.id === this.groupEditor.id\n      );\n      this.playlistEditor.groups[index].group_type =\n        this.groupEditor.group_type;\n      this.playlistEditor.groups[index].group_name =\n        this.groupEditor.group_name;\n      this.playlistEditor.groups[index].group_is_hidden =\n        this.groupEditor.group_is_hidden;\n      this.playlistEditor.groups[index].group_parent_code =\n        this.groupEditor.group_parent_code;\n      this.playlistEditor.groups[index].modified = true;\n      this.playlistEditor.changed = true;\n      this.groupEditor.modal = false;\n    },\n    editStream() {\n      let index = this.playlistEditor.streams.findIndex(\n        (stream) => stream.id === this.activeStreams[0]\n      );\n      this.playlistEditor.streams[index].stream_tvg_name =\n        this.streamEditor.stream_tvg_name;\n      this.playlistEditor.streams[index].stream_tvg_id =\n        this.streamEditor.stream_tvg_id;\n      this.playlistEditor.streams[index].stream_tvg_logo =\n        this.streamEditor.stream_tvg_logo;\n      this.playlistEditor.streams[index].stream_parent_code =\n        this.streamEditor.stream_parent_code;\n      this.playlistEditor.streams[index].stream_is_hidden =\n        this.streamEditor.stream_is_hidden;\n      this.playlistEditor.streams[index].stream_radio =\n        this.streamEditor.stream_radio;\n      this.playlistEditor.streams[index].source_stream_url =\n        this.streamEditor.source_stream_url;\n      if (\n        this.playlistEditor.streams[index].movie_name !== undefined &&\n        this.playlistEditor.streams[index].movie_year !== undefined &&\n        this.playlistEditor.streams[index].tmdb_id !== undefined\n      ) {\n        this.playlistEditor.streams[index].movie_name =\n          this.streamEditor.movie_name;\n        this.playlistEditor.streams[index].movie_year =\n          this.streamEditor.movie_year;\n        this.playlistEditor.streams[index].tmdb_id = this.streamEditor.tmdb_id;\n      }\n      if (\n        this.playlistEditor.streams[index].serie_name !== undefined &&\n        this.playlistEditor.streams[index].serie_season !== undefined &&\n        this.playlistEditor.streams[index].serie_episode !== undefined\n      ) {\n        this.playlistEditor.streams[index].serie_name =\n          this.streamEditor.serie_name;\n        this.playlistEditor.streams[index].serie_season =\n          this.streamEditor.serie_season;\n        this.playlistEditor.streams[index].serie_episode =\n          this.streamEditor.serie_episode;\n      }\n      this.playlistEditor.streams[index].modified = true;\n      this.playlistEditor.changed = true;\n      this.streamEditor.modal = false;\n    },\n    sortGroupAlphaUp() {\n      this.playlistEditor.groups = this.playlistEditor.groups.sort((a, b) =>\n        b.group_name > a.group_name ? 1 : a.group_name > b.group_name ? -1 : 0\n      );\n      this.playlistEditor.groups.map((group) => (group.modified = true));\n      this.playlistEditor.changed = true;\n    },\n    sortGroupAlphaDown() {\n      this.playlistEditor.groups = this.playlistEditor.groups.sort((a, b) =>\n        a.group_name > b.group_name ? 1 : b.group_name > a.group_name ? -1 : 0\n      );\n      this.playlistEditor.groups.map((group) => (group.modified = true));\n      this.playlistEditor.changed = true;\n    },\n    sortGroupTypeUp() {\n      this.playlistEditor.groups = this.playlistEditor.groups.sort((a, b) =>\n        b.group_type > a.group_type ? 1 : a.group_type > b.group_type ? -1 : 0\n      );\n      this.playlistEditor.groups.map((group) => (group.modified = true));\n      this.playlistEditor.changed = true;\n    },\n    sortGroupTypeDown() {\n      this.playlistEditor.groups = this.playlistEditor.groups.sort((a, b) =>\n        a.group_type > b.group_type ? 1 : b.group_type > a.group_type ? -1 : 0\n      );\n      this.playlistEditor.groups.map((group) => (group.modified = true));\n      this.playlistEditor.changed = true;\n    },\n    sortStreamAlphaUp() {\n      //ERNST HIER\n      this.playlistEditor.streams = this.playlistEditor.streams.sort((a, b) => {\n        switch (this.activeGroupType) {\n          case 1:\n            return b.stream_tvg_name > a.stream_tvg_name\n              ? 1\n              : a.stream_tvg_name > b.stream_tvg_name\n              ? -1\n              : 0;\n          case 2:\n            return b.movie_name > a.movie_name\n              ? 1\n              : a.movie_name > b.movie_name\n              ? -1\n              : 0;\n          case 3:\n            return b.serie_name > a.serie_name\n              ? 1\n              : a.serie_name > b.serie_name\n              ? -1\n              : 0;\n        }\n      });\n      this.playlistEditor.streams.map((stream) => (stream.modified = true));\n      this.playlistEditor.changed = true;\n    },\n    sortStreamAlphaDown() {\n      this.playlistEditor.streams = this.playlistEditor.streams.sort((a, b) => {\n        switch (this.activeGroupType) {\n          case 1:\n            return a.stream_tvg_name > b.stream_tvg_name\n              ? 1\n              : b.stream_tvg_name > a.stream_tvg_name\n              ? -1\n              : 0;\n          case 2:\n            return a.movie_name > b.movie_name\n              ? 1\n              : b.movie_name > a.movie_name\n              ? -1\n              : 0;\n          case 3:\n            return a.serie_name > b.serie_name\n              ? 1\n              : b.serie_name > a.serie_name\n              ? -1\n              : 0;\n        }\n      });\n      this.playlistEditor.streams.map((stream) => (stream.modified = true));\n      this.playlistEditor.changed = true;\n    },\n    sortStreamHiddenUp() {\n      this.playlistEditor.streams = this.playlistEditor.streams.sort((a, b) =>\n        b.stream_is_hidden > a.stream_is_hidden\n          ? 1\n          : a.stream_is_hidden > b.stream_is_hidden\n          ? -1\n          : 0\n      );\n      this.playlistEditor.streams.map((group) => (group.modified = true));\n      this.playlistEditor.changed = true;\n    },\n    sortStreamHiddenDown() {\n      this.playlistEditor.streams = this.playlistEditor.streams.sort((a, b) =>\n        a.stream_is_hidden > b.stream_is_hidden\n          ? 1\n          : b.stream_is_hidden > a.stream_is_hidden\n          ? -1\n          : 0\n      );\n      this.playlistEditor.streams.map((group) => (group.modified = true));\n      this.playlistEditor.changed = true;\n    },\n    addGroup() {\n      this.isLoading = true;\n      httpService\n        .post(\"editor/add-group\", { playlist_id: this.playlistEditor.id })\n        .then((res) => {\n          this.isLoading = false;\n          if (res.status === true && res.data) {\n            return new Promise((resolve) => {\n              this.playlistEditor.groups.push(res.data);\n              this.activeGroup =\n                this.playlistEditor.groups[\n                  this.playlistEditor.groups.length - 1\n                ].id;\n              this.activeGroups = [\n                this.playlistEditor.groups[\n                  this.playlistEditor.groups.length - 1\n                ].id,\n              ];\n              resolve();\n            }).then(() => {\n              this.editGroupModal(true);\n            });\n          }\n        })\n        .catch(() => {\n          this.isLoading = false;\n          this.$notify(\n            \"error\",\n            this.$t(\"profile.failed\"),\n            this.$t(\"editor.add-group-error\"),\n            \"la-user-shield\",\n            { duration: 5000, permanent: false }\n          );\n        });\n    },\n    addStream() {\n      this.isLoading = true;\n      httpService\n        .post(\"editor/add-stream\", {\n          playlist_id: this.playlistEditor.id,\n          group_id: this.getGroupWithId(this.activeGroup).id,\n          stream_type: this.getGroupWithId(this.activeGroup).group_type,\n        })\n        .then((res) => {\n          this.isLoading = false;\n          if (res.status === true && res.data) {\n            return new Promise((resolve) => {\n              this.playlistEditor.streams.unshift(res.data);\n              this.activeStream =\n                this.playlistEditor.streams[\n                  this.playlistEditor.streams.length - 1\n                ].id;\n              this.activeStreams = [\n                this.playlistEditor.streams[\n                  this.playlistEditor.streams.length - 1\n                ].id,\n              ];\n              resolve();\n            }).then(() => {\n              this.editStreamModal(true);\n            });\n          }\n        })\n        .catch(() => {\n          this.isLoading = false;\n          this.$notify(\n            \"error\",\n            this.$t(\"profile.failed\"),\n            this.$t(\"editor.add-stream-error\"),\n            \"la-user-shield\",\n            { duration: 5000, permanent: false }\n          );\n        });\n    },\n    loadStreams() {\n      this.activeStream = -1;\n      this.activeStreams = [];\n      this.playlistEditor.streams = [];\n      let index = this.playlistEditor.groups.findIndex(\n        (group) => group.id === this.activeGroup\n      );\n      let group = this.playlistEditor.groups[index];\n      this.isLoading = true;\n      httpService\n        .get(\n          `editor/streams/${this.playlistEditor.id}/${group.id}/${group.group_type}`\n        )\n        .then((res) => {\n          document.body.scrollTop = 0;\n          document.documentElement.scrollTop = 0;\n          if (res.status === true) {\n            let streams = res.data.map((stream) => {\n              const str = Object.assign({}, stream);\n              str.source_stream_tvg_name = stream.stream_tvg_name;\n              str.source_stream_tvg_id = stream.stream_tvg_id;\n              str.source_stream_tvg_logo = stream.stream_tvg_logo;\n              str.source_stream_tvg_chno = stream.stream_tvg_chno;\n              str.source_stream_tvg_shift = stream.stream_tvg_shift;\n              str.source_stream_parent_code = stream.stream_parent_code;\n              str.source_stream_audio_track = stream.stream_audio_track;\n              str.source_stream_aspect_ratio = stream.stream_aspect_ratio;\n              str.source_stream_radio = stream.stream_radio;\n              str.source_stream_order = stream.stream_order;\n              str.source_stream_is_hidden = stream.stream_is_hidden;\n              str.modified = false;\n              str.stream_is_removed = 0;\n              if (group.group_type == 2) {\n                if (str.movie_name == \"\") {\n                  str.movie_name = str.stream_tvg_name;\n                  str.source_movie_name = str.stream_tvg_name;\n                } else {\n                  str.source_movie_name = stream.movie_name;\n                }\n                str.source_movie_year = stream.movie_year;\n                str.source_tmdb_id = stream.tmdb_id;\n              }\n              if (group.group_type == 3) {\n                if (str.serie_name == \"\") {\n                  str.serie_name = str.stream_tvg_name;\n                  str.source_serie_name = str.stream_tvg_name;\n                } else {\n                  str.source_serie_name = stream.serie_name;\n                }\n                str.source_serie_season = stream.serie_season;\n                str.source_serie_episode = stream.serie_episode;\n                str.source_tmdb_id = stream.tmdb_id;\n              }\n              return str;\n            });\n            streams.sort((a, b) =>\n              a.source_stream_order > b.source_stream_order\n                ? 1\n                : b.source_stream_order > a.source_stream_order\n                ? -1\n                : 0\n            );\n            this.playlistEditor.streams = streams;\n            this.isLoading = false;\n          } else {\n            this.isLoading = false;\n          }\n        })\n        .catch(() => {\n          this.isLoading = false;\n        });\n    },\n    moveToSelectedGroup() {\n      this.isLoading = true;\n      let streams = this.activeStreams.join();\n      let index = this.playlistEditor.groups.findIndex((group) => {\n        return group.id == this.activeGroup;\n      });\n      httpService\n        .post(`editor/move-to-group/${this.activeGroupType}`, {\n          playlist_id: this.playlistEditor.id,\n          streams: streams,\n          group_id: this.activeGroups[0],\n        })\n        .then((res) => {\n          this.isLoading = false;\n          if (res.status && res.data) {\n            this.loadPlaylist(this.playlistEditor.id, index);\n          }\n        })\n        .catch(() => {\n          this.isLoading = false;\n        });\n    },\n    saveChangesModal(show, save = false) {\n      this.saveChanges.modal = show;\n      if (save) {\n        this.doSave();\n      } else {\n        this.loadStreams();\n      }\n    },\n    radioBrowserModal(show, save = false) {\n      if (show) {\n        this.radioBrowser.search = \"\";\n        this.radioBrowser.results = [];\n        this.radioBrowser.active = [];\n      }\n      if (save) {\n        this.isLoading = true;\n        let groupIndex = this.playlistEditor.groups.findIndex((group) => {\n          return group.id == this.activeGroup;\n        });\n        let order = this.playlistEditor.streams.length;\n        const streams = this.radioBrowser.active.map((index) => {\n          let radio = this.radioBrowser.results[index];\n          return {\n            source_stream_url: radio.url,\n            stream_tvg_name: radio.name,\n            stream_tvg_id: \"\",\n            stream_tvg_logo: radio.favicon,\n            stream_radio: true,\n            stream_order: order++,\n          };\n        });\n        httpService\n          .post(`editor/add-streams/${this.activeGroupType}`, {\n            playlist_id: this.playlistEditor.id,\n            group_id: this.getGroupWithId(this.activeGroup).id,\n            streams: streams,\n          })\n          .then((res) => {\n            this.isLoading = false;\n            if (res.status) {\n              this.loadPlaylist(this.playlistEditor.id, groupIndex);\n            }\n          })\n          .catch(() => {\n            this.isLoading = false;\n          });\n      }\n      this.radioBrowser.modal = show;\n    },\n    findRadiobrowser(search) {\n      if (search.length === 0) {\n        this.radioBrowser.results = [];\n        this.radioBrowser.active = [];\n      } else {\n        this.radioBrowser.isLoading = true;\n        httpService\n          .post(\"editor/find-radiobrowser\", {\n            search: search,\n          })\n          .then((res) => {\n            this.radioBrowser.active = [];\n            if (res.status) {\n              this.radioBrowser.results = res.data;\n            } else {\n              this.radioBrowser.results = [];\n            }\n            this.radioBrowser.isLoading = false;\n          })\n          .catch(() => {\n            this.radioBrowser.active = [];\n            this.radioBrowser.results = [];\n            this.radioBrowser.isLoading = false;\n          });\n      }\n    },\n    soundcloudModal(show, save = false) {\n      if (show) {\n        this.soundcloud.url = \"\";\n        this.soundcloud.track = null;\n      }\n      if (save) {\n        if (this.soundcloud.track) {\n          this.isLoading = true;\n          let groupIndex = this.playlistEditor.groups.findIndex((group) => {\n            return group.id == this.activeGroup;\n          });\n          let order = this.playlistEditor.streams.length;\n          const streams = [\n            {\n              source_stream_url: this.soundcloud.url,\n              stream_tvg_name: this.soundcloud.track.title,\n              stream_tvg_id: \"\",\n              stream_tvg_logo: this.soundcloud.track.artwork_url.replace(\n                \"large.jpg\",\n                \"t500x500.jpg\"\n              ),\n              stream_radio: true,\n              stream_order: order++,\n            },\n          ];\n          httpService\n            .post(`editor/add-streams/${this.activeGroupType}`, {\n              playlist_id: this.playlistEditor.id,\n              group_id: this.getGroupWithId(this.activeGroup).id,\n              streams: streams,\n            })\n            .then((res) => {\n              this.isLoading = false;\n              if (res.status) {\n                this.loadPlaylist(this.playlistEditor.id, groupIndex);\n              }\n            })\n            .catch(() => {\n              this.isLoading = false;\n            });\n        }\n      }\n      this.soundcloud.modal = show;\n    },\n    getSoundcloudTrack(url, client_id) {\n      if (url.length === 0 || !/soundcloud\\.com/.test(url)) {\n        this.soundcloud.url = \"\";\n        this.soundcloud.track = null;\n      } else {\n        this.soundcloud.isLoading = true;\n        httpService\n          .post(\"editor/soundcloud-track\", {\n            url: url,\n            client_id: client_id,\n          })\n          .then((res) => {\n            if (res.status && Object.keys(res.data).length) {\n              this.soundcloud.track = res.data;\n            } else {\n              this.soundcloud.track = null;\n            }\n            this.soundcloud.isLoading = false;\n          })\n          .catch(() => {\n            this.soundcloud.track = null;\n            this.soundcloud.isLoading = false;\n          });\n      }\n    },\n    youtubeModal(show, save = false) {\n      if (show) {\n        this.youtube.url = \"\";\n        this.youtube.video = null;\n        this.youtube.isLoading = false;\n      }\n      if (save) {\n        if (this.youtube.video) {\n          this.youtube.isLoading = true;\n          let groupIndex = this.playlistEditor.groups.findIndex((group) => {\n            return group.id == this.activeGroup;\n          });\n          let order = this.playlistEditor.streams.length;\n          const streams = [\n            {\n              source_stream_url: this.youtube.url,\n              stream_tvg_name: this.youtube.video.videoDetails.title,\n              stream_tvg_id: \"\",\n              stream_tvg_logo: `http://i.ytimg.com/vi/${this.youtube.videoId}/maxresdefault.jpg`,\n              stream_order: order++,\n            },\n          ];\n          httpService\n            .post(`editor/add-streams/${this.activeGroupType}`, {\n              playlist_id: this.playlistEditor.id,\n              group_id: this.getGroupWithId(this.activeGroup).id,\n              streams: streams,\n            })\n            .then((res) => {\n              this.youtube.isLoading = false;\n              if (res.status) {\n                this.loadPlaylist(this.playlistEditor.id, groupIndex);\n              }\n            })\n            .catch(() => {\n              this.youtube.isLoading = false;\n            });\n        }\n      }\n      this.youtube.modal = show;\n    },\n    getYoutubePage(videoId) {\n      this.youtube.isLoading = true;\n      httpService.youtube(videoId).then((res) => {\n        this.youtube.video = res;\n        this.youtube.isLoading = false;\n      });\n    },\n    vimeoModal(show, save = false) {\n      if (show) {\n        this.vimeo.url = \"\";\n        this.vimeo.video = null;\n        this.vimeo.isLoading = false;\n      }\n      if (save) {\n        if (this.vimeo.video) {\n          this.vimeo.isLoading = true;\n          let groupIndex = this.playlistEditor.groups.findIndex((group) => {\n            return group.id == this.activeGroup;\n          });\n          let order = this.playlistEditor.streams.length;\n          const streams = [\n            {\n              source_stream_url: this.vimeo.url,\n              stream_tvg_name: this.vimeo.video.video.title,\n              stream_tvg_id: \"\",\n              stream_tvg_logo: this.vimeo.video.video.thumbs.base,\n              stream_order: order++,\n            },\n          ];\n          httpService\n            .post(`editor/add-streams/${this.activeGroupType}`, {\n              playlist_id: this.playlistEditor.id,\n              group_id: this.getGroupWithId(this.activeGroup).id,\n              streams: streams,\n            })\n            .then((res) => {\n              this.vimeo.isLoading = false;\n              if (res.status) {\n                this.loadPlaylist(this.playlistEditor.id, groupIndex);\n              }\n            })\n            .catch(() => {\n              this.vimeo.isLoading = false;\n            });\n        }\n      }\n      this.vimeo.modal = show;\n    },\n    getVimeoConfig(videoId) {\n      this.vimeo.isLoading = true;\n      httpService\n        .post(\"editor/vimeo-video\", { video_id: videoId })\n        .then((res) => {\n          this.vimeo.video = res.data;\n          this.vimeo.isLoading = false;\n        });\n    },\n    dailymotionModal(show, save = false) {\n      if (show) {\n        this.dailymotion.url = \"\";\n        this.dailymotion.video = null;\n        this.dailymotion.isLoading = false;\n      }\n      if (save) {\n        if (this.dailymotion.video) {\n          this.dailymotion.isLoading = true;\n          let groupIndex = this.playlistEditor.groups.findIndex((group) => {\n            return group.id == this.activeGroup;\n          });\n          let order = this.playlistEditor.streams.length;\n          const streams = [\n            {\n              source_stream_url: this.dailymotion.url,\n              stream_tvg_name: this.dailymotion.video.title,\n              stream_tvg_id: \"\",\n              stream_tvg_logo: this.dailymotion.video.thumbnail_1080_url,\n              stream_order: order++,\n            },\n          ];\n          httpService\n            .post(`editor/add-streams/${this.activeGroupType}`, {\n              playlist_id: this.playlistEditor.id,\n              group_id: this.getGroupWithId(this.activeGroup).id,\n              streams: streams,\n            })\n            .then((res) => {\n              this.dailymotion.isLoading = false;\n              if (res.status) {\n                this.loadPlaylist(this.playlistEditor.id, groupIndex);\n              }\n            })\n            .catch(() => {\n              this.dailymotion.isLoading = false;\n            });\n        }\n      }\n      this.dailymotion.modal = show;\n    },\n    getDailymotionConfig(videoId) {\n      this.dailymotion.isLoading = true;\n      httpService\n        .post(\"editor/dailymotion-video\", { video_id: videoId })\n        .then((res) => {\n          this.dailymotion.video = res.data;\n          this.dailymotion.isLoading = false;\n        });\n    },\n    tedTalksModal(show, save = false) {\n      if (show) {\n        this.tedTalks.url = \"\";\n        this.tedTalks.video = null;\n        this.tedTalks.isLoading = false;\n      }\n      if (save) {\n        if (this.tedTalks.video) {\n          this.tedTalks.isLoading = true;\n          let groupIndex = this.playlistEditor.groups.findIndex((group) => {\n            return group.id == this.activeGroup;\n          });\n          let order = this.playlistEditor.streams.length;\n          const streams = [\n            {\n              source_stream_url: this.tedTalks.url,\n              stream_tvg_name: this.tedTalks.video.title,\n              stream_tvg_id: \"\",\n              stream_tvg_logo: this.tedTalks.video.hero,\n              stream_order: order++,\n            },\n          ];\n          httpService\n            .post(`editor/add-streams/${this.activeGroupType}`, {\n              playlist_id: this.playlistEditor.id,\n              group_id: this.getGroupWithId(this.activeGroup).id,\n              streams: streams,\n            })\n            .then((res) => {\n              this.tedTalks.isLoading = false;\n              if (res.status) {\n                this.loadPlaylist(this.playlistEditor.id, groupIndex);\n              }\n            })\n            .catch(() => {\n              this.tedTalks.isLoading = false;\n            });\n        }\n      }\n      this.tedTalks.modal = show;\n    },\n    getTedTalksConfig(url) {\n      this.tedTalks.isLoading = true;\n      httpService.post(\"editor/ted-talks-video\", { url: url }).then((res) => {\n        this.tedTalks.video = res.data.talks.length ? res.data.talks[0] : null;\n        this.tedTalks.isLoading = false;\n      });\n    },\n    xhamsterModal(show, save = false) {\n      if (show) {\n        this.xhamster.url = \"\";\n        this.xhamster.video = null;\n        this.xhamster.isLoading = false;\n      }\n      if (save) {\n        if (this.xhamster.video) {\n          this.xhamster.isLoading = true;\n          let groupIndex = this.playlistEditor.groups.findIndex((group) => {\n            return group.id == this.activeGroup;\n          });\n          let order = this.playlistEditor.streams.length;\n          const streams = [\n            {\n              source_stream_url: this.xhamster.url,\n              stream_tvg_name: this.xhamster.video.videoEntity.title,\n              stream_tvg_id: \"\",\n              stream_tvg_logo: this.xhamster.video.videoEntity.thumbBig,\n              stream_order: order++,\n            },\n          ];\n          httpService\n            .post(`editor/add-streams/${this.activeGroupType}`, {\n              playlist_id: this.playlistEditor.id,\n              group_id: this.getGroupWithId(this.activeGroup).id,\n              streams: streams,\n            })\n            .then((res) => {\n              this.xhamster.isLoading = false;\n              if (res.status) {\n                this.loadPlaylist(this.playlistEditor.id, groupIndex);\n              }\n            })\n            .catch(() => {\n              this.xhamster.isLoading = false;\n            });\n        }\n      }\n      this.xhamster.modal = show;\n    },\n    getXhamsterConfig(url) {\n      this.xhamster.isLoading = true;\n      httpService.post(\"editor/xhamster-video\", { url: url }).then((res) => {\n        this.xhamster.video = res.data;\n        this.xhamster.isLoading = false;\n      });\n    },\n    groupDoubleClick() {\n      if (this.activeGroups.length === 1) {\n        this.editGroupModal(true);\n      }\n    },\n    streamDoubleClick() {\n      if (this.activeStreams.length === 1) {\n        this.editStreamModal(true);\n      }\n    },\n    loadLogoCountries() {\n      this.findLogo.isLoading = true;\n      httpService\n        .get(\"editor/logo-countries\")\n        .then((res) => {\n          this.findLogo.isLoading = false;\n          this.findLogo.countries = res.data\n            .map((country) => {\n              let cn = this.countries.find(\n                (cnt) => cnt.code.toLowerCase() == country.toLowerCase()\n              );\n              return {\n                text: cn ? cn.name : country,\n                value: country,\n              };\n            })\n            .sort((a, b) => {\n              return a.text.toUpperCase() < b.text.toUpperCase()\n                ? -1\n                : a.text.toUpperCase() > b.text.toUpperCase()\n                ? 1\n                : 0;\n            });\n          this.assignLogo.countries = [...this.findLogo.countries];\n        })\n        .catch(() => {\n          this.findLogo.isLoading = false;\n        });\n    },\n    loadLogosFind(country) {\n      this.findLogo.isLoading = true;\n      httpService\n        .get(`editor/logos/${country}`)\n        .then((res) => {\n          this.findLogo.logo = \"\";\n          this.findLogo.isLoading = false;\n          this.findLogo.logos = res.data.map((logo) => {\n            return {\n              text: logo.label,\n              value: logo.filename,\n            };\n          });\n        })\n        .catch(() => {\n          this.findLogo.isLoading = false;\n        });\n    },\n    findLogoModal(show, save = false) {\n      if (show) {\n        this.findLogo.logo = \"\";\n      }\n      this.findLogo.search = \"\";\n      if (save) {\n        let selected = this.getStreamWithId(this.activeStreams[0]);\n        if (selected) {\n          selected.stream_tvg_logo = `http://static.iptv-tools.com/${this.findLogo.country}/${this.findLogo.logo}`;\n          selected.modified = true;\n          this.playlistEditor.changed = true;\n        }\n      }\n      this.findLogo.modal = show;\n    },\n    loadLogosAssign(country) {\n      this.assignLogo.isLoading = true;\n      httpService\n        .get(`editor/logos/${country}`)\n        .then((res) => {\n          this.assignLogo.logo = \"\";\n          this.assignLogo.isLoading = false;\n          this.assignLogo.logos = res.data.map((logo) => logo.filename);\n        })\n        .catch(() => {\n          this.assignLogo.isLoading = false;\n        });\n    },\n    assignLogoModal(show, save = false) {\n      if (show) {\n        this.assignLogo.logo = \"\";\n      }\n      if (save) {\n        var changed = false;\n        var stringSimilarity = require(\"string-similarity\");\n        let streams = [];\n        if (this.assignLogo.assignAll) {\n          streams = this.playlistEditor.streams;\n        } else {\n          streams = this.playlistEditor.streams.filter((stream) => {\n            return !stream.stream_tvg_logo.length;\n          });\n        }\n        streams.map((stream) => {\n          let match1 = stringSimilarity.findBestMatch(\n            String(stream.stream_tvg_name).replace(/ hd$/i, \"\"),\n            this.assignLogo.logos\n          ).bestMatch;\n          let match2 = stringSimilarity.findBestMatch(\n            String(stream.stream_tvg_id),\n            this.assignLogo.logos\n          ).bestMatch;\n          if (match1.rating >= 0.3) {\n            changed = true;\n            stream.stream_tvg_logo = `http://static.iptv-tools.com/${this.assignLogo.country}/${match1.target}`;\n            stream.modified = true;\n          } else if (match2.rating >= 0.5) {\n            changed = true;\n            stream.stream_tvg_logo = `http://static.iptv-tools.com/${this.assignLogo.country}/${match2.target}`;\n            stream.modified = true;\n          }\n        });\n        this.playlistEditor.changed = changed;\n      }\n      this.assignLogo.modal = show;\n    },\n  },\n  beforeMount() {\n    document.body.classList.add(\"right-menu\");\n    EventBus.$on(\"search\", this.searchEditor);\n    EventBus.$on(\"print\", this.printEditor);\n    EventBus.$on(\"tab-change\", this.doTabChange);\n    EventBus.$on(\"save\", this.doSave);\n    EventBus.$on(\"cancel\", this.doCancel);\n    EventBus.$on(\"editor-playlist\", this.loadPlaylist);\n    this.loadLogoCountries();\n  },\n  beforeDestroy() {\n    document.body.classList.remove(\"right-menu\");\n    EventBus.$off(\"search\", this.searchEditor);\n    EventBus.$off(\"print\", this.printEditor);\n    EventBus.$off(\"tab-change\", this.doTabChange);\n    EventBus.$off(\"save\", this.doSave);\n    EventBus.$off(\"cancel\", this.doCancel);\n    EventBus.$off(\"editor-playlist\", this.loadPlaylist);\n  },\n  watch: {\n    dragStream: function (val) {\n      if (!val) {\n        this.playlistEditor.changed = true;\n      }\n    },\n    dragGroup: function (val) {\n      if (!val) {\n        this.playlistEditor.changed = true;\n      }\n    },\n    activeGroup: function (val) {\n      if (this.playlistEditor.changed) {\n        this.saveChangesModal(true);\n      } else {\n        this.loadStreams();\n      }\n    },\n    \"playlistEditor.changed\": function (val) {\n      EventBus.$emit(\"editor-changes\", val);\n    },\n    \"radioBrowser.search\": function (val) {\n      let vm = this;\n      clearTimeout(this.radioBrowser.bounce);\n      this.radioBrowser.bounce = setTimeout(function () {\n        vm.findRadiobrowser(val);\n      }, 500);\n    },\n    \"soundcloud.url\": function (val) {\n      let vm = this;\n      clearTimeout(this.radioBrowser.bounce);\n      this.radioBrowser.bounce = setTimeout(function () {\n        vm.getSoundcloudTrack(val, vm.soundcloudClientId);\n      }, 500);\n    },\n    \"youtube.url\": function (val) {\n      if (!val.length) {\n        return;\n      }\n      if (/youtu\\.?be/i.test(val)) {\n        var i;\n        var patterns = [\n          /youtu\\.be\\/([^#&?]{11})/, // youtu.be/<id>\n          /\\?v=([^#&?]{11})/, // ?v=<id>\n          /&v=([^#&?]{11})/, // &v=<id>\n          /embed\\/([^#&?]{11})/, // embed/<id>\n          /\\/v\\/([^#&?]{11})/, // /v/<id>\n        ];\n\n        for (i = 0; i < patterns.length; ++i) {\n          if (patterns[i].test(val)) {\n            this.youtube.videoId = patterns[i].exec(val)[1];\n            return;\n          }\n        }\n\n        var tokens = val.split(/[/&?=#.\\s]/g);\n        for (i = 0; i < tokens.length; ++i) {\n          if (/^[^#&?]{11}$/.test(tokens[i])) {\n            this.youtube.videoId = tokens[i];\n            return;\n          }\n        }\n\n        this.youtube.videoId = \"\";\n      } else {\n        try {\n          var urlp = new URL(val);\n          this.youtube.videoId = urlp.searchParams.get(\"v\");\n        } catch (error) {\n          this.youtube.videoId = \"\";\n          console.log(error);\n        }\n      }\n    },\n    \"youtube.videoId\": function (val) {\n      let vm = this;\n      clearTimeout(this.youtube.bounce);\n      this.youtube.bounce = setTimeout(function () {\n        if (val.length) {\n          vm.getYoutubePage(val);\n        } else {\n          vm.youtube.video = null;\n        }\n      }, 500);\n    },\n    \"vimeo.url\": function (val) {\n      if (/vimeo\\.com/i.test(val)) {\n        let match = val.match(\n          /(?:www\\.|player\\.)?vimeo.com\\/(?:channels\\/(?:\\w+\\/)?|groups\\/(?:[^/]*)\\/videos\\/|album\\/(?:\\d+)\\/video\\/|video\\/|)(\\d+)(?:[a-zA-Z0-9_-]+)?/i\n        );\n        if (match.length >= 2) {\n          this.vimeo.videoId = match[1];\n        } else {\n          this.vimeo.videoId = \"\";\n        }\n      } else {\n        this.vimeo.videoId = \"\";\n      }\n    },\n    \"vimeo.videoId\": function (val) {\n      let vm = this;\n      clearTimeout(this.vimeo.bounce);\n      this.vimeo.bounce = setTimeout(function () {\n        if (val.length) {\n          vm.getVimeoConfig(val);\n        } else {\n          vm.vimeo.video = null;\n        }\n      }, 500);\n    },\n    \"dailymotion.url\": function (val) {\n      if (/dailymotion\\.com/i.test(val)) {\n        let match = val.match(\n          /^.+dailymotion.com\\/(video|hub)\\/([^_]+)[^#]*(#video=([^_&]+))?/i\n        );\n        if (match.length >= 4 && match[4]) {\n          this.dailymotion.videoId = match[4];\n        } else if (match.length >= 2) {\n          this.dailymotion.videoId = match[2];\n        } else {\n          this.dailymotion.videoId = \"\";\n        }\n      } else {\n        this.dailymotion.videoId = \"\";\n      }\n    },\n    \"dailymotion.videoId\": function (val) {\n      let vm = this;\n      clearTimeout(this.dailymotion.bounce);\n      this.dailymotion.bounce = setTimeout(function () {\n        if (val.length) {\n          vm.getDailymotionConfig(val);\n        } else {\n          vm.dailymotion.video = null;\n        }\n      }, 500);\n    },\n    \"tedTalks.url\": function (val) {\n      if (/ted\\.com\\/talks/i.test(val)) {\n        let vm = this;\n        clearTimeout(this.tedTalks.bounce);\n        this.tedTalks.bounce = setTimeout(function () {\n          if (val.length) {\n            vm.getTedTalksConfig(val);\n          } else {\n            vm.tedTalks.video = null;\n          }\n        }, 500);\n      }\n    },\n    \"xhamster.url\": function (val) {\n      let vm = this;\n      if (/xhamster\\.com\\/videos/i.test(val)) {\n        clearTimeout(this.xhamsterBounce);\n        this.xhamsterBounce = setTimeout(function () {\n          if (val.length) {\n            vm.getXhamsterConfig(val);\n          } else {\n            vm.xhamster.video = null;\n          }\n        }, 500);\n      }\n    },\n    \"findLogo.country\": function (val) {\n      if (val.length) {\n        this.loadLogosFind(val);\n      } else {\n        this.findLogo.logo = \"\";\n      }\n    },\n    \"assignLogo.country\": function (val) {\n      if (val.length) {\n        this.loadLogosAssign(val);\n      } else {\n        this.assignLogo.logo = \"\";\n      }\n    },\n  },\n};\n</script>\n\n<style lang=\"scss\">\n.editor-stream,\n.editor-group {\n  margin-top: 0.1rem;\n  -webkit-user-select: none;\n  -webkit-touch-callout: none;\n  -khtml-user-select: none;\n  -ms-user-select: none;\n  -moz-user-select: none;\n  user-select: none;\n\n  &:focus,\n  &:focus-within {\n    &.selected {\n      background-color: $theme-color-1 !important;\n\n      a,\n      i,\n      span {\n        color: $button-text-color !important;\n      }\n    }\n\n    &.active {\n      border-color: rgba($theme-color-1, 0.6) !important;\n\n      a,\n      span {\n        font-weight: bold;\n      }\n      a,\n      i,\n      span {\n        color: $theme-color-1;\n      }\n    }\n  }\n\n  &.selected {\n    background-color: $theme-color-1 !important;\n    &.success {\n      background-color: $success-color !important;\n    }\n    &.danger {\n      background-color: $error-color !important;\n    }\n    &.info {\n      background-color: $info-color !important;\n    }\n\n    a,\n    i,\n    span {\n      color: $button-text-color !important;\n    }\n  }\n\n  &.active {\n    border-color: rgba($theme-color-1, 0.6) !important;\n\n    a,\n    span {\n      font-weight: bold;\n    }\n    a,\n    i,\n    span {\n      color: $theme-color-1;\n    }\n  }\n\n  &.hidden {\n    opacity: 0.5;\n  }\n}\n\n.editor-stream {\n  .stream-icon {\n    float: right;\n    max-height: 16px;\n  }\n}\n\n.editor-stream-icon {\n  max-width: 100%;\n  max-height: 250px;\n  height: auto !important;\n}\n\n.editor-movie-poster {\n  max-height: 250px;\n  width: auto !important;\n}\n\n.flip-list-move {\n  transition: transform 0.5s;\n}\n.no-move {\n  transition: transform 0s;\n}\n.ghost {\n  opacity: 0.5;\n}\n\n.handle {\n  cursor: move;\n  vertical-align: middle;\n\n  &.disabled {\n    cursor: not-allowed;\n  }\n}\n\n.radiobrowser-stations {\n  overflow: hidden;\n\n  .ps {\n    max-height: 300px;\n    padding-top: 0.25rem;\n    padding-bottom: 0.5rem;\n  }\n\n  .radiobrowser-station {\n    margin-top: 0.1rem;\n    -webkit-user-select: none;\n    -webkit-touch-callout: none;\n    -khtml-user-select: none;\n    -ms-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n\n    &:focus,\n    &:focus-within {\n      &.selected {\n        background-color: $theme-color-1 !important;\n\n        a,\n        i,\n        span {\n          color: $button-text-color !important;\n        }\n      }\n\n      &.active {\n        border-color: rgba($theme-color-1, 0.6) !important;\n\n        a,\n        span {\n          font-weight: bold;\n        }\n        a,\n        i,\n        span {\n          color: $theme-color-1;\n        }\n      }\n    }\n\n    &.selected {\n      background-color: $theme-color-1 !important;\n      &.success {\n        background-color: $success-color !important;\n      }\n      &.danger {\n        background-color: $error-color !important;\n      }\n      &.info {\n        background-color: $info-color !important;\n      }\n\n      a,\n      i,\n      span {\n        color: $button-text-color !important;\n      }\n    }\n\n    &.active {\n      border-color: rgba($theme-color-1, 0.6) !important;\n\n      a,\n      span {\n        font-weight: bold;\n      }\n      a,\n      i,\n      span {\n        color: $theme-color-1;\n      }\n    }\n  }\n}\n\n.soundcloud-info {\n  width: max-content;\n\n  .cover {\n    max-height: 300px;\n  }\n}\n\n.find-logo {\n  min-height: 250px;\n\n  .stream-logo {\n    max-width: 250px;\n    height: auto;\n  }\n}\n\n.assign-logo {\n  min-height: 300px;\n}\n</style>\n"]}]}