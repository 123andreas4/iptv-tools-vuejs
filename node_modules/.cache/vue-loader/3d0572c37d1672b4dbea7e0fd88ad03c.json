{"remainingRequest":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/vue-loader/lib/index.js??vue-loader-options!/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/src/views/app/m3u/editor.vue?vue&type=script&lang=js&","dependencies":[{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/src/views/app/m3u/editor.vue","mtime":1624960125340},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCi8qIGVzbGludC1kaXNhYmxlIHZ1ZS9uby1zaWRlLWVmZmVjdHMtaW4tY29tcHV0ZWQtcHJvcGVydGllcyAqLwovKiBlc2xpbnQtZGlzYWJsZSBuby11bnVzZWQtdmFycyAqLwovKiBlc2xpbnQtZGlzYWJsZSBuby11c2VsZXNzLWVzY2FwZSAqLwoKaW1wb3J0IHsgRXZlbnRCdXMgfSBmcm9tICIuLi8uLi8uLi9zZXJ2aWNlcy9lYnVzIjsKaW1wb3J0IHsgaHR0cFNlcnZpY2UgfSBmcm9tICIuLi8uLi8uLi9zZXJ2aWNlcy9odHRwIjsKaW1wb3J0IHsgbWFwR2V0dGVycyB9IGZyb20gInZ1ZXgiOwppbXBvcnQgZHJhZ2dhYmxlIGZyb20gInZ1ZWRyYWdnYWJsZSI7CmltcG9ydCB7IFN1YnNjcmlwdGlvblR5cGUgfSBmcm9tICIuLi8uLi8uLi9jb25zdGFudHMvY29uZmlnIjsKaW1wb3J0IHsgY291bnRyaWVzIH0gZnJvbSAiLi4vLi4vLi4vaGVscGVycyI7CmltcG9ydCB7IG0zdSB9IGZyb20gIi4uLy4uLy4uL3BsdWdpbnMvbTN1IjsKCmV4cG9ydCBkZWZhdWx0IHsKICBjb21wb25lbnRzOiB7CiAgICBkcmFnZ2FibGUsCiAgfSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgY291bnRyaWVzLAogICAgICBhY3RpdmVUYWI6IDAsCiAgICAgIGFjdGl2ZUdyb3VwOiAtMSwKICAgICAgYWN0aXZlR3JvdXBzOiBbXSwKICAgICAgYWN0aXZlU3RyZWFtOiAtMSwKICAgICAgYWN0aXZlU3RyZWFtczogW10sCiAgICAgIGRyYWdHcm91cDogZmFsc2UsCiAgICAgIGRyYWdTdHJlYW06IGZhbHNlLAogICAgICBlZGl0b3I6IGZhbHNlLAogICAgICBzZWFyY2g6IG51bGwsCiAgICAgIGlzTG9hZGluZzogZmFsc2UsCiAgICAgIHBsYXlsaXN0RWRpdG9yOiB7CiAgICAgICAgaWQ6IHVuZGVmaW5lZCwKICAgICAgICBwbGF5bGlzdDogbnVsbCwKICAgICAgICBncm91cHM6IFtdLAogICAgICAgIHN0cmVhbXM6IFtdLAogICAgICAgIGNoYW5nZWQ6IGZhbHNlLAogICAgICB9LAogICAgICBmaW5kUmVwbGFjZTogewogICAgICAgIHR5cGU6IDAsCiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIGZyb206ICIiLAogICAgICAgIHRvOiAiIiwKICAgICAgICByZXBsYWNlQWxsOiBmYWxzZSwKICAgICAgICBpZ25vcmVDYXNlOiBmYWxzZSwKICAgICAgICBzZWxlY3RlZE9ubHk6IDAsCiAgICAgIH0sCiAgICAgIHByZWZpeFN1ZmZpeDogewogICAgICAgIHR5cGU6IDAsCiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIHByZWZpeDogIiIsCiAgICAgICAgc3VmZml4OiAiIiwKICAgICAgICBzZWxlY3RlZE9ubHk6IDAsCiAgICAgIH0sCiAgICAgIGNvbnZlcnRDYXNlOiB7CiAgICAgICAgdHlwZTogMCwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgbWV0aG9kOiAwLAogICAgICAgIHNlbGVjdGVkT25seTogMCwKICAgICAgfSwKICAgICAgZ3JvdXBFZGl0b3I6IHsKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgaWQ6IDAsCiAgICAgICAgZ3JvdXBfbmFtZTogIiIsCiAgICAgICAgZ3JvdXBfcGFyZW50X2NvZGU6ICIiLAogICAgICAgIGdyb3VwX3R5cGU6IDEsCiAgICAgICAgZ3JvdXBfaXNfaGlkZGVuOiAwLAogICAgICB9LAogICAgICBzdHJlYW1FZGl0b3I6IHsKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgaWQ6IC0xLAogICAgICAgIHN0cmVhbV90dmdfbmFtZTogIiIsCiAgICAgICAgc3RyZWFtX3R2Z19pZDogIiIsCiAgICAgICAgc3RyZWFtX3R2Z19sb2dvOiAiIiwKICAgICAgICBzdHJlYW1fdHZnX2Nobm86ICIiLAogICAgICAgIHN0cmVhbV90dmdfc2hpZnQ6ICIiLAogICAgICAgIHN0cmVhbV9wYXJlbnRfY29kZTogIiIsCiAgICAgICAgc3RyZWFtX2F1ZGlvX3RyYWNrOiAiIiwKICAgICAgICBzdHJlYW1fYXNwZWN0X3JhdGlvOiAiIiwKICAgICAgICBzdHJlYW1fcmFkaW86IDAsCiAgICAgICAgc3RyZWFtX2lzX2hpZGRlbjogMCwKICAgICAgICBzdHJlYW1faXNfY3VzdG9tOiAwLAogICAgICAgIG1vdmllX25hbWU6ICIiLAogICAgICAgIG1vdmllX3llYXI6ICIiLAogICAgICAgIHNlcmllX25hbWU6ICIiLAogICAgICAgIHNlcmllX3NlYXNvbjogMCwKICAgICAgICBzZXJpZV9lcGlzb2RlOiAwLAogICAgICAgIHNvdXJjZV9zdHJlYW1fdXJsOiAiIiwKICAgICAgfSwKICAgICAgcmFkaW9Ccm93c2VyOiB7CiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgYm91bmNlOiBudWxsLAogICAgICAgIGFjdGl2ZTogW10sCiAgICAgICAgc2VhcmNoOiAiIiwKICAgICAgICByZXN1bHRzOiBbXSwKICAgICAgfSwKICAgICAgc291bmRjbG91ZDogewogICAgICAgIGlzTG9hZGluZzogZmFsc2UsCiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIGJvdW5jZTogbnVsbCwKICAgICAgICB1cmw6ICIiLAogICAgICAgIHRyYWNrOiBudWxsLAogICAgICB9LAogICAgICB5b3V0dWJlOiB7CiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgYm91bmNlOiBudWxsLAogICAgICAgIHVybDogIiIsCiAgICAgICAgdmlkZW9JZDogIiIsCiAgICAgICAgdmlkZW86IG51bGwsCiAgICAgIH0sCiAgICAgIHZpbWVvOiB7CiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgYm91bmNlOiBudWxsLAogICAgICAgIHVybDogIiIsCiAgICAgICAgdmlkZW9JZDogIiIsCiAgICAgICAgdmlkZW86IG51bGwsCiAgICAgIH0sCiAgICAgIGRhaWx5bW90aW9uOiB7CiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgYm91bmNlOiBudWxsLAogICAgICAgIHVybDogIiIsCiAgICAgICAgdmlkZW9JZDogIiIsCiAgICAgICAgdmlkZW86IG51bGwsCiAgICAgIH0sCiAgICAgIHRlZFRhbGtzOiB7CiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgYm91bmNlOiBudWxsLAogICAgICAgIHVybDogIiIsCiAgICAgICAgdmlkZW86IG51bGwsCiAgICAgIH0sCiAgICAgIHhoYW1zdGVyOiB7CiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgYm91bmNlOiBudWxsLAogICAgICAgIHVybDogIiIsCiAgICAgICAgdmlkZW86IG51bGwsCiAgICAgIH0sCiAgICAgIGZpbmRMb2dvOiB7CiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgY291bnRyaWVzOiBbXSwKICAgICAgICBjb3VudHJ5OiAiIiwKICAgICAgICBsb2dvczogW10sCiAgICAgICAgbG9nbzogIiIsCiAgICAgICAgc2VhcmNoOiAiIiwKICAgICAgICB0aXRsZTogIiIsCiAgICAgIH0sCiAgICAgIGFzc2lnbkxvZ286IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBjb3VudHJpZXM6IFtdLAogICAgICAgIGNvdW50cnk6ICIiLAogICAgICAgIGxvZ29zOiBbXSwKICAgICAgICBhc3NpZ25BbGw6IDAsCiAgICAgIH0sCiAgICAgIGltcG9ydE0zVTogewogICAgICAgIGlzTG9hZGluZzogZmFsc2UsCiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIGdyb3VwczogW10sCiAgICAgICAgaW1wb3J0R3JvdXBzOiBbXSwKICAgICAgICBtM3U6IG51bGwsCiAgICAgICAgZmlsZTogbnVsbCwKICAgICAgfSwKICAgICAgZmluZFRWR0lEOiB7CiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgY291bnRyaWVzOiBbXSwKICAgICAgICBjb3VudHJ5OiAiIiwKICAgICAgICBjaGFubmVsczogW10sCiAgICAgICAgY2hhbm5lbDogIiIsCiAgICAgICAgc2VhcmNoOiAiIiwKICAgICAgICB0aXRsZTogIiIsCiAgICAgIH0sCiAgICAgIGFzc2lnblRWR0lEOiB7CiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgY291bnRyaWVzOiBbXSwKICAgICAgICBjb3VudHJ5OiAiIiwKICAgICAgICBjaGFubmVsczogW10sCiAgICAgICAgYXNzaWduQWxsOiAwLAogICAgICB9LAogICAgICBzYXZlQ2hhbmdlczogewogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgfSwKICAgICAgZ3JvdXBUeXBlczogWwogICAgICAgIHsgdGV4dDogdGhpcy4kdCgieHRyZWFtLmxpdmUiKSwgdmFsdWU6IDEgfSwKICAgICAgICB7IHRleHQ6IHRoaXMuJHQoInh0cmVhbS5tb3ZpZXMiKSwgdmFsdWU6IDIgfSwKICAgICAgICB7IHRleHQ6IHRoaXMuJHQoInh0cmVhbS5zZXJpZXMiKSwgdmFsdWU6IDMgfSwKICAgICAgXSwKICAgIH07CiAgfSwKICBjb21wdXRlZDogewogICAgLi4ubWFwR2V0dGVycyhbImN1cnJlbnRVc2VyIiwgInNldHRpbmdzIiwgInNvdW5kY2xvdWRDbGllbnRJZCIsICJtb3ZpZVNlcmllUGxheWxpc3QiXSksCiAgICBzZWFyY2hGaWx0ZXJlZCgpIHsKICAgICAgaWYgKHRoaXMuc2VhcmNoID09PSBudWxsKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuYWNjb3VudHM7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIHJlID0gbmV3IFJlZ0V4cCh0aGlzLnNlYXJjaCwgImkiKTsKICAgICAgICByZXR1cm4gdGhpcy5hY2NvdW50cy5maWx0ZXIoKGFjY291bnQpID0+IHsKICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgIFN0cmluZyhhY2NvdW50LnRpdGxlKS5tYXRjaChyZSkgfHwKICAgICAgICAgICAgU3RyaW5nKGFjY291bnQuaG9zdCkubWF0Y2gocmUpIHx8CiAgICAgICAgICAgIFN0cmluZyhhY2NvdW50LnBvcnQpLm1hdGNoKHJlKSB8fAogICAgICAgICAgICBTdHJpbmcoYWNjb3VudC51c2VybmFtZSkubWF0Y2gocmUpIHx8CiAgICAgICAgICAgIFN0cmluZyhhY2NvdW50LnBhc3N3b3JkKS5tYXRjaChyZSkgfHwKICAgICAgICAgICAgdGhpcy5mb3JtYXREYXRlKGFjY291bnQuc3luY2VkX2F0KS5tYXRjaChyZSkgfHwKICAgICAgICAgICAgdGhpcy4kdChgc3luYy1pbnRlcnZhbC4ke2FjY291bnQuc3luY19pbnRlcnZhbH1gKS5tYXRjaChyZSkKICAgICAgICAgICk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBwbGF5bGlzdFNlbGVjdGVkKCkgewogICAgICByZXR1cm4gdGhpcy5wbGF5bGlzdEVkaXRvci5pZCAhPT0gdW5kZWZpbmVkOwogICAgfSwKICAgIGxhc3RTZWxlY3RlZEdyb3VwKCkgewogICAgICByZXR1cm4gdGhpcy5hY3RpdmVHcm91cHNbdGhpcy5hY3RpdmVHcm91cHMubGVuZ3RoIC0gMV07CiAgICB9LAogICAgbGFzdFNlbGVjdGVkU3RyZWFtKCkgewogICAgICByZXR1cm4gdGhpcy5hY3RpdmVTdHJlYW1zW3RoaXMuYWN0aXZlU3RyZWFtcy5sZW5ndGggLSAxXTsKICAgIH0sCiAgICBjYW5FZGl0R3JvdXBUeXBlKCkgewogICAgICByZXR1cm4gKAogICAgICAgIHRoaXMuZ3JvdXBFZGl0b3IuaWQgJiYKICAgICAgICB0aGlzLmdldEdyb3VwV2l0aElkKHRoaXMuZ3JvdXBFZGl0b3IuaWQpLnN0cmVhbXMgPT0gMAogICAgICApOwogICAgfSwKICAgIHN1YnNjcmlwdGlvbkxpbWl0ZWQoKSB7CiAgICAgIHJldHVybiAoCiAgICAgICAgdGhpcy5jdXJyZW50VXNlci5zdWJzY3JpcHRpb24gJiYKICAgICAgICB0aGlzLmN1cnJlbnRVc2VyLnN1YnNjcmlwdGlvbi5zdWJzY3JpcHRpb25fdHlwZSA9PQogICAgICAgICAgU3Vic2NyaXB0aW9uVHlwZS5FbnRodXNpYXN0CiAgICAgICk7CiAgICB9LAogICAgZmlsdGVyZWRHcm91cHMoKSB7CiAgICAgIGlmICh0aGlzLnN1YnNjcmlwdGlvbkxpbWl0ZWQpIHsKICAgICAgICByZXR1cm4gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmlsdGVyKAogICAgICAgICAgKGdyb3VwKSA9PgogICAgICAgICAgICBncm91cC5ncm91cF9pc19yZW1vdmVkICE9PSAxICYmCiAgICAgICAgICAgIGdyb3VwLnNvdXJjZV9ncm91cF90eXBlID09IDEgJiYKICAgICAgICAgICAgZ3JvdXAuZ3JvdXBfdHlwZSA9PSAxCiAgICAgICAgKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmlsdGVyKAogICAgICAgIChncm91cCkgPT4gZ3JvdXAuZ3JvdXBfaXNfcmVtb3ZlZCAhPT0gMQogICAgICApOwogICAgfSwKICAgIGZpbHRlcmVkU3RyZWFtcygpIHsKICAgICAgcmV0dXJuIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5maWx0ZXIoCiAgICAgICAgKGdyb3VwKSA9PiBncm91cC5zdHJlYW1faXNfcmVtb3ZlZCAhPT0gMQogICAgICApOwogICAgfSwKICAgIGFjdGl2ZUdyb3VwVHlwZSgpIHsKICAgICAgbGV0IGluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KAogICAgICAgIChncm91cCkgPT4gZ3JvdXAuaWQgPT0gdGhpcy5hY3RpdmVHcm91cAogICAgICApOwogICAgICByZXR1cm4gaW5kZXggPiAtMSA/IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2luZGV4XS5ncm91cF90eXBlIDogMDsKICAgIH0sCiAgICBmaWx0ZXJlZExvZ29zKCkgewogICAgICBpZiAoIXRoaXMuZmluZExvZ28uc2VhcmNoLmxlbmd0aCkgewogICAgICAgIHJldHVybiB0aGlzLmZpbmRMb2dvLmxvZ29zOwogICAgICB9CiAgICAgIGxldCBzZWxlY3RlZFN0cmVhbSA9IHRoaXMuZ2V0U3RyZWFtV2l0aElkKHRoaXMuYWN0aXZlU3RyZWFtc1swXSk7CiAgICAgIGxldCByZSA9IG5ldyBSZWdFeHAodGhpcy5maW5kTG9nby5zZWFyY2gsICJpIik7CiAgICAgIHJldHVybiB0aGlzLmZpbmRMb2dvLmxvZ29zLmZpbHRlcigobG9nbykgPT4gewogICAgICAgIHJldHVybiBsb2dvLnRleHQubWF0Y2gocmUpOwogICAgICB9KTsKICAgIH0sCiAgICBmaWx0ZXJlZFRWR0lEUygpIHsKICAgICAgaWYgKCF0aGlzLmZpbmRUVkdJRC5zZWFyY2gubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZmluZFRWR0lELmNoYW5uZWxzOwogICAgICB9CiAgICAgIGxldCBzZWxlY3RlZFN0cmVhbSA9IHRoaXMuZ2V0U3RyZWFtV2l0aElkKHRoaXMuYWN0aXZlU3RyZWFtc1swXSk7CiAgICAgIGxldCByZSA9IG5ldyBSZWdFeHAodGhpcy5maW5kVFZHSUQuc2VhcmNoLCAiaSIpOwogICAgICByZXR1cm4gdGhpcy5maW5kVFZHSUQuY2hhbm5lbHMuZmlsdGVyKChjaGFubmVsKSA9PiB7CiAgICAgICAgcmV0dXJuIGNoYW5uZWwudGV4dC5tYXRjaChyZSk7CiAgICAgIH0pOwogICAgfSwKICAgIGdyb3VwQ29udGV4dE1lbnUoKSB7CiAgICAgIGxldCB2bSA9IHRoaXM7CiAgICAgIHJldHVybiBbCiAgICAgICAgewogICAgICAgICAgaWNvbjogImxhLXBsdXMiLAogICAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5hZGQtZ3JvdXAiKSwKICAgICAgICAgIG9uQ2xpY2s6IHZtLmFkZEdyb3VwLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgZGlzYWJsZWQ6IHZtLmFjdGl2ZUdyb3Vwcy5sZW5ndGggIT09IDEsCiAgICAgICAgICBpY29uOiAibGEtZWRpdCIsCiAgICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLmVkaXQtZ3JvdXAiKSwKICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKHZtLmFjdGl2ZUdyb3Vwcy5sZW5ndGggPT09IDEpIHsKICAgICAgICAgICAgICB2bS5lZGl0R3JvdXBNb2RhbCh0cnVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGRpdmlkZXI6IHRydWUsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICB0ZXh0OiB2bS4kdCgiZ2VuZXJhbC5zZWxlY3QtYWxsIiksCiAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZtLmFjdGl2ZUdyb3VwcyA9IFsuLi52bS5wbGF5bGlzdEVkaXRvci5ncm91cHMubWFwKChnKSA9PiBnLmlkKV07CiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgdGV4dDogdm0uJHQoImdlbmVyYWwuc2VsZWN0LW5vbmUiKSwKICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdm0uYWN0aXZlR3JvdXBzID0gW107CiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgZGl2aWRlcjogdHJ1ZSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGljb246ICJsYS1zZWFyY2giLAogICAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5maW5kLXJlcGxhY2UiKSwKICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdm0uZmluZEFuZFJlcGxhY2VNb2RhbCh0cnVlLCAxKTsKICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBpY29uOiAibGEtcGVuIiwKICAgICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IuYWRkLXByZWZpeC1zdWZmaXgiKSwKICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdm0ucHJlZml4U3VmZml4TW9kYWwodHJ1ZSwgMSk7CiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgaWNvbjogImxhLWZvbnQiLAogICAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5jaGFuZ2UtY2FzZSIpLAogICAgICAgICAgb25DbGljazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2bS5jb252ZXJ0Q2FzZU1vZGFsKHRydWUsIDEpOwogICAgICAgICAgfSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGRpdmlkZXI6IHRydWUsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBkaXNhYmxlZDogdm0uYWN0aXZlR3JvdXBzLmxlbmd0aCA9PT0gMCwKICAgICAgICAgIGljb246ICJsYS1leWUiLAogICAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci50b2dnbGUtdmlzaWJpbGl0eSIpLAogICAgICAgICAgb25DbGljazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICBpZiAodm0uYWN0aXZlR3JvdXBzLmxlbmd0aCkgewogICAgICAgICAgICAgIHZtLnRvZ2dsZUdyb3VwVmlzaWJpbGl0eSgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgZGlzYWJsZWQ6IHZtLmFjdGl2ZUdyb3Vwcy5sZW5ndGggPT09IDAsCiAgICAgICAgICBpY29uOiAibGEtdHJhc2giLAogICAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5kZWxldGUiKSwKICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKHZtLmFjdGl2ZUdyb3Vwcy5sZW5ndGgpIHsKICAgICAgICAgICAgICB2bS5kZWxldGVTZWxlY3RlZEdyb3VwcygpOwogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgIF07CiAgICB9LAogICAgc3RyZWFtQ29udGV4dE1lbnUoKSB7CiAgICAgIGxldCB2bSA9IHRoaXM7CiAgICAgIHJldHVybiBbCiAgICAgICAgewogICAgICAgICAgaWNvbjogImxhLXBsdXMiLAogICAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5hZGQtc3RyZWFtIiksCiAgICAgICAgICBvbkNsaWNrOiB2bS5hZGRTdHJlYW0sCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBkaXNhYmxlZDogdm0uYWN0aXZlU3RyZWFtcy5sZW5ndGggIT09IDEsCiAgICAgICAgICBpY29uOiAibGEtZWRpdCIsCiAgICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLmVkaXQtc3RyZWFtIiksCiAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmICh2bS5hY3RpdmVTdHJlYW1zLmxlbmd0aCA9PT0gMSkgewogICAgICAgICAgICAgIHZtLmVkaXRTdHJlYW1Nb2RhbCh0cnVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGRpdmlkZXI6IHRydWUsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICB0ZXh0OiB2bS4kdCgiZ2VuZXJhbC5zZWxlY3QtYWxsIiksCiAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZtLmFjdGl2ZVN0cmVhbXMgPSBbLi4udm0ucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5tYXAoKGcpID0+IGcuaWQpXTsKICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICB0ZXh0OiB2bS4kdCgiZ2VuZXJhbC5zZWxlY3Qtbm9uZSIpLAogICAgICAgICAgb25DbGljazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2bS5hY3RpdmVTdHJlYW1zID0gW107CiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgZGl2aWRlcjogdHJ1ZSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGRpc2FibGVkOgogICAgICAgICAgICB2bS5hY3RpdmVHcm91cHMubGVuZ3RoICE9PSAxIHx8CiAgICAgICAgICAgIHZtLmFjdGl2ZVN0cmVhbXMubGVuZ3RoID09PSAwIHx8CiAgICAgICAgICAgIHZtLmdldEdyb3VwV2l0aElkKHZtLmFjdGl2ZUdyb3Vwc1swXSkuZ3JvdXBfdHlwZSAhPT0KICAgICAgICAgICAgICB2bS5hY3RpdmVHcm91cFR5cGUgfHwKICAgICAgICAgICAgdm0uYWN0aXZlR3JvdXBzWzBdID09PSB2bS5hY3RpdmVHcm91cCwKICAgICAgICAgIGljb246ICJsYS1jaGV2cm9uLWxlZnQiLAogICAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5tb3ZlLXRvLXNlbGVjdGVkLWdyb3VwIiksCiAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZtLm1vdmVUb1NlbGVjdGVkR3JvdXAoKTsKICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBkaXZpZGVyOiB0cnVlLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgaWNvbjogImxhLXNlYXJjaCIsCiAgICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLmZpbmQtcmVwbGFjZSIpLAogICAgICAgICAgb25DbGljazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2bS5maW5kQW5kUmVwbGFjZU1vZGFsKHRydWUsIDIpOwogICAgICAgICAgfSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGljb246ICJsYS1wZW4iLAogICAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5hZGQtcHJlZml4LXN1ZmZpeCIpLAogICAgICAgICAgb25DbGljazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2bS5wcmVmaXhTdWZmaXhNb2RhbCh0cnVlLCAyKTsKICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBpY29uOiAibGEtZm9udCIsCiAgICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLmNoYW5nZS1jYXNlIiksCiAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZtLmNvbnZlcnRDYXNlTW9kYWwodHJ1ZSwgMik7CiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgZGl2aWRlcjogdHJ1ZSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGRpc2FibGVkOiB2bS5hY3RpdmVTdHJlYW1zLmxlbmd0aCAhPT0gMSB8fCB2bS5hY3RpdmVHcm91cFR5cGUgIT09IDEsCiAgICAgICAgICBpY29uOiAibGEtcGhvdG8tdmlkZW8iLAogICAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5maW5kLWxvZ28iKSwKICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdm0uZmluZExvZ29Nb2RhbCh0cnVlKTsKICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBkaXNhYmxlZDogdm0uYWN0aXZlU3RyZWFtcy5sZW5ndGggIT09IDEgfHwgdm0uYWN0aXZlR3JvdXBUeXBlICE9PSAxLAogICAgICAgICAgaWNvbjogImxhLXRoLWxpc3QiLAogICAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5maW5kLXR2LWd1aWRlIiksCiAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZtLmZpbmRUVkdJRE1vZGFsKHRydWUpOwogICAgICAgICAgfSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGRpdmlkZXI6IHRydWUsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBkaXNhYmxlZDogdm0uYWN0aXZlU3RyZWFtcy5sZW5ndGggPT09IDAgfHwgdm0uYWN0aXZlR3JvdXBUeXBlICE9PSAxLAogICAgICAgICAgaWNvbjogImxhLW11c2ljIiwKICAgICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IudG9nZ2xlLXJhZGlvIiksCiAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmICh2bS5hY3RpdmVTdHJlYW1zLmxlbmd0aCAmJiB2bS5hY3RpdmVHcm91cFR5cGUgPT0gMSkgewogICAgICAgICAgICAgIHZtLnRvZ2dsZVN0cmVhbVJhZGlvKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBkaXNhYmxlZDogdm0uYWN0aXZlU3RyZWFtcy5sZW5ndGggPT09IDAsCiAgICAgICAgICBpY29uOiAibGEtZXllIiwKICAgICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IudG9nZ2xlLXZpc2liaWxpdHkiKSwKICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKHZtLmFjdGl2ZVN0cmVhbXMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgdm0udG9nZ2xlU3RyZWFtVmlzaWJpbGl0eSgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgZGl2aWRlcjogdHJ1ZSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGRpc2FibGVkOiB2bS5hY3RpdmVTdHJlYW1zLmxlbmd0aCA9PT0gMCwKICAgICAgICAgIGljb246ICJsYS10cmFzaCIsCiAgICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLmRlbGV0ZSIpLAogICAgICAgICAgb25DbGljazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICBpZiAodm0uYWN0aXZlU3RyZWFtcy5sZW5ndGgpIHsKICAgICAgICAgICAgICB2bS5kZWxldGVTZWxlY3RlZFN0cmVhbXMoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICB9LAogICAgICBdOwogICAgfSwKICB9LAogIG1ldGhvZHM6IHsKICAgIGdyb3VwRHJhZ0NoYW5nZWQoZykgewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmdyb3VwX29yZGVyICE9IGkgKyAxKSB7CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5ncm91cF9vcmRlciA9IGkgKyAxOwogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHN0cmVhbURyYWdDaGFuZ2VkKGcpIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAodGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLnN0cmVhbV9vcmRlciAhPSBpICsgMSkgewogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLnN0cmVhbV9vcmRlciA9IGkgKyAxOwogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBvcGVuQ29udGV4dChjb250ZXh0KSB7CiAgICAgIHRoaXMuJHJlZnNbY29udGV4dF0ub3BlbigpOwogICAgfSwKICAgIHNlYXJjaEVkaXRvcihzZWFyY2gpIHsKICAgICAgaWYgKHNlYXJjaC5sZW5ndGggPT09IDApIHsKICAgICAgICB0aGlzLnNlYXJjaCA9IG51bGw7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zZWFyY2ggPSBzZWFyY2g7CiAgICAgIH0KICAgIH0sCiAgICBwcmludEVkaXRvcigpIHsKICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVkaXRvciIpLnByaW50KCk7CiAgICB9LAogICAgZm9ybWF0TnVtYmVyKG51bWJlcikgewogICAgICByZXR1cm4gbmV3IEludGwuTnVtYmVyRm9ybWF0KHRoaXMuJHQoImRhdGUubG9jYWxlIikpLmZvcm1hdChudW1iZXIpOwogICAgfSwKICAgIGZvcm1hdERhdGUoZGF0ZSkgewogICAgICByZXR1cm4gbmV3IERhdGUoZGF0ZSkudG9Mb2NhbGVTdHJpbmcoCiAgICAgICAgdGhpcy4kdCgiZGF0ZS5sb2NhbGUiKSwKICAgICAgICB0aGlzLmRhdGVPcHRpb25zCiAgICAgICk7CiAgICB9LAogICAgZm9ybWF0RGF0ZVlvdXR1YmUoZGF0ZSkgewogICAgICByZXR1cm4gbmV3IERhdGUoZGF0ZSkudG9Mb2NhbGVEYXRlU3RyaW5nKHRoaXMuJHQoImRhdGUubG9jYWxlIiksIHsKICAgICAgICB5ZWFyOiAibnVtZXJpYyIsCiAgICAgICAgbW9udGg6ICJzaG9ydCIsCiAgICAgICAgZGF5OiAibnVtZXJpYyIsCiAgICAgIH0pOwogICAgfSwKICAgIGZvcm1hdFNlY29uZHMoc2VjKSB7CiAgICAgIHZhciBkID0gTnVtYmVyKHNlYyk7CiAgICAgIHZhciBoID0gTWF0aC5mbG9vcihkIC8gMzYwMCk7CiAgICAgIHZhciBtID0gTWF0aC5mbG9vcigoZCAlIDM2MDApIC8gNjApOwogICAgICB2YXIgcyA9IE1hdGguZmxvb3IoKGQgJSAzNjAwKSAlIDYwKTsKCiAgICAgIHZhciBob3VyID0gdGhpcy4kdCgiZ2VuZXJhbC5ob3VyIik7CiAgICAgIHZhciBob3VycyA9IHRoaXMuJHQoImdlbmVyYWwuaG91cnMiKTsKICAgICAgdmFyIG1pbnV0ZSA9IHRoaXMuJHQoImdlbmVyYWwubWludXRlIik7CiAgICAgIHZhciBtaW51dGVzID0gdGhpcy4kdCgiZ2VuZXJhbC5taW51dGVzIik7CiAgICAgIHZhciBzZWNvbmQgPSB0aGlzLiR0KCJnZW5lcmFsLnNlY29uZCIpOwogICAgICB2YXIgc2Vjb25kcyA9IHRoaXMuJHQoImdlbmVyYWwuc2Vjb25kcyIpOwoKICAgICAgdmFyIGhEaXNwbGF5ID0gaCA+IDAgPyBoICsgKGggPT0gMSA/IGAgJHtob3VyfSBgIDogYCAke2hvdXJzfSBgKSA6ICIiOwogICAgICB2YXIgbURpc3BsYXkgPSBtID4gMCA/IG0gKyAobSA9PSAxID8gYCAke21pbnV0ZX0gYCA6IGAgJHttaW51dGVzfSBgKSA6ICIiOwogICAgICB2YXIgc0Rpc3BsYXkgPSBzID4gMCA/IHMgKyAocyA9PSAxID8gYCAke3NlY29uZH0gYCA6IGAgJHtzZWNvbmRzfSBgKSA6ICIiOwogICAgICByZXR1cm4gaERpc3BsYXkgKyBtRGlzcGxheSArIHNEaXNwbGF5OwogICAgfSwKCiAgICBnZXRHcm91cFdpdGhJZChpZCkgewogICAgICBsZXQgaW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoCiAgICAgICAgKGdyb3VwKSA9PiBncm91cC5pZCA9PSBpZAogICAgICApOwogICAgICByZXR1cm4gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaW5kZXhdOwogICAgfSwKICAgIGdldFN0cmVhbVdpdGhJZChpZCkgewogICAgICBsZXQgaW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMuZmluZEluZGV4KAogICAgICAgIChzdHJlYW0pID0+IHN0cmVhbS5pZCA9PSBpZAogICAgICApOwogICAgICByZXR1cm4gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XTsKICAgIH0sCiAgICBkb1NhdmUoKSB7CiAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gZmFsc2U7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgIGxldCBpbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleCgoZ3JvdXApID0+IHsKICAgICAgICAgIHJldHVybiBncm91cC5pZCA9PSB0aGlzLmFjdGl2ZUdyb3VwOwogICAgICAgIH0pOwogICAgICAgIGxldCB1cGRhdGVHcm91cHMgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3VwcwogICAgICAgICAgLmZpbHRlcigoZ3JvdXApID0+ICFncm91cC5ncm91cF9pc19yZW1vdmVkICYmIGdyb3VwLm1vZGlmaWVkKQogICAgICAgICAgLm1hcCgoZ3JvdXApID0+IHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICBpZDogZ3JvdXAuaWQsCiAgICAgICAgICAgICAgZ3JvdXBfbmFtZTogZ3JvdXAuZ3JvdXBfbmFtZSwKICAgICAgICAgICAgICBncm91cF9vcmRlcjogZ3JvdXAuZ3JvdXBfb3JkZXIsCiAgICAgICAgICAgICAgZ3JvdXBfdHlwZTogZ3JvdXAuZ3JvdXBfdHlwZSwKICAgICAgICAgICAgICBncm91cF9wYXJlbnRfY29kZTogZ3JvdXAuZ3JvdXBfcGFyZW50X2NvZGUsCiAgICAgICAgICAgICAgZ3JvdXBfaXNfaGlkZGVuOiBncm91cC5ncm91cF9pc19oaWRkZW4sCiAgICAgICAgICAgIH07CiAgICAgICAgICB9KTsKICAgICAgICBsZXQgZGVsZXRlR3JvdXBzID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMKICAgICAgICAgIC5maWx0ZXIoKGdyb3VwKSA9PiBncm91cC5ncm91cF9pc19yZW1vdmVkICYmIGdyb3VwLm1vZGlmaWVkKQogICAgICAgICAgLm1hcCgoZ3JvdXApID0+IGdyb3VwLmlkKQogICAgICAgICAgLmpvaW4oKTsKCiAgICAgICAgbGV0IHVwZGF0ZVN0cmVhbXM7CiAgICAgICAgc3dpdGNoICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSkgewogICAgICAgICAgLy8gTGl2ZSBzdHJlYW1zCiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIHVwZGF0ZVN0cmVhbXMgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMKICAgICAgICAgICAgICAuZmlsdGVyKAogICAgICAgICAgICAgICAgKHN0cmVhbSkgPT4gc3RyZWFtLnN0cmVhbV9pc19yZW1vdmVkICE9PSAxICYmIHN0cmVhbS5tb2RpZmllZAogICAgICAgICAgICAgICkKICAgICAgICAgICAgICAubWFwKChzdHJlYW0pID0+IHsKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgIGlkOiBzdHJlYW0uaWQsCiAgICAgICAgICAgICAgICAgIHNvdXJjZV9zdHJlYW1fdXJsOiBzdHJlYW0uc291cmNlX3N0cmVhbV91cmwsCiAgICAgICAgICAgICAgICAgIHN0cmVhbV90dmdfbmFtZTogc3RyZWFtLnN0cmVhbV90dmdfbmFtZSwKICAgICAgICAgICAgICAgICAgc3RyZWFtX3R2Z19pZDogc3RyZWFtLnN0cmVhbV90dmdfaWQsCiAgICAgICAgICAgICAgICAgIHN0cmVhbV90dmdfbG9nbzogc3RyZWFtLnN0cmVhbV90dmdfbG9nbywKICAgICAgICAgICAgICAgICAgc3RyZWFtX3R2Z19jaG5vOiBzdHJlYW0uc3RyZWFtX3R2Z19jaG5vLAogICAgICAgICAgICAgICAgICBzdHJlYW1fdHZnX3NoaWZ0OiBzdHJlYW0uc3RyZWFtX3R2Z19zaGlmdCwKICAgICAgICAgICAgICAgICAgc3RyZWFtX3BhcmVudF9jb2RlOiBzdHJlYW0uc3RyZWFtX3BhcmVudF9jb2RlLAogICAgICAgICAgICAgICAgICBzdHJlYW1fYXVkaW9fdHJhY2s6IHN0cmVhbS5zdHJlYW1fYXVkaW9fdHJhY2ssIAogICAgICAgICAgICAgICAgICBzdHJlYW1fYXNwZWN0X3JhdGlvOiBzdHJlYW0uc3RyZWFtX2FzcGVjdF9yYXRpbywKICAgICAgICAgICAgICAgICAgc3RyZWFtX3JhZGlvOiBzdHJlYW0uc3RyZWFtX3JhZGlvLAogICAgICAgICAgICAgICAgICBzdHJlYW1faXNfaGlkZGVuOiBzdHJlYW0uc3RyZWFtX2lzX2hpZGRlbiwKICAgICAgICAgICAgICAgICAgc3RyZWFtX29yZGVyOiBzdHJlYW0uc3RyZWFtX29yZGVyLAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAvLyBNb3ZpZXMKICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgdXBkYXRlU3RyZWFtcyA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcwogICAgICAgICAgICAgIC5maWx0ZXIoCiAgICAgICAgICAgICAgICAoc3RyZWFtKSA9PiBzdHJlYW0uc3RyZWFtX2lzX3JlbW92ZWQgIT09IDEgJiYgc3RyZWFtLm1vZGlmaWVkCiAgICAgICAgICAgICAgKQogICAgICAgICAgICAgIC5tYXAoKHN0cmVhbSkgPT4gewogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgaWQ6IHN0cmVhbS5pZCwKICAgICAgICAgICAgICAgICAgbW92aWVfbmFtZTogc3RyZWFtLm1vdmllX25hbWUsCiAgICAgICAgICAgICAgICAgIG1vdmllX3llYXI6IHN0cmVhbS5tb3ZpZV95ZWFyLAogICAgICAgICAgICAgICAgICB0bWRiX2lkOiBzdHJlYW0udG1kYl9pZCwKICAgICAgICAgICAgICAgICAgc291cmNlX3N0cmVhbV91cmw6IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX3VybCwKICAgICAgICAgICAgICAgICAgc3RyZWFtX3R2Z19uYW1lOiBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lLAogICAgICAgICAgICAgICAgICBzdHJlYW1fdHZnX2lkOiBzdHJlYW0uc3RyZWFtX3R2Z19pZCwKICAgICAgICAgICAgICAgICAgc3RyZWFtX3R2Z19sb2dvOiBzdHJlYW0uc3RyZWFtX3R2Z19sb2dvLAogICAgICAgICAgICAgICAgICBzdHJlYW1fdHZnX2Nobm86IHN0cmVhbS5zdHJlYW1fdHZnX2Nobm8sCiAgICAgICAgICAgICAgICAgIHN0cmVhbV90dmdfc2hpZnQ6IHN0cmVhbS5zdHJlYW1fdHZnX3NoaWZ0LAogICAgICAgICAgICAgICAgICBzdHJlYW1fcGFyZW50X2NvZGU6IHN0cmVhbS5zdHJlYW1fcGFyZW50X2NvZGUsCiAgICAgICAgICAgICAgICAgIHN0cmVhbV9hdWRpb190cmFjazogc3RyZWFtLnN0cmVhbV9hdWRpb190cmFjaywgCiAgICAgICAgICAgICAgICAgIHN0cmVhbV9hc3BlY3RfcmF0aW86IHN0cmVhbS5zdHJlYW1fYXNwZWN0X3JhdGlvLAogICAgICAgICAgICAgICAgICBzdHJlYW1faXNfaGlkZGVuOiBzdHJlYW0uc3RyZWFtX2lzX2hpZGRlbiwKICAgICAgICAgICAgICAgICAgc3RyZWFtX29yZGVyOiBzdHJlYW0uc3RyZWFtX29yZGVyLAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAvLyBTZXJpZXMKICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgdXBkYXRlU3RyZWFtcyA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcwogICAgICAgICAgICAgIC5maWx0ZXIoCiAgICAgICAgICAgICAgICAoc3RyZWFtKSA9PiBzdHJlYW0uc3RyZWFtX2lzX3JlbW92ZWQgIT09IDEgJiYgc3RyZWFtLm1vZGlmaWVkCiAgICAgICAgICAgICAgKQogICAgICAgICAgICAgIC5tYXAoKHN0cmVhbSkgPT4gewogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgaWQ6IHN0cmVhbS5pZCwKICAgICAgICAgICAgICAgICAgc2VyaWVfbmFtZTogc3RyZWFtLnNlcmllX25hbWUsCiAgICAgICAgICAgICAgICAgIHNlcmllX3NlYXNvbjogc3RyZWFtLnNlcmllX3NlYXNvbiwKICAgICAgICAgICAgICAgICAgc2VyaWVfZXBpc29kZTogc3RyZWFtLnNlcmllX2VwaXNvZGUsCiAgICAgICAgICAgICAgICAgIHRtZGJfaWQ6IHN0cmVhbS50bWRiX2lkLAogICAgICAgICAgICAgICAgICBzb3VyY2Vfc3RyZWFtX3VybDogc3RyZWFtLnNvdXJjZV9zdHJlYW1fdXJsLAogICAgICAgICAgICAgICAgICBzdHJlYW1fdHZnX25hbWU6IHN0cmVhbS5zdHJlYW1fdHZnX25hbWUsCiAgICAgICAgICAgICAgICAgIHN0cmVhbV90dmdfaWQ6IHN0cmVhbS5zdHJlYW1fdHZnX2lkLAogICAgICAgICAgICAgICAgICBzdHJlYW1fdHZnX2xvZ286IHN0cmVhbS5zdHJlYW1fdHZnX2xvZ28sCiAgICAgICAgICAgICAgICAgIHN0cmVhbV90dmdfY2hubzogc3RyZWFtLnN0cmVhbV90dmdfY2hubywKICAgICAgICAgICAgICAgICAgc3RyZWFtX3R2Z19zaGlmdDogc3RyZWFtLnN0cmVhbV90dmdfc2hpZnQsCiAgICAgICAgICAgICAgICAgIHN0cmVhbV9wYXJlbnRfY29kZTogc3RyZWFtLnN0cmVhbV9wYXJlbnRfY29kZSwKICAgICAgICAgICAgICAgICAgc3RyZWFtX2F1ZGlvX3RyYWNrOiBzdHJlYW0uc3RyZWFtX2F1ZGlvX3RyYWNrLCAKICAgICAgICAgICAgICAgICAgc3RyZWFtX2FzcGVjdF9yYXRpbzogc3RyZWFtLnN0cmVhbV9hc3BlY3RfcmF0aW8sCiAgICAgICAgICAgICAgICAgIHN0cmVhbV9pc19oaWRkZW46IHN0cmVhbS5zdHJlYW1faXNfaGlkZGVuLAogICAgICAgICAgICAgICAgICBzdHJlYW1fb3JkZXI6IHN0cmVhbS5zdHJlYW1fb3JkZXIsCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgbGV0IGRlbGV0ZVN0cmVhbXMgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMKICAgICAgICAgIC5maWx0ZXIoKHN0cmVhbSkgPT4gc3RyZWFtLnN0cmVhbV9pc19yZW1vdmVkID09PSAxICYmIHN0cmVhbS5tb2RpZmllZCkKICAgICAgICAgIC5tYXAoKHN0cmVhbSkgPT4gc3RyZWFtLmlkKQogICAgICAgICAgLmpvaW4oKTsKCiAgICAgICAgbGV0IHJlcXVlc3RzID0gW107CiAgICAgICAgaWYgKHVwZGF0ZUdyb3Vwcy5sZW5ndGgpIHsKICAgICAgICAgIHJlcXVlc3RzLnB1c2goCiAgICAgICAgICAgIGh0dHBTZXJ2aWNlLnBvc3QoImVkaXRvci91cGRhdGUtZ3JvdXBzIiwgewogICAgICAgICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgICAgIGdyb3VwczogdXBkYXRlR3JvdXBzLAogICAgICAgICAgICB9KQogICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgaWYgKGRlbGV0ZUdyb3Vwcy5sZW5ndGgpIHsKICAgICAgICAgIGluZGV4ID0gMDsKICAgICAgICAgIHJlcXVlc3RzLnB1c2goCiAgICAgICAgICAgIGh0dHBTZXJ2aWNlLnBvc3QoImVkaXRvci9kZWxldGUtZ3JvdXBzIiwgewogICAgICAgICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgICAgIGdyb3VwczogZGVsZXRlR3JvdXBzLAogICAgICAgICAgICB9KQogICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgaWYgKHVwZGF0ZVN0cmVhbXMubGVuZ3RoKSB7CiAgICAgICAgICByZXF1ZXN0cy5wdXNoKAogICAgICAgICAgICBodHRwU2VydmljZS5wb3N0KGBlZGl0b3IvdXBkYXRlLXN0cmVhbXMvJHt0aGlzLmFjdGl2ZUdyb3VwVHlwZX1gLCB7CiAgICAgICAgICAgICAgcGxheWxpc3RfaWQ6IHRoaXMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICAgICAgc3RyZWFtczogdXBkYXRlU3RyZWFtcywKICAgICAgICAgICAgfSkKICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIGlmIChkZWxldGVTdHJlYW1zLmxlbmd0aCkgewogICAgICAgICAgcmVxdWVzdHMucHVzaCgKICAgICAgICAgICAgaHR0cFNlcnZpY2UucG9zdChgZWRpdG9yL2RlbGV0ZS1zdHJlYW1zLyR7dGhpcy5hY3RpdmVHcm91cFR5cGV9YCwgewogICAgICAgICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgICAgIHN0cmVhbXM6IGRlbGV0ZVN0cmVhbXMsCiAgICAgICAgICAgIH0pCiAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICBQcm9taXNlLmFsbChyZXF1ZXN0cykudGhlbigocmVzKSA9PiB7CiAgICAgICAgICB0aGlzLmxvYWRQbGF5bGlzdCh0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLCBpbmRleCk7CiAgICAgICAgICByZXNvbHZlKHJlcyk7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSwKICAgIGRvQ2FuY2VsKCkgewogICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIFByb21pc2UuYWxsKFt0aGlzLnJlc3RvcmVHcm91cHMoKSwgdGhpcy5yZXN0b3JlU3RyZWFtcygpXSkudGhlbigoKSA9PiB7CiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gZmFsc2U7CiAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfSk7CiAgICB9LAogICAgZG9UYWJDaGFuZ2UodGFiKSB7CiAgICAgIHRoaXMuYWN0aXZlVGFiID0gdGFiOwogICAgfSwKICAgIHVwZGF0ZUdyb3VwT3JkZXIoc291cmNlKSB7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgIGxldCBncm91cHMgPSBbLi4uc291cmNlXTsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGdyb3Vwcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgZ3JvdXBzW2ldLnNvdXJjZV9ncm91cF9vcmRlciA9IGkgKyAxOwogICAgICAgICAgZ3JvdXBzW2ldLmdyb3VwX29yZGVyID0gaSArIDE7CiAgICAgICAgfQogICAgICAgIHJlc29sdmUoZ3JvdXBzKTsKICAgICAgfSk7CiAgICB9LAogICAgdXBkYXRlU3RyZWFtT3JkZXIoc291cmNlKSB7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgIGxldCBzdHJlYW1zID0gWy4uLnNvdXJjZV07CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdHJlYW1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBzdHJlYW1zW2ldLnNvdXJjZV9zdHJlYW1fb3JkZXIgPSBpICsgMTsKICAgICAgICAgIHN0cmVhbXNbaV0uc3RyZWFtX29yZGVyID0gaSArIDE7CiAgICAgICAgfQogICAgICAgIHJlc29sdmUoc3RyZWFtcyk7CiAgICAgIH0pOwogICAgfSwKICAgIHJlc3RvcmVHcm91cE9yZGVyKCkgewogICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5zb3J0KChhLCBiKSA9PgogICAgICAgICAgYS5zb3VyY2VfZ3JvdXBfb3JkZXIgPiBiLnNvdXJjZV9ncm91cF9vcmRlcgogICAgICAgICAgICA/IDEKICAgICAgICAgICAgOiBiLnNvdXJjZV9ncm91cF9vcmRlciA+IGEuc291cmNlX2dyb3VwX29yZGVyCiAgICAgICAgICAgID8gLTEKICAgICAgICAgICAgOiAwCiAgICAgICAgKTsKICAgICAgICByZXNvbHZlKCk7CiAgICAgIH0pOwogICAgfSwKICAgIHJlc3RvcmVTdHJlYW1PcmRlcigpIHsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLnNvcnQoKGEsIGIpID0+CiAgICAgICAgICBhLnNvdXJjZV9zdHJlYW1fb3JkZXIgPiBiLnNvdXJjZV9zdHJlYW1fb3JkZXIKICAgICAgICAgICAgPyAxCiAgICAgICAgICAgIDogYi5zb3VyY2Vfc3RyZWFtX29yZGVyID4gYS5zb3VyY2Vfc3RyZWFtX29yZGVyCiAgICAgICAgICAgID8gLTEKICAgICAgICAgICAgOiAwCiAgICAgICAgKTsKICAgICAgICByZXNvbHZlKCk7CiAgICAgIH0pOwogICAgfSwKICAgIHJlc3RvcmVHcm91cHMoKSB7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgIHRoaXMucmVzdG9yZUdyb3VwT3JkZXIoKS50aGVuKCgpID0+IHsKICAgICAgICAgIGxldCBncm91cDsKICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgZ3JvdXAgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXTsKICAgICAgICAgICAgZ3JvdXAubW9kaWZpZWQgPSBmYWxzZTsKICAgICAgICAgICAgZ3JvdXAuZ3JvdXBfaXNfcmVtb3ZlZCA9IDA7CiAgICAgICAgICAgIGdyb3VwLmdyb3VwX3R5cGUgPSBncm91cC5zb3VyY2VfZ3JvdXBfdHlwZTsKICAgICAgICAgICAgZ3JvdXAuZ3JvdXBfbmFtZSA9IGdyb3VwLnNvdXJjZV9ncm91cF9uYW1lOwogICAgICAgICAgICBncm91cC5wYXJlbnRfY29kZSA9IGdyb3VwLnNvdXJjZV9ncm91cF9wYXJlbnRfY29kZTsKICAgICAgICAgICAgZ3JvdXAuZ3JvdXBfaXNfaGlkZGVuID0gZ3JvdXAuc291cmNlX2dyb3VwX2lzX2hpZGRlbjsKICAgICAgICAgIH0KICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LAogICAgcmVzdG9yZVN0cmVhbXMoKSB7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgIHRoaXMucmVzdG9yZVN0cmVhbU9yZGVyKCkudGhlbigoKSA9PiB7CiAgICAgICAgICBsZXQgc3RyZWFtOwogICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgc3RyZWFtID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldOwogICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSBmYWxzZTsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV9pc19yZW1vdmVkID0gMDsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfbmFtZSA9IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX3R2Z19uYW1lOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19pZCA9IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX3R2Z19pZDsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfbG9nbyA9IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX3R2Z19sb2dvOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19jaG5vID0gc3RyZWFtLnNvdXJjZV9zdHJlYW1fdHZnX2Nobm87CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX3NoaWZ0ID0gc3RyZWFtLnNvdXJjZV9zdHJlYW1fdHZnX3NoaWZ0OwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3BhcmVudF9jb2RlID0gc3RyZWFtLnNvdXJjZV9zdHJlYW1fcGFyZW50X2NvZGU7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fYXVkaW9fdHJhY2sgPSBzdHJlYW0uc291cmNlX3N0cmVhbV9hdWRpb190cmFjazsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV9hc3BlY3RfcmF0aW8gPSBzdHJlYW0uc291cmNlX3N0cmVhbV9hc3BlY3RfcmF0aW87CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fcmFkaW8gPSBzdHJlYW0uc291cmNlX3N0cmVhbV9yYWRpbzsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV9vcmRlciA9IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX29yZGVyOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX2lzX2hpZGRlbiA9IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX2lzX2hpZGRlbjsKICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgIHN0cmVhbS5tb3ZpZV9uYW1lICE9PSB1bmRlZmluZWQgJiYKICAgICAgICAgICAgICBzdHJlYW0ubW92aWVfeWVhciAhPT0gdW5kZWZpbmVkCiAgICAgICAgICAgICkgewogICAgICAgICAgICAgIHN0cmVhbS5tb3ZpZV9uYW1lID0gc3RyZWFtLnNvdXJjZV9tb3ZpZV9uYW1lOwogICAgICAgICAgICAgIHN0cmVhbS5tb3ZpZV95ZWFyID0gc3RyZWFtLnNvdXJjZV9tb3ZpZV95ZWFyOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICBzdHJlYW0uc2VyaWVfbmFtZSAhPT0gdW5kZWZpbmVkICYmCiAgICAgICAgICAgICAgc3RyZWFtLnNlcmllX3NlYXNvbiAhPT0gdW5kZWZpbmVkICYmCiAgICAgICAgICAgICAgc3RyZWFtLnNlcmllX2VwaXNvZGUgIT09IHVuZGVmaW5lZAogICAgICAgICAgICApIHsKICAgICAgICAgICAgICBzdHJlYW0uc2VyaWVfbmFtZSA9IHN0cmVhbS5zb3VyY2Vfc2VyaWVfbmFtZTsKICAgICAgICAgICAgICBzdHJlYW0uc2VyaWVfc2Vhc29uID0gc3RyZWFtLnNvdXJjZV9zZXJpZV9zZWFzb247CiAgICAgICAgICAgICAgc3RyZWFtLnNlcmllX2VwaXNvZGUgPSBzdHJlYW0uc291cmNlX3NlcmllX2VwaXNvZGU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LAogICAgdG9nZ2xlR3JvdXBWaXNpYmlsaXR5KCkgewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBzLmluY2x1ZGVzKHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmlkKSkgewogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uZ3JvdXBfaXNfaGlkZGVuID0KICAgICAgICAgICAgIXRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmdyb3VwX2lzX2hpZGRlbjsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgIH0sCiAgICB0b2dnbGVTdHJlYW1WaXNpYmlsaXR5KCkgewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmICh0aGlzLmFjdGl2ZVN0cmVhbXMuaW5jbHVkZXModGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLmlkKSkgewogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLnN0cmVhbV9pc19oaWRkZW4gPQogICAgICAgICAgICAhdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLnN0cmVhbV9pc19oaWRkZW47CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgfSwKICAgIHRvZ2dsZVN0cmVhbVJhZGlvKCkgewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmICh0aGlzLmFjdGl2ZVN0cmVhbXMuaW5jbHVkZXModGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLmlkKSkgewogICAgICAgICAgaWYgKHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5zdHJlYW1fcmFkaW8gPT0gMCkgewogICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uc3RyZWFtX3JhZGlvID0gMTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5zdHJlYW1fcmFkaW8gPSAwOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgIH0sCiAgICBkZWxldGVTZWxlY3RlZEdyb3VwcygpIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3Vwcy5pbmNsdWRlcyh0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5pZCkpIHsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmdyb3VwX2lzX3JlbW92ZWQgPSAxOwogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgfSwKICAgIGRlbGV0ZVNlbGVjdGVkU3RyZWFtcygpIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAodGhpcy5hY3RpdmVTdHJlYW1zLmluY2x1ZGVzKHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5pZCkpIHsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5zdHJlYW1faXNfcmVtb3ZlZCA9IDE7CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgfSwKICAgIGxvYWRQbGF5bGlzdCh2YWwsIGdyb3VwX2luZGV4ID0gdW5kZWZpbmVkKSB7CiAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaWYgKHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCkgewogICAgICAgIHRoaXMuZG9TYXZlKCk7CiAgICAgIH0KICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5pZCA9IHZhbDsKICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAuZ2V0KGBlZGl0b3IvZ3JvdXBzLyR7dmFsfWApCiAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgaWYgKHJlcy5zdGF0dXMgPT09IHRydWUpIHsKICAgICAgICAgICAgdGhpcy51cGRhdGVHcm91cE9yZGVyKHJlcy5kYXRhKS50aGVuKChncm91cHMpID0+IHsKICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3VwcyA9IGdyb3Vwcy5tYXAoKGdyb3VwKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBncnAgPSBPYmplY3QuYXNzaWduKHt9LCBncm91cCk7CiAgICAgICAgICAgICAgICBncnAuc291cmNlX2dyb3VwX3BhcmVudF9jb2RlID0gZ3JvdXAuZ3JvdXBfcGFyZW50X2NvZGU7CiAgICAgICAgICAgICAgICBncnAuc291cmNlX2dyb3VwX2lzX2hpZGRlbiA9IGdyb3VwLmdyb3VwX2lzX2hpZGRlbjsKICAgICAgICAgICAgICAgIGdycC5zb3VyY2VfZ3JvdXBfbmFtZSA9IGdyb3VwLmdyb3VwX25hbWU7CiAgICAgICAgICAgICAgICBncnAuc291cmNlX2dyb3VwX3R5cGUgPSBncm91cC5ncm91cF90eXBlOwogICAgICAgICAgICAgICAgZ3JwLmdyb3VwX2lzX3JlbW92ZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIGdycC5tb2RpZmllZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgcmV0dXJuIGdycDsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBpZiAoZ3JvdXBzLmxlbmd0aCkgewogICAgICAgICAgICAgICAgaWYgKGdyb3VwX2luZGV4ID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5hY3RpdmVHcm91cCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzWzBdLmlkOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgdGhpcy5hY3RpdmVHcm91cCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2dyb3VwX2luZGV4XS5pZDsKICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkU3RyZWFtcygpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgfSk7CiAgICB9LAogICAgdG9nZ2xlR3JvdXBTZWxlY3Rpb24oaXRlbSkgewogICAgICBsZXQgaWR4ID0gdGhpcy5hY3RpdmVHcm91cHMuaW5kZXhPZihpdGVtKTsKICAgICAgaWYgKGlkeCAhPT0gLTEpIHsKICAgICAgICB0aGlzLmFjdGl2ZUdyb3Vwcy5zcGxpY2UoaWR4LCAxKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmFjdGl2ZUdyb3Vwcy5wdXNoKGl0ZW0pOwogICAgICB9CiAgICB9LAogICAgdG9nZ2xlU3RyZWFtU2VsZWN0aW9uKGl0ZW0pIHsKICAgICAgbGV0IGlkeCA9IHRoaXMuYWN0aXZlU3RyZWFtcy5pbmRleE9mKGl0ZW0pOwogICAgICBpZiAoaWR4ICE9PSAtMSkgewogICAgICAgIHRoaXMuYWN0aXZlU3RyZWFtcy5zcGxpY2UoaWR4LCAxKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmFjdGl2ZVN0cmVhbXMucHVzaChpdGVtKTsKICAgICAgfQogICAgfSwKICAgIHRvZ2dsZVJhZGlvYnJvd3NlclNlbGVjdGlvbihpdGVtKSB7CiAgICAgIGxldCBpZHggPSB0aGlzLnJhZGlvQnJvd3Nlci5hY3RpdmUuaW5kZXhPZihpdGVtKTsKICAgICAgaWYgKGlkeCAhPT0gLTEpIHsKICAgICAgICB0aGlzLnJhZGlvQnJvd3Nlci5hY3RpdmUuc3BsaWNlKGlkeCwgMSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuYWN0aXZlLnB1c2goaXRlbSk7CiAgICAgIH0KICAgIH0sCiAgICB0b2dnbGVJbXBvcnRNM1VTZWxlY3Rpb24oaXRlbSkgewogICAgICBsZXQgaWR4ID0gdGhpcy5pbXBvcnRNM1UuaW1wb3J0R3JvdXBzLmluZGV4T2YoaXRlbSk7CiAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgdGhpcy5pbXBvcnRNM1UuaW1wb3J0R3JvdXBzLnNwbGljZShpZHgsIDEpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuaW1wb3J0TTNVLmltcG9ydEdyb3Vwcy5wdXNoKGl0ZW0pOwogICAgICB9CiAgICB9LAogICAgaW5kZXhPZkdyb3VwKGdyb3VwKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5tYXAoKGcpID0+IGcuaWQpLmluZGV4T2YoZ3JvdXApOwogICAgfSwKICAgIHNlbGVjdEdyb3VwUmFuZ2VTZWxlY3Rpb24oaXRlbSkgewogICAgICBjb25zdCBsYXN0SW5kZXggPSB0aGlzLmluZGV4T2ZHcm91cCh0aGlzLmxhc3RTZWxlY3RlZEdyb3VwKTsKICAgICAgY29uc3QgaXRlbUluZGV4ID0gdGhpcy5pbmRleE9mR3JvdXAoaXRlbSk7CiAgICAgIGNvbnN0IGRpciA9IGl0ZW1JbmRleCA+IGxhc3RJbmRleCA/IDEgOiAtMTsKICAgICAgZm9yIChsZXQgaSA9IGxhc3RJbmRleDsgaSAhPSBpdGVtSW5kZXggKyBkaXI7IGkgKz0gZGlyKSB7CiAgICAgICAgaWYgKCF0aGlzLmFjdGl2ZUdyb3Vwcy5pbmNsdWRlcyh0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5pZCkpIHsKICAgICAgICAgIHRoaXMuYWN0aXZlR3JvdXBzLnB1c2godGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uaWQpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGluZGV4T2ZTdHJlYW0oc3RyZWFtKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubWFwKChnKSA9PiBnLmlkKS5pbmRleE9mKHN0cmVhbSk7CiAgICB9LAogICAgc2VsZWN0U3RyZWFtUmFuZ2VTZWxlY3Rpb24oaXRlbSkgewogICAgICBjb25zdCBsYXN0SW5kZXggPSB0aGlzLmluZGV4T2ZTdHJlYW0odGhpcy5sYXN0U2VsZWN0ZWRTdHJlYW0pOwogICAgICBjb25zdCBpdGVtSW5kZXggPSB0aGlzLmluZGV4T2ZTdHJlYW0oaXRlbSk7CiAgICAgIGNvbnN0IGRpciA9IGl0ZW1JbmRleCA+IGxhc3RJbmRleCA/IDEgOiAtMTsKICAgICAgZm9yIChsZXQgaSA9IGxhc3RJbmRleDsgaSAhPSBpdGVtSW5kZXggKyBkaXI7IGkgKz0gZGlyKSB7CiAgICAgICAgaWYgKCF0aGlzLmFjdGl2ZVN0cmVhbXMuaW5jbHVkZXModGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLmlkKSkgewogICAgICAgICAgdGhpcy5hY3RpdmVTdHJlYW1zLnB1c2godGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLmlkKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBzZWxlY3RSYWRpb2Jyb3dzZXJSYW5nZVNlbGVjdGlvbihpbmRleCkgewogICAgICBjb25zdCBsYXN0SW5kZXggPQogICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZVt0aGlzLnJhZGlvQnJvd3Nlci5hY3RpdmUubGVuZ3RoIC0gMV07CiAgICAgIGNvbnN0IGRpciA9IGluZGV4ID4gbGFzdEluZGV4ID8gMSA6IC0xOwogICAgICBmb3IgKGxldCBpID0gbGFzdEluZGV4OyBpICE9IGluZGV4ICsgZGlyOyBpICs9IGRpcikgewogICAgICAgIGlmICghdGhpcy5yYWRpb0Jyb3dzZXIuYWN0aXZlLmluY2x1ZGVzKGkpKSB7CiAgICAgICAgICB0aGlzLnJhZGlvQnJvd3Nlci5hY3RpdmUucHVzaChpKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBzZWxlY3RJbXBvcnRNM1VSYW5nZVNlbGVjdGlvbihpbmRleCkgewogICAgICBjb25zdCBsYXN0SW5kZXggPQogICAgICAgIHRoaXMuaW1wb3J0TTNVLmltcG9ydEdyb3Vwc1t0aGlzLmltcG9ydE0zVS5pbXBvcnRHcm91cHMubGVuZ3RoIC0gMV07CiAgICAgIGNvbnN0IGRpciA9IGluZGV4ID4gbGFzdEluZGV4ID8gMSA6IC0xOwogICAgICBmb3IgKGxldCBpID0gbGFzdEluZGV4OyBpICE9IGluZGV4ICsgZGlyOyBpICs9IGRpcikgewogICAgICAgIGlmICghdGhpcy5pbXBvcnRNM1UuaW1wb3J0R3JvdXBzLmluY2x1ZGVzKGkpKSB7CiAgICAgICAgICB0aGlzLmltcG9ydE0zVS5pbXBvcnRHcm91cHMucHVzaChpKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBzZWxlY3RHcm91cFNlbGVjdGlvbihpdGVtKSB7CiAgICAgIHRoaXMuYWN0aXZlR3JvdXBzLmxlbmd0aCA9IDA7CiAgICAgIHRoaXMuYWN0aXZlR3JvdXBzLnB1c2goaXRlbSk7CiAgICB9LAogICAgc2VsZWN0U3RyZWFtU2VsZWN0aW9uKGl0ZW0pIHsKICAgICAgdGhpcy5hY3RpdmVTdHJlYW1zLmxlbmd0aCA9IDA7CiAgICAgIHRoaXMuYWN0aXZlU3RyZWFtcy5wdXNoKGl0ZW0pOwogICAgfSwKICAgIHNlbGVjdFJhZGlvYnJvd3NlclNlbGVjdGlvbihpdGVtKSB7CiAgICAgIHRoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZS5sZW5ndGggPSAwOwogICAgICB0aGlzLnJhZGlvQnJvd3Nlci5hY3RpdmUucHVzaChpdGVtKTsKICAgIH0sCiAgICBzZWxlY3RJbXBvcnRNM1VTZWxlY3Rpb24oaXRlbSkgewogICAgICB0aGlzLmltcG9ydE0zVS5pbXBvcnRHcm91cHMubGVuZ3RoID0gMDsKICAgICAgdGhpcy5pbXBvcnRNM1UuaW1wb3J0R3JvdXBzLnB1c2goaXRlbSk7CiAgICB9LAogICAgZmluZEFuZFJlcGxhY2VNb2RhbChzaG93LCB0eXBlID0gMSkgewogICAgICB0aGlzLmZpbmRSZXBsYWNlLnR5cGUgPSB0eXBlOwogICAgICB0aGlzLmZpbmRSZXBsYWNlLm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBmaW5kQW5kUmVwbGFjZSgpIHsKICAgICAgbGV0IG9wdGlvbnMgPSAiIjsKICAgICAgaWYgKHRoaXMuZmluZFJlcGxhY2UucmVwbGFjZUFsbCkgewogICAgICAgIG9wdGlvbnMgKz0gImciOwogICAgICB9CiAgICAgIGlmICh0aGlzLmZpbmRSZXBsYWNlLmlnbm9yZUNhc2UpIHsKICAgICAgICBvcHRpb25zICs9ICJpIjsKICAgICAgfQogICAgICBsZXQgcmUgPSBuZXcgUmVnRXhwKHRoaXMuZmluZFJlcGxhY2UuZnJvbS5yZXBsYWNlKCJ8IiwgIlxcfCIpLCBvcHRpb25zKTsKICAgICAgc3dpdGNoIChwYXJzZUludCh0aGlzLmZpbmRSZXBsYWNlLnR5cGUpKSB7CiAgICAgICAgLy8gR3JvdXAKICAgICAgICBjYXNlIDE6CiAgICAgICAgICBpZiAocGFyc2VJbnQodGhpcy5maW5kUmVwbGFjZS5zZWxlY3RlZE9ubHkpID09PSAxKSB7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZUdyb3Vwcy5pbmNsdWRlcyh0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5pZCkKICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmdyb3VwX25hbWUgPQogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5ncm91cF9uYW1lLnJlcGxhY2UoCiAgICAgICAgICAgICAgICAgICAgcmUsCiAgICAgICAgICAgICAgICAgICAgdGhpcy5maW5kUmVwbGFjZS50bwogICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5maWx0ZXJlZEdyb3Vwcy5tYXAoKGdyb3VwKSA9PiB7CiAgICAgICAgICAgICAgZ3JvdXAubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgIGdyb3VwLmdyb3VwX25hbWUgPSBncm91cC5ncm91cF9uYW1lLnJlcGxhY2UoCiAgICAgICAgICAgICAgICByZSwKICAgICAgICAgICAgICAgIHRoaXMuZmluZFJlcGxhY2UudG8KICAgICAgICAgICAgICApOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwoKICAgICAgICAvLyBTdHJlYW1zCiAgICAgICAgY2FzZSAyOgogICAgICAgICAgaWYgKHBhcnNlSW50KHRoaXMuZmluZFJlcGxhY2Uuc2VsZWN0ZWRPbmx5KSA9PT0gMSkgewogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlU3RyZWFtcy5pbmNsdWRlcyh0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uaWQpCiAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDEpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLnN0cmVhbV90dmdfbmFtZSA9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLnN0cmVhbV90dmdfbmFtZS5yZXBsYWNlKAogICAgICAgICAgICAgICAgICAgICAgcmUsCiAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZpbmRSZXBsYWNlLnRvCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMikgewogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0ubW92aWVfbmFtZSA9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLm1vdmllX25hbWUucmVwbGFjZSgKICAgICAgICAgICAgICAgICAgICAgIHJlLAogICAgICAgICAgICAgICAgICAgICAgdGhpcy5maW5kUmVwbGFjZS50bwogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDMpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLnNlcmllX25hbWUgPQogICAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5zZXJpZV9uYW1lLnJlcGxhY2UoCiAgICAgICAgICAgICAgICAgICAgICByZSwKICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmluZFJlcGxhY2UudG8KICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5maWx0ZXJlZFN0cmVhbXMubWFwKChzdHJlYW0pID0+IHsKICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDEpIHsKICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lID0gc3RyZWFtLnN0cmVhbV90dmdfbmFtZS5yZXBsYWNlKAogICAgICAgICAgICAgICAgICByZSwKICAgICAgICAgICAgICAgICAgdGhpcy5maW5kUmVwbGFjZS50bwogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAyKSB7CiAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgc3RyZWFtLm1vdmllX25hbWUgPSBzdHJlYW0ubW92aWVfbmFtZS5yZXBsYWNlKAogICAgICAgICAgICAgICAgICByZSwKICAgICAgICAgICAgICAgICAgdGhpcy5maW5kUmVwbGFjZS50bwogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAzKSB7CiAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgc3RyZWFtLnNlcmllX25hbWUgPSBzdHJlYW0uc2VyaWVfbmFtZS5yZXBsYWNlKAogICAgICAgICAgICAgICAgICByZSwKICAgICAgICAgICAgICAgICAgdGhpcy5maW5kUmVwbGFjZS50bwogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgICAgdGhpcy5maW5kUmVwbGFjZS5tb2RhbCA9IGZhbHNlOwogICAgfSwKICAgIHByZWZpeFN1ZmZpeE1vZGFsKHNob3csIHR5cGUgPSAxKSB7CiAgICAgIHRoaXMucHJlZml4U3VmZml4LnR5cGUgPSB0eXBlOwogICAgICB0aGlzLnByZWZpeFN1ZmZpeC5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgYWRkUHJlZml4U3VmZml4KCkgewogICAgICBsZXQgcHJlZml4ID0gdGhpcy5wcmVmaXhTdWZmaXgucHJlZml4OwogICAgICBsZXQgc3VmZml4ID0gdGhpcy5wcmVmaXhTdWZmaXguc3VmZml4OwogICAgICBzd2l0Y2ggKHBhcnNlSW50KHRoaXMucHJlZml4U3VmZml4LnR5cGUpKSB7CiAgICAgICAgLy8gR3JvdXAKICAgICAgICBjYXNlIDE6CiAgICAgICAgICBpZiAocGFyc2VJbnQodGhpcy5wcmVmaXhTdWZmaXguc2VsZWN0ZWRPbmx5KSA9PT0gMSkgewogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgdGhpcy5hY3RpdmVHcm91cHMuaW5jbHVkZXModGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uaWQpCiAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5ncm91cF9uYW1lID0KICAgICAgICAgICAgICAgICAgcHJlZml4ICsgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uZ3JvdXBfbmFtZSArIHN1ZmZpeDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuZmlsdGVyZWRHcm91cHMubWFwKChncm91cCkgPT4gewogICAgICAgICAgICAgIGdyb3VwLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICBncm91cC5ncm91cF9uYW1lID0gcHJlZml4ICsgZ3JvdXAuZ3JvdXBfbmFtZSArIHN1ZmZpeDsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKCiAgICAgICAgLy8gU3RyZWFtCiAgICAgICAgY2FzZSAyOgogICAgICAgICAgaWYgKHBhcnNlSW50KHRoaXMucHJlZml4U3VmZml4LnNlbGVjdGVkT25seSkgPT09IDEpIHsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZVN0cmVhbXMuaW5jbHVkZXModGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLmlkKQogICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAxKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5zdHJlYW1fdHZnX25hbWUgPQogICAgICAgICAgICAgICAgICAgIHByZWZpeCArCiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLnN0cmVhbV90dmdfbmFtZSArCiAgICAgICAgICAgICAgICAgICAgc3VmZml4OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5tb3ZpZV9uYW1lID0KICAgICAgICAgICAgICAgICAgICBwcmVmaXggKyB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0ubW92aWVfbmFtZSArIHN1ZmZpeDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMykgewogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uc2VyaWVfbmFtZSA9CiAgICAgICAgICAgICAgICAgICAgcHJlZml4ICsgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLnNlcmllX25hbWUgKyBzdWZmaXg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDEpIHsKICAgICAgICAgICAgICB0aGlzLmZpbHRlcmVkU3RyZWFtcy5tYXAoKHN0cmVhbSkgPT4gewogICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX25hbWUgPQogICAgICAgICAgICAgICAgICBwcmVmaXggKyBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lICsgc3VmZml4OwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMikgewogICAgICAgICAgICAgIHRoaXMuZmlsdGVyZWRTdHJlYW1zLm1hcCgoc3RyZWFtKSA9PiB7CiAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgc3RyZWFtLm1vdmllX25hbWUgPSBwcmVmaXggKyBzdHJlYW0ubW92aWVfbmFtZSArIHN1ZmZpeDsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDMpIHsKICAgICAgICAgICAgICB0aGlzLmZpbHRlcmVkU3RyZWFtcy5tYXAoKHN0cmVhbSkgPT4gewogICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHN0cmVhbS5zZXJpZV9uYW1lID0gcHJlZml4ICsgc3RyZWFtLnNlcmllX25hbWUgKyBzdWZmaXg7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICAgIHRoaXMucHJlZml4U3VmZml4Lm1vZGFsID0gZmFsc2U7CiAgICB9LAogICAgY29udmVydENhc2VNb2RhbChzaG93LCB0eXBlKSB7CiAgICAgIHRoaXMuY29udmVydENhc2UudHlwZSA9IHR5cGU7CiAgICAgIHRoaXMuY29udmVydENhc2UubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGNoYW5nZUNhc2UoKSB7CiAgICAgIGxldCBtZXRob2QgPSB0aGlzLmNvbnZlcnRDYXNlLm1ldGhvZDsKICAgICAgbGV0IGdyb3VwczsKICAgICAgbGV0IHN0cmVhbXM7CiAgICAgIGlmIChwYXJzZUludCh0aGlzLmNvbnZlcnRDYXNlLnNlbGVjdGVkT25seSkgPT09IDEpIHsKICAgICAgICBncm91cHMgPSB0aGlzLmZpbHRlcmVkR3JvdXBzLmZpbHRlcigoZ3JvdXApID0+IHsKICAgICAgICAgIHJldHVybiB0aGlzLmFjdGl2ZUdyb3Vwcy5pbmNsdWRlcyhncm91cC5pZCk7CiAgICAgICAgfSk7CiAgICAgICAgc3RyZWFtcyA9IHRoaXMuZmlsdGVyZWRTdHJlYW1zLmZpbHRlcigoc3RyZWFtKSA9PiB7CiAgICAgICAgICByZXR1cm4gdGhpcy5hY3RpdmVTdHJlYW1zLmluY2x1ZGVzKHN0cmVhbS5pZCk7CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZ3JvdXBzID0gdGhpcy5maWx0ZXJlZEdyb3VwczsKICAgICAgICBzdHJlYW1zID0gdGhpcy5maWx0ZXJlZFN0cmVhbXM7CiAgICAgIH0KICAgICAgc3dpdGNoIChwYXJzZUludCh0aGlzLmNvbnZlcnRDYXNlLnR5cGUpKSB7CiAgICAgICAgLy8gQ2F0ZWdvcmllcwogICAgICAgIGNhc2UgMToKICAgICAgICAgIGdyb3Vwcy5tYXAoKGdyb3VwKSA9PiB7CiAgICAgICAgICAgIHN3aXRjaCAocGFyc2VJbnQobWV0aG9kKSkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGdyb3VwLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGdyb3VwLmdyb3VwX25hbWUgPSBncm91cC5ncm91cF9uYW1lLnRpdGxlQ2FzZSgpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgZ3JvdXAubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgZ3JvdXAuZ3JvdXBfbmFtZSA9IGdyb3VwLmdyb3VwX25hbWUudG9VcHBlckNhc2UoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIGdyb3VwLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGdyb3VwLmdyb3VwX25hbWUgPSBncm91cC5ncm91cF9uYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgLy8gU3RyZWFtcwogICAgICAgIGNhc2UgMjoKICAgICAgICAgIHN0cmVhbXMubWFwKChzdHJlYW0pID0+IHsKICAgICAgICAgICAgc3dpdGNoIChwYXJzZUludChtZXRob2QpKSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAxKSB7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX25hbWUgPSBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lLnRpdGxlQ2FzZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5tb3ZpZV9uYW1lID0gc3RyZWFtLm1vdmllX25hbWUudGl0bGVDYXNlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDMpIHsKICAgICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgc3RyZWFtLnNlcmllX25hbWUgPSBzdHJlYW0uc2VyaWVfbmFtZS50aXRsZUNhc2UoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMSkgewogICAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lID0gc3RyZWFtLnN0cmVhbV90dmdfbmFtZS50b1VwcGVyQ2FzZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5tb3ZpZV9uYW1lID0gc3RyZWFtLm1vdmllX25hbWUudG9VcHBlckNhc2UoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMykgewogICAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICBzdHJlYW0uc2VyaWVfbmFtZSA9IHN0cmVhbS5zZXJpZV9uYW1lLnRvVXBwZXJDYXNlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDEpIHsKICAgICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfbmFtZSA9IHN0cmVhbS5zdHJlYW1fdHZnX25hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMikgewogICAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICBzdHJlYW0ubW92aWVfbmFtZSA9IHN0cmVhbS5tb3ZpZV9uYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDMpIHsKICAgICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgc3RyZWFtLnNlcmllX25hbWUgPSBzdHJlYW0uc2VyaWVfbmFtZS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgICAgdGhpcy5jb252ZXJ0Q2FzZS5tb2RhbCA9IGZhbHNlOwogICAgfSwKICAgIGVkaXRHcm91cE1vZGFsKHNob3cpIHsKICAgICAgbGV0IGluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KAogICAgICAgIChncm91cCkgPT4gZ3JvdXAuaWQgPT09IHRoaXMuYWN0aXZlR3JvdXBzWzBdCiAgICAgICk7CiAgICAgIGxldCBncm91cCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2luZGV4XTsKICAgICAgaWYgKGdyb3VwKSB7CiAgICAgICAgdGhpcy5ncm91cEVkaXRvci5pZCA9IHRoaXMuYWN0aXZlR3JvdXBzWzBdOwogICAgICAgIHRoaXMuZ3JvdXBFZGl0b3IuZ3JvdXBfdHlwZSA9IGdyb3VwLmdyb3VwX3R5cGU7CiAgICAgICAgdGhpcy5ncm91cEVkaXRvci5ncm91cF9uYW1lID0gZ3JvdXAuZ3JvdXBfbmFtZTsKICAgICAgICB0aGlzLmdyb3VwRWRpdG9yLmdyb3VwX2lzX2hpZGRlbiA9IGdyb3VwLmdyb3VwX2lzX2hpZGRlbjsKICAgICAgICB0aGlzLmdyb3VwRWRpdG9yLmdyb3VwX3BhcmVudF9jb2RlID0gZ3JvdXAuZ3JvdXBfcGFyZW50X2NvZGU7CiAgICAgICAgdGhpcy5ncm91cEVkaXRvci5tb2RhbCA9IHNob3c7CiAgICAgIH0KICAgIH0sCiAgICBlZGl0U3RyZWFtTW9kYWwoc2hvdykgewogICAgICBsZXQgaW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMuZmluZEluZGV4KAogICAgICAgIChzdHJlYW0pID0+IHN0cmVhbS5pZCA9PT0gdGhpcy5hY3RpdmVTdHJlYW1zWzBdCiAgICAgICk7CiAgICAgIGxldCBzdHJlYW0gPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdOwogICAgICBpZiAoc3RyZWFtKSB7CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3IuaWQgPSB0aGlzLmFjdGl2ZVN0cmVhbXNbMF07CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX3R2Z19uYW1lID0gc3RyZWFtLnN0cmVhbV90dmdfbmFtZTsKICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1fdHZnX2lkID0gc3RyZWFtLnN0cmVhbV90dmdfaWQ7CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX3R2Z19sb2dvID0gc3RyZWFtLnN0cmVhbV90dmdfbG9nbzsKICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1fdHZnX2Nobm8gPSBzdHJlYW0uc3RyZWFtX3R2Z19jaG5vOwogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV90dmdfc2hpZnQgPSBzdHJlYW0uc3RyZWFtX3R2Z19zaGlmdDsKICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1fcGFyZW50X2NvZGUgPSBzdHJlYW0uc3RyZWFtX3BhcmVudF9jb2RlOwogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV9hdWRpb190cmFjayA9IHN0cmVhbS5zdHJlYW1fYXVkaW9fdHJhY2s7CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX2FzcGVjdF9yYXRpbyA9IHN0cmVhbS5zdHJlYW1fYXNwZWN0X3JhdGlvOwogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV9yYWRpbyA9IHN0cmVhbS5zdHJlYW1fcmFkaW87CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX2lzX2hpZGRlbiA9IHN0cmVhbS5zdHJlYW1faXNfaGlkZGVuOwogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnNvdXJjZV9zdHJlYW1fdXJsID0gc3RyZWFtLnNvdXJjZV9zdHJlYW1fdXJsOwogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV9pc19jdXN0b20gPSBzdHJlYW0uc3RyZWFtX2lzX2N1c3RvbTsKICAgICAgICBpZiAoCiAgICAgICAgICBzdHJlYW0ubW92aWVfbmFtZSAhPT0gdW5kZWZpbmVkICYmCiAgICAgICAgICBzdHJlYW0ubW92aWVfeWVhciAhPT0gdW5kZWZpbmVkICYmCiAgICAgICAgICBzdHJlYW0udG1kYl9pZCAhPT0gdW5kZWZpbmVkCiAgICAgICAgKSB7CiAgICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5tb3ZpZV9uYW1lID0gc3RyZWFtLm1vdmllX25hbWU7CiAgICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5tb3ZpZV95ZWFyID0gc3RyZWFtLm1vdmllX3llYXI7CiAgICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci50bWRiX2lkID0gc3RyZWFtLnRtZGJfaWQ7CiAgICAgICAgfQogICAgICAgIGlmICgKICAgICAgICAgIHN0cmVhbS5zZXJpZV9uYW1lICE9PSB1bmRlZmluZWQgJiYKICAgICAgICAgIHN0cmVhbS5zZXJpZV9zZWFzb24gIT09IHVuZGVmaW5lZCAmJgogICAgICAgICAgc3RyZWFtLnNlcmllX2VwaXNvZGUgIT09IHVuZGVmaW5lZAogICAgICAgICkgewogICAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc2VyaWVfbmFtZSA9IHN0cmVhbS5zZXJpZV9uYW1lOwogICAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc2VyaWVfc2Vhc29uID0gc3RyZWFtLnNlcmllX3NlYXNvbjsKICAgICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnNlcmllX2VwaXNvZGUgPSBzdHJlYW0uc2VyaWVfZXBpc29kZTsKICAgICAgICB9CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3IubW9kYWwgPSBzaG93OwogICAgICB9CiAgICB9LAogICAgZWRpdEdyb3VwKCkgewogICAgICBsZXQgaW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoCiAgICAgICAgKGdyb3VwKSA9PiBncm91cC5pZCA9PT0gdGhpcy5ncm91cEVkaXRvci5pZAogICAgICApOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpbmRleF0uZ3JvdXBfdHlwZSA9CiAgICAgICAgdGhpcy5ncm91cEVkaXRvci5ncm91cF90eXBlOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpbmRleF0uZ3JvdXBfbmFtZSA9CiAgICAgICAgdGhpcy5ncm91cEVkaXRvci5ncm91cF9uYW1lOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpbmRleF0uZ3JvdXBfaXNfaGlkZGVuID0KICAgICAgICB0aGlzLmdyb3VwRWRpdG9yLmdyb3VwX2lzX2hpZGRlbjsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaW5kZXhdLmdyb3VwX3BhcmVudF9jb2RlID0KICAgICAgICB0aGlzLmdyb3VwRWRpdG9yLmdyb3VwX3BhcmVudF9jb2RlOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpbmRleF0ubW9kaWZpZWQgPSB0cnVlOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgICB0aGlzLmdyb3VwRWRpdG9yLm1vZGFsID0gZmFsc2U7CiAgICB9LAogICAgZWRpdFN0cmVhbSgpIHsKICAgICAgbGV0IGluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmZpbmRJbmRleCgKICAgICAgICAoc3RyZWFtKSA9PiBzdHJlYW0uaWQgPT09IHRoaXMuYWN0aXZlU3RyZWFtc1swXQogICAgICApOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnN0cmVhbV90dmdfbmFtZSA9CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX3R2Z19uYW1lOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnN0cmVhbV90dmdfaWQgPQogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV90dmdfaWQ7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc3RyZWFtX3R2Z19sb2dvID0KICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1fdHZnX2xvZ287CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc3RyZWFtX3R2Z19jaG5vID0KICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1fdHZnX2Nobm87CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc3RyZWFtX3R2Z19zaGlmdCA9CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX3R2Z19zaGlmdDsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zdHJlYW1fcGFyZW50X2NvZGUgPQogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV9wYXJlbnRfY29kZTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zdHJlYW1fYXVkaW9fdHJhY2sgPQogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV9hdWRpb190cmFjazsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zdHJlYW1fYXNwZWN0X3JhdGlvID0KICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1fYXNwZWN0X3JhdGlvOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnN0cmVhbV9pc19oaWRkZW4gPQogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV9pc19oaWRkZW47CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc3RyZWFtX3JhZGlvID0KICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1fcmFkaW87CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc291cmNlX3N0cmVhbV91cmwgPQogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnNvdXJjZV9zdHJlYW1fdXJsOwogICAgICBpZiAoCiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5tb3ZpZV9uYW1lICE9PSB1bmRlZmluZWQgJiYKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLm1vdmllX3llYXIgIT09IHVuZGVmaW5lZCAmJgogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0udG1kYl9pZCAhPT0gdW5kZWZpbmVkCiAgICAgICkgewogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0ubW92aWVfbmFtZSA9CiAgICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5tb3ZpZV9uYW1lOwogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0ubW92aWVfeWVhciA9CiAgICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5tb3ZpZV95ZWFyOwogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0udG1kYl9pZCA9IHRoaXMuc3RyZWFtRWRpdG9yLnRtZGJfaWQ7CiAgICAgIH0KICAgICAgaWYgKAogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc2VyaWVfbmFtZSAhPT0gdW5kZWZpbmVkICYmCiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zZXJpZV9zZWFzb24gIT09IHVuZGVmaW5lZCAmJgogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc2VyaWVfZXBpc29kZSAhPT0gdW5kZWZpbmVkCiAgICAgICkgewogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc2VyaWVfbmFtZSA9CiAgICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zZXJpZV9uYW1lOwogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc2VyaWVfc2Vhc29uID0KICAgICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnNlcmllX3NlYXNvbjsKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnNlcmllX2VwaXNvZGUgPQogICAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc2VyaWVfZXBpc29kZTsKICAgICAgfQogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgICAgdGhpcy5zdHJlYW1FZGl0b3IubW9kYWwgPSBmYWxzZTsKICAgIH0sCiAgICBzb3J0R3JvdXBBbHBoYVVwKCkgewogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3VwcyA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLnNvcnQoKGEsIGIpID0+CiAgICAgICAgYi5ncm91cF9uYW1lID4gYS5ncm91cF9uYW1lID8gMSA6IGEuZ3JvdXBfbmFtZSA+IGIuZ3JvdXBfbmFtZSA/IC0xIDogMAogICAgICApOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5tYXAoKGdyb3VwKSA9PiAoZ3JvdXAubW9kaWZpZWQgPSB0cnVlKSk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICB9LAogICAgc29ydEdyb3VwQWxwaGFEb3duKCkgewogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3VwcyA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLnNvcnQoKGEsIGIpID0+CiAgICAgICAgYS5ncm91cF9uYW1lID4gYi5ncm91cF9uYW1lID8gMSA6IGIuZ3JvdXBfbmFtZSA+IGEuZ3JvdXBfbmFtZSA/IC0xIDogMAogICAgICApOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5tYXAoKGdyb3VwKSA9PiAoZ3JvdXAubW9kaWZpZWQgPSB0cnVlKSk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICB9LAogICAgc29ydEdyb3VwVHlwZVVwKCkgewogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3VwcyA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLnNvcnQoKGEsIGIpID0+CiAgICAgICAgYi5ncm91cF90eXBlID4gYS5ncm91cF90eXBlID8gMSA6IGEuZ3JvdXBfdHlwZSA+IGIuZ3JvdXBfdHlwZSA/IC0xIDogMAogICAgICApOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5tYXAoKGdyb3VwKSA9PiAoZ3JvdXAubW9kaWZpZWQgPSB0cnVlKSk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICB9LAogICAgc29ydEdyb3VwVHlwZURvd24oKSB7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuc29ydCgoYSwgYikgPT4KICAgICAgICBhLmdyb3VwX3R5cGUgPiBiLmdyb3VwX3R5cGUgPyAxIDogYi5ncm91cF90eXBlID4gYS5ncm91cF90eXBlID8gLTEgOiAwCiAgICAgICk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLm1hcCgoZ3JvdXApID0+IChncm91cC5tb2RpZmllZCA9IHRydWUpKTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgIH0sCiAgICBzb3J0U3RyZWFtQWxwaGFVcCgpIHsKICAgICAgLy9FUk5TVCBISUVSCiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcyA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5zb3J0KChhLCBiKSA9PiB7CiAgICAgICAgc3dpdGNoICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSkgewogICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICByZXR1cm4gYi5zdHJlYW1fdHZnX25hbWUgPiBhLnN0cmVhbV90dmdfbmFtZQogICAgICAgICAgICAgID8gMQogICAgICAgICAgICAgIDogYS5zdHJlYW1fdHZnX25hbWUgPiBiLnN0cmVhbV90dmdfbmFtZQogICAgICAgICAgICAgID8gLTEKICAgICAgICAgICAgICA6IDA7CiAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgIHJldHVybiBiLm1vdmllX25hbWUgPiBhLm1vdmllX25hbWUKICAgICAgICAgICAgICA/IDEKICAgICAgICAgICAgICA6IGEubW92aWVfbmFtZSA+IGIubW92aWVfbmFtZQogICAgICAgICAgICAgID8gLTEKICAgICAgICAgICAgICA6IDA7CiAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgIHJldHVybiBiLnNlcmllX25hbWUgPiBhLnNlcmllX25hbWUKICAgICAgICAgICAgICA/IDEKICAgICAgICAgICAgICA6IGEuc2VyaWVfbmFtZSA+IGIuc2VyaWVfbmFtZQogICAgICAgICAgICAgID8gLTEKICAgICAgICAgICAgICA6IDA7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLm1hcCgoc3RyZWFtKSA9PiAoc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZSkpOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgfSwKICAgIHNvcnRTdHJlYW1BbHBoYURvd24oKSB7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcyA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5zb3J0KChhLCBiKSA9PiB7CiAgICAgICAgc3dpdGNoICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSkgewogICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICByZXR1cm4gYS5zdHJlYW1fdHZnX25hbWUgPiBiLnN0cmVhbV90dmdfbmFtZQogICAgICAgICAgICAgID8gMQogICAgICAgICAgICAgIDogYi5zdHJlYW1fdHZnX25hbWUgPiBhLnN0cmVhbV90dmdfbmFtZQogICAgICAgICAgICAgID8gLTEKICAgICAgICAgICAgICA6IDA7CiAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgIHJldHVybiBhLm1vdmllX25hbWUgPiBiLm1vdmllX25hbWUKICAgICAgICAgICAgICA/IDEKICAgICAgICAgICAgICA6IGIubW92aWVfbmFtZSA+IGEubW92aWVfbmFtZQogICAgICAgICAgICAgID8gLTEKICAgICAgICAgICAgICA6IDA7CiAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgIHJldHVybiBhLnNlcmllX25hbWUgPiBiLnNlcmllX25hbWUKICAgICAgICAgICAgICA/IDEKICAgICAgICAgICAgICA6IGIuc2VyaWVfbmFtZSA+IGEuc2VyaWVfbmFtZQogICAgICAgICAgICAgID8gLTEKICAgICAgICAgICAgICA6IDA7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLm1hcCgoc3RyZWFtKSA9PiAoc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZSkpOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgfSwKICAgIHNvcnRTdHJlYW1IaWRkZW5VcCgpIHsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLnNvcnQoKGEsIGIpID0+CiAgICAgICAgYi5zdHJlYW1faXNfaGlkZGVuID4gYS5zdHJlYW1faXNfaGlkZGVuCiAgICAgICAgICA/IDEKICAgICAgICAgIDogYS5zdHJlYW1faXNfaGlkZGVuID4gYi5zdHJlYW1faXNfaGlkZGVuCiAgICAgICAgICA/IC0xCiAgICAgICAgICA6IDAKICAgICAgKTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLm1hcCgoZ3JvdXApID0+IChncm91cC5tb2RpZmllZCA9IHRydWUpKTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgIH0sCiAgICBzb3J0U3RyZWFtSGlkZGVuRG93bigpIHsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLnNvcnQoKGEsIGIpID0+CiAgICAgICAgYS5zdHJlYW1faXNfaGlkZGVuID4gYi5zdHJlYW1faXNfaGlkZGVuCiAgICAgICAgICA/IDEKICAgICAgICAgIDogYi5zdHJlYW1faXNfaGlkZGVuID4gYS5zdHJlYW1faXNfaGlkZGVuCiAgICAgICAgICA/IC0xCiAgICAgICAgICA6IDAKICAgICAgKTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLm1hcCgoZ3JvdXApID0+IChncm91cC5tb2RpZmllZCA9IHRydWUpKTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgIH0sCiAgICBhZGRHcm91cCgpIHsKICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZQogICAgICAgIC5wb3N0KCJlZGl0b3IvYWRkLWdyb3VwIiwgeyBwbGF5bGlzdF9pZDogdGhpcy5wbGF5bGlzdEVkaXRvci5pZCB9KQogICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICBpZiAocmVzLnN0YXR1cyA9PT0gdHJ1ZSAmJiByZXMuZGF0YSkgewogICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5wdXNoKHJlcy5kYXRhKTsKICAgICAgICAgICAgICB0aGlzLmFjdGl2ZUdyb3VwID0KICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzWwogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5sZW5ndGggLSAxCiAgICAgICAgICAgICAgICBdLmlkOwogICAgICAgICAgICAgIHRoaXMuYWN0aXZlR3JvdXBzID0gWwogICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbCiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmxlbmd0aCAtIDEKICAgICAgICAgICAgICAgIF0uaWQsCiAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgICByZXNvbHZlKCk7CiAgICAgICAgICAgIH0pLnRoZW4oKCkgPT4gewogICAgICAgICAgICAgIHRoaXMuZWRpdEdyb3VwTW9kYWwodHJ1ZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB0aGlzLiRub3RpZnkoCiAgICAgICAgICAgICJlcnJvciIsCiAgICAgICAgICAgIHRoaXMuJHQoInByb2ZpbGUuZmFpbGVkIiksCiAgICAgICAgICAgIHRoaXMuJHQoImVkaXRvci5hZGQtZ3JvdXAtZXJyb3IiKSwKICAgICAgICAgICAgImxhLXVzZXItc2hpZWxkIiwKICAgICAgICAgICAgeyBkdXJhdGlvbjogNTAwMCwgcGVybWFuZW50OiBmYWxzZSB9CiAgICAgICAgICApOwogICAgICAgIH0pOwogICAgfSwKICAgIGFkZFN0cmVhbSgpIHsKICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZQogICAgICAgIC5wb3N0KCJlZGl0b3IvYWRkLXN0cmVhbSIsIHsKICAgICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgZ3JvdXBfaWQ6IHRoaXMuZ2V0R3JvdXBXaXRoSWQodGhpcy5hY3RpdmVHcm91cCkuaWQsCiAgICAgICAgICBzdHJlYW1fdHlwZTogdGhpcy5nZXRHcm91cFdpdGhJZCh0aGlzLmFjdGl2ZUdyb3VwKS5ncm91cF90eXBlLAogICAgICAgIH0pCiAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIGlmIChyZXMuc3RhdHVzID09PSB0cnVlICYmIHJlcy5kYXRhKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy51bnNoaWZ0KHJlcy5kYXRhKTsKICAgICAgICAgICAgICB0aGlzLmFjdGl2ZVN0cmVhbSA9CiAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbCiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGggLSAxCiAgICAgICAgICAgICAgICBdLmlkOwogICAgICAgICAgICAgIHRoaXMuYWN0aXZlU3RyZWFtcyA9IFsKICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1sKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aCAtIDEKICAgICAgICAgICAgICAgIF0uaWQsCiAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgICByZXNvbHZlKCk7CiAgICAgICAgICAgIH0pLnRoZW4oKCkgPT4gewogICAgICAgICAgICAgIHRoaXMuZWRpdFN0cmVhbU1vZGFsKHRydWUpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgdGhpcy4kbm90aWZ5KAogICAgICAgICAgICAiZXJyb3IiLAogICAgICAgICAgICB0aGlzLiR0KCJwcm9maWxlLmZhaWxlZCIpLAogICAgICAgICAgICB0aGlzLiR0KCJlZGl0b3IuYWRkLXN0cmVhbS1lcnJvciIpLAogICAgICAgICAgICAibGEtdXNlci1zaGllbGQiLAogICAgICAgICAgICB7IGR1cmF0aW9uOiA1MDAwLCBwZXJtYW5lbnQ6IGZhbHNlIH0KICAgICAgICAgICk7CiAgICAgICAgfSk7CiAgICB9LAogICAgbG9hZFN0cmVhbXMoKSB7CiAgICAgIHRoaXMuYWN0aXZlU3RyZWFtID0gLTE7CiAgICAgIHRoaXMuYWN0aXZlU3RyZWFtcyA9IFtdOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMgPSBbXTsKICAgICAgbGV0IGluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KAogICAgICAgIChncm91cCkgPT4gZ3JvdXAuaWQgPT09IHRoaXMuYWN0aXZlR3JvdXAKICAgICAgKTsKICAgICAgbGV0IGdyb3VwID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaW5kZXhdOwogICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGh0dHBTZXJ2aWNlCiAgICAgICAgLmdldCgKICAgICAgICAgIGBlZGl0b3Ivc3RyZWFtcy8ke3RoaXMucGxheWxpc3RFZGl0b3IuaWR9LyR7Z3JvdXAuaWR9LyR7Z3JvdXAuZ3JvdXBfdHlwZX1gCiAgICAgICAgKQogICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgIGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wID0gMDsKICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3AgPSAwOwogICAgICAgICAgaWYgKHJlcy5zdGF0dXMgPT09IHRydWUpIHsKICAgICAgICAgICAgbGV0IHN0cmVhbXMgPSByZXMuZGF0YS5tYXAoKHN0cmVhbSkgPT4gewogICAgICAgICAgICAgIGNvbnN0IHN0ciA9IE9iamVjdC5hc3NpZ24oe30sIHN0cmVhbSk7CiAgICAgICAgICAgICAgc3RyLnNvdXJjZV9zdHJlYW1fdHZnX25hbWUgPSBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lOwogICAgICAgICAgICAgIHN0ci5zb3VyY2Vfc3RyZWFtX3R2Z19pZCA9IHN0cmVhbS5zdHJlYW1fdHZnX2lkOwogICAgICAgICAgICAgIHN0ci5zb3VyY2Vfc3RyZWFtX3R2Z19sb2dvID0gc3RyZWFtLnN0cmVhbV90dmdfbG9nbzsKICAgICAgICAgICAgICBzdHIuc291cmNlX3N0cmVhbV90dmdfY2hubyA9IHN0cmVhbS5zdHJlYW1fdHZnX2Nobm87CiAgICAgICAgICAgICAgc3RyLnNvdXJjZV9zdHJlYW1fdHZnX3NoaWZ0ID0gc3RyZWFtLnN0cmVhbV90dmdfc2hpZnQ7CiAgICAgICAgICAgICAgc3RyLnNvdXJjZV9zdHJlYW1fcGFyZW50X2NvZGUgPSBzdHJlYW0uc3RyZWFtX3BhcmVudF9jb2RlOwogICAgICAgICAgICAgIHN0ci5zb3VyY2Vfc3RyZWFtX2F1ZGlvX3RyYWNrID0gc3RyZWFtLnN0cmVhbV9hdWRpb190cmFjazsKICAgICAgICAgICAgICBzdHIuc291cmNlX3N0cmVhbV9hc3BlY3RfcmF0aW8gPSBzdHJlYW0uc3RyZWFtX2FzcGVjdF9yYXRpbzsKICAgICAgICAgICAgICBzdHIuc291cmNlX3N0cmVhbV9yYWRpbyA9IHN0cmVhbS5zdHJlYW1fcmFkaW87CiAgICAgICAgICAgICAgc3RyLnNvdXJjZV9zdHJlYW1fb3JkZXIgPSBzdHJlYW0uc3RyZWFtX29yZGVyOwogICAgICAgICAgICAgIHN0ci5zb3VyY2Vfc3RyZWFtX2lzX2hpZGRlbiA9IHN0cmVhbS5zdHJlYW1faXNfaGlkZGVuOwogICAgICAgICAgICAgIHN0ci5tb2RpZmllZCA9IGZhbHNlOwogICAgICAgICAgICAgIHN0ci5zdHJlYW1faXNfcmVtb3ZlZCA9IDA7CiAgICAgICAgICAgICAgaWYgKGdyb3VwLmdyb3VwX3R5cGUgPT0gMikgewogICAgICAgICAgICAgICAgaWYgKHN0ci5tb3ZpZV9uYW1lID09ICIiKSB7CiAgICAgICAgICAgICAgICAgIHN0ci5tb3ZpZV9uYW1lID0gc3RyLnN0cmVhbV90dmdfbmFtZTsKICAgICAgICAgICAgICAgICAgc3RyLnNvdXJjZV9tb3ZpZV9uYW1lID0gc3RyLnN0cmVhbV90dmdfbmFtZTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHN0ci5zb3VyY2VfbW92aWVfbmFtZSA9IHN0cmVhbS5tb3ZpZV9uYW1lOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc3RyLnNvdXJjZV9tb3ZpZV95ZWFyID0gc3RyZWFtLm1vdmllX3llYXI7CiAgICAgICAgICAgICAgICBzdHIuc291cmNlX3RtZGJfaWQgPSBzdHJlYW0udG1kYl9pZDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKGdyb3VwLmdyb3VwX3R5cGUgPT0gMykgewogICAgICAgICAgICAgICAgaWYgKHN0ci5zZXJpZV9uYW1lID09ICIiKSB7CiAgICAgICAgICAgICAgICAgIHN0ci5zZXJpZV9uYW1lID0gc3RyLnN0cmVhbV90dmdfbmFtZTsKICAgICAgICAgICAgICAgICAgc3RyLnNvdXJjZV9zZXJpZV9uYW1lID0gc3RyLnN0cmVhbV90dmdfbmFtZTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHN0ci5zb3VyY2Vfc2VyaWVfbmFtZSA9IHN0cmVhbS5zZXJpZV9uYW1lOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc3RyLnNvdXJjZV9zZXJpZV9zZWFzb24gPSBzdHJlYW0uc2VyaWVfc2Vhc29uOwogICAgICAgICAgICAgICAgc3RyLnNvdXJjZV9zZXJpZV9lcGlzb2RlID0gc3RyZWFtLnNlcmllX2VwaXNvZGU7CiAgICAgICAgICAgICAgICBzdHIuc291cmNlX3RtZGJfaWQgPSBzdHJlYW0udG1kYl9pZDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIHN0cjsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHN0cmVhbXMuc29ydCgoYSwgYikgPT4KICAgICAgICAgICAgICBhLnNvdXJjZV9zdHJlYW1fb3JkZXIgPiBiLnNvdXJjZV9zdHJlYW1fb3JkZXIKICAgICAgICAgICAgICAgID8gMQogICAgICAgICAgICAgICAgOiBiLnNvdXJjZV9zdHJlYW1fb3JkZXIgPiBhLnNvdXJjZV9zdHJlYW1fb3JkZXIKICAgICAgICAgICAgICAgID8gLTEKICAgICAgICAgICAgICAgIDogMAogICAgICAgICAgICApOwogICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMgPSBzdHJlYW1zOwogICAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0pOwogICAgfSwKICAgIG1vdmVUb1NlbGVjdGVkR3JvdXAoKSB7CiAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgbGV0IHN0cmVhbXMgPSB0aGlzLmFjdGl2ZVN0cmVhbXMuam9pbigpOwogICAgICBsZXQgaW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoKGdyb3VwKSA9PiB7CiAgICAgICAgcmV0dXJuIGdyb3VwLmlkID09IHRoaXMuYWN0aXZlR3JvdXA7CiAgICAgIH0pOwogICAgICBodHRwU2VydmljZQogICAgICAgIC5wb3N0KGBlZGl0b3IvbW92ZS10by1ncm91cC8ke3RoaXMuYWN0aXZlR3JvdXBUeXBlfWAsIHsKICAgICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgc3RyZWFtczogc3RyZWFtcywKICAgICAgICAgIGdyb3VwX2lkOiB0aGlzLmFjdGl2ZUdyb3Vwc1swXSwKICAgICAgICB9KQogICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICBpZiAocmVzLnN0YXR1cyAmJiByZXMuZGF0YSkgewogICAgICAgICAgICB0aGlzLmxvYWRQbGF5bGlzdCh0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLCBpbmRleCk7CiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICB9KTsKICAgIH0sCiAgICBzYXZlQ2hhbmdlc01vZGFsKHNob3csIHNhdmUgPSBmYWxzZSkgewogICAgICB0aGlzLnNhdmVDaGFuZ2VzLm1vZGFsID0gc2hvdzsKICAgICAgaWYgKHNhdmUpIHsKICAgICAgICB0aGlzLmRvU2F2ZSgpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMubG9hZFN0cmVhbXMoKTsKICAgICAgfQogICAgfSwKICAgIHJhZGlvQnJvd3Nlck1vZGFsKHNob3csIHNhdmUgPSBmYWxzZSkgewogICAgICBpZiAoc2hvdykgewogICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLnNlYXJjaCA9ICIiOwogICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLnJlc3VsdHMgPSBbXTsKICAgICAgICB0aGlzLnJhZGlvQnJvd3Nlci5hY3RpdmUgPSBbXTsKICAgICAgfQogICAgICBpZiAoc2F2ZSkgewogICAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgICBsZXQgZ3JvdXBJbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleCgoZ3JvdXApID0+IHsKICAgICAgICAgIHJldHVybiBncm91cC5pZCA9PSB0aGlzLmFjdGl2ZUdyb3VwOwogICAgICAgIH0pOwogICAgICAgIGxldCBvcmRlciA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7CiAgICAgICAgY29uc3Qgc3RyZWFtcyA9IHRoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZS5tYXAoKGluZGV4KSA9PiB7CiAgICAgICAgICBsZXQgcmFkaW8gPSB0aGlzLnJhZGlvQnJvd3Nlci5yZXN1bHRzW2luZGV4XTsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHNvdXJjZV9zdHJlYW1fdXJsOiByYWRpby51cmwsCiAgICAgICAgICAgIHN0cmVhbV90dmdfbmFtZTogcmFkaW8ubmFtZSwKICAgICAgICAgICAgc3RyZWFtX3R2Z19pZDogIiIsCiAgICAgICAgICAgIHN0cmVhbV90dmdfbG9nbzogcmFkaW8uZmF2aWNvbiwKICAgICAgICAgICAgc3RyZWFtX3JhZGlvOiB0cnVlLAogICAgICAgICAgICBzdHJlYW1fb3JkZXI6IG9yZGVyKyssCiAgICAgICAgICB9OwogICAgICAgIH0pOwogICAgICAgIGh0dHBTZXJ2aWNlCiAgICAgICAgICAucG9zdChgZWRpdG9yL2FkZC1zdHJlYW1zLyR7dGhpcy5hY3RpdmVHcm91cFR5cGV9YCwgewogICAgICAgICAgICBwbGF5bGlzdF9pZDogdGhpcy5wbGF5bGlzdEVkaXRvci5pZCwKICAgICAgICAgICAgZ3JvdXBfaWQ6IHRoaXMuZ2V0R3JvdXBXaXRoSWQodGhpcy5hY3RpdmVHcm91cCkuaWQsCiAgICAgICAgICAgIHN0cmVhbXM6IHN0cmVhbXMsCiAgICAgICAgICB9KQogICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICBpZiAocmVzLnN0YXR1cykgewogICAgICAgICAgICAgIHRoaXMubG9hZFBsYXlsaXN0KHRoaXMucGxheWxpc3RFZGl0b3IuaWQsIGdyb3VwSW5kZXgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIH0pOwogICAgICB9CiAgICAgIHRoaXMucmFkaW9Ccm93c2VyLm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBmaW5kUmFkaW9icm93c2VyKHNlYXJjaCkgewogICAgICBpZiAoc2VhcmNoLmxlbmd0aCA9PT0gMCkgewogICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLnJlc3VsdHMgPSBbXTsKICAgICAgICB0aGlzLnJhZGlvQnJvd3Nlci5hY3RpdmUgPSBbXTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnJhZGlvQnJvd3Nlci5pc0xvYWRpbmcgPSB0cnVlOwogICAgICAgIGh0dHBTZXJ2aWNlCiAgICAgICAgICAucG9zdCgiZWRpdG9yL2ZpbmQtcmFkaW9icm93c2VyIiwgewogICAgICAgICAgICBzZWFyY2g6IHNlYXJjaCwKICAgICAgICAgIH0pCiAgICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZSA9IFtdOwogICAgICAgICAgICBpZiAocmVzLnN0YXR1cykgewogICAgICAgICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLnJlc3VsdHMgPSByZXMuZGF0YTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0aGlzLnJhZGlvQnJvd3Nlci5yZXN1bHRzID0gW107CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuYWN0aXZlID0gW107CiAgICAgICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLnJlc3VsdHMgPSBbXTsKICAgICAgICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIHNvdW5kY2xvdWRNb2RhbChzaG93LCBzYXZlID0gZmFsc2UpIHsKICAgICAgaWYgKHNob3cpIHsKICAgICAgICB0aGlzLnNvdW5kY2xvdWQudXJsID0gIiI7CiAgICAgICAgdGhpcy5zb3VuZGNsb3VkLnRyYWNrID0gbnVsbDsKICAgICAgfQogICAgICBpZiAoc2F2ZSkgewogICAgICAgIGlmICh0aGlzLnNvdW5kY2xvdWQudHJhY2spIHsKICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgIGxldCBncm91cEluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KChncm91cCkgPT4gewogICAgICAgICAgICByZXR1cm4gZ3JvdXAuaWQgPT0gdGhpcy5hY3RpdmVHcm91cDsKICAgICAgICAgIH0pOwogICAgICAgICAgbGV0IG9yZGVyID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsKICAgICAgICAgIGNvbnN0IHN0cmVhbXMgPSBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBzb3VyY2Vfc3RyZWFtX3VybDogdGhpcy5zb3VuZGNsb3VkLnVybCwKICAgICAgICAgICAgICBzdHJlYW1fdHZnX25hbWU6IHRoaXMuc291bmRjbG91ZC50cmFjay50aXRsZSwKICAgICAgICAgICAgICBzdHJlYW1fdHZnX2lkOiAiIiwKICAgICAgICAgICAgICBzdHJlYW1fdHZnX2xvZ286IHRoaXMuc291bmRjbG91ZC50cmFjay5hcnR3b3JrX3VybC5yZXBsYWNlKAogICAgICAgICAgICAgICAgImxhcmdlLmpwZyIsCiAgICAgICAgICAgICAgICAidDUwMHg1MDAuanBnIgogICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgc3RyZWFtX3JhZGlvOiB0cnVlLAogICAgICAgICAgICAgIHN0cmVhbV9vcmRlcjogb3JkZXIrKywKICAgICAgICAgICAgfSwKICAgICAgICAgIF07CiAgICAgICAgICBodHRwU2VydmljZQogICAgICAgICAgICAucG9zdChgZWRpdG9yL2FkZC1zdHJlYW1zLyR7dGhpcy5hY3RpdmVHcm91cFR5cGV9YCwgewogICAgICAgICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgICAgIGdyb3VwX2lkOiB0aGlzLmdldEdyb3VwV2l0aElkKHRoaXMuYWN0aXZlR3JvdXApLmlkLAogICAgICAgICAgICAgIHN0cmVhbXM6IHN0cmVhbXMsCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgIGlmIChyZXMuc3RhdHVzKSB7CiAgICAgICAgICAgICAgICB0aGlzLmxvYWRQbGF5bGlzdCh0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLCBncm91cEluZGV4KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMuc291bmRjbG91ZC5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgZ2V0U291bmRjbG91ZFRyYWNrKHVybCwgY2xpZW50X2lkKSB7CiAgICAgIGlmICh1cmwubGVuZ3RoID09PSAwIHx8ICEvc291bmRjbG91ZFwuY29tLy50ZXN0KHVybCkpIHsKICAgICAgICB0aGlzLnNvdW5kY2xvdWQudXJsID0gIiI7CiAgICAgICAgdGhpcy5zb3VuZGNsb3VkLnRyYWNrID0gbnVsbDsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNvdW5kY2xvdWQuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgICBodHRwU2VydmljZQogICAgICAgICAgLnBvc3QoImVkaXRvci9zb3VuZGNsb3VkLXRyYWNrIiwgewogICAgICAgICAgICB1cmw6IHVybCwKICAgICAgICAgICAgY2xpZW50X2lkOiBjbGllbnRfaWQsCiAgICAgICAgICB9KQogICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICBpZiAocmVzLnN0YXR1cyAmJiBPYmplY3Qua2V5cyhyZXMuZGF0YSkubGVuZ3RoKSB7CiAgICAgICAgICAgICAgdGhpcy5zb3VuZGNsb3VkLnRyYWNrID0gcmVzLmRhdGE7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGhpcy5zb3VuZGNsb3VkLnRyYWNrID0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnNvdW5kY2xvdWQuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgICAgdGhpcy5zb3VuZGNsb3VkLnRyYWNrID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5zb3VuZGNsb3VkLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICB5b3V0dWJlTW9kYWwoc2hvdywgc2F2ZSA9IGZhbHNlKSB7CiAgICAgIGlmIChzaG93KSB7CiAgICAgICAgdGhpcy55b3V0dWJlLnVybCA9ICIiOwogICAgICAgIHRoaXMueW91dHViZS52aWRlbyA9IG51bGw7CiAgICAgICAgdGhpcy55b3V0dWJlLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9CiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgaWYgKHRoaXMueW91dHViZS52aWRlbykgewogICAgICAgICAgdGhpcy55b3V0dWJlLmlzTG9hZGluZyA9IHRydWU7CiAgICAgICAgICBsZXQgZ3JvdXBJbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleCgoZ3JvdXApID0+IHsKICAgICAgICAgICAgcmV0dXJuIGdyb3VwLmlkID09IHRoaXMuYWN0aXZlR3JvdXA7CiAgICAgICAgICB9KTsKICAgICAgICAgIGxldCBvcmRlciA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7CiAgICAgICAgICBjb25zdCBzdHJlYW1zID0gWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgc291cmNlX3N0cmVhbV91cmw6IHRoaXMueW91dHViZS51cmwsCiAgICAgICAgICAgICAgc3RyZWFtX3R2Z19uYW1lOiB0aGlzLnlvdXR1YmUudmlkZW8udmlkZW9EZXRhaWxzLnRpdGxlLAogICAgICAgICAgICAgIHN0cmVhbV90dmdfaWQ6ICIiLAogICAgICAgICAgICAgIHN0cmVhbV90dmdfbG9nbzogYGh0dHA6Ly9pLnl0aW1nLmNvbS92aS8ke3RoaXMueW91dHViZS52aWRlb0lkfS9tYXhyZXNkZWZhdWx0LmpwZ2AsCiAgICAgICAgICAgICAgc3RyZWFtX29yZGVyOiBvcmRlcisrLAogICAgICAgICAgICB9LAogICAgICAgICAgXTsKICAgICAgICAgIGh0dHBTZXJ2aWNlCiAgICAgICAgICAgIC5wb3N0KGBlZGl0b3IvYWRkLXN0cmVhbXMvJHt0aGlzLmFjdGl2ZUdyb3VwVHlwZX1gLCB7CiAgICAgICAgICAgICAgcGxheWxpc3RfaWQ6IHRoaXMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICAgICAgZ3JvdXBfaWQ6IHRoaXMuZ2V0R3JvdXBXaXRoSWQodGhpcy5hY3RpdmVHcm91cCkuaWQsCiAgICAgICAgICAgICAgc3RyZWFtczogc3RyZWFtcywKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgIHRoaXMueW91dHViZS5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICBpZiAocmVzLnN0YXR1cykgewogICAgICAgICAgICAgICAgdGhpcy5sb2FkUGxheWxpc3QodGhpcy5wbGF5bGlzdEVkaXRvci5pZCwgZ3JvdXBJbmRleCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgICAgIHRoaXMueW91dHViZS5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMueW91dHViZS5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgZ2V0WW91dHViZVBhZ2UodmlkZW9JZCkgewogICAgICB0aGlzLnlvdXR1YmUuaXNMb2FkaW5nID0gdHJ1ZTsgICAgICAKICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAucG9zdCgiZWRpdG9yL3lvdXR1YmUtdmlkZW8iLCB7IHZpZGVvX2lkOiB2aWRlb0lkIH0pCiAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgaWYgKHJlcy5zdGF0dXMgJiYgT2JqZWN0LmtleXMocmVzLmRhdGEpLmxlbmd0aCkgewogICAgICAgICAgICB0aGlzLnlvdXR1YmUudmlkZW8gPSByZXMuZGF0YTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMueW91dHViZS52aWRlbyA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLnlvdXR1YmUuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgdGhpcy55b3V0dWJlLnZpZGVvID0gbnVsbDsKICAgICAgICAgIHRoaXMueW91dHViZS5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICB9KTsKICAgIH0sCiAgICB2aW1lb01vZGFsKHNob3csIHNhdmUgPSBmYWxzZSkgewogICAgICBpZiAoc2hvdykgewogICAgICAgIHRoaXMudmltZW8udXJsID0gIiI7CiAgICAgICAgdGhpcy52aW1lby52aWRlbyA9IG51bGw7CiAgICAgICAgdGhpcy52aW1lby5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfQogICAgICBpZiAoc2F2ZSkgewogICAgICAgIGlmICh0aGlzLnZpbWVvLnZpZGVvKSB7CiAgICAgICAgICB0aGlzLnZpbWVvLmlzTG9hZGluZyA9IHRydWU7CiAgICAgICAgICBsZXQgZ3JvdXBJbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleCgoZ3JvdXApID0+IHsKICAgICAgICAgICAgcmV0dXJuIGdyb3VwLmlkID09IHRoaXMuYWN0aXZlR3JvdXA7CiAgICAgICAgICB9KTsKICAgICAgICAgIGxldCBvcmRlciA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7CiAgICAgICAgICBjb25zdCBzdHJlYW1zID0gWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgc291cmNlX3N0cmVhbV91cmw6IHRoaXMudmltZW8udXJsLAogICAgICAgICAgICAgIHN0cmVhbV90dmdfbmFtZTogdGhpcy52aW1lby52aWRlby52aWRlby50aXRsZSwKICAgICAgICAgICAgICBzdHJlYW1fdHZnX2lkOiAiIiwKICAgICAgICAgICAgICBzdHJlYW1fdHZnX2xvZ286IHRoaXMudmltZW8udmlkZW8udmlkZW8udGh1bWJzLmJhc2UsCiAgICAgICAgICAgICAgc3RyZWFtX29yZGVyOiBvcmRlcisrLAogICAgICAgICAgICB9LAogICAgICAgICAgXTsKICAgICAgICAgIGh0dHBTZXJ2aWNlCiAgICAgICAgICAgIC5wb3N0KGBlZGl0b3IvYWRkLXN0cmVhbXMvJHt0aGlzLmFjdGl2ZUdyb3VwVHlwZX1gLCB7CiAgICAgICAgICAgICAgcGxheWxpc3RfaWQ6IHRoaXMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICAgICAgZ3JvdXBfaWQ6IHRoaXMuZ2V0R3JvdXBXaXRoSWQodGhpcy5hY3RpdmVHcm91cCkuaWQsCiAgICAgICAgICAgICAgc3RyZWFtczogc3RyZWFtcywKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgIHRoaXMudmltZW8uaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgaWYgKHJlcy5zdGF0dXMpIHsKICAgICAgICAgICAgICAgIHRoaXMubG9hZFBsYXlsaXN0KHRoaXMucGxheWxpc3RFZGl0b3IuaWQsIGdyb3VwSW5kZXgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgICAgICB0aGlzLnZpbWVvLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy52aW1lby5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgZ2V0VmltZW9Db25maWcodmlkZW9JZCkgewogICAgICB0aGlzLnZpbWVvLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGh0dHBTZXJ2aWNlCiAgICAgICAgLnBvc3QoImVkaXRvci92aW1lby12aWRlbyIsIHsgdmlkZW9faWQ6IHZpZGVvSWQgfSkKICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICB0aGlzLnZpbWVvLnZpZGVvID0gcmVzLmRhdGE7CiAgICAgICAgICB0aGlzLnZpbWVvLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0pOwogICAgfSwKICAgIGRhaWx5bW90aW9uTW9kYWwoc2hvdywgc2F2ZSA9IGZhbHNlKSB7CiAgICAgIGlmIChzaG93KSB7CiAgICAgICAgdGhpcy5kYWlseW1vdGlvbi51cmwgPSAiIjsKICAgICAgICB0aGlzLmRhaWx5bW90aW9uLnZpZGVvID0gbnVsbDsKICAgICAgICB0aGlzLmRhaWx5bW90aW9uLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9CiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgaWYgKHRoaXMuZGFpbHltb3Rpb24udmlkZW8pIHsKICAgICAgICAgIHRoaXMuZGFpbHltb3Rpb24uaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgIGxldCBncm91cEluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KChncm91cCkgPT4gewogICAgICAgICAgICByZXR1cm4gZ3JvdXAuaWQgPT0gdGhpcy5hY3RpdmVHcm91cDsKICAgICAgICAgIH0pOwogICAgICAgICAgbGV0IG9yZGVyID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsKICAgICAgICAgIGNvbnN0IHN0cmVhbXMgPSBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBzb3VyY2Vfc3RyZWFtX3VybDogdGhpcy5kYWlseW1vdGlvbi51cmwsCiAgICAgICAgICAgICAgc3RyZWFtX3R2Z19uYW1lOiB0aGlzLmRhaWx5bW90aW9uLnZpZGVvLnRpdGxlLAogICAgICAgICAgICAgIHN0cmVhbV90dmdfaWQ6ICIiLAogICAgICAgICAgICAgIHN0cmVhbV90dmdfbG9nbzogdGhpcy5kYWlseW1vdGlvbi52aWRlby50aHVtYm5haWxfMTA4MF91cmwsCiAgICAgICAgICAgICAgc3RyZWFtX29yZGVyOiBvcmRlcisrLAogICAgICAgICAgICB9LAogICAgICAgICAgXTsKICAgICAgICAgIGh0dHBTZXJ2aWNlCiAgICAgICAgICAgIC5wb3N0KGBlZGl0b3IvYWRkLXN0cmVhbXMvJHt0aGlzLmFjdGl2ZUdyb3VwVHlwZX1gLCB7CiAgICAgICAgICAgICAgcGxheWxpc3RfaWQ6IHRoaXMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICAgICAgZ3JvdXBfaWQ6IHRoaXMuZ2V0R3JvdXBXaXRoSWQodGhpcy5hY3RpdmVHcm91cCkuaWQsCiAgICAgICAgICAgICAgc3RyZWFtczogc3RyZWFtcywKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgIHRoaXMuZGFpbHltb3Rpb24uaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgaWYgKHJlcy5zdGF0dXMpIHsKICAgICAgICAgICAgICAgIHRoaXMubG9hZFBsYXlsaXN0KHRoaXMucGxheWxpc3RFZGl0b3IuaWQsIGdyb3VwSW5kZXgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgICAgICB0aGlzLmRhaWx5bW90aW9uLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy5kYWlseW1vdGlvbi5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgZ2V0RGFpbHltb3Rpb25Db25maWcodmlkZW9JZCkgewogICAgICB0aGlzLmRhaWx5bW90aW9uLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGh0dHBTZXJ2aWNlCiAgICAgICAgLnBvc3QoImVkaXRvci9kYWlseW1vdGlvbi12aWRlbyIsIHsgdmlkZW9faWQ6IHZpZGVvSWQgfSkKICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICB0aGlzLmRhaWx5bW90aW9uLnZpZGVvID0gcmVzLmRhdGE7CiAgICAgICAgICB0aGlzLmRhaWx5bW90aW9uLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0pOwogICAgfSwKICAgIHRlZFRhbGtzTW9kYWwoc2hvdywgc2F2ZSA9IGZhbHNlKSB7CiAgICAgIGlmIChzaG93KSB7CiAgICAgICAgdGhpcy50ZWRUYWxrcy51cmwgPSAiIjsKICAgICAgICB0aGlzLnRlZFRhbGtzLnZpZGVvID0gbnVsbDsKICAgICAgICB0aGlzLnRlZFRhbGtzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9CiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgaWYgKHRoaXMudGVkVGFsa3MudmlkZW8pIHsKICAgICAgICAgIHRoaXMudGVkVGFsa3MuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgIGxldCBncm91cEluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KChncm91cCkgPT4gewogICAgICAgICAgICByZXR1cm4gZ3JvdXAuaWQgPT0gdGhpcy5hY3RpdmVHcm91cDsKICAgICAgICAgIH0pOwogICAgICAgICAgbGV0IG9yZGVyID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsKICAgICAgICAgIGNvbnN0IHN0cmVhbXMgPSBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBzb3VyY2Vfc3RyZWFtX3VybDogdGhpcy50ZWRUYWxrcy51cmwsCiAgICAgICAgICAgICAgc3RyZWFtX3R2Z19uYW1lOiB0aGlzLnRlZFRhbGtzLnZpZGVvLnRpdGxlLAogICAgICAgICAgICAgIHN0cmVhbV90dmdfaWQ6ICIiLAogICAgICAgICAgICAgIHN0cmVhbV90dmdfbG9nbzogdGhpcy50ZWRUYWxrcy52aWRlby5oZXJvLAogICAgICAgICAgICAgIHN0cmVhbV9vcmRlcjogb3JkZXIrKywKICAgICAgICAgICAgfSwKICAgICAgICAgIF07CiAgICAgICAgICBodHRwU2VydmljZQogICAgICAgICAgICAucG9zdChgZWRpdG9yL2FkZC1zdHJlYW1zLyR7dGhpcy5hY3RpdmVHcm91cFR5cGV9YCwgewogICAgICAgICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgICAgIGdyb3VwX2lkOiB0aGlzLmdldEdyb3VwV2l0aElkKHRoaXMuYWN0aXZlR3JvdXApLmlkLAogICAgICAgICAgICAgIHN0cmVhbXM6IHN0cmVhbXMsCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICB0aGlzLnRlZFRhbGtzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgIGlmIChyZXMuc3RhdHVzKSB7CiAgICAgICAgICAgICAgICB0aGlzLmxvYWRQbGF5bGlzdCh0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLCBncm91cEluZGV4KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICAgICAgdGhpcy50ZWRUYWxrcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMudGVkVGFsa3MubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGdldFRlZFRhbGtzQ29uZmlnKHVybCkgewogICAgICB0aGlzLnRlZFRhbGtzLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGh0dHBTZXJ2aWNlLnBvc3QoImVkaXRvci90ZWQtdGFsa3MtdmlkZW8iLCB7IHVybDogdXJsIH0pLnRoZW4oKHJlcykgPT4gewogICAgICAgIHRoaXMudGVkVGFsa3MudmlkZW8gPSByZXMuZGF0YS50YWxrcy5sZW5ndGggPyByZXMuZGF0YS50YWxrc1swXSA6IG51bGw7CiAgICAgICAgdGhpcy50ZWRUYWxrcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfSk7CiAgICB9LAogICAgeGhhbXN0ZXJNb2RhbChzaG93LCBzYXZlID0gZmFsc2UpIHsKICAgICAgaWYgKHNob3cpIHsKICAgICAgICB0aGlzLnhoYW1zdGVyLnVybCA9ICIiOwogICAgICAgIHRoaXMueGhhbXN0ZXIudmlkZW8gPSBudWxsOwogICAgICAgIHRoaXMueGhhbXN0ZXIuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0KICAgICAgaWYgKHNhdmUpIHsKICAgICAgICBpZiAodGhpcy54aGFtc3Rlci52aWRlbykgewogICAgICAgICAgdGhpcy54aGFtc3Rlci5pc0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgbGV0IGdyb3VwSW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoKGdyb3VwKSA9PiB7CiAgICAgICAgICAgIHJldHVybiBncm91cC5pZCA9PSB0aGlzLmFjdGl2ZUdyb3VwOwogICAgICAgICAgfSk7CiAgICAgICAgICBsZXQgb3JkZXIgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOwogICAgICAgICAgY29uc3Qgc3RyZWFtcyA9IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgIHNvdXJjZV9zdHJlYW1fdXJsOiB0aGlzLnhoYW1zdGVyLnVybCwKICAgICAgICAgICAgICBzdHJlYW1fdHZnX25hbWU6IHRoaXMueGhhbXN0ZXIudmlkZW8udmlkZW9FbnRpdHkudGl0bGUsCiAgICAgICAgICAgICAgc3RyZWFtX3R2Z19pZDogIiIsCiAgICAgICAgICAgICAgc3RyZWFtX3R2Z19sb2dvOiB0aGlzLnhoYW1zdGVyLnZpZGVvLnZpZGVvRW50aXR5LnRodW1iQmlnLAogICAgICAgICAgICAgIHN0cmVhbV9vcmRlcjogb3JkZXIrKywKICAgICAgICAgICAgfSwKICAgICAgICAgIF07CiAgICAgICAgICBodHRwU2VydmljZQogICAgICAgICAgICAucG9zdChgZWRpdG9yL2FkZC1zdHJlYW1zLyR7dGhpcy5hY3RpdmVHcm91cFR5cGV9YCwgewogICAgICAgICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgICAgIGdyb3VwX2lkOiB0aGlzLmdldEdyb3VwV2l0aElkKHRoaXMuYWN0aXZlR3JvdXApLmlkLAogICAgICAgICAgICAgIHN0cmVhbXM6IHN0cmVhbXMsCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICB0aGlzLnhoYW1zdGVyLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgIGlmIChyZXMuc3RhdHVzKSB7CiAgICAgICAgICAgICAgICB0aGlzLmxvYWRQbGF5bGlzdCh0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLCBncm91cEluZGV4KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICAgICAgdGhpcy54aGFtc3Rlci5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMueGhhbXN0ZXIubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGdldFhoYW1zdGVyQ29uZmlnKHVybCkgewogICAgICB0aGlzLnhoYW1zdGVyLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGh0dHBTZXJ2aWNlLnBvc3QoImVkaXRvci94aGFtc3Rlci12aWRlbyIsIHsgdXJsOiB1cmwgfSkudGhlbigocmVzKSA9PiB7CiAgICAgICAgdGhpcy54aGFtc3Rlci52aWRlbyA9IHJlcy5kYXRhOwogICAgICAgIHRoaXMueGhhbXN0ZXIuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0pOwogICAgfSwKICAgIGdyb3VwRG91YmxlQ2xpY2soKSB7CiAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3Vwcy5sZW5ndGggPT09IDEpIHsKICAgICAgICB0aGlzLmVkaXRHcm91cE1vZGFsKHRydWUpOwogICAgICB9CiAgICB9LAogICAgc3RyZWFtRG91YmxlQ2xpY2soKSB7CiAgICAgIGlmICh0aGlzLmFjdGl2ZVN0cmVhbXMubGVuZ3RoID09PSAxKSB7CiAgICAgICAgdGhpcy5lZGl0U3RyZWFtTW9kYWwodHJ1ZSk7CiAgICAgIH0KICAgIH0sCiAgICBsb2FkTG9nb0NvdW50cmllcygpIHsKICAgICAgdGhpcy5maW5kTG9nby5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZQogICAgICAgIC5nZXQoImVkaXRvci9sb2dvLWNvdW50cmllcyIpCiAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgdGhpcy5maW5kTG9nby5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIHRoaXMuZmluZExvZ28uY291bnRyaWVzID0gcmVzLmRhdGEKICAgICAgICAgICAgLm1hcCgoY291bnRyeSkgPT4gewogICAgICAgICAgICAgIGxldCBjbiA9IHRoaXMuY291bnRyaWVzLmZpbmQoCiAgICAgICAgICAgICAgICAoY250KSA9PiBjbnQuY29kZS50b0xvd2VyQ2FzZSgpID09IGNvdW50cnkudG9Mb3dlckNhc2UoKQogICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHRleHQ6IGNuID8gY24ubmFtZSA6IGNvdW50cnksCiAgICAgICAgICAgICAgICB2YWx1ZTogY291bnRyeSwKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9KQogICAgICAgICAgICAuc29ydCgoYSwgYikgPT4gewogICAgICAgICAgICAgIHJldHVybiBhLnRleHQudG9VcHBlckNhc2UoKSA8IGIudGV4dC50b1VwcGVyQ2FzZSgpCiAgICAgICAgICAgICAgICA/IC0xCiAgICAgICAgICAgICAgICA6IGEudGV4dC50b1VwcGVyQ2FzZSgpID4gYi50ZXh0LnRvVXBwZXJDYXNlKCkKICAgICAgICAgICAgICAgID8gMQogICAgICAgICAgICAgICAgOiAwOwogICAgICAgICAgICB9KTsKICAgICAgICAgIHRoaXMuYXNzaWduTG9nby5jb3VudHJpZXMgPSBbLi4udGhpcy5maW5kTG9nby5jb3VudHJpZXNdOwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgIHRoaXMuZmluZExvZ28uaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgfSk7CiAgICB9LAogICAgbG9hZFRWR0lEQ291bnRyaWVzKCkgewogICAgICB0aGlzLmFzc2lnblRWR0lELmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGh0dHBTZXJ2aWNlCiAgICAgICAgLmdldCgiZWRpdG9yL3R2LWd1aWRlLWNvdW50cmllcyIpCiAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgdGhpcy5hc3NpZ25UVkdJRC5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIHRoaXMuYXNzaWduVFZHSUQuY291bnRyaWVzID0gcmVzLmRhdGEKICAgICAgICAgICAgLm1hcCgoY291bnRyeSkgPT4gewogICAgICAgICAgICAgIGxldCBjbiA9IHRoaXMuY291bnRyaWVzLmZpbmQoCiAgICAgICAgICAgICAgICAoY250KSA9PiBjbnQuY29kZS50b0xvd2VyQ2FzZSgpID09IGNvdW50cnkudG9Mb3dlckNhc2UoKQogICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHRleHQ6IGNuID8gY24ubmFtZSA6IGNvdW50cnksCiAgICAgICAgICAgICAgICB2YWx1ZTogY291bnRyeSwKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9KQogICAgICAgICAgICAuc29ydCgoYSwgYikgPT4gewogICAgICAgICAgICAgIHJldHVybiBhLnRleHQudG9VcHBlckNhc2UoKSA8IGIudGV4dC50b1VwcGVyQ2FzZSgpCiAgICAgICAgICAgICAgICA/IC0xCiAgICAgICAgICAgICAgICA6IGEudGV4dC50b1VwcGVyQ2FzZSgpID4gYi50ZXh0LnRvVXBwZXJDYXNlKCkKICAgICAgICAgICAgICAgID8gMQogICAgICAgICAgICAgICAgOiAwOwogICAgICAgICAgICB9KTsKICAgICAgICAgIHRoaXMuYXNzaWduVFZHSUQuY291bnRyaWVzLnVuc2hpZnQoeyB0ZXh0OiB0aGlzLiR0KCJnZW5lcmFsLmFsbCIpLCB2YWx1ZTogImFsbCIgfSk7CiAgICAgICAgICB0aGlzLmZpbmRUVkdJRC5jb3VudHJpZXMgPSBbLi4udGhpcy5hc3NpZ25UVkdJRC5jb3VudHJpZXNdOwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgIHRoaXMuYXNzaWduVFZHSUQuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgfSk7CiAgICB9LAogICAgbG9hZExvZ29zRmluZChjb3VudHJ5KSB7CiAgICAgIHRoaXMuZmluZExvZ28uaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAuZ2V0KGBlZGl0b3IvbG9nb3MvJHtjb3VudHJ5fWApCiAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgdGhpcy5maW5kTG9nby5sb2dvID0gIiI7CiAgICAgICAgICB0aGlzLmZpbmRMb2dvLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgdGhpcy5maW5kTG9nby5sb2dvcyA9IHJlcy5kYXRhLm1hcCgobG9nbykgPT4gewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIHRleHQ6IGxvZ28ubGFiZWwsCiAgICAgICAgICAgICAgdmFsdWU6IGxvZ28uZmlsZW5hbWUsCiAgICAgICAgICAgIH07CiAgICAgICAgICB9KTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICB0aGlzLmZpbmRMb2dvLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0pOwogICAgfSwKICAgIGZpbmRMb2dvTW9kYWwoc2hvdywgc2F2ZSA9IGZhbHNlKSB7CiAgICAgIGxldCBzZWxlY3RlZCA9IHRoaXMuZ2V0U3RyZWFtV2l0aElkKHRoaXMuYWN0aXZlU3RyZWFtc1swXSk7CiAgICAgIGlmIChzaG93KSB7CiAgICAgICAgdGhpcy5maW5kTG9nby5sb2dvID0gIiI7CiAgICAgICAgdGhpcy5maW5kTG9nby50aXRsZSA9IHNlbGVjdGVkLnN0cmVhbV90dmdfbmFtZTsKICAgICAgfQogICAgICB0aGlzLmZpbmRMb2dvLnNlYXJjaCA9ICIiOwogICAgICBpZiAoc2F2ZSkgewogICAgICAgIGlmIChzZWxlY3RlZCkgewogICAgICAgICAgc2VsZWN0ZWQuc3RyZWFtX3R2Z19sb2dvID0gYGh0dHA6Ly9zdGF0aWMuaXB0di10b29scy5jb20vJHt0aGlzLmZpbmRMb2dvLmNvdW50cnl9LyR7dGhpcy5maW5kTG9nby5sb2dvfWA7CiAgICAgICAgICBzZWxlY3RlZC5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLmZpbmRMb2dvLm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBsb2FkTG9nb3NBc3NpZ24oY291bnRyeSkgewogICAgICB0aGlzLmFzc2lnbkxvZ28uaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAuZ2V0KGBlZGl0b3IvbG9nb3MvJHtjb3VudHJ5fWApCiAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgdGhpcy5hc3NpZ25Mb2dvLmxvZ28gPSAiIjsKICAgICAgICAgIHRoaXMuYXNzaWduTG9nby5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIHRoaXMuYXNzaWduTG9nby5sb2dvcyA9IHJlcy5kYXRhLm1hcCgobG9nbykgPT4gbG9nby5maWxlbmFtZSk7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgdGhpcy5hc3NpZ25Mb2dvLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0pOwogICAgfSwKICAgIGFzc2lnbkxvZ29Nb2RhbChzaG93LCBzYXZlID0gZmFsc2UpIHsKICAgICAgaWYgKHNob3cpIHsKICAgICAgICB0aGlzLmFzc2lnbkxvZ28ubG9nbyA9ICIiOwogICAgICB9CiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgdmFyIGNoYW5nZWQgPSBmYWxzZTsKICAgICAgICB2YXIgc3RyaW5nU2ltaWxhcml0eSA9IHJlcXVpcmUoInN0cmluZy1zaW1pbGFyaXR5Iik7CiAgICAgICAgbGV0IHN0cmVhbXMgPSBbXTsKICAgICAgICBpZiAodGhpcy5hc3NpZ25Mb2dvLmFzc2lnbkFsbCA9PSAxKSB7CiAgICAgICAgICBzdHJlYW1zID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzdHJlYW1zID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmZpbHRlcigoc3RyZWFtKSA9PiAhc3RyZWFtLnN0cmVhbV90dmdfbG9nby5sZW5ndGgpOwogICAgICAgIH0KICAgICAgICBzdHJlYW1zLm1hcCgoc3RyZWFtKSA9PiB7CiAgICAgICAgICBsZXQgbWF0Y2gxID0gc3RyaW5nU2ltaWxhcml0eS5maW5kQmVzdE1hdGNoKAogICAgICAgICAgICBTdHJpbmcoc3RyZWFtLnN0cmVhbV90dmdfbmFtZSkucmVwbGFjZSgvIGhkJC9pLCAiIiksCiAgICAgICAgICAgIHRoaXMuYXNzaWduTG9nby5sb2dvcwogICAgICAgICAgKS5iZXN0TWF0Y2g7CiAgICAgICAgICBsZXQgbWF0Y2gyID0gc3RyaW5nU2ltaWxhcml0eS5maW5kQmVzdE1hdGNoKAogICAgICAgICAgICBTdHJpbmcoc3RyZWFtLnN0cmVhbV90dmdfaWQpLAogICAgICAgICAgICB0aGlzLmFzc2lnbkxvZ28ubG9nb3MKICAgICAgICAgICkuYmVzdE1hdGNoOwogICAgICAgICAgaWYgKG1hdGNoMS5yYXRpbmcgPj0gMC4zKSB7CiAgICAgICAgICAgIGNoYW5nZWQgPSB0cnVlOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19sb2dvID0gYGh0dHA6Ly9zdGF0aWMuaXB0di10b29scy5jb20vJHt0aGlzLmFzc2lnbkxvZ28uY291bnRyeX0vJHttYXRjaDEudGFyZ2V0fWA7CiAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICB9IGVsc2UgaWYgKG1hdGNoMi5yYXRpbmcgPj0gMC41KSB7CiAgICAgICAgICAgIGNoYW5nZWQgPSB0cnVlOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19sb2dvID0gYGh0dHA6Ly9zdGF0aWMuaXB0di10b29scy5jb20vJHt0aGlzLmFzc2lnbkxvZ28uY291bnRyeX0vJHttYXRjaDIudGFyZ2V0fWA7CiAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gY2hhbmdlZDsKICAgICAgfQogICAgICB0aGlzLmFzc2lnbkxvZ28ubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGxvYWRUVkdJREFzc2lnbihjb3VudHJ5KSB7CiAgICAgIHRoaXMuYXNzaWduVFZHSUQuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAuZ2V0KGBlZGl0b3IvdHYtZ3VpZGUvJHtjb3VudHJ5fWApCiAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgdGhpcy5hc3NpZ25UVkdJRC5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIHRoaXMuYXNzaWduVFZHSUQuY2hhbm5lbHMgPSByZXMuZGF0YTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICB0aGlzLmFzc2lnblRWR0lELmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0pOwogICAgfSwKICAgIGFzc2lnblRWR0lETW9kYWwoc2hvdywgc2F2ZSA9IGZhbHNlKSB7CiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgdmFyIGNoYW5nZWQgPSBmYWxzZTsKICAgICAgICB2YXIgc3RyaW5nU2ltaWxhcml0eSA9IHJlcXVpcmUoInN0cmluZy1zaW1pbGFyaXR5Iik7CiAgICAgICAgbGV0IHN0cmVhbXMgPSBbXTsKICAgICAgICBpZiAodGhpcy5hc3NpZ25UVkdJRC5hc3NpZ25BbGwgPT0gMSkgewogICAgICAgICAgc3RyZWFtcyA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtczsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc3RyZWFtcyA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5maWx0ZXIoKHN0cmVhbSkgPT4gIXN0cmVhbS5zdHJlYW1fdHZnX2lkLmxlbmd0aCB8fCBzdHJlYW0uc3RyZWFtX3R2Z19pZC5sZW5ndGggPT0gMCk7CiAgICAgICAgfQogICAgICAgIGxldCBjaGFubmVsTmFtZXMgPSB0aGlzLmFzc2lnblRWR0lELmNoYW5uZWxzLm1hcChjaGFubmVsID0+IGNoYW5uZWwudHZnX25hbWUpOwogICAgICAgIGxldCBjaGFubmVsSWRzID0gdGhpcy5hc3NpZ25UVkdJRC5jaGFubmVscy5tYXAoY2hhbm5lbCA9PiBjaGFubmVsLnR2Z19pZCk7CiAgICAgICAgc3RyZWFtcy5tYXAoKHN0cmVhbSkgPT4gewogICAgICAgICAgbGV0IG1hdGNoMSA9IHN0cmluZ1NpbWlsYXJpdHkuZmluZEJlc3RNYXRjaCgKICAgICAgICAgICAgU3RyaW5nKHN0cmVhbS5zdHJlYW1fdHZnX25hbWUpLAogICAgICAgICAgICBjaGFubmVsTmFtZXMKICAgICAgICAgICkuYmVzdE1hdGNoOwogICAgICAgICAgbGV0IG1hdGNoMiA9IHN0cmluZ1NpbWlsYXJpdHkuZmluZEJlc3RNYXRjaCgKICAgICAgICAgICAgU3RyaW5nKHN0cmVhbS5zdHJlYW1fdHZnX2lkKSwKICAgICAgICAgICAgY2hhbm5lbElkcwogICAgICAgICAgKS5iZXN0TWF0Y2g7CiAgICAgICAgICBsZXQgbWF0Y2gzID0gc3RyaW5nU2ltaWxhcml0eS5maW5kQmVzdE1hdGNoKAogICAgICAgICAgICBTdHJpbmcoc3RyZWFtLnN0cmVhbV90dmdfbmFtZSkucmVwbGFjZSgvIGhkJHwgZmhkJHwgaGV2YyR8IGgyNjUkfC9pLCAiIiksCiAgICAgICAgICAgIGNoYW5uZWxOYW1lcwogICAgICAgICAgKS5iZXN0TWF0Y2g7CiAgICAgICAgICBpZiAobWF0Y2gyLnJhdGluZyA+PSAwLjc1KSB7CiAgICAgICAgICAgIGNoYW5nZWQgPSB0cnVlOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19pZCA9IG1hdGNoMi50YXJnZXQ7CiAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICB9IGVsc2UgaWYgKG1hdGNoMS5yYXRpbmcgPj0gMC43NSkgewogICAgICAgICAgICBjaGFuZ2VkID0gdHJ1ZTsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfaWQgPSB0aGlzLmFzc2lnblRWR0lELmNoYW5uZWxzLmZpbmQoY2hhbm5lbCA9PiBjaGFubmVsLnR2Z19uYW1lID09PSBtYXRjaDEudGFyZ2V0KS50dmdfaWQ7CiAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICB9IGVsc2UgaWYgKG1hdGNoMy5yYXRpbmcgPj0gMC43NSkgewogICAgICAgICAgICBjaGFuZ2VkID0gdHJ1ZTsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfaWQgPSB0aGlzLmFzc2lnblRWR0lELmNoYW5uZWxzLmZpbmQoY2hhbm5lbCA9PiBjaGFubmVsLnR2Z19uYW1lID09PSBtYXRjaDEudGFyZ2V0KS50dmdfaWQ7CiAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjaGFuZ2VkID0gdHJ1ZTsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfaWQgPSAiIjsKICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSBjaGFuZ2VkOwogICAgICB9CiAgICAgIHRoaXMuYXNzaWduVFZHSUQubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGxvYWRUVkdJREZpbmQoY291bnRyeSkgewogICAgICB0aGlzLmZpbmRUVkdJRC5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZQogICAgICAgIC5nZXQoYGVkaXRvci90di1ndWlkZS8ke2NvdW50cnl9YCkKICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICB0aGlzLmZpbmRUVkdJRC5jaGFubmVsID0gIiI7CiAgICAgICAgICB0aGlzLmZpbmRUVkdJRC5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIHRoaXMuZmluZFRWR0lELmNoYW5uZWxzID0gcmVzLmRhdGEubWFwKChjaGFubmVsKSA9PiB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgdGV4dDogY2hhbm5lbC50dmdfbmFtZSwKICAgICAgICAgICAgICB2YWx1ZTogY2hhbm5lbC50dmdfaWQsCiAgICAgICAgICAgIH07CiAgICAgICAgICB9KTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICB0aGlzLmZpbmRUVkdJRC5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICB9KTsKICAgIH0sCiAgICBmaW5kVFZHSURNb2RhbChzaG93LCBzYXZlID0gZmFsc2UpIHsKICAgICAgbGV0IHNlbGVjdGVkID0gdGhpcy5nZXRTdHJlYW1XaXRoSWQodGhpcy5hY3RpdmVTdHJlYW1zWzBdKTsKICAgICAgaWYgKHNob3cpIHsKICAgICAgICB0aGlzLmZpbmRUVkdJRC5jaGFubmVsID0gIiI7CiAgICAgICAgdGhpcy5maW5kVFZHSUQudGl0bGUgPSBzZWxlY3RlZC5zdHJlYW1fdHZnX25hbWU7CiAgICAgIH0KICAgICAgdGhpcy5maW5kVFZHSUQuc2VhcmNoID0gIiI7CiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgaWYgKHNlbGVjdGVkKSB7CiAgICAgICAgICBzZWxlY3RlZC5zdHJlYW1fdHZnX2lkID0gdGhpcy5maW5kVFZHSUQuY2hhbm5lbDsKICAgICAgICAgIHNlbGVjdGVkLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMuZmluZFRWR0lELm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBpbXBvcnRNM1VNb2RhbChzaG93LCBzYXZlID0gZmFsc2UpIHsKICAgICAgaWYgKHNob3cpIHsKICAgICAgICB0aGlzLmltcG9ydE0zVS5maWxlID0gbnVsbDsKICAgICAgICB0aGlzLmltcG9ydE0zVS5tM3UgPSBudWxsOwogICAgICAgIHRoaXMuaW1wb3J0TTNVLmdyb3VwcyA9IFtdOwogICAgICAgIHRoaXMuaW1wb3J0TTNVLmltcG9ydEdyb3VwcyA9IFtdOwogICAgICB9CiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlOwogICAgICAgIGxldCBncm91cEluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KChncm91cCkgPT4gewogICAgICAgICAgcmV0dXJuIGdyb3VwLmlkID09IHRoaXMuYWN0aXZlR3JvdXA7CiAgICAgICAgfSk7CiAgICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAgIC5wb3N0KCJlZGl0b3IvaW1wb3J0IiwgewogICAgICAgICAgICBwbGF5bGlzdF9pZDogdGhpcy5wbGF5bGlzdEVkaXRvci5pZCwKICAgICAgICAgICAgaW1wb3J0OiB0aGlzLmltcG9ydE0zVS5ncm91cHMuZmlsdGVyKChncm91cCwgaW5kZXgpID0+IHRoaXMuaW1wb3J0TTNVLmltcG9ydEdyb3Vwcy5pbmNsdWRlcyhpbmRleCkpCiAgICAgICAgICB9KQogICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICBpZiAocmVzLnN0YXR1cykgewogICAgICAgICAgICAgIHRoaXMubG9hZFBsYXlsaXN0KHRoaXMucGxheWxpc3RFZGl0b3IuaWQsIGdyb3VwSW5kZXgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIH0pOwogICAgICB9CiAgICAgIHRoaXMuaW1wb3J0TTNVLm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICB1cGxvYWRNM1UoZXZlbnQpIHsKICAgICAgY29uc3QgaW5wdXQgPSBldmVudC50YXJnZXQ7CiAgICAgIGlmICgiZmlsZXMiIGluIGlucHV0ICYmIGlucHV0LmZpbGVzLmxlbmd0aCA+IDApIHsKICAgICAgICB0aGlzLmltcG9ydE0zVS5pc0xvYWRpbmcgPSB0cnVlOwogICAgICAgIHRoaXMucmVhZEZpbGVDb250ZW50KGlucHV0LmZpbGVzWzBdKQogICAgICAgICAgLnRoZW4oKGNvbnRlbnQpID0+IHsKICAgICAgICAgICAgdGhpcy5pbXBvcnRNM1UuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMucGFyc2VNM1UoY29udGVudCk7CiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKChlcnJvcikgPT4gewogICAgICAgICAgICB0aGlzLiRub3RpZnkoCiAgICAgICAgICAgICAgImVycm9yIiwKICAgICAgICAgICAgICB0aGlzLiR0KCJwcm9maWxlLmZhaWxlZCIpLAogICAgICAgICAgICAgIGVycm9yLAogICAgICAgICAgICAgICJsYS11c2VyLXNoaWVsZCIsCiAgICAgICAgICAgICAgeyBkdXJhdGlvbjogNTAwMCwgcGVybWFuZW50OiBmYWxzZSB9CiAgICAgICAgICAgICk7CiAgICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIHBhcnNlTTNVKGNvbnRlbnQpIHsKICAgICAgbGV0IHZtID0gdGhpczsKICAgICAgdm0uaW1wb3J0TTNVLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIG0zdQogICAgICAgIC5wYXJzZSgKICAgICAgICAgIGNvbnRlbnQsCiAgICAgICAgICB7IHRhZzogIm5hbWUiLCB0eXBlOiBbIk1vdmllIiwgIlNlcmllcyIsICJWT0QiLCAiTGl2ZSJdIH0sCiAgICAgICAgICB0cnVlCiAgICAgICAgKQogICAgICAgIC50aGVuKChwbGF5bGlzdCkgPT4gewogICAgICAgICAgdGhpcy5pbXBvcnRNM1UubTN1ID0gcGxheWxpc3Q7CiAgICAgICAgICB0aGlzLmltcG9ydE0zVS5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIHRoaXMuaW1wb3J0TTNVLmdyb3VwcyA9IHBsYXlsaXN0Lmdyb3VwczsKICAgICAgICAgIHRoaXMuaW1wb3J0TTNVLmltcG9ydEdyb3VwcyA9IFtdOwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChlcnJvcikgPT4gewogICAgICAgICAgdm0uaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB2bS4kbm90aWZ5KAogICAgICAgICAgICAiZXJyb3IiLAogICAgICAgICAgICB2bS4kdCgicHJvZmlsZS5mYWlsZWQiKSwKICAgICAgICAgICAgZXJyb3IsCiAgICAgICAgICAgICJsYS11c2VyLXNoaWVsZCIsCiAgICAgICAgICAgIHsgZHVyYXRpb246IDUwMDAsIHBlcm1hbmVudDogZmFsc2UgfQogICAgICAgICAgKTsKICAgICAgICB9KTsKICAgIH0sCiAgICByZWFkRmlsZUNvbnRlbnQoZmlsZSkgewogICAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwogICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICAgIHJlYWRlci5vbmxvYWQgPSAoZXZlbnQpID0+IHJlc29sdmUoZXZlbnQudGFyZ2V0LnJlc3VsdCk7CiAgICAgICAgcmVhZGVyLm9uZXJyb3IgPSAoZXJyb3IpID0+IHJlamVjdChlcnJvcik7CiAgICAgICAgcmVhZGVyLnJlYWRBc1RleHQoZmlsZSk7CiAgICAgIH0pOwogICAgfSwKICB9LAogIGJlZm9yZU1vdW50KCkgewogICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QuYWRkKCJyaWdodC1tZW51Iik7CiAgICBFdmVudEJ1cy4kb24oInNlYXJjaCIsIHRoaXMuc2VhcmNoRWRpdG9yKTsKICAgIEV2ZW50QnVzLiRvbigicHJpbnQiLCB0aGlzLnByaW50RWRpdG9yKTsKICAgIEV2ZW50QnVzLiRvbigidGFiLWNoYW5nZSIsIHRoaXMuZG9UYWJDaGFuZ2UpOwogICAgRXZlbnRCdXMuJG9uKCJzYXZlIiwgdGhpcy5kb1NhdmUpOwogICAgRXZlbnRCdXMuJG9uKCJjYW5jZWwiLCB0aGlzLmRvQ2FuY2VsKTsKICAgIGlmICh0aGlzLm1vdmllU2VyaWVQbGF5bGlzdCkgewogICAgICB0aGlzLmxvYWRQbGF5bGlzdCh0aGlzLm1vdmllU2VyaWVQbGF5bGlzdCk7CiAgICB9CiAgICB0aGlzLmxvYWRMb2dvQ291bnRyaWVzKCk7CiAgICB0aGlzLmxvYWRUVkdJRENvdW50cmllcygpOwogIH0sCiAgYmVmb3JlRGVzdHJveSgpIHsKICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnJlbW92ZSgicmlnaHQtbWVudSIpOwogICAgRXZlbnRCdXMuJG9mZigic2VhcmNoIiwgdGhpcy5zZWFyY2hFZGl0b3IpOwogICAgRXZlbnRCdXMuJG9mZigicHJpbnQiLCB0aGlzLnByaW50RWRpdG9yKTsKICAgIEV2ZW50QnVzLiRvZmYoInRhYi1jaGFuZ2UiLCB0aGlzLmRvVGFiQ2hhbmdlKTsKICAgIEV2ZW50QnVzLiRvZmYoInNhdmUiLCB0aGlzLmRvU2F2ZSk7CiAgICBFdmVudEJ1cy4kb2ZmKCJjYW5jZWwiLCB0aGlzLmRvQ2FuY2VsKTsKICB9LAogIHdhdGNoOiB7CiAgICBkcmFnU3RyZWFtOiBmdW5jdGlvbiAodmFsKSB7CiAgICAgIGlmICghdmFsKSB7CiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgICAgfQogICAgfSwKICAgIGRyYWdHcm91cDogZnVuY3Rpb24gKHZhbCkgewogICAgICBpZiAoIXZhbCkgewogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICAgIH0KICAgIH0sCiAgICBhY3RpdmVHcm91cDogZnVuY3Rpb24gKHZhbCkgewogICAgICBpZiAodGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkKSB7CiAgICAgICAgdGhpcy5zYXZlQ2hhbmdlc01vZGFsKHRydWUpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMubG9hZFN0cmVhbXMoKTsKICAgICAgfQogICAgfSwKICAgICJwbGF5bGlzdEVkaXRvci5jaGFuZ2VkIjogZnVuY3Rpb24gKHZhbCkgewogICAgICBFdmVudEJ1cy4kZW1pdCgiZWRpdG9yLWNoYW5nZXMiLCB2YWwpOwogICAgfSwKICAgICJyYWRpb0Jyb3dzZXIuc2VhcmNoIjogZnVuY3Rpb24gKHZhbCkgewogICAgICBsZXQgdm0gPSB0aGlzOwogICAgICBjbGVhclRpbWVvdXQodGhpcy5yYWRpb0Jyb3dzZXIuYm91bmNlKTsKICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuYm91bmNlID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgdm0uZmluZFJhZGlvYnJvd3Nlcih2YWwpOwogICAgICB9LCA1MDApOwogICAgfSwKICAgICJzb3VuZGNsb3VkLnVybCI6IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgbGV0IHZtID0gdGhpczsKICAgICAgY2xlYXJUaW1lb3V0KHRoaXMucmFkaW9Ccm93c2VyLmJvdW5jZSk7CiAgICAgIHRoaXMucmFkaW9Ccm93c2VyLmJvdW5jZSA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgIHZtLmdldFNvdW5kY2xvdWRUcmFjayh2YWwsIHZtLnNvdW5kY2xvdWRDbGllbnRJZCk7CiAgICAgIH0sIDUwMCk7CiAgICB9LAogICAgInlvdXR1YmUudXJsIjogZnVuY3Rpb24gKHZhbCkgewogICAgICBpZiAoIXZhbC5sZW5ndGgpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKC95b3V0dVwuP2JlL2kudGVzdCh2YWwpKSB7CiAgICAgICAgdmFyIGk7CiAgICAgICAgdmFyIHBhdHRlcm5zID0gWwogICAgICAgICAgL3lvdXR1XC5iZVwvKFteIyY/XXsxMX0pLywgLy8geW91dHUuYmUvPGlkPgogICAgICAgICAgL1w/dj0oW14jJj9dezExfSkvLCAvLyA/dj08aWQ+CiAgICAgICAgICAvJnY9KFteIyY/XXsxMX0pLywgLy8gJnY9PGlkPgogICAgICAgICAgL2VtYmVkXC8oW14jJj9dezExfSkvLCAvLyBlbWJlZC88aWQ+CiAgICAgICAgICAvXC92XC8oW14jJj9dezExfSkvLCAvLyAvdi88aWQ+CiAgICAgICAgXTsKCiAgICAgICAgZm9yIChpID0gMDsgaSA8IHBhdHRlcm5zLmxlbmd0aDsgKytpKSB7CiAgICAgICAgICBpZiAocGF0dGVybnNbaV0udGVzdCh2YWwpKSB7CiAgICAgICAgICAgIHRoaXMueW91dHViZS52aWRlb0lkID0gcGF0dGVybnNbaV0uZXhlYyh2YWwpWzFdOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB2YXIgdG9rZW5zID0gdmFsLnNwbGl0KC9bLyY/PSMuXHNdL2cpOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCB0b2tlbnMubGVuZ3RoOyArK2kpIHsKICAgICAgICAgIGlmICgvXlteIyY/XXsxMX0kLy50ZXN0KHRva2Vuc1tpXSkpIHsKICAgICAgICAgICAgdGhpcy55b3V0dWJlLnZpZGVvSWQgPSB0b2tlbnNbaV07CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHRoaXMueW91dHViZS52aWRlb0lkID0gIiI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHZhciB1cmxwID0gbmV3IFVSTCh2YWwpOwogICAgICAgICAgdGhpcy55b3V0dWJlLnZpZGVvSWQgPSB1cmxwLnNlYXJjaFBhcmFtcy5nZXQoInYiKTsKICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgdGhpcy55b3V0dWJlLnZpZGVvSWQgPSAiIjsKICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICAieW91dHViZS52aWRlb0lkIjogZnVuY3Rpb24gKHZhbCkgewogICAgICBsZXQgdm0gPSB0aGlzOwogICAgICBjbGVhclRpbWVvdXQodGhpcy55b3V0dWJlLmJvdW5jZSk7CiAgICAgIHRoaXMueW91dHViZS5ib3VuY2UgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAodmFsLmxlbmd0aCkgewogICAgICAgICAgdm0uZ2V0WW91dHViZVBhZ2UodmFsKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdm0ueW91dHViZS52aWRlbyA9IG51bGw7CiAgICAgICAgfQogICAgICB9LCA1MDApOwogICAgfSwKICAgICJ2aW1lby51cmwiOiBmdW5jdGlvbiAodmFsKSB7CiAgICAgIGlmICgvdmltZW9cLmNvbS9pLnRlc3QodmFsKSkgewogICAgICAgIGxldCBtYXRjaCA9IHZhbC5tYXRjaCgKICAgICAgICAgIC8oPzp3d3dcLnxwbGF5ZXJcLik/dmltZW8uY29tXC8oPzpjaGFubmVsc1wvKD86XHcrXC8pP3xncm91cHNcLyg/OlteL10qKVwvdmlkZW9zXC98YWxidW1cLyg/OlxkKylcL3ZpZGVvXC98dmlkZW9cL3wpKFxkKykoPzpbYS16QS1aMC05Xy1dKyk/L2kKICAgICAgICApOwogICAgICAgIGlmIChtYXRjaC5sZW5ndGggPj0gMikgewogICAgICAgICAgdGhpcy52aW1lby52aWRlb0lkID0gbWF0Y2hbMV07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMudmltZW8udmlkZW9JZCA9ICIiOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnZpbWVvLnZpZGVvSWQgPSAiIjsKICAgICAgfQogICAgfSwKICAgICJ2aW1lby52aWRlb0lkIjogZnVuY3Rpb24gKHZhbCkgewogICAgICBsZXQgdm0gPSB0aGlzOwogICAgICBjbGVhclRpbWVvdXQodGhpcy52aW1lby5ib3VuY2UpOwogICAgICB0aGlzLnZpbWVvLmJvdW5jZSA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgIGlmICh2YWwubGVuZ3RoKSB7CiAgICAgICAgICB2bS5nZXRWaW1lb0NvbmZpZyh2YWwpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2bS52aW1lby52aWRlbyA9IG51bGw7CiAgICAgICAgfQogICAgICB9LCA1MDApOwogICAgfSwKICAgICJkYWlseW1vdGlvbi51cmwiOiBmdW5jdGlvbiAodmFsKSB7CiAgICAgIGlmICgvZGFpbHltb3Rpb25cLmNvbS9pLnRlc3QodmFsKSkgewogICAgICAgIGxldCBtYXRjaCA9IHZhbC5tYXRjaCgKICAgICAgICAgIC9eLitkYWlseW1vdGlvbi5jb21cLyh2aWRlb3xodWIpXC8oW15fXSspW14jXSooI3ZpZGVvPShbXl8mXSspKT8vaQogICAgICAgICk7CiAgICAgICAgaWYgKG1hdGNoLmxlbmd0aCA+PSA0ICYmIG1hdGNoWzRdKSB7CiAgICAgICAgICB0aGlzLmRhaWx5bW90aW9uLnZpZGVvSWQgPSBtYXRjaFs0XTsKICAgICAgICB9IGVsc2UgaWYgKG1hdGNoLmxlbmd0aCA+PSAyKSB7CiAgICAgICAgICB0aGlzLmRhaWx5bW90aW9uLnZpZGVvSWQgPSBtYXRjaFsyXTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5kYWlseW1vdGlvbi52aWRlb0lkID0gIiI7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZGFpbHltb3Rpb24udmlkZW9JZCA9ICIiOwogICAgICB9CiAgICB9LAogICAgImRhaWx5bW90aW9uLnZpZGVvSWQiOiBmdW5jdGlvbiAodmFsKSB7CiAgICAgIGxldCB2bSA9IHRoaXM7CiAgICAgIGNsZWFyVGltZW91dCh0aGlzLmRhaWx5bW90aW9uLmJvdW5jZSk7CiAgICAgIHRoaXMuZGFpbHltb3Rpb24uYm91bmNlID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKHZhbC5sZW5ndGgpIHsKICAgICAgICAgIHZtLmdldERhaWx5bW90aW9uQ29uZmlnKHZhbCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZtLmRhaWx5bW90aW9uLnZpZGVvID0gbnVsbDsKICAgICAgICB9CiAgICAgIH0sIDUwMCk7CiAgICB9LAogICAgInRlZFRhbGtzLnVybCI6IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgaWYgKC90ZWRcLmNvbVwvdGFsa3MvaS50ZXN0KHZhbCkpIHsKICAgICAgICBsZXQgdm0gPSB0aGlzOwogICAgICAgIGNsZWFyVGltZW91dCh0aGlzLnRlZFRhbGtzLmJvdW5jZSk7CiAgICAgICAgdGhpcy50ZWRUYWxrcy5ib3VuY2UgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGlmICh2YWwubGVuZ3RoKSB7CiAgICAgICAgICAgIHZtLmdldFRlZFRhbGtzQ29uZmlnKHZhbCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2bS50ZWRUYWxrcy52aWRlbyA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgfSwgNTAwKTsKICAgICAgfQogICAgfSwKICAgICJ4aGFtc3Rlci51cmwiOiBmdW5jdGlvbiAodmFsKSB7CiAgICAgIGxldCB2bSA9IHRoaXM7CiAgICAgIGlmICgveGhhbXN0ZXJcLmNvbVwvdmlkZW9zL2kudGVzdCh2YWwpKSB7CiAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMueGhhbXN0ZXJCb3VuY2UpOwogICAgICAgIHRoaXMueGhhbXN0ZXJCb3VuY2UgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGlmICh2YWwubGVuZ3RoKSB7CiAgICAgICAgICAgIHZtLmdldFhoYW1zdGVyQ29uZmlnKHZhbCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2bS54aGFtc3Rlci52aWRlbyA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgfSwgNTAwKTsKICAgICAgfQogICAgfSwKICAgICJmaW5kTG9nby5jb3VudHJ5IjogZnVuY3Rpb24gKHZhbCkgewogICAgICBpZiAodmFsLmxlbmd0aCkgewogICAgICAgIHRoaXMubG9hZExvZ29zRmluZCh2YWwpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZmluZExvZ28ubG9nbyA9ICIiOwogICAgICB9CiAgICB9LAogICAgImFzc2lnbkxvZ28uY291bnRyeSI6IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgaWYgKHZhbC5sZW5ndGgpIHsKICAgICAgICB0aGlzLmxvYWRMb2dvc0Fzc2lnbih2YWwpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYXNzaWduTG9nby5sb2dvID0gIiI7CiAgICAgIH0KICAgIH0sCiAgICAiZmluZFRWR0lELmNvdW50cnkiOiBmdW5jdGlvbiAodmFsKSB7CiAgICAgIGlmICh2YWwubGVuZ3RoKSB7CiAgICAgICAgdGhpcy5sb2FkVFZHSURGaW5kKHZhbCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5maW5kVFZHSUQuY2hhbm5lbCA9ICIiOwogICAgICB9CiAgICB9LAogICAgImFzc2lnblRWR0lELmNvdW50cnkiOiBmdW5jdGlvbiAodmFsKSB7CiAgICAgIGlmICh2YWwubGVuZ3RoKSB7CiAgICAgICAgdGhpcy5sb2FkVFZHSURBc3NpZ24odmFsKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmFzc2lnblRWR0lELmNoYW5uZWxzID0gW107CiAgICAgIH0KICAgIH0sCiAgICBtb3ZpZVNlcmllUGxheWxpc3Q6IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgdGhpcy5sb2FkUGxheWxpc3QodmFsKTsKICAgIH0KICB9LAp9Owo="},null]}