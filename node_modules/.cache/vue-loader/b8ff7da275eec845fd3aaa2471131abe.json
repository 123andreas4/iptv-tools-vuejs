{"remainingRequest":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/vue-loader/lib/index.js??vue-loader-options!/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/src/views/app/m3u/editor.vue?vue&type=script&lang=js&","dependencies":[{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/src/views/app/m3u/editor.vue","mtime":1625832793910},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCi8qIGVzbGludC1kaXNhYmxlIHZ1ZS9uby1zaWRlLWVmZmVjdHMtaW4tY29tcHV0ZWQtcHJvcGVydGllcyAqLwovKiBlc2xpbnQtZGlzYWJsZSBuby11bnVzZWQtdmFycyAqLwovKiBlc2xpbnQtZGlzYWJsZSBuby11c2VsZXNzLWVzY2FwZSAqLwoKaW1wb3J0IHsgRXZlbnRCdXMgfSBmcm9tICIuLi8uLi8uLi9zZXJ2aWNlcy9lYnVzIjsKaW1wb3J0IHsgaHR0cFNlcnZpY2UgfSBmcm9tICIuLi8uLi8uLi9zZXJ2aWNlcy9odHRwIjsKaW1wb3J0IHsgbWFwR2V0dGVycyB9IGZyb20gInZ1ZXgiOwppbXBvcnQgZHJhZ2dhYmxlIGZyb20gInZ1ZWRyYWdnYWJsZSI7CmltcG9ydCB7IFN1YnNjcmlwdGlvblR5cGUgfSBmcm9tICIuLi8uLi8uLi9jb25zdGFudHMvY29uZmlnIjsKaW1wb3J0IHsgY291bnRyaWVzIH0gZnJvbSAiLi4vLi4vLi4vaGVscGVycyI7CmltcG9ydCB7IG0zdSB9IGZyb20gIi4uLy4uLy4uL3BsdWdpbnMvbTN1IjsKCmV4cG9ydCBkZWZhdWx0IHsKICBjb21wb25lbnRzOiB7CiAgICBkcmFnZ2FibGUsCiAgfSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgZGF0ZU9wdGlvbnM6IHsgZGF5OiAiMi1kaWdpdCIsIG1vbnRoOiAibnVtZXJpYyIsIHllYXI6ICJudW1lcmljIiB9LAogICAgICBjb3VudHJpZXMsCiAgICAgIGFjdGl2ZVRhYjogMCwKICAgICAgYWN0aXZlR3JvdXA6IC0xLAogICAgICBhY3RpdmVHcm91cHM6IFtdLAogICAgICBhY3RpdmVTdHJlYW06IC0xLAogICAgICBhY3RpdmVTdHJlYW1zOiBbXSwKICAgICAgZHJhZ0dyb3VwOiBmYWxzZSwKICAgICAgZHJhZ1N0cmVhbTogZmFsc2UsCiAgICAgIGVkaXRvcjogZmFsc2UsCiAgICAgIHNlYXJjaDogbnVsbCwKICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgcGxheWxpc3RFZGl0b3I6IHsKICAgICAgICBpZDogdW5kZWZpbmVkLAogICAgICAgIHBsYXlsaXN0OiBudWxsLAogICAgICAgIGdyb3VwczogW10sCiAgICAgICAgc3RyZWFtczogW10sCiAgICAgICAgY2hhbmdlZDogZmFsc2UsCiAgICAgIH0sCiAgICAgIGZpbmRSZXBsYWNlOiB7CiAgICAgICAgdHlwZTogMCwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgZnJvbTogIiIsCiAgICAgICAgdG86ICIiLAogICAgICAgIHJlcGxhY2VBbGw6IGZhbHNlLAogICAgICAgIGlnbm9yZUNhc2U6IGZhbHNlLAogICAgICAgIHNlbGVjdGVkT25seTogMCwKICAgICAgfSwKICAgICAgcHJlZml4U3VmZml4OiB7CiAgICAgICAgdHlwZTogMCwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgcHJlZml4OiAiIiwKICAgICAgICBzdWZmaXg6ICIiLAogICAgICAgIHNlbGVjdGVkT25seTogMCwKICAgICAgfSwKICAgICAgY29udmVydENhc2U6IHsKICAgICAgICB0eXBlOiAwLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBtZXRob2Q6IDAsCiAgICAgICAgc2VsZWN0ZWRPbmx5OiAwLAogICAgICB9LAogICAgICBncm91cEVkaXRvcjogewogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBpZDogMCwKICAgICAgICBncm91cF9uYW1lOiAiIiwKICAgICAgICBncm91cF9wYXJlbnRfY29kZTogIiIsCiAgICAgICAgZ3JvdXBfdHlwZTogMSwKICAgICAgICBncm91cF9pc19oaWRkZW46IDAsCiAgICAgIH0sCiAgICAgIHN0cmVhbUVkaXRvcjogewogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBpZDogLTEsCiAgICAgICAgc3RyZWFtX3R2Z19uYW1lOiAiIiwKICAgICAgICBzdHJlYW1fdHZnX2lkOiAiIiwKICAgICAgICBzdHJlYW1fdHZnX2xvZ286ICIiLAogICAgICAgIHN0cmVhbV90dmdfY2hubzogIiIsCiAgICAgICAgc3RyZWFtX3R2Z19zaGlmdDogIiIsCiAgICAgICAgc3RyZWFtX3BhcmVudF9jb2RlOiAiIiwKICAgICAgICBzdHJlYW1fYXVkaW9fdHJhY2s6ICIiLAogICAgICAgIHN0cmVhbV9hc3BlY3RfcmF0aW86ICIiLAogICAgICAgIHN0cmVhbV9yYWRpbzogMCwKICAgICAgICBzdHJlYW1faXNfaGlkZGVuOiAwLAogICAgICAgIHN0cmVhbV9pc19jdXN0b206IDAsCiAgICAgICAgbW92aWVfbmFtZTogIiIsCiAgICAgICAgbW92aWVfeWVhcjogIiIsCiAgICAgICAgc2VyaWVfbmFtZTogIiIsCiAgICAgICAgc2VyaWVfc2Vhc29uOiAwLAogICAgICAgIHNlcmllX2VwaXNvZGU6IDAsCiAgICAgICAgc291cmNlX3N0cmVhbV91cmw6ICIiLAogICAgICB9LAogICAgICByYWRpb0Jyb3dzZXI6IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBib3VuY2U6IG51bGwsCiAgICAgICAgYWN0aXZlOiBbXSwKICAgICAgICBzZWFyY2g6ICIiLAogICAgICAgIHJlc3VsdHM6IFtdLAogICAgICB9LAogICAgICBzb3VuZGNsb3VkOiB7CiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgYm91bmNlOiBudWxsLAogICAgICAgIHVybDogIiIsCiAgICAgICAgdHJhY2s6IG51bGwsCiAgICAgIH0sCiAgICAgIHlvdXR1YmU6IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBib3VuY2U6IG51bGwsCiAgICAgICAgdXJsOiAiIiwKICAgICAgICB2aWRlb0lkOiAiIiwKICAgICAgICB2aWRlbzogbnVsbCwKICAgICAgfSwKICAgICAgdmltZW86IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBib3VuY2U6IG51bGwsCiAgICAgICAgdXJsOiAiIiwKICAgICAgICB2aWRlb0lkOiAiIiwKICAgICAgICB2aWRlbzogbnVsbCwKICAgICAgfSwKICAgICAgZGFpbHltb3Rpb246IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBib3VuY2U6IG51bGwsCiAgICAgICAgdXJsOiAiIiwKICAgICAgICB2aWRlb0lkOiAiIiwKICAgICAgICB2aWRlbzogbnVsbCwKICAgICAgfSwKICAgICAgdGVkVGFsa3M6IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBib3VuY2U6IG51bGwsCiAgICAgICAgdXJsOiAiIiwKICAgICAgICB2aWRlbzogbnVsbCwKICAgICAgfSwKICAgICAgeGhhbXN0ZXI6IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBib3VuY2U6IG51bGwsCiAgICAgICAgdXJsOiAiIiwKICAgICAgICB2aWRlbzogbnVsbCwKICAgICAgfSwKICAgICAgZmluZExvZ286IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBjb3VudHJpZXM6IFtdLAogICAgICAgIGNvdW50cnk6ICIiLAogICAgICAgIGxvZ29zOiBbXSwKICAgICAgICBsb2dvOiAiIiwKICAgICAgICBzZWFyY2g6ICIiLAogICAgICAgIHRpdGxlOiAiIiwKICAgICAgfSwKICAgICAgYXNzaWduTG9nbzogewogICAgICAgIGlzTG9hZGluZzogZmFsc2UsCiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIGNvdW50cmllczogW10sCiAgICAgICAgY291bnRyeTogIiIsCiAgICAgICAgbG9nb3M6IFtdLAogICAgICAgIGFzc2lnbkFsbDogMCwKICAgICAgfSwKICAgICAgaW1wb3J0TTNVOiB7CiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgZ3JvdXBzOiBbXSwKICAgICAgICBpbXBvcnRHcm91cHM6IFtdLAogICAgICAgIG0zdTogbnVsbCwKICAgICAgICBmaWxlOiBudWxsLAogICAgICB9LAogICAgICBmaW5kVFZHSUQ6IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBjb3VudHJpZXM6IFtdLAogICAgICAgIGNvdW50cnk6ICIiLAogICAgICAgIGNoYW5uZWxzOiBbXSwKICAgICAgICBjaGFubmVsOiAiIiwKICAgICAgICBzZWFyY2g6ICIiLAogICAgICAgIHRpdGxlOiAiIiwKICAgICAgfSwKICAgICAgZmluZFNpcHR2OiB7CiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgY291bnRyaWVzOiBbXSwKICAgICAgICBjb3VudHJ5OiAiIiwKICAgICAgICBjaGFubmVsczogW10sCiAgICAgICAgY2hhbm5lbDogIiIsCiAgICAgICAgc2VhcmNoOiAiIiwKICAgICAgICB0aXRsZTogIiIsCiAgICAgIH0sCiAgICAgIGFzc2lnblRWR0lEOiB7CiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgY291bnRyaWVzOiBbXSwKICAgICAgICBjb3VudHJ5OiAiIiwKICAgICAgICBjaGFubmVsczogW10sCiAgICAgICAgYXNzaWduQWxsOiAwLAogICAgICB9LAogICAgICBhc3NpZ25TSVBUVjogewogICAgICAgIGlzTG9hZGluZzogZmFsc2UsCiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIGNvdW50cmllczogW10sCiAgICAgICAgY291bnRyeTogIiIsCiAgICAgICAgY2hhbm5lbHM6IFtdLAogICAgICAgIGFzc2lnbkFsbDogMCwKICAgICAgfSwKICAgICAgc2F2ZUNoYW5nZXM6IHsKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgIH0sCiAgICAgIGdyb3VwVHlwZXM6IFsKICAgICAgICB7IHRleHQ6IHRoaXMuJHQoInh0cmVhbS5saXZlIiksIHZhbHVlOiAxIH0sCiAgICAgICAgeyB0ZXh0OiB0aGlzLiR0KCJ4dHJlYW0ubW92aWVzIiksIHZhbHVlOiAyIH0sCiAgICAgICAgeyB0ZXh0OiB0aGlzLiR0KCJ4dHJlYW0uc2VyaWVzIiksIHZhbHVlOiAzIH0sCiAgICAgIF0sCiAgICB9OwogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIC4uLm1hcEdldHRlcnMoWwogICAgICAiY3VycmVudFVzZXIiLAogICAgICAic2V0dGluZ3MiLAogICAgICAic291bmRjbG91ZENsaWVudElkIiwKICAgICAgIm1vdmllU2VyaWVQbGF5bGlzdCIsCiAgICBdKSwKICAgIHNlYXJjaEZpbHRlcmVkKCkgewogICAgICBpZiAodGhpcy5zZWFyY2ggPT09IG51bGwpIHsKICAgICAgICByZXR1cm4gdGhpcy5hY2NvdW50czsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgcmUgPSBuZXcgUmVnRXhwKHRoaXMuc2VhcmNoLCAiaSIpOwogICAgICAgIHJldHVybiB0aGlzLmFjY291bnRzLmZpbHRlcigoYWNjb3VudCkgPT4gewogICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgU3RyaW5nKGFjY291bnQudGl0bGUpLm1hdGNoKHJlKSB8fAogICAgICAgICAgICBTdHJpbmcoYWNjb3VudC5ob3N0KS5tYXRjaChyZSkgfHwKICAgICAgICAgICAgU3RyaW5nKGFjY291bnQucG9ydCkubWF0Y2gocmUpIHx8CiAgICAgICAgICAgIFN0cmluZyhhY2NvdW50LnVzZXJuYW1lKS5tYXRjaChyZSkgfHwKICAgICAgICAgICAgU3RyaW5nKGFjY291bnQucGFzc3dvcmQpLm1hdGNoKHJlKSB8fAogICAgICAgICAgICB0aGlzLmZvcm1hdERhdGUoYWNjb3VudC5zeW5jZWRfYXQpLm1hdGNoKHJlKSB8fAogICAgICAgICAgICB0aGlzLiR0KGBzeW5jLWludGVydmFsLiR7YWNjb3VudC5zeW5jX2ludGVydmFsfWApLm1hdGNoKHJlKQogICAgICAgICAgKTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIHBsYXlsaXN0U2VsZWN0ZWQoKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkICE9PSB1bmRlZmluZWQ7CiAgICB9LAogICAgbGFzdFNlbGVjdGVkR3JvdXAoKSB7CiAgICAgIHJldHVybiB0aGlzLmFjdGl2ZUdyb3Vwc1t0aGlzLmFjdGl2ZUdyb3Vwcy5sZW5ndGggLSAxXTsKICAgIH0sCiAgICBsYXN0U2VsZWN0ZWRTdHJlYW0oKSB7CiAgICAgIHJldHVybiB0aGlzLmFjdGl2ZVN0cmVhbXNbdGhpcy5hY3RpdmVTdHJlYW1zLmxlbmd0aCAtIDFdOwogICAgfSwKICAgIGNhbkVkaXRHcm91cFR5cGUoKSB7CiAgICAgIHJldHVybiAoCiAgICAgICAgdGhpcy5ncm91cEVkaXRvci5pZCAmJgogICAgICAgIHRoaXMuZ2V0R3JvdXBXaXRoSWQodGhpcy5ncm91cEVkaXRvci5pZCkuc3RyZWFtcyA9PSAwCiAgICAgICk7CiAgICB9LAogICAgc3Vic2NyaXB0aW9uTGltaXRlZCgpIHsKICAgICAgcmV0dXJuICgKICAgICAgICB0aGlzLmN1cnJlbnRVc2VyLnN1YnNjcmlwdGlvbiAmJgogICAgICAgIHRoaXMuY3VycmVudFVzZXIuc3Vic2NyaXB0aW9uLnN1YnNjcmlwdGlvbl90eXBlID09CiAgICAgICAgICBTdWJzY3JpcHRpb25UeXBlLkVudGh1c2lhc3QKICAgICAgKTsKICAgIH0sCiAgICBmaWx0ZXJlZEdyb3VwcygpIHsKICAgICAgaWYgKHRoaXMuc3Vic2NyaXB0aW9uTGltaXRlZCkgewogICAgICAgIHJldHVybiB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maWx0ZXIoCiAgICAgICAgICAoZ3JvdXApID0+CiAgICAgICAgICAgIGdyb3VwLmdyb3VwX2lzX3JlbW92ZWQgIT09IDEgJiYKICAgICAgICAgICAgZ3JvdXAuc291cmNlX2dyb3VwX3R5cGUgPT0gMSAmJgogICAgICAgICAgICBncm91cC5ncm91cF90eXBlID09IDEKICAgICAgICApOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maWx0ZXIoCiAgICAgICAgKGdyb3VwKSA9PiBncm91cC5ncm91cF9pc19yZW1vdmVkICE9PSAxCiAgICAgICk7CiAgICB9LAogICAgZmlsdGVyZWRTdHJlYW1zKCkgewogICAgICByZXR1cm4gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmZpbHRlcigKICAgICAgICAoZ3JvdXApID0+IGdyb3VwLnN0cmVhbV9pc19yZW1vdmVkICE9PSAxCiAgICAgICk7CiAgICB9LAogICAgYWN0aXZlR3JvdXBUeXBlKCkgewogICAgICBsZXQgaW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoCiAgICAgICAgKGdyb3VwKSA9PiBncm91cC5pZCA9PSB0aGlzLmFjdGl2ZUdyb3VwCiAgICAgICk7CiAgICAgIHJldHVybiBpbmRleCA+IC0xID8gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaW5kZXhdLmdyb3VwX3R5cGUgOiAwOwogICAgfSwKICAgIGZpbHRlcmVkTG9nb3MoKSB7CiAgICAgIGlmICghdGhpcy5maW5kTG9nby5zZWFyY2gubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZmluZExvZ28ubG9nb3M7CiAgICAgIH0KICAgICAgbGV0IHNlbGVjdGVkU3RyZWFtID0gdGhpcy5nZXRTdHJlYW1XaXRoSWQodGhpcy5hY3RpdmVTdHJlYW1zWzBdKTsKICAgICAgbGV0IHJlID0gbmV3IFJlZ0V4cCh0aGlzLmZpbmRMb2dvLnNlYXJjaCwgImkiKTsKICAgICAgcmV0dXJuIHRoaXMuZmluZExvZ28ubG9nb3MuZmlsdGVyKChsb2dvKSA9PiB7CiAgICAgICAgcmV0dXJuIGxvZ28udGV4dC5tYXRjaChyZSk7CiAgICAgIH0pOwogICAgfSwKICAgIGZpbHRlcmVkVFZHSURTKCkgewogICAgICBpZiAoIXRoaXMuZmluZFRWR0lELnNlYXJjaC5sZW5ndGgpIHsKICAgICAgICByZXR1cm4gdGhpcy5maW5kVFZHSUQuY2hhbm5lbHM7CiAgICAgIH0KICAgICAgbGV0IHNlbGVjdGVkU3RyZWFtID0gdGhpcy5nZXRTdHJlYW1XaXRoSWQodGhpcy5hY3RpdmVTdHJlYW1zWzBdKTsKICAgICAgbGV0IHJlID0gbmV3IFJlZ0V4cCh0aGlzLmZpbmRUVkdJRC5zZWFyY2gsICJpIik7CiAgICAgIHJldHVybiB0aGlzLmZpbmRUVkdJRC5jaGFubmVscy5maWx0ZXIoKGNoYW5uZWwpID0+IHsKICAgICAgICByZXR1cm4gY2hhbm5lbC50ZXh0Lm1hdGNoKHJlKTsKICAgICAgfSk7CiAgICB9LAogICAgZmlsdGVyZWRTaXB0dklEUygpIHsKICAgICAgaWYgKCF0aGlzLmZpbmRTaXB0di5zZWFyY2gubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZmluZFNpcHR2LmNoYW5uZWxzOwogICAgICB9CiAgICAgIGxldCBzZWxlY3RlZFN0cmVhbSA9IHRoaXMuZ2V0U3RyZWFtV2l0aElkKHRoaXMuYWN0aXZlU3RyZWFtc1swXSk7CiAgICAgIGxldCByZSA9IG5ldyBSZWdFeHAodGhpcy5maW5kU2lwdHYuc2VhcmNoLCAiaSIpOwogICAgICByZXR1cm4gdGhpcy5maW5kU2lwdHYuY2hhbm5lbHMuZmlsdGVyKChjaGFubmVsKSA9PiB7CiAgICAgICAgcmV0dXJuIGNoYW5uZWwudGV4dC5tYXRjaChyZSk7CiAgICAgIH0pOwogICAgfSwKICAgIGdyb3VwQ29udGV4dE1lbnUoKSB7CiAgICAgIGxldCB2bSA9IHRoaXM7CiAgICAgIHJldHVybiBbCiAgICAgICAgewogICAgICAgICAgaWNvbjogImxhLXBsdXMiLAogICAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5hZGQtZ3JvdXAiKSwKICAgICAgICAgIG9uQ2xpY2s6IHZtLmFkZEdyb3VwLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgZGlzYWJsZWQ6IHZtLmFjdGl2ZUdyb3Vwcy5sZW5ndGggIT09IDEsCiAgICAgICAgICBpY29uOiAibGEtZWRpdCIsCiAgICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLmVkaXQtZ3JvdXAiKSwKICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKHZtLmFjdGl2ZUdyb3Vwcy5sZW5ndGggPT09IDEpIHsKICAgICAgICAgICAgICB2bS5lZGl0R3JvdXBNb2RhbCh0cnVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGRpdmlkZXI6IHRydWUsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICB0ZXh0OiB2bS4kdCgiZ2VuZXJhbC5zZWxlY3QtYWxsIiksCiAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZtLmFjdGl2ZUdyb3VwcyA9IFsuLi52bS5wbGF5bGlzdEVkaXRvci5ncm91cHMubWFwKChnKSA9PiBnLmlkKV07CiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgdGV4dDogdm0uJHQoImdlbmVyYWwuc2VsZWN0LW5vbmUiKSwKICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdm0uYWN0aXZlR3JvdXBzID0gW107CiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgZGl2aWRlcjogdHJ1ZSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGljb246ICJsYS1zZWFyY2giLAogICAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5maW5kLXJlcGxhY2UiKSwKICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdm0uZmluZEFuZFJlcGxhY2VNb2RhbCh0cnVlLCAxKTsKICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBpY29uOiAibGEtcGVuIiwKICAgICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IuYWRkLXByZWZpeC1zdWZmaXgiKSwKICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdm0ucHJlZml4U3VmZml4TW9kYWwodHJ1ZSwgMSk7CiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgaWNvbjogImxhLWZvbnQiLAogICAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5jaGFuZ2UtY2FzZSIpLAogICAgICAgICAgb25DbGljazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2bS5jb252ZXJ0Q2FzZU1vZGFsKHRydWUsIDEpOwogICAgICAgICAgfSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGRpdmlkZXI6IHRydWUsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBkaXNhYmxlZDogdm0uYWN0aXZlR3JvdXBzLmxlbmd0aCA9PT0gMCwKICAgICAgICAgIGljb246ICJsYS1leWUiLAogICAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci50b2dnbGUtdmlzaWJpbGl0eSIpLAogICAgICAgICAgb25DbGljazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICBpZiAodm0uYWN0aXZlR3JvdXBzLmxlbmd0aCkgewogICAgICAgICAgICAgIHZtLnRvZ2dsZUdyb3VwVmlzaWJpbGl0eSgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgZGlzYWJsZWQ6IHZtLmFjdGl2ZUdyb3Vwcy5sZW5ndGggPT09IDAsCiAgICAgICAgICBpY29uOiAibGEtdHJhc2giLAogICAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5kZWxldGUiKSwKICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKHZtLmFjdGl2ZUdyb3Vwcy5sZW5ndGgpIHsKICAgICAgICAgICAgICB2bS5kZWxldGVTZWxlY3RlZEdyb3VwcygpOwogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgIF07CiAgICB9LAogICAgc3RyZWFtQ29udGV4dE1lbnUoKSB7CiAgICAgIGxldCB2bSA9IHRoaXM7CiAgICAgIHJldHVybiBbCiAgICAgICAgewogICAgICAgICAgaWNvbjogImxhLXBsdXMiLAogICAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5hZGQtc3RyZWFtIiksCiAgICAgICAgICBvbkNsaWNrOiB2bS5hZGRTdHJlYW0sCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBkaXNhYmxlZDogdm0uYWN0aXZlU3RyZWFtcy5sZW5ndGggIT09IDEsCiAgICAgICAgICBpY29uOiAibGEtZWRpdCIsCiAgICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLmVkaXQtc3RyZWFtIiksCiAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmICh2bS5hY3RpdmVTdHJlYW1zLmxlbmd0aCA9PT0gMSkgewogICAgICAgICAgICAgIHZtLmVkaXRTdHJlYW1Nb2RhbCh0cnVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGRpdmlkZXI6IHRydWUsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICB0ZXh0OiB2bS4kdCgiZ2VuZXJhbC5zZWxlY3QtYWxsIiksCiAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZtLmFjdGl2ZVN0cmVhbXMgPSBbLi4udm0ucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5tYXAoKGcpID0+IGcuaWQpXTsKICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICB0ZXh0OiB2bS4kdCgiZ2VuZXJhbC5zZWxlY3Qtbm9uZSIpLAogICAgICAgICAgb25DbGljazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2bS5hY3RpdmVTdHJlYW1zID0gW107CiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgZGl2aWRlcjogdHJ1ZSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGRpc2FibGVkOgogICAgICAgICAgICB2bS5hY3RpdmVHcm91cHMubGVuZ3RoICE9PSAxIHx8CiAgICAgICAgICAgIHZtLmFjdGl2ZVN0cmVhbXMubGVuZ3RoID09PSAwIHx8CiAgICAgICAgICAgIHZtLmdldEdyb3VwV2l0aElkKHZtLmFjdGl2ZUdyb3Vwc1swXSkuZ3JvdXBfdHlwZSAhPT0KICAgICAgICAgICAgICB2bS5hY3RpdmVHcm91cFR5cGUgfHwKICAgICAgICAgICAgdm0uYWN0aXZlR3JvdXBzWzBdID09PSB2bS5hY3RpdmVHcm91cCwKICAgICAgICAgIGljb246ICJsYS1jaGV2cm9uLWxlZnQiLAogICAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5tb3ZlLXRvLXNlbGVjdGVkLWdyb3VwIiksCiAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZtLm1vdmVUb1NlbGVjdGVkR3JvdXAoKTsKICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBkaXZpZGVyOiB0cnVlLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgaWNvbjogImxhLXNlYXJjaCIsCiAgICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLmZpbmQtcmVwbGFjZSIpLAogICAgICAgICAgb25DbGljazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2bS5maW5kQW5kUmVwbGFjZU1vZGFsKHRydWUsIDIpOwogICAgICAgICAgfSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGljb246ICJsYS1wZW4iLAogICAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5hZGQtcHJlZml4LXN1ZmZpeCIpLAogICAgICAgICAgb25DbGljazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2bS5wcmVmaXhTdWZmaXhNb2RhbCh0cnVlLCAyKTsKICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBpY29uOiAibGEtZm9udCIsCiAgICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLmNoYW5nZS1jYXNlIiksCiAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZtLmNvbnZlcnRDYXNlTW9kYWwodHJ1ZSwgMik7CiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgZGl2aWRlcjogdHJ1ZSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGRpc2FibGVkOiB2bS5hY3RpdmVTdHJlYW1zLmxlbmd0aCAhPT0gMSB8fCB2bS5hY3RpdmVHcm91cFR5cGUgIT09IDEsCiAgICAgICAgICBpY29uOiAibGEtcGhvdG8tdmlkZW8iLAogICAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5maW5kLWxvZ28iKSwKICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdm0uZmluZExvZ29Nb2RhbCh0cnVlKTsKICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBkaXNhYmxlZDogdm0uYWN0aXZlU3RyZWFtcy5sZW5ndGggIT09IDEgfHwgdm0uYWN0aXZlR3JvdXBUeXBlICE9PSAxLAogICAgICAgICAgaWNvbjogImxhLXRoLWxpc3QiLAogICAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5maW5kLXR2LWd1aWRlIiksCiAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZtLmZpbmRUVkdJRE1vZGFsKHRydWUpOwogICAgICAgICAgfSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGRpc2FibGVkOiB2bS5hY3RpdmVTdHJlYW1zLmxlbmd0aCAhPT0gMSB8fCB2bS5hY3RpdmVHcm91cFR5cGUgIT09IDEsCiAgICAgICAgICBpY29uOiAibGEtdGgtbGlzdCIsCiAgICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLmZpbmQtc2lwdHYiKSwKICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdm0uZmluZFNpcHR2TW9kYWwodHJ1ZSk7CiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgZGl2aWRlcjogdHJ1ZSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGRpc2FibGVkOiB2bS5hY3RpdmVTdHJlYW1zLmxlbmd0aCA9PT0gMCB8fCB2bS5hY3RpdmVHcm91cFR5cGUgIT09IDEsCiAgICAgICAgICBpY29uOiAibGEtbXVzaWMiLAogICAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci50b2dnbGUtcmFkaW8iKSwKICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKHZtLmFjdGl2ZVN0cmVhbXMubGVuZ3RoICYmIHZtLmFjdGl2ZUdyb3VwVHlwZSA9PSAxKSB7CiAgICAgICAgICAgICAgdm0udG9nZ2xlU3RyZWFtUmFkaW8oKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGRpc2FibGVkOiB2bS5hY3RpdmVTdHJlYW1zLmxlbmd0aCA9PT0gMCwKICAgICAgICAgIGljb246ICJsYS1leWUiLAogICAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci50b2dnbGUtdmlzaWJpbGl0eSIpLAogICAgICAgICAgb25DbGljazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICBpZiAodm0uYWN0aXZlU3RyZWFtcy5sZW5ndGgpIHsKICAgICAgICAgICAgICB2bS50b2dnbGVTdHJlYW1WaXNpYmlsaXR5KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBkaXZpZGVyOiB0cnVlLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgZGlzYWJsZWQ6IHZtLmFjdGl2ZVN0cmVhbXMubGVuZ3RoID09PSAwLAogICAgICAgICAgaWNvbjogImxhLXRyYXNoIiwKICAgICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IuZGVsZXRlIiksCiAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmICh2bS5hY3RpdmVTdHJlYW1zLmxlbmd0aCkgewogICAgICAgICAgICAgIHZtLmRlbGV0ZVNlbGVjdGVkU3RyZWFtcygpOwogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgIF07CiAgICB9LAogIH0sCiAgbWV0aG9kczogewogICAgZ3JvdXBEcmFnQ2hhbmdlZChnKSB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAodGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uZ3JvdXBfb3JkZXIgIT0gaSArIDEpIHsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmdyb3VwX29yZGVyID0gaSArIDE7CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgc3RyZWFtRHJhZ0NoYW5nZWQoZykgewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmICh0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uc3RyZWFtX29yZGVyICE9IGkgKyAxKSB7CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uc3RyZWFtX29yZGVyID0gaSArIDE7CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIG9wZW5Db250ZXh0KGNvbnRleHQpIHsKICAgICAgdGhpcy4kcmVmc1tjb250ZXh0XS5vcGVuKCk7CiAgICB9LAogICAgc2VhcmNoRWRpdG9yKHNlYXJjaCkgewogICAgICBpZiAoc2VhcmNoLmxlbmd0aCA9PT0gMCkgewogICAgICAgIHRoaXMuc2VhcmNoID0gbnVsbDsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNlYXJjaCA9IHNlYXJjaDsKICAgICAgfQogICAgfSwKICAgIHByaW50RWRpdG9yKCkgewogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZWRpdG9yIikucHJpbnQoKTsKICAgIH0sCiAgICBmb3JtYXROdW1iZXIobnVtYmVyKSB7CiAgICAgIHJldHVybiBuZXcgSW50bC5OdW1iZXJGb3JtYXQodGhpcy4kdCgiZGF0ZS5sb2NhbGUiKSkuZm9ybWF0KG51bWJlcik7CiAgICB9LAogICAgZm9ybWF0RGF0ZShkYXRlKSB7CiAgICAgIHJldHVybiBuZXcgRGF0ZShkYXRlKS50b0xvY2FsZVN0cmluZygKICAgICAgICB0aGlzLiR0KCJkYXRlLmxvY2FsZSIpLAogICAgICAgIHRoaXMuZGF0ZU9wdGlvbnMKICAgICAgKTsKICAgIH0sCiAgICBmb3JtYXREYXRlWW91dHViZShkYXRlKSB7CiAgICAgIHJldHVybiBuZXcgRGF0ZShkYXRlKS50b0xvY2FsZURhdGVTdHJpbmcodGhpcy4kdCgiZGF0ZS5sb2NhbGUiKSwgewogICAgICAgIHllYXI6ICJudW1lcmljIiwKICAgICAgICBtb250aDogInNob3J0IiwKICAgICAgICBkYXk6ICJudW1lcmljIiwKICAgICAgfSk7CiAgICB9LAogICAgZm9ybWF0U2Vjb25kcyhzZWMpIHsKICAgICAgdmFyIGQgPSBOdW1iZXIoc2VjKTsKICAgICAgdmFyIGggPSBNYXRoLmZsb29yKGQgLyAzNjAwKTsKICAgICAgdmFyIG0gPSBNYXRoLmZsb29yKChkICUgMzYwMCkgLyA2MCk7CiAgICAgIHZhciBzID0gTWF0aC5mbG9vcigoZCAlIDM2MDApICUgNjApOwoKICAgICAgdmFyIGhvdXIgPSB0aGlzLiR0KCJnZW5lcmFsLmhvdXIiKTsKICAgICAgdmFyIGhvdXJzID0gdGhpcy4kdCgiZ2VuZXJhbC5ob3VycyIpOwogICAgICB2YXIgbWludXRlID0gdGhpcy4kdCgiZ2VuZXJhbC5taW51dGUiKTsKICAgICAgdmFyIG1pbnV0ZXMgPSB0aGlzLiR0KCJnZW5lcmFsLm1pbnV0ZXMiKTsKICAgICAgdmFyIHNlY29uZCA9IHRoaXMuJHQoImdlbmVyYWwuc2Vjb25kIik7CiAgICAgIHZhciBzZWNvbmRzID0gdGhpcy4kdCgiZ2VuZXJhbC5zZWNvbmRzIik7CgogICAgICB2YXIgaERpc3BsYXkgPSBoID4gMCA/IGggKyAoaCA9PSAxID8gYCAke2hvdXJ9IGAgOiBgICR7aG91cnN9IGApIDogIiI7CiAgICAgIHZhciBtRGlzcGxheSA9IG0gPiAwID8gbSArIChtID09IDEgPyBgICR7bWludXRlfSBgIDogYCAke21pbnV0ZXN9IGApIDogIiI7CiAgICAgIHZhciBzRGlzcGxheSA9IHMgPiAwID8gcyArIChzID09IDEgPyBgICR7c2Vjb25kfSBgIDogYCAke3NlY29uZHN9IGApIDogIiI7CiAgICAgIHJldHVybiBoRGlzcGxheSArIG1EaXNwbGF5ICsgc0Rpc3BsYXk7CiAgICB9LAoKICAgIGdldEdyb3VwV2l0aElkKGlkKSB7CiAgICAgIGxldCBpbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleCgKICAgICAgICAoZ3JvdXApID0+IGdyb3VwLmlkID09IGlkCiAgICAgICk7CiAgICAgIHJldHVybiB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpbmRleF07CiAgICB9LAogICAgZ2V0U3RyZWFtV2l0aElkKGlkKSB7CiAgICAgIGxldCBpbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5maW5kSW5kZXgoCiAgICAgICAgKHN0cmVhbSkgPT4gc3RyZWFtLmlkID09IGlkCiAgICAgICk7CiAgICAgIHJldHVybiB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdOwogICAgfSwKICAgIGRvU2F2ZSgpIHsKICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSBmYWxzZTsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgbGV0IGluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KChncm91cCkgPT4gewogICAgICAgICAgcmV0dXJuIGdyb3VwLmlkID09IHRoaXMuYWN0aXZlR3JvdXA7CiAgICAgICAgfSk7CiAgICAgICAgbGV0IHVwZGF0ZUdyb3VwcyA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzCiAgICAgICAgICAuZmlsdGVyKChncm91cCkgPT4gIWdyb3VwLmdyb3VwX2lzX3JlbW92ZWQgJiYgZ3JvdXAubW9kaWZpZWQpCiAgICAgICAgICAubWFwKChncm91cCkgPT4gewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIGlkOiBncm91cC5pZCwKICAgICAgICAgICAgICBncm91cF9uYW1lOiBncm91cC5ncm91cF9uYW1lLAogICAgICAgICAgICAgIGdyb3VwX29yZGVyOiBncm91cC5ncm91cF9vcmRlciwKICAgICAgICAgICAgICBncm91cF90eXBlOiBncm91cC5ncm91cF90eXBlLAogICAgICAgICAgICAgIGdyb3VwX3BhcmVudF9jb2RlOiBncm91cC5ncm91cF9wYXJlbnRfY29kZSwKICAgICAgICAgICAgICBncm91cF9pc19oaWRkZW46IGdyb3VwLmdyb3VwX2lzX2hpZGRlbiwKICAgICAgICAgICAgfTsKICAgICAgICAgIH0pOwogICAgICAgIGxldCBkZWxldGVHcm91cHMgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3VwcwogICAgICAgICAgLmZpbHRlcigoZ3JvdXApID0+IGdyb3VwLmdyb3VwX2lzX3JlbW92ZWQgJiYgZ3JvdXAubW9kaWZpZWQpCiAgICAgICAgICAubWFwKChncm91cCkgPT4gZ3JvdXAuaWQpCiAgICAgICAgICAuam9pbigpOwoKICAgICAgICBsZXQgdXBkYXRlU3RyZWFtczsKICAgICAgICBzd2l0Y2ggKHRoaXMuYWN0aXZlR3JvdXBUeXBlKSB7CiAgICAgICAgICAvLyBMaXZlIHN0cmVhbXMKICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgdXBkYXRlU3RyZWFtcyA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcwogICAgICAgICAgICAgIC5maWx0ZXIoCiAgICAgICAgICAgICAgICAoc3RyZWFtKSA9PiBzdHJlYW0uc3RyZWFtX2lzX3JlbW92ZWQgIT09IDEgJiYgc3RyZWFtLm1vZGlmaWVkCiAgICAgICAgICAgICAgKQogICAgICAgICAgICAgIC5tYXAoKHN0cmVhbSkgPT4gewogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgaWQ6IHN0cmVhbS5pZCwKICAgICAgICAgICAgICAgICAgc291cmNlX3N0cmVhbV91cmw6IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX3VybCwKICAgICAgICAgICAgICAgICAgc3RyZWFtX3R2Z19uYW1lOiBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lLAogICAgICAgICAgICAgICAgICBzdHJlYW1fdHZnX2lkOiBzdHJlYW0uc3RyZWFtX3R2Z19pZCwKICAgICAgICAgICAgICAgICAgc3RyZWFtX3R2Z19sb2dvOiBzdHJlYW0uc3RyZWFtX3R2Z19sb2dvLAogICAgICAgICAgICAgICAgICBzdHJlYW1fdHZnX2Nobm86IHN0cmVhbS5zdHJlYW1fdHZnX2Nobm8sCiAgICAgICAgICAgICAgICAgIHN0cmVhbV90dmdfc2hpZnQ6IHN0cmVhbS5zdHJlYW1fdHZnX3NoaWZ0LAogICAgICAgICAgICAgICAgICBzdHJlYW1fcGFyZW50X2NvZGU6IHN0cmVhbS5zdHJlYW1fcGFyZW50X2NvZGUsCiAgICAgICAgICAgICAgICAgIHN0cmVhbV9hdWRpb190cmFjazogc3RyZWFtLnN0cmVhbV9hdWRpb190cmFjaywKICAgICAgICAgICAgICAgICAgc3RyZWFtX2FzcGVjdF9yYXRpbzogc3RyZWFtLnN0cmVhbV9hc3BlY3RfcmF0aW8sCiAgICAgICAgICAgICAgICAgIHN0cmVhbV9yYWRpbzogc3RyZWFtLnN0cmVhbV9yYWRpbywKICAgICAgICAgICAgICAgICAgc3RyZWFtX2lzX2hpZGRlbjogc3RyZWFtLnN0cmVhbV9pc19oaWRkZW4sCiAgICAgICAgICAgICAgICAgIHN0cmVhbV9vcmRlcjogc3RyZWFtLnN0cmVhbV9vcmRlciwKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgLy8gTW92aWVzCiAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgIHVwZGF0ZVN0cmVhbXMgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMKICAgICAgICAgICAgICAuZmlsdGVyKAogICAgICAgICAgICAgICAgKHN0cmVhbSkgPT4gc3RyZWFtLnN0cmVhbV9pc19yZW1vdmVkICE9PSAxICYmIHN0cmVhbS5tb2RpZmllZAogICAgICAgICAgICAgICkKICAgICAgICAgICAgICAubWFwKChzdHJlYW0pID0+IHsKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgIGlkOiBzdHJlYW0uaWQsCiAgICAgICAgICAgICAgICAgIG1vdmllX25hbWU6IHN0cmVhbS5tb3ZpZV9uYW1lLAogICAgICAgICAgICAgICAgICBtb3ZpZV95ZWFyOiBzdHJlYW0ubW92aWVfeWVhciwKICAgICAgICAgICAgICAgICAgdG1kYl9pZDogc3RyZWFtLnRtZGJfaWQsCiAgICAgICAgICAgICAgICAgIHNvdXJjZV9zdHJlYW1fdXJsOiBzdHJlYW0uc291cmNlX3N0cmVhbV91cmwsCiAgICAgICAgICAgICAgICAgIHN0cmVhbV90dmdfbmFtZTogc3RyZWFtLnN0cmVhbV90dmdfbmFtZSwKICAgICAgICAgICAgICAgICAgc3RyZWFtX3R2Z19pZDogc3RyZWFtLnN0cmVhbV90dmdfaWQsCiAgICAgICAgICAgICAgICAgIHN0cmVhbV90dmdfbG9nbzogc3RyZWFtLnN0cmVhbV90dmdfbG9nbywKICAgICAgICAgICAgICAgICAgc3RyZWFtX3R2Z19jaG5vOiBzdHJlYW0uc3RyZWFtX3R2Z19jaG5vLAogICAgICAgICAgICAgICAgICBzdHJlYW1fdHZnX3NoaWZ0OiBzdHJlYW0uc3RyZWFtX3R2Z19zaGlmdCwKICAgICAgICAgICAgICAgICAgc3RyZWFtX3BhcmVudF9jb2RlOiBzdHJlYW0uc3RyZWFtX3BhcmVudF9jb2RlLAogICAgICAgICAgICAgICAgICBzdHJlYW1fYXVkaW9fdHJhY2s6IHN0cmVhbS5zdHJlYW1fYXVkaW9fdHJhY2ssCiAgICAgICAgICAgICAgICAgIHN0cmVhbV9hc3BlY3RfcmF0aW86IHN0cmVhbS5zdHJlYW1fYXNwZWN0X3JhdGlvLAogICAgICAgICAgICAgICAgICBzdHJlYW1faXNfaGlkZGVuOiBzdHJlYW0uc3RyZWFtX2lzX2hpZGRlbiwKICAgICAgICAgICAgICAgICAgc3RyZWFtX29yZGVyOiBzdHJlYW0uc3RyZWFtX29yZGVyLAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAvLyBTZXJpZXMKICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgdXBkYXRlU3RyZWFtcyA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcwogICAgICAgICAgICAgIC5maWx0ZXIoCiAgICAgICAgICAgICAgICAoc3RyZWFtKSA9PiBzdHJlYW0uc3RyZWFtX2lzX3JlbW92ZWQgIT09IDEgJiYgc3RyZWFtLm1vZGlmaWVkCiAgICAgICAgICAgICAgKQogICAgICAgICAgICAgIC5tYXAoKHN0cmVhbSkgPT4gewogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgaWQ6IHN0cmVhbS5pZCwKICAgICAgICAgICAgICAgICAgc2VyaWVfbmFtZTogc3RyZWFtLnNlcmllX25hbWUsCiAgICAgICAgICAgICAgICAgIHNlcmllX3NlYXNvbjogc3RyZWFtLnNlcmllX3NlYXNvbiwKICAgICAgICAgICAgICAgICAgc2VyaWVfZXBpc29kZTogc3RyZWFtLnNlcmllX2VwaXNvZGUsCiAgICAgICAgICAgICAgICAgIHRtZGJfaWQ6IHN0cmVhbS50bWRiX2lkLAogICAgICAgICAgICAgICAgICBzb3VyY2Vfc3RyZWFtX3VybDogc3RyZWFtLnNvdXJjZV9zdHJlYW1fdXJsLAogICAgICAgICAgICAgICAgICBzdHJlYW1fdHZnX25hbWU6IHN0cmVhbS5zdHJlYW1fdHZnX25hbWUsCiAgICAgICAgICAgICAgICAgIHN0cmVhbV90dmdfaWQ6IHN0cmVhbS5zdHJlYW1fdHZnX2lkLAogICAgICAgICAgICAgICAgICBzdHJlYW1fdHZnX2xvZ286IHN0cmVhbS5zdHJlYW1fdHZnX2xvZ28sCiAgICAgICAgICAgICAgICAgIHN0cmVhbV90dmdfY2hubzogc3RyZWFtLnN0cmVhbV90dmdfY2hubywKICAgICAgICAgICAgICAgICAgc3RyZWFtX3R2Z19zaGlmdDogc3RyZWFtLnN0cmVhbV90dmdfc2hpZnQsCiAgICAgICAgICAgICAgICAgIHN0cmVhbV9wYXJlbnRfY29kZTogc3RyZWFtLnN0cmVhbV9wYXJlbnRfY29kZSwKICAgICAgICAgICAgICAgICAgc3RyZWFtX2F1ZGlvX3RyYWNrOiBzdHJlYW0uc3RyZWFtX2F1ZGlvX3RyYWNrLAogICAgICAgICAgICAgICAgICBzdHJlYW1fYXNwZWN0X3JhdGlvOiBzdHJlYW0uc3RyZWFtX2FzcGVjdF9yYXRpbywKICAgICAgICAgICAgICAgICAgc3RyZWFtX2lzX2hpZGRlbjogc3RyZWFtLnN0cmVhbV9pc19oaWRkZW4sCiAgICAgICAgICAgICAgICAgIHN0cmVhbV9vcmRlcjogc3RyZWFtLnN0cmVhbV9vcmRlciwKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBsZXQgZGVsZXRlU3RyZWFtcyA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcwogICAgICAgICAgLmZpbHRlcigoc3RyZWFtKSA9PiBzdHJlYW0uc3RyZWFtX2lzX3JlbW92ZWQgPT09IDEgJiYgc3RyZWFtLm1vZGlmaWVkKQogICAgICAgICAgLm1hcCgoc3RyZWFtKSA9PiBzdHJlYW0uaWQpCiAgICAgICAgICAuam9pbigpOwoKICAgICAgICBsZXQgcmVxdWVzdHMgPSBbXTsKICAgICAgICBpZiAodXBkYXRlR3JvdXBzLmxlbmd0aCkgewogICAgICAgICAgcmVxdWVzdHMucHVzaCgKICAgICAgICAgICAgaHR0cFNlcnZpY2UucG9zdCgiZWRpdG9yL3VwZGF0ZS1ncm91cHMiLCB7CiAgICAgICAgICAgICAgcGxheWxpc3RfaWQ6IHRoaXMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICAgICAgZ3JvdXBzOiB1cGRhdGVHcm91cHMsCiAgICAgICAgICAgIH0pCiAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICBpZiAoZGVsZXRlR3JvdXBzLmxlbmd0aCkgewogICAgICAgICAgaW5kZXggPSAwOwogICAgICAgICAgcmVxdWVzdHMucHVzaCgKICAgICAgICAgICAgaHR0cFNlcnZpY2UucG9zdCgiZWRpdG9yL2RlbGV0ZS1ncm91cHMiLCB7CiAgICAgICAgICAgICAgcGxheWxpc3RfaWQ6IHRoaXMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICAgICAgZ3JvdXBzOiBkZWxldGVHcm91cHMsCiAgICAgICAgICAgIH0pCiAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICBpZiAodXBkYXRlU3RyZWFtcy5sZW5ndGgpIHsKICAgICAgICAgIHJlcXVlc3RzLnB1c2goCiAgICAgICAgICAgIGh0dHBTZXJ2aWNlLnBvc3QoYGVkaXRvci91cGRhdGUtc3RyZWFtcy8ke3RoaXMuYWN0aXZlR3JvdXBUeXBlfWAsIHsKICAgICAgICAgICAgICBwbGF5bGlzdF9pZDogdGhpcy5wbGF5bGlzdEVkaXRvci5pZCwKICAgICAgICAgICAgICBzdHJlYW1zOiB1cGRhdGVTdHJlYW1zLAogICAgICAgICAgICB9KQogICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgaWYgKGRlbGV0ZVN0cmVhbXMubGVuZ3RoKSB7CiAgICAgICAgICByZXF1ZXN0cy5wdXNoKAogICAgICAgICAgICBodHRwU2VydmljZS5wb3N0KGBlZGl0b3IvZGVsZXRlLXN0cmVhbXMvJHt0aGlzLmFjdGl2ZUdyb3VwVHlwZX1gLCB7CiAgICAgICAgICAgICAgcGxheWxpc3RfaWQ6IHRoaXMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICAgICAgc3RyZWFtczogZGVsZXRlU3RyZWFtcywKICAgICAgICAgICAgfSkKICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIFByb21pc2UuYWxsKHJlcXVlc3RzKS50aGVuKChyZXMpID0+IHsKICAgICAgICAgIHRoaXMubG9hZFBsYXlsaXN0KHRoaXMucGxheWxpc3RFZGl0b3IuaWQsIGluZGV4KTsKICAgICAgICAgIHJlc29sdmUocmVzKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LAogICAgZG9DYW5jZWwoKSB7CiAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgUHJvbWlzZS5hbGwoW3RoaXMucmVzdG9yZUdyb3VwcygpLCB0aGlzLnJlc3RvcmVTdHJlYW1zKCldKS50aGVuKCgpID0+IHsKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSBmYWxzZTsKICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9KTsKICAgIH0sCiAgICBkb1RhYkNoYW5nZSh0YWIpIHsKICAgICAgdGhpcy5hY3RpdmVUYWIgPSB0YWI7CiAgICB9LAogICAgdXBkYXRlR3JvdXBPcmRlcihzb3VyY2UpIHsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgbGV0IGdyb3VwcyA9IFsuLi5zb3VyY2VdOwogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZ3JvdXBzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBncm91cHNbaV0uc291cmNlX2dyb3VwX29yZGVyID0gaSArIDE7CiAgICAgICAgICBncm91cHNbaV0uZ3JvdXBfb3JkZXIgPSBpICsgMTsKICAgICAgICB9CiAgICAgICAgcmVzb2x2ZShncm91cHMpOwogICAgICB9KTsKICAgIH0sCiAgICB1cGRhdGVTdHJlYW1PcmRlcihzb3VyY2UpIHsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgbGV0IHN0cmVhbXMgPSBbLi4uc291cmNlXTsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHN0cmVhbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHN0cmVhbXNbaV0uc291cmNlX3N0cmVhbV9vcmRlciA9IGkgKyAxOwogICAgICAgICAgc3RyZWFtc1tpXS5zdHJlYW1fb3JkZXIgPSBpICsgMTsKICAgICAgICB9CiAgICAgICAgcmVzb2x2ZShzdHJlYW1zKTsKICAgICAgfSk7CiAgICB9LAogICAgcmVzdG9yZUdyb3VwT3JkZXIoKSB7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLnNvcnQoKGEsIGIpID0+CiAgICAgICAgICBhLnNvdXJjZV9ncm91cF9vcmRlciA+IGIuc291cmNlX2dyb3VwX29yZGVyCiAgICAgICAgICAgID8gMQogICAgICAgICAgICA6IGIuc291cmNlX2dyb3VwX29yZGVyID4gYS5zb3VyY2VfZ3JvdXBfb3JkZXIKICAgICAgICAgICAgPyAtMQogICAgICAgICAgICA6IDAKICAgICAgICApOwogICAgICAgIHJlc29sdmUoKTsKICAgICAgfSk7CiAgICB9LAogICAgcmVzdG9yZVN0cmVhbU9yZGVyKCkgewogICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMuc29ydCgoYSwgYikgPT4KICAgICAgICAgIGEuc291cmNlX3N0cmVhbV9vcmRlciA+IGIuc291cmNlX3N0cmVhbV9vcmRlcgogICAgICAgICAgICA/IDEKICAgICAgICAgICAgOiBiLnNvdXJjZV9zdHJlYW1fb3JkZXIgPiBhLnNvdXJjZV9zdHJlYW1fb3JkZXIKICAgICAgICAgICAgPyAtMQogICAgICAgICAgICA6IDAKICAgICAgICApOwogICAgICAgIHJlc29sdmUoKTsKICAgICAgfSk7CiAgICB9LAogICAgcmVzdG9yZUdyb3VwcygpIHsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgdGhpcy5yZXN0b3JlR3JvdXBPcmRlcigpLnRoZW4oKCkgPT4gewogICAgICAgICAgbGV0IGdyb3VwOwogICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBncm91cCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldOwogICAgICAgICAgICBncm91cC5tb2RpZmllZCA9IGZhbHNlOwogICAgICAgICAgICBncm91cC5ncm91cF9pc19yZW1vdmVkID0gMDsKICAgICAgICAgICAgZ3JvdXAuZ3JvdXBfdHlwZSA9IGdyb3VwLnNvdXJjZV9ncm91cF90eXBlOwogICAgICAgICAgICBncm91cC5ncm91cF9uYW1lID0gZ3JvdXAuc291cmNlX2dyb3VwX25hbWU7CiAgICAgICAgICAgIGdyb3VwLnBhcmVudF9jb2RlID0gZ3JvdXAuc291cmNlX2dyb3VwX3BhcmVudF9jb2RlOwogICAgICAgICAgICBncm91cC5ncm91cF9pc19oaWRkZW4gPSBncm91cC5zb3VyY2VfZ3JvdXBfaXNfaGlkZGVuOwogICAgICAgICAgfQogICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0sCiAgICByZXN0b3JlU3RyZWFtcygpIHsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgdGhpcy5yZXN0b3JlU3RyZWFtT3JkZXIoKS50aGVuKCgpID0+IHsKICAgICAgICAgIGxldCBzdHJlYW07CiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBzdHJlYW0gPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV07CiAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IGZhbHNlOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX2lzX3JlbW92ZWQgPSAwOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lID0gc3RyZWFtLnNvdXJjZV9zdHJlYW1fdHZnX25hbWU7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX2lkID0gc3RyZWFtLnNvdXJjZV9zdHJlYW1fdHZnX2lkOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19sb2dvID0gc3RyZWFtLnNvdXJjZV9zdHJlYW1fdHZnX2xvZ287CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX2Nobm8gPSBzdHJlYW0uc291cmNlX3N0cmVhbV90dmdfY2hubzsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfc2hpZnQgPSBzdHJlYW0uc291cmNlX3N0cmVhbV90dmdfc2hpZnQ7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fcGFyZW50X2NvZGUgPSBzdHJlYW0uc291cmNlX3N0cmVhbV9wYXJlbnRfY29kZTsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV9hdWRpb190cmFjayA9IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX2F1ZGlvX3RyYWNrOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX2FzcGVjdF9yYXRpbyA9IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX2FzcGVjdF9yYXRpbzsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV9yYWRpbyA9IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX3JhZGlvOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX29yZGVyID0gc3RyZWFtLnNvdXJjZV9zdHJlYW1fb3JkZXI7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1faXNfaGlkZGVuID0gc3RyZWFtLnNvdXJjZV9zdHJlYW1faXNfaGlkZGVuOwogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgc3RyZWFtLm1vdmllX25hbWUgIT09IHVuZGVmaW5lZCAmJgogICAgICAgICAgICAgIHN0cmVhbS5tb3ZpZV95ZWFyICE9PSB1bmRlZmluZWQKICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgc3RyZWFtLm1vdmllX25hbWUgPSBzdHJlYW0uc291cmNlX21vdmllX25hbWU7CiAgICAgICAgICAgICAgc3RyZWFtLm1vdmllX3llYXIgPSBzdHJlYW0uc291cmNlX21vdmllX3llYXI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgIHN0cmVhbS5zZXJpZV9uYW1lICE9PSB1bmRlZmluZWQgJiYKICAgICAgICAgICAgICBzdHJlYW0uc2VyaWVfc2Vhc29uICE9PSB1bmRlZmluZWQgJiYKICAgICAgICAgICAgICBzdHJlYW0uc2VyaWVfZXBpc29kZSAhPT0gdW5kZWZpbmVkCiAgICAgICAgICAgICkgewogICAgICAgICAgICAgIHN0cmVhbS5zZXJpZV9uYW1lID0gc3RyZWFtLnNvdXJjZV9zZXJpZV9uYW1lOwogICAgICAgICAgICAgIHN0cmVhbS5zZXJpZV9zZWFzb24gPSBzdHJlYW0uc291cmNlX3NlcmllX3NlYXNvbjsKICAgICAgICAgICAgICBzdHJlYW0uc2VyaWVfZXBpc29kZSA9IHN0cmVhbS5zb3VyY2Vfc2VyaWVfZXBpc29kZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0sCiAgICB0b2dnbGVHcm91cFZpc2liaWxpdHkoKSB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cHMuaW5jbHVkZXModGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uaWQpKSB7CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5ncm91cF9pc19oaWRkZW4gPQogICAgICAgICAgICAhdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uZ3JvdXBfaXNfaGlkZGVuOwogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgfSwKICAgIHRvZ2dsZVN0cmVhbVZpc2liaWxpdHkoKSB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHRoaXMuYWN0aXZlU3RyZWFtcy5pbmNsdWRlcyh0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uaWQpKSB7CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uc3RyZWFtX2lzX2hpZGRlbiA9CiAgICAgICAgICAgICF0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uc3RyZWFtX2lzX2hpZGRlbjsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICB9LAogICAgdG9nZ2xlU3RyZWFtUmFkaW8oKSB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHRoaXMuYWN0aXZlU3RyZWFtcy5pbmNsdWRlcyh0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uaWQpKSB7CiAgICAgICAgICBpZiAodGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLnN0cmVhbV9yYWRpbyA9PSAwKSB7CiAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5zdHJlYW1fcmFkaW8gPSAxOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLnN0cmVhbV9yYWRpbyA9IDA7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgfSwKICAgIGRlbGV0ZVNlbGVjdGVkR3JvdXBzKCkgewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBzLmluY2x1ZGVzKHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmlkKSkgewogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uZ3JvdXBfaXNfcmVtb3ZlZCA9IDE7CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICB9LAogICAgZGVsZXRlU2VsZWN0ZWRTdHJlYW1zKCkgewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmICh0aGlzLmFjdGl2ZVN0cmVhbXMuaW5jbHVkZXModGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLmlkKSkgewogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLnN0cmVhbV9pc19yZW1vdmVkID0gMTsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICB9LAogICAgbG9hZFBsYXlsaXN0KHZhbCwgZ3JvdXBfaW5kZXggPSB1bmRlZmluZWQpIHsKICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBpZiAodGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkKSB7CiAgICAgICAgdGhpcy5kb1NhdmUoKTsKICAgICAgfQogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkID0gdmFsOwogICAgICBodHRwU2VydmljZQogICAgICAgIC5nZXQoYGVkaXRvci9ncm91cHMvJHt2YWx9YCkKICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICBpZiAocmVzLnN0YXR1cyA9PT0gdHJ1ZSkgewogICAgICAgICAgICB0aGlzLnVwZGF0ZUdyb3VwT3JkZXIocmVzLmRhdGEpLnRoZW4oKGdyb3VwcykgPT4gewogICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzID0gZ3JvdXBzLm1hcCgoZ3JvdXApID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGdycCA9IE9iamVjdC5hc3NpZ24oe30sIGdyb3VwKTsKICAgICAgICAgICAgICAgIGdycC5zb3VyY2VfZ3JvdXBfcGFyZW50X2NvZGUgPSBncm91cC5ncm91cF9wYXJlbnRfY29kZTsKICAgICAgICAgICAgICAgIGdycC5zb3VyY2VfZ3JvdXBfaXNfaGlkZGVuID0gZ3JvdXAuZ3JvdXBfaXNfaGlkZGVuOwogICAgICAgICAgICAgICAgZ3JwLnNvdXJjZV9ncm91cF9uYW1lID0gZ3JvdXAuZ3JvdXBfbmFtZTsKICAgICAgICAgICAgICAgIGdycC5zb3VyY2VfZ3JvdXBfdHlwZSA9IGdyb3VwLmdyb3VwX3R5cGU7CiAgICAgICAgICAgICAgICBncnAuZ3JvdXBfaXNfcmVtb3ZlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgZ3JwLm1vZGlmaWVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICByZXR1cm4gZ3JwOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIGlmIChncm91cHMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICBpZiAoZ3JvdXBfaW5kZXggPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZUdyb3VwID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbMF0uaWQ7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZUdyb3VwID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbZ3JvdXBfaW5kZXhdLmlkOwogICAgICAgICAgICAgICAgICB0aGlzLmxvYWRTdHJlYW1zKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICB9KTsKICAgIH0sCiAgICB0b2dnbGVHcm91cFNlbGVjdGlvbihpdGVtKSB7CiAgICAgIGxldCBpZHggPSB0aGlzLmFjdGl2ZUdyb3Vwcy5pbmRleE9mKGl0ZW0pOwogICAgICBpZiAoaWR4ICE9PSAtMSkgewogICAgICAgIHRoaXMuYWN0aXZlR3JvdXBzLnNwbGljZShpZHgsIDEpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYWN0aXZlR3JvdXBzLnB1c2goaXRlbSk7CiAgICAgIH0KICAgIH0sCiAgICB0b2dnbGVTdHJlYW1TZWxlY3Rpb24oaXRlbSkgewogICAgICBsZXQgaWR4ID0gdGhpcy5hY3RpdmVTdHJlYW1zLmluZGV4T2YoaXRlbSk7CiAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgdGhpcy5hY3RpdmVTdHJlYW1zLnNwbGljZShpZHgsIDEpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYWN0aXZlU3RyZWFtcy5wdXNoKGl0ZW0pOwogICAgICB9CiAgICB9LAogICAgdG9nZ2xlUmFkaW9icm93c2VyU2VsZWN0aW9uKGl0ZW0pIHsKICAgICAgbGV0IGlkeCA9IHRoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZS5pbmRleE9mKGl0ZW0pOwogICAgICBpZiAoaWR4ICE9PSAtMSkgewogICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZS5zcGxpY2UoaWR4LCAxKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnJhZGlvQnJvd3Nlci5hY3RpdmUucHVzaChpdGVtKTsKICAgICAgfQogICAgfSwKICAgIHRvZ2dsZUltcG9ydE0zVVNlbGVjdGlvbihpdGVtKSB7CiAgICAgIGxldCBpZHggPSB0aGlzLmltcG9ydE0zVS5pbXBvcnRHcm91cHMuaW5kZXhPZihpdGVtKTsKICAgICAgaWYgKGlkeCAhPT0gLTEpIHsKICAgICAgICB0aGlzLmltcG9ydE0zVS5pbXBvcnRHcm91cHMuc3BsaWNlKGlkeCwgMSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5pbXBvcnRNM1UuaW1wb3J0R3JvdXBzLnB1c2goaXRlbSk7CiAgICAgIH0KICAgIH0sCiAgICBpbmRleE9mR3JvdXAoZ3JvdXApIHsKICAgICAgcmV0dXJuIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLm1hcCgoZykgPT4gZy5pZCkuaW5kZXhPZihncm91cCk7CiAgICB9LAogICAgc2VsZWN0R3JvdXBSYW5nZVNlbGVjdGlvbihpdGVtKSB7CiAgICAgIGNvbnN0IGxhc3RJbmRleCA9IHRoaXMuaW5kZXhPZkdyb3VwKHRoaXMubGFzdFNlbGVjdGVkR3JvdXApOwogICAgICBjb25zdCBpdGVtSW5kZXggPSB0aGlzLmluZGV4T2ZHcm91cChpdGVtKTsKICAgICAgY29uc3QgZGlyID0gaXRlbUluZGV4ID4gbGFzdEluZGV4ID8gMSA6IC0xOwogICAgICBmb3IgKGxldCBpID0gbGFzdEluZGV4OyBpICE9IGl0ZW1JbmRleCArIGRpcjsgaSArPSBkaXIpIHsKICAgICAgICBpZiAoIXRoaXMuYWN0aXZlR3JvdXBzLmluY2x1ZGVzKHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmlkKSkgewogICAgICAgICAgdGhpcy5hY3RpdmVHcm91cHMucHVzaCh0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5pZCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgaW5kZXhPZlN0cmVhbShzdHJlYW0pIHsKICAgICAgcmV0dXJuIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5tYXAoKGcpID0+IGcuaWQpLmluZGV4T2Yoc3RyZWFtKTsKICAgIH0sCiAgICBzZWxlY3RTdHJlYW1SYW5nZVNlbGVjdGlvbihpdGVtKSB7CiAgICAgIGNvbnN0IGxhc3RJbmRleCA9IHRoaXMuaW5kZXhPZlN0cmVhbSh0aGlzLmxhc3RTZWxlY3RlZFN0cmVhbSk7CiAgICAgIGNvbnN0IGl0ZW1JbmRleCA9IHRoaXMuaW5kZXhPZlN0cmVhbShpdGVtKTsKICAgICAgY29uc3QgZGlyID0gaXRlbUluZGV4ID4gbGFzdEluZGV4ID8gMSA6IC0xOwogICAgICBmb3IgKGxldCBpID0gbGFzdEluZGV4OyBpICE9IGl0ZW1JbmRleCArIGRpcjsgaSArPSBkaXIpIHsKICAgICAgICBpZiAoIXRoaXMuYWN0aXZlU3RyZWFtcy5pbmNsdWRlcyh0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uaWQpKSB7CiAgICAgICAgICB0aGlzLmFjdGl2ZVN0cmVhbXMucHVzaCh0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uaWQpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHNlbGVjdFJhZGlvYnJvd3NlclJhbmdlU2VsZWN0aW9uKGluZGV4KSB7CiAgICAgIGNvbnN0IGxhc3RJbmRleCA9CiAgICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuYWN0aXZlW3RoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZS5sZW5ndGggLSAxXTsKICAgICAgY29uc3QgZGlyID0gaW5kZXggPiBsYXN0SW5kZXggPyAxIDogLTE7CiAgICAgIGZvciAobGV0IGkgPSBsYXN0SW5kZXg7IGkgIT0gaW5kZXggKyBkaXI7IGkgKz0gZGlyKSB7CiAgICAgICAgaWYgKCF0aGlzLnJhZGlvQnJvd3Nlci5hY3RpdmUuaW5jbHVkZXMoaSkpIHsKICAgICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZS5wdXNoKGkpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHNlbGVjdEltcG9ydE0zVVJhbmdlU2VsZWN0aW9uKGluZGV4KSB7CiAgICAgIGNvbnN0IGxhc3RJbmRleCA9CiAgICAgICAgdGhpcy5pbXBvcnRNM1UuaW1wb3J0R3JvdXBzW3RoaXMuaW1wb3J0TTNVLmltcG9ydEdyb3Vwcy5sZW5ndGggLSAxXTsKICAgICAgY29uc3QgZGlyID0gaW5kZXggPiBsYXN0SW5kZXggPyAxIDogLTE7CiAgICAgIGZvciAobGV0IGkgPSBsYXN0SW5kZXg7IGkgIT0gaW5kZXggKyBkaXI7IGkgKz0gZGlyKSB7CiAgICAgICAgaWYgKCF0aGlzLmltcG9ydE0zVS5pbXBvcnRHcm91cHMuaW5jbHVkZXMoaSkpIHsKICAgICAgICAgIHRoaXMuaW1wb3J0TTNVLmltcG9ydEdyb3Vwcy5wdXNoKGkpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHNlbGVjdEdyb3VwU2VsZWN0aW9uKGl0ZW0pIHsKICAgICAgdGhpcy5hY3RpdmVHcm91cHMubGVuZ3RoID0gMDsKICAgICAgdGhpcy5hY3RpdmVHcm91cHMucHVzaChpdGVtKTsKICAgIH0sCiAgICBzZWxlY3RTdHJlYW1TZWxlY3Rpb24oaXRlbSkgewogICAgICB0aGlzLmFjdGl2ZVN0cmVhbXMubGVuZ3RoID0gMDsKICAgICAgdGhpcy5hY3RpdmVTdHJlYW1zLnB1c2goaXRlbSk7CiAgICB9LAogICAgc2VsZWN0UmFkaW9icm93c2VyU2VsZWN0aW9uKGl0ZW0pIHsKICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuYWN0aXZlLmxlbmd0aCA9IDA7CiAgICAgIHRoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZS5wdXNoKGl0ZW0pOwogICAgfSwKICAgIHNlbGVjdEltcG9ydE0zVVNlbGVjdGlvbihpdGVtKSB7CiAgICAgIHRoaXMuaW1wb3J0TTNVLmltcG9ydEdyb3Vwcy5sZW5ndGggPSAwOwogICAgICB0aGlzLmltcG9ydE0zVS5pbXBvcnRHcm91cHMucHVzaChpdGVtKTsKICAgIH0sCiAgICBmaW5kQW5kUmVwbGFjZU1vZGFsKHNob3csIHR5cGUgPSAxKSB7CiAgICAgIHRoaXMuZmluZFJlcGxhY2UudHlwZSA9IHR5cGU7CiAgICAgIHRoaXMuZmluZFJlcGxhY2UubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGZpbmRBbmRSZXBsYWNlKCkgewogICAgICBsZXQgb3B0aW9ucyA9ICIiOwogICAgICBpZiAodGhpcy5maW5kUmVwbGFjZS5yZXBsYWNlQWxsKSB7CiAgICAgICAgb3B0aW9ucyArPSAiZyI7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuZmluZFJlcGxhY2UuaWdub3JlQ2FzZSkgewogICAgICAgIG9wdGlvbnMgKz0gImkiOwogICAgICB9CiAgICAgIGxldCByZSA9IG5ldyBSZWdFeHAodGhpcy5maW5kUmVwbGFjZS5mcm9tLnJlcGxhY2UoInwiLCAiXFx8IiksIG9wdGlvbnMpOwogICAgICBzd2l0Y2ggKHBhcnNlSW50KHRoaXMuZmluZFJlcGxhY2UudHlwZSkpIHsKICAgICAgICAvLyBHcm91cAogICAgICAgIGNhc2UgMToKICAgICAgICAgIGlmIChwYXJzZUludCh0aGlzLmZpbmRSZXBsYWNlLnNlbGVjdGVkT25seSkgPT09IDEpIHsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlR3JvdXBzLmluY2x1ZGVzKHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmlkKQogICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uZ3JvdXBfbmFtZSA9CiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmdyb3VwX25hbWUucmVwbGFjZSgKICAgICAgICAgICAgICAgICAgICByZSwKICAgICAgICAgICAgICAgICAgICB0aGlzLmZpbmRSZXBsYWNlLnRvCiAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLmZpbHRlcmVkR3JvdXBzLm1hcCgoZ3JvdXApID0+IHsKICAgICAgICAgICAgICBncm91cC5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgZ3JvdXAuZ3JvdXBfbmFtZSA9IGdyb3VwLmdyb3VwX25hbWUucmVwbGFjZSgKICAgICAgICAgICAgICAgIHJlLAogICAgICAgICAgICAgICAgdGhpcy5maW5kUmVwbGFjZS50bwogICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CgogICAgICAgIC8vIFN0cmVhbXMKICAgICAgICBjYXNlIDI6CiAgICAgICAgICBpZiAocGFyc2VJbnQodGhpcy5maW5kUmVwbGFjZS5zZWxlY3RlZE9ubHkpID09PSAxKSB7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgdGhpcy5hY3RpdmVTdHJlYW1zLmluY2x1ZGVzKHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5pZCkKICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMSkgewogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uc3RyZWFtX3R2Z19uYW1lID0KICAgICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uc3RyZWFtX3R2Z19uYW1lLnJlcGxhY2UoCiAgICAgICAgICAgICAgICAgICAgICByZSwKICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmluZFJlcGxhY2UudG8KICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5tb3ZpZV9uYW1lID0KICAgICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0ubW92aWVfbmFtZS5yZXBsYWNlKAogICAgICAgICAgICAgICAgICAgICAgcmUsCiAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZpbmRSZXBsYWNlLnRvCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMykgewogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uc2VyaWVfbmFtZSA9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLnNlcmllX25hbWUucmVwbGFjZSgKICAgICAgICAgICAgICAgICAgICAgIHJlLAogICAgICAgICAgICAgICAgICAgICAgdGhpcy5maW5kUmVwbGFjZS50bwogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLmZpbHRlcmVkU3RyZWFtcy5tYXAoKHN0cmVhbSkgPT4gewogICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMSkgewogICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX25hbWUgPSBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lLnJlcGxhY2UoCiAgICAgICAgICAgICAgICAgIHJlLAogICAgICAgICAgICAgICAgICB0aGlzLmZpbmRSZXBsYWNlLnRvCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDIpIHsKICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICBzdHJlYW0ubW92aWVfbmFtZSA9IHN0cmVhbS5tb3ZpZV9uYW1lLnJlcGxhY2UoCiAgICAgICAgICAgICAgICAgIHJlLAogICAgICAgICAgICAgICAgICB0aGlzLmZpbmRSZXBsYWNlLnRvCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDMpIHsKICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICBzdHJlYW0uc2VyaWVfbmFtZSA9IHN0cmVhbS5zZXJpZV9uYW1lLnJlcGxhY2UoCiAgICAgICAgICAgICAgICAgIHJlLAogICAgICAgICAgICAgICAgICB0aGlzLmZpbmRSZXBsYWNlLnRvCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgICB0aGlzLmZpbmRSZXBsYWNlLm1vZGFsID0gZmFsc2U7CiAgICB9LAogICAgcHJlZml4U3VmZml4TW9kYWwoc2hvdywgdHlwZSA9IDEpIHsKICAgICAgdGhpcy5wcmVmaXhTdWZmaXgudHlwZSA9IHR5cGU7CiAgICAgIHRoaXMucHJlZml4U3VmZml4Lm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBhZGRQcmVmaXhTdWZmaXgoKSB7CiAgICAgIGxldCBwcmVmaXggPSB0aGlzLnByZWZpeFN1ZmZpeC5wcmVmaXg7CiAgICAgIGxldCBzdWZmaXggPSB0aGlzLnByZWZpeFN1ZmZpeC5zdWZmaXg7CiAgICAgIHN3aXRjaCAocGFyc2VJbnQodGhpcy5wcmVmaXhTdWZmaXgudHlwZSkpIHsKICAgICAgICAvLyBHcm91cAogICAgICAgIGNhc2UgMToKICAgICAgICAgIGlmIChwYXJzZUludCh0aGlzLnByZWZpeFN1ZmZpeC5zZWxlY3RlZE9ubHkpID09PSAxKSB7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZUdyb3Vwcy5pbmNsdWRlcyh0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5pZCkKICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmdyb3VwX25hbWUgPQogICAgICAgICAgICAgICAgICBwcmVmaXggKyB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5ncm91cF9uYW1lICsgc3VmZml4OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5maWx0ZXJlZEdyb3Vwcy5tYXAoKGdyb3VwKSA9PiB7CiAgICAgICAgICAgICAgZ3JvdXAubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgIGdyb3VwLmdyb3VwX25hbWUgPSBwcmVmaXggKyBncm91cC5ncm91cF9uYW1lICsgc3VmZml4OwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwoKICAgICAgICAvLyBTdHJlYW0KICAgICAgICBjYXNlIDI6CiAgICAgICAgICBpZiAocGFyc2VJbnQodGhpcy5wcmVmaXhTdWZmaXguc2VsZWN0ZWRPbmx5KSA9PT0gMSkgewogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlU3RyZWFtcy5pbmNsdWRlcyh0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uaWQpCiAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDEpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLnN0cmVhbV90dmdfbmFtZSA9CiAgICAgICAgICAgICAgICAgICAgcHJlZml4ICsKICAgICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uc3RyZWFtX3R2Z19uYW1lICsKICAgICAgICAgICAgICAgICAgICBzdWZmaXg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDIpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLm1vdmllX25hbWUgPQogICAgICAgICAgICAgICAgICAgIHByZWZpeCArIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5tb3ZpZV9uYW1lICsgc3VmZml4OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAzKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5zZXJpZV9uYW1lID0KICAgICAgICAgICAgICAgICAgICBwcmVmaXggKyB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uc2VyaWVfbmFtZSArIHN1ZmZpeDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMSkgewogICAgICAgICAgICAgIHRoaXMuZmlsdGVyZWRTdHJlYW1zLm1hcCgoc3RyZWFtKSA9PiB7CiAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfbmFtZSA9CiAgICAgICAgICAgICAgICAgIHByZWZpeCArIHN0cmVhbS5zdHJlYW1fdHZnX25hbWUgKyBzdWZmaXg7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAyKSB7CiAgICAgICAgICAgICAgdGhpcy5maWx0ZXJlZFN0cmVhbXMubWFwKChzdHJlYW0pID0+IHsKICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICBzdHJlYW0ubW92aWVfbmFtZSA9IHByZWZpeCArIHN0cmVhbS5tb3ZpZV9uYW1lICsgc3VmZml4OwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMykgewogICAgICAgICAgICAgIHRoaXMuZmlsdGVyZWRTdHJlYW1zLm1hcCgoc3RyZWFtKSA9PiB7CiAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgc3RyZWFtLnNlcmllX25hbWUgPSBwcmVmaXggKyBzdHJlYW0uc2VyaWVfbmFtZSArIHN1ZmZpeDsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgICAgdGhpcy5wcmVmaXhTdWZmaXgubW9kYWwgPSBmYWxzZTsKICAgIH0sCiAgICBjb252ZXJ0Q2FzZU1vZGFsKHNob3csIHR5cGUpIHsKICAgICAgdGhpcy5jb252ZXJ0Q2FzZS50eXBlID0gdHlwZTsKICAgICAgdGhpcy5jb252ZXJ0Q2FzZS5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgY2hhbmdlQ2FzZSgpIHsKICAgICAgbGV0IG1ldGhvZCA9IHRoaXMuY29udmVydENhc2UubWV0aG9kOwogICAgICBsZXQgZ3JvdXBzOwogICAgICBsZXQgc3RyZWFtczsKICAgICAgaWYgKHBhcnNlSW50KHRoaXMuY29udmVydENhc2Uuc2VsZWN0ZWRPbmx5KSA9PT0gMSkgewogICAgICAgIGdyb3VwcyA9IHRoaXMuZmlsdGVyZWRHcm91cHMuZmlsdGVyKChncm91cCkgPT4gewogICAgICAgICAgcmV0dXJuIHRoaXMuYWN0aXZlR3JvdXBzLmluY2x1ZGVzKGdyb3VwLmlkKTsKICAgICAgICB9KTsKICAgICAgICBzdHJlYW1zID0gdGhpcy5maWx0ZXJlZFN0cmVhbXMuZmlsdGVyKChzdHJlYW0pID0+IHsKICAgICAgICAgIHJldHVybiB0aGlzLmFjdGl2ZVN0cmVhbXMuaW5jbHVkZXMoc3RyZWFtLmlkKTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBncm91cHMgPSB0aGlzLmZpbHRlcmVkR3JvdXBzOwogICAgICAgIHN0cmVhbXMgPSB0aGlzLmZpbHRlcmVkU3RyZWFtczsKICAgICAgfQogICAgICBzd2l0Y2ggKHBhcnNlSW50KHRoaXMuY29udmVydENhc2UudHlwZSkpIHsKICAgICAgICAvLyBDYXRlZ29yaWVzCiAgICAgICAgY2FzZSAxOgogICAgICAgICAgZ3JvdXBzLm1hcCgoZ3JvdXApID0+IHsKICAgICAgICAgICAgc3dpdGNoIChwYXJzZUludChtZXRob2QpKSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgZ3JvdXAubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgZ3JvdXAuZ3JvdXBfbmFtZSA9IGdyb3VwLmdyb3VwX25hbWUudGl0bGVDYXNlKCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICBncm91cC5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICBncm91cC5ncm91cF9uYW1lID0gZ3JvdXAuZ3JvdXBfbmFtZS50b1VwcGVyQ2FzZSgpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgZ3JvdXAubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgZ3JvdXAuZ3JvdXBfbmFtZSA9IGdyb3VwLmdyb3VwX25hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICAvLyBTdHJlYW1zCiAgICAgICAgY2FzZSAyOgogICAgICAgICAgc3RyZWFtcy5tYXAoKHN0cmVhbSkgPT4gewogICAgICAgICAgICBzd2l0Y2ggKHBhcnNlSW50KG1ldGhvZCkpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDEpIHsKICAgICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfbmFtZSA9IHN0cmVhbS5zdHJlYW1fdHZnX25hbWUudGl0bGVDYXNlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDIpIHsKICAgICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgc3RyZWFtLm1vdmllX25hbWUgPSBzdHJlYW0ubW92aWVfbmFtZS50aXRsZUNhc2UoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMykgewogICAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICBzdHJlYW0uc2VyaWVfbmFtZSA9IHN0cmVhbS5zZXJpZV9uYW1lLnRpdGxlQ2FzZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAxKSB7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX25hbWUgPSBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lLnRvVXBwZXJDYXNlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDIpIHsKICAgICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgc3RyZWFtLm1vdmllX25hbWUgPSBzdHJlYW0ubW92aWVfbmFtZS50b1VwcGVyQ2FzZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAzKSB7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5zZXJpZV9uYW1lID0gc3RyZWFtLnNlcmllX25hbWUudG9VcHBlckNhc2UoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMSkgewogICAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lID0gc3RyZWFtLnN0cmVhbV90dmdfbmFtZS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5tb3ZpZV9uYW1lID0gc3RyZWFtLm1vdmllX25hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMykgewogICAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICBzdHJlYW0uc2VyaWVfbmFtZSA9IHN0cmVhbS5zZXJpZV9uYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgICB0aGlzLmNvbnZlcnRDYXNlLm1vZGFsID0gZmFsc2U7CiAgICB9LAogICAgZWRpdEdyb3VwTW9kYWwoc2hvdykgewogICAgICBsZXQgaW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoCiAgICAgICAgKGdyb3VwKSA9PiBncm91cC5pZCA9PT0gdGhpcy5hY3RpdmVHcm91cHNbMF0KICAgICAgKTsKICAgICAgbGV0IGdyb3VwID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaW5kZXhdOwogICAgICBpZiAoZ3JvdXApIHsKICAgICAgICB0aGlzLmdyb3VwRWRpdG9yLmlkID0gdGhpcy5hY3RpdmVHcm91cHNbMF07CiAgICAgICAgdGhpcy5ncm91cEVkaXRvci5ncm91cF90eXBlID0gZ3JvdXAuZ3JvdXBfdHlwZTsKICAgICAgICB0aGlzLmdyb3VwRWRpdG9yLmdyb3VwX25hbWUgPSBncm91cC5ncm91cF9uYW1lOwogICAgICAgIHRoaXMuZ3JvdXBFZGl0b3IuZ3JvdXBfaXNfaGlkZGVuID0gZ3JvdXAuZ3JvdXBfaXNfaGlkZGVuOwogICAgICAgIHRoaXMuZ3JvdXBFZGl0b3IuZ3JvdXBfcGFyZW50X2NvZGUgPSBncm91cC5ncm91cF9wYXJlbnRfY29kZTsKICAgICAgICB0aGlzLmdyb3VwRWRpdG9yLm1vZGFsID0gc2hvdzsKICAgICAgfQogICAgfSwKICAgIGVkaXRTdHJlYW1Nb2RhbChzaG93KSB7CiAgICAgIGxldCBpbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5maW5kSW5kZXgoCiAgICAgICAgKHN0cmVhbSkgPT4gc3RyZWFtLmlkID09PSB0aGlzLmFjdGl2ZVN0cmVhbXNbMF0KICAgICAgKTsKICAgICAgbGV0IHN0cmVhbSA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF07CiAgICAgIGlmIChzdHJlYW0pIHsKICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5pZCA9IHRoaXMuYWN0aXZlU3RyZWFtc1swXTsKICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1fdHZnX25hbWUgPSBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lOwogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV90dmdfaWQgPSBzdHJlYW0uc3RyZWFtX3R2Z19pZDsKICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1fdHZnX2xvZ28gPSBzdHJlYW0uc3RyZWFtX3R2Z19sb2dvOwogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV90dmdfY2hubyA9IHN0cmVhbS5zdHJlYW1fdHZnX2Nobm87CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX3R2Z19zaGlmdCA9IHN0cmVhbS5zdHJlYW1fdHZnX3NoaWZ0OwogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV9wYXJlbnRfY29kZSA9IHN0cmVhbS5zdHJlYW1fcGFyZW50X2NvZGU7CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX2F1ZGlvX3RyYWNrID0gc3RyZWFtLnN0cmVhbV9hdWRpb190cmFjazsKICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1fYXNwZWN0X3JhdGlvID0gc3RyZWFtLnN0cmVhbV9hc3BlY3RfcmF0aW87CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX3JhZGlvID0gc3RyZWFtLnN0cmVhbV9yYWRpbzsKICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1faXNfaGlkZGVuID0gc3RyZWFtLnN0cmVhbV9pc19oaWRkZW47CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc291cmNlX3N0cmVhbV91cmwgPSBzdHJlYW0uc291cmNlX3N0cmVhbV91cmw7CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX2lzX2N1c3RvbSA9IHN0cmVhbS5zdHJlYW1faXNfY3VzdG9tOwogICAgICAgIGlmICgKICAgICAgICAgIHN0cmVhbS5tb3ZpZV9uYW1lICE9PSB1bmRlZmluZWQgJiYKICAgICAgICAgIHN0cmVhbS5tb3ZpZV95ZWFyICE9PSB1bmRlZmluZWQgJiYKICAgICAgICAgIHN0cmVhbS50bWRiX2lkICE9PSB1bmRlZmluZWQKICAgICAgICApIHsKICAgICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLm1vdmllX25hbWUgPSBzdHJlYW0ubW92aWVfbmFtZTsKICAgICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLm1vdmllX3llYXIgPSBzdHJlYW0ubW92aWVfeWVhcjsKICAgICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnRtZGJfaWQgPSBzdHJlYW0udG1kYl9pZDsKICAgICAgICB9CiAgICAgICAgaWYgKAogICAgICAgICAgc3RyZWFtLnNlcmllX25hbWUgIT09IHVuZGVmaW5lZCAmJgogICAgICAgICAgc3RyZWFtLnNlcmllX3NlYXNvbiAhPT0gdW5kZWZpbmVkICYmCiAgICAgICAgICBzdHJlYW0uc2VyaWVfZXBpc29kZSAhPT0gdW5kZWZpbmVkCiAgICAgICAgKSB7CiAgICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zZXJpZV9uYW1lID0gc3RyZWFtLnNlcmllX25hbWU7CiAgICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zZXJpZV9zZWFzb24gPSBzdHJlYW0uc2VyaWVfc2Vhc29uOwogICAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc2VyaWVfZXBpc29kZSA9IHN0cmVhbS5zZXJpZV9lcGlzb2RlOwogICAgICAgIH0KICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5tb2RhbCA9IHNob3c7CiAgICAgIH0KICAgIH0sCiAgICBlZGl0R3JvdXAoKSB7CiAgICAgIGxldCBpbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleCgKICAgICAgICAoZ3JvdXApID0+IGdyb3VwLmlkID09PSB0aGlzLmdyb3VwRWRpdG9yLmlkCiAgICAgICk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2luZGV4XS5ncm91cF90eXBlID0KICAgICAgICB0aGlzLmdyb3VwRWRpdG9yLmdyb3VwX3R5cGU7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2luZGV4XS5ncm91cF9uYW1lID0KICAgICAgICB0aGlzLmdyb3VwRWRpdG9yLmdyb3VwX25hbWU7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2luZGV4XS5ncm91cF9pc19oaWRkZW4gPQogICAgICAgIHRoaXMuZ3JvdXBFZGl0b3IuZ3JvdXBfaXNfaGlkZGVuOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpbmRleF0uZ3JvdXBfcGFyZW50X2NvZGUgPQogICAgICAgIHRoaXMuZ3JvdXBFZGl0b3IuZ3JvdXBfcGFyZW50X2NvZGU7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2luZGV4XS5tb2RpZmllZCA9IHRydWU7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICAgIHRoaXMuZ3JvdXBFZGl0b3IubW9kYWwgPSBmYWxzZTsKICAgIH0sCiAgICBlZGl0U3RyZWFtKCkgewogICAgICBsZXQgaW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMuZmluZEluZGV4KAogICAgICAgIChzdHJlYW0pID0+IHN0cmVhbS5pZCA9PT0gdGhpcy5hY3RpdmVTdHJlYW1zWzBdCiAgICAgICk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc3RyZWFtX3R2Z19uYW1lID0KICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1fdHZnX25hbWU7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc3RyZWFtX3R2Z19pZCA9CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX3R2Z19pZDsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zdHJlYW1fdHZnX2xvZ28gPQogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV90dmdfbG9nbzsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zdHJlYW1fdHZnX2Nobm8gPQogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV90dmdfY2hubzsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zdHJlYW1fdHZnX3NoaWZ0ID0KICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1fdHZnX3NoaWZ0OwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnN0cmVhbV9wYXJlbnRfY29kZSA9CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX3BhcmVudF9jb2RlOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnN0cmVhbV9hdWRpb190cmFjayA9CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX2F1ZGlvX3RyYWNrOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnN0cmVhbV9hc3BlY3RfcmF0aW8gPQogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV9hc3BlY3RfcmF0aW87CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc3RyZWFtX2lzX2hpZGRlbiA9CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX2lzX2hpZGRlbjsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zdHJlYW1fcmFkaW8gPQogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV9yYWRpbzsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zb3VyY2Vfc3RyZWFtX3VybCA9CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc291cmNlX3N0cmVhbV91cmw7CiAgICAgIGlmICgKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLm1vdmllX25hbWUgIT09IHVuZGVmaW5lZCAmJgogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0ubW92aWVfeWVhciAhPT0gdW5kZWZpbmVkICYmCiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS50bWRiX2lkICE9PSB1bmRlZmluZWQKICAgICAgKSB7CiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5tb3ZpZV9uYW1lID0KICAgICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLm1vdmllX25hbWU7CiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5tb3ZpZV95ZWFyID0KICAgICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLm1vdmllX3llYXI7CiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS50bWRiX2lkID0gdGhpcy5zdHJlYW1FZGl0b3IudG1kYl9pZDsKICAgICAgfQogICAgICBpZiAoCiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zZXJpZV9uYW1lICE9PSB1bmRlZmluZWQgJiYKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnNlcmllX3NlYXNvbiAhPT0gdW5kZWZpbmVkICYmCiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zZXJpZV9lcGlzb2RlICE9PSB1bmRlZmluZWQKICAgICAgKSB7CiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zZXJpZV9uYW1lID0KICAgICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnNlcmllX25hbWU7CiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zZXJpZV9zZWFzb24gPQogICAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc2VyaWVfc2Vhc29uOwogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc2VyaWVfZXBpc29kZSA9CiAgICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zZXJpZV9lcGlzb2RlOwogICAgICB9CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0ubW9kaWZpZWQgPSB0cnVlOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgICB0aGlzLnN0cmVhbUVkaXRvci5tb2RhbCA9IGZhbHNlOwogICAgfSwKICAgIHNvcnRHcm91cEFscGhhVXAoKSB7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuc29ydCgoYSwgYikgPT4KICAgICAgICBiLmdyb3VwX25hbWUgPiBhLmdyb3VwX25hbWUgPyAxIDogYS5ncm91cF9uYW1lID4gYi5ncm91cF9uYW1lID8gLTEgOiAwCiAgICAgICk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLm1hcCgoZ3JvdXApID0+IChncm91cC5tb2RpZmllZCA9IHRydWUpKTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgIH0sCiAgICBzb3J0R3JvdXBBbHBoYURvd24oKSB7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuc29ydCgoYSwgYikgPT4KICAgICAgICBhLmdyb3VwX25hbWUgPiBiLmdyb3VwX25hbWUgPyAxIDogYi5ncm91cF9uYW1lID4gYS5ncm91cF9uYW1lID8gLTEgOiAwCiAgICAgICk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLm1hcCgoZ3JvdXApID0+IChncm91cC5tb2RpZmllZCA9IHRydWUpKTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgIH0sCiAgICBzb3J0R3JvdXBUeXBlVXAoKSB7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuc29ydCgoYSwgYikgPT4KICAgICAgICBiLmdyb3VwX3R5cGUgPiBhLmdyb3VwX3R5cGUgPyAxIDogYS5ncm91cF90eXBlID4gYi5ncm91cF90eXBlID8gLTEgOiAwCiAgICAgICk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLm1hcCgoZ3JvdXApID0+IChncm91cC5tb2RpZmllZCA9IHRydWUpKTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgIH0sCiAgICBzb3J0R3JvdXBUeXBlRG93bigpIHsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5zb3J0KChhLCBiKSA9PgogICAgICAgIGEuZ3JvdXBfdHlwZSA+IGIuZ3JvdXBfdHlwZSA/IDEgOiBiLmdyb3VwX3R5cGUgPiBhLmdyb3VwX3R5cGUgPyAtMSA6IDAKICAgICAgKTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMubWFwKChncm91cCkgPT4gKGdyb3VwLm1vZGlmaWVkID0gdHJ1ZSkpOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgfSwKICAgIHNvcnRTdHJlYW1BbHBoYVVwKCkgewogICAgICAvL0VSTlNUIEhJRVIKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLnNvcnQoKGEsIGIpID0+IHsKICAgICAgICBzd2l0Y2ggKHRoaXMuYWN0aXZlR3JvdXBUeXBlKSB7CiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIHJldHVybiBiLnN0cmVhbV90dmdfbmFtZSA+IGEuc3RyZWFtX3R2Z19uYW1lCiAgICAgICAgICAgICAgPyAxCiAgICAgICAgICAgICAgOiBhLnN0cmVhbV90dmdfbmFtZSA+IGIuc3RyZWFtX3R2Z19uYW1lCiAgICAgICAgICAgICAgPyAtMQogICAgICAgICAgICAgIDogMDsKICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgcmV0dXJuIGIubW92aWVfbmFtZSA+IGEubW92aWVfbmFtZQogICAgICAgICAgICAgID8gMQogICAgICAgICAgICAgIDogYS5tb3ZpZV9uYW1lID4gYi5tb3ZpZV9uYW1lCiAgICAgICAgICAgICAgPyAtMQogICAgICAgICAgICAgIDogMDsKICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgcmV0dXJuIGIuc2VyaWVfbmFtZSA+IGEuc2VyaWVfbmFtZQogICAgICAgICAgICAgID8gMQogICAgICAgICAgICAgIDogYS5zZXJpZV9uYW1lID4gYi5zZXJpZV9uYW1lCiAgICAgICAgICAgICAgPyAtMQogICAgICAgICAgICAgIDogMDsKICAgICAgICB9CiAgICAgIH0pOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubWFwKChzdHJlYW0pID0+IChzdHJlYW0ubW9kaWZpZWQgPSB0cnVlKSk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICB9LAogICAgc29ydFN0cmVhbUFscGhhRG93bigpIHsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLnNvcnQoKGEsIGIpID0+IHsKICAgICAgICBzd2l0Y2ggKHRoaXMuYWN0aXZlR3JvdXBUeXBlKSB7CiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIHJldHVybiBhLnN0cmVhbV90dmdfbmFtZSA+IGIuc3RyZWFtX3R2Z19uYW1lCiAgICAgICAgICAgICAgPyAxCiAgICAgICAgICAgICAgOiBiLnN0cmVhbV90dmdfbmFtZSA+IGEuc3RyZWFtX3R2Z19uYW1lCiAgICAgICAgICAgICAgPyAtMQogICAgICAgICAgICAgIDogMDsKICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgcmV0dXJuIGEubW92aWVfbmFtZSA+IGIubW92aWVfbmFtZQogICAgICAgICAgICAgID8gMQogICAgICAgICAgICAgIDogYi5tb3ZpZV9uYW1lID4gYS5tb3ZpZV9uYW1lCiAgICAgICAgICAgICAgPyAtMQogICAgICAgICAgICAgIDogMDsKICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgcmV0dXJuIGEuc2VyaWVfbmFtZSA+IGIuc2VyaWVfbmFtZQogICAgICAgICAgICAgID8gMQogICAgICAgICAgICAgIDogYi5zZXJpZV9uYW1lID4gYS5zZXJpZV9uYW1lCiAgICAgICAgICAgICAgPyAtMQogICAgICAgICAgICAgIDogMDsKICAgICAgICB9CiAgICAgIH0pOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubWFwKChzdHJlYW0pID0+IChzdHJlYW0ubW9kaWZpZWQgPSB0cnVlKSk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICB9LAogICAgc29ydFN0cmVhbUhpZGRlblVwKCkgewogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMuc29ydCgoYSwgYikgPT4KICAgICAgICBiLnN0cmVhbV9pc19oaWRkZW4gPiBhLnN0cmVhbV9pc19oaWRkZW4KICAgICAgICAgID8gMQogICAgICAgICAgOiBhLnN0cmVhbV9pc19oaWRkZW4gPiBiLnN0cmVhbV9pc19oaWRkZW4KICAgICAgICAgID8gLTEKICAgICAgICAgIDogMAogICAgICApOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubWFwKChncm91cCkgPT4gKGdyb3VwLm1vZGlmaWVkID0gdHJ1ZSkpOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgfSwKICAgIHNvcnRTdHJlYW1IaWRkZW5Eb3duKCkgewogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMuc29ydCgoYSwgYikgPT4KICAgICAgICBhLnN0cmVhbV9pc19oaWRkZW4gPiBiLnN0cmVhbV9pc19oaWRkZW4KICAgICAgICAgID8gMQogICAgICAgICAgOiBiLnN0cmVhbV9pc19oaWRkZW4gPiBhLnN0cmVhbV9pc19oaWRkZW4KICAgICAgICAgID8gLTEKICAgICAgICAgIDogMAogICAgICApOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubWFwKChncm91cCkgPT4gKGdyb3VwLm1vZGlmaWVkID0gdHJ1ZSkpOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgfSwKICAgIGFkZEdyb3VwKCkgewogICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGh0dHBTZXJ2aWNlCiAgICAgICAgLnBvc3QoImVkaXRvci9hZGQtZ3JvdXAiLCB7IHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkIH0pCiAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIGlmIChyZXMuc3RhdHVzID09PSB0cnVlICYmIHJlcy5kYXRhKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLnB1c2gocmVzLmRhdGEpOwogICAgICAgICAgICAgIHRoaXMuYWN0aXZlR3JvdXAgPQogICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbCiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmxlbmd0aCAtIDEKICAgICAgICAgICAgICAgIF0uaWQ7CiAgICAgICAgICAgICAgdGhpcy5hY3RpdmVHcm91cHMgPSBbCiAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1sKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMubGVuZ3RoIC0gMQogICAgICAgICAgICAgICAgXS5pZCwKICAgICAgICAgICAgICBdOwogICAgICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICAgICAgfSkudGhlbigoKSA9PiB7CiAgICAgICAgICAgICAgdGhpcy5lZGl0R3JvdXBNb2RhbCh0cnVlKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIHRoaXMuJG5vdGlmeSgKICAgICAgICAgICAgImVycm9yIiwKICAgICAgICAgICAgdGhpcy4kdCgicHJvZmlsZS5mYWlsZWQiKSwKICAgICAgICAgICAgdGhpcy4kdCgiZWRpdG9yLmFkZC1ncm91cC1lcnJvciIpLAogICAgICAgICAgICAibGEtdXNlci1zaGllbGQiLAogICAgICAgICAgICB7IGR1cmF0aW9uOiA1MDAwLCBwZXJtYW5lbnQ6IGZhbHNlIH0KICAgICAgICAgICk7CiAgICAgICAgfSk7CiAgICB9LAogICAgYWRkU3RyZWFtKCkgewogICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGh0dHBTZXJ2aWNlCiAgICAgICAgLnBvc3QoImVkaXRvci9hZGQtc3RyZWFtIiwgewogICAgICAgICAgcGxheWxpc3RfaWQ6IHRoaXMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICBncm91cF9pZDogdGhpcy5nZXRHcm91cFdpdGhJZCh0aGlzLmFjdGl2ZUdyb3VwKS5pZCwKICAgICAgICAgIHN0cmVhbV90eXBlOiB0aGlzLmdldEdyb3VwV2l0aElkKHRoaXMuYWN0aXZlR3JvdXApLmdyb3VwX3R5cGUsCiAgICAgICAgfSkKICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgaWYgKHJlcy5zdGF0dXMgPT09IHRydWUgJiYgcmVzLmRhdGEpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLnVuc2hpZnQocmVzLmRhdGEpOwogICAgICAgICAgICAgIHRoaXMuYWN0aXZlU3RyZWFtID0KICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1sKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aCAtIDEKICAgICAgICAgICAgICAgIF0uaWQ7CiAgICAgICAgICAgICAgdGhpcy5hY3RpdmVTdHJlYW1zID0gWwogICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zWwogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoIC0gMQogICAgICAgICAgICAgICAgXS5pZCwKICAgICAgICAgICAgICBdOwogICAgICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICAgICAgfSkudGhlbigoKSA9PiB7CiAgICAgICAgICAgICAgdGhpcy5lZGl0U3RyZWFtTW9kYWwodHJ1ZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB0aGlzLiRub3RpZnkoCiAgICAgICAgICAgICJlcnJvciIsCiAgICAgICAgICAgIHRoaXMuJHQoInByb2ZpbGUuZmFpbGVkIiksCiAgICAgICAgICAgIHRoaXMuJHQoImVkaXRvci5hZGQtc3RyZWFtLWVycm9yIiksCiAgICAgICAgICAgICJsYS11c2VyLXNoaWVsZCIsCiAgICAgICAgICAgIHsgZHVyYXRpb246IDUwMDAsIHBlcm1hbmVudDogZmFsc2UgfQogICAgICAgICAgKTsKICAgICAgICB9KTsKICAgIH0sCiAgICBsb2FkU3RyZWFtcygpIHsKICAgICAgdGhpcy5hY3RpdmVTdHJlYW0gPSAtMTsKICAgICAgdGhpcy5hY3RpdmVTdHJlYW1zID0gW107CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcyA9IFtdOwogICAgICBsZXQgaW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoCiAgICAgICAgKGdyb3VwKSA9PiBncm91cC5pZCA9PT0gdGhpcy5hY3RpdmVHcm91cAogICAgICApOwogICAgICBsZXQgZ3JvdXAgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpbmRleF07CiAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAuZ2V0KAogICAgICAgICAgYGVkaXRvci9zdHJlYW1zLyR7dGhpcy5wbGF5bGlzdEVkaXRvci5pZH0vJHtncm91cC5pZH0vJHtncm91cC5ncm91cF90eXBlfWAKICAgICAgICApCiAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgZG9jdW1lbnQuYm9keS5zY3JvbGxUb3AgPSAwOwogICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcCA9IDA7CiAgICAgICAgICBpZiAocmVzLnN0YXR1cyA9PT0gdHJ1ZSkgewogICAgICAgICAgICBsZXQgc3RyZWFtcyA9IHJlcy5kYXRhLm1hcCgoc3RyZWFtKSA9PiB7CiAgICAgICAgICAgICAgY29uc3Qgc3RyID0gT2JqZWN0LmFzc2lnbih7fSwgc3RyZWFtKTsKICAgICAgICAgICAgICBzdHIuc291cmNlX3N0cmVhbV90dmdfbmFtZSA9IHN0cmVhbS5zdHJlYW1fdHZnX25hbWU7CiAgICAgICAgICAgICAgc3RyLnNvdXJjZV9zdHJlYW1fdHZnX2lkID0gc3RyZWFtLnN0cmVhbV90dmdfaWQ7CiAgICAgICAgICAgICAgc3RyLnNvdXJjZV9zdHJlYW1fdHZnX2xvZ28gPSBzdHJlYW0uc3RyZWFtX3R2Z19sb2dvOwogICAgICAgICAgICAgIHN0ci5zb3VyY2Vfc3RyZWFtX3R2Z19jaG5vID0gc3RyZWFtLnN0cmVhbV90dmdfY2hubzsKICAgICAgICAgICAgICBzdHIuc291cmNlX3N0cmVhbV90dmdfc2hpZnQgPSBzdHJlYW0uc3RyZWFtX3R2Z19zaGlmdDsKICAgICAgICAgICAgICBzdHIuc291cmNlX3N0cmVhbV9wYXJlbnRfY29kZSA9IHN0cmVhbS5zdHJlYW1fcGFyZW50X2NvZGU7CiAgICAgICAgICAgICAgc3RyLnNvdXJjZV9zdHJlYW1fYXVkaW9fdHJhY2sgPSBzdHJlYW0uc3RyZWFtX2F1ZGlvX3RyYWNrOwogICAgICAgICAgICAgIHN0ci5zb3VyY2Vfc3RyZWFtX2FzcGVjdF9yYXRpbyA9IHN0cmVhbS5zdHJlYW1fYXNwZWN0X3JhdGlvOwogICAgICAgICAgICAgIHN0ci5zb3VyY2Vfc3RyZWFtX3JhZGlvID0gc3RyZWFtLnN0cmVhbV9yYWRpbzsKICAgICAgICAgICAgICBzdHIuc291cmNlX3N0cmVhbV9vcmRlciA9IHN0cmVhbS5zdHJlYW1fb3JkZXI7CiAgICAgICAgICAgICAgc3RyLnNvdXJjZV9zdHJlYW1faXNfaGlkZGVuID0gc3RyZWFtLnN0cmVhbV9pc19oaWRkZW47CiAgICAgICAgICAgICAgc3RyLm1vZGlmaWVkID0gZmFsc2U7CiAgICAgICAgICAgICAgc3RyLnN0cmVhbV9pc19yZW1vdmVkID0gMDsKICAgICAgICAgICAgICBpZiAoZ3JvdXAuZ3JvdXBfdHlwZSA9PSAyKSB7CiAgICAgICAgICAgICAgICBpZiAoc3RyLm1vdmllX25hbWUgPT0gIiIpIHsKICAgICAgICAgICAgICAgICAgc3RyLm1vdmllX25hbWUgPSBzdHIuc3RyZWFtX3R2Z19uYW1lOwogICAgICAgICAgICAgICAgICBzdHIuc291cmNlX21vdmllX25hbWUgPSBzdHIuc3RyZWFtX3R2Z19uYW1lOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgc3RyLnNvdXJjZV9tb3ZpZV9uYW1lID0gc3RyZWFtLm1vdmllX25hbWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzdHIuc291cmNlX21vdmllX3llYXIgPSBzdHJlYW0ubW92aWVfeWVhcjsKICAgICAgICAgICAgICAgIHN0ci5zb3VyY2VfdG1kYl9pZCA9IHN0cmVhbS50bWRiX2lkOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoZ3JvdXAuZ3JvdXBfdHlwZSA9PSAzKSB7CiAgICAgICAgICAgICAgICBpZiAoc3RyLnNlcmllX25hbWUgPT0gIiIpIHsKICAgICAgICAgICAgICAgICAgc3RyLnNlcmllX25hbWUgPSBzdHIuc3RyZWFtX3R2Z19uYW1lOwogICAgICAgICAgICAgICAgICBzdHIuc291cmNlX3NlcmllX25hbWUgPSBzdHIuc3RyZWFtX3R2Z19uYW1lOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgc3RyLnNvdXJjZV9zZXJpZV9uYW1lID0gc3RyZWFtLnNlcmllX25hbWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzdHIuc291cmNlX3NlcmllX3NlYXNvbiA9IHN0cmVhbS5zZXJpZV9zZWFzb247CiAgICAgICAgICAgICAgICBzdHIuc291cmNlX3NlcmllX2VwaXNvZGUgPSBzdHJlYW0uc2VyaWVfZXBpc29kZTsKICAgICAgICAgICAgICAgIHN0ci5zb3VyY2VfdG1kYl9pZCA9IHN0cmVhbS50bWRiX2lkOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm4gc3RyOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgc3RyZWFtcy5zb3J0KChhLCBiKSA9PgogICAgICAgICAgICAgIGEuc291cmNlX3N0cmVhbV9vcmRlciA+IGIuc291cmNlX3N0cmVhbV9vcmRlcgogICAgICAgICAgICAgICAgPyAxCiAgICAgICAgICAgICAgICA6IGIuc291cmNlX3N0cmVhbV9vcmRlciA+IGEuc291cmNlX3N0cmVhbV9vcmRlcgogICAgICAgICAgICAgICAgPyAtMQogICAgICAgICAgICAgICAgOiAwCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcyA9IHN0cmVhbXM7CiAgICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgfSk7CiAgICB9LAogICAgbW92ZVRvU2VsZWN0ZWRHcm91cCgpIHsKICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBsZXQgc3RyZWFtcyA9IHRoaXMuYWN0aXZlU3RyZWFtcy5qb2luKCk7CiAgICAgIGxldCBpbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleCgoZ3JvdXApID0+IHsKICAgICAgICByZXR1cm4gZ3JvdXAuaWQgPT0gdGhpcy5hY3RpdmVHcm91cDsKICAgICAgfSk7CiAgICAgIGh0dHBTZXJ2aWNlCiAgICAgICAgLnBvc3QoYGVkaXRvci9tb3ZlLXRvLWdyb3VwLyR7dGhpcy5hY3RpdmVHcm91cFR5cGV9YCwgewogICAgICAgICAgcGxheWxpc3RfaWQ6IHRoaXMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICBzdHJlYW1zOiBzdHJlYW1zLAogICAgICAgICAgZ3JvdXBfaWQ6IHRoaXMuYWN0aXZlR3JvdXBzWzBdLAogICAgICAgIH0pCiAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIGlmIChyZXMuc3RhdHVzICYmIHJlcy5kYXRhKSB7CiAgICAgICAgICAgIHRoaXMubG9hZFBsYXlsaXN0KHRoaXMucGxheWxpc3RFZGl0b3IuaWQsIGluZGV4KTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0pOwogICAgfSwKICAgIHNhdmVDaGFuZ2VzTW9kYWwoc2hvdywgc2F2ZSA9IGZhbHNlKSB7CiAgICAgIHRoaXMuc2F2ZUNoYW5nZXMubW9kYWwgPSBzaG93OwogICAgICBpZiAoc2F2ZSkgewogICAgICAgIHRoaXMuZG9TYXZlKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5sb2FkU3RyZWFtcygpOwogICAgICB9CiAgICB9LAogICAgcmFkaW9Ccm93c2VyTW9kYWwoc2hvdywgc2F2ZSA9IGZhbHNlKSB7CiAgICAgIGlmIChzaG93KSB7CiAgICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuc2VhcmNoID0gIiI7CiAgICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIucmVzdWx0cyA9IFtdOwogICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZSA9IFtdOwogICAgICB9CiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlOwogICAgICAgIGxldCBncm91cEluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KChncm91cCkgPT4gewogICAgICAgICAgcmV0dXJuIGdyb3VwLmlkID09IHRoaXMuYWN0aXZlR3JvdXA7CiAgICAgICAgfSk7CiAgICAgICAgbGV0IG9yZGVyID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsKICAgICAgICBjb25zdCBzdHJlYW1zID0gdGhpcy5yYWRpb0Jyb3dzZXIuYWN0aXZlLm1hcCgoaW5kZXgpID0+IHsKICAgICAgICAgIGxldCByYWRpbyA9IHRoaXMucmFkaW9Ccm93c2VyLnJlc3VsdHNbaW5kZXhdOwogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgc291cmNlX3N0cmVhbV91cmw6IHJhZGlvLnVybCwKICAgICAgICAgICAgc3RyZWFtX3R2Z19uYW1lOiByYWRpby5uYW1lLAogICAgICAgICAgICBzdHJlYW1fdHZnX2lkOiAiIiwKICAgICAgICAgICAgc3RyZWFtX3R2Z19sb2dvOiByYWRpby5mYXZpY29uLAogICAgICAgICAgICBzdHJlYW1fcmFkaW86IHRydWUsCiAgICAgICAgICAgIHN0cmVhbV9vcmRlcjogb3JkZXIrKywKICAgICAgICAgIH07CiAgICAgICAgfSk7CiAgICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAgIC5wb3N0KGBlZGl0b3IvYWRkLXN0cmVhbXMvJHt0aGlzLmFjdGl2ZUdyb3VwVHlwZX1gLCB7CiAgICAgICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgICBncm91cF9pZDogdGhpcy5nZXRHcm91cFdpdGhJZCh0aGlzLmFjdGl2ZUdyb3VwKS5pZCwKICAgICAgICAgICAgc3RyZWFtczogc3RyZWFtcywKICAgICAgICAgIH0pCiAgICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgIGlmIChyZXMuc3RhdHVzKSB7CiAgICAgICAgICAgICAgdGhpcy5sb2FkUGxheWxpc3QodGhpcy5wbGF5bGlzdEVkaXRvci5pZCwgZ3JvdXBJbmRleCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pCiAgICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgfSk7CiAgICAgIH0KICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGZpbmRSYWRpb2Jyb3dzZXIoc2VhcmNoKSB7CiAgICAgIGlmIChzZWFyY2gubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIucmVzdWx0cyA9IFtdOwogICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZSA9IFtdOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLmlzTG9hZGluZyA9IHRydWU7CiAgICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAgIC5wb3N0KCJlZGl0b3IvZmluZC1yYWRpb2Jyb3dzZXIiLCB7CiAgICAgICAgICAgIHNlYXJjaDogc2VhcmNoLAogICAgICAgICAgfSkKICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuYWN0aXZlID0gW107CiAgICAgICAgICAgIGlmIChyZXMuc3RhdHVzKSB7CiAgICAgICAgICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIucmVzdWx0cyA9IHJlcy5kYXRhOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLnJlc3VsdHMgPSBbXTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnJhZGlvQnJvd3Nlci5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIH0pCiAgICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgICB0aGlzLnJhZGlvQnJvd3Nlci5hY3RpdmUgPSBbXTsKICAgICAgICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIucmVzdWx0cyA9IFtdOwogICAgICAgICAgICB0aGlzLnJhZGlvQnJvd3Nlci5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgc291bmRjbG91ZE1vZGFsKHNob3csIHNhdmUgPSBmYWxzZSkgewogICAgICBpZiAoc2hvdykgewogICAgICAgIHRoaXMuc291bmRjbG91ZC51cmwgPSAiIjsKICAgICAgICB0aGlzLnNvdW5kY2xvdWQudHJhY2sgPSBudWxsOwogICAgICB9CiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgaWYgKHRoaXMuc291bmRjbG91ZC50cmFjaykgewogICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgbGV0IGdyb3VwSW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoKGdyb3VwKSA9PiB7CiAgICAgICAgICAgIHJldHVybiBncm91cC5pZCA9PSB0aGlzLmFjdGl2ZUdyb3VwOwogICAgICAgICAgfSk7CiAgICAgICAgICBsZXQgb3JkZXIgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOwogICAgICAgICAgY29uc3Qgc3RyZWFtcyA9IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgIHNvdXJjZV9zdHJlYW1fdXJsOiB0aGlzLnNvdW5kY2xvdWQudXJsLAogICAgICAgICAgICAgIHN0cmVhbV90dmdfbmFtZTogdGhpcy5zb3VuZGNsb3VkLnRyYWNrLnRpdGxlLAogICAgICAgICAgICAgIHN0cmVhbV90dmdfaWQ6ICIiLAogICAgICAgICAgICAgIHN0cmVhbV90dmdfbG9nbzogdGhpcy5zb3VuZGNsb3VkLnRyYWNrLmFydHdvcmtfdXJsLnJlcGxhY2UoCiAgICAgICAgICAgICAgICAibGFyZ2UuanBnIiwKICAgICAgICAgICAgICAgICJ0NTAweDUwMC5qcGciCiAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICBzdHJlYW1fcmFkaW86IHRydWUsCiAgICAgICAgICAgICAgc3RyZWFtX29yZGVyOiBvcmRlcisrLAogICAgICAgICAgICB9LAogICAgICAgICAgXTsKICAgICAgICAgIGh0dHBTZXJ2aWNlCiAgICAgICAgICAgIC5wb3N0KGBlZGl0b3IvYWRkLXN0cmVhbXMvJHt0aGlzLmFjdGl2ZUdyb3VwVHlwZX1gLCB7CiAgICAgICAgICAgICAgcGxheWxpc3RfaWQ6IHRoaXMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICAgICAgZ3JvdXBfaWQ6IHRoaXMuZ2V0R3JvdXBXaXRoSWQodGhpcy5hY3RpdmVHcm91cCkuaWQsCiAgICAgICAgICAgICAgc3RyZWFtczogc3RyZWFtcywKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgaWYgKHJlcy5zdGF0dXMpIHsKICAgICAgICAgICAgICAgIHRoaXMubG9hZFBsYXlsaXN0KHRoaXMucGxheWxpc3RFZGl0b3IuaWQsIGdyb3VwSW5kZXgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy5zb3VuZGNsb3VkLm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBnZXRTb3VuZGNsb3VkVHJhY2sodXJsLCBjbGllbnRfaWQpIHsKICAgICAgaWYgKHVybC5sZW5ndGggPT09IDAgfHwgIS9zb3VuZGNsb3VkXC5jb20vLnRlc3QodXJsKSkgewogICAgICAgIHRoaXMuc291bmRjbG91ZC51cmwgPSAiIjsKICAgICAgICB0aGlzLnNvdW5kY2xvdWQudHJhY2sgPSBudWxsOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc291bmRjbG91ZC5pc0xvYWRpbmcgPSB0cnVlOwogICAgICAgIGh0dHBTZXJ2aWNlCiAgICAgICAgICAucG9zdCgiZWRpdG9yL3NvdW5kY2xvdWQtdHJhY2siLCB7CiAgICAgICAgICAgIHVybDogdXJsLAogICAgICAgICAgICBjbGllbnRfaWQ6IGNsaWVudF9pZCwKICAgICAgICAgIH0pCiAgICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgIGlmIChyZXMuc3RhdHVzICYmIE9iamVjdC5rZXlzKHJlcy5kYXRhKS5sZW5ndGgpIHsKICAgICAgICAgICAgICB0aGlzLnNvdW5kY2xvdWQudHJhY2sgPSByZXMuZGF0YTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0aGlzLnNvdW5kY2xvdWQudHJhY2sgPSBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuc291bmRjbG91ZC5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIH0pCiAgICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgICB0aGlzLnNvdW5kY2xvdWQudHJhY2sgPSBudWxsOwogICAgICAgICAgICB0aGlzLnNvdW5kY2xvdWQuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIHlvdXR1YmVNb2RhbChzaG93LCBzYXZlID0gZmFsc2UpIHsKICAgICAgaWYgKHNob3cpIHsKICAgICAgICB0aGlzLnlvdXR1YmUudXJsID0gIiI7CiAgICAgICAgdGhpcy55b3V0dWJlLnZpZGVvID0gbnVsbDsKICAgICAgICB0aGlzLnlvdXR1YmUuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0KICAgICAgaWYgKHNhdmUpIHsKICAgICAgICBpZiAodGhpcy55b3V0dWJlLnZpZGVvKSB7CiAgICAgICAgICB0aGlzLnlvdXR1YmUuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgIGxldCBncm91cEluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KChncm91cCkgPT4gewogICAgICAgICAgICByZXR1cm4gZ3JvdXAuaWQgPT0gdGhpcy5hY3RpdmVHcm91cDsKICAgICAgICAgIH0pOwogICAgICAgICAgbGV0IG9yZGVyID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsKICAgICAgICAgIGNvbnN0IHN0cmVhbXMgPSBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBzb3VyY2Vfc3RyZWFtX3VybDogdGhpcy55b3V0dWJlLnVybCwKICAgICAgICAgICAgICBzdHJlYW1fdHZnX25hbWU6IHRoaXMueW91dHViZS52aWRlby52aWRlb0RldGFpbHMudGl0bGUsCiAgICAgICAgICAgICAgc3RyZWFtX3R2Z19pZDogIiIsCiAgICAgICAgICAgICAgc3RyZWFtX3R2Z19sb2dvOiBgaHR0cDovL2kueXRpbWcuY29tL3ZpLyR7dGhpcy55b3V0dWJlLnZpZGVvSWR9L21heHJlc2RlZmF1bHQuanBnYCwKICAgICAgICAgICAgICBzdHJlYW1fb3JkZXI6IG9yZGVyKyssCiAgICAgICAgICAgIH0sCiAgICAgICAgICBdOwogICAgICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAgICAgLnBvc3QoYGVkaXRvci9hZGQtc3RyZWFtcy8ke3RoaXMuYWN0aXZlR3JvdXBUeXBlfWAsIHsKICAgICAgICAgICAgICBwbGF5bGlzdF9pZDogdGhpcy5wbGF5bGlzdEVkaXRvci5pZCwKICAgICAgICAgICAgICBncm91cF9pZDogdGhpcy5nZXRHcm91cFdpdGhJZCh0aGlzLmFjdGl2ZUdyb3VwKS5pZCwKICAgICAgICAgICAgICBzdHJlYW1zOiBzdHJlYW1zLAogICAgICAgICAgICB9KQogICAgICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgdGhpcy55b3V0dWJlLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgIGlmIChyZXMuc3RhdHVzKSB7CiAgICAgICAgICAgICAgICB0aGlzLmxvYWRQbGF5bGlzdCh0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLCBncm91cEluZGV4KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICAgICAgdGhpcy55b3V0dWJlLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy55b3V0dWJlLm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBnZXRZb3V0dWJlUGFnZSh2aWRlb0lkKSB7CiAgICAgIHRoaXMueW91dHViZS5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZQogICAgICAgIC5wb3N0KCJlZGl0b3IveW91dHViZS12aWRlbyIsIHsgdmlkZW9faWQ6IHZpZGVvSWQgfSkKICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICBpZiAocmVzLnN0YXR1cyAmJiBPYmplY3Qua2V5cyhyZXMuZGF0YSkubGVuZ3RoKSB7CiAgICAgICAgICAgIHRoaXMueW91dHViZS52aWRlbyA9IHJlcy5kYXRhOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy55b3V0dWJlLnZpZGVvID0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMueW91dHViZS5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICB0aGlzLnlvdXR1YmUudmlkZW8gPSBudWxsOwogICAgICAgICAgdGhpcy55b3V0dWJlLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0pOwogICAgfSwKICAgIHZpbWVvTW9kYWwoc2hvdywgc2F2ZSA9IGZhbHNlKSB7CiAgICAgIGlmIChzaG93KSB7CiAgICAgICAgdGhpcy52aW1lby51cmwgPSAiIjsKICAgICAgICB0aGlzLnZpbWVvLnZpZGVvID0gbnVsbDsKICAgICAgICB0aGlzLnZpbWVvLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9CiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgaWYgKHRoaXMudmltZW8udmlkZW8pIHsKICAgICAgICAgIHRoaXMudmltZW8uaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgIGxldCBncm91cEluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KChncm91cCkgPT4gewogICAgICAgICAgICByZXR1cm4gZ3JvdXAuaWQgPT0gdGhpcy5hY3RpdmVHcm91cDsKICAgICAgICAgIH0pOwogICAgICAgICAgbGV0IG9yZGVyID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsKICAgICAgICAgIGNvbnN0IHN0cmVhbXMgPSBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBzb3VyY2Vfc3RyZWFtX3VybDogdGhpcy52aW1lby51cmwsCiAgICAgICAgICAgICAgc3RyZWFtX3R2Z19uYW1lOiB0aGlzLnZpbWVvLnZpZGVvLnZpZGVvLnRpdGxlLAogICAgICAgICAgICAgIHN0cmVhbV90dmdfaWQ6ICIiLAogICAgICAgICAgICAgIHN0cmVhbV90dmdfbG9nbzogdGhpcy52aW1lby52aWRlby52aWRlby50aHVtYnMuYmFzZSwKICAgICAgICAgICAgICBzdHJlYW1fb3JkZXI6IG9yZGVyKyssCiAgICAgICAgICAgIH0sCiAgICAgICAgICBdOwogICAgICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAgICAgLnBvc3QoYGVkaXRvci9hZGQtc3RyZWFtcy8ke3RoaXMuYWN0aXZlR3JvdXBUeXBlfWAsIHsKICAgICAgICAgICAgICBwbGF5bGlzdF9pZDogdGhpcy5wbGF5bGlzdEVkaXRvci5pZCwKICAgICAgICAgICAgICBncm91cF9pZDogdGhpcy5nZXRHcm91cFdpdGhJZCh0aGlzLmFjdGl2ZUdyb3VwKS5pZCwKICAgICAgICAgICAgICBzdHJlYW1zOiBzdHJlYW1zLAogICAgICAgICAgICB9KQogICAgICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgdGhpcy52aW1lby5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICBpZiAocmVzLnN0YXR1cykgewogICAgICAgICAgICAgICAgdGhpcy5sb2FkUGxheWxpc3QodGhpcy5wbGF5bGlzdEVkaXRvci5pZCwgZ3JvdXBJbmRleCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgICAgIHRoaXMudmltZW8uaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLnZpbWVvLm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBnZXRWaW1lb0NvbmZpZyh2aWRlb0lkKSB7CiAgICAgIHRoaXMudmltZW8uaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAucG9zdCgiZWRpdG9yL3ZpbWVvLXZpZGVvIiwgeyB2aWRlb19pZDogdmlkZW9JZCB9KQogICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgIHRoaXMudmltZW8udmlkZW8gPSByZXMuZGF0YTsKICAgICAgICAgIHRoaXMudmltZW8uaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgfSk7CiAgICB9LAogICAgZGFpbHltb3Rpb25Nb2RhbChzaG93LCBzYXZlID0gZmFsc2UpIHsKICAgICAgaWYgKHNob3cpIHsKICAgICAgICB0aGlzLmRhaWx5bW90aW9uLnVybCA9ICIiOwogICAgICAgIHRoaXMuZGFpbHltb3Rpb24udmlkZW8gPSBudWxsOwogICAgICAgIHRoaXMuZGFpbHltb3Rpb24uaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0KICAgICAgaWYgKHNhdmUpIHsKICAgICAgICBpZiAodGhpcy5kYWlseW1vdGlvbi52aWRlbykgewogICAgICAgICAgdGhpcy5kYWlseW1vdGlvbi5pc0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgbGV0IGdyb3VwSW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoKGdyb3VwKSA9PiB7CiAgICAgICAgICAgIHJldHVybiBncm91cC5pZCA9PSB0aGlzLmFjdGl2ZUdyb3VwOwogICAgICAgICAgfSk7CiAgICAgICAgICBsZXQgb3JkZXIgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOwogICAgICAgICAgY29uc3Qgc3RyZWFtcyA9IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgIHNvdXJjZV9zdHJlYW1fdXJsOiB0aGlzLmRhaWx5bW90aW9uLnVybCwKICAgICAgICAgICAgICBzdHJlYW1fdHZnX25hbWU6IHRoaXMuZGFpbHltb3Rpb24udmlkZW8udGl0bGUsCiAgICAgICAgICAgICAgc3RyZWFtX3R2Z19pZDogIiIsCiAgICAgICAgICAgICAgc3RyZWFtX3R2Z19sb2dvOiB0aGlzLmRhaWx5bW90aW9uLnZpZGVvLnRodW1ibmFpbF8xMDgwX3VybCwKICAgICAgICAgICAgICBzdHJlYW1fb3JkZXI6IG9yZGVyKyssCiAgICAgICAgICAgIH0sCiAgICAgICAgICBdOwogICAgICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAgICAgLnBvc3QoYGVkaXRvci9hZGQtc3RyZWFtcy8ke3RoaXMuYWN0aXZlR3JvdXBUeXBlfWAsIHsKICAgICAgICAgICAgICBwbGF5bGlzdF9pZDogdGhpcy5wbGF5bGlzdEVkaXRvci5pZCwKICAgICAgICAgICAgICBncm91cF9pZDogdGhpcy5nZXRHcm91cFdpdGhJZCh0aGlzLmFjdGl2ZUdyb3VwKS5pZCwKICAgICAgICAgICAgICBzdHJlYW1zOiBzdHJlYW1zLAogICAgICAgICAgICB9KQogICAgICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgdGhpcy5kYWlseW1vdGlvbi5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICBpZiAocmVzLnN0YXR1cykgewogICAgICAgICAgICAgICAgdGhpcy5sb2FkUGxheWxpc3QodGhpcy5wbGF5bGlzdEVkaXRvci5pZCwgZ3JvdXBJbmRleCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgICAgIHRoaXMuZGFpbHltb3Rpb24uaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLmRhaWx5bW90aW9uLm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBnZXREYWlseW1vdGlvbkNvbmZpZyh2aWRlb0lkKSB7CiAgICAgIHRoaXMuZGFpbHltb3Rpb24uaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAucG9zdCgiZWRpdG9yL2RhaWx5bW90aW9uLXZpZGVvIiwgeyB2aWRlb19pZDogdmlkZW9JZCB9KQogICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgIHRoaXMuZGFpbHltb3Rpb24udmlkZW8gPSByZXMuZGF0YTsKICAgICAgICAgIHRoaXMuZGFpbHltb3Rpb24uaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgfSk7CiAgICB9LAogICAgdGVkVGFsa3NNb2RhbChzaG93LCBzYXZlID0gZmFsc2UpIHsKICAgICAgaWYgKHNob3cpIHsKICAgICAgICB0aGlzLnRlZFRhbGtzLnVybCA9ICIiOwogICAgICAgIHRoaXMudGVkVGFsa3MudmlkZW8gPSBudWxsOwogICAgICAgIHRoaXMudGVkVGFsa3MuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0KICAgICAgaWYgKHNhdmUpIHsKICAgICAgICBpZiAodGhpcy50ZWRUYWxrcy52aWRlbykgewogICAgICAgICAgdGhpcy50ZWRUYWxrcy5pc0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgbGV0IGdyb3VwSW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoKGdyb3VwKSA9PiB7CiAgICAgICAgICAgIHJldHVybiBncm91cC5pZCA9PSB0aGlzLmFjdGl2ZUdyb3VwOwogICAgICAgICAgfSk7CiAgICAgICAgICBsZXQgb3JkZXIgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOwogICAgICAgICAgY29uc3Qgc3RyZWFtcyA9IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgIHNvdXJjZV9zdHJlYW1fdXJsOiB0aGlzLnRlZFRhbGtzLnVybCwKICAgICAgICAgICAgICBzdHJlYW1fdHZnX25hbWU6IHRoaXMudGVkVGFsa3MudmlkZW8udGl0bGUsCiAgICAgICAgICAgICAgc3RyZWFtX3R2Z19pZDogIiIsCiAgICAgICAgICAgICAgc3RyZWFtX3R2Z19sb2dvOiB0aGlzLnRlZFRhbGtzLnZpZGVvLmhlcm8sCiAgICAgICAgICAgICAgc3RyZWFtX29yZGVyOiBvcmRlcisrLAogICAgICAgICAgICB9LAogICAgICAgICAgXTsKICAgICAgICAgIGh0dHBTZXJ2aWNlCiAgICAgICAgICAgIC5wb3N0KGBlZGl0b3IvYWRkLXN0cmVhbXMvJHt0aGlzLmFjdGl2ZUdyb3VwVHlwZX1gLCB7CiAgICAgICAgICAgICAgcGxheWxpc3RfaWQ6IHRoaXMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICAgICAgZ3JvdXBfaWQ6IHRoaXMuZ2V0R3JvdXBXaXRoSWQodGhpcy5hY3RpdmVHcm91cCkuaWQsCiAgICAgICAgICAgICAgc3RyZWFtczogc3RyZWFtcywKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgIHRoaXMudGVkVGFsa3MuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgaWYgKHJlcy5zdGF0dXMpIHsKICAgICAgICAgICAgICAgIHRoaXMubG9hZFBsYXlsaXN0KHRoaXMucGxheWxpc3RFZGl0b3IuaWQsIGdyb3VwSW5kZXgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgICAgICB0aGlzLnRlZFRhbGtzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy50ZWRUYWxrcy5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgZ2V0VGVkVGFsa3NDb25maWcodXJsKSB7CiAgICAgIHRoaXMudGVkVGFsa3MuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UucG9zdCgiZWRpdG9yL3RlZC10YWxrcy12aWRlbyIsIHsgdXJsOiB1cmwgfSkudGhlbigocmVzKSA9PiB7CiAgICAgICAgdGhpcy50ZWRUYWxrcy52aWRlbyA9IHJlcy5kYXRhLnRhbGtzLmxlbmd0aCA/IHJlcy5kYXRhLnRhbGtzWzBdIDogbnVsbDsKICAgICAgICB0aGlzLnRlZFRhbGtzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9KTsKICAgIH0sCiAgICB4aGFtc3Rlck1vZGFsKHNob3csIHNhdmUgPSBmYWxzZSkgewogICAgICBpZiAoc2hvdykgewogICAgICAgIHRoaXMueGhhbXN0ZXIudXJsID0gIiI7CiAgICAgICAgdGhpcy54aGFtc3Rlci52aWRlbyA9IG51bGw7CiAgICAgICAgdGhpcy54aGFtc3Rlci5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfQogICAgICBpZiAoc2F2ZSkgewogICAgICAgIGlmICh0aGlzLnhoYW1zdGVyLnZpZGVvKSB7CiAgICAgICAgICB0aGlzLnhoYW1zdGVyLmlzTG9hZGluZyA9IHRydWU7CiAgICAgICAgICBsZXQgZ3JvdXBJbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleCgoZ3JvdXApID0+IHsKICAgICAgICAgICAgcmV0dXJuIGdyb3VwLmlkID09IHRoaXMuYWN0aXZlR3JvdXA7CiAgICAgICAgICB9KTsKICAgICAgICAgIGxldCBvcmRlciA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7CiAgICAgICAgICBjb25zdCBzdHJlYW1zID0gWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgc291cmNlX3N0cmVhbV91cmw6IHRoaXMueGhhbXN0ZXIudXJsLAogICAgICAgICAgICAgIHN0cmVhbV90dmdfbmFtZTogdGhpcy54aGFtc3Rlci52aWRlby52aWRlb0VudGl0eS50aXRsZSwKICAgICAgICAgICAgICBzdHJlYW1fdHZnX2lkOiAiIiwKICAgICAgICAgICAgICBzdHJlYW1fdHZnX2xvZ286IHRoaXMueGhhbXN0ZXIudmlkZW8udmlkZW9FbnRpdHkudGh1bWJCaWcsCiAgICAgICAgICAgICAgc3RyZWFtX29yZGVyOiBvcmRlcisrLAogICAgICAgICAgICB9LAogICAgICAgICAgXTsKICAgICAgICAgIGh0dHBTZXJ2aWNlCiAgICAgICAgICAgIC5wb3N0KGBlZGl0b3IvYWRkLXN0cmVhbXMvJHt0aGlzLmFjdGl2ZUdyb3VwVHlwZX1gLCB7CiAgICAgICAgICAgICAgcGxheWxpc3RfaWQ6IHRoaXMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICAgICAgZ3JvdXBfaWQ6IHRoaXMuZ2V0R3JvdXBXaXRoSWQodGhpcy5hY3RpdmVHcm91cCkuaWQsCiAgICAgICAgICAgICAgc3RyZWFtczogc3RyZWFtcywKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgIHRoaXMueGhhbXN0ZXIuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgaWYgKHJlcy5zdGF0dXMpIHsKICAgICAgICAgICAgICAgIHRoaXMubG9hZFBsYXlsaXN0KHRoaXMucGxheWxpc3RFZGl0b3IuaWQsIGdyb3VwSW5kZXgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgICAgICB0aGlzLnhoYW1zdGVyLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy54aGFtc3Rlci5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgZ2V0WGhhbXN0ZXJDb25maWcodXJsKSB7CiAgICAgIHRoaXMueGhhbXN0ZXIuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UucG9zdCgiZWRpdG9yL3hoYW1zdGVyLXZpZGVvIiwgeyB1cmw6IHVybCB9KS50aGVuKChyZXMpID0+IHsKICAgICAgICB0aGlzLnhoYW1zdGVyLnZpZGVvID0gcmVzLmRhdGE7CiAgICAgICAgdGhpcy54aGFtc3Rlci5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfSk7CiAgICB9LAogICAgZ3JvdXBEb3VibGVDbGljaygpIHsKICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBzLmxlbmd0aCA9PT0gMSkgewogICAgICAgIHRoaXMuZWRpdEdyb3VwTW9kYWwodHJ1ZSk7CiAgICAgIH0KICAgIH0sCiAgICBzdHJlYW1Eb3VibGVDbGljaygpIHsKICAgICAgaWYgKHRoaXMuYWN0aXZlU3RyZWFtcy5sZW5ndGggPT09IDEpIHsKICAgICAgICB0aGlzLmVkaXRTdHJlYW1Nb2RhbCh0cnVlKTsKICAgICAgfQogICAgfSwKICAgIGxvYWRMb2dvQ291bnRyaWVzKCkgewogICAgICB0aGlzLmZpbmRMb2dvLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGh0dHBTZXJ2aWNlCiAgICAgICAgLmdldCgiZWRpdG9yL2xvZ28tY291bnRyaWVzIikKICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICB0aGlzLmZpbmRMb2dvLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgdGhpcy5maW5kTG9nby5jb3VudHJpZXMgPSByZXMuZGF0YQogICAgICAgICAgICAubWFwKChjb3VudHJ5KSA9PiB7CiAgICAgICAgICAgICAgbGV0IGNuID0gdGhpcy5jb3VudHJpZXMuZmluZCgKICAgICAgICAgICAgICAgIChjbnQpID0+IGNudC5jb2RlLnRvTG93ZXJDYXNlKCkgPT0gY291bnRyeS50b0xvd2VyQ2FzZSgpCiAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgdGV4dDogY24gPyBjbi5uYW1lIDogY291bnRyeSwKICAgICAgICAgICAgICAgIHZhbHVlOiBjb3VudHJ5LAogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5zb3J0KChhLCBiKSA9PiB7CiAgICAgICAgICAgICAgcmV0dXJuIGEudGV4dC50b1VwcGVyQ2FzZSgpIDwgYi50ZXh0LnRvVXBwZXJDYXNlKCkKICAgICAgICAgICAgICAgID8gLTEKICAgICAgICAgICAgICAgIDogYS50ZXh0LnRvVXBwZXJDYXNlKCkgPiBiLnRleHQudG9VcHBlckNhc2UoKQogICAgICAgICAgICAgICAgPyAxCiAgICAgICAgICAgICAgICA6IDA7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgdGhpcy5hc3NpZ25Mb2dvLmNvdW50cmllcyA9IFsuLi50aGlzLmZpbmRMb2dvLmNvdW50cmllc107CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgdGhpcy5maW5kTG9nby5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICB9KTsKICAgIH0sCiAgICBsb2FkVFZHSURDb3VudHJpZXMoKSB7CiAgICAgIHRoaXMuYXNzaWduVFZHSUQuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAuZ2V0KCJlZGl0b3IvdHYtZ3VpZGUtY291bnRyaWVzIikKICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICB0aGlzLmFzc2lnblRWR0lELmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgdGhpcy5hc3NpZ25UVkdJRC5jb3VudHJpZXMgPSByZXMuZGF0YQogICAgICAgICAgICAubWFwKChjb3VudHJ5KSA9PiB7CiAgICAgICAgICAgICAgbGV0IGNuID0gdGhpcy5jb3VudHJpZXMuZmluZCgKICAgICAgICAgICAgICAgIChjbnQpID0+IGNudC5jb2RlLnRvTG93ZXJDYXNlKCkgPT0gY291bnRyeS50b0xvd2VyQ2FzZSgpCiAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgdGV4dDogY24gPyBjbi5uYW1lIDogY291bnRyeSwKICAgICAgICAgICAgICAgIHZhbHVlOiBjb3VudHJ5LAogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5zb3J0KChhLCBiKSA9PiB7CiAgICAgICAgICAgICAgcmV0dXJuIGEudGV4dC50b1VwcGVyQ2FzZSgpIDwgYi50ZXh0LnRvVXBwZXJDYXNlKCkKICAgICAgICAgICAgICAgID8gLTEKICAgICAgICAgICAgICAgIDogYS50ZXh0LnRvVXBwZXJDYXNlKCkgPiBiLnRleHQudG9VcHBlckNhc2UoKQogICAgICAgICAgICAgICAgPyAxCiAgICAgICAgICAgICAgICA6IDA7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgdGhpcy5hc3NpZ25UVkdJRC5jb3VudHJpZXMudW5zaGlmdCh7CiAgICAgICAgICAgIHRleHQ6IHRoaXMuJHQoImdlbmVyYWwuYWxsIiksCiAgICAgICAgICAgIHZhbHVlOiAiYWxsIiwKICAgICAgICAgIH0pOwogICAgICAgICAgdGhpcy5maW5kVFZHSUQuY291bnRyaWVzID0gWy4uLnRoaXMuYXNzaWduVFZHSUQuY291bnRyaWVzXTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICB0aGlzLmFzc2lnblRWR0lELmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0pOwogICAgfSwKICAgIGxvYWRTaXB0dkNvdW50cmllcygpIHsKICAgICAgdGhpcy5hc3NpZ25TSVBUVi5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZQogICAgICAgIC5nZXQoImVkaXRvci9zbWFydC1pcHR2LWNvdW50cmllcyIpCiAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgdGhpcy5hc3NpZ25TSVBUVi5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIHRoaXMuYXNzaWduU0lQVFYuY291bnRyaWVzID0gcmVzLmRhdGE7CiAgICAgICAgICB0aGlzLmZpbmRTaXB0di5jb3VudHJpZXMgPSBbLi4udGhpcy5hc3NpZ25TSVBUVi5jb3VudHJpZXNdOwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgIHRoaXMuYXNzaWduU0lQVFYuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgfSk7CiAgICB9LAogICAgbG9hZExvZ29zRmluZChjb3VudHJ5KSB7CiAgICAgIHRoaXMuZmluZExvZ28uaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAuZ2V0KGBlZGl0b3IvbG9nb3MvJHtjb3VudHJ5fWApCiAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgdGhpcy5maW5kTG9nby5sb2dvID0gIiI7CiAgICAgICAgICB0aGlzLmZpbmRMb2dvLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgdGhpcy5maW5kTG9nby5sb2dvcyA9IHJlcy5kYXRhLm1hcCgobG9nbykgPT4gewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIHRleHQ6IGxvZ28ubGFiZWwsCiAgICAgICAgICAgICAgdmFsdWU6IGxvZ28uZmlsZW5hbWUsCiAgICAgICAgICAgIH07CiAgICAgICAgICB9KTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICB0aGlzLmZpbmRMb2dvLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0pOwogICAgfSwKICAgIGZpbmRMb2dvTW9kYWwoc2hvdywgc2F2ZSA9IGZhbHNlKSB7CiAgICAgIGxldCBzZWxlY3RlZCA9IHRoaXMuZ2V0U3RyZWFtV2l0aElkKHRoaXMuYWN0aXZlU3RyZWFtc1swXSk7CiAgICAgIGlmIChzaG93KSB7CiAgICAgICAgdGhpcy5maW5kTG9nby5sb2dvID0gIiI7CiAgICAgICAgdGhpcy5maW5kTG9nby50aXRsZSA9IHNlbGVjdGVkLnN0cmVhbV90dmdfbmFtZTsKICAgICAgfQogICAgICB0aGlzLmZpbmRMb2dvLnNlYXJjaCA9ICIiOwogICAgICBpZiAoc2F2ZSkgewogICAgICAgIGlmIChzZWxlY3RlZCkgewogICAgICAgICAgc2VsZWN0ZWQuc3RyZWFtX3R2Z19sb2dvID0gYGh0dHA6Ly9zdGF0aWMuaXB0di10b29scy5jb20vJHt0aGlzLmZpbmRMb2dvLmNvdW50cnl9LyR7dGhpcy5maW5kTG9nby5sb2dvfWA7CiAgICAgICAgICBzZWxlY3RlZC5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLmZpbmRMb2dvLm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBsb2FkTG9nb3NBc3NpZ24oY291bnRyeSkgewogICAgICB0aGlzLmFzc2lnbkxvZ28uaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAuZ2V0KGBlZGl0b3IvbG9nb3MvJHtjb3VudHJ5fWApCiAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgdGhpcy5hc3NpZ25Mb2dvLmxvZ28gPSAiIjsKICAgICAgICAgIHRoaXMuYXNzaWduTG9nby5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIHRoaXMuYXNzaWduTG9nby5sb2dvcyA9IHJlcy5kYXRhLm1hcCgobG9nbykgPT4gbG9nby5maWxlbmFtZSk7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgdGhpcy5hc3NpZ25Mb2dvLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0pOwogICAgfSwKICAgIGFzc2lnbkxvZ29Nb2RhbChzaG93LCBzYXZlID0gZmFsc2UpIHsKICAgICAgaWYgKHNob3cpIHsKICAgICAgICB0aGlzLmFzc2lnbkxvZ28ubG9nbyA9ICIiOwogICAgICB9CiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgdmFyIGNoYW5nZWQgPSBmYWxzZTsKICAgICAgICB2YXIgc3RyaW5nU2ltaWxhcml0eSA9IHJlcXVpcmUoInN0cmluZy1zaW1pbGFyaXR5Iik7CiAgICAgICAgbGV0IHN0cmVhbXMgPSBbXTsKICAgICAgICBpZiAodGhpcy5hc3NpZ25Mb2dvLmFzc2lnbkFsbCA9PSAxKSB7CiAgICAgICAgICBzdHJlYW1zID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzdHJlYW1zID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmZpbHRlcigKICAgICAgICAgICAgKHN0cmVhbSkgPT4gIXN0cmVhbS5zdHJlYW1fdHZnX2xvZ28ubGVuZ3RoCiAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICBzdHJlYW1zLm1hcCgoc3RyZWFtKSA9PiB7CiAgICAgICAgICBsZXQgbWF0Y2gxID0gc3RyaW5nU2ltaWxhcml0eS5maW5kQmVzdE1hdGNoKAogICAgICAgICAgICBTdHJpbmcoc3RyZWFtLnN0cmVhbV90dmdfbmFtZSkucmVwbGFjZSgvIGhkJC9pLCAiIiksCiAgICAgICAgICAgIHRoaXMuYXNzaWduTG9nby5sb2dvcwogICAgICAgICAgKS5iZXN0TWF0Y2g7CiAgICAgICAgICBsZXQgbWF0Y2gyID0gc3RyaW5nU2ltaWxhcml0eS5maW5kQmVzdE1hdGNoKAogICAgICAgICAgICBTdHJpbmcoc3RyZWFtLnN0cmVhbV90dmdfaWQpLAogICAgICAgICAgICB0aGlzLmFzc2lnbkxvZ28ubG9nb3MKICAgICAgICAgICkuYmVzdE1hdGNoOwogICAgICAgICAgaWYgKG1hdGNoMS5yYXRpbmcgPj0gMC4zKSB7CiAgICAgICAgICAgIGNoYW5nZWQgPSB0cnVlOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19sb2dvID0gYGh0dHA6Ly9zdGF0aWMuaXB0di10b29scy5jb20vJHt0aGlzLmFzc2lnbkxvZ28uY291bnRyeX0vJHttYXRjaDEudGFyZ2V0fWA7CiAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICB9IGVsc2UgaWYgKG1hdGNoMi5yYXRpbmcgPj0gMC41KSB7CiAgICAgICAgICAgIGNoYW5nZWQgPSB0cnVlOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19sb2dvID0gYGh0dHA6Ly9zdGF0aWMuaXB0di10b29scy5jb20vJHt0aGlzLmFzc2lnbkxvZ28uY291bnRyeX0vJHttYXRjaDIudGFyZ2V0fWA7CiAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gY2hhbmdlZDsKICAgICAgfQogICAgICB0aGlzLmFzc2lnbkxvZ28ubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGxvYWRUVkdJREFzc2lnbihjb3VudHJ5KSB7CiAgICAgIHRoaXMuYXNzaWduVFZHSUQuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAuZ2V0KGBlZGl0b3IvdHYtZ3VpZGUvJHtjb3VudHJ5fWApCiAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgdGhpcy5hc3NpZ25UVkdJRC5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIHRoaXMuYXNzaWduVFZHSUQuY2hhbm5lbHMgPSByZXMuZGF0YTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICB0aGlzLmFzc2lnblRWR0lELmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0pOwogICAgfSwKICAgIGxvYWRTaXB0dkFzc2lnbihjb3VudHJ5KSB7CiAgICAgIHRoaXMuYXNzaWduU0lQVFYuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAuZ2V0KGBlZGl0b3Ivc21hcnQtaXB0di8ke2NvdW50cnl9YCkKICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICB0aGlzLmFzc2lnblNJUFRWLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgdGhpcy5hc3NpZ25TSVBUVi5jaGFubmVscyA9IHJlcy5kYXRhOwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgIHRoaXMuYXNzaWduU0lQVFYuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgfSk7CiAgICB9LAogICAgYXNzaWduVFZHSURNb2RhbChzaG93LCBzYXZlID0gZmFsc2UpIHsKICAgICAgaWYgKHNhdmUpIHsKICAgICAgICB2YXIgY2hhbmdlZCA9IGZhbHNlOwogICAgICAgIHZhciBzdHJpbmdTaW1pbGFyaXR5ID0gcmVxdWlyZSgic3RyaW5nLXNpbWlsYXJpdHkiKTsKICAgICAgICBsZXQgc3RyZWFtcyA9IFtdOwogICAgICAgIGlmICh0aGlzLmFzc2lnblRWR0lELmFzc2lnbkFsbCA9PSAxKSB7CiAgICAgICAgICBzdHJlYW1zID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzdHJlYW1zID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmZpbHRlcigKICAgICAgICAgICAgKHN0cmVhbSkgPT4KICAgICAgICAgICAgICAhc3RyZWFtLnN0cmVhbV90dmdfaWQubGVuZ3RoIHx8IHN0cmVhbS5zdHJlYW1fdHZnX2lkLmxlbmd0aCA9PSAwCiAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICBsZXQgY2hhbm5lbE5hbWVzID0gdGhpcy5hc3NpZ25UVkdJRC5jaGFubmVscy5tYXAoCiAgICAgICAgICAoY2hhbm5lbCkgPT4gY2hhbm5lbC50dmdfbmFtZS50b0xvd2VyQ2FzZSgpCiAgICAgICAgKTsKICAgICAgICBsZXQgY2hhbm5lbElkcyA9IHRoaXMuYXNzaWduVFZHSUQuY2hhbm5lbHMubWFwKAogICAgICAgICAgKGNoYW5uZWwpID0+IGNoYW5uZWwudHZnX2lkLnRvTG93ZXJDYXNlKCkKICAgICAgICApOwogICAgICAgIHN0cmVhbXMubWFwKChzdHJlYW0pID0+IHsKICAgICAgICAgIGxldCBtYXRjaDEgPSBzdHJpbmdTaW1pbGFyaXR5LmZpbmRCZXN0TWF0Y2goCiAgICAgICAgICAgIFN0cmluZyhzdHJlYW0uc3RyZWFtX3R2Z19uYW1lKS50b0xvd2VyQ2FzZSgpLAogICAgICAgICAgICBjaGFubmVsTmFtZXMKICAgICAgICAgICkuYmVzdE1hdGNoOwogICAgICAgICAgbGV0IG1hdGNoMiA9IHN0cmluZ1NpbWlsYXJpdHkuZmluZEJlc3RNYXRjaCgKICAgICAgICAgICAgU3RyaW5nKHN0cmVhbS5zdHJlYW1fdHZnX2lkKS50b0xvd2VyQ2FzZSgpLAogICAgICAgICAgICBjaGFubmVsSWRzCiAgICAgICAgICApLmJlc3RNYXRjaDsKICAgICAgICAgIGxldCBtYXRjaDMgPSBzdHJpbmdTaW1pbGFyaXR5LmZpbmRCZXN0TWF0Y2goCiAgICAgICAgICAgIFN0cmluZyhzdHJlYW0uc3RyZWFtX3R2Z19uYW1lKS5yZXBsYWNlKAogICAgICAgICAgICAgIC8gaGQkfCBmaGQkfCBoZXZjJHwgaDI2NSR8L2ksCiAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgKS50b0xvd2VyQ2FzZSgpLAogICAgICAgICAgICBjaGFubmVsTmFtZXMKICAgICAgICAgICkuYmVzdE1hdGNoOwogICAgICAgICAgaWYgKG1hdGNoMi5yYXRpbmcgPj0gMC43NSkgewogICAgICAgICAgICBjaGFuZ2VkID0gdHJ1ZTsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfaWQgPSBtYXRjaDIudGFyZ2V0OwogICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgfSBlbHNlIGlmIChtYXRjaDEucmF0aW5nID49IDAuNzUpIHsKICAgICAgICAgICAgY2hhbmdlZCA9IHRydWU7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX2lkID0gdGhpcy5hc3NpZ25UVkdJRC5jaGFubmVscy5maW5kKAogICAgICAgICAgICAgIChjaGFubmVsKSA9PiBjaGFubmVsLnR2Z19uYW1lLnRvTG93ZXJDYXNlKCkgPT09IG1hdGNoMS50YXJnZXQKICAgICAgICAgICAgKS50dmdfaWQ7CiAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICB9IGVsc2UgaWYgKG1hdGNoMy5yYXRpbmcgPj0gMC43NSkgewogICAgICAgICAgICBjaGFuZ2VkID0gdHJ1ZTsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfaWQgPSB0aGlzLmFzc2lnblRWR0lELmNoYW5uZWxzLmZpbmQoCiAgICAgICAgICAgICAgKGNoYW5uZWwpID0+IGNoYW5uZWwudHZnX25hbWUudG9Mb3dlckNhc2UoKSA9PT0gbWF0Y2gxLnRhcmdldAogICAgICAgICAgICApLnR2Z19pZDsKICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNoYW5nZWQgPSB0cnVlOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19pZCA9ICIiOwogICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IGNoYW5nZWQ7CiAgICAgIH0KICAgICAgdGhpcy5hc3NpZ25UVkdJRC5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgYXNzaWduU2lwdHZNb2RhbChzaG93LCBzYXZlID0gZmFsc2UpIHsKICAgICAgaWYgKHNhdmUpIHsKICAgICAgICB2YXIgY2hhbmdlZCA9IGZhbHNlOwogICAgICAgIHZhciBzdHJpbmdTaW1pbGFyaXR5ID0gcmVxdWlyZSgic3RyaW5nLXNpbWlsYXJpdHkiKTsKICAgICAgICBsZXQgc3RyZWFtcyA9IFtdOwogICAgICAgIGlmICh0aGlzLmFzc2lnblNJUFRWLmFzc2lnbkFsbCA9PSAxKSB7CiAgICAgICAgICBzdHJlYW1zID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzdHJlYW1zID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmZpbHRlcigKICAgICAgICAgICAgKHN0cmVhbSkgPT4KICAgICAgICAgICAgICAhc3RyZWFtLnN0cmVhbV90dmdfaWQubGVuZ3RoIHx8IHN0cmVhbS5zdHJlYW1fdHZnX2lkLmxlbmd0aCA9PSAwCiAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICBsZXQgY2hhbm5lbE5hbWVzID0gdGhpcy5hc3NpZ25TSVBUVi5jaGFubmVscy5tYXAoCiAgICAgICAgICAoY2hhbm5lbCkgPT4gY2hhbm5lbC50dmdfbmFtZQogICAgICAgICk7CiAgICAgICAgbGV0IGNoYW5uZWxJZHMgPSB0aGlzLmFzc2lnblNJUFRWLmNoYW5uZWxzLm1hcCgKICAgICAgICAgIChjaGFubmVsKSA9PiBjaGFubmVsLnR2Z19pZAogICAgICAgICk7CiAgICAgICAgc3RyZWFtcy5tYXAoKHN0cmVhbSkgPT4gewogICAgICAgICAgbGV0IG1hdGNoMSA9IHN0cmluZ1NpbWlsYXJpdHkuZmluZEJlc3RNYXRjaCgKICAgICAgICAgICAgU3RyaW5nKHN0cmVhbS5zdHJlYW1fdHZnX25hbWUpLAogICAgICAgICAgICBjaGFubmVsTmFtZXMKICAgICAgICAgICkuYmVzdE1hdGNoOwogICAgICAgICAgbGV0IG1hdGNoMiA9IHN0cmluZ1NpbWlsYXJpdHkuZmluZEJlc3RNYXRjaCgKICAgICAgICAgICAgU3RyaW5nKHN0cmVhbS5zdHJlYW1fdHZnX2lkKSwKICAgICAgICAgICAgY2hhbm5lbElkcwogICAgICAgICAgKS5iZXN0TWF0Y2g7CiAgICAgICAgICBsZXQgbWF0Y2gzID0gc3RyaW5nU2ltaWxhcml0eS5maW5kQmVzdE1hdGNoKAogICAgICAgICAgICBTdHJpbmcoc3RyZWFtLnN0cmVhbV90dmdfbmFtZSkucmVwbGFjZSgKICAgICAgICAgICAgICAvIGhkJHwgZmhkJHwgaGV2YyR8IGgyNjUkfC9pLAogICAgICAgICAgICAgICIiCiAgICAgICAgICAgICksCiAgICAgICAgICAgIGNoYW5uZWxOYW1lcwogICAgICAgICAgKS5iZXN0TWF0Y2g7CiAgICAgICAgICBpZiAobWF0Y2gyLnJhdGluZyA+PSAwLjc1KSB7CiAgICAgICAgICAgIGNoYW5nZWQgPSB0cnVlOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19pZCA9IG1hdGNoMi50YXJnZXQ7CiAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICB9IGVsc2UgaWYgKG1hdGNoMS5yYXRpbmcgPj0gMC43NSkgewogICAgICAgICAgICBjaGFuZ2VkID0gdHJ1ZTsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfaWQgPSB0aGlzLmFzc2lnblNJUFRWLmNoYW5uZWxzLmZpbmQoCiAgICAgICAgICAgICAgKGNoYW5uZWwpID0+IGNoYW5uZWwudHZnX25hbWUgPT09IG1hdGNoMS50YXJnZXQKICAgICAgICAgICAgKS50dmdfaWQ7CiAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICB9IGVsc2UgaWYgKG1hdGNoMy5yYXRpbmcgPj0gMC43NSkgewogICAgICAgICAgICBjaGFuZ2VkID0gdHJ1ZTsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfaWQgPSB0aGlzLmFzc2lnblNJUFRWLmNoYW5uZWxzLmZpbmQoCiAgICAgICAgICAgICAgKGNoYW5uZWwpID0+IGNoYW5uZWwudHZnX25hbWUgPT09IG1hdGNoMS50YXJnZXQKICAgICAgICAgICAgKS50dmdfaWQ7CiAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjaGFuZ2VkID0gdHJ1ZTsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfaWQgPSAiIjsKICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSBjaGFuZ2VkOwogICAgICB9CiAgICAgIHRoaXMuYXNzaWduU0lQVFYubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGxvYWRUVkdJREZpbmQoY291bnRyeSkgewogICAgICB0aGlzLmZpbmRUVkdJRC5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZQogICAgICAgIC5nZXQoYGVkaXRvci90di1ndWlkZS8ke2NvdW50cnl9YCkKICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICB0aGlzLmZpbmRUVkdJRC5jaGFubmVsID0gIiI7CiAgICAgICAgICB0aGlzLmZpbmRUVkdJRC5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIHRoaXMuZmluZFRWR0lELmNoYW5uZWxzID0gcmVzLmRhdGEubWFwKChjaGFubmVsKSA9PiB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgdGV4dDogY2hhbm5lbC50dmdfbmFtZSwKICAgICAgICAgICAgICB2YWx1ZTogY2hhbm5lbC50dmdfaWQsCiAgICAgICAgICAgIH07CiAgICAgICAgICB9KTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICB0aGlzLmZpbmRUVkdJRC5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICB9KTsKICAgIH0sCiAgICBsb2FkU2lwdHZGaW5kKGNvdW50cnkpIHsKICAgICAgdGhpcy5maW5kU2lwdHYuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAuZ2V0KGBlZGl0b3Ivc21hcnQtaXB0di8ke2NvdW50cnl9YCkKICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICB0aGlzLmZpbmRTaXB0di5jaGFubmVsID0gIiI7CiAgICAgICAgICB0aGlzLmZpbmRTaXB0di5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIHRoaXMuZmluZFNpcHR2LmNoYW5uZWxzID0gcmVzLmRhdGEubWFwKChjaGFubmVsKSA9PiB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgdGV4dDogY2hhbm5lbC50dmdfbmFtZSwKICAgICAgICAgICAgICB2YWx1ZTogY2hhbm5lbC50dmdfaWQsCiAgICAgICAgICAgIH07CiAgICAgICAgICB9KTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICB0aGlzLmZpbmRUVkdJRC5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICB9KTsKICAgIH0sCiAgICBmaW5kVFZHSURNb2RhbChzaG93LCBzYXZlID0gZmFsc2UpIHsKICAgICAgbGV0IHNlbGVjdGVkID0gdGhpcy5nZXRTdHJlYW1XaXRoSWQodGhpcy5hY3RpdmVTdHJlYW1zWzBdKTsKICAgICAgaWYgKHNob3cpIHsKICAgICAgICB0aGlzLmZpbmRUVkdJRC5jaGFubmVsID0gIiI7CiAgICAgICAgdGhpcy5maW5kVFZHSUQudGl0bGUgPSBzZWxlY3RlZC5zdHJlYW1fdHZnX25hbWU7CiAgICAgIH0KICAgICAgdGhpcy5maW5kVFZHSUQuc2VhcmNoID0gIiI7CiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgaWYgKHNlbGVjdGVkKSB7CiAgICAgICAgICBzZWxlY3RlZC5zdHJlYW1fdHZnX2lkID0gdGhpcy5maW5kVFZHSUQuY2hhbm5lbDsKICAgICAgICAgIHNlbGVjdGVkLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMuZmluZFRWR0lELm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBmaW5kU2lwdHZNb2RhbChzaG93LCBzYXZlID0gZmFsc2UpIHsKICAgICAgbGV0IHNlbGVjdGVkID0gdGhpcy5nZXRTdHJlYW1XaXRoSWQodGhpcy5hY3RpdmVTdHJlYW1zWzBdKTsKICAgICAgaWYgKHNob3cpIHsKICAgICAgICB0aGlzLmZpbmRTaXB0di5jaGFubmVsID0gIiI7CiAgICAgICAgdGhpcy5maW5kU2lwdHYudGl0bGUgPSBzZWxlY3RlZC5zdHJlYW1fdHZnX25hbWU7CiAgICAgIH0KICAgICAgdGhpcy5maW5kU2lwdHYuc2VhcmNoID0gIiI7CiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgaWYgKHNlbGVjdGVkKSB7CiAgICAgICAgICBzZWxlY3RlZC5zdHJlYW1fdHZnX2lkID0gdGhpcy5maW5kU2lwdHYuY2hhbm5lbDsKICAgICAgICAgIHNlbGVjdGVkLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMuZmluZFNpcHR2Lm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBpbXBvcnRNM1VNb2RhbChzaG93LCBzYXZlID0gZmFsc2UpIHsKICAgICAgaWYgKHNob3cpIHsKICAgICAgICB0aGlzLmltcG9ydE0zVS5maWxlID0gbnVsbDsKICAgICAgICB0aGlzLmltcG9ydE0zVS5tM3UgPSBudWxsOwogICAgICAgIHRoaXMuaW1wb3J0TTNVLmdyb3VwcyA9IFtdOwogICAgICAgIHRoaXMuaW1wb3J0TTNVLmltcG9ydEdyb3VwcyA9IFtdOwogICAgICB9CiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlOwogICAgICAgIGxldCBncm91cEluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KChncm91cCkgPT4gewogICAgICAgICAgcmV0dXJuIGdyb3VwLmlkID09IHRoaXMuYWN0aXZlR3JvdXA7CiAgICAgICAgfSk7CiAgICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAgIC5wb3N0KCJlZGl0b3IvaW1wb3J0IiwgewogICAgICAgICAgICBwbGF5bGlzdF9pZDogdGhpcy5wbGF5bGlzdEVkaXRvci5pZCwKICAgICAgICAgICAgaW1wb3J0OiB0aGlzLmltcG9ydE0zVS5ncm91cHMuZmlsdGVyKChncm91cCwgaW5kZXgpID0+CiAgICAgICAgICAgICAgdGhpcy5pbXBvcnRNM1UuaW1wb3J0R3JvdXBzLmluY2x1ZGVzKGluZGV4KQogICAgICAgICAgICApLAogICAgICAgICAgfSkKICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKHJlcy5zdGF0dXMpIHsKICAgICAgICAgICAgICB0aGlzLmxvYWRQbGF5bGlzdCh0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLCBncm91cEluZGV4KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSkKICAgICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB9KTsKICAgICAgfQogICAgICB0aGlzLmltcG9ydE0zVS5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgdXBsb2FkTTNVKGV2ZW50KSB7CiAgICAgIGNvbnN0IGlucHV0ID0gZXZlbnQudGFyZ2V0OwogICAgICBpZiAoImZpbGVzIiBpbiBpbnB1dCAmJiBpbnB1dC5maWxlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgdGhpcy5pbXBvcnRNM1UuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgICB0aGlzLnJlYWRGaWxlQ29udGVudChpbnB1dC5maWxlc1swXSkKICAgICAgICAgIC50aGVuKChjb250ZW50KSA9PiB7CiAgICAgICAgICAgIHRoaXMuaW1wb3J0TTNVLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLnBhcnNlTTNVKGNvbnRlbnQpOwogICAgICAgICAgfSkKICAgICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHsKICAgICAgICAgICAgdGhpcy4kbm90aWZ5KAogICAgICAgICAgICAgICJlcnJvciIsCiAgICAgICAgICAgICAgdGhpcy4kdCgicHJvZmlsZS5mYWlsZWQiKSwKICAgICAgICAgICAgICBlcnJvciwKICAgICAgICAgICAgICAibGEtdXNlci1zaGllbGQiLAogICAgICAgICAgICAgIHsgZHVyYXRpb246IDUwMDAsIHBlcm1hbmVudDogZmFsc2UgfQogICAgICAgICAgICApOwogICAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBwYXJzZU0zVShjb250ZW50KSB7CiAgICAgIGxldCB2bSA9IHRoaXM7CiAgICAgIHZtLmltcG9ydE0zVS5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBtM3UKICAgICAgICAucGFyc2UoCiAgICAgICAgICBjb250ZW50LAogICAgICAgICAgeyB0YWc6ICJuYW1lIiwgdHlwZTogWyJNb3ZpZSIsICJTZXJpZXMiLCAiVk9EIiwgIkxpdmUiXSB9LAogICAgICAgICAgdHJ1ZQogICAgICAgICkKICAgICAgICAudGhlbigocGxheWxpc3QpID0+IHsKICAgICAgICAgIHRoaXMuaW1wb3J0TTNVLm0zdSA9IHBsYXlsaXN0OwogICAgICAgICAgdGhpcy5pbXBvcnRNM1UuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB0aGlzLmltcG9ydE0zVS5ncm91cHMgPSBwbGF5bGlzdC5ncm91cHM7CiAgICAgICAgICB0aGlzLmltcG9ydE0zVS5pbXBvcnRHcm91cHMgPSBbXTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHsKICAgICAgICAgIHZtLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgdm0uJG5vdGlmeSgKICAgICAgICAgICAgImVycm9yIiwKICAgICAgICAgICAgdm0uJHQoInByb2ZpbGUuZmFpbGVkIiksCiAgICAgICAgICAgIGVycm9yLAogICAgICAgICAgICAibGEtdXNlci1zaGllbGQiLAogICAgICAgICAgICB7IGR1cmF0aW9uOiA1MDAwLCBwZXJtYW5lbnQ6IGZhbHNlIH0KICAgICAgICAgICk7CiAgICAgICAgfSk7CiAgICB9LAogICAgcmVhZEZpbGVDb250ZW50KGZpbGUpIHsKICAgICAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgICAgICByZWFkZXIub25sb2FkID0gKGV2ZW50KSA9PiByZXNvbHZlKGV2ZW50LnRhcmdldC5yZXN1bHQpOwogICAgICAgIHJlYWRlci5vbmVycm9yID0gKGVycm9yKSA9PiByZWplY3QoZXJyb3IpOwogICAgICAgIHJlYWRlci5yZWFkQXNUZXh0KGZpbGUpOwogICAgICB9KTsKICAgIH0sCiAgfSwKICBiZWZvcmVNb3VudCgpIHsKICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmFkZCgicmlnaHQtbWVudSIpOwogICAgRXZlbnRCdXMuJG9uKCJzZWFyY2giLCB0aGlzLnNlYXJjaEVkaXRvcik7CiAgICBFdmVudEJ1cy4kb24oInByaW50IiwgdGhpcy5wcmludEVkaXRvcik7CiAgICBFdmVudEJ1cy4kb24oInRhYi1jaGFuZ2UiLCB0aGlzLmRvVGFiQ2hhbmdlKTsKICAgIEV2ZW50QnVzLiRvbigic2F2ZSIsIHRoaXMuZG9TYXZlKTsKICAgIEV2ZW50QnVzLiRvbigiY2FuY2VsIiwgdGhpcy5kb0NhbmNlbCk7CiAgICBpZiAodGhpcy5tb3ZpZVNlcmllUGxheWxpc3QpIHsKICAgICAgdGhpcy5sb2FkUGxheWxpc3QodGhpcy5tb3ZpZVNlcmllUGxheWxpc3QpOwogICAgfQogICAgdGhpcy5sb2FkTG9nb0NvdW50cmllcygpOwogICAgdGhpcy5sb2FkVFZHSURDb3VudHJpZXMoKTsKICAgIHRoaXMubG9hZFNpcHR2Q291bnRyaWVzKCk7CiAgfSwKICBiZWZvcmVEZXN0cm95KCkgewogICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QucmVtb3ZlKCJyaWdodC1tZW51Iik7CiAgICBFdmVudEJ1cy4kb2ZmKCJzZWFyY2giLCB0aGlzLnNlYXJjaEVkaXRvcik7CiAgICBFdmVudEJ1cy4kb2ZmKCJwcmludCIsIHRoaXMucHJpbnRFZGl0b3IpOwogICAgRXZlbnRCdXMuJG9mZigidGFiLWNoYW5nZSIsIHRoaXMuZG9UYWJDaGFuZ2UpOwogICAgRXZlbnRCdXMuJG9mZigic2F2ZSIsIHRoaXMuZG9TYXZlKTsKICAgIEV2ZW50QnVzLiRvZmYoImNhbmNlbCIsIHRoaXMuZG9DYW5jZWwpOwogIH0sCiAgd2F0Y2g6IHsKICAgIGRyYWdTdHJlYW06IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgaWYgKCF2YWwpIHsKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgICB9CiAgICB9LAogICAgZHJhZ0dyb3VwOiBmdW5jdGlvbiAodmFsKSB7CiAgICAgIGlmICghdmFsKSB7CiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgICAgfQogICAgfSwKICAgIGFjdGl2ZUdyb3VwOiBmdW5jdGlvbiAodmFsKSB7CiAgICAgIGlmICh0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQpIHsKICAgICAgICB0aGlzLnNhdmVDaGFuZ2VzTW9kYWwodHJ1ZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5sb2FkU3RyZWFtcygpOwogICAgICB9CiAgICB9LAogICAgInBsYXlsaXN0RWRpdG9yLmNoYW5nZWQiOiBmdW5jdGlvbiAodmFsKSB7CiAgICAgIEV2ZW50QnVzLiRlbWl0KCJlZGl0b3ItY2hhbmdlcyIsIHZhbCk7CiAgICB9LAogICAgInJhZGlvQnJvd3Nlci5zZWFyY2giOiBmdW5jdGlvbiAodmFsKSB7CiAgICAgIGxldCB2bSA9IHRoaXM7CiAgICAgIGNsZWFyVGltZW91dCh0aGlzLnJhZGlvQnJvd3Nlci5ib3VuY2UpOwogICAgICB0aGlzLnJhZGlvQnJvd3Nlci5ib3VuY2UgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICB2bS5maW5kUmFkaW9icm93c2VyKHZhbCk7CiAgICAgIH0sIDUwMCk7CiAgICB9LAogICAgInNvdW5kY2xvdWQudXJsIjogZnVuY3Rpb24gKHZhbCkgewogICAgICBsZXQgdm0gPSB0aGlzOwogICAgICBjbGVhclRpbWVvdXQodGhpcy5yYWRpb0Jyb3dzZXIuYm91bmNlKTsKICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuYm91bmNlID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgdm0uZ2V0U291bmRjbG91ZFRyYWNrKHZhbCwgdm0uc291bmRjbG91ZENsaWVudElkKTsKICAgICAgfSwgNTAwKTsKICAgIH0sCiAgICAieW91dHViZS51cmwiOiBmdW5jdGlvbiAodmFsKSB7CiAgICAgIGlmICghdmFsLmxlbmd0aCkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAoL3lvdXR1XC4/YmUvaS50ZXN0KHZhbCkpIHsKICAgICAgICB2YXIgaTsKICAgICAgICB2YXIgcGF0dGVybnMgPSBbCiAgICAgICAgICAveW91dHVcLmJlXC8oW14jJj9dezExfSkvLCAvLyB5b3V0dS5iZS88aWQ+CiAgICAgICAgICAvXD92PShbXiMmP117MTF9KS8sIC8vID92PTxpZD4KICAgICAgICAgIC8mdj0oW14jJj9dezExfSkvLCAvLyAmdj08aWQ+CiAgICAgICAgICAvZW1iZWRcLyhbXiMmP117MTF9KS8sIC8vIGVtYmVkLzxpZD4KICAgICAgICAgIC9cL3ZcLyhbXiMmP117MTF9KS8sIC8vIC92LzxpZD4KICAgICAgICBdOwoKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcGF0dGVybnMubGVuZ3RoOyArK2kpIHsKICAgICAgICAgIGlmIChwYXR0ZXJuc1tpXS50ZXN0KHZhbCkpIHsKICAgICAgICAgICAgdGhpcy55b3V0dWJlLnZpZGVvSWQgPSBwYXR0ZXJuc1tpXS5leGVjKHZhbClbMV07CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHZhciB0b2tlbnMgPSB2YWwuc3BsaXQoL1svJj89Iy5cc10vZyk7CiAgICAgICAgZm9yIChpID0gMDsgaSA8IHRva2Vucy5sZW5ndGg7ICsraSkgewogICAgICAgICAgaWYgKC9eW14jJj9dezExfSQvLnRlc3QodG9rZW5zW2ldKSkgewogICAgICAgICAgICB0aGlzLnlvdXR1YmUudmlkZW9JZCA9IHRva2Vuc1tpXTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdGhpcy55b3V0dWJlLnZpZGVvSWQgPSAiIjsKICAgICAgfSBlbHNlIHsKICAgICAgICB0cnkgewogICAgICAgICAgdmFyIHVybHAgPSBuZXcgVVJMKHZhbCk7CiAgICAgICAgICB0aGlzLnlvdXR1YmUudmlkZW9JZCA9IHVybHAuc2VhcmNoUGFyYW1zLmdldCgidiIpOwogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICB0aGlzLnlvdXR1YmUudmlkZW9JZCA9ICIiOwogICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgICJ5b3V0dWJlLnZpZGVvSWQiOiBmdW5jdGlvbiAodmFsKSB7CiAgICAgIGxldCB2bSA9IHRoaXM7CiAgICAgIGNsZWFyVGltZW91dCh0aGlzLnlvdXR1YmUuYm91bmNlKTsKICAgICAgdGhpcy55b3V0dWJlLmJvdW5jZSA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgIGlmICh2YWwubGVuZ3RoKSB7CiAgICAgICAgICB2bS5nZXRZb3V0dWJlUGFnZSh2YWwpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2bS55b3V0dWJlLnZpZGVvID0gbnVsbDsKICAgICAgICB9CiAgICAgIH0sIDUwMCk7CiAgICB9LAogICAgInZpbWVvLnVybCI6IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgaWYgKC92aW1lb1wuY29tL2kudGVzdCh2YWwpKSB7CiAgICAgICAgbGV0IG1hdGNoID0gdmFsLm1hdGNoKAogICAgICAgICAgLyg/Ond3d1wufHBsYXllclwuKT92aW1lby5jb21cLyg/OmNoYW5uZWxzXC8oPzpcdytcLyk/fGdyb3Vwc1wvKD86W14vXSopXC92aWRlb3NcL3xhbGJ1bVwvKD86XGQrKVwvdmlkZW9cL3x2aWRlb1wvfCkoXGQrKSg/OlthLXpBLVowLTlfLV0rKT8vaQogICAgICAgICk7CiAgICAgICAgaWYgKG1hdGNoLmxlbmd0aCA+PSAyKSB7CiAgICAgICAgICB0aGlzLnZpbWVvLnZpZGVvSWQgPSBtYXRjaFsxXTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy52aW1lby52aWRlb0lkID0gIiI7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMudmltZW8udmlkZW9JZCA9ICIiOwogICAgICB9CiAgICB9LAogICAgInZpbWVvLnZpZGVvSWQiOiBmdW5jdGlvbiAodmFsKSB7CiAgICAgIGxldCB2bSA9IHRoaXM7CiAgICAgIGNsZWFyVGltZW91dCh0aGlzLnZpbWVvLmJvdW5jZSk7CiAgICAgIHRoaXMudmltZW8uYm91bmNlID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKHZhbC5sZW5ndGgpIHsKICAgICAgICAgIHZtLmdldFZpbWVvQ29uZmlnKHZhbCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZtLnZpbWVvLnZpZGVvID0gbnVsbDsKICAgICAgICB9CiAgICAgIH0sIDUwMCk7CiAgICB9LAogICAgImRhaWx5bW90aW9uLnVybCI6IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgaWYgKC9kYWlseW1vdGlvblwuY29tL2kudGVzdCh2YWwpKSB7CiAgICAgICAgbGV0IG1hdGNoID0gdmFsLm1hdGNoKAogICAgICAgICAgL14uK2RhaWx5bW90aW9uLmNvbVwvKHZpZGVvfGh1YilcLyhbXl9dKylbXiNdKigjdmlkZW89KFteXyZdKykpPy9pCiAgICAgICAgKTsKICAgICAgICBpZiAobWF0Y2gubGVuZ3RoID49IDQgJiYgbWF0Y2hbNF0pIHsKICAgICAgICAgIHRoaXMuZGFpbHltb3Rpb24udmlkZW9JZCA9IG1hdGNoWzRdOwogICAgICAgIH0gZWxzZSBpZiAobWF0Y2gubGVuZ3RoID49IDIpIHsKICAgICAgICAgIHRoaXMuZGFpbHltb3Rpb24udmlkZW9JZCA9IG1hdGNoWzJdOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLmRhaWx5bW90aW9uLnZpZGVvSWQgPSAiIjsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5kYWlseW1vdGlvbi52aWRlb0lkID0gIiI7CiAgICAgIH0KICAgIH0sCiAgICAiZGFpbHltb3Rpb24udmlkZW9JZCI6IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgbGV0IHZtID0gdGhpczsKICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuZGFpbHltb3Rpb24uYm91bmNlKTsKICAgICAgdGhpcy5kYWlseW1vdGlvbi5ib3VuY2UgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAodmFsLmxlbmd0aCkgewogICAgICAgICAgdm0uZ2V0RGFpbHltb3Rpb25Db25maWcodmFsKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdm0uZGFpbHltb3Rpb24udmlkZW8gPSBudWxsOwogICAgICAgIH0KICAgICAgfSwgNTAwKTsKICAgIH0sCiAgICAidGVkVGFsa3MudXJsIjogZnVuY3Rpb24gKHZhbCkgewogICAgICBpZiAoL3RlZFwuY29tXC90YWxrcy9pLnRlc3QodmFsKSkgewogICAgICAgIGxldCB2bSA9IHRoaXM7CiAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMudGVkVGFsa3MuYm91bmNlKTsKICAgICAgICB0aGlzLnRlZFRhbGtzLmJvdW5jZSA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKHZhbC5sZW5ndGgpIHsKICAgICAgICAgICAgdm0uZ2V0VGVkVGFsa3NDb25maWcodmFsKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZtLnRlZFRhbGtzLnZpZGVvID0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICB9LCA1MDApOwogICAgICB9CiAgICB9LAogICAgInhoYW1zdGVyLnVybCI6IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgbGV0IHZtID0gdGhpczsKICAgICAgaWYgKC94aGFtc3RlclwuY29tXC92aWRlb3MvaS50ZXN0KHZhbCkpIHsKICAgICAgICBjbGVhclRpbWVvdXQodGhpcy54aGFtc3RlckJvdW5jZSk7CiAgICAgICAgdGhpcy54aGFtc3RlckJvdW5jZSA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKHZhbC5sZW5ndGgpIHsKICAgICAgICAgICAgdm0uZ2V0WGhhbXN0ZXJDb25maWcodmFsKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZtLnhoYW1zdGVyLnZpZGVvID0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICB9LCA1MDApOwogICAgICB9CiAgICB9LAogICAgImZpbmRMb2dvLmNvdW50cnkiOiBmdW5jdGlvbiAodmFsKSB7CiAgICAgIGlmICh2YWwubGVuZ3RoKSB7CiAgICAgICAgdGhpcy5sb2FkTG9nb3NGaW5kKHZhbCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5maW5kTG9nby5sb2dvID0gIiI7CiAgICAgIH0KICAgIH0sCiAgICAiYXNzaWduTG9nby5jb3VudHJ5IjogZnVuY3Rpb24gKHZhbCkgewogICAgICBpZiAodmFsLmxlbmd0aCkgewogICAgICAgIHRoaXMubG9hZExvZ29zQXNzaWduKHZhbCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5hc3NpZ25Mb2dvLmxvZ28gPSAiIjsKICAgICAgfQogICAgfSwKICAgICJmaW5kVFZHSUQuY291bnRyeSI6IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgaWYgKHZhbC5sZW5ndGgpIHsKICAgICAgICB0aGlzLmxvYWRUVkdJREZpbmQodmFsKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmZpbmRUVkdJRC5jaGFubmVsID0gIiI7CiAgICAgIH0KICAgIH0sCiAgICAiZmluZFNpcHR2LmNvdW50cnkiOiBmdW5jdGlvbiAodmFsKSB7CiAgICAgIGlmICh2YWwubGVuZ3RoKSB7CiAgICAgICAgdGhpcy5sb2FkU2lwdHZGaW5kKHZhbCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5maW5kU2lwdHYuY2hhbm5lbCA9ICIiOwogICAgICB9CiAgICB9LAogICAgImFzc2lnblRWR0lELmNvdW50cnkiOiBmdW5jdGlvbiAodmFsKSB7CiAgICAgIGlmICh2YWwubGVuZ3RoKSB7CiAgICAgICAgdGhpcy5sb2FkVFZHSURBc3NpZ24odmFsKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmFzc2lnblRWR0lELmNoYW5uZWxzID0gW107CiAgICAgIH0KICAgIH0sCiAgICAiYXNzaWduU0lQVFYuY291bnRyeSI6IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgaWYgKHZhbC5sZW5ndGgpIHsKICAgICAgICB0aGlzLmxvYWRTaXB0dkFzc2lnbih2YWwpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYXNzaWduVFZHSUQuY2hhbm5lbHMgPSBbXTsKICAgICAgfQogICAgfSwKICAgIG1vdmllU2VyaWVQbGF5bGlzdDogZnVuY3Rpb24gKHZhbCkgewogICAgICB0aGlzLmxvYWRQbGF5bGlzdCh2YWwpOwogICAgfSwKICB9LAp9Owo="},null]}