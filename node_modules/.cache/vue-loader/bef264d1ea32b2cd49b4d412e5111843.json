{"remainingRequest":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/vue-loader/lib/index.js??vue-loader-options!/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/src/views/app/xtream/editor.vue?vue&type=script&lang=js&","dependencies":[{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/src/views/app/xtream/editor.vue","mtime":1624960129020},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCi8qIGVzbGludC1kaXNhYmxlIHZ1ZS9uby1zaWRlLWVmZmVjdHMtaW4tY29tcHV0ZWQtcHJvcGVydGllcyAqLwovKiBlc2xpbnQtZGlzYWJsZSBuby11bnVzZWQtdmFycyAqLwovKiBlc2xpbnQtZGlzYWJsZSBuby11c2VsZXNzLWVzY2FwZSAqLwoKaW1wb3J0IHsgRXZlbnRCdXMgfSBmcm9tICIuLi8uLi8uLi9zZXJ2aWNlcy9lYnVzIjsKaW1wb3J0IHsgaHR0cFNlcnZpY2UgfSBmcm9tICIuLi8uLi8uLi9zZXJ2aWNlcy9odHRwIjsKaW1wb3J0IHsgbWFwR2V0dGVycyB9IGZyb20gInZ1ZXgiOwppbXBvcnQgZHJhZ2dhYmxlIGZyb20gInZ1ZWRyYWdnYWJsZSI7CmltcG9ydCB7IFN1YnNjcmlwdGlvblR5cGUgfSBmcm9tICIuLi8uLi8uLi9jb25zdGFudHMvY29uZmlnIjsKaW1wb3J0IHsgY291bnRyaWVzIH0gZnJvbSAiLi4vLi4vLi4vaGVscGVycyI7CmltcG9ydCB7IG0zdSB9IGZyb20gIi4uLy4uLy4uL3BsdWdpbnMvbTN1IjsKCmV4cG9ydCBkZWZhdWx0IHsKICBjb21wb25lbnRzOiB7CiAgICBkcmFnZ2FibGUsCiAgfSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgY291bnRyaWVzLAogICAgICBhY3RpdmVUYWI6IDAsCiAgICAgIGFjdGl2ZUdyb3VwOiAtMSwKICAgICAgYWN0aXZlR3JvdXBzOiBbXSwKICAgICAgYWN0aXZlU3RyZWFtOiAtMSwKICAgICAgYWN0aXZlU3RyZWFtczogW10sCiAgICAgIGRyYWdHcm91cDogZmFsc2UsCiAgICAgIGRyYWdTdHJlYW06IGZhbHNlLAogICAgICBlZGl0b3I6IGZhbHNlLAogICAgICBzZWFyY2g6IG51bGwsCiAgICAgIGlzTG9hZGluZzogZmFsc2UsCiAgICAgIHBsYXlsaXN0RWRpdG9yOiB7CiAgICAgICAgaWQ6IHVuZGVmaW5lZCwKICAgICAgICBwbGF5bGlzdDogbnVsbCwKICAgICAgICBncm91cHM6IFtdLAogICAgICAgIHN0cmVhbXM6IFtdLAogICAgICAgIGNoYW5nZWQ6IGZhbHNlLAogICAgICB9LAogICAgICBmaW5kUmVwbGFjZTogewogICAgICAgIHR5cGU6IDAsCiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIGZyb206ICIiLAogICAgICAgIHRvOiAiIiwKICAgICAgICByZXBsYWNlQWxsOiBmYWxzZSwKICAgICAgICBpZ25vcmVDYXNlOiBmYWxzZSwKICAgICAgICBzZWxlY3RlZE9ubHk6IDAsCiAgICAgIH0sCiAgICAgIHByZWZpeFN1ZmZpeDogewogICAgICAgIHR5cGU6IDAsCiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIHByZWZpeDogIiIsCiAgICAgICAgc3VmZml4OiAiIiwKICAgICAgICBzZWxlY3RlZE9ubHk6IDAsCiAgICAgIH0sCiAgICAgIGNvbnZlcnRDYXNlOiB7CiAgICAgICAgdHlwZTogMCwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgbWV0aG9kOiAwLAogICAgICAgIHNlbGVjdGVkT25seTogMCwKICAgICAgfSwKICAgICAgZ3JvdXBFZGl0b3I6IHsKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgaWQ6IDAsCiAgICAgICAgZ3JvdXBfbmFtZTogIiIsCiAgICAgICAgZ3JvdXBfcGFyZW50X2NvZGU6ICIiLAogICAgICAgIGdyb3VwX3R5cGU6IDEsCiAgICAgICAgZ3JvdXBfaXNfaGlkZGVuOiAwLAogICAgICB9LAogICAgICBzdHJlYW1FZGl0b3I6IHsKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgaWQ6IC0xLAogICAgICAgIHN0cmVhbV90dmdfbmFtZTogIiIsCiAgICAgICAgc3RyZWFtX3R2Z19pZDogIiIsCiAgICAgICAgc3RyZWFtX3R2Z19sb2dvOiAiIiwKICAgICAgICBzdHJlYW1fcGFyZW50X2NvZGU6ICIiLAogICAgICAgIHN0cmVhbV9yYWRpbzogMCwKICAgICAgICBzdHJlYW1faXNfaGlkZGVuOiAwLAogICAgICAgIHN0cmVhbV9pc19jdXN0b206IDAsCiAgICAgICAgbW92aWVfbmFtZTogIiIsCiAgICAgICAgbW92aWVfeWVhcjogIiIsCiAgICAgICAgc2VyaWVfbmFtZTogIiIsCiAgICAgICAgc2VyaWVfc2Vhc29uOiAwLAogICAgICAgIHNlcmllX2VwaXNvZGU6IDAsCiAgICAgICAgc291cmNlX3N0cmVhbV91cmw6ICIiLAogICAgICB9LAogICAgICByYWRpb0Jyb3dzZXI6IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBib3VuY2U6IG51bGwsCiAgICAgICAgYWN0aXZlOiBbXSwKICAgICAgICBzZWFyY2g6ICIiLAogICAgICAgIHJlc3VsdHM6IFtdLAogICAgICB9LAogICAgICBzb3VuZGNsb3VkOiB7CiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgYm91bmNlOiBudWxsLAogICAgICAgIHVybDogIiIsCiAgICAgICAgdHJhY2s6IG51bGwsCiAgICAgIH0sCiAgICAgIHlvdXR1YmU6IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBib3VuY2U6IG51bGwsCiAgICAgICAgdXJsOiAiIiwKICAgICAgICB2aWRlb0lkOiAiIiwKICAgICAgICB2aWRlbzogbnVsbCwKICAgICAgfSwKICAgICAgdmltZW86IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBib3VuY2U6IG51bGwsCiAgICAgICAgdXJsOiAiIiwKICAgICAgICB2aWRlb0lkOiAiIiwKICAgICAgICB2aWRlbzogbnVsbCwKICAgICAgfSwKICAgICAgZGFpbHltb3Rpb246IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBib3VuY2U6IG51bGwsCiAgICAgICAgdXJsOiAiIiwKICAgICAgICB2aWRlb0lkOiAiIiwKICAgICAgICB2aWRlbzogbnVsbCwKICAgICAgfSwKICAgICAgdGVkVGFsa3M6IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBib3VuY2U6IG51bGwsCiAgICAgICAgdXJsOiAiIiwKICAgICAgICB2aWRlbzogbnVsbCwKICAgICAgfSwKICAgICAgeGhhbXN0ZXI6IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBib3VuY2U6IG51bGwsCiAgICAgICAgdXJsOiAiIiwKICAgICAgICB2aWRlbzogbnVsbCwKICAgICAgfSwKICAgICAgZmluZExvZ286IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBjb3VudHJpZXM6IFtdLAogICAgICAgIGNvdW50cnk6ICIiLAogICAgICAgIGxvZ29zOiBbXSwKICAgICAgICBsb2dvOiAiIiwKICAgICAgICBzZWFyY2g6ICIiLAogICAgICAgIHRpdGxlOiAiIiwKICAgICAgfSwKICAgICAgYXNzaWduTG9nbzogewogICAgICAgIGlzTG9hZGluZzogZmFsc2UsCiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIGNvdW50cmllczogW10sCiAgICAgICAgY291bnRyeTogIiIsCiAgICAgICAgbG9nb3M6IFtdLAogICAgICAgIGFzc2lnbkFsbDogMCwKICAgICAgfSwKICAgICAgaW1wb3J0TTNVOiB7CiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgZ3JvdXBzOiBbXSwKICAgICAgICBpbXBvcnRHcm91cHM6IFtdLAogICAgICAgIG0zdTogbnVsbCwKICAgICAgICBmaWxlOiBudWxsLAogICAgICB9LAogICAgICBmaW5kVFZHSUQ6IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBjb3VudHJpZXM6IFtdLAogICAgICAgIGNvdW50cnk6ICIiLAogICAgICAgIGNoYW5uZWxzOiBbXSwKICAgICAgICBjaGFubmVsOiAiIiwKICAgICAgICBzZWFyY2g6ICIiLAogICAgICAgIHRpdGxlOiAiIiwKICAgICAgfSwKICAgICAgYXNzaWduVFZHSUQ6IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBjb3VudHJpZXM6IFtdLAogICAgICAgIGNvdW50cnk6ICIiLAogICAgICAgIGNoYW5uZWxzOiBbXSwKICAgICAgICBhc3NpZ25BbGw6IDAsCiAgICAgIH0sCiAgICAgIHNhdmVDaGFuZ2VzOiB7CiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICB9LAogICAgICBncm91cFR5cGVzOiBbCiAgICAgICAgeyB0ZXh0OiB0aGlzLiR0KCJ4dHJlYW0ubGl2ZSIpLCB2YWx1ZTogMSB9LAogICAgICAgIHsgdGV4dDogdGhpcy4kdCgieHRyZWFtLm1vdmllcyIpLCB2YWx1ZTogMiB9LAogICAgICAgIHsgdGV4dDogdGhpcy4kdCgieHRyZWFtLnNlcmllcyIpLCB2YWx1ZTogMyB9LAogICAgICBdLAogICAgfTsKICB9LAogIGNvbXB1dGVkOiB7CiAgICAuLi5tYXBHZXR0ZXJzKFsiY3VycmVudFVzZXIiLCAic2V0dGluZ3MiLCAic291bmRjbG91ZENsaWVudElkIiwgIm1vdmllU2VyaWVQbGF5bGlzdCJdKSwKICAgIHNlYXJjaEZpbHRlcmVkKCkgewogICAgICBpZiAodGhpcy5zZWFyY2ggPT09IG51bGwpIHsKICAgICAgICByZXR1cm4gdGhpcy5hY2NvdW50czsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgcmUgPSBuZXcgUmVnRXhwKHRoaXMuc2VhcmNoLCAiaSIpOwogICAgICAgIHJldHVybiB0aGlzLmFjY291bnRzLmZpbHRlcigoYWNjb3VudCkgPT4gewogICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgU3RyaW5nKGFjY291bnQudGl0bGUpLm1hdGNoKHJlKSB8fAogICAgICAgICAgICBTdHJpbmcoYWNjb3VudC5ob3N0KS5tYXRjaChyZSkgfHwKICAgICAgICAgICAgU3RyaW5nKGFjY291bnQucG9ydCkubWF0Y2gocmUpIHx8CiAgICAgICAgICAgIFN0cmluZyhhY2NvdW50LnVzZXJuYW1lKS5tYXRjaChyZSkgfHwKICAgICAgICAgICAgU3RyaW5nKGFjY291bnQucGFzc3dvcmQpLm1hdGNoKHJlKSB8fAogICAgICAgICAgICB0aGlzLmZvcm1hdERhdGUoYWNjb3VudC5zeW5jZWRfYXQpLm1hdGNoKHJlKSB8fAogICAgICAgICAgICB0aGlzLiR0KGBzeW5jLWludGVydmFsLiR7YWNjb3VudC5zeW5jX2ludGVydmFsfWApLm1hdGNoKHJlKQogICAgICAgICAgKTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIHBsYXlsaXN0U2VsZWN0ZWQoKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkICE9PSB1bmRlZmluZWQ7CiAgICB9LAogICAgbGFzdFNlbGVjdGVkR3JvdXAoKSB7CiAgICAgIHJldHVybiB0aGlzLmFjdGl2ZUdyb3Vwc1t0aGlzLmFjdGl2ZUdyb3Vwcy5sZW5ndGggLSAxXTsKICAgIH0sCiAgICBsYXN0U2VsZWN0ZWRTdHJlYW0oKSB7CiAgICAgIHJldHVybiB0aGlzLmFjdGl2ZVN0cmVhbXNbdGhpcy5hY3RpdmVTdHJlYW1zLmxlbmd0aCAtIDFdOwogICAgfSwKICAgIGNhbkVkaXRHcm91cFR5cGUoKSB7CiAgICAgIHJldHVybiAoCiAgICAgICAgdGhpcy5ncm91cEVkaXRvci5pZCAmJgogICAgICAgIHRoaXMuZ2V0R3JvdXBXaXRoSWQodGhpcy5ncm91cEVkaXRvci5pZCkuc3RyZWFtcyA9PSAwCiAgICAgICk7CiAgICB9LAogICAgc3Vic2NyaXB0aW9uTGltaXRlZCgpIHsKICAgICAgcmV0dXJuICgKICAgICAgICB0aGlzLmN1cnJlbnRVc2VyLnN1YnNjcmlwdGlvbiAmJgogICAgICAgIHRoaXMuY3VycmVudFVzZXIuc3Vic2NyaXB0aW9uLnN1YnNjcmlwdGlvbl90eXBlID09CiAgICAgICAgICBTdWJzY3JpcHRpb25UeXBlLkVudGh1c2lhc3QKICAgICAgKTsKICAgIH0sCiAgICBmaWx0ZXJlZEdyb3VwcygpIHsKICAgICAgaWYgKHRoaXMuc3Vic2NyaXB0aW9uTGltaXRlZCkgewogICAgICAgIHJldHVybiB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maWx0ZXIoCiAgICAgICAgICAoZ3JvdXApID0+CiAgICAgICAgICAgIGdyb3VwLmdyb3VwX2lzX3JlbW92ZWQgIT09IDEgJiYKICAgICAgICAgICAgZ3JvdXAuc291cmNlX2dyb3VwX3R5cGUgPT0gMSAmJgogICAgICAgICAgICBncm91cC5ncm91cF90eXBlID09IDEKICAgICAgICApOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maWx0ZXIoCiAgICAgICAgKGdyb3VwKSA9PiBncm91cC5ncm91cF9pc19yZW1vdmVkICE9PSAxCiAgICAgICk7CiAgICB9LAogICAgZmlsdGVyZWRTdHJlYW1zKCkgewogICAgICByZXR1cm4gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmZpbHRlcigKICAgICAgICAoZ3JvdXApID0+IGdyb3VwLnN0cmVhbV9pc19yZW1vdmVkICE9PSAxCiAgICAgICk7CiAgICB9LAogICAgYWN0aXZlR3JvdXBUeXBlKCkgewogICAgICBsZXQgaW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoCiAgICAgICAgKGdyb3VwKSA9PiBncm91cC5pZCA9PSB0aGlzLmFjdGl2ZUdyb3VwCiAgICAgICk7CiAgICAgIHJldHVybiBpbmRleCA+IC0xID8gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaW5kZXhdLmdyb3VwX3R5cGUgOiAwOwogICAgfSwKICAgIGZpbHRlcmVkTG9nb3MoKSB7CiAgICAgIGlmICghdGhpcy5maW5kTG9nby5zZWFyY2gubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZmluZExvZ28ubG9nb3M7CiAgICAgIH0KICAgICAgbGV0IHNlbGVjdGVkU3RyZWFtID0gdGhpcy5nZXRTdHJlYW1XaXRoSWQodGhpcy5hY3RpdmVTdHJlYW1zWzBdKTsKICAgICAgbGV0IHJlID0gbmV3IFJlZ0V4cCh0aGlzLmZpbmRMb2dvLnNlYXJjaCwgImkiKTsKICAgICAgcmV0dXJuIHRoaXMuZmluZExvZ28ubG9nb3MuZmlsdGVyKChsb2dvKSA9PiB7CiAgICAgICAgcmV0dXJuIGxvZ28udGV4dC5tYXRjaChyZSk7CiAgICAgIH0pOwogICAgfSwKICAgIGZpbHRlcmVkVFZHSURTKCkgewogICAgICBpZiAoIXRoaXMuZmluZFRWR0lELnNlYXJjaC5sZW5ndGgpIHsKICAgICAgICByZXR1cm4gdGhpcy5maW5kVFZHSUQuY2hhbm5lbHM7CiAgICAgIH0KICAgICAgbGV0IHNlbGVjdGVkU3RyZWFtID0gdGhpcy5nZXRTdHJlYW1XaXRoSWQodGhpcy5hY3RpdmVTdHJlYW1zWzBdKTsKICAgICAgbGV0IHJlID0gbmV3IFJlZ0V4cCh0aGlzLmZpbmRUVkdJRC5zZWFyY2gsICJpIik7CiAgICAgIHJldHVybiB0aGlzLmZpbmRUVkdJRC5jaGFubmVscy5maWx0ZXIoKGNoYW5uZWwpID0+IHsKICAgICAgICByZXR1cm4gY2hhbm5lbC50ZXh0Lm1hdGNoKHJlKTsKICAgICAgfSk7CiAgICB9LAogICAgZ3JvdXBDb250ZXh0TWVudSgpIHsKICAgICAgbGV0IHZtID0gdGhpczsKICAgICAgcmV0dXJuIFsKICAgICAgICB7CiAgICAgICAgICBpY29uOiAibGEtcGx1cyIsCiAgICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLmFkZC1ncm91cCIpLAogICAgICAgICAgb25DbGljazogdm0uYWRkR3JvdXAsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBkaXNhYmxlZDogdm0uYWN0aXZlR3JvdXBzLmxlbmd0aCAhPT0gMSwKICAgICAgICAgIGljb246ICJsYS1lZGl0IiwKICAgICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IuZWRpdC1ncm91cCIpLAogICAgICAgICAgb25DbGljazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICBpZiAodm0uYWN0aXZlR3JvdXBzLmxlbmd0aCA9PT0gMSkgewogICAgICAgICAgICAgIHZtLmVkaXRHcm91cE1vZGFsKHRydWUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgZGl2aWRlcjogdHJ1ZSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIHRleHQ6IHZtLiR0KCJnZW5lcmFsLnNlbGVjdC1hbGwiKSwKICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdm0uYWN0aXZlR3JvdXBzID0gWy4uLnZtLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5tYXAoKGcpID0+IGcuaWQpXTsKICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICB0ZXh0OiB2bS4kdCgiZ2VuZXJhbC5zZWxlY3Qtbm9uZSIpLAogICAgICAgICAgb25DbGljazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2bS5hY3RpdmVHcm91cHMgPSBbXTsKICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBkaXZpZGVyOiB0cnVlLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgaWNvbjogImxhLXNlYXJjaCIsCiAgICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLmZpbmQtcmVwbGFjZSIpLAogICAgICAgICAgb25DbGljazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2bS5maW5kQW5kUmVwbGFjZU1vZGFsKHRydWUsIDEpOwogICAgICAgICAgfSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGljb246ICJsYS1wZW4iLAogICAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5hZGQtcHJlZml4LXN1ZmZpeCIpLAogICAgICAgICAgb25DbGljazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2bS5wcmVmaXhTdWZmaXhNb2RhbCh0cnVlLCAxKTsKICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBpY29uOiAibGEtZm9udCIsCiAgICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLmNoYW5nZS1jYXNlIiksCiAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZtLmNvbnZlcnRDYXNlTW9kYWwodHJ1ZSwgMSk7CiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgZGl2aWRlcjogdHJ1ZSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGRpc2FibGVkOiB2bS5hY3RpdmVHcm91cHMubGVuZ3RoID09PSAwLAogICAgICAgICAgaWNvbjogImxhLWV5ZSIsCiAgICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLnRvZ2dsZS12aXNpYmlsaXR5IiksCiAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmICh2bS5hY3RpdmVHcm91cHMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgdm0udG9nZ2xlR3JvdXBWaXNpYmlsaXR5KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBkaXNhYmxlZDogdm0uYWN0aXZlR3JvdXBzLmxlbmd0aCA9PT0gMCwKICAgICAgICAgIGljb246ICJsYS10cmFzaCIsCiAgICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLmRlbGV0ZSIpLAogICAgICAgICAgb25DbGljazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICBpZiAodm0uYWN0aXZlR3JvdXBzLmxlbmd0aCkgewogICAgICAgICAgICAgIHZtLmRlbGV0ZVNlbGVjdGVkR3JvdXBzKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgICAgXTsKICAgIH0sCiAgICBzdHJlYW1Db250ZXh0TWVudSgpIHsKICAgICAgbGV0IHZtID0gdGhpczsKICAgICAgcmV0dXJuIFsKICAgICAgICB7CiAgICAgICAgICBpY29uOiAibGEtcGx1cyIsCiAgICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLmFkZC1zdHJlYW0iKSwKICAgICAgICAgIG9uQ2xpY2s6IHZtLmFkZFN0cmVhbSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGRpc2FibGVkOiB2bS5hY3RpdmVTdHJlYW1zLmxlbmd0aCAhPT0gMSwKICAgICAgICAgIGljb246ICJsYS1lZGl0IiwKICAgICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IuZWRpdC1zdHJlYW0iKSwKICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKHZtLmFjdGl2ZVN0cmVhbXMubGVuZ3RoID09PSAxKSB7CiAgICAgICAgICAgICAgdm0uZWRpdFN0cmVhbU1vZGFsKHRydWUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgZGl2aWRlcjogdHJ1ZSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIHRleHQ6IHZtLiR0KCJnZW5lcmFsLnNlbGVjdC1hbGwiKSwKICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdm0uYWN0aXZlU3RyZWFtcyA9IFsuLi52bS5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLm1hcCgoZykgPT4gZy5pZCldOwogICAgICAgICAgfSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIHRleHQ6IHZtLiR0KCJnZW5lcmFsLnNlbGVjdC1ub25lIiksCiAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZtLmFjdGl2ZVN0cmVhbXMgPSBbXTsKICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBkaXZpZGVyOiB0cnVlLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgZGlzYWJsZWQ6CiAgICAgICAgICAgIHZtLmFjdGl2ZUdyb3Vwcy5sZW5ndGggIT09IDEgfHwKICAgICAgICAgICAgdm0uYWN0aXZlU3RyZWFtcy5sZW5ndGggPT09IDAgfHwKICAgICAgICAgICAgdm0uZ2V0R3JvdXBXaXRoSWQodm0uYWN0aXZlR3JvdXBzWzBdKS5ncm91cF90eXBlICE9PQogICAgICAgICAgICAgIHZtLmFjdGl2ZUdyb3VwVHlwZSB8fAogICAgICAgICAgICB2bS5hY3RpdmVHcm91cHNbMF0gPT09IHZtLmFjdGl2ZUdyb3VwLAogICAgICAgICAgaWNvbjogImxhLWNoZXZyb24tbGVmdCIsCiAgICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLm1vdmUtdG8tc2VsZWN0ZWQtZ3JvdXAiKSwKICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdm0ubW92ZVRvU2VsZWN0ZWRHcm91cCgpOwogICAgICAgICAgfSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGRpdmlkZXI6IHRydWUsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBpY29uOiAibGEtc2VhcmNoIiwKICAgICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IuZmluZC1yZXBsYWNlIiksCiAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZtLmZpbmRBbmRSZXBsYWNlTW9kYWwodHJ1ZSwgMik7CiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgaWNvbjogImxhLXBlbiIsCiAgICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLmFkZC1wcmVmaXgtc3VmZml4IiksCiAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZtLnByZWZpeFN1ZmZpeE1vZGFsKHRydWUsIDIpOwogICAgICAgICAgfSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGljb246ICJsYS1mb250IiwKICAgICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IuY2hhbmdlLWNhc2UiKSwKICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdm0uY29udmVydENhc2VNb2RhbCh0cnVlLCAyKTsKICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBkaXZpZGVyOiB0cnVlLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgZGlzYWJsZWQ6IHZtLmFjdGl2ZVN0cmVhbXMubGVuZ3RoICE9PSAxIHx8IHZtLmFjdGl2ZUdyb3VwVHlwZSAhPT0gMSwKICAgICAgICAgIGljb246ICJsYS1waG90by12aWRlbyIsCiAgICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLmZpbmQtbG9nbyIpLAogICAgICAgICAgb25DbGljazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2bS5maW5kTG9nb01vZGFsKHRydWUpOwogICAgICAgICAgfSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGRpc2FibGVkOiB2bS5hY3RpdmVTdHJlYW1zLmxlbmd0aCAhPT0gMSB8fCB2bS5hY3RpdmVHcm91cFR5cGUgIT09IDEsCiAgICAgICAgICBpY29uOiAibGEtdGgtbGlzdCIsCiAgICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLmZpbmQtdHYtZ3VpZGUiKSwKICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdm0uZmluZFRWR0lETW9kYWwodHJ1ZSk7CiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgZGl2aWRlcjogdHJ1ZSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGRpc2FibGVkOiB2bS5hY3RpdmVTdHJlYW1zLmxlbmd0aCA9PT0gMCB8fCB2bS5hY3RpdmVHcm91cFR5cGUgIT09IDEsCiAgICAgICAgICBpY29uOiAibGEtbXVzaWMiLAogICAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci50b2dnbGUtcmFkaW8iKSwKICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKHZtLmFjdGl2ZVN0cmVhbXMubGVuZ3RoICYmIHZtLmFjdGl2ZUdyb3VwVHlwZSA9PSAxKSB7CiAgICAgICAgICAgICAgdm0udG9nZ2xlU3RyZWFtUmFkaW8oKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGRpc2FibGVkOiB2bS5hY3RpdmVTdHJlYW1zLmxlbmd0aCA9PT0gMCwKICAgICAgICAgIGljb246ICJsYS1leWUiLAogICAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci50b2dnbGUtdmlzaWJpbGl0eSIpLAogICAgICAgICAgb25DbGljazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICBpZiAodm0uYWN0aXZlU3RyZWFtcy5sZW5ndGgpIHsKICAgICAgICAgICAgICB2bS50b2dnbGVTdHJlYW1WaXNpYmlsaXR5KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBkaXZpZGVyOiB0cnVlLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgZGlzYWJsZWQ6IHZtLmFjdGl2ZVN0cmVhbXMubGVuZ3RoID09PSAwLAogICAgICAgICAgaWNvbjogImxhLXRyYXNoIiwKICAgICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IuZGVsZXRlIiksCiAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmICh2bS5hY3RpdmVTdHJlYW1zLmxlbmd0aCkgewogICAgICAgICAgICAgIHZtLmRlbGV0ZVNlbGVjdGVkU3RyZWFtcygpOwogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgIF07CiAgICB9LAogIH0sCiAgbWV0aG9kczogewogICAgZ3JvdXBEcmFnQ2hhbmdlZChnKSB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAodGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uZ3JvdXBfb3JkZXIgIT0gaSArIDEpIHsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmdyb3VwX29yZGVyID0gaSArIDE7CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgc3RyZWFtRHJhZ0NoYW5nZWQoZykgewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmICh0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uc3RyZWFtX29yZGVyICE9IGkgKyAxKSB7CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uc3RyZWFtX29yZGVyID0gaSArIDE7CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIG9wZW5Db250ZXh0KGNvbnRleHQpIHsKICAgICAgdGhpcy4kcmVmc1tjb250ZXh0XS5vcGVuKCk7CiAgICB9LAogICAgc2VhcmNoRWRpdG9yKHNlYXJjaCkgewogICAgICBpZiAoc2VhcmNoLmxlbmd0aCA9PT0gMCkgewogICAgICAgIHRoaXMuc2VhcmNoID0gbnVsbDsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNlYXJjaCA9IHNlYXJjaDsKICAgICAgfQogICAgfSwKICAgIHByaW50RWRpdG9yKCkgewogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZWRpdG9yIikucHJpbnQoKTsKICAgIH0sCiAgICBmb3JtYXROdW1iZXIobnVtYmVyKSB7CiAgICAgIHJldHVybiBuZXcgSW50bC5OdW1iZXJGb3JtYXQodGhpcy4kdCgiZGF0ZS5sb2NhbGUiKSkuZm9ybWF0KG51bWJlcik7CiAgICB9LAogICAgZm9ybWF0RGF0ZShkYXRlKSB7CiAgICAgIHJldHVybiBuZXcgRGF0ZShkYXRlKS50b0xvY2FsZVN0cmluZygKICAgICAgICB0aGlzLiR0KCJkYXRlLmxvY2FsZSIpLAogICAgICAgIHRoaXMuZGF0ZU9wdGlvbnMKICAgICAgKTsKICAgIH0sCiAgICBmb3JtYXREYXRlWW91dHViZShkYXRlKSB7CiAgICAgIHJldHVybiBuZXcgRGF0ZShkYXRlKS50b0xvY2FsZURhdGVTdHJpbmcodGhpcy4kdCgiZGF0ZS5sb2NhbGUiKSwgewogICAgICAgIHllYXI6ICJudW1lcmljIiwKICAgICAgICBtb250aDogInNob3J0IiwKICAgICAgICBkYXk6ICJudW1lcmljIiwKICAgICAgfSk7CiAgICB9LAogICAgZm9ybWF0U2Vjb25kcyhzZWMpIHsKICAgICAgdmFyIGQgPSBOdW1iZXIoc2VjKTsKICAgICAgdmFyIGggPSBNYXRoLmZsb29yKGQgLyAzNjAwKTsKICAgICAgdmFyIG0gPSBNYXRoLmZsb29yKChkICUgMzYwMCkgLyA2MCk7CiAgICAgIHZhciBzID0gTWF0aC5mbG9vcigoZCAlIDM2MDApICUgNjApOwoKICAgICAgdmFyIGhvdXIgPSB0aGlzLiR0KCJnZW5lcmFsLmhvdXIiKTsKICAgICAgdmFyIGhvdXJzID0gdGhpcy4kdCgiZ2VuZXJhbC5ob3VycyIpOwogICAgICB2YXIgbWludXRlID0gdGhpcy4kdCgiZ2VuZXJhbC5taW51dGUiKTsKICAgICAgdmFyIG1pbnV0ZXMgPSB0aGlzLiR0KCJnZW5lcmFsLm1pbnV0ZXMiKTsKICAgICAgdmFyIHNlY29uZCA9IHRoaXMuJHQoImdlbmVyYWwuc2Vjb25kIik7CiAgICAgIHZhciBzZWNvbmRzID0gdGhpcy4kdCgiZ2VuZXJhbC5zZWNvbmRzIik7CgogICAgICB2YXIgaERpc3BsYXkgPSBoID4gMCA/IGggKyAoaCA9PSAxID8gYCAke2hvdXJ9IGAgOiBgICR7aG91cnN9IGApIDogIiI7CiAgICAgIHZhciBtRGlzcGxheSA9IG0gPiAwID8gbSArIChtID09IDEgPyBgICR7bWludXRlfSBgIDogYCAke21pbnV0ZXN9IGApIDogIiI7CiAgICAgIHZhciBzRGlzcGxheSA9IHMgPiAwID8gcyArIChzID09IDEgPyBgICR7c2Vjb25kfSBgIDogYCAke3NlY29uZHN9IGApIDogIiI7CiAgICAgIHJldHVybiBoRGlzcGxheSArIG1EaXNwbGF5ICsgc0Rpc3BsYXk7CiAgICB9LAoKICAgIGdldEdyb3VwV2l0aElkKGlkKSB7CiAgICAgIGxldCBpbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleCgKICAgICAgICAoZ3JvdXApID0+IGdyb3VwLmlkID09IGlkCiAgICAgICk7CiAgICAgIHJldHVybiB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpbmRleF07CiAgICB9LAogICAgZ2V0U3RyZWFtV2l0aElkKGlkKSB7CiAgICAgIGxldCBpbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5maW5kSW5kZXgoCiAgICAgICAgKHN0cmVhbSkgPT4gc3RyZWFtLmlkID09IGlkCiAgICAgICk7CiAgICAgIHJldHVybiB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdOwogICAgfSwKICAgIGRvU2F2ZSgpIHsKICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSBmYWxzZTsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgbGV0IGluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KChncm91cCkgPT4gewogICAgICAgICAgcmV0dXJuIGdyb3VwLmlkID09IHRoaXMuYWN0aXZlR3JvdXA7CiAgICAgICAgfSk7CiAgICAgICAgbGV0IHVwZGF0ZUdyb3VwcyA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzCiAgICAgICAgICAuZmlsdGVyKChncm91cCkgPT4gIWdyb3VwLmdyb3VwX2lzX3JlbW92ZWQgJiYgZ3JvdXAubW9kaWZpZWQpCiAgICAgICAgICAubWFwKChncm91cCkgPT4gewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIGlkOiBncm91cC5pZCwKICAgICAgICAgICAgICBncm91cF9uYW1lOiBncm91cC5ncm91cF9uYW1lLAogICAgICAgICAgICAgIGdyb3VwX29yZGVyOiBncm91cC5ncm91cF9vcmRlciwKICAgICAgICAgICAgICBncm91cF90eXBlOiBncm91cC5ncm91cF90eXBlLAogICAgICAgICAgICAgIGdyb3VwX3BhcmVudF9jb2RlOiBncm91cC5ncm91cF9wYXJlbnRfY29kZSwKICAgICAgICAgICAgICBncm91cF9pc19oaWRkZW46IGdyb3VwLmdyb3VwX2lzX2hpZGRlbiwKICAgICAgICAgICAgfTsKICAgICAgICAgIH0pOwogICAgICAgIGxldCBkZWxldGVHcm91cHMgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3VwcwogICAgICAgICAgLmZpbHRlcigoZ3JvdXApID0+IGdyb3VwLmdyb3VwX2lzX3JlbW92ZWQgJiYgZ3JvdXAubW9kaWZpZWQpCiAgICAgICAgICAubWFwKChncm91cCkgPT4gZ3JvdXAuaWQpCiAgICAgICAgICAuam9pbigpOwoKICAgICAgICBsZXQgdXBkYXRlU3RyZWFtczsKICAgICAgICBzd2l0Y2ggKHRoaXMuYWN0aXZlR3JvdXBUeXBlKSB7CiAgICAgICAgICAvLyBMaXZlIHN0cmVhbXMKICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgdXBkYXRlU3RyZWFtcyA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcwogICAgICAgICAgICAgIC5maWx0ZXIoCiAgICAgICAgICAgICAgICAoc3RyZWFtKSA9PiBzdHJlYW0uc3RyZWFtX2lzX3JlbW92ZWQgIT09IDEgJiYgc3RyZWFtLm1vZGlmaWVkCiAgICAgICAgICAgICAgKQogICAgICAgICAgICAgIC5tYXAoKHN0cmVhbSkgPT4gewogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgaWQ6IHN0cmVhbS5pZCwKICAgICAgICAgICAgICAgICAgc291cmNlX3N0cmVhbV91cmw6IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX3VybCwKICAgICAgICAgICAgICAgICAgc3RyZWFtX3R2Z19uYW1lOiBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lLAogICAgICAgICAgICAgICAgICBzdHJlYW1fdHZnX2lkOiBzdHJlYW0uc3RyZWFtX3R2Z19pZCwKICAgICAgICAgICAgICAgICAgc3RyZWFtX3R2Z19sb2dvOiBzdHJlYW0uc3RyZWFtX3R2Z19sb2dvLAogICAgICAgICAgICAgICAgICBzdHJlYW1fcGFyZW50X2NvZGU6IHN0cmVhbS5zdHJlYW1fcGFyZW50X2NvZGUsCiAgICAgICAgICAgICAgICAgIHN0cmVhbV9yYWRpbzogc3RyZWFtLnN0cmVhbV9yYWRpbywKICAgICAgICAgICAgICAgICAgc3RyZWFtX2lzX2hpZGRlbjogc3RyZWFtLnN0cmVhbV9pc19oaWRkZW4sCiAgICAgICAgICAgICAgICAgIHN0cmVhbV9vcmRlcjogc3RyZWFtLnN0cmVhbV9vcmRlciwKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgLy8gTW92aWVzCiAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgIHVwZGF0ZVN0cmVhbXMgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMKICAgICAgICAgICAgICAuZmlsdGVyKAogICAgICAgICAgICAgICAgKHN0cmVhbSkgPT4gc3RyZWFtLnN0cmVhbV9pc19yZW1vdmVkICE9PSAxICYmIHN0cmVhbS5tb2RpZmllZAogICAgICAgICAgICAgICkKICAgICAgICAgICAgICAubWFwKChzdHJlYW0pID0+IHsKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgIGlkOiBzdHJlYW0uaWQsCiAgICAgICAgICAgICAgICAgIHNvdXJjZV9zdHJlYW1fdXJsOiBzdHJlYW0uc291cmNlX3N0cmVhbV91cmwsCiAgICAgICAgICAgICAgICAgIG1vdmllX25hbWU6IHN0cmVhbS5tb3ZpZV9uYW1lLAogICAgICAgICAgICAgICAgICBtb3ZpZV95ZWFyOiBzdHJlYW0ubW92aWVfeWVhciwKICAgICAgICAgICAgICAgICAgdG1kYl9pZDogc3RyZWFtLnRtZGJfaWQsCiAgICAgICAgICAgICAgICAgIHN0cmVhbV90dmdfbG9nbzogc3RyZWFtLnN0cmVhbV90dmdfbG9nbywKICAgICAgICAgICAgICAgICAgc3RyZWFtX2lzX2hpZGRlbjogc3RyZWFtLnN0cmVhbV9pc19oaWRkZW4sCiAgICAgICAgICAgICAgICAgIHN0cmVhbV9vcmRlcjogc3RyZWFtLnN0cmVhbV9vcmRlciwKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgLy8gU2VyaWVzCiAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgIHVwZGF0ZVN0cmVhbXMgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMKICAgICAgICAgICAgICAuZmlsdGVyKAogICAgICAgICAgICAgICAgKHN0cmVhbSkgPT4gc3RyZWFtLnN0cmVhbV9pc19yZW1vdmVkICE9PSAxICYmIHN0cmVhbS5tb2RpZmllZAogICAgICAgICAgICAgICkKICAgICAgICAgICAgICAubWFwKChzdHJlYW0pID0+IHsKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgIGlkOiBzdHJlYW0uaWQsCiAgICAgICAgICAgICAgICAgIHNvdXJjZV9zdHJlYW1fdXJsOiBzdHJlYW0uc291cmNlX3N0cmVhbV91cmwsCiAgICAgICAgICAgICAgICAgIHNlcmllX25hbWU6IHN0cmVhbS5zZXJpZV9uYW1lLAogICAgICAgICAgICAgICAgICBzZXJpZV9zZWFzb246IHN0cmVhbS5zZXJpZV9zZWFzb24sCiAgICAgICAgICAgICAgICAgIHNlcmllX2VwaXNvZGU6IHN0cmVhbS5zZXJpZV9lcGlzb2RlLAogICAgICAgICAgICAgICAgICB0bWRiX2lkOiBzdHJlYW0udG1kYl9pZCwKICAgICAgICAgICAgICAgICAgc3RyZWFtX3R2Z19sb2dvOiBzdHJlYW0uc3RyZWFtX3R2Z19sb2dvLAogICAgICAgICAgICAgICAgICBzdHJlYW1faXNfaGlkZGVuOiBzdHJlYW0uc3RyZWFtX2lzX2hpZGRlbiwKICAgICAgICAgICAgICAgICAgc3RyZWFtX29yZGVyOiBzdHJlYW0uc3RyZWFtX29yZGVyLAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGxldCBkZWxldGVTdHJlYW1zID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zCiAgICAgICAgICAuZmlsdGVyKChzdHJlYW0pID0+IHN0cmVhbS5zdHJlYW1faXNfcmVtb3ZlZCA9PT0gMSAmJiBzdHJlYW0ubW9kaWZpZWQpCiAgICAgICAgICAubWFwKChzdHJlYW0pID0+IHN0cmVhbS5pZCkKICAgICAgICAgIC5qb2luKCk7CgogICAgICAgIGxldCByZXF1ZXN0cyA9IFtdOwogICAgICAgIGlmICh1cGRhdGVHcm91cHMubGVuZ3RoKSB7CiAgICAgICAgICByZXF1ZXN0cy5wdXNoKAogICAgICAgICAgICBodHRwU2VydmljZS5wb3N0KCJlZGl0b3IvdXBkYXRlLWdyb3VwcyIsIHsKICAgICAgICAgICAgICBwbGF5bGlzdF9pZDogdGhpcy5wbGF5bGlzdEVkaXRvci5pZCwKICAgICAgICAgICAgICBncm91cHM6IHVwZGF0ZUdyb3VwcywKICAgICAgICAgICAgfSkKICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIGlmIChkZWxldGVHcm91cHMubGVuZ3RoKSB7CiAgICAgICAgICBpbmRleCA9IDA7CiAgICAgICAgICByZXF1ZXN0cy5wdXNoKAogICAgICAgICAgICBodHRwU2VydmljZS5wb3N0KCJlZGl0b3IvZGVsZXRlLWdyb3VwcyIsIHsKICAgICAgICAgICAgICBwbGF5bGlzdF9pZDogdGhpcy5wbGF5bGlzdEVkaXRvci5pZCwKICAgICAgICAgICAgICBncm91cHM6IGRlbGV0ZUdyb3VwcywKICAgICAgICAgICAgfSkKICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIGlmICh1cGRhdGVTdHJlYW1zLmxlbmd0aCkgewogICAgICAgICAgcmVxdWVzdHMucHVzaCgKICAgICAgICAgICAgaHR0cFNlcnZpY2UucG9zdChgZWRpdG9yL3VwZGF0ZS1zdHJlYW1zLyR7dGhpcy5hY3RpdmVHcm91cFR5cGV9YCwgewogICAgICAgICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgICAgIHN0cmVhbXM6IHVwZGF0ZVN0cmVhbXMsCiAgICAgICAgICAgIH0pCiAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICBpZiAoZGVsZXRlU3RyZWFtcy5sZW5ndGgpIHsKICAgICAgICAgIHJlcXVlc3RzLnB1c2goCiAgICAgICAgICAgIGh0dHBTZXJ2aWNlLnBvc3QoYGVkaXRvci9kZWxldGUtc3RyZWFtcy8ke3RoaXMuYWN0aXZlR3JvdXBUeXBlfWAsIHsKICAgICAgICAgICAgICBwbGF5bGlzdF9pZDogdGhpcy5wbGF5bGlzdEVkaXRvci5pZCwKICAgICAgICAgICAgICBzdHJlYW1zOiBkZWxldGVTdHJlYW1zLAogICAgICAgICAgICB9KQogICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgUHJvbWlzZS5hbGwocmVxdWVzdHMpLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgdGhpcy5sb2FkUGxheWxpc3QodGhpcy5wbGF5bGlzdEVkaXRvci5pZCwgaW5kZXgpOwogICAgICAgICAgcmVzb2x2ZShyZXMpOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0sCiAgICBkb0NhbmNlbCgpIHsKICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBQcm9taXNlLmFsbChbdGhpcy5yZXN0b3JlR3JvdXBzKCksIHRoaXMucmVzdG9yZVN0cmVhbXMoKV0pLnRoZW4oKCkgPT4gewogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IGZhbHNlOwogICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0pOwogICAgfSwKICAgIGRvVGFiQ2hhbmdlKHRhYikgewogICAgICB0aGlzLmFjdGl2ZVRhYiA9IHRhYjsKICAgIH0sCiAgICB1cGRhdGVHcm91cE9yZGVyKHNvdXJjZSkgewogICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICBsZXQgZ3JvdXBzID0gWy4uLnNvdXJjZV07CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBncm91cHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGdyb3Vwc1tpXS5zb3VyY2VfZ3JvdXBfb3JkZXIgPSBpICsgMTsKICAgICAgICAgIGdyb3Vwc1tpXS5ncm91cF9vcmRlciA9IGkgKyAxOwogICAgICAgIH0KICAgICAgICByZXNvbHZlKGdyb3Vwcyk7CiAgICAgIH0pOwogICAgfSwKICAgIHVwZGF0ZVN0cmVhbU9yZGVyKHNvdXJjZSkgewogICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICBsZXQgc3RyZWFtcyA9IFsuLi5zb3VyY2VdOwogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc3RyZWFtcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgc3RyZWFtc1tpXS5zb3VyY2Vfc3RyZWFtX29yZGVyID0gaSArIDE7CiAgICAgICAgICBzdHJlYW1zW2ldLnN0cmVhbV9vcmRlciA9IGkgKyAxOwogICAgICAgIH0KICAgICAgICByZXNvbHZlKHN0cmVhbXMpOwogICAgICB9KTsKICAgIH0sCiAgICByZXN0b3JlR3JvdXBPcmRlcigpIHsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuc29ydCgoYSwgYikgPT4KICAgICAgICAgIGEuc291cmNlX2dyb3VwX29yZGVyID4gYi5zb3VyY2VfZ3JvdXBfb3JkZXIKICAgICAgICAgICAgPyAxCiAgICAgICAgICAgIDogYi5zb3VyY2VfZ3JvdXBfb3JkZXIgPiBhLnNvdXJjZV9ncm91cF9vcmRlcgogICAgICAgICAgICA/IC0xCiAgICAgICAgICAgIDogMAogICAgICAgICk7CiAgICAgICAgcmVzb2x2ZSgpOwogICAgICB9KTsKICAgIH0sCiAgICByZXN0b3JlU3RyZWFtT3JkZXIoKSB7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5zb3J0KChhLCBiKSA9PgogICAgICAgICAgYS5zb3VyY2Vfc3RyZWFtX29yZGVyID4gYi5zb3VyY2Vfc3RyZWFtX29yZGVyCiAgICAgICAgICAgID8gMQogICAgICAgICAgICA6IGIuc291cmNlX3N0cmVhbV9vcmRlciA+IGEuc291cmNlX3N0cmVhbV9vcmRlcgogICAgICAgICAgICA/IC0xCiAgICAgICAgICAgIDogMAogICAgICAgICk7CiAgICAgICAgcmVzb2x2ZSgpOwogICAgICB9KTsKICAgIH0sCiAgICByZXN0b3JlR3JvdXBzKCkgewogICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICB0aGlzLnJlc3RvcmVHcm91cE9yZGVyKCkudGhlbigoKSA9PiB7CiAgICAgICAgICBsZXQgZ3JvdXA7CiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGdyb3VwID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV07CiAgICAgICAgICAgIGdyb3VwLm1vZGlmaWVkID0gZmFsc2U7CiAgICAgICAgICAgIGdyb3VwLmdyb3VwX2lzX3JlbW92ZWQgPSAwOwogICAgICAgICAgICBncm91cC5ncm91cF90eXBlID0gZ3JvdXAuc291cmNlX2dyb3VwX3R5cGU7CiAgICAgICAgICAgIGdyb3VwLmdyb3VwX25hbWUgPSBncm91cC5zb3VyY2VfZ3JvdXBfbmFtZTsKICAgICAgICAgICAgZ3JvdXAucGFyZW50X2NvZGUgPSBncm91cC5zb3VyY2VfZ3JvdXBfcGFyZW50X2NvZGU7CiAgICAgICAgICAgIGdyb3VwLmdyb3VwX2lzX2hpZGRlbiA9IGdyb3VwLnNvdXJjZV9ncm91cF9pc19oaWRkZW47CiAgICAgICAgICB9CiAgICAgICAgICByZXNvbHZlKCk7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSwKICAgIHJlc3RvcmVTdHJlYW1zKCkgewogICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICB0aGlzLnJlc3RvcmVTdHJlYW1PcmRlcigpLnRoZW4oKCkgPT4gewogICAgICAgICAgbGV0IHN0cmVhbTsKICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHN0cmVhbSA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXTsKICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gZmFsc2U7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1faXNfcmVtb3ZlZCA9IDA7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX25hbWUgPSBzdHJlYW0uc291cmNlX3N0cmVhbV90dmdfbmFtZTsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfaWQgPSBzdHJlYW0uc291cmNlX3N0cmVhbV90dmdfaWQ7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX2xvZ28gPSBzdHJlYW0uc291cmNlX3N0cmVhbV90dmdfbG9nbzsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfY2hubyA9IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX3R2Z19jaG5vOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19zaGlmdCA9IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX3R2Z19zaGlmdDsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV9wYXJlbnRfY29kZSA9IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX3BhcmVudF9jb2RlOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX2F1ZGlvX3RyYWNrID0gc3RyZWFtLnNvdXJjZV9zdHJlYW1fYXVkaW9fdHJhY2s7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fYXNwZWN0X3JhdGlvID0gc3RyZWFtLnNvdXJjZV9zdHJlYW1fYXNwZWN0X3JhdGlvOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3JhZGlvID0gc3RyZWFtLnNvdXJjZV9zdHJlYW1fcmFkaW87CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fb3JkZXIgPSBzdHJlYW0uc291cmNlX3N0cmVhbV9vcmRlcjsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV9pc19oaWRkZW4gPSBzdHJlYW0uc291cmNlX3N0cmVhbV9pc19oaWRkZW47CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICBzdHJlYW0ubW92aWVfbmFtZSAhPT0gdW5kZWZpbmVkICYmCiAgICAgICAgICAgICAgc3RyZWFtLm1vdmllX3llYXIgIT09IHVuZGVmaW5lZAogICAgICAgICAgICApIHsKICAgICAgICAgICAgICBzdHJlYW0ubW92aWVfbmFtZSA9IHN0cmVhbS5zb3VyY2VfbW92aWVfbmFtZTsKICAgICAgICAgICAgICBzdHJlYW0ubW92aWVfeWVhciA9IHN0cmVhbS5zb3VyY2VfbW92aWVfeWVhcjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgc3RyZWFtLnNlcmllX25hbWUgIT09IHVuZGVmaW5lZCAmJgogICAgICAgICAgICAgIHN0cmVhbS5zZXJpZV9zZWFzb24gIT09IHVuZGVmaW5lZCAmJgogICAgICAgICAgICAgIHN0cmVhbS5zZXJpZV9lcGlzb2RlICE9PSB1bmRlZmluZWQKICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgc3RyZWFtLnNlcmllX25hbWUgPSBzdHJlYW0uc291cmNlX3NlcmllX25hbWU7CiAgICAgICAgICAgICAgc3RyZWFtLnNlcmllX3NlYXNvbiA9IHN0cmVhbS5zb3VyY2Vfc2VyaWVfc2Vhc29uOwogICAgICAgICAgICAgIHN0cmVhbS5zZXJpZV9lcGlzb2RlID0gc3RyZWFtLnNvdXJjZV9zZXJpZV9lcGlzb2RlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICByZXNvbHZlKCk7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSwKICAgIHRvZ2dsZUdyb3VwVmlzaWJpbGl0eSgpIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3Vwcy5pbmNsdWRlcyh0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5pZCkpIHsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmdyb3VwX2lzX2hpZGRlbiA9CiAgICAgICAgICAgICF0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5ncm91cF9pc19oaWRkZW47CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICB9LAogICAgdG9nZ2xlU3RyZWFtVmlzaWJpbGl0eSgpIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAodGhpcy5hY3RpdmVTdHJlYW1zLmluY2x1ZGVzKHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5pZCkpIHsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5zdHJlYW1faXNfaGlkZGVuID0KICAgICAgICAgICAgIXRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5zdHJlYW1faXNfaGlkZGVuOwogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgIH0sCiAgICB0b2dnbGVTdHJlYW1SYWRpbygpIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAodGhpcy5hY3RpdmVTdHJlYW1zLmluY2x1ZGVzKHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5pZCkpIHsKICAgICAgICAgIGlmICh0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uc3RyZWFtX3JhZGlvID09IDApIHsKICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLnN0cmVhbV9yYWRpbyA9IDE7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uc3RyZWFtX3JhZGlvID0gMDsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICB9LAogICAgZGVsZXRlU2VsZWN0ZWRHcm91cHMoKSB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cHMuaW5jbHVkZXModGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uaWQpKSB7CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5ncm91cF9pc19yZW1vdmVkID0gMTsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgIH0sCiAgICBkZWxldGVTZWxlY3RlZFN0cmVhbXMoKSB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHRoaXMuYWN0aXZlU3RyZWFtcy5pbmNsdWRlcyh0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uaWQpKSB7CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uc3RyZWFtX2lzX3JlbW92ZWQgPSAxOwogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgIH0sCiAgICBsb2FkUGxheWxpc3QodmFsLCBncm91cF9pbmRleCA9IHVuZGVmaW5lZCkgewogICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGlmICh0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQpIHsKICAgICAgICB0aGlzLmRvU2F2ZSgpOwogICAgICB9CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuaWQgPSB2YWw7CiAgICAgIGh0dHBTZXJ2aWNlCiAgICAgICAgLmdldChgZWRpdG9yL2dyb3Vwcy8ke3ZhbH1gKQogICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgIGlmIChyZXMuc3RhdHVzID09PSB0cnVlKSB7CiAgICAgICAgICAgIHRoaXMudXBkYXRlR3JvdXBPcmRlcihyZXMuZGF0YSkudGhlbigoZ3JvdXBzKSA9PiB7CiAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMgPSBncm91cHMubWFwKChncm91cCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgZ3JwID0gT2JqZWN0LmFzc2lnbih7fSwgZ3JvdXApOwogICAgICAgICAgICAgICAgZ3JwLnNvdXJjZV9ncm91cF9wYXJlbnRfY29kZSA9IGdyb3VwLmdyb3VwX3BhcmVudF9jb2RlOwogICAgICAgICAgICAgICAgZ3JwLnNvdXJjZV9ncm91cF9pc19oaWRkZW4gPSBncm91cC5ncm91cF9pc19oaWRkZW47CiAgICAgICAgICAgICAgICBncnAuc291cmNlX2dyb3VwX25hbWUgPSBncm91cC5ncm91cF9uYW1lOwogICAgICAgICAgICAgICAgZ3JwLnNvdXJjZV9ncm91cF90eXBlID0gZ3JvdXAuZ3JvdXBfdHlwZTsKICAgICAgICAgICAgICAgIGdycC5ncm91cF9pc19yZW1vdmVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICBncnAubW9kaWZpZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHJldHVybiBncnA7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgaWYgKGdyb3Vwcy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIGlmIChncm91cF9pbmRleCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlR3JvdXAgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1swXS5pZDsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlR3JvdXAgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tncm91cF9pbmRleF0uaWQ7CiAgICAgICAgICAgICAgICAgIHRoaXMubG9hZFN0cmVhbXMoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0pOwogICAgfSwKICAgIHRvZ2dsZUdyb3VwU2VsZWN0aW9uKGl0ZW0pIHsKICAgICAgbGV0IGlkeCA9IHRoaXMuYWN0aXZlR3JvdXBzLmluZGV4T2YoaXRlbSk7CiAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgdGhpcy5hY3RpdmVHcm91cHMuc3BsaWNlKGlkeCwgMSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5hY3RpdmVHcm91cHMucHVzaChpdGVtKTsKICAgICAgfQogICAgfSwKICAgIHRvZ2dsZVN0cmVhbVNlbGVjdGlvbihpdGVtKSB7CiAgICAgIGxldCBpZHggPSB0aGlzLmFjdGl2ZVN0cmVhbXMuaW5kZXhPZihpdGVtKTsKICAgICAgaWYgKGlkeCAhPT0gLTEpIHsKICAgICAgICB0aGlzLmFjdGl2ZVN0cmVhbXMuc3BsaWNlKGlkeCwgMSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5hY3RpdmVTdHJlYW1zLnB1c2goaXRlbSk7CiAgICAgIH0KICAgIH0sCiAgICB0b2dnbGVSYWRpb2Jyb3dzZXJTZWxlY3Rpb24oaXRlbSkgewogICAgICBsZXQgaWR4ID0gdGhpcy5yYWRpb0Jyb3dzZXIuYWN0aXZlLmluZGV4T2YoaXRlbSk7CiAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuYWN0aXZlLnNwbGljZShpZHgsIDEpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZS5wdXNoKGl0ZW0pOwogICAgICB9CiAgICB9LAogICAgdG9nZ2xlSW1wb3J0TTNVU2VsZWN0aW9uKGl0ZW0pIHsKICAgICAgbGV0IGlkeCA9IHRoaXMuaW1wb3J0TTNVLmltcG9ydEdyb3Vwcy5pbmRleE9mKGl0ZW0pOwogICAgICBpZiAoaWR4ICE9PSAtMSkgewogICAgICAgIHRoaXMuaW1wb3J0TTNVLmltcG9ydEdyb3Vwcy5zcGxpY2UoaWR4LCAxKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmltcG9ydE0zVS5pbXBvcnRHcm91cHMucHVzaChpdGVtKTsKICAgICAgfQogICAgfSwKICAgIGluZGV4T2ZHcm91cChncm91cCkgewogICAgICByZXR1cm4gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMubWFwKChnKSA9PiBnLmlkKS5pbmRleE9mKGdyb3VwKTsKICAgIH0sCiAgICBzZWxlY3RHcm91cFJhbmdlU2VsZWN0aW9uKGl0ZW0pIHsKICAgICAgY29uc3QgbGFzdEluZGV4ID0gdGhpcy5pbmRleE9mR3JvdXAodGhpcy5sYXN0U2VsZWN0ZWRHcm91cCk7CiAgICAgIGNvbnN0IGl0ZW1JbmRleCA9IHRoaXMuaW5kZXhPZkdyb3VwKGl0ZW0pOwogICAgICBjb25zdCBkaXIgPSBpdGVtSW5kZXggPiBsYXN0SW5kZXggPyAxIDogLTE7CiAgICAgIGZvciAobGV0IGkgPSBsYXN0SW5kZXg7IGkgIT0gaXRlbUluZGV4ICsgZGlyOyBpICs9IGRpcikgewogICAgICAgIGlmICghdGhpcy5hY3RpdmVHcm91cHMuaW5jbHVkZXModGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uaWQpKSB7CiAgICAgICAgICB0aGlzLmFjdGl2ZUdyb3Vwcy5wdXNoKHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmlkKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBpbmRleE9mU3RyZWFtKHN0cmVhbSkgewogICAgICByZXR1cm4gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLm1hcCgoZykgPT4gZy5pZCkuaW5kZXhPZihzdHJlYW0pOwogICAgfSwKICAgIHNlbGVjdFN0cmVhbVJhbmdlU2VsZWN0aW9uKGl0ZW0pIHsKICAgICAgY29uc3QgbGFzdEluZGV4ID0gdGhpcy5pbmRleE9mU3RyZWFtKHRoaXMubGFzdFNlbGVjdGVkU3RyZWFtKTsKICAgICAgY29uc3QgaXRlbUluZGV4ID0gdGhpcy5pbmRleE9mU3RyZWFtKGl0ZW0pOwogICAgICBjb25zdCBkaXIgPSBpdGVtSW5kZXggPiBsYXN0SW5kZXggPyAxIDogLTE7CiAgICAgIGZvciAobGV0IGkgPSBsYXN0SW5kZXg7IGkgIT0gaXRlbUluZGV4ICsgZGlyOyBpICs9IGRpcikgewogICAgICAgIGlmICghdGhpcy5hY3RpdmVTdHJlYW1zLmluY2x1ZGVzKHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5pZCkpIHsKICAgICAgICAgIHRoaXMuYWN0aXZlU3RyZWFtcy5wdXNoKHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5pZCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgc2VsZWN0UmFkaW9icm93c2VyUmFuZ2VTZWxlY3Rpb24oaW5kZXgpIHsKICAgICAgY29uc3QgbGFzdEluZGV4ID0KICAgICAgICB0aGlzLnJhZGlvQnJvd3Nlci5hY3RpdmVbdGhpcy5yYWRpb0Jyb3dzZXIuYWN0aXZlLmxlbmd0aCAtIDFdOwogICAgICBjb25zdCBkaXIgPSBpbmRleCA+IGxhc3RJbmRleCA/IDEgOiAtMTsKICAgICAgZm9yIChsZXQgaSA9IGxhc3RJbmRleDsgaSAhPSBpbmRleCArIGRpcjsgaSArPSBkaXIpIHsKICAgICAgICBpZiAoIXRoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZS5pbmNsdWRlcyhpKSkgewogICAgICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuYWN0aXZlLnB1c2goaSk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgc2VsZWN0SW1wb3J0TTNVUmFuZ2VTZWxlY3Rpb24oaW5kZXgpIHsKICAgICAgY29uc3QgbGFzdEluZGV4ID0KICAgICAgICB0aGlzLmltcG9ydE0zVS5pbXBvcnRHcm91cHNbdGhpcy5pbXBvcnRNM1UuaW1wb3J0R3JvdXBzLmxlbmd0aCAtIDFdOwogICAgICBjb25zdCBkaXIgPSBpbmRleCA+IGxhc3RJbmRleCA/IDEgOiAtMTsKICAgICAgZm9yIChsZXQgaSA9IGxhc3RJbmRleDsgaSAhPSBpbmRleCArIGRpcjsgaSArPSBkaXIpIHsKICAgICAgICBpZiAoIXRoaXMuaW1wb3J0TTNVLmltcG9ydEdyb3Vwcy5pbmNsdWRlcyhpKSkgewogICAgICAgICAgdGhpcy5pbXBvcnRNM1UuaW1wb3J0R3JvdXBzLnB1c2goaSk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgc2VsZWN0R3JvdXBTZWxlY3Rpb24oaXRlbSkgewogICAgICB0aGlzLmFjdGl2ZUdyb3Vwcy5sZW5ndGggPSAwOwogICAgICB0aGlzLmFjdGl2ZUdyb3Vwcy5wdXNoKGl0ZW0pOwogICAgfSwKICAgIHNlbGVjdFN0cmVhbVNlbGVjdGlvbihpdGVtKSB7CiAgICAgIHRoaXMuYWN0aXZlU3RyZWFtcy5sZW5ndGggPSAwOwogICAgICB0aGlzLmFjdGl2ZVN0cmVhbXMucHVzaChpdGVtKTsKICAgIH0sCiAgICBzZWxlY3RSYWRpb2Jyb3dzZXJTZWxlY3Rpb24oaXRlbSkgewogICAgICB0aGlzLnJhZGlvQnJvd3Nlci5hY3RpdmUubGVuZ3RoID0gMDsKICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuYWN0aXZlLnB1c2goaXRlbSk7CiAgICB9LAogICAgc2VsZWN0SW1wb3J0TTNVU2VsZWN0aW9uKGl0ZW0pIHsKICAgICAgdGhpcy5pbXBvcnRNM1UuaW1wb3J0R3JvdXBzLmxlbmd0aCA9IDA7CiAgICAgIHRoaXMuaW1wb3J0TTNVLmltcG9ydEdyb3Vwcy5wdXNoKGl0ZW0pOwogICAgfSwKICAgIGZpbmRBbmRSZXBsYWNlTW9kYWwoc2hvdywgdHlwZSA9IDEpIHsKICAgICAgdGhpcy5maW5kUmVwbGFjZS50eXBlID0gdHlwZTsKICAgICAgdGhpcy5maW5kUmVwbGFjZS5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgZmluZEFuZFJlcGxhY2UoKSB7CiAgICAgIGxldCBvcHRpb25zID0gIiI7CiAgICAgIGlmICh0aGlzLmZpbmRSZXBsYWNlLnJlcGxhY2VBbGwpIHsKICAgICAgICBvcHRpb25zICs9ICJnIjsKICAgICAgfQogICAgICBpZiAodGhpcy5maW5kUmVwbGFjZS5pZ25vcmVDYXNlKSB7CiAgICAgICAgb3B0aW9ucyArPSAiaSI7CiAgICAgIH0KICAgICAgbGV0IHJlID0gbmV3IFJlZ0V4cCh0aGlzLmZpbmRSZXBsYWNlLmZyb20ucmVwbGFjZSgifCIsICJcXHwiKSwgb3B0aW9ucyk7CiAgICAgIHN3aXRjaCAocGFyc2VJbnQodGhpcy5maW5kUmVwbGFjZS50eXBlKSkgewogICAgICAgIC8vIEdyb3VwCiAgICAgICAgY2FzZSAxOgogICAgICAgICAgaWYgKHBhcnNlSW50KHRoaXMuZmluZFJlcGxhY2Uuc2VsZWN0ZWRPbmx5KSA9PT0gMSkgewogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgdGhpcy5hY3RpdmVHcm91cHMuaW5jbHVkZXModGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uaWQpCiAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5ncm91cF9uYW1lID0KICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uZ3JvdXBfbmFtZS5yZXBsYWNlKAogICAgICAgICAgICAgICAgICAgIHJlLAogICAgICAgICAgICAgICAgICAgIHRoaXMuZmluZFJlcGxhY2UudG8KICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuZmlsdGVyZWRHcm91cHMubWFwKChncm91cCkgPT4gewogICAgICAgICAgICAgIGdyb3VwLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICBncm91cC5ncm91cF9uYW1lID0gZ3JvdXAuZ3JvdXBfbmFtZS5yZXBsYWNlKAogICAgICAgICAgICAgICAgcmUsCiAgICAgICAgICAgICAgICB0aGlzLmZpbmRSZXBsYWNlLnRvCiAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKCiAgICAgICAgLy8gU3RyZWFtcwogICAgICAgIGNhc2UgMjoKICAgICAgICAgIGlmIChwYXJzZUludCh0aGlzLmZpbmRSZXBsYWNlLnNlbGVjdGVkT25seSkgPT09IDEpIHsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZVN0cmVhbXMuaW5jbHVkZXModGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLmlkKQogICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAxKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5zdHJlYW1fdHZnX25hbWUgPQogICAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5zdHJlYW1fdHZnX25hbWUucmVwbGFjZSgKICAgICAgICAgICAgICAgICAgICAgIHJlLAogICAgICAgICAgICAgICAgICAgICAgdGhpcy5maW5kUmVwbGFjZS50bwogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDIpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLm1vdmllX25hbWUgPQogICAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5tb3ZpZV9uYW1lLnJlcGxhY2UoCiAgICAgICAgICAgICAgICAgICAgICByZSwKICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmluZFJlcGxhY2UudG8KICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAzKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5zZXJpZV9uYW1lID0KICAgICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uc2VyaWVfbmFtZS5yZXBsYWNlKAogICAgICAgICAgICAgICAgICAgICAgcmUsCiAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZpbmRSZXBsYWNlLnRvCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuZmlsdGVyZWRTdHJlYW1zLm1hcCgoc3RyZWFtKSA9PiB7CiAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAxKSB7CiAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfbmFtZSA9IHN0cmVhbS5zdHJlYW1fdHZnX25hbWUucmVwbGFjZSgKICAgICAgICAgICAgICAgICAgcmUsCiAgICAgICAgICAgICAgICAgIHRoaXMuZmluZFJlcGxhY2UudG8KICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMikgewogICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHN0cmVhbS5tb3ZpZV9uYW1lID0gc3RyZWFtLm1vdmllX25hbWUucmVwbGFjZSgKICAgICAgICAgICAgICAgICAgcmUsCiAgICAgICAgICAgICAgICAgIHRoaXMuZmluZFJlcGxhY2UudG8KICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMykgewogICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHN0cmVhbS5zZXJpZV9uYW1lID0gc3RyZWFtLnNlcmllX25hbWUucmVwbGFjZSgKICAgICAgICAgICAgICAgICAgcmUsCiAgICAgICAgICAgICAgICAgIHRoaXMuZmluZFJlcGxhY2UudG8KICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICAgIHRoaXMuZmluZFJlcGxhY2UubW9kYWwgPSBmYWxzZTsKICAgIH0sCiAgICBwcmVmaXhTdWZmaXhNb2RhbChzaG93LCB0eXBlID0gMSkgewogICAgICB0aGlzLnByZWZpeFN1ZmZpeC50eXBlID0gdHlwZTsKICAgICAgdGhpcy5wcmVmaXhTdWZmaXgubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGFkZFByZWZpeFN1ZmZpeCgpIHsKICAgICAgbGV0IHByZWZpeCA9IHRoaXMucHJlZml4U3VmZml4LnByZWZpeDsKICAgICAgbGV0IHN1ZmZpeCA9IHRoaXMucHJlZml4U3VmZml4LnN1ZmZpeDsKICAgICAgc3dpdGNoIChwYXJzZUludCh0aGlzLnByZWZpeFN1ZmZpeC50eXBlKSkgewogICAgICAgIC8vIEdyb3VwCiAgICAgICAgY2FzZSAxOgogICAgICAgICAgaWYgKHBhcnNlSW50KHRoaXMucHJlZml4U3VmZml4LnNlbGVjdGVkT25seSkgPT09IDEpIHsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlR3JvdXBzLmluY2x1ZGVzKHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmlkKQogICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uZ3JvdXBfbmFtZSA9CiAgICAgICAgICAgICAgICAgIHByZWZpeCArIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmdyb3VwX25hbWUgKyBzdWZmaXg7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLmZpbHRlcmVkR3JvdXBzLm1hcCgoZ3JvdXApID0+IHsKICAgICAgICAgICAgICBncm91cC5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgZ3JvdXAuZ3JvdXBfbmFtZSA9IHByZWZpeCArIGdyb3VwLmdyb3VwX25hbWUgKyBzdWZmaXg7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CgogICAgICAgIC8vIFN0cmVhbQogICAgICAgIGNhc2UgMjoKICAgICAgICAgIGlmIChwYXJzZUludCh0aGlzLnByZWZpeFN1ZmZpeC5zZWxlY3RlZE9ubHkpID09PSAxKSB7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgdGhpcy5hY3RpdmVTdHJlYW1zLmluY2x1ZGVzKHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5pZCkKICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMSkgewogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uc3RyZWFtX3R2Z19uYW1lID0KICAgICAgICAgICAgICAgICAgICBwcmVmaXggKwogICAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5zdHJlYW1fdHZnX25hbWUgKwogICAgICAgICAgICAgICAgICAgIHN1ZmZpeDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMikgewogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0ubW92aWVfbmFtZSA9CiAgICAgICAgICAgICAgICAgICAgcHJlZml4ICsgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLm1vdmllX25hbWUgKyBzdWZmaXg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDMpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLnNlcmllX25hbWUgPQogICAgICAgICAgICAgICAgICAgIHByZWZpeCArIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5zZXJpZV9uYW1lICsgc3VmZml4OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAxKSB7CiAgICAgICAgICAgICAgdGhpcy5maWx0ZXJlZFN0cmVhbXMubWFwKChzdHJlYW0pID0+IHsKICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lID0KICAgICAgICAgICAgICAgICAgcHJlZml4ICsgc3RyZWFtLnN0cmVhbV90dmdfbmFtZSArIHN1ZmZpeDsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDIpIHsKICAgICAgICAgICAgICB0aGlzLmZpbHRlcmVkU3RyZWFtcy5tYXAoKHN0cmVhbSkgPT4gewogICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHN0cmVhbS5tb3ZpZV9uYW1lID0gcHJlZml4ICsgc3RyZWFtLm1vdmllX25hbWUgKyBzdWZmaXg7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAzKSB7CiAgICAgICAgICAgICAgdGhpcy5maWx0ZXJlZFN0cmVhbXMubWFwKChzdHJlYW0pID0+IHsKICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICBzdHJlYW0uc2VyaWVfbmFtZSA9IHByZWZpeCArIHN0cmVhbS5zZXJpZV9uYW1lICsgc3VmZml4OwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgICB0aGlzLnByZWZpeFN1ZmZpeC5tb2RhbCA9IGZhbHNlOwogICAgfSwKICAgIGNvbnZlcnRDYXNlTW9kYWwoc2hvdywgdHlwZSkgewogICAgICB0aGlzLmNvbnZlcnRDYXNlLnR5cGUgPSB0eXBlOwogICAgICB0aGlzLmNvbnZlcnRDYXNlLm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBjaGFuZ2VDYXNlKCkgewogICAgICBsZXQgbWV0aG9kID0gdGhpcy5jb252ZXJ0Q2FzZS5tZXRob2Q7CiAgICAgIGxldCBncm91cHM7CiAgICAgIGxldCBzdHJlYW1zOwogICAgICBpZiAocGFyc2VJbnQodGhpcy5jb252ZXJ0Q2FzZS5zZWxlY3RlZE9ubHkpID09PSAxKSB7CiAgICAgICAgZ3JvdXBzID0gdGhpcy5maWx0ZXJlZEdyb3Vwcy5maWx0ZXIoKGdyb3VwKSA9PiB7CiAgICAgICAgICByZXR1cm4gdGhpcy5hY3RpdmVHcm91cHMuaW5jbHVkZXMoZ3JvdXAuaWQpOwogICAgICAgIH0pOwogICAgICAgIHN0cmVhbXMgPSB0aGlzLmZpbHRlcmVkU3RyZWFtcy5maWx0ZXIoKHN0cmVhbSkgPT4gewogICAgICAgICAgcmV0dXJuIHRoaXMuYWN0aXZlU3RyZWFtcy5pbmNsdWRlcyhzdHJlYW0uaWQpOwogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIGdyb3VwcyA9IHRoaXMuZmlsdGVyZWRHcm91cHM7CiAgICAgICAgc3RyZWFtcyA9IHRoaXMuZmlsdGVyZWRTdHJlYW1zOwogICAgICB9CiAgICAgIHN3aXRjaCAocGFyc2VJbnQodGhpcy5jb252ZXJ0Q2FzZS50eXBlKSkgewogICAgICAgIC8vIENhdGVnb3JpZXMKICAgICAgICBjYXNlIDE6CiAgICAgICAgICBncm91cHMubWFwKChncm91cCkgPT4gewogICAgICAgICAgICBzd2l0Y2ggKHBhcnNlSW50KG1ldGhvZCkpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBncm91cC5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICBncm91cC5ncm91cF9uYW1lID0gZ3JvdXAuZ3JvdXBfbmFtZS50aXRsZUNhc2UoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgIGdyb3VwLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGdyb3VwLmdyb3VwX25hbWUgPSBncm91cC5ncm91cF9uYW1lLnRvVXBwZXJDYXNlKCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICBncm91cC5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICBncm91cC5ncm91cF9uYW1lID0gZ3JvdXAuZ3JvdXBfbmFtZS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIC8vIFN0cmVhbXMKICAgICAgICBjYXNlIDI6CiAgICAgICAgICBzdHJlYW1zLm1hcCgoc3RyZWFtKSA9PiB7CiAgICAgICAgICAgIHN3aXRjaCAocGFyc2VJbnQobWV0aG9kKSkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMSkgewogICAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lID0gc3RyZWFtLnN0cmVhbV90dmdfbmFtZS50aXRsZUNhc2UoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMikgewogICAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICBzdHJlYW0ubW92aWVfbmFtZSA9IHN0cmVhbS5tb3ZpZV9uYW1lLnRpdGxlQ2FzZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAzKSB7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5zZXJpZV9uYW1lID0gc3RyZWFtLnNlcmllX25hbWUudGl0bGVDYXNlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDEpIHsKICAgICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfbmFtZSA9IHN0cmVhbS5zdHJlYW1fdHZnX25hbWUudG9VcHBlckNhc2UoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMikgewogICAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICBzdHJlYW0ubW92aWVfbmFtZSA9IHN0cmVhbS5tb3ZpZV9uYW1lLnRvVXBwZXJDYXNlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDMpIHsKICAgICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgc3RyZWFtLnNlcmllX25hbWUgPSBzdHJlYW0uc2VyaWVfbmFtZS50b1VwcGVyQ2FzZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAxKSB7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX25hbWUgPSBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDIpIHsKICAgICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgc3RyZWFtLm1vdmllX25hbWUgPSBzdHJlYW0ubW92aWVfbmFtZS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAzKSB7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5zZXJpZV9uYW1lID0gc3RyZWFtLnNlcmllX25hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICAgIHRoaXMuY29udmVydENhc2UubW9kYWwgPSBmYWxzZTsKICAgIH0sCiAgICBlZGl0R3JvdXBNb2RhbChzaG93KSB7CiAgICAgIGxldCBpbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleCgKICAgICAgICAoZ3JvdXApID0+IGdyb3VwLmlkID09PSB0aGlzLmFjdGl2ZUdyb3Vwc1swXQogICAgICApOwogICAgICBsZXQgZ3JvdXAgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpbmRleF07CiAgICAgIGlmIChncm91cCkgewogICAgICAgIHRoaXMuZ3JvdXBFZGl0b3IuaWQgPSB0aGlzLmFjdGl2ZUdyb3Vwc1swXTsKICAgICAgICB0aGlzLmdyb3VwRWRpdG9yLmdyb3VwX3R5cGUgPSBncm91cC5ncm91cF90eXBlOwogICAgICAgIHRoaXMuZ3JvdXBFZGl0b3IuZ3JvdXBfbmFtZSA9IGdyb3VwLmdyb3VwX25hbWU7CiAgICAgICAgdGhpcy5ncm91cEVkaXRvci5ncm91cF9pc19oaWRkZW4gPSBncm91cC5ncm91cF9pc19oaWRkZW47CiAgICAgICAgdGhpcy5ncm91cEVkaXRvci5ncm91cF9wYXJlbnRfY29kZSA9IGdyb3VwLmdyb3VwX3BhcmVudF9jb2RlOwogICAgICAgIHRoaXMuZ3JvdXBFZGl0b3IubW9kYWwgPSBzaG93OwogICAgICB9CiAgICB9LAogICAgZWRpdFN0cmVhbU1vZGFsKHNob3cpIHsKICAgICAgbGV0IGluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmZpbmRJbmRleCgKICAgICAgICAoc3RyZWFtKSA9PiBzdHJlYW0uaWQgPT09IHRoaXMuYWN0aXZlU3RyZWFtc1swXQogICAgICApOwogICAgICBsZXQgc3RyZWFtID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XTsKICAgICAgaWYgKHN0cmVhbSkgewogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLmlkID0gdGhpcy5hY3RpdmVTdHJlYW1zWzBdOwogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV90dmdfbmFtZSA9IHN0cmVhbS5zdHJlYW1fdHZnX25hbWU7CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX3R2Z19pZCA9IHN0cmVhbS5zdHJlYW1fdHZnX2lkOwogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV90dmdfbG9nbyA9IHN0cmVhbS5zdHJlYW1fdHZnX2xvZ287CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX3BhcmVudF9jb2RlID0gc3RyZWFtLnN0cmVhbV9wYXJlbnRfY29kZTsKICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1fcmFkaW8gPSBzdHJlYW0uc3RyZWFtX3JhZGlvOwogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV9pc19oaWRkZW4gPSBzdHJlYW0uc3RyZWFtX2lzX2hpZGRlbjsKICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zb3VyY2Vfc3RyZWFtX3VybCA9IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX3VybDsKICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1faXNfY3VzdG9tID0gc3RyZWFtLnN0cmVhbV9pc19jdXN0b207CiAgICAgICAgaWYgKAogICAgICAgICAgc3RyZWFtLm1vdmllX25hbWUgIT09IHVuZGVmaW5lZCAmJgogICAgICAgICAgc3RyZWFtLm1vdmllX3llYXIgIT09IHVuZGVmaW5lZCAmJgogICAgICAgICAgc3RyZWFtLnRtZGJfaWQgIT09IHVuZGVmaW5lZAogICAgICAgICkgewogICAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3IubW92aWVfbmFtZSA9IHN0cmVhbS5tb3ZpZV9uYW1lOwogICAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3IubW92aWVfeWVhciA9IHN0cmVhbS5tb3ZpZV95ZWFyOwogICAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3IudG1kYl9pZCA9IHN0cmVhbS50bWRiX2lkOwogICAgICAgIH0KICAgICAgICBpZiAoCiAgICAgICAgICBzdHJlYW0uc2VyaWVfbmFtZSAhPT0gdW5kZWZpbmVkICYmCiAgICAgICAgICBzdHJlYW0uc2VyaWVfc2Vhc29uICE9PSB1bmRlZmluZWQgJiYKICAgICAgICAgIHN0cmVhbS5zZXJpZV9lcGlzb2RlICE9PSB1bmRlZmluZWQKICAgICAgICApIHsKICAgICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnNlcmllX25hbWUgPSBzdHJlYW0uc2VyaWVfbmFtZTsKICAgICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnNlcmllX3NlYXNvbiA9IHN0cmVhbS5zZXJpZV9zZWFzb247CiAgICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zZXJpZV9lcGlzb2RlID0gc3RyZWFtLnNlcmllX2VwaXNvZGU7CiAgICAgICAgfQogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLm1vZGFsID0gc2hvdzsKICAgICAgfQogICAgfSwKICAgIGVkaXRHcm91cCgpIHsKICAgICAgbGV0IGluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KAogICAgICAgIChncm91cCkgPT4gZ3JvdXAuaWQgPT09IHRoaXMuZ3JvdXBFZGl0b3IuaWQKICAgICAgKTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaW5kZXhdLmdyb3VwX3R5cGUgPQogICAgICAgIHRoaXMuZ3JvdXBFZGl0b3IuZ3JvdXBfdHlwZTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaW5kZXhdLmdyb3VwX25hbWUgPQogICAgICAgIHRoaXMuZ3JvdXBFZGl0b3IuZ3JvdXBfbmFtZTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaW5kZXhdLmdyb3VwX2lzX2hpZGRlbiA9CiAgICAgICAgdGhpcy5ncm91cEVkaXRvci5ncm91cF9pc19oaWRkZW47CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2luZGV4XS5ncm91cF9wYXJlbnRfY29kZSA9CiAgICAgICAgdGhpcy5ncm91cEVkaXRvci5ncm91cF9wYXJlbnRfY29kZTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaW5kZXhdLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgICAgdGhpcy5ncm91cEVkaXRvci5tb2RhbCA9IGZhbHNlOwogICAgfSwKICAgIGVkaXRTdHJlYW0oKSB7CiAgICAgIGxldCBpbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5maW5kSW5kZXgoCiAgICAgICAgKHN0cmVhbSkgPT4gc3RyZWFtLmlkID09PSB0aGlzLmFjdGl2ZVN0cmVhbXNbMF0KICAgICAgKTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zdHJlYW1fdHZnX25hbWUgPQogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV90dmdfbmFtZTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zdHJlYW1fdHZnX2lkID0KICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1fdHZnX2lkOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnN0cmVhbV90dmdfbG9nbyA9CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX3R2Z19sb2dvOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnN0cmVhbV9wYXJlbnRfY29kZSA9CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX3BhcmVudF9jb2RlOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnN0cmVhbV9pc19oaWRkZW4gPQogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV9pc19oaWRkZW47CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc3RyZWFtX3JhZGlvID0KICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1fcmFkaW87CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc291cmNlX3N0cmVhbV91cmwgPQogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnNvdXJjZV9zdHJlYW1fdXJsOwogICAgICBpZiAoCiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5tb3ZpZV9uYW1lICE9PSB1bmRlZmluZWQgJiYKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLm1vdmllX3llYXIgIT09IHVuZGVmaW5lZCAmJgogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0udG1kYl9pZCAhPT0gdW5kZWZpbmVkCiAgICAgICkgewogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0ubW92aWVfbmFtZSA9CiAgICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5tb3ZpZV9uYW1lOwogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0ubW92aWVfeWVhciA9CiAgICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5tb3ZpZV95ZWFyOwogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0udG1kYl9pZCA9IHRoaXMuc3RyZWFtRWRpdG9yLnRtZGJfaWQ7CiAgICAgIH0KICAgICAgaWYgKAogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc2VyaWVfbmFtZSAhPT0gdW5kZWZpbmVkICYmCiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zZXJpZV9zZWFzb24gIT09IHVuZGVmaW5lZCAmJgogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc2VyaWVfZXBpc29kZSAhPT0gdW5kZWZpbmVkCiAgICAgICkgewogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc2VyaWVfbmFtZSA9CiAgICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zZXJpZV9uYW1lOwogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc2VyaWVfc2Vhc29uID0KICAgICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnNlcmllX3NlYXNvbjsKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnNlcmllX2VwaXNvZGUgPQogICAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc2VyaWVfZXBpc29kZTsKICAgICAgfQogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgICAgdGhpcy5zdHJlYW1FZGl0b3IubW9kYWwgPSBmYWxzZTsKICAgIH0sCiAgICBzb3J0R3JvdXBBbHBoYVVwKCkgewogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3VwcyA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLnNvcnQoKGEsIGIpID0+CiAgICAgICAgYi5ncm91cF9uYW1lID4gYS5ncm91cF9uYW1lID8gMSA6IGEuZ3JvdXBfbmFtZSA+IGIuZ3JvdXBfbmFtZSA/IC0xIDogMAogICAgICApOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5tYXAoKGdyb3VwKSA9PiAoZ3JvdXAubW9kaWZpZWQgPSB0cnVlKSk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICB9LAogICAgc29ydEdyb3VwQWxwaGFEb3duKCkgewogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3VwcyA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLnNvcnQoKGEsIGIpID0+CiAgICAgICAgYS5ncm91cF9uYW1lID4gYi5ncm91cF9uYW1lID8gMSA6IGIuZ3JvdXBfbmFtZSA+IGEuZ3JvdXBfbmFtZSA/IC0xIDogMAogICAgICApOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5tYXAoKGdyb3VwKSA9PiAoZ3JvdXAubW9kaWZpZWQgPSB0cnVlKSk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICB9LAogICAgc29ydEdyb3VwVHlwZVVwKCkgewogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3VwcyA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLnNvcnQoKGEsIGIpID0+CiAgICAgICAgYi5ncm91cF90eXBlID4gYS5ncm91cF90eXBlID8gMSA6IGEuZ3JvdXBfdHlwZSA+IGIuZ3JvdXBfdHlwZSA/IC0xIDogMAogICAgICApOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5tYXAoKGdyb3VwKSA9PiAoZ3JvdXAubW9kaWZpZWQgPSB0cnVlKSk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICB9LAogICAgc29ydEdyb3VwVHlwZURvd24oKSB7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuc29ydCgoYSwgYikgPT4KICAgICAgICBhLmdyb3VwX3R5cGUgPiBiLmdyb3VwX3R5cGUgPyAxIDogYi5ncm91cF90eXBlID4gYS5ncm91cF90eXBlID8gLTEgOiAwCiAgICAgICk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLm1hcCgoZ3JvdXApID0+IChncm91cC5tb2RpZmllZCA9IHRydWUpKTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgIH0sCiAgICBzb3J0U3RyZWFtQWxwaGFVcCgpIHsKICAgICAgLy9FUk5TVCBISUVSCiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcyA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5zb3J0KChhLCBiKSA9PiB7CiAgICAgICAgc3dpdGNoICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSkgewogICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICByZXR1cm4gYi5zdHJlYW1fdHZnX25hbWUgPiBhLnN0cmVhbV90dmdfbmFtZQogICAgICAgICAgICAgID8gMQogICAgICAgICAgICAgIDogYS5zdHJlYW1fdHZnX25hbWUgPiBiLnN0cmVhbV90dmdfbmFtZQogICAgICAgICAgICAgID8gLTEKICAgICAgICAgICAgICA6IDA7CiAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgIHJldHVybiBiLm1vdmllX25hbWUgPiBhLm1vdmllX25hbWUKICAgICAgICAgICAgICA/IDEKICAgICAgICAgICAgICA6IGEubW92aWVfbmFtZSA+IGIubW92aWVfbmFtZQogICAgICAgICAgICAgID8gLTEKICAgICAgICAgICAgICA6IDA7CiAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgIHJldHVybiBiLnNlcmllX25hbWUgPiBhLnNlcmllX25hbWUKICAgICAgICAgICAgICA/IDEKICAgICAgICAgICAgICA6IGEuc2VyaWVfbmFtZSA+IGIuc2VyaWVfbmFtZQogICAgICAgICAgICAgID8gLTEKICAgICAgICAgICAgICA6IDA7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLm1hcCgoc3RyZWFtKSA9PiAoc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZSkpOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgfSwKICAgIHNvcnRTdHJlYW1BbHBoYURvd24oKSB7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcyA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5zb3J0KChhLCBiKSA9PiB7CiAgICAgICAgc3dpdGNoICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSkgewogICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICByZXR1cm4gYS5zdHJlYW1fdHZnX25hbWUgPiBiLnN0cmVhbV90dmdfbmFtZQogICAgICAgICAgICAgID8gMQogICAgICAgICAgICAgIDogYi5zdHJlYW1fdHZnX25hbWUgPiBhLnN0cmVhbV90dmdfbmFtZQogICAgICAgICAgICAgID8gLTEKICAgICAgICAgICAgICA6IDA7CiAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgIHJldHVybiBhLm1vdmllX25hbWUgPiBiLm1vdmllX25hbWUKICAgICAgICAgICAgICA/IDEKICAgICAgICAgICAgICA6IGIubW92aWVfbmFtZSA+IGEubW92aWVfbmFtZQogICAgICAgICAgICAgID8gLTEKICAgICAgICAgICAgICA6IDA7CiAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgIHJldHVybiBhLnNlcmllX25hbWUgPiBiLnNlcmllX25hbWUKICAgICAgICAgICAgICA/IDEKICAgICAgICAgICAgICA6IGIuc2VyaWVfbmFtZSA+IGEuc2VyaWVfbmFtZQogICAgICAgICAgICAgID8gLTEKICAgICAgICAgICAgICA6IDA7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLm1hcCgoc3RyZWFtKSA9PiAoc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZSkpOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgfSwKICAgIHNvcnRTdHJlYW1IaWRkZW5VcCgpIHsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLnNvcnQoKGEsIGIpID0+CiAgICAgICAgYi5zdHJlYW1faXNfaGlkZGVuID4gYS5zdHJlYW1faXNfaGlkZGVuCiAgICAgICAgICA/IDEKICAgICAgICAgIDogYS5zdHJlYW1faXNfaGlkZGVuID4gYi5zdHJlYW1faXNfaGlkZGVuCiAgICAgICAgICA/IC0xCiAgICAgICAgICA6IDAKICAgICAgKTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLm1hcCgoZ3JvdXApID0+IChncm91cC5tb2RpZmllZCA9IHRydWUpKTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgIH0sCiAgICBzb3J0U3RyZWFtSGlkZGVuRG93bigpIHsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLnNvcnQoKGEsIGIpID0+CiAgICAgICAgYS5zdHJlYW1faXNfaGlkZGVuID4gYi5zdHJlYW1faXNfaGlkZGVuCiAgICAgICAgICA/IDEKICAgICAgICAgIDogYi5zdHJlYW1faXNfaGlkZGVuID4gYS5zdHJlYW1faXNfaGlkZGVuCiAgICAgICAgICA/IC0xCiAgICAgICAgICA6IDAKICAgICAgKTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLm1hcCgoZ3JvdXApID0+IChncm91cC5tb2RpZmllZCA9IHRydWUpKTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgIH0sCiAgICBhZGRHcm91cCgpIHsKICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZQogICAgICAgIC5wb3N0KCJlZGl0b3IvYWRkLWdyb3VwIiwgeyBwbGF5bGlzdF9pZDogdGhpcy5wbGF5bGlzdEVkaXRvci5pZCB9KQogICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICBpZiAocmVzLnN0YXR1cyA9PT0gdHJ1ZSAmJiByZXMuZGF0YSkgewogICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5wdXNoKHJlcy5kYXRhKTsKICAgICAgICAgICAgICB0aGlzLmFjdGl2ZUdyb3VwID0KICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzWwogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5sZW5ndGggLSAxCiAgICAgICAgICAgICAgICBdLmlkOwogICAgICAgICAgICAgIHRoaXMuYWN0aXZlR3JvdXBzID0gWwogICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbCiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmxlbmd0aCAtIDEKICAgICAgICAgICAgICAgIF0uaWQsCiAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgICByZXNvbHZlKCk7CiAgICAgICAgICAgIH0pLnRoZW4oKCkgPT4gewogICAgICAgICAgICAgIHRoaXMuZWRpdEdyb3VwTW9kYWwodHJ1ZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB0aGlzLiRub3RpZnkoCiAgICAgICAgICAgICJlcnJvciIsCiAgICAgICAgICAgIHRoaXMuJHQoInByb2ZpbGUuZmFpbGVkIiksCiAgICAgICAgICAgIHRoaXMuJHQoImVkaXRvci5hZGQtZ3JvdXAtZXJyb3IiKSwKICAgICAgICAgICAgImxhLXVzZXItc2hpZWxkIiwKICAgICAgICAgICAgeyBkdXJhdGlvbjogNTAwMCwgcGVybWFuZW50OiBmYWxzZSB9CiAgICAgICAgICApOwogICAgICAgIH0pOwogICAgfSwKICAgIGFkZFN0cmVhbSgpIHsKICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZQogICAgICAgIC5wb3N0KCJlZGl0b3IvYWRkLXN0cmVhbSIsIHsKICAgICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgZ3JvdXBfaWQ6IHRoaXMuZ2V0R3JvdXBXaXRoSWQodGhpcy5hY3RpdmVHcm91cCkuaWQsCiAgICAgICAgICBzdHJlYW1fdHlwZTogdGhpcy5nZXRHcm91cFdpdGhJZCh0aGlzLmFjdGl2ZUdyb3VwKS5ncm91cF90eXBlLAogICAgICAgIH0pCiAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIGlmIChyZXMuc3RhdHVzID09PSB0cnVlICYmIHJlcy5kYXRhKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy51bnNoaWZ0KHJlcy5kYXRhKTsKICAgICAgICAgICAgICB0aGlzLmFjdGl2ZVN0cmVhbSA9CiAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbCiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGggLSAxCiAgICAgICAgICAgICAgICBdLmlkOwogICAgICAgICAgICAgIHRoaXMuYWN0aXZlU3RyZWFtcyA9IFsKICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1sKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aCAtIDEKICAgICAgICAgICAgICAgIF0uaWQsCiAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgICByZXNvbHZlKCk7CiAgICAgICAgICAgIH0pLnRoZW4oKCkgPT4gewogICAgICAgICAgICAgIHRoaXMuZWRpdFN0cmVhbU1vZGFsKHRydWUpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgdGhpcy4kbm90aWZ5KAogICAgICAgICAgICAiZXJyb3IiLAogICAgICAgICAgICB0aGlzLiR0KCJwcm9maWxlLmZhaWxlZCIpLAogICAgICAgICAgICB0aGlzLiR0KCJlZGl0b3IuYWRkLXN0cmVhbS1lcnJvciIpLAogICAgICAgICAgICAibGEtdXNlci1zaGllbGQiLAogICAgICAgICAgICB7IGR1cmF0aW9uOiA1MDAwLCBwZXJtYW5lbnQ6IGZhbHNlIH0KICAgICAgICAgICk7CiAgICAgICAgfSk7CiAgICB9LAogICAgbG9hZFN0cmVhbXMoKSB7CiAgICAgIHRoaXMuYWN0aXZlU3RyZWFtID0gLTE7CiAgICAgIHRoaXMuYWN0aXZlU3RyZWFtcyA9IFtdOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMgPSBbXTsKICAgICAgbGV0IGluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KAogICAgICAgIChncm91cCkgPT4gZ3JvdXAuaWQgPT09IHRoaXMuYWN0aXZlR3JvdXAKICAgICAgKTsKICAgICAgbGV0IGdyb3VwID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaW5kZXhdOwogICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGh0dHBTZXJ2aWNlCiAgICAgICAgLmdldCgKICAgICAgICAgIGBlZGl0b3Ivc3RyZWFtcy8ke3RoaXMucGxheWxpc3RFZGl0b3IuaWR9LyR7Z3JvdXAuaWR9LyR7Z3JvdXAuZ3JvdXBfdHlwZX1gCiAgICAgICAgKQogICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgIGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wID0gMDsKICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3AgPSAwOwogICAgICAgICAgaWYgKHJlcy5zdGF0dXMgPT09IHRydWUpIHsKICAgICAgICAgICAgbGV0IHN0cmVhbXMgPSByZXMuZGF0YS5tYXAoKHN0cmVhbSkgPT4gewogICAgICAgICAgICAgIGNvbnN0IHN0ciA9IE9iamVjdC5hc3NpZ24oe30sIHN0cmVhbSk7CiAgICAgICAgICAgICAgc3RyLnNvdXJjZV9zdHJlYW1fdHZnX25hbWUgPSBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lOwogICAgICAgICAgICAgIHN0ci5zb3VyY2Vfc3RyZWFtX3R2Z19pZCA9IHN0cmVhbS5zdHJlYW1fdHZnX2lkOwogICAgICAgICAgICAgIHN0ci5zb3VyY2Vfc3RyZWFtX3R2Z19sb2dvID0gc3RyZWFtLnN0cmVhbV90dmdfbG9nbzsKICAgICAgICAgICAgICBzdHIuc291cmNlX3N0cmVhbV90dmdfY2hubyA9IHN0cmVhbS5zdHJlYW1fdHZnX2Nobm87CiAgICAgICAgICAgICAgc3RyLnNvdXJjZV9zdHJlYW1fdHZnX3NoaWZ0ID0gc3RyZWFtLnN0cmVhbV90dmdfc2hpZnQ7CiAgICAgICAgICAgICAgc3RyLnNvdXJjZV9zdHJlYW1fcGFyZW50X2NvZGUgPSBzdHJlYW0uc3RyZWFtX3BhcmVudF9jb2RlOwogICAgICAgICAgICAgIHN0ci5zb3VyY2Vfc3RyZWFtX2F1ZGlvX3RyYWNrID0gc3RyZWFtLnN0cmVhbV9hdWRpb190cmFjazsKICAgICAgICAgICAgICBzdHIuc291cmNlX3N0cmVhbV9hc3BlY3RfcmF0aW8gPSBzdHJlYW0uc3RyZWFtX2FzcGVjdF9yYXRpbzsKICAgICAgICAgICAgICBzdHIuc291cmNlX3N0cmVhbV9yYWRpbyA9IHN0cmVhbS5zdHJlYW1fcmFkaW87CiAgICAgICAgICAgICAgc3RyLnNvdXJjZV9zdHJlYW1fb3JkZXIgPSBzdHJlYW0uc3RyZWFtX29yZGVyOwogICAgICAgICAgICAgIHN0ci5zb3VyY2Vfc3RyZWFtX2lzX2hpZGRlbiA9IHN0cmVhbS5zdHJlYW1faXNfaGlkZGVuOwogICAgICAgICAgICAgIHN0ci5tb2RpZmllZCA9IGZhbHNlOwogICAgICAgICAgICAgIHN0ci5zdHJlYW1faXNfcmVtb3ZlZCA9IDA7CiAgICAgICAgICAgICAgaWYgKGdyb3VwLmdyb3VwX3R5cGUgPT0gMikgewogICAgICAgICAgICAgICAgaWYgKHN0ci5tb3ZpZV9uYW1lID09ICIiKSB7CiAgICAgICAgICAgICAgICAgIHN0ci5tb3ZpZV9uYW1lID0gc3RyLnN0cmVhbV90dmdfbmFtZTsKICAgICAgICAgICAgICAgICAgc3RyLnNvdXJjZV9tb3ZpZV9uYW1lID0gc3RyLnN0cmVhbV90dmdfbmFtZTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHN0ci5zb3VyY2VfbW92aWVfbmFtZSA9IHN0cmVhbS5tb3ZpZV9uYW1lOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc3RyLnNvdXJjZV9tb3ZpZV95ZWFyID0gc3RyZWFtLm1vdmllX3llYXI7CiAgICAgICAgICAgICAgICBzdHIuc291cmNlX3RtZGJfaWQgPSBzdHJlYW0udG1kYl9pZDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKGdyb3VwLmdyb3VwX3R5cGUgPT0gMykgewogICAgICAgICAgICAgICAgaWYgKHN0ci5zZXJpZV9uYW1lID09ICIiKSB7CiAgICAgICAgICAgICAgICAgIHN0ci5zZXJpZV9uYW1lID0gc3RyLnN0cmVhbV90dmdfbmFtZTsKICAgICAgICAgICAgICAgICAgc3RyLnNvdXJjZV9zZXJpZV9uYW1lID0gc3RyLnN0cmVhbV90dmdfbmFtZTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHN0ci5zb3VyY2Vfc2VyaWVfbmFtZSA9IHN0cmVhbS5zZXJpZV9uYW1lOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc3RyLnNvdXJjZV9zZXJpZV9zZWFzb24gPSBzdHJlYW0uc2VyaWVfc2Vhc29uOwogICAgICAgICAgICAgICAgc3RyLnNvdXJjZV9zZXJpZV9lcGlzb2RlID0gc3RyZWFtLnNlcmllX2VwaXNvZGU7CiAgICAgICAgICAgICAgICBzdHIuc291cmNlX3RtZGJfaWQgPSBzdHJlYW0udG1kYl9pZDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIHN0cjsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHN0cmVhbXMuc29ydCgoYSwgYikgPT4KICAgICAgICAgICAgICBhLnNvdXJjZV9zdHJlYW1fb3JkZXIgPiBiLnNvdXJjZV9zdHJlYW1fb3JkZXIKICAgICAgICAgICAgICAgID8gMQogICAgICAgICAgICAgICAgOiBiLnNvdXJjZV9zdHJlYW1fb3JkZXIgPiBhLnNvdXJjZV9zdHJlYW1fb3JkZXIKICAgICAgICAgICAgICAgID8gLTEKICAgICAgICAgICAgICAgIDogMAogICAgICAgICAgICApOwogICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMgPSBzdHJlYW1zOwogICAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0pOwogICAgfSwKICAgIG1vdmVUb1NlbGVjdGVkR3JvdXAoKSB7CiAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgbGV0IHN0cmVhbXMgPSB0aGlzLmFjdGl2ZVN0cmVhbXMuam9pbigpOwogICAgICBsZXQgaW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoKGdyb3VwKSA9PiB7CiAgICAgICAgcmV0dXJuIGdyb3VwLmlkID09IHRoaXMuYWN0aXZlR3JvdXA7CiAgICAgIH0pOwogICAgICBodHRwU2VydmljZQogICAgICAgIC5wb3N0KGBlZGl0b3IvbW92ZS10by1ncm91cC8ke3RoaXMuYWN0aXZlR3JvdXBUeXBlfWAsIHsKICAgICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgc3RyZWFtczogc3RyZWFtcywKICAgICAgICAgIGdyb3VwX2lkOiB0aGlzLmFjdGl2ZUdyb3Vwc1swXSwKICAgICAgICB9KQogICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICBpZiAocmVzLnN0YXR1cyAmJiByZXMuZGF0YSkgewogICAgICAgICAgICB0aGlzLmxvYWRQbGF5bGlzdCh0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLCBpbmRleCk7CiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICB9KTsKICAgIH0sCiAgICBzYXZlQ2hhbmdlc01vZGFsKHNob3csIHNhdmUgPSBmYWxzZSkgewogICAgICB0aGlzLnNhdmVDaGFuZ2VzLm1vZGFsID0gc2hvdzsKICAgICAgaWYgKHNhdmUpIHsKICAgICAgICB0aGlzLmRvU2F2ZSgpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMubG9hZFN0cmVhbXMoKTsKICAgICAgfQogICAgfSwKICAgIHJhZGlvQnJvd3Nlck1vZGFsKHNob3csIHNhdmUgPSBmYWxzZSkgewogICAgICBpZiAoc2hvdykgewogICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLnNlYXJjaCA9ICIiOwogICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLnJlc3VsdHMgPSBbXTsKICAgICAgICB0aGlzLnJhZGlvQnJvd3Nlci5hY3RpdmUgPSBbXTsKICAgICAgfQogICAgICBpZiAoc2F2ZSkgewogICAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgICBsZXQgZ3JvdXBJbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleCgoZ3JvdXApID0+IHsKICAgICAgICAgIHJldHVybiBncm91cC5pZCA9PSB0aGlzLmFjdGl2ZUdyb3VwOwogICAgICAgIH0pOwogICAgICAgIGxldCBvcmRlciA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7CiAgICAgICAgY29uc3Qgc3RyZWFtcyA9IHRoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZS5tYXAoKGluZGV4KSA9PiB7CiAgICAgICAgICBsZXQgcmFkaW8gPSB0aGlzLnJhZGlvQnJvd3Nlci5yZXN1bHRzW2luZGV4XTsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHNvdXJjZV9zdHJlYW1fdXJsOiByYWRpby51cmwsCiAgICAgICAgICAgIHN0cmVhbV90dmdfbmFtZTogcmFkaW8ubmFtZSwKICAgICAgICAgICAgc3RyZWFtX3R2Z19pZDogIiIsCiAgICAgICAgICAgIHN0cmVhbV90dmdfbG9nbzogcmFkaW8uZmF2aWNvbiwKICAgICAgICAgICAgc3RyZWFtX3JhZGlvOiB0cnVlLAogICAgICAgICAgICBzdHJlYW1fb3JkZXI6IG9yZGVyKyssCiAgICAgICAgICB9OwogICAgICAgIH0pOwogICAgICAgIGh0dHBTZXJ2aWNlCiAgICAgICAgICAucG9zdChgZWRpdG9yL2FkZC1zdHJlYW1zLyR7dGhpcy5hY3RpdmVHcm91cFR5cGV9YCwgewogICAgICAgICAgICBwbGF5bGlzdF9pZDogdGhpcy5wbGF5bGlzdEVkaXRvci5pZCwKICAgICAgICAgICAgZ3JvdXBfaWQ6IHRoaXMuZ2V0R3JvdXBXaXRoSWQodGhpcy5hY3RpdmVHcm91cCkuaWQsCiAgICAgICAgICAgIHN0cmVhbXM6IHN0cmVhbXMsCiAgICAgICAgICB9KQogICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICBpZiAocmVzLnN0YXR1cykgewogICAgICAgICAgICAgIHRoaXMubG9hZFBsYXlsaXN0KHRoaXMucGxheWxpc3RFZGl0b3IuaWQsIGdyb3VwSW5kZXgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIH0pOwogICAgICB9CiAgICAgIHRoaXMucmFkaW9Ccm93c2VyLm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBmaW5kUmFkaW9icm93c2VyKHNlYXJjaCkgewogICAgICBpZiAoc2VhcmNoLmxlbmd0aCA9PT0gMCkgewogICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLnJlc3VsdHMgPSBbXTsKICAgICAgICB0aGlzLnJhZGlvQnJvd3Nlci5hY3RpdmUgPSBbXTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnJhZGlvQnJvd3Nlci5pc0xvYWRpbmcgPSB0cnVlOwogICAgICAgIGh0dHBTZXJ2aWNlCiAgICAgICAgICAucG9zdCgiZWRpdG9yL2ZpbmQtcmFkaW9icm93c2VyIiwgewogICAgICAgICAgICBzZWFyY2g6IHNlYXJjaCwKICAgICAgICAgIH0pCiAgICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZSA9IFtdOwogICAgICAgICAgICBpZiAocmVzLnN0YXR1cykgewogICAgICAgICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLnJlc3VsdHMgPSByZXMuZGF0YTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0aGlzLnJhZGlvQnJvd3Nlci5yZXN1bHRzID0gW107CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuYWN0aXZlID0gW107CiAgICAgICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLnJlc3VsdHMgPSBbXTsKICAgICAgICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIHNvdW5kY2xvdWRNb2RhbChzaG93LCBzYXZlID0gZmFsc2UpIHsKICAgICAgaWYgKHNob3cpIHsKICAgICAgICB0aGlzLnNvdW5kY2xvdWQudXJsID0gIiI7CiAgICAgICAgdGhpcy5zb3VuZGNsb3VkLnRyYWNrID0gbnVsbDsKICAgICAgfQogICAgICBpZiAoc2F2ZSkgewogICAgICAgIGlmICh0aGlzLnNvdW5kY2xvdWQudHJhY2spIHsKICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgIGxldCBncm91cEluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KChncm91cCkgPT4gewogICAgICAgICAgICByZXR1cm4gZ3JvdXAuaWQgPT0gdGhpcy5hY3RpdmVHcm91cDsKICAgICAgICAgIH0pOwogICAgICAgICAgbGV0IG9yZGVyID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsKICAgICAgICAgIGNvbnN0IHN0cmVhbXMgPSBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBzb3VyY2Vfc3RyZWFtX3VybDogdGhpcy5zb3VuZGNsb3VkLnVybCwKICAgICAgICAgICAgICBzdHJlYW1fdHZnX25hbWU6IHRoaXMuc291bmRjbG91ZC50cmFjay50aXRsZSwKICAgICAgICAgICAgICBzdHJlYW1fdHZnX2lkOiAiIiwKICAgICAgICAgICAgICBzdHJlYW1fdHZnX2xvZ286IHRoaXMuc291bmRjbG91ZC50cmFjay5hcnR3b3JrX3VybC5yZXBsYWNlKAogICAgICAgICAgICAgICAgImxhcmdlLmpwZyIsCiAgICAgICAgICAgICAgICAidDUwMHg1MDAuanBnIgogICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgc3RyZWFtX3JhZGlvOiB0cnVlLAogICAgICAgICAgICAgIHN0cmVhbV9vcmRlcjogb3JkZXIrKywKICAgICAgICAgICAgfSwKICAgICAgICAgIF07CiAgICAgICAgICBodHRwU2VydmljZQogICAgICAgICAgICAucG9zdChgZWRpdG9yL2FkZC1zdHJlYW1zLyR7dGhpcy5hY3RpdmVHcm91cFR5cGV9YCwgewogICAgICAgICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgICAgIGdyb3VwX2lkOiB0aGlzLmdldEdyb3VwV2l0aElkKHRoaXMuYWN0aXZlR3JvdXApLmlkLAogICAgICAgICAgICAgIHN0cmVhbXM6IHN0cmVhbXMsCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgIGlmIChyZXMuc3RhdHVzKSB7CiAgICAgICAgICAgICAgICB0aGlzLmxvYWRQbGF5bGlzdCh0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLCBncm91cEluZGV4KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMuc291bmRjbG91ZC5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgZ2V0U291bmRjbG91ZFRyYWNrKHVybCwgY2xpZW50X2lkKSB7CiAgICAgIGlmICh1cmwubGVuZ3RoID09PSAwIHx8ICEvc291bmRjbG91ZFwuY29tLy50ZXN0KHVybCkpIHsKICAgICAgICB0aGlzLnNvdW5kY2xvdWQudXJsID0gIiI7CiAgICAgICAgdGhpcy5zb3VuZGNsb3VkLnRyYWNrID0gbnVsbDsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNvdW5kY2xvdWQuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgICBodHRwU2VydmljZQogICAgICAgICAgLnBvc3QoImVkaXRvci9zb3VuZGNsb3VkLXRyYWNrIiwgewogICAgICAgICAgICB1cmw6IHVybCwKICAgICAgICAgICAgY2xpZW50X2lkOiBjbGllbnRfaWQsCiAgICAgICAgICB9KQogICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICBpZiAocmVzLnN0YXR1cyAmJiBPYmplY3Qua2V5cyhyZXMuZGF0YSkubGVuZ3RoKSB7CiAgICAgICAgICAgICAgdGhpcy5zb3VuZGNsb3VkLnRyYWNrID0gcmVzLmRhdGE7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGhpcy5zb3VuZGNsb3VkLnRyYWNrID0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnNvdW5kY2xvdWQuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgICAgdGhpcy5zb3VuZGNsb3VkLnRyYWNrID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5zb3VuZGNsb3VkLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICB5b3V0dWJlTW9kYWwoc2hvdywgc2F2ZSA9IGZhbHNlKSB7CiAgICAgIGlmIChzaG93KSB7CiAgICAgICAgdGhpcy55b3V0dWJlLnVybCA9ICIiOwogICAgICAgIHRoaXMueW91dHViZS52aWRlbyA9IG51bGw7CiAgICAgICAgdGhpcy55b3V0dWJlLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9CiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgaWYgKHRoaXMueW91dHViZS52aWRlbykgewogICAgICAgICAgdGhpcy55b3V0dWJlLmlzTG9hZGluZyA9IHRydWU7CiAgICAgICAgICBsZXQgZ3JvdXBJbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleCgoZ3JvdXApID0+IHsKICAgICAgICAgICAgcmV0dXJuIGdyb3VwLmlkID09IHRoaXMuYWN0aXZlR3JvdXA7CiAgICAgICAgICB9KTsKICAgICAgICAgIGxldCBvcmRlciA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7CiAgICAgICAgICBjb25zdCBzdHJlYW1zID0gWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgc291cmNlX3N0cmVhbV91cmw6IHRoaXMueW91dHViZS51cmwsCiAgICAgICAgICAgICAgc3RyZWFtX3R2Z19uYW1lOiB0aGlzLnlvdXR1YmUudmlkZW8udmlkZW9EZXRhaWxzLnRpdGxlLAogICAgICAgICAgICAgIHN0cmVhbV90dmdfaWQ6ICIiLAogICAgICAgICAgICAgIHN0cmVhbV90dmdfbG9nbzogYGh0dHA6Ly9pLnl0aW1nLmNvbS92aS8ke3RoaXMueW91dHViZS52aWRlb0lkfS9tYXhyZXNkZWZhdWx0LmpwZ2AsCiAgICAgICAgICAgICAgc3RyZWFtX29yZGVyOiBvcmRlcisrLAogICAgICAgICAgICB9LAogICAgICAgICAgXTsKICAgICAgICAgIGh0dHBTZXJ2aWNlCiAgICAgICAgICAgIC5wb3N0KGBlZGl0b3IvYWRkLXN0cmVhbXMvJHt0aGlzLmFjdGl2ZUdyb3VwVHlwZX1gLCB7CiAgICAgICAgICAgICAgcGxheWxpc3RfaWQ6IHRoaXMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICAgICAgZ3JvdXBfaWQ6IHRoaXMuZ2V0R3JvdXBXaXRoSWQodGhpcy5hY3RpdmVHcm91cCkuaWQsCiAgICAgICAgICAgICAgc3RyZWFtczogc3RyZWFtcywKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgIHRoaXMueW91dHViZS5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICBpZiAocmVzLnN0YXR1cykgewogICAgICAgICAgICAgICAgdGhpcy5sb2FkUGxheWxpc3QodGhpcy5wbGF5bGlzdEVkaXRvci5pZCwgZ3JvdXBJbmRleCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgICAgIHRoaXMueW91dHViZS5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMueW91dHViZS5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgZ2V0WW91dHViZVBhZ2UodmlkZW9JZCkgewogICAgICB0aGlzLnlvdXR1YmUuaXNMb2FkaW5nID0gdHJ1ZTsgCiAgICAgIGh0dHBTZXJ2aWNlCiAgICAgICAgLnBvc3QoImVkaXRvci95b3V0dWJlLXZpZGVvIiwgeyB2aWRlb19pZDogdmlkZW9JZCB9KQogICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgIGlmIChyZXMuc3RhdHVzICYmIE9iamVjdC5rZXlzKHJlcy5kYXRhKS5sZW5ndGgpIHsKICAgICAgICAgICAgdGhpcy55b3V0dWJlLnZpZGVvID0gcmVzLmRhdGE7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnlvdXR1YmUudmlkZW8gPSBudWxsOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy55b3V0dWJlLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgIHRoaXMueW91dHViZS52aWRlbyA9IG51bGw7CiAgICAgICAgICB0aGlzLnlvdXR1YmUuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgfSk7CiAgICB9LAogICAgdmltZW9Nb2RhbChzaG93LCBzYXZlID0gZmFsc2UpIHsKICAgICAgaWYgKHNob3cpIHsKICAgICAgICB0aGlzLnZpbWVvLnVybCA9ICIiOwogICAgICAgIHRoaXMudmltZW8udmlkZW8gPSBudWxsOwogICAgICAgIHRoaXMudmltZW8uaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0KICAgICAgaWYgKHNhdmUpIHsKICAgICAgICBpZiAodGhpcy52aW1lby52aWRlbykgewogICAgICAgICAgdGhpcy52aW1lby5pc0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgbGV0IGdyb3VwSW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoKGdyb3VwKSA9PiB7CiAgICAgICAgICAgIHJldHVybiBncm91cC5pZCA9PSB0aGlzLmFjdGl2ZUdyb3VwOwogICAgICAgICAgfSk7CiAgICAgICAgICBsZXQgb3JkZXIgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOwogICAgICAgICAgY29uc3Qgc3RyZWFtcyA9IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgIHNvdXJjZV9zdHJlYW1fdXJsOiB0aGlzLnZpbWVvLnVybCwKICAgICAgICAgICAgICBzdHJlYW1fdHZnX25hbWU6IHRoaXMudmltZW8udmlkZW8udmlkZW8udGl0bGUsCiAgICAgICAgICAgICAgc3RyZWFtX3R2Z19pZDogIiIsCiAgICAgICAgICAgICAgc3RyZWFtX3R2Z19sb2dvOiB0aGlzLnZpbWVvLnZpZGVvLnZpZGVvLnRodW1icy5iYXNlLAogICAgICAgICAgICAgIHN0cmVhbV9vcmRlcjogb3JkZXIrKywKICAgICAgICAgICAgfSwKICAgICAgICAgIF07CiAgICAgICAgICBodHRwU2VydmljZQogICAgICAgICAgICAucG9zdChgZWRpdG9yL2FkZC1zdHJlYW1zLyR7dGhpcy5hY3RpdmVHcm91cFR5cGV9YCwgewogICAgICAgICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgICAgIGdyb3VwX2lkOiB0aGlzLmdldEdyb3VwV2l0aElkKHRoaXMuYWN0aXZlR3JvdXApLmlkLAogICAgICAgICAgICAgIHN0cmVhbXM6IHN0cmVhbXMsCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICB0aGlzLnZpbWVvLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgIGlmIChyZXMuc3RhdHVzKSB7CiAgICAgICAgICAgICAgICB0aGlzLmxvYWRQbGF5bGlzdCh0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLCBncm91cEluZGV4KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICAgICAgdGhpcy52aW1lby5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMudmltZW8ubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGdldFZpbWVvQ29uZmlnKHZpZGVvSWQpIHsKICAgICAgdGhpcy52aW1lby5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZQogICAgICAgIC5wb3N0KCJlZGl0b3IvdmltZW8tdmlkZW8iLCB7IHZpZGVvX2lkOiB2aWRlb0lkIH0pCiAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgdGhpcy52aW1lby52aWRlbyA9IHJlcy5kYXRhOwogICAgICAgICAgdGhpcy52aW1lby5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICB9KTsKICAgIH0sCiAgICBkYWlseW1vdGlvbk1vZGFsKHNob3csIHNhdmUgPSBmYWxzZSkgewogICAgICBpZiAoc2hvdykgewogICAgICAgIHRoaXMuZGFpbHltb3Rpb24udXJsID0gIiI7CiAgICAgICAgdGhpcy5kYWlseW1vdGlvbi52aWRlbyA9IG51bGw7CiAgICAgICAgdGhpcy5kYWlseW1vdGlvbi5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfQogICAgICBpZiAoc2F2ZSkgewogICAgICAgIGlmICh0aGlzLmRhaWx5bW90aW9uLnZpZGVvKSB7CiAgICAgICAgICB0aGlzLmRhaWx5bW90aW9uLmlzTG9hZGluZyA9IHRydWU7CiAgICAgICAgICBsZXQgZ3JvdXBJbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleCgoZ3JvdXApID0+IHsKICAgICAgICAgICAgcmV0dXJuIGdyb3VwLmlkID09IHRoaXMuYWN0aXZlR3JvdXA7CiAgICAgICAgICB9KTsKICAgICAgICAgIGxldCBvcmRlciA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7CiAgICAgICAgICBjb25zdCBzdHJlYW1zID0gWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgc291cmNlX3N0cmVhbV91cmw6IHRoaXMuZGFpbHltb3Rpb24udXJsLAogICAgICAgICAgICAgIHN0cmVhbV90dmdfbmFtZTogdGhpcy5kYWlseW1vdGlvbi52aWRlby50aXRsZSwKICAgICAgICAgICAgICBzdHJlYW1fdHZnX2lkOiAiIiwKICAgICAgICAgICAgICBzdHJlYW1fdHZnX2xvZ286IHRoaXMuZGFpbHltb3Rpb24udmlkZW8udGh1bWJuYWlsXzEwODBfdXJsLAogICAgICAgICAgICAgIHN0cmVhbV9vcmRlcjogb3JkZXIrKywKICAgICAgICAgICAgfSwKICAgICAgICAgIF07CiAgICAgICAgICBodHRwU2VydmljZQogICAgICAgICAgICAucG9zdChgZWRpdG9yL2FkZC1zdHJlYW1zLyR7dGhpcy5hY3RpdmVHcm91cFR5cGV9YCwgewogICAgICAgICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgICAgIGdyb3VwX2lkOiB0aGlzLmdldEdyb3VwV2l0aElkKHRoaXMuYWN0aXZlR3JvdXApLmlkLAogICAgICAgICAgICAgIHN0cmVhbXM6IHN0cmVhbXMsCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICB0aGlzLmRhaWx5bW90aW9uLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgIGlmIChyZXMuc3RhdHVzKSB7CiAgICAgICAgICAgICAgICB0aGlzLmxvYWRQbGF5bGlzdCh0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLCBncm91cEluZGV4KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICAgICAgdGhpcy5kYWlseW1vdGlvbi5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMuZGFpbHltb3Rpb24ubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGdldERhaWx5bW90aW9uQ29uZmlnKHZpZGVvSWQpIHsKICAgICAgdGhpcy5kYWlseW1vdGlvbi5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZQogICAgICAgIC5wb3N0KCJlZGl0b3IvZGFpbHltb3Rpb24tdmlkZW8iLCB7IHZpZGVvX2lkOiB2aWRlb0lkIH0pCiAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgdGhpcy5kYWlseW1vdGlvbi52aWRlbyA9IHJlcy5kYXRhOwogICAgICAgICAgdGhpcy5kYWlseW1vdGlvbi5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICB9KTsKICAgIH0sCiAgICB0ZWRUYWxrc01vZGFsKHNob3csIHNhdmUgPSBmYWxzZSkgewogICAgICBpZiAoc2hvdykgewogICAgICAgIHRoaXMudGVkVGFsa3MudXJsID0gIiI7CiAgICAgICAgdGhpcy50ZWRUYWxrcy52aWRlbyA9IG51bGw7CiAgICAgICAgdGhpcy50ZWRUYWxrcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfQogICAgICBpZiAoc2F2ZSkgewogICAgICAgIGlmICh0aGlzLnRlZFRhbGtzLnZpZGVvKSB7CiAgICAgICAgICB0aGlzLnRlZFRhbGtzLmlzTG9hZGluZyA9IHRydWU7CiAgICAgICAgICBsZXQgZ3JvdXBJbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleCgoZ3JvdXApID0+IHsKICAgICAgICAgICAgcmV0dXJuIGdyb3VwLmlkID09IHRoaXMuYWN0aXZlR3JvdXA7CiAgICAgICAgICB9KTsKICAgICAgICAgIGxldCBvcmRlciA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7CiAgICAgICAgICBjb25zdCBzdHJlYW1zID0gWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgc291cmNlX3N0cmVhbV91cmw6IHRoaXMudGVkVGFsa3MudXJsLAogICAgICAgICAgICAgIHN0cmVhbV90dmdfbmFtZTogdGhpcy50ZWRUYWxrcy52aWRlby50aXRsZSwKICAgICAgICAgICAgICBzdHJlYW1fdHZnX2lkOiAiIiwKICAgICAgICAgICAgICBzdHJlYW1fdHZnX2xvZ286IHRoaXMudGVkVGFsa3MudmlkZW8uaGVybywKICAgICAgICAgICAgICBzdHJlYW1fb3JkZXI6IG9yZGVyKyssCiAgICAgICAgICAgIH0sCiAgICAgICAgICBdOwogICAgICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAgICAgLnBvc3QoYGVkaXRvci9hZGQtc3RyZWFtcy8ke3RoaXMuYWN0aXZlR3JvdXBUeXBlfWAsIHsKICAgICAgICAgICAgICBwbGF5bGlzdF9pZDogdGhpcy5wbGF5bGlzdEVkaXRvci5pZCwKICAgICAgICAgICAgICBncm91cF9pZDogdGhpcy5nZXRHcm91cFdpdGhJZCh0aGlzLmFjdGl2ZUdyb3VwKS5pZCwKICAgICAgICAgICAgICBzdHJlYW1zOiBzdHJlYW1zLAogICAgICAgICAgICB9KQogICAgICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgdGhpcy50ZWRUYWxrcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICBpZiAocmVzLnN0YXR1cykgewogICAgICAgICAgICAgICAgdGhpcy5sb2FkUGxheWxpc3QodGhpcy5wbGF5bGlzdEVkaXRvci5pZCwgZ3JvdXBJbmRleCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgICAgIHRoaXMudGVkVGFsa3MuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLnRlZFRhbGtzLm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBnZXRUZWRUYWxrc0NvbmZpZyh1cmwpIHsKICAgICAgdGhpcy50ZWRUYWxrcy5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZS5wb3N0KCJlZGl0b3IvdGVkLXRhbGtzLXZpZGVvIiwgeyB1cmw6IHVybCB9KS50aGVuKChyZXMpID0+IHsKICAgICAgICB0aGlzLnRlZFRhbGtzLnZpZGVvID0gcmVzLmRhdGEudGFsa3MubGVuZ3RoID8gcmVzLmRhdGEudGFsa3NbMF0gOiBudWxsOwogICAgICAgIHRoaXMudGVkVGFsa3MuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0pOwogICAgfSwKICAgIHhoYW1zdGVyTW9kYWwoc2hvdywgc2F2ZSA9IGZhbHNlKSB7CiAgICAgIGlmIChzaG93KSB7CiAgICAgICAgdGhpcy54aGFtc3Rlci51cmwgPSAiIjsKICAgICAgICB0aGlzLnhoYW1zdGVyLnZpZGVvID0gbnVsbDsKICAgICAgICB0aGlzLnhoYW1zdGVyLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9CiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgaWYgKHRoaXMueGhhbXN0ZXIudmlkZW8pIHsKICAgICAgICAgIHRoaXMueGhhbXN0ZXIuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgIGxldCBncm91cEluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KChncm91cCkgPT4gewogICAgICAgICAgICByZXR1cm4gZ3JvdXAuaWQgPT0gdGhpcy5hY3RpdmVHcm91cDsKICAgICAgICAgIH0pOwogICAgICAgICAgbGV0IG9yZGVyID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsKICAgICAgICAgIGNvbnN0IHN0cmVhbXMgPSBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBzb3VyY2Vfc3RyZWFtX3VybDogdGhpcy54aGFtc3Rlci51cmwsCiAgICAgICAgICAgICAgc3RyZWFtX3R2Z19uYW1lOiB0aGlzLnhoYW1zdGVyLnZpZGVvLnZpZGVvRW50aXR5LnRpdGxlLAogICAgICAgICAgICAgIHN0cmVhbV90dmdfaWQ6ICIiLAogICAgICAgICAgICAgIHN0cmVhbV90dmdfbG9nbzogdGhpcy54aGFtc3Rlci52aWRlby52aWRlb0VudGl0eS50aHVtYkJpZywKICAgICAgICAgICAgICBzdHJlYW1fb3JkZXI6IG9yZGVyKyssCiAgICAgICAgICAgIH0sCiAgICAgICAgICBdOwogICAgICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAgICAgLnBvc3QoYGVkaXRvci9hZGQtc3RyZWFtcy8ke3RoaXMuYWN0aXZlR3JvdXBUeXBlfWAsIHsKICAgICAgICAgICAgICBwbGF5bGlzdF9pZDogdGhpcy5wbGF5bGlzdEVkaXRvci5pZCwKICAgICAgICAgICAgICBncm91cF9pZDogdGhpcy5nZXRHcm91cFdpdGhJZCh0aGlzLmFjdGl2ZUdyb3VwKS5pZCwKICAgICAgICAgICAgICBzdHJlYW1zOiBzdHJlYW1zLAogICAgICAgICAgICB9KQogICAgICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgdGhpcy54aGFtc3Rlci5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICBpZiAocmVzLnN0YXR1cykgewogICAgICAgICAgICAgICAgdGhpcy5sb2FkUGxheWxpc3QodGhpcy5wbGF5bGlzdEVkaXRvci5pZCwgZ3JvdXBJbmRleCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgICAgIHRoaXMueGhhbXN0ZXIuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLnhoYW1zdGVyLm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBnZXRYaGFtc3RlckNvbmZpZyh1cmwpIHsKICAgICAgdGhpcy54aGFtc3Rlci5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZS5wb3N0KCJlZGl0b3IveGhhbXN0ZXItdmlkZW8iLCB7IHVybDogdXJsIH0pLnRoZW4oKHJlcykgPT4gewogICAgICAgIHRoaXMueGhhbXN0ZXIudmlkZW8gPSByZXMuZGF0YTsKICAgICAgICB0aGlzLnhoYW1zdGVyLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9KTsKICAgIH0sCiAgICBncm91cERvdWJsZUNsaWNrKCkgewogICAgICBpZiAodGhpcy5hY3RpdmVHcm91cHMubGVuZ3RoID09PSAxKSB7CiAgICAgICAgdGhpcy5lZGl0R3JvdXBNb2RhbCh0cnVlKTsKICAgICAgfQogICAgfSwKICAgIHN0cmVhbURvdWJsZUNsaWNrKCkgewogICAgICBpZiAodGhpcy5hY3RpdmVTdHJlYW1zLmxlbmd0aCA9PT0gMSkgewogICAgICAgIHRoaXMuZWRpdFN0cmVhbU1vZGFsKHRydWUpOwogICAgICB9CiAgICB9LAogICAgbG9hZExvZ29Db3VudHJpZXMoKSB7CiAgICAgIHRoaXMuZmluZExvZ28uaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAuZ2V0KCJlZGl0b3IvbG9nby1jb3VudHJpZXMiKQogICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgIHRoaXMuZmluZExvZ28uaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB0aGlzLmZpbmRMb2dvLmNvdW50cmllcyA9IHJlcy5kYXRhCiAgICAgICAgICAgIC5tYXAoKGNvdW50cnkpID0+IHsKICAgICAgICAgICAgICBsZXQgY24gPSB0aGlzLmNvdW50cmllcy5maW5kKAogICAgICAgICAgICAgICAgKGNudCkgPT4gY250LmNvZGUudG9Mb3dlckNhc2UoKSA9PSBjb3VudHJ5LnRvTG93ZXJDYXNlKCkKICAgICAgICAgICAgICApOwogICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICB0ZXh0OiBjbiA/IGNuLm5hbWUgOiBjb3VudHJ5LAogICAgICAgICAgICAgICAgdmFsdWU6IGNvdW50cnksCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLnNvcnQoKGEsIGIpID0+IHsKICAgICAgICAgICAgICByZXR1cm4gYS50ZXh0LnRvVXBwZXJDYXNlKCkgPCBiLnRleHQudG9VcHBlckNhc2UoKQogICAgICAgICAgICAgICAgPyAtMQogICAgICAgICAgICAgICAgOiBhLnRleHQudG9VcHBlckNhc2UoKSA+IGIudGV4dC50b1VwcGVyQ2FzZSgpCiAgICAgICAgICAgICAgICA/IDEKICAgICAgICAgICAgICAgIDogMDsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB0aGlzLmFzc2lnbkxvZ28uY291bnRyaWVzID0gWy4uLnRoaXMuZmluZExvZ28uY291bnRyaWVzXTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICB0aGlzLmZpbmRMb2dvLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0pOwogICAgfSwKICAgIGxvYWRUVkdJRENvdW50cmllcygpIHsKICAgICAgdGhpcy5hc3NpZ25UVkdJRC5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZQogICAgICAgIC5nZXQoImVkaXRvci90di1ndWlkZS1jb3VudHJpZXMiKQogICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgIHRoaXMuYXNzaWduVFZHSUQuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB0aGlzLmFzc2lnblRWR0lELmNvdW50cmllcyA9IHJlcy5kYXRhCiAgICAgICAgICAgIC5tYXAoKGNvdW50cnkpID0+IHsKICAgICAgICAgICAgICBsZXQgY24gPSB0aGlzLmNvdW50cmllcy5maW5kKAogICAgICAgICAgICAgICAgKGNudCkgPT4gY250LmNvZGUudG9Mb3dlckNhc2UoKSA9PSBjb3VudHJ5LnRvTG93ZXJDYXNlKCkKICAgICAgICAgICAgICApOwogICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICB0ZXh0OiBjbiA/IGNuLm5hbWUgOiBjb3VudHJ5LAogICAgICAgICAgICAgICAgdmFsdWU6IGNvdW50cnksCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLnNvcnQoKGEsIGIpID0+IHsKICAgICAgICAgICAgICByZXR1cm4gYS50ZXh0LnRvVXBwZXJDYXNlKCkgPCBiLnRleHQudG9VcHBlckNhc2UoKQogICAgICAgICAgICAgICAgPyAtMQogICAgICAgICAgICAgICAgOiBhLnRleHQudG9VcHBlckNhc2UoKSA+IGIudGV4dC50b1VwcGVyQ2FzZSgpCiAgICAgICAgICAgICAgICA/IDEKICAgICAgICAgICAgICAgIDogMDsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB0aGlzLmFzc2lnblRWR0lELmNvdW50cmllcy51bnNoaWZ0KHsgdGV4dDogdGhpcy4kdCgiZ2VuZXJhbC5hbGwiKSwgdmFsdWU6ICJhbGwiIH0pOwogICAgICAgICAgdGhpcy5maW5kVFZHSUQuY291bnRyaWVzID0gWy4uLnRoaXMuYXNzaWduVFZHSUQuY291bnRyaWVzXTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICB0aGlzLmFzc2lnblRWR0lELmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0pOwogICAgfSwKICAgIGxvYWRMb2dvc0ZpbmQoY291bnRyeSkgewogICAgICB0aGlzLmZpbmRMb2dvLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGh0dHBTZXJ2aWNlCiAgICAgICAgLmdldChgZWRpdG9yL2xvZ29zLyR7Y291bnRyeX1gKQogICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgIHRoaXMuZmluZExvZ28ubG9nbyA9ICIiOwogICAgICAgICAgdGhpcy5maW5kTG9nby5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIHRoaXMuZmluZExvZ28ubG9nb3MgPSByZXMuZGF0YS5tYXAoKGxvZ28pID0+IHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICB0ZXh0OiBsb2dvLmxhYmVsLAogICAgICAgICAgICAgIHZhbHVlOiBsb2dvLmZpbGVuYW1lLAogICAgICAgICAgICB9OwogICAgICAgICAgfSk7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgdGhpcy5maW5kTG9nby5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICB9KTsKICAgIH0sCiAgICBmaW5kTG9nb01vZGFsKHNob3csIHNhdmUgPSBmYWxzZSkgewogICAgICBsZXQgc2VsZWN0ZWQgPSB0aGlzLmdldFN0cmVhbVdpdGhJZCh0aGlzLmFjdGl2ZVN0cmVhbXNbMF0pOwogICAgICBpZiAoc2hvdykgewogICAgICAgIHRoaXMuZmluZExvZ28ubG9nbyA9ICIiOwogICAgICAgIHRoaXMuZmluZExvZ28udGl0bGUgPSBzZWxlY3RlZC5zdHJlYW1fdHZnX25hbWU7CiAgICAgIH0KICAgICAgdGhpcy5maW5kTG9nby5zZWFyY2ggPSAiIjsKICAgICAgaWYgKHNhdmUpIHsKICAgICAgICBpZiAoc2VsZWN0ZWQpIHsKICAgICAgICAgIHNlbGVjdGVkLnN0cmVhbV90dmdfbG9nbyA9IGBodHRwOi8vc3RhdGljLmlwdHYtdG9vbHMuY29tLyR7dGhpcy5maW5kTG9nby5jb3VudHJ5fS8ke3RoaXMuZmluZExvZ28ubG9nb31gOwogICAgICAgICAgc2VsZWN0ZWQubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy5maW5kTG9nby5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgbG9hZExvZ29zQXNzaWduKGNvdW50cnkpIHsKICAgICAgdGhpcy5hc3NpZ25Mb2dvLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGh0dHBTZXJ2aWNlCiAgICAgICAgLmdldChgZWRpdG9yL2xvZ29zLyR7Y291bnRyeX1gKQogICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgIHRoaXMuYXNzaWduTG9nby5sb2dvID0gIiI7CiAgICAgICAgICB0aGlzLmFzc2lnbkxvZ28uaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB0aGlzLmFzc2lnbkxvZ28ubG9nb3MgPSByZXMuZGF0YS5tYXAoKGxvZ28pID0+IGxvZ28uZmlsZW5hbWUpOwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgIHRoaXMuYXNzaWduTG9nby5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICB9KTsKICAgIH0sCiAgICBhc3NpZ25Mb2dvTW9kYWwoc2hvdywgc2F2ZSA9IGZhbHNlKSB7CiAgICAgIGlmIChzaG93KSB7CiAgICAgICAgdGhpcy5hc3NpZ25Mb2dvLmxvZ28gPSAiIjsKICAgICAgfQogICAgICBpZiAoc2F2ZSkgewogICAgICAgIHZhciBjaGFuZ2VkID0gZmFsc2U7CiAgICAgICAgdmFyIHN0cmluZ1NpbWlsYXJpdHkgPSByZXF1aXJlKCJzdHJpbmctc2ltaWxhcml0eSIpOwogICAgICAgIGxldCBzdHJlYW1zID0gW107CiAgICAgICAgaWYgKHRoaXMuYXNzaWduTG9nby5hc3NpZ25BbGwgPT0gMSkgewogICAgICAgICAgc3RyZWFtcyA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtczsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc3RyZWFtcyA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5maWx0ZXIoKHN0cmVhbSkgPT4gIXN0cmVhbS5zdHJlYW1fdHZnX2xvZ28ubGVuZ3RoKTsKICAgICAgICB9CiAgICAgICAgc3RyZWFtcy5tYXAoKHN0cmVhbSkgPT4gewogICAgICAgICAgbGV0IG1hdGNoMSA9IHN0cmluZ1NpbWlsYXJpdHkuZmluZEJlc3RNYXRjaCgKICAgICAgICAgICAgU3RyaW5nKHN0cmVhbS5zdHJlYW1fdHZnX25hbWUpLnJlcGxhY2UoLyBoZCQvaSwgIiIpLAogICAgICAgICAgICB0aGlzLmFzc2lnbkxvZ28ubG9nb3MKICAgICAgICAgICkuYmVzdE1hdGNoOwogICAgICAgICAgbGV0IG1hdGNoMiA9IHN0cmluZ1NpbWlsYXJpdHkuZmluZEJlc3RNYXRjaCgKICAgICAgICAgICAgU3RyaW5nKHN0cmVhbS5zdHJlYW1fdHZnX2lkKSwKICAgICAgICAgICAgdGhpcy5hc3NpZ25Mb2dvLmxvZ29zCiAgICAgICAgICApLmJlc3RNYXRjaDsKICAgICAgICAgIGlmIChtYXRjaDEucmF0aW5nID49IDAuMykgewogICAgICAgICAgICBjaGFuZ2VkID0gdHJ1ZTsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfbG9nbyA9IGBodHRwOi8vc3RhdGljLmlwdHYtdG9vbHMuY29tLyR7dGhpcy5hc3NpZ25Mb2dvLmNvdW50cnl9LyR7bWF0Y2gxLnRhcmdldH1gOwogICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgfSBlbHNlIGlmIChtYXRjaDIucmF0aW5nID49IDAuNSkgewogICAgICAgICAgICBjaGFuZ2VkID0gdHJ1ZTsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfbG9nbyA9IGBodHRwOi8vc3RhdGljLmlwdHYtdG9vbHMuY29tLyR7dGhpcy5hc3NpZ25Mb2dvLmNvdW50cnl9LyR7bWF0Y2gyLnRhcmdldH1gOwogICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IGNoYW5nZWQ7CiAgICAgIH0KICAgICAgdGhpcy5hc3NpZ25Mb2dvLm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBsb2FkVFZHSURBc3NpZ24oY291bnRyeSkgewogICAgICB0aGlzLmFzc2lnblRWR0lELmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGh0dHBTZXJ2aWNlCiAgICAgICAgLmdldChgZWRpdG9yL3R2LWd1aWRlLyR7Y291bnRyeX1gKQogICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgIHRoaXMuYXNzaWduVFZHSUQuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB0aGlzLmFzc2lnblRWR0lELmNoYW5uZWxzID0gcmVzLmRhdGE7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgdGhpcy5hc3NpZ25UVkdJRC5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICB9KTsKICAgIH0sCiAgICBhc3NpZ25UVkdJRE1vZGFsKHNob3csIHNhdmUgPSBmYWxzZSkgewogICAgICBpZiAoc2F2ZSkgewogICAgICAgIHZhciBjaGFuZ2VkID0gZmFsc2U7CiAgICAgICAgdmFyIHN0cmluZ1NpbWlsYXJpdHkgPSByZXF1aXJlKCJzdHJpbmctc2ltaWxhcml0eSIpOwogICAgICAgIGxldCBzdHJlYW1zID0gW107CiAgICAgICAgaWYgKHRoaXMuYXNzaWduVFZHSUQuYXNzaWduQWxsID09IDEpIHsKICAgICAgICAgIHN0cmVhbXMgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXM7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN0cmVhbXMgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMuZmlsdGVyKChzdHJlYW0pID0+ICFzdHJlYW0uc3RyZWFtX3R2Z19pZC5sZW5ndGggfHwgc3RyZWFtLnN0cmVhbV90dmdfaWQubGVuZ3RoID09IDApOwogICAgICAgIH0KICAgICAgICBsZXQgY2hhbm5lbE5hbWVzID0gdGhpcy5hc3NpZ25UVkdJRC5jaGFubmVscy5tYXAoY2hhbm5lbCA9PiBjaGFubmVsLnR2Z19uYW1lKTsKICAgICAgICBsZXQgY2hhbm5lbElkcyA9IHRoaXMuYXNzaWduVFZHSUQuY2hhbm5lbHMubWFwKGNoYW5uZWwgPT4gY2hhbm5lbC50dmdfaWQpOwogICAgICAgIHN0cmVhbXMubWFwKChzdHJlYW0pID0+IHsKICAgICAgICAgIGxldCBtYXRjaDEgPSBzdHJpbmdTaW1pbGFyaXR5LmZpbmRCZXN0TWF0Y2goCiAgICAgICAgICAgIFN0cmluZyhzdHJlYW0uc3RyZWFtX3R2Z19uYW1lKSwKICAgICAgICAgICAgY2hhbm5lbE5hbWVzCiAgICAgICAgICApLmJlc3RNYXRjaDsKICAgICAgICAgIGxldCBtYXRjaDIgPSBzdHJpbmdTaW1pbGFyaXR5LmZpbmRCZXN0TWF0Y2goCiAgICAgICAgICAgIFN0cmluZyhzdHJlYW0uc3RyZWFtX3R2Z19pZCksCiAgICAgICAgICAgIGNoYW5uZWxJZHMKICAgICAgICAgICkuYmVzdE1hdGNoOwogICAgICAgICAgbGV0IG1hdGNoMyA9IHN0cmluZ1NpbWlsYXJpdHkuZmluZEJlc3RNYXRjaCgKICAgICAgICAgICAgU3RyaW5nKHN0cmVhbS5zdHJlYW1fdHZnX25hbWUpLnJlcGxhY2UoLyBoZCR8IGZoZCR8IGhldmMkfCBoMjY1JHwvaSwgIiIpLAogICAgICAgICAgICBjaGFubmVsTmFtZXMKICAgICAgICAgICkuYmVzdE1hdGNoOwogICAgICAgICAgaWYgKG1hdGNoMi5yYXRpbmcgPj0gMC43NSkgewogICAgICAgICAgICBjaGFuZ2VkID0gdHJ1ZTsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfaWQgPSBtYXRjaDIudGFyZ2V0OwogICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgfSBlbHNlIGlmIChtYXRjaDEucmF0aW5nID49IDAuNzUpIHsKICAgICAgICAgICAgY2hhbmdlZCA9IHRydWU7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX2lkID0gdGhpcy5hc3NpZ25UVkdJRC5jaGFubmVscy5maW5kKGNoYW5uZWwgPT4gY2hhbm5lbC50dmdfbmFtZSA9PT0gbWF0Y2gxLnRhcmdldCkudHZnX2lkOwogICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgfSBlbHNlIGlmIChtYXRjaDMucmF0aW5nID49IDAuNzUpIHsKICAgICAgICAgICAgY2hhbmdlZCA9IHRydWU7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX2lkID0gdGhpcy5hc3NpZ25UVkdJRC5jaGFubmVscy5maW5kKGNoYW5uZWwgPT4gY2hhbm5lbC50dmdfbmFtZSA9PT0gbWF0Y2gxLnRhcmdldCkudHZnX2lkOwogICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY2hhbmdlZCA9IHRydWU7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX2lkID0gIiI7CiAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gY2hhbmdlZDsKICAgICAgfQogICAgICB0aGlzLmFzc2lnblRWR0lELm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBsb2FkVFZHSURGaW5kKGNvdW50cnkpIHsKICAgICAgdGhpcy5maW5kVFZHSUQuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAuZ2V0KGBlZGl0b3IvdHYtZ3VpZGUvJHtjb3VudHJ5fWApCiAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgdGhpcy5maW5kVFZHSUQuY2hhbm5lbCA9ICIiOwogICAgICAgICAgdGhpcy5maW5kVFZHSUQuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB0aGlzLmZpbmRUVkdJRC5jaGFubmVscyA9IHJlcy5kYXRhLm1hcCgoY2hhbm5lbCkgPT4gewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIHRleHQ6IGNoYW5uZWwudHZnX25hbWUsCiAgICAgICAgICAgICAgdmFsdWU6IGNoYW5uZWwudHZnX2lkLAogICAgICAgICAgICB9OwogICAgICAgICAgfSk7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgdGhpcy5maW5kVFZHSUQuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgfSk7CiAgICB9LAogICAgZmluZFRWR0lETW9kYWwoc2hvdywgc2F2ZSA9IGZhbHNlKSB7CiAgICAgIGxldCBzZWxlY3RlZCA9IHRoaXMuZ2V0U3RyZWFtV2l0aElkKHRoaXMuYWN0aXZlU3RyZWFtc1swXSk7CiAgICAgIGlmIChzaG93KSB7CiAgICAgICAgdGhpcy5maW5kVFZHSUQuY2hhbm5lbCA9ICIiOwogICAgICAgIHRoaXMuZmluZFRWR0lELnRpdGxlID0gc2VsZWN0ZWQuc3RyZWFtX3R2Z19uYW1lOwogICAgICB9CiAgICAgIHRoaXMuZmluZFRWR0lELnNlYXJjaCA9ICIiOwogICAgICBpZiAoc2F2ZSkgewogICAgICAgIGlmIChzZWxlY3RlZCkgewogICAgICAgICAgc2VsZWN0ZWQuc3RyZWFtX3R2Z19pZCA9IHRoaXMuZmluZFRWR0lELmNoYW5uZWw7CiAgICAgICAgICBzZWxlY3RlZC5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLmZpbmRUVkdJRC5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgaW1wb3J0TTNVTW9kYWwoc2hvdywgc2F2ZSA9IGZhbHNlKSB7CiAgICAgIGlmIChzaG93KSB7CiAgICAgICAgdGhpcy5pbXBvcnRNM1UuZmlsZSA9IG51bGw7CiAgICAgICAgdGhpcy5pbXBvcnRNM1UubTN1ID0gbnVsbDsKICAgICAgICB0aGlzLmltcG9ydE0zVS5ncm91cHMgPSBbXTsKICAgICAgICB0aGlzLmltcG9ydE0zVS5pbXBvcnRHcm91cHMgPSBbXTsKICAgICAgfQogICAgICBpZiAoc2F2ZSkgewogICAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgICBsZXQgZ3JvdXBJbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleCgoZ3JvdXApID0+IHsKICAgICAgICAgIHJldHVybiBncm91cC5pZCA9PSB0aGlzLmFjdGl2ZUdyb3VwOwogICAgICAgIH0pOwogICAgICAgIGh0dHBTZXJ2aWNlCiAgICAgICAgICAucG9zdCgiZWRpdG9yL2ltcG9ydCIsIHsKICAgICAgICAgICAgcGxheWxpc3RfaWQ6IHRoaXMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICAgIGltcG9ydDogdGhpcy5pbXBvcnRNM1UuZ3JvdXBzLmZpbHRlcigoZ3JvdXAsIGluZGV4KSA9PiB0aGlzLmltcG9ydE0zVS5pbXBvcnRHcm91cHMuaW5jbHVkZXMoaW5kZXgpKQogICAgICAgICAgfSkKICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKHJlcy5zdGF0dXMpIHsKICAgICAgICAgICAgICB0aGlzLmxvYWRQbGF5bGlzdCh0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLCBncm91cEluZGV4KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSkKICAgICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB9KTsKICAgICAgfQogICAgICB0aGlzLmltcG9ydE0zVS5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgdXBsb2FkTTNVKGV2ZW50KSB7CiAgICAgIGNvbnN0IGlucHV0ID0gZXZlbnQudGFyZ2V0OwogICAgICBpZiAoImZpbGVzIiBpbiBpbnB1dCAmJiBpbnB1dC5maWxlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgdGhpcy5pbXBvcnRNM1UuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgICB0aGlzLnJlYWRGaWxlQ29udGVudChpbnB1dC5maWxlc1swXSkKICAgICAgICAgIC50aGVuKChjb250ZW50KSA9PiB7CiAgICAgICAgICAgIHRoaXMuaW1wb3J0TTNVLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLnBhcnNlTTNVKGNvbnRlbnQpOwogICAgICAgICAgfSkKICAgICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHsKICAgICAgICAgICAgdGhpcy4kbm90aWZ5KAogICAgICAgICAgICAgICJlcnJvciIsCiAgICAgICAgICAgICAgdGhpcy4kdCgicHJvZmlsZS5mYWlsZWQiKSwKICAgICAgICAgICAgICBlcnJvciwKICAgICAgICAgICAgICAibGEtdXNlci1zaGllbGQiLAogICAgICAgICAgICAgIHsgZHVyYXRpb246IDUwMDAsIHBlcm1hbmVudDogZmFsc2UgfQogICAgICAgICAgICApOwogICAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBwYXJzZU0zVShjb250ZW50KSB7CiAgICAgIGxldCB2bSA9IHRoaXM7CiAgICAgIHZtLmltcG9ydE0zVS5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBtM3UKICAgICAgICAucGFyc2UoCiAgICAgICAgICBjb250ZW50LAogICAgICAgICAgeyB0YWc6ICJuYW1lIiwgdHlwZTogWyJNb3ZpZSIsICJTZXJpZXMiLCAiVk9EIiwgIkxpdmUiXSB9LAogICAgICAgICAgdHJ1ZQogICAgICAgICkKICAgICAgICAudGhlbigocGxheWxpc3QpID0+IHsKICAgICAgICAgIHRoaXMuaW1wb3J0TTNVLm0zdSA9IHBsYXlsaXN0OwogICAgICAgICAgdGhpcy5pbXBvcnRNM1UuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB0aGlzLmltcG9ydE0zVS5ncm91cHMgPSBwbGF5bGlzdC5ncm91cHM7CiAgICAgICAgICB0aGlzLmltcG9ydE0zVS5pbXBvcnRHcm91cHMgPSBbXTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHsKICAgICAgICAgIHZtLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgdm0uJG5vdGlmeSgKICAgICAgICAgICAgImVycm9yIiwKICAgICAgICAgICAgdm0uJHQoInByb2ZpbGUuZmFpbGVkIiksCiAgICAgICAgICAgIGVycm9yLAogICAgICAgICAgICAibGEtdXNlci1zaGllbGQiLAogICAgICAgICAgICB7IGR1cmF0aW9uOiA1MDAwLCBwZXJtYW5lbnQ6IGZhbHNlIH0KICAgICAgICAgICk7CiAgICAgICAgfSk7CiAgICB9LAogICAgcmVhZEZpbGVDb250ZW50KGZpbGUpIHsKICAgICAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgICAgICByZWFkZXIub25sb2FkID0gKGV2ZW50KSA9PiByZXNvbHZlKGV2ZW50LnRhcmdldC5yZXN1bHQpOwogICAgICAgIHJlYWRlci5vbmVycm9yID0gKGVycm9yKSA9PiByZWplY3QoZXJyb3IpOwogICAgICAgIHJlYWRlci5yZWFkQXNUZXh0KGZpbGUpOwogICAgICB9KTsKICAgIH0sCiAgfSwKICBiZWZvcmVNb3VudCgpIHsKICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmFkZCgicmlnaHQtbWVudSIpOwogICAgRXZlbnRCdXMuJG9uKCJzZWFyY2giLCB0aGlzLnNlYXJjaEVkaXRvcik7CiAgICBFdmVudEJ1cy4kb24oInByaW50IiwgdGhpcy5wcmludEVkaXRvcik7CiAgICBFdmVudEJ1cy4kb24oInRhYi1jaGFuZ2UiLCB0aGlzLmRvVGFiQ2hhbmdlKTsKICAgIEV2ZW50QnVzLiRvbigic2F2ZSIsIHRoaXMuZG9TYXZlKTsKICAgIEV2ZW50QnVzLiRvbigiY2FuY2VsIiwgdGhpcy5kb0NhbmNlbCk7CiAgICBpZiAodGhpcy5tb3ZpZVNlcmllUGxheWxpc3QpIHsKICAgICAgdGhpcy5sb2FkUGxheWxpc3QodGhpcy5tb3ZpZVNlcmllUGxheWxpc3QpOwogICAgfQogICAgdGhpcy5sb2FkTG9nb0NvdW50cmllcygpOwogICAgdGhpcy5sb2FkVFZHSURDb3VudHJpZXMoKTsKICB9LAogIGJlZm9yZURlc3Ryb3koKSB7CiAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5yZW1vdmUoInJpZ2h0LW1lbnUiKTsKICAgIEV2ZW50QnVzLiRvZmYoInNlYXJjaCIsIHRoaXMuc2VhcmNoRWRpdG9yKTsKICAgIEV2ZW50QnVzLiRvZmYoInByaW50IiwgdGhpcy5wcmludEVkaXRvcik7CiAgICBFdmVudEJ1cy4kb2ZmKCJ0YWItY2hhbmdlIiwgdGhpcy5kb1RhYkNoYW5nZSk7CiAgICBFdmVudEJ1cy4kb2ZmKCJzYXZlIiwgdGhpcy5kb1NhdmUpOwogICAgRXZlbnRCdXMuJG9mZigiY2FuY2VsIiwgdGhpcy5kb0NhbmNlbCk7CiAgfSwKICB3YXRjaDogewogICAgZHJhZ1N0cmVhbTogZnVuY3Rpb24gKHZhbCkgewogICAgICBpZiAoIXZhbCkgewogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICAgIH0KICAgIH0sCiAgICBkcmFnR3JvdXA6IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgaWYgKCF2YWwpIHsKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgICB9CiAgICB9LAogICAgYWN0aXZlR3JvdXA6IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgaWYgKHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCkgewogICAgICAgIHRoaXMuc2F2ZUNoYW5nZXNNb2RhbCh0cnVlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmxvYWRTdHJlYW1zKCk7CiAgICAgIH0KICAgIH0sCiAgICAicGxheWxpc3RFZGl0b3IuY2hhbmdlZCI6IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgRXZlbnRCdXMuJGVtaXQoImVkaXRvci1jaGFuZ2VzIiwgdmFsKTsKICAgIH0sCiAgICAicmFkaW9Ccm93c2VyLnNlYXJjaCI6IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgbGV0IHZtID0gdGhpczsKICAgICAgY2xlYXJUaW1lb3V0KHRoaXMucmFkaW9Ccm93c2VyLmJvdW5jZSk7CiAgICAgIHRoaXMucmFkaW9Ccm93c2VyLmJvdW5jZSA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgIHZtLmZpbmRSYWRpb2Jyb3dzZXIodmFsKTsKICAgICAgfSwgNTAwKTsKICAgIH0sCiAgICAic291bmRjbG91ZC51cmwiOiBmdW5jdGlvbiAodmFsKSB7CiAgICAgIGxldCB2bSA9IHRoaXM7CiAgICAgIGNsZWFyVGltZW91dCh0aGlzLnJhZGlvQnJvd3Nlci5ib3VuY2UpOwogICAgICB0aGlzLnJhZGlvQnJvd3Nlci5ib3VuY2UgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICB2bS5nZXRTb3VuZGNsb3VkVHJhY2sodmFsLCB2bS5zb3VuZGNsb3VkQ2xpZW50SWQpOwogICAgICB9LCA1MDApOwogICAgfSwKICAgICJ5b3V0dWJlLnVybCI6IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgaWYgKCF2YWwubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmICgveW91dHVcLj9iZS9pLnRlc3QodmFsKSkgewogICAgICAgIHZhciBpOwogICAgICAgIHZhciBwYXR0ZXJucyA9IFsKICAgICAgICAgIC95b3V0dVwuYmVcLyhbXiMmP117MTF9KS8sIC8vIHlvdXR1LmJlLzxpZD4KICAgICAgICAgIC9cP3Y9KFteIyY/XXsxMX0pLywgLy8gP3Y9PGlkPgogICAgICAgICAgLyZ2PShbXiMmP117MTF9KS8sIC8vICZ2PTxpZD4KICAgICAgICAgIC9lbWJlZFwvKFteIyY/XXsxMX0pLywgLy8gZW1iZWQvPGlkPgogICAgICAgICAgL1wvdlwvKFteIyY/XXsxMX0pLywgLy8gL3YvPGlkPgogICAgICAgIF07CgogICAgICAgIGZvciAoaSA9IDA7IGkgPCBwYXR0ZXJucy5sZW5ndGg7ICsraSkgewogICAgICAgICAgaWYgKHBhdHRlcm5zW2ldLnRlc3QodmFsKSkgewogICAgICAgICAgICB0aGlzLnlvdXR1YmUudmlkZW9JZCA9IHBhdHRlcm5zW2ldLmV4ZWModmFsKVsxXTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdmFyIHRva2VucyA9IHZhbC5zcGxpdCgvWy8mPz0jLlxzXS9nKTsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdG9rZW5zLmxlbmd0aDsgKytpKSB7CiAgICAgICAgICBpZiAoL15bXiMmP117MTF9JC8udGVzdCh0b2tlbnNbaV0pKSB7CiAgICAgICAgICAgIHRoaXMueW91dHViZS52aWRlb0lkID0gdG9rZW5zW2ldOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB0aGlzLnlvdXR1YmUudmlkZW9JZCA9ICIiOwogICAgICB9IGVsc2UgewogICAgICAgIHRyeSB7CiAgICAgICAgICB2YXIgdXJscCA9IG5ldyBVUkwodmFsKTsKICAgICAgICAgIHRoaXMueW91dHViZS52aWRlb0lkID0gdXJscC5zZWFyY2hQYXJhbXMuZ2V0KCJ2Iik7CiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgIHRoaXMueW91dHViZS52aWRlb0lkID0gIiI7CiAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgInlvdXR1YmUudmlkZW9JZCI6IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgbGV0IHZtID0gdGhpczsKICAgICAgY2xlYXJUaW1lb3V0KHRoaXMueW91dHViZS5ib3VuY2UpOwogICAgICB0aGlzLnlvdXR1YmUuYm91bmNlID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKHZhbC5sZW5ndGgpIHsKICAgICAgICAgIHZtLmdldFlvdXR1YmVQYWdlKHZhbCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZtLnlvdXR1YmUudmlkZW8gPSBudWxsOwogICAgICAgIH0KICAgICAgfSwgNTAwKTsKICAgIH0sCiAgICAidmltZW8udXJsIjogZnVuY3Rpb24gKHZhbCkgewogICAgICBpZiAoL3ZpbWVvXC5jb20vaS50ZXN0KHZhbCkpIHsKICAgICAgICBsZXQgbWF0Y2ggPSB2YWwubWF0Y2goCiAgICAgICAgICAvKD86d3d3XC58cGxheWVyXC4pP3ZpbWVvLmNvbVwvKD86Y2hhbm5lbHNcLyg/Olx3K1wvKT98Z3JvdXBzXC8oPzpbXi9dKilcL3ZpZGVvc1wvfGFsYnVtXC8oPzpcZCspXC92aWRlb1wvfHZpZGVvXC98KShcZCspKD86W2EtekEtWjAtOV8tXSspPy9pCiAgICAgICAgKTsKICAgICAgICBpZiAobWF0Y2gubGVuZ3RoID49IDIpIHsKICAgICAgICAgIHRoaXMudmltZW8udmlkZW9JZCA9IG1hdGNoWzFdOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLnZpbWVvLnZpZGVvSWQgPSAiIjsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy52aW1lby52aWRlb0lkID0gIiI7CiAgICAgIH0KICAgIH0sCiAgICAidmltZW8udmlkZW9JZCI6IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgbGV0IHZtID0gdGhpczsKICAgICAgY2xlYXJUaW1lb3V0KHRoaXMudmltZW8uYm91bmNlKTsKICAgICAgdGhpcy52aW1lby5ib3VuY2UgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAodmFsLmxlbmd0aCkgewogICAgICAgICAgdm0uZ2V0VmltZW9Db25maWcodmFsKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdm0udmltZW8udmlkZW8gPSBudWxsOwogICAgICAgIH0KICAgICAgfSwgNTAwKTsKICAgIH0sCiAgICAiZGFpbHltb3Rpb24udXJsIjogZnVuY3Rpb24gKHZhbCkgewogICAgICBpZiAoL2RhaWx5bW90aW9uXC5jb20vaS50ZXN0KHZhbCkpIHsKICAgICAgICBsZXQgbWF0Y2ggPSB2YWwubWF0Y2goCiAgICAgICAgICAvXi4rZGFpbHltb3Rpb24uY29tXC8odmlkZW98aHViKVwvKFteX10rKVteI10qKCN2aWRlbz0oW15fJl0rKSk/L2kKICAgICAgICApOwogICAgICAgIGlmIChtYXRjaC5sZW5ndGggPj0gNCAmJiBtYXRjaFs0XSkgewogICAgICAgICAgdGhpcy5kYWlseW1vdGlvbi52aWRlb0lkID0gbWF0Y2hbNF07CiAgICAgICAgfSBlbHNlIGlmIChtYXRjaC5sZW5ndGggPj0gMikgewogICAgICAgICAgdGhpcy5kYWlseW1vdGlvbi52aWRlb0lkID0gbWF0Y2hbMl07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuZGFpbHltb3Rpb24udmlkZW9JZCA9ICIiOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmRhaWx5bW90aW9uLnZpZGVvSWQgPSAiIjsKICAgICAgfQogICAgfSwKICAgICJkYWlseW1vdGlvbi52aWRlb0lkIjogZnVuY3Rpb24gKHZhbCkgewogICAgICBsZXQgdm0gPSB0aGlzOwogICAgICBjbGVhclRpbWVvdXQodGhpcy5kYWlseW1vdGlvbi5ib3VuY2UpOwogICAgICB0aGlzLmRhaWx5bW90aW9uLmJvdW5jZSA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgIGlmICh2YWwubGVuZ3RoKSB7CiAgICAgICAgICB2bS5nZXREYWlseW1vdGlvbkNvbmZpZyh2YWwpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2bS5kYWlseW1vdGlvbi52aWRlbyA9IG51bGw7CiAgICAgICAgfQogICAgICB9LCA1MDApOwogICAgfSwKICAgICJ0ZWRUYWxrcy51cmwiOiBmdW5jdGlvbiAodmFsKSB7CiAgICAgIGlmICgvdGVkXC5jb21cL3RhbGtzL2kudGVzdCh2YWwpKSB7CiAgICAgICAgbGV0IHZtID0gdGhpczsKICAgICAgICBjbGVhclRpbWVvdXQodGhpcy50ZWRUYWxrcy5ib3VuY2UpOwogICAgICAgIHRoaXMudGVkVGFsa3MuYm91bmNlID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBpZiAodmFsLmxlbmd0aCkgewogICAgICAgICAgICB2bS5nZXRUZWRUYWxrc0NvbmZpZyh2YWwpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdm0udGVkVGFsa3MudmlkZW8gPSBudWxsOwogICAgICAgICAgfQogICAgICAgIH0sIDUwMCk7CiAgICAgIH0KICAgIH0sCiAgICAieGhhbXN0ZXIudXJsIjogZnVuY3Rpb24gKHZhbCkgewogICAgICBsZXQgdm0gPSB0aGlzOwogICAgICBpZiAoL3hoYW1zdGVyXC5jb21cL3ZpZGVvcy9pLnRlc3QodmFsKSkgewogICAgICAgIGNsZWFyVGltZW91dCh0aGlzLnhoYW1zdGVyQm91bmNlKTsKICAgICAgICB0aGlzLnhoYW1zdGVyQm91bmNlID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBpZiAodmFsLmxlbmd0aCkgewogICAgICAgICAgICB2bS5nZXRYaGFtc3RlckNvbmZpZyh2YWwpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdm0ueGhhbXN0ZXIudmlkZW8gPSBudWxsOwogICAgICAgICAgfQogICAgICAgIH0sIDUwMCk7CiAgICAgIH0KICAgIH0sCiAgICAiZmluZExvZ28uY291bnRyeSI6IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgaWYgKHZhbC5sZW5ndGgpIHsKICAgICAgICB0aGlzLmxvYWRMb2dvc0ZpbmQodmFsKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmZpbmRMb2dvLmxvZ28gPSAiIjsKICAgICAgfQogICAgfSwKICAgICJhc3NpZ25Mb2dvLmNvdW50cnkiOiBmdW5jdGlvbiAodmFsKSB7CiAgICAgIGlmICh2YWwubGVuZ3RoKSB7CiAgICAgICAgdGhpcy5sb2FkTG9nb3NBc3NpZ24odmFsKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmFzc2lnbkxvZ28ubG9nbyA9ICIiOwogICAgICB9CiAgICB9LAogICAgImZpbmRUVkdJRC5jb3VudHJ5IjogZnVuY3Rpb24gKHZhbCkgewogICAgICBpZiAodmFsLmxlbmd0aCkgewogICAgICAgIHRoaXMubG9hZFRWR0lERmluZCh2YWwpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZmluZFRWR0lELmNoYW5uZWwgPSAiIjsKICAgICAgfQogICAgfSwKICAgICJhc3NpZ25UVkdJRC5jb3VudHJ5IjogZnVuY3Rpb24gKHZhbCkgewogICAgICBpZiAodmFsLmxlbmd0aCkgewogICAgICAgIHRoaXMubG9hZFRWR0lEQXNzaWduKHZhbCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5hc3NpZ25UVkdJRC5jaGFubmVscyA9IFtdOwogICAgICB9CiAgICB9LAogICAgbW92aWVTZXJpZVBsYXlsaXN0OiBmdW5jdGlvbiAodmFsKSB7CiAgICAgIHRoaXMubG9hZFBsYXlsaXN0KHZhbCk7CiAgICB9CiAgfSwKfTsK"},null]}