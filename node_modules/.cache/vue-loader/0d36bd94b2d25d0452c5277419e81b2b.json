{"remainingRequest":"/home/ernst/Desktop/IPTV-Tools/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/ernst/Desktop/IPTV-Tools/src/views/app/user/invoice.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/ernst/Desktop/IPTV-Tools/src/views/app/user/invoice.vue","mtime":1619374606221},{"path":"/home/ernst/Desktop/IPTV-Tools/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/ernst/Desktop/IPTV-Tools/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/ernst/Desktop/IPTV-Tools/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/ernst/Desktop/IPTV-Tools/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/ernst/Desktop/IPTV-Tools/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IG1hcEdldHRlcnMgfSBmcm9tICJ2dWV4IjsKaW1wb3J0IHsgaHR0cFNlcnZpY2UgfSBmcm9tICIuLi8uLi8uLi9zZXJ2aWNlcy9odHRwIjsKaW1wb3J0IHsgRXZlbnRCdXMgfSBmcm9tICIuLi8uLi8uLi9zZXJ2aWNlcy9lYnVzIjsKCmV4cG9ydCBkZWZhdWx0IHsKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgaW52b2ljZU1vZGFsOiBmYWxzZSwKICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgaW52b2ljZXM6IFtdLAogICAgICBzZWxlY3RlZDogW10sCiAgICB9OwogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIC4uLm1hcEdldHRlcnMoWyJjdXJyZW50VXNlciJdKSwKICAgIHJlY2lwaWVudCgpIHsKICAgICAgbGV0IHByb2ZpbGUgPSB0aGlzLmN1cnJlbnRVc2VyLnByb2ZpbGUKICAgICAgICA/IHRoaXMuY3VycmVudFVzZXIucHJvZmlsZQogICAgICAgIDogewogICAgICAgICAgICBmaXJzdF9uYW1lOiAiIiwKICAgICAgICAgICAgbGFzdF9uYW1lOiAiIiwKICAgICAgICAgICAgYWRkcmVzczogIiIsCiAgICAgICAgICAgIHppcGNvZGU6ICIiLAogICAgICAgICAgICBjaXR5OiAiIiwKICAgICAgICAgICAgY291bnRyeTogIiIsCiAgICAgICAgICAgIGVtYWlsOiAiIiwKICAgICAgICAgICAgcGhvbmU6ICIiLAogICAgICAgICAgfTsKICAgICAgcmV0dXJuIFsKICAgICAgICBgJHtwcm9maWxlLm5hbWVfZmlyc3R9ICR7cHJvZmlsZS5uYW1lX2xhc3R9YCwKICAgICAgICBgJHtwcm9maWxlLmFkZHJlc3N9ICR7cHJvZmlsZS56aXBjb2RlfSAke3Byb2ZpbGUuY2l0eX0sICR7cHJvZmlsZS5jb3VudHJ5fWAsCiAgICAgIF07CiAgICB9LAogIH0sCiAgbWV0aG9kczogewogICAgc2hvd01vZGFsKCkgewogICAgICB0aGlzLmludm9pY2VNb2RhbCA9IHRydWU7CiAgICB9LAogICAgY2xvc2VNb2RhbCgpIHsKICAgICAgdGhpcy5pbnZvaWNlTW9kYWwgPSBmYWxzZTsKICAgIH0sCiAgICBpbnZvaWNlQ29udGV4dChpZCkgewogICAgICByZXR1cm4gWwogICAgICAgIHsKICAgICAgICAgIHRleHQ6IHRoaXMuJHQoInN1YnNjcmlwdGlvbnMucHJpbnQtaW52b2ljZSIpLAogICAgICAgICAgaWNvbjogImxhLXByaW50IiwKICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGludm9pY2UtJHtpZH1gKS5wcmludCgpOwogICAgICAgICAgfSwKICAgICAgICB9LAogICAgICBdOwogICAgfSwKICAgIGxvYWRJbnZvaWNlcygpIHsKICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAuZ2V0KCJ1c2Vycy9pbnZvaWNlcyIpCiAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIGlmIChyZXMuc3RhdHVzID09PSB0cnVlKSB7CiAgICAgICAgICAgIHRoaXMuaW52b2ljZXMgPSByZXMuZGF0YTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgdGhpcy4kbm90aWZ5KAogICAgICAgICAgICAiZXJyb3IiLAogICAgICAgICAgICB0aGlzLiR0KCJwcm9maWxlLmZhaWxlZCIpLAogICAgICAgICAgICB0aGlzLiR0KCJzdWJzY3JpcHRpb25zLmludm9pY2UtZXJyb3IiKSwKICAgICAgICAgICAgImxhLXVzZXItc2hpZWxkIiwKICAgICAgICAgICAgeyBkdXJhdGlvbjogNTAwMCwgcGVybWFuZW50OiBmYWxzZSB9CiAgICAgICAgICApOwogICAgICAgIH0pOwogICAgfSwKICAgIGZvcm1hdERhdGUoZGF0ZSkgewogICAgICByZXR1cm4gZGF0ZS50b0xvY2FsZURhdGVTdHJpbmcodGhpcy4kdCgiZGF0ZS5sb2NhbGUiKSwgdGhpcy5kYXRlT3B0aW9ucyk7CiAgICB9LAogICAgcGFnZVByaW50KCkgewogICAgICB0aGlzLmNsb3NlTW9kYWwoKTsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmludm9pY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWQuaW5jbHVkZXMoaSkpIHsKICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBpbnZvaWNlLSR7dGhpcy5pbnZvaWNlc1tpXS5pZH1gKS5wcmludCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHNlYXJjaEluSXRlbXMoaXRlbXMsIHNlYXJjaCkgewogICAgICBsZXQgZm91bmQgPSBmYWxzZTsKICAgICAgbGV0IHJlID0gbmV3IFJlZ0V4cChzZWFyY2gsICJpIik7CiAgICAgIGl0ZW1zLm1hcCgoaXRlbSkgPT4gewogICAgICAgIGlmIChpdGVtLmRlc2NyaXB0aW9uLm1hdGNoKHJlKSkgewogICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHJldHVybiBmb3VuZDsKICAgIH0sCiAgICBzZWFyY2hJbnZvaWNlKHNlYXJjaCkgewogICAgICBpZiAoc2VhcmNoID09PSB1bmRlZmluZWQgfHwgc2VhcmNoID09PSBudWxsIHx8IHNlYXJjaC5sZW5ndGggPT09IDApIHsKICAgICAgICB0aGlzLmxvYWRJbnZvaWNlcygpOwogICAgICB9IGVsc2UgewogICAgICAgIGh0dHBTZXJ2aWNlCiAgICAgICAgICAuZ2V0KCJ1c2Vycy9pbnZvaWNlcyIpCiAgICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgIGlmIChyZXMuc3RhdHVzID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgdGhpcy5pbnZvaWNlcyA9IHJlcy5kYXRhLmZpbHRlcigoaW52KSA9PiB7CiAgICAgICAgICAgICAgICB2YXIgcmUgPSBuZXcgUmVnRXhwKHNlYXJjaCwgImkiKTsKICAgICAgICAgICAgICAgIHZhciBmb3VuZEluVGl0bGUgPSBpbnYubm90ZS5tYXRjaChyZSk7CiAgICAgICAgICAgICAgICB2YXIgZm91bmRJbkl0ZW1zID0gdGhpcy5zZWFyY2hJbkl0ZW1zKGludi5pdGVtcywgc2VhcmNoKTsKICAgICAgICAgICAgICAgIHJldHVybiBmb3VuZEluVGl0bGUgfHwgZm91bmRJbkl0ZW1zOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgICAgdGhpcy5pbnZvaWNlcyA9IFtdOwogICAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgfSwKICBiZWZvcmVNb3VudCgpIHsKICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTsKICAgIHRoaXMubG9hZEludm9pY2VzKCk7CiAgICBFdmVudEJ1cy4kb24oInByaW50IiwgdGhpcy5zaG93TW9kYWwpOwogICAgRXZlbnRCdXMuJG9uKCJzZWFyY2giLCB0aGlzLnNlYXJjaEludm9pY2UpOwogIH0sCiAgYmVmb3JlRGVzdHJveSgpIHsKICAgIEV2ZW50QnVzLiRvZmYoInByaW50IiwgdGhpcy5zaG93TW9kYWwpOwogICAgRXZlbnRCdXMuJG9mZigic2VhcmNoIiwgdGhpcy5zZWFyY2hJbnZvaWNlKTsKICB9LAp9Owo="},{"version":3,"sources":["invoice.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"invoice.vue","sourceRoot":"src/views/app/user","sourcesContent":["<template>\n  <erd-row class=\"erd-report m-0 px-0 py-3\">\n    <erd-modal\n      v-show=\"invoiceModal\"\n      @close=\"closeModal\"\n      :title=\"$t('subscriptions.print-invoices')\"\n      class=\"select-none\"\n    >\n      <p class=\"text-one mx-2\">{{ $t(\"subscriptions.select-invoices\") }}</p>\n      <perfect-scrollbar\n        class=\"modal-list\"\n        :options=\"{ wheelPropagation: false }\"\n      >\n        <erd-checkbox\n          v-for=\"(invoice, index) in invoices\"\n          :key=\"`print-${index}-${invoice.id}`\"\n          v-model=\"selected\"\n          :value=\"index\"\n          ># {{ invoice.id }} ({{\n            formatDate(new Date(invoice.invoice_date))\n          }})</erd-checkbox\n        >\n      </perfect-scrollbar>\n      <template v-slot:footer>\n        <erd-button\n          variant=\"primary\"\n          class=\"mr-1\"\n          icon=\"la-print\"\n          @click=\"pagePrint\"\n          >{{ $t(\"general.ok\") }}</erd-button\n        >\n        <erd-button variant=\"danger\" @click=\"closeModal\">{{\n          $t(\"general.cancel\")\n        }}</erd-button>\n      </template>\n    </erd-modal>\n    <erd-spinner v-if=\"isLoading\" size=\"lg\" overlay absolute></erd-spinner>\n    <erd-col\n      flex\n      center\n      v-if=\"invoices.length === 0\"\n      class=\"text-muted select-none\"\n    >\n      <div class=\"text-center\">\n        <h5 class=\"mb-1\">{{ $t(\"subscriptions.no-invoices\") }}</h5>\n        <i class=\"las la-receipt la-4x d-block\"></i>\n      </div>\n    </erd-col>\n    <erd-col\n      flex\n      center\n      v-for=\"(invoice, index) in invoices\"\n      :key=\"`invoice-${index}-${invoice.id}`\"\n    >\n      <erd-report\n        :id=\"`invoice-${invoice.id}`\"\n        :number=\"invoice.id\"\n        :recipient=\"recipient\"\n        :items=\"invoice.items\"\n        :date=\"new Date(invoice.invoice_date)\"\n        :context-items=\"invoiceContext(invoice.id)\"\n      ></erd-report>\n    </erd-col>\n  </erd-row>\n</template>\n\n<script>\nimport { mapGetters } from \"vuex\";\nimport { httpService } from \"../../../services/http\";\nimport { EventBus } from \"../../../services/ebus\";\n\nexport default {\n  data() {\n    return {\n      invoiceModal: false,\n      isLoading: false,\n      invoices: [],\n      selected: [],\n    };\n  },\n  computed: {\n    ...mapGetters([\"currentUser\"]),\n    recipient() {\n      let profile = this.currentUser.profile\n        ? this.currentUser.profile\n        : {\n            first_name: \"\",\n            last_name: \"\",\n            address: \"\",\n            zipcode: \"\",\n            city: \"\",\n            country: \"\",\n            email: \"\",\n            phone: \"\",\n          };\n      return [\n        `${profile.name_first} ${profile.name_last}`,\n        `${profile.address} ${profile.zipcode} ${profile.city}, ${profile.country}`,\n      ];\n    },\n  },\n  methods: {\n    showModal() {\n      this.invoiceModal = true;\n    },\n    closeModal() {\n      this.invoiceModal = false;\n    },\n    invoiceContext(id) {\n      return [\n        {\n          text: this.$t(\"subscriptions.print-invoice\"),\n          icon: \"la-print\",\n          onClick: function () {\n            document.getElementById(`invoice-${id}`).print();\n          },\n        },\n      ];\n    },\n    loadInvoices() {\n      httpService\n        .get(\"users/invoices\")\n        .then((res) => {\n          this.isLoading = false;\n          if (res.status === true) {\n            this.invoices = res.data;\n          }\n        })\n        .catch(() => {\n          this.isLoading = false;\n          this.$notify(\n            \"error\",\n            this.$t(\"profile.failed\"),\n            this.$t(\"subscriptions.invoice-error\"),\n            \"la-user-shield\",\n            { duration: 5000, permanent: false }\n          );\n        });\n    },\n    formatDate(date) {\n      return date.toLocaleDateString(this.$t(\"date.locale\"), this.dateOptions);\n    },\n    pagePrint() {\n      this.closeModal();\n      for (var i = 0; i < this.invoices.length; i++) {\n        if (this.selected.includes(i)) {\n          document.getElementById(`invoice-${this.invoices[i].id}`).print();\n        }\n      }\n    },\n    searchInItems(items, search) {\n      let found = false;\n      let re = new RegExp(search, \"i\");\n      items.map((item) => {\n        if (item.description.match(re)) {\n          found = true;\n        }\n      });\n      return found;\n    },\n    searchInvoice(search) {\n      if (search === undefined || search === null || search.length === 0) {\n        this.loadInvoices();\n      } else {\n        httpService\n          .get(\"users/invoices\")\n          .then((res) => {\n            this.isLoading = false;\n            if (res.status === true) {\n              this.invoices = res.data.filter((inv) => {\n                var re = new RegExp(search, \"i\");\n                var foundInTitle = inv.note.match(re);\n                var foundInItems = this.searchInItems(inv.items, search);\n                return foundInTitle || foundInItems;\n              });\n            }\n          })\n          .catch(() => {\n            this.invoices = [];\n          });\n      }\n    },\n  },\n  beforeMount() {\n    this.isLoading = true;\n    this.loadInvoices();\n    EventBus.$on(\"print\", this.showModal);\n    EventBus.$on(\"search\", this.searchInvoice);\n  },\n  beforeDestroy() {\n    EventBus.$off(\"print\", this.showModal);\n    EventBus.$off(\"search\", this.searchInvoice);\n  },\n};\n</script>\n\n<style scoped>\n.modal-list {\n  max-height: 200px;\n}\n</style>\n"]}]}