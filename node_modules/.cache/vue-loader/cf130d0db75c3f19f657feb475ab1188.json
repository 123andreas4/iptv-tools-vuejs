{"remainingRequest":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/vue-loader/lib/index.js??vue-loader-options!/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/src/views/app/xtream/editor.vue?vue&type=script&lang=js&","dependencies":[{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/src/views/app/xtream/editor.vue","mtime":1625401606218},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCi8qIGVzbGludC1kaXNhYmxlIHZ1ZS9uby1zaWRlLWVmZmVjdHMtaW4tY29tcHV0ZWQtcHJvcGVydGllcyAqLwovKiBlc2xpbnQtZGlzYWJsZSBuby11bnVzZWQtdmFycyAqLwovKiBlc2xpbnQtZGlzYWJsZSBuby11c2VsZXNzLWVzY2FwZSAqLwoKaW1wb3J0IHsgRXZlbnRCdXMgfSBmcm9tICIuLi8uLi8uLi9zZXJ2aWNlcy9lYnVzIjsKaW1wb3J0IHsgaHR0cFNlcnZpY2UgfSBmcm9tICIuLi8uLi8uLi9zZXJ2aWNlcy9odHRwIjsKaW1wb3J0IHsgbWFwR2V0dGVycyB9IGZyb20gInZ1ZXgiOwppbXBvcnQgZHJhZ2dhYmxlIGZyb20gInZ1ZWRyYWdnYWJsZSI7CmltcG9ydCB7IFN1YnNjcmlwdGlvblR5cGUgfSBmcm9tICIuLi8uLi8uLi9jb25zdGFudHMvY29uZmlnIjsKaW1wb3J0IHsgY291bnRyaWVzIH0gZnJvbSAiLi4vLi4vLi4vaGVscGVycyI7CmltcG9ydCB7IG0zdSB9IGZyb20gIi4uLy4uLy4uL3BsdWdpbnMvbTN1IjsKCmV4cG9ydCBkZWZhdWx0IHsKICBjb21wb25lbnRzOiB7CiAgICBkcmFnZ2FibGUsCiAgfSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgY291bnRyaWVzLAogICAgICBhY3RpdmVUYWI6IDAsCiAgICAgIGFjdGl2ZUdyb3VwOiAtMSwKICAgICAgYWN0aXZlR3JvdXBzOiBbXSwKICAgICAgYWN0aXZlU3RyZWFtOiAtMSwKICAgICAgYWN0aXZlU3RyZWFtczogW10sCiAgICAgIGRyYWdHcm91cDogZmFsc2UsCiAgICAgIGRyYWdTdHJlYW06IGZhbHNlLAogICAgICBlZGl0b3I6IGZhbHNlLAogICAgICBzZWFyY2g6IG51bGwsCiAgICAgIGlzTG9hZGluZzogZmFsc2UsCiAgICAgIHBsYXlsaXN0RWRpdG9yOiB7CiAgICAgICAgaWQ6IHVuZGVmaW5lZCwKICAgICAgICBwbGF5bGlzdDogbnVsbCwKICAgICAgICBncm91cHM6IFtdLAogICAgICAgIHN0cmVhbXM6IFtdLAogICAgICAgIGNoYW5nZWQ6IGZhbHNlLAogICAgICB9LAogICAgICBmaW5kUmVwbGFjZTogewogICAgICAgIHR5cGU6IDAsCiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIGZyb206ICIiLAogICAgICAgIHRvOiAiIiwKICAgICAgICByZXBsYWNlQWxsOiBmYWxzZSwKICAgICAgICBpZ25vcmVDYXNlOiBmYWxzZSwKICAgICAgICBzZWxlY3RlZE9ubHk6IDAsCiAgICAgIH0sCiAgICAgIHByZWZpeFN1ZmZpeDogewogICAgICAgIHR5cGU6IDAsCiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIHByZWZpeDogIiIsCiAgICAgICAgc3VmZml4OiAiIiwKICAgICAgICBzZWxlY3RlZE9ubHk6IDAsCiAgICAgIH0sCiAgICAgIGNvbnZlcnRDYXNlOiB7CiAgICAgICAgdHlwZTogMCwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgbWV0aG9kOiAwLAogICAgICAgIHNlbGVjdGVkT25seTogMCwKICAgICAgfSwKICAgICAgZ3JvdXBFZGl0b3I6IHsKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgaWQ6IDAsCiAgICAgICAgZ3JvdXBfbmFtZTogIiIsCiAgICAgICAgZ3JvdXBfcGFyZW50X2NvZGU6ICIiLAogICAgICAgIGdyb3VwX3R5cGU6IDEsCiAgICAgICAgZ3JvdXBfaXNfaGlkZGVuOiAwLAogICAgICB9LAogICAgICBzdHJlYW1FZGl0b3I6IHsKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgaWQ6IC0xLAogICAgICAgIHN0cmVhbV90dmdfbmFtZTogIiIsCiAgICAgICAgc3RyZWFtX3R2Z19pZDogIiIsCiAgICAgICAgc3RyZWFtX3R2Z19sb2dvOiAiIiwKICAgICAgICBzdHJlYW1fcGFyZW50X2NvZGU6ICIiLAogICAgICAgIHN0cmVhbV9yYWRpbzogMCwKICAgICAgICBzdHJlYW1faXNfaGlkZGVuOiAwLAogICAgICAgIHN0cmVhbV9pc19jdXN0b206IDAsCiAgICAgICAgbW92aWVfbmFtZTogIiIsCiAgICAgICAgbW92aWVfeWVhcjogIiIsCiAgICAgICAgc2VyaWVfbmFtZTogIiIsCiAgICAgICAgc2VyaWVfc2Vhc29uOiAwLAogICAgICAgIHNlcmllX2VwaXNvZGU6IDAsCiAgICAgICAgc291cmNlX3N0cmVhbV91cmw6ICIiLAogICAgICB9LAogICAgICByYWRpb0Jyb3dzZXI6IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBib3VuY2U6IG51bGwsCiAgICAgICAgYWN0aXZlOiBbXSwKICAgICAgICBzZWFyY2g6ICIiLAogICAgICAgIHJlc3VsdHM6IFtdLAogICAgICB9LAogICAgICBzb3VuZGNsb3VkOiB7CiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgYm91bmNlOiBudWxsLAogICAgICAgIHVybDogIiIsCiAgICAgICAgdHJhY2s6IG51bGwsCiAgICAgIH0sCiAgICAgIHlvdXR1YmU6IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBib3VuY2U6IG51bGwsCiAgICAgICAgdXJsOiAiIiwKICAgICAgICB2aWRlb0lkOiAiIiwKICAgICAgICB2aWRlbzogbnVsbCwKICAgICAgfSwKICAgICAgdmltZW86IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBib3VuY2U6IG51bGwsCiAgICAgICAgdXJsOiAiIiwKICAgICAgICB2aWRlb0lkOiAiIiwKICAgICAgICB2aWRlbzogbnVsbCwKICAgICAgfSwKICAgICAgZGFpbHltb3Rpb246IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBib3VuY2U6IG51bGwsCiAgICAgICAgdXJsOiAiIiwKICAgICAgICB2aWRlb0lkOiAiIiwKICAgICAgICB2aWRlbzogbnVsbCwKICAgICAgfSwKICAgICAgdGVkVGFsa3M6IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBib3VuY2U6IG51bGwsCiAgICAgICAgdXJsOiAiIiwKICAgICAgICB2aWRlbzogbnVsbCwKICAgICAgfSwKICAgICAgeGhhbXN0ZXI6IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBib3VuY2U6IG51bGwsCiAgICAgICAgdXJsOiAiIiwKICAgICAgICB2aWRlbzogbnVsbCwKICAgICAgfSwKICAgICAgZmluZExvZ286IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBjb3VudHJpZXM6IFtdLAogICAgICAgIGNvdW50cnk6ICIiLAogICAgICAgIGxvZ29zOiBbXSwKICAgICAgICBsb2dvOiAiIiwKICAgICAgICBzZWFyY2g6ICIiLAogICAgICAgIHRpdGxlOiAiIiwKICAgICAgfSwKICAgICAgYXNzaWduTG9nbzogewogICAgICAgIGlzTG9hZGluZzogZmFsc2UsCiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIGNvdW50cmllczogW10sCiAgICAgICAgY291bnRyeTogIiIsCiAgICAgICAgbG9nb3M6IFtdLAogICAgICAgIGFzc2lnbkFsbDogMCwKICAgICAgfSwKICAgICAgaW1wb3J0TTNVOiB7CiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgZ3JvdXBzOiBbXSwKICAgICAgICBpbXBvcnRHcm91cHM6IFtdLAogICAgICAgIG0zdTogbnVsbCwKICAgICAgICBmaWxlOiBudWxsLAogICAgICB9LAogICAgICBmaW5kVFZHSUQ6IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBjb3VudHJpZXM6IFtdLAogICAgICAgIGNvdW50cnk6ICIiLAogICAgICAgIGNoYW5uZWxzOiBbXSwKICAgICAgICBjaGFubmVsOiAiIiwKICAgICAgICBzZWFyY2g6ICIiLAogICAgICAgIHRpdGxlOiAiIiwKICAgICAgfSwKICAgICAgYXNzaWduVFZHSUQ6IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBjb3VudHJpZXM6IFtdLAogICAgICAgIGNvdW50cnk6ICIiLAogICAgICAgIGNoYW5uZWxzOiBbXSwKICAgICAgICBhc3NpZ25BbGw6IDAsCiAgICAgIH0sCiAgICAgIHNhdmVDaGFuZ2VzOiB7CiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICB9LAogICAgICBncm91cFR5cGVzOiBbCiAgICAgICAgeyB0ZXh0OiB0aGlzLiR0KCJ4dHJlYW0ubGl2ZSIpLCB2YWx1ZTogMSB9LAogICAgICAgIHsgdGV4dDogdGhpcy4kdCgieHRyZWFtLm1vdmllcyIpLCB2YWx1ZTogMiB9LAogICAgICAgIHsgdGV4dDogdGhpcy4kdCgieHRyZWFtLnNlcmllcyIpLCB2YWx1ZTogMyB9LAogICAgICBdLAogICAgfTsKICB9LAogIGNvbXB1dGVkOiB7CiAgICAuLi5tYXBHZXR0ZXJzKFsKICAgICAgImN1cnJlbnRVc2VyIiwKICAgICAgInNldHRpbmdzIiwKICAgICAgInNvdW5kY2xvdWRDbGllbnRJZCIsCiAgICAgICJtb3ZpZVNlcmllUGxheWxpc3QiLAogICAgXSksCiAgICBzaG93VG9vbHRpcHMgKCkgewogICAgICByZXR1cm4gdGhpcy5zZXR0aW5ncy5zaG93VG9vbHRpcHM7CiAgICB9LAogICAgc2VhcmNoRmlsdGVyZWQoKSB7CiAgICAgIGlmICh0aGlzLnNlYXJjaCA9PT0gbnVsbCkgewogICAgICAgIHJldHVybiB0aGlzLmFjY291bnRzOwogICAgICB9IGVsc2UgewogICAgICAgIHZhciByZSA9IG5ldyBSZWdFeHAodGhpcy5zZWFyY2gsICJpIik7CiAgICAgICAgcmV0dXJuIHRoaXMuYWNjb3VudHMuZmlsdGVyKChhY2NvdW50KSA9PiB7CiAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICBTdHJpbmcoYWNjb3VudC50aXRsZSkubWF0Y2gocmUpIHx8CiAgICAgICAgICAgIFN0cmluZyhhY2NvdW50Lmhvc3QpLm1hdGNoKHJlKSB8fAogICAgICAgICAgICBTdHJpbmcoYWNjb3VudC5wb3J0KS5tYXRjaChyZSkgfHwKICAgICAgICAgICAgU3RyaW5nKGFjY291bnQudXNlcm5hbWUpLm1hdGNoKHJlKSB8fAogICAgICAgICAgICBTdHJpbmcoYWNjb3VudC5wYXNzd29yZCkubWF0Y2gocmUpIHx8CiAgICAgICAgICAgIHRoaXMuZm9ybWF0RGF0ZShhY2NvdW50LnN5bmNlZF9hdCkubWF0Y2gocmUpIHx8CiAgICAgICAgICAgIHRoaXMuJHQoYHN5bmMtaW50ZXJ2YWwuJHthY2NvdW50LnN5bmNfaW50ZXJ2YWx9YCkubWF0Y2gocmUpCiAgICAgICAgICApOwogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgcGxheWxpc3RTZWxlY3RlZCgpIHsKICAgICAgcmV0dXJuIHRoaXMucGxheWxpc3RFZGl0b3IuaWQgIT09IHVuZGVmaW5lZDsKICAgIH0sCiAgICBsYXN0U2VsZWN0ZWRHcm91cCgpIHsKICAgICAgcmV0dXJuIHRoaXMuYWN0aXZlR3JvdXBzW3RoaXMuYWN0aXZlR3JvdXBzLmxlbmd0aCAtIDFdOwogICAgfSwKICAgIGxhc3RTZWxlY3RlZFN0cmVhbSgpIHsKICAgICAgcmV0dXJuIHRoaXMuYWN0aXZlU3RyZWFtc1t0aGlzLmFjdGl2ZVN0cmVhbXMubGVuZ3RoIC0gMV07CiAgICB9LAogICAgY2FuRWRpdEdyb3VwVHlwZSgpIHsKICAgICAgcmV0dXJuICgKICAgICAgICB0aGlzLmdyb3VwRWRpdG9yLmlkICYmCiAgICAgICAgdGhpcy5nZXRHcm91cFdpdGhJZCh0aGlzLmdyb3VwRWRpdG9yLmlkKS5zdHJlYW1zID09IDAKICAgICAgKTsKICAgIH0sCiAgICBzdWJzY3JpcHRpb25MaW1pdGVkKCkgewogICAgICByZXR1cm4gKAogICAgICAgIHRoaXMuY3VycmVudFVzZXIuc3Vic2NyaXB0aW9uICYmCiAgICAgICAgdGhpcy5jdXJyZW50VXNlci5zdWJzY3JpcHRpb24uc3Vic2NyaXB0aW9uX3R5cGUgPT0KICAgICAgICAgIFN1YnNjcmlwdGlvblR5cGUuRW50aHVzaWFzdAogICAgICApOwogICAgfSwKICAgIGZpbHRlcmVkR3JvdXBzKCkgewogICAgICBpZiAodGhpcy5zdWJzY3JpcHRpb25MaW1pdGVkKSB7CiAgICAgICAgcmV0dXJuIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbHRlcigKICAgICAgICAgIChncm91cCkgPT4KICAgICAgICAgICAgZ3JvdXAuZ3JvdXBfaXNfcmVtb3ZlZCAhPT0gMSAmJgogICAgICAgICAgICBncm91cC5zb3VyY2VfZ3JvdXBfdHlwZSA9PSAxICYmCiAgICAgICAgICAgIGdyb3VwLmdyb3VwX3R5cGUgPT0gMQogICAgICAgICk7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbHRlcigKICAgICAgICAoZ3JvdXApID0+IGdyb3VwLmdyb3VwX2lzX3JlbW92ZWQgIT09IDEKICAgICAgKTsKICAgIH0sCiAgICBmaWx0ZXJlZFN0cmVhbXMoKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMuZmlsdGVyKAogICAgICAgIChncm91cCkgPT4gZ3JvdXAuc3RyZWFtX2lzX3JlbW92ZWQgIT09IDEKICAgICAgKTsKICAgIH0sCiAgICBhY3RpdmVHcm91cFR5cGUoKSB7CiAgICAgIGxldCBpbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleCgKICAgICAgICAoZ3JvdXApID0+IGdyb3VwLmlkID09IHRoaXMuYWN0aXZlR3JvdXAKICAgICAgKTsKICAgICAgcmV0dXJuIGluZGV4ID4gLTEgPyB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpbmRleF0uZ3JvdXBfdHlwZSA6IDA7CiAgICB9LAogICAgZmlsdGVyZWRMb2dvcygpIHsKICAgICAgaWYgKCF0aGlzLmZpbmRMb2dvLnNlYXJjaC5sZW5ndGgpIHsKICAgICAgICByZXR1cm4gdGhpcy5maW5kTG9nby5sb2dvczsKICAgICAgfQogICAgICBsZXQgc2VsZWN0ZWRTdHJlYW0gPSB0aGlzLmdldFN0cmVhbVdpdGhJZCh0aGlzLmFjdGl2ZVN0cmVhbXNbMF0pOwogICAgICBsZXQgcmUgPSBuZXcgUmVnRXhwKHRoaXMuZmluZExvZ28uc2VhcmNoLCAiaSIpOwogICAgICByZXR1cm4gdGhpcy5maW5kTG9nby5sb2dvcy5maWx0ZXIoKGxvZ28pID0+IHsKICAgICAgICByZXR1cm4gbG9nby50ZXh0Lm1hdGNoKHJlKTsKICAgICAgfSk7CiAgICB9LAogICAgZmlsdGVyZWRUVkdJRFMoKSB7CiAgICAgIGlmICghdGhpcy5maW5kVFZHSUQuc2VhcmNoLmxlbmd0aCkgewogICAgICAgIHJldHVybiB0aGlzLmZpbmRUVkdJRC5jaGFubmVsczsKICAgICAgfQogICAgICBsZXQgc2VsZWN0ZWRTdHJlYW0gPSB0aGlzLmdldFN0cmVhbVdpdGhJZCh0aGlzLmFjdGl2ZVN0cmVhbXNbMF0pOwogICAgICBsZXQgcmUgPSBuZXcgUmVnRXhwKHRoaXMuZmluZFRWR0lELnNlYXJjaCwgImkiKTsKICAgICAgcmV0dXJuIHRoaXMuZmluZFRWR0lELmNoYW5uZWxzLmZpbHRlcigoY2hhbm5lbCkgPT4gewogICAgICAgIHJldHVybiBjaGFubmVsLnRleHQubWF0Y2gocmUpOwogICAgICB9KTsKICAgIH0sCiAgICBncm91cENvbnRleHRNZW51KCkgewogICAgICBsZXQgdm0gPSB0aGlzOwogICAgICByZXR1cm4gWwogICAgICAgIHsKICAgICAgICAgIGljb246ICJsYS1wbHVzIiwKICAgICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IuYWRkLWdyb3VwIiksCiAgICAgICAgICBvbkNsaWNrOiB2bS5hZGRHcm91cCwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGRpc2FibGVkOiB2bS5hY3RpdmVHcm91cHMubGVuZ3RoICE9PSAxLAogICAgICAgICAgaWNvbjogImxhLWVkaXQiLAogICAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5lZGl0LWdyb3VwIiksCiAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmICh2bS5hY3RpdmVHcm91cHMubGVuZ3RoID09PSAxKSB7CiAgICAgICAgICAgICAgdm0uZWRpdEdyb3VwTW9kYWwodHJ1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBkaXZpZGVyOiB0cnVlLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgdGV4dDogdm0uJHQoImdlbmVyYWwuc2VsZWN0LWFsbCIpLAogICAgICAgICAgb25DbGljazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2bS5hY3RpdmVHcm91cHMgPSBbLi4udm0ucGxheWxpc3RFZGl0b3IuZ3JvdXBzLm1hcCgoZykgPT4gZy5pZCldOwogICAgICAgICAgfSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIHRleHQ6IHZtLiR0KCJnZW5lcmFsLnNlbGVjdC1ub25lIiksCiAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZtLmFjdGl2ZUdyb3VwcyA9IFtdOwogICAgICAgICAgfSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGRpdmlkZXI6IHRydWUsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBpY29uOiAibGEtc2VhcmNoIiwKICAgICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IuZmluZC1yZXBsYWNlIiksCiAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZtLmZpbmRBbmRSZXBsYWNlTW9kYWwodHJ1ZSwgMSk7CiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgaWNvbjogImxhLXBlbiIsCiAgICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLmFkZC1wcmVmaXgtc3VmZml4IiksCiAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZtLnByZWZpeFN1ZmZpeE1vZGFsKHRydWUsIDEpOwogICAgICAgICAgfSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGljb246ICJsYS1mb250IiwKICAgICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IuY2hhbmdlLWNhc2UiKSwKICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdm0uY29udmVydENhc2VNb2RhbCh0cnVlLCAxKTsKICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBkaXZpZGVyOiB0cnVlLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgZGlzYWJsZWQ6IHZtLmFjdGl2ZUdyb3Vwcy5sZW5ndGggPT09IDAsCiAgICAgICAgICBpY29uOiAibGEtZXllIiwKICAgICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IudG9nZ2xlLXZpc2liaWxpdHkiKSwKICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKHZtLmFjdGl2ZUdyb3Vwcy5sZW5ndGgpIHsKICAgICAgICAgICAgICB2bS50b2dnbGVHcm91cFZpc2liaWxpdHkoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGRpc2FibGVkOiB2bS5hY3RpdmVHcm91cHMubGVuZ3RoID09PSAwLAogICAgICAgICAgaWNvbjogImxhLXRyYXNoIiwKICAgICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IuZGVsZXRlIiksCiAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmICh2bS5hY3RpdmVHcm91cHMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgdm0uZGVsZXRlU2VsZWN0ZWRHcm91cHMoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICB9LAogICAgICBdOwogICAgfSwKICAgIHN0cmVhbUNvbnRleHRNZW51KCkgewogICAgICBsZXQgdm0gPSB0aGlzOwogICAgICByZXR1cm4gWwogICAgICAgIHsKICAgICAgICAgIGljb246ICJsYS1wbHVzIiwKICAgICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IuYWRkLXN0cmVhbSIpLAogICAgICAgICAgb25DbGljazogdm0uYWRkU3RyZWFtLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgZGlzYWJsZWQ6IHZtLmFjdGl2ZVN0cmVhbXMubGVuZ3RoICE9PSAxLAogICAgICAgICAgaWNvbjogImxhLWVkaXQiLAogICAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5lZGl0LXN0cmVhbSIpLAogICAgICAgICAgb25DbGljazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICBpZiAodm0uYWN0aXZlU3RyZWFtcy5sZW5ndGggPT09IDEpIHsKICAgICAgICAgICAgICB2bS5lZGl0U3RyZWFtTW9kYWwodHJ1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBkaXZpZGVyOiB0cnVlLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgdGV4dDogdm0uJHQoImdlbmVyYWwuc2VsZWN0LWFsbCIpLAogICAgICAgICAgb25DbGljazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2bS5hY3RpdmVTdHJlYW1zID0gWy4uLnZtLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubWFwKChnKSA9PiBnLmlkKV07CiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgdGV4dDogdm0uJHQoImdlbmVyYWwuc2VsZWN0LW5vbmUiKSwKICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdm0uYWN0aXZlU3RyZWFtcyA9IFtdOwogICAgICAgICAgfSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGRpdmlkZXI6IHRydWUsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBkaXNhYmxlZDoKICAgICAgICAgICAgdm0uYWN0aXZlR3JvdXBzLmxlbmd0aCAhPT0gMSB8fAogICAgICAgICAgICB2bS5hY3RpdmVTdHJlYW1zLmxlbmd0aCA9PT0gMCB8fAogICAgICAgICAgICB2bS5nZXRHcm91cFdpdGhJZCh2bS5hY3RpdmVHcm91cHNbMF0pLmdyb3VwX3R5cGUgIT09CiAgICAgICAgICAgICAgdm0uYWN0aXZlR3JvdXBUeXBlIHx8CiAgICAgICAgICAgIHZtLmFjdGl2ZUdyb3Vwc1swXSA9PT0gdm0uYWN0aXZlR3JvdXAsCiAgICAgICAgICBpY29uOiAibGEtY2hldnJvbi1sZWZ0IiwKICAgICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IubW92ZS10by1zZWxlY3RlZC1ncm91cCIpLAogICAgICAgICAgb25DbGljazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2bS5tb3ZlVG9TZWxlY3RlZEdyb3VwKCk7CiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgZGl2aWRlcjogdHJ1ZSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGljb246ICJsYS1zZWFyY2giLAogICAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5maW5kLXJlcGxhY2UiKSwKICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdm0uZmluZEFuZFJlcGxhY2VNb2RhbCh0cnVlLCAyKTsKICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBpY29uOiAibGEtcGVuIiwKICAgICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IuYWRkLXByZWZpeC1zdWZmaXgiKSwKICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdm0ucHJlZml4U3VmZml4TW9kYWwodHJ1ZSwgMik7CiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgaWNvbjogImxhLWZvbnQiLAogICAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5jaGFuZ2UtY2FzZSIpLAogICAgICAgICAgb25DbGljazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2bS5jb252ZXJ0Q2FzZU1vZGFsKHRydWUsIDIpOwogICAgICAgICAgfSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGRpdmlkZXI6IHRydWUsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBkaXNhYmxlZDogdm0uYWN0aXZlU3RyZWFtcy5sZW5ndGggIT09IDEgfHwgdm0uYWN0aXZlR3JvdXBUeXBlICE9PSAxLAogICAgICAgICAgaWNvbjogImxhLXBob3RvLXZpZGVvIiwKICAgICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IuZmluZC1sb2dvIiksCiAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZtLmZpbmRMb2dvTW9kYWwodHJ1ZSk7CiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgZGlzYWJsZWQ6IHZtLmFjdGl2ZVN0cmVhbXMubGVuZ3RoICE9PSAxIHx8IHZtLmFjdGl2ZUdyb3VwVHlwZSAhPT0gMSwKICAgICAgICAgIGljb246ICJsYS10aC1saXN0IiwKICAgICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IuZmluZC10di1ndWlkZSIpLAogICAgICAgICAgb25DbGljazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2bS5maW5kVFZHSURNb2RhbCh0cnVlKTsKICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBkaXZpZGVyOiB0cnVlLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgZGlzYWJsZWQ6IHZtLmFjdGl2ZVN0cmVhbXMubGVuZ3RoID09PSAwIHx8IHZtLmFjdGl2ZUdyb3VwVHlwZSAhPT0gMSwKICAgICAgICAgIGljb246ICJsYS1tdXNpYyIsCiAgICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLnRvZ2dsZS1yYWRpbyIpLAogICAgICAgICAgb25DbGljazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICBpZiAodm0uYWN0aXZlU3RyZWFtcy5sZW5ndGggJiYgdm0uYWN0aXZlR3JvdXBUeXBlID09IDEpIHsKICAgICAgICAgICAgICB2bS50b2dnbGVTdHJlYW1SYWRpbygpOwogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgZGlzYWJsZWQ6IHZtLmFjdGl2ZVN0cmVhbXMubGVuZ3RoID09PSAwLAogICAgICAgICAgaWNvbjogImxhLWV5ZSIsCiAgICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLnRvZ2dsZS12aXNpYmlsaXR5IiksCiAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmICh2bS5hY3RpdmVTdHJlYW1zLmxlbmd0aCkgewogICAgICAgICAgICAgIHZtLnRvZ2dsZVN0cmVhbVZpc2liaWxpdHkoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGRpdmlkZXI6IHRydWUsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBkaXNhYmxlZDogdm0uYWN0aXZlU3RyZWFtcy5sZW5ndGggPT09IDAsCiAgICAgICAgICBpY29uOiAibGEtdHJhc2giLAogICAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5kZWxldGUiKSwKICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKHZtLmFjdGl2ZVN0cmVhbXMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgdm0uZGVsZXRlU2VsZWN0ZWRTdHJlYW1zKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgICAgXTsKICAgIH0sCiAgfSwKICBtZXRob2RzOiB7CiAgICBncm91cERyYWdDaGFuZ2VkKGcpIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmICh0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5ncm91cF9vcmRlciAhPSBpICsgMSkgewogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uZ3JvdXBfb3JkZXIgPSBpICsgMTsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBzdHJlYW1EcmFnQ2hhbmdlZChnKSB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5zdHJlYW1fb3JkZXIgIT0gaSArIDEpIHsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5zdHJlYW1fb3JkZXIgPSBpICsgMTsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgb3BlbkNvbnRleHQoY29udGV4dCkgewogICAgICB0aGlzLiRyZWZzW2NvbnRleHRdLm9wZW4oKTsKICAgIH0sCiAgICBzZWFyY2hFZGl0b3Ioc2VhcmNoKSB7CiAgICAgIGlmIChzZWFyY2gubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhpcy5zZWFyY2ggPSBudWxsOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc2VhcmNoID0gc2VhcmNoOwogICAgICB9CiAgICB9LAogICAgcHJpbnRFZGl0b3IoKSB7CiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJlZGl0b3IiKS5wcmludCgpOwogICAgfSwKICAgIGZvcm1hdE51bWJlcihudW1iZXIpIHsKICAgICAgcmV0dXJuIG5ldyBJbnRsLk51bWJlckZvcm1hdCh0aGlzLiR0KCJkYXRlLmxvY2FsZSIpKS5mb3JtYXQobnVtYmVyKTsKICAgIH0sCiAgICBmb3JtYXREYXRlKGRhdGUpIHsKICAgICAgcmV0dXJuIG5ldyBEYXRlKGRhdGUpLnRvTG9jYWxlU3RyaW5nKAogICAgICAgIHRoaXMuJHQoImRhdGUubG9jYWxlIiksCiAgICAgICAgdGhpcy5kYXRlT3B0aW9ucwogICAgICApOwogICAgfSwKICAgIGZvcm1hdERhdGVZb3V0dWJlKGRhdGUpIHsKICAgICAgcmV0dXJuIG5ldyBEYXRlKGRhdGUpLnRvTG9jYWxlRGF0ZVN0cmluZyh0aGlzLiR0KCJkYXRlLmxvY2FsZSIpLCB7CiAgICAgICAgeWVhcjogIm51bWVyaWMiLAogICAgICAgIG1vbnRoOiAic2hvcnQiLAogICAgICAgIGRheTogIm51bWVyaWMiLAogICAgICB9KTsKICAgIH0sCiAgICBmb3JtYXRTZWNvbmRzKHNlYykgewogICAgICB2YXIgZCA9IE51bWJlcihzZWMpOwogICAgICB2YXIgaCA9IE1hdGguZmxvb3IoZCAvIDM2MDApOwogICAgICB2YXIgbSA9IE1hdGguZmxvb3IoKGQgJSAzNjAwKSAvIDYwKTsKICAgICAgdmFyIHMgPSBNYXRoLmZsb29yKChkICUgMzYwMCkgJSA2MCk7CgogICAgICB2YXIgaG91ciA9IHRoaXMuJHQoImdlbmVyYWwuaG91ciIpOwogICAgICB2YXIgaG91cnMgPSB0aGlzLiR0KCJnZW5lcmFsLmhvdXJzIik7CiAgICAgIHZhciBtaW51dGUgPSB0aGlzLiR0KCJnZW5lcmFsLm1pbnV0ZSIpOwogICAgICB2YXIgbWludXRlcyA9IHRoaXMuJHQoImdlbmVyYWwubWludXRlcyIpOwogICAgICB2YXIgc2Vjb25kID0gdGhpcy4kdCgiZ2VuZXJhbC5zZWNvbmQiKTsKICAgICAgdmFyIHNlY29uZHMgPSB0aGlzLiR0KCJnZW5lcmFsLnNlY29uZHMiKTsKCiAgICAgIHZhciBoRGlzcGxheSA9IGggPiAwID8gaCArIChoID09IDEgPyBgICR7aG91cn0gYCA6IGAgJHtob3Vyc30gYCkgOiAiIjsKICAgICAgdmFyIG1EaXNwbGF5ID0gbSA+IDAgPyBtICsgKG0gPT0gMSA/IGAgJHttaW51dGV9IGAgOiBgICR7bWludXRlc30gYCkgOiAiIjsKICAgICAgdmFyIHNEaXNwbGF5ID0gcyA+IDAgPyBzICsgKHMgPT0gMSA/IGAgJHtzZWNvbmR9IGAgOiBgICR7c2Vjb25kc30gYCkgOiAiIjsKICAgICAgcmV0dXJuIGhEaXNwbGF5ICsgbURpc3BsYXkgKyBzRGlzcGxheTsKICAgIH0sCgogICAgZ2V0R3JvdXBXaXRoSWQoaWQpIHsKICAgICAgbGV0IGluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KAogICAgICAgIChncm91cCkgPT4gZ3JvdXAuaWQgPT0gaWQKICAgICAgKTsKICAgICAgcmV0dXJuIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2luZGV4XTsKICAgIH0sCiAgICBnZXRTdHJlYW1XaXRoSWQoaWQpIHsKICAgICAgbGV0IGluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmZpbmRJbmRleCgKICAgICAgICAoc3RyZWFtKSA9PiBzdHJlYW0uaWQgPT0gaWQKICAgICAgKTsKICAgICAgcmV0dXJuIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF07CiAgICB9LAogICAgZG9TYXZlKCkgewogICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IGZhbHNlOwogICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICBsZXQgaW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoKGdyb3VwKSA9PiB7CiAgICAgICAgICByZXR1cm4gZ3JvdXAuaWQgPT0gdGhpcy5hY3RpdmVHcm91cDsKICAgICAgICB9KTsKICAgICAgICBsZXQgdXBkYXRlR3JvdXBzID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMKICAgICAgICAgIC5maWx0ZXIoKGdyb3VwKSA9PiAhZ3JvdXAuZ3JvdXBfaXNfcmVtb3ZlZCAmJiBncm91cC5tb2RpZmllZCkKICAgICAgICAgIC5tYXAoKGdyb3VwKSA9PiB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgaWQ6IGdyb3VwLmlkLAogICAgICAgICAgICAgIGdyb3VwX25hbWU6IGdyb3VwLmdyb3VwX25hbWUsCiAgICAgICAgICAgICAgZ3JvdXBfb3JkZXI6IGdyb3VwLmdyb3VwX29yZGVyLAogICAgICAgICAgICAgIGdyb3VwX3R5cGU6IGdyb3VwLmdyb3VwX3R5cGUsCiAgICAgICAgICAgICAgZ3JvdXBfcGFyZW50X2NvZGU6IGdyb3VwLmdyb3VwX3BhcmVudF9jb2RlLAogICAgICAgICAgICAgIGdyb3VwX2lzX2hpZGRlbjogZ3JvdXAuZ3JvdXBfaXNfaGlkZGVuLAogICAgICAgICAgICB9OwogICAgICAgICAgfSk7CiAgICAgICAgbGV0IGRlbGV0ZUdyb3VwcyA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzCiAgICAgICAgICAuZmlsdGVyKChncm91cCkgPT4gZ3JvdXAuZ3JvdXBfaXNfcmVtb3ZlZCAmJiBncm91cC5tb2RpZmllZCkKICAgICAgICAgIC5tYXAoKGdyb3VwKSA9PiBncm91cC5pZCkKICAgICAgICAgIC5qb2luKCk7CgogICAgICAgIGxldCB1cGRhdGVTdHJlYW1zOwogICAgICAgIHN3aXRjaCAodGhpcy5hY3RpdmVHcm91cFR5cGUpIHsKICAgICAgICAgIC8vIExpdmUgc3RyZWFtcwogICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICB1cGRhdGVTdHJlYW1zID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zCiAgICAgICAgICAgICAgLmZpbHRlcigKICAgICAgICAgICAgICAgIChzdHJlYW0pID0+IHN0cmVhbS5zdHJlYW1faXNfcmVtb3ZlZCAhPT0gMSAmJiBzdHJlYW0ubW9kaWZpZWQKICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgLm1hcCgoc3RyZWFtKSA9PiB7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICBpZDogc3RyZWFtLmlkLAogICAgICAgICAgICAgICAgICBzb3VyY2Vfc3RyZWFtX3VybDogc3RyZWFtLnNvdXJjZV9zdHJlYW1fdXJsLAogICAgICAgICAgICAgICAgICBzdHJlYW1fdHZnX25hbWU6IHN0cmVhbS5zdHJlYW1fdHZnX25hbWUsCiAgICAgICAgICAgICAgICAgIHN0cmVhbV90dmdfaWQ6IHN0cmVhbS5zdHJlYW1fdHZnX2lkLAogICAgICAgICAgICAgICAgICBzdHJlYW1fdHZnX2xvZ286IHN0cmVhbS5zdHJlYW1fdHZnX2xvZ28sCiAgICAgICAgICAgICAgICAgIHN0cmVhbV9wYXJlbnRfY29kZTogc3RyZWFtLnN0cmVhbV9wYXJlbnRfY29kZSwKICAgICAgICAgICAgICAgICAgc3RyZWFtX3JhZGlvOiBzdHJlYW0uc3RyZWFtX3JhZGlvLAogICAgICAgICAgICAgICAgICBzdHJlYW1faXNfaGlkZGVuOiBzdHJlYW0uc3RyZWFtX2lzX2hpZGRlbiwKICAgICAgICAgICAgICAgICAgc3RyZWFtX29yZGVyOiBzdHJlYW0uc3RyZWFtX29yZGVyLAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAvLyBNb3ZpZXMKICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgdXBkYXRlU3RyZWFtcyA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcwogICAgICAgICAgICAgIC5maWx0ZXIoCiAgICAgICAgICAgICAgICAoc3RyZWFtKSA9PiBzdHJlYW0uc3RyZWFtX2lzX3JlbW92ZWQgIT09IDEgJiYgc3RyZWFtLm1vZGlmaWVkCiAgICAgICAgICAgICAgKQogICAgICAgICAgICAgIC5tYXAoKHN0cmVhbSkgPT4gewogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgaWQ6IHN0cmVhbS5pZCwKICAgICAgICAgICAgICAgICAgc291cmNlX3N0cmVhbV91cmw6IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX3VybCwKICAgICAgICAgICAgICAgICAgbW92aWVfbmFtZTogc3RyZWFtLm1vdmllX25hbWUsCiAgICAgICAgICAgICAgICAgIG1vdmllX3llYXI6IHN0cmVhbS5tb3ZpZV95ZWFyLAogICAgICAgICAgICAgICAgICB0bWRiX2lkOiBzdHJlYW0udG1kYl9pZCwKICAgICAgICAgICAgICAgICAgc3RyZWFtX3R2Z19sb2dvOiBzdHJlYW0uc3RyZWFtX3R2Z19sb2dvLAogICAgICAgICAgICAgICAgICBzdHJlYW1faXNfaGlkZGVuOiBzdHJlYW0uc3RyZWFtX2lzX2hpZGRlbiwKICAgICAgICAgICAgICAgICAgc3RyZWFtX29yZGVyOiBzdHJlYW0uc3RyZWFtX29yZGVyLAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAvLyBTZXJpZXMKICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgdXBkYXRlU3RyZWFtcyA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcwogICAgICAgICAgICAgIC5maWx0ZXIoCiAgICAgICAgICAgICAgICAoc3RyZWFtKSA9PiBzdHJlYW0uc3RyZWFtX2lzX3JlbW92ZWQgIT09IDEgJiYgc3RyZWFtLm1vZGlmaWVkCiAgICAgICAgICAgICAgKQogICAgICAgICAgICAgIC5tYXAoKHN0cmVhbSkgPT4gewogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgaWQ6IHN0cmVhbS5pZCwKICAgICAgICAgICAgICAgICAgc291cmNlX3N0cmVhbV91cmw6IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX3VybCwKICAgICAgICAgICAgICAgICAgc2VyaWVfbmFtZTogc3RyZWFtLnNlcmllX25hbWUsCiAgICAgICAgICAgICAgICAgIHNlcmllX3NlYXNvbjogc3RyZWFtLnNlcmllX3NlYXNvbiwKICAgICAgICAgICAgICAgICAgc2VyaWVfZXBpc29kZTogc3RyZWFtLnNlcmllX2VwaXNvZGUsCiAgICAgICAgICAgICAgICAgIHRtZGJfaWQ6IHN0cmVhbS50bWRiX2lkLAogICAgICAgICAgICAgICAgICBzdHJlYW1fdHZnX2xvZ286IHN0cmVhbS5zdHJlYW1fdHZnX2xvZ28sCiAgICAgICAgICAgICAgICAgIHN0cmVhbV9pc19oaWRkZW46IHN0cmVhbS5zdHJlYW1faXNfaGlkZGVuLAogICAgICAgICAgICAgICAgICBzdHJlYW1fb3JkZXI6IHN0cmVhbS5zdHJlYW1fb3JkZXIsCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgbGV0IGRlbGV0ZVN0cmVhbXMgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMKICAgICAgICAgIC5maWx0ZXIoKHN0cmVhbSkgPT4gc3RyZWFtLnN0cmVhbV9pc19yZW1vdmVkID09PSAxICYmIHN0cmVhbS5tb2RpZmllZCkKICAgICAgICAgIC5tYXAoKHN0cmVhbSkgPT4gc3RyZWFtLmlkKQogICAgICAgICAgLmpvaW4oKTsKCiAgICAgICAgbGV0IHJlcXVlc3RzID0gW107CiAgICAgICAgaWYgKHVwZGF0ZUdyb3Vwcy5sZW5ndGgpIHsKICAgICAgICAgIHJlcXVlc3RzLnB1c2goCiAgICAgICAgICAgIGh0dHBTZXJ2aWNlLnBvc3QoImVkaXRvci91cGRhdGUtZ3JvdXBzIiwgewogICAgICAgICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgICAgIGdyb3VwczogdXBkYXRlR3JvdXBzLAogICAgICAgICAgICB9KQogICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgaWYgKGRlbGV0ZUdyb3Vwcy5sZW5ndGgpIHsKICAgICAgICAgIGluZGV4ID0gMDsKICAgICAgICAgIHJlcXVlc3RzLnB1c2goCiAgICAgICAgICAgIGh0dHBTZXJ2aWNlLnBvc3QoImVkaXRvci9kZWxldGUtZ3JvdXBzIiwgewogICAgICAgICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgICAgIGdyb3VwczogZGVsZXRlR3JvdXBzLAogICAgICAgICAgICB9KQogICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgaWYgKHVwZGF0ZVN0cmVhbXMubGVuZ3RoKSB7CiAgICAgICAgICByZXF1ZXN0cy5wdXNoKAogICAgICAgICAgICBodHRwU2VydmljZS5wb3N0KGBlZGl0b3IvdXBkYXRlLXN0cmVhbXMvJHt0aGlzLmFjdGl2ZUdyb3VwVHlwZX1gLCB7CiAgICAgICAgICAgICAgcGxheWxpc3RfaWQ6IHRoaXMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICAgICAgc3RyZWFtczogdXBkYXRlU3RyZWFtcywKICAgICAgICAgICAgfSkKICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIGlmIChkZWxldGVTdHJlYW1zLmxlbmd0aCkgewogICAgICAgICAgcmVxdWVzdHMucHVzaCgKICAgICAgICAgICAgaHR0cFNlcnZpY2UucG9zdChgZWRpdG9yL2RlbGV0ZS1zdHJlYW1zLyR7dGhpcy5hY3RpdmVHcm91cFR5cGV9YCwgewogICAgICAgICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgICAgIHN0cmVhbXM6IGRlbGV0ZVN0cmVhbXMsCiAgICAgICAgICAgIH0pCiAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICBQcm9taXNlLmFsbChyZXF1ZXN0cykudGhlbigocmVzKSA9PiB7CiAgICAgICAgICB0aGlzLmxvYWRQbGF5bGlzdCh0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLCBpbmRleCk7CiAgICAgICAgICByZXNvbHZlKHJlcyk7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSwKICAgIGRvQ2FuY2VsKCkgewogICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIFByb21pc2UuYWxsKFt0aGlzLnJlc3RvcmVHcm91cHMoKSwgdGhpcy5yZXN0b3JlU3RyZWFtcygpXSkudGhlbigoKSA9PiB7CiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gZmFsc2U7CiAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfSk7CiAgICB9LAogICAgZG9UYWJDaGFuZ2UodGFiKSB7CiAgICAgIHRoaXMuYWN0aXZlVGFiID0gdGFiOwogICAgfSwKICAgIHVwZGF0ZUdyb3VwT3JkZXIoc291cmNlKSB7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgIGxldCBncm91cHMgPSBbLi4uc291cmNlXTsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGdyb3Vwcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgZ3JvdXBzW2ldLnNvdXJjZV9ncm91cF9vcmRlciA9IGkgKyAxOwogICAgICAgICAgZ3JvdXBzW2ldLmdyb3VwX29yZGVyID0gaSArIDE7CiAgICAgICAgfQogICAgICAgIHJlc29sdmUoZ3JvdXBzKTsKICAgICAgfSk7CiAgICB9LAogICAgdXBkYXRlU3RyZWFtT3JkZXIoc291cmNlKSB7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgIGxldCBzdHJlYW1zID0gWy4uLnNvdXJjZV07CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdHJlYW1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBzdHJlYW1zW2ldLnNvdXJjZV9zdHJlYW1fb3JkZXIgPSBpICsgMTsKICAgICAgICAgIHN0cmVhbXNbaV0uc3RyZWFtX29yZGVyID0gaSArIDE7CiAgICAgICAgfQogICAgICAgIHJlc29sdmUoc3RyZWFtcyk7CiAgICAgIH0pOwogICAgfSwKICAgIHJlc3RvcmVHcm91cE9yZGVyKCkgewogICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5zb3J0KChhLCBiKSA9PgogICAgICAgICAgYS5zb3VyY2VfZ3JvdXBfb3JkZXIgPiBiLnNvdXJjZV9ncm91cF9vcmRlcgogICAgICAgICAgICA/IDEKICAgICAgICAgICAgOiBiLnNvdXJjZV9ncm91cF9vcmRlciA+IGEuc291cmNlX2dyb3VwX29yZGVyCiAgICAgICAgICAgID8gLTEKICAgICAgICAgICAgOiAwCiAgICAgICAgKTsKICAgICAgICByZXNvbHZlKCk7CiAgICAgIH0pOwogICAgfSwKICAgIHJlc3RvcmVTdHJlYW1PcmRlcigpIHsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLnNvcnQoKGEsIGIpID0+CiAgICAgICAgICBhLnNvdXJjZV9zdHJlYW1fb3JkZXIgPiBiLnNvdXJjZV9zdHJlYW1fb3JkZXIKICAgICAgICAgICAgPyAxCiAgICAgICAgICAgIDogYi5zb3VyY2Vfc3RyZWFtX29yZGVyID4gYS5zb3VyY2Vfc3RyZWFtX29yZGVyCiAgICAgICAgICAgID8gLTEKICAgICAgICAgICAgOiAwCiAgICAgICAgKTsKICAgICAgICByZXNvbHZlKCk7CiAgICAgIH0pOwogICAgfSwKICAgIHJlc3RvcmVHcm91cHMoKSB7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgIHRoaXMucmVzdG9yZUdyb3VwT3JkZXIoKS50aGVuKCgpID0+IHsKICAgICAgICAgIGxldCBncm91cDsKICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgZ3JvdXAgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXTsKICAgICAgICAgICAgZ3JvdXAubW9kaWZpZWQgPSBmYWxzZTsKICAgICAgICAgICAgZ3JvdXAuZ3JvdXBfaXNfcmVtb3ZlZCA9IDA7CiAgICAgICAgICAgIGdyb3VwLmdyb3VwX3R5cGUgPSBncm91cC5zb3VyY2VfZ3JvdXBfdHlwZTsKICAgICAgICAgICAgZ3JvdXAuZ3JvdXBfbmFtZSA9IGdyb3VwLnNvdXJjZV9ncm91cF9uYW1lOwogICAgICAgICAgICBncm91cC5wYXJlbnRfY29kZSA9IGdyb3VwLnNvdXJjZV9ncm91cF9wYXJlbnRfY29kZTsKICAgICAgICAgICAgZ3JvdXAuZ3JvdXBfaXNfaGlkZGVuID0gZ3JvdXAuc291cmNlX2dyb3VwX2lzX2hpZGRlbjsKICAgICAgICAgIH0KICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LAogICAgcmVzdG9yZVN0cmVhbXMoKSB7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgIHRoaXMucmVzdG9yZVN0cmVhbU9yZGVyKCkudGhlbigoKSA9PiB7CiAgICAgICAgICBsZXQgc3RyZWFtOwogICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgc3RyZWFtID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldOwogICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSBmYWxzZTsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV9pc19yZW1vdmVkID0gMDsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfbmFtZSA9IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX3R2Z19uYW1lOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19pZCA9IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX3R2Z19pZDsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfbG9nbyA9IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX3R2Z19sb2dvOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19jaG5vID0gc3RyZWFtLnNvdXJjZV9zdHJlYW1fdHZnX2Nobm87CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX3NoaWZ0ID0gc3RyZWFtLnNvdXJjZV9zdHJlYW1fdHZnX3NoaWZ0OwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3BhcmVudF9jb2RlID0gc3RyZWFtLnNvdXJjZV9zdHJlYW1fcGFyZW50X2NvZGU7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fYXVkaW9fdHJhY2sgPSBzdHJlYW0uc291cmNlX3N0cmVhbV9hdWRpb190cmFjazsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV9hc3BlY3RfcmF0aW8gPSBzdHJlYW0uc291cmNlX3N0cmVhbV9hc3BlY3RfcmF0aW87CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fcmFkaW8gPSBzdHJlYW0uc291cmNlX3N0cmVhbV9yYWRpbzsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV9vcmRlciA9IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX29yZGVyOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX2lzX2hpZGRlbiA9IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX2lzX2hpZGRlbjsKICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgIHN0cmVhbS5tb3ZpZV9uYW1lICE9PSB1bmRlZmluZWQgJiYKICAgICAgICAgICAgICBzdHJlYW0ubW92aWVfeWVhciAhPT0gdW5kZWZpbmVkCiAgICAgICAgICAgICkgewogICAgICAgICAgICAgIHN0cmVhbS5tb3ZpZV9uYW1lID0gc3RyZWFtLnNvdXJjZV9tb3ZpZV9uYW1lOwogICAgICAgICAgICAgIHN0cmVhbS5tb3ZpZV95ZWFyID0gc3RyZWFtLnNvdXJjZV9tb3ZpZV95ZWFyOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICBzdHJlYW0uc2VyaWVfbmFtZSAhPT0gdW5kZWZpbmVkICYmCiAgICAgICAgICAgICAgc3RyZWFtLnNlcmllX3NlYXNvbiAhPT0gdW5kZWZpbmVkICYmCiAgICAgICAgICAgICAgc3RyZWFtLnNlcmllX2VwaXNvZGUgIT09IHVuZGVmaW5lZAogICAgICAgICAgICApIHsKICAgICAgICAgICAgICBzdHJlYW0uc2VyaWVfbmFtZSA9IHN0cmVhbS5zb3VyY2Vfc2VyaWVfbmFtZTsKICAgICAgICAgICAgICBzdHJlYW0uc2VyaWVfc2Vhc29uID0gc3RyZWFtLnNvdXJjZV9zZXJpZV9zZWFzb247CiAgICAgICAgICAgICAgc3RyZWFtLnNlcmllX2VwaXNvZGUgPSBzdHJlYW0uc291cmNlX3NlcmllX2VwaXNvZGU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LAogICAgdG9nZ2xlR3JvdXBWaXNpYmlsaXR5KCkgewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBzLmluY2x1ZGVzKHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmlkKSkgewogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uZ3JvdXBfaXNfaGlkZGVuID0KICAgICAgICAgICAgIXRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmdyb3VwX2lzX2hpZGRlbjsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgIH0sCiAgICB0b2dnbGVTdHJlYW1WaXNpYmlsaXR5KCkgewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmICh0aGlzLmFjdGl2ZVN0cmVhbXMuaW5jbHVkZXModGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLmlkKSkgewogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLnN0cmVhbV9pc19oaWRkZW4gPQogICAgICAgICAgICAhdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLnN0cmVhbV9pc19oaWRkZW47CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgfSwKICAgIHRvZ2dsZVN0cmVhbVJhZGlvKCkgewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmICh0aGlzLmFjdGl2ZVN0cmVhbXMuaW5jbHVkZXModGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLmlkKSkgewogICAgICAgICAgaWYgKHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5zdHJlYW1fcmFkaW8gPT0gMCkgewogICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uc3RyZWFtX3JhZGlvID0gMTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5zdHJlYW1fcmFkaW8gPSAwOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgIH0sCiAgICBkZWxldGVTZWxlY3RlZEdyb3VwcygpIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3Vwcy5pbmNsdWRlcyh0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5pZCkpIHsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmdyb3VwX2lzX3JlbW92ZWQgPSAxOwogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgfSwKICAgIGRlbGV0ZVNlbGVjdGVkU3RyZWFtcygpIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAodGhpcy5hY3RpdmVTdHJlYW1zLmluY2x1ZGVzKHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5pZCkpIHsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5zdHJlYW1faXNfcmVtb3ZlZCA9IDE7CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgfSwKICAgIGxvYWRQbGF5bGlzdCh2YWwsIGdyb3VwX2luZGV4ID0gdW5kZWZpbmVkKSB7CiAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaWYgKHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCkgewogICAgICAgIHRoaXMuZG9TYXZlKCk7CiAgICAgIH0KICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5pZCA9IHZhbDsKICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAuZ2V0KGBlZGl0b3IvZ3JvdXBzLyR7dmFsfWApCiAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgaWYgKHJlcy5zdGF0dXMgPT09IHRydWUpIHsKICAgICAgICAgICAgdGhpcy51cGRhdGVHcm91cE9yZGVyKHJlcy5kYXRhKS50aGVuKChncm91cHMpID0+IHsKICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3VwcyA9IGdyb3Vwcy5tYXAoKGdyb3VwKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBncnAgPSBPYmplY3QuYXNzaWduKHt9LCBncm91cCk7CiAgICAgICAgICAgICAgICBncnAuc291cmNlX2dyb3VwX3BhcmVudF9jb2RlID0gZ3JvdXAuZ3JvdXBfcGFyZW50X2NvZGU7CiAgICAgICAgICAgICAgICBncnAuc291cmNlX2dyb3VwX2lzX2hpZGRlbiA9IGdyb3VwLmdyb3VwX2lzX2hpZGRlbjsKICAgICAgICAgICAgICAgIGdycC5zb3VyY2VfZ3JvdXBfbmFtZSA9IGdyb3VwLmdyb3VwX25hbWU7CiAgICAgICAgICAgICAgICBncnAuc291cmNlX2dyb3VwX3R5cGUgPSBncm91cC5ncm91cF90eXBlOwogICAgICAgICAgICAgICAgZ3JwLmdyb3VwX2lzX3JlbW92ZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIGdycC5tb2RpZmllZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgcmV0dXJuIGdycDsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBpZiAoZ3JvdXBzLmxlbmd0aCkgewogICAgICAgICAgICAgICAgaWYgKGdyb3VwX2luZGV4ID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5hY3RpdmVHcm91cCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzWzBdLmlkOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgdGhpcy5hY3RpdmVHcm91cCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2dyb3VwX2luZGV4XS5pZDsKICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkU3RyZWFtcygpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgfSk7CiAgICB9LAogICAgdG9nZ2xlR3JvdXBTZWxlY3Rpb24oaXRlbSkgewogICAgICBsZXQgaWR4ID0gdGhpcy5hY3RpdmVHcm91cHMuaW5kZXhPZihpdGVtKTsKICAgICAgaWYgKGlkeCAhPT0gLTEpIHsKICAgICAgICB0aGlzLmFjdGl2ZUdyb3Vwcy5zcGxpY2UoaWR4LCAxKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmFjdGl2ZUdyb3Vwcy5wdXNoKGl0ZW0pOwogICAgICB9CiAgICB9LAogICAgdG9nZ2xlU3RyZWFtU2VsZWN0aW9uKGl0ZW0pIHsKICAgICAgbGV0IGlkeCA9IHRoaXMuYWN0aXZlU3RyZWFtcy5pbmRleE9mKGl0ZW0pOwogICAgICBpZiAoaWR4ICE9PSAtMSkgewogICAgICAgIHRoaXMuYWN0aXZlU3RyZWFtcy5zcGxpY2UoaWR4LCAxKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmFjdGl2ZVN0cmVhbXMucHVzaChpdGVtKTsKICAgICAgfQogICAgfSwKICAgIHRvZ2dsZVJhZGlvYnJvd3NlclNlbGVjdGlvbihpdGVtKSB7CiAgICAgIGxldCBpZHggPSB0aGlzLnJhZGlvQnJvd3Nlci5hY3RpdmUuaW5kZXhPZihpdGVtKTsKICAgICAgaWYgKGlkeCAhPT0gLTEpIHsKICAgICAgICB0aGlzLnJhZGlvQnJvd3Nlci5hY3RpdmUuc3BsaWNlKGlkeCwgMSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuYWN0aXZlLnB1c2goaXRlbSk7CiAgICAgIH0KICAgIH0sCiAgICB0b2dnbGVJbXBvcnRNM1VTZWxlY3Rpb24oaXRlbSkgewogICAgICBsZXQgaWR4ID0gdGhpcy5pbXBvcnRNM1UuaW1wb3J0R3JvdXBzLmluZGV4T2YoaXRlbSk7CiAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgdGhpcy5pbXBvcnRNM1UuaW1wb3J0R3JvdXBzLnNwbGljZShpZHgsIDEpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuaW1wb3J0TTNVLmltcG9ydEdyb3Vwcy5wdXNoKGl0ZW0pOwogICAgICB9CiAgICB9LAogICAgaW5kZXhPZkdyb3VwKGdyb3VwKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5tYXAoKGcpID0+IGcuaWQpLmluZGV4T2YoZ3JvdXApOwogICAgfSwKICAgIHNlbGVjdEdyb3VwUmFuZ2VTZWxlY3Rpb24oaXRlbSkgewogICAgICBjb25zdCBsYXN0SW5kZXggPSB0aGlzLmluZGV4T2ZHcm91cCh0aGlzLmxhc3RTZWxlY3RlZEdyb3VwKTsKICAgICAgY29uc3QgaXRlbUluZGV4ID0gdGhpcy5pbmRleE9mR3JvdXAoaXRlbSk7CiAgICAgIGNvbnN0IGRpciA9IGl0ZW1JbmRleCA+IGxhc3RJbmRleCA/IDEgOiAtMTsKICAgICAgZm9yIChsZXQgaSA9IGxhc3RJbmRleDsgaSAhPSBpdGVtSW5kZXggKyBkaXI7IGkgKz0gZGlyKSB7CiAgICAgICAgaWYgKCF0aGlzLmFjdGl2ZUdyb3Vwcy5pbmNsdWRlcyh0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5pZCkpIHsKICAgICAgICAgIHRoaXMuYWN0aXZlR3JvdXBzLnB1c2godGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uaWQpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGluZGV4T2ZTdHJlYW0oc3RyZWFtKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubWFwKChnKSA9PiBnLmlkKS5pbmRleE9mKHN0cmVhbSk7CiAgICB9LAogICAgc2VsZWN0U3RyZWFtUmFuZ2VTZWxlY3Rpb24oaXRlbSkgewogICAgICBjb25zdCBsYXN0SW5kZXggPSB0aGlzLmluZGV4T2ZTdHJlYW0odGhpcy5sYXN0U2VsZWN0ZWRTdHJlYW0pOwogICAgICBjb25zdCBpdGVtSW5kZXggPSB0aGlzLmluZGV4T2ZTdHJlYW0oaXRlbSk7CiAgICAgIGNvbnN0IGRpciA9IGl0ZW1JbmRleCA+IGxhc3RJbmRleCA/IDEgOiAtMTsKICAgICAgZm9yIChsZXQgaSA9IGxhc3RJbmRleDsgaSAhPSBpdGVtSW5kZXggKyBkaXI7IGkgKz0gZGlyKSB7CiAgICAgICAgaWYgKCF0aGlzLmFjdGl2ZVN0cmVhbXMuaW5jbHVkZXModGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLmlkKSkgewogICAgICAgICAgdGhpcy5hY3RpdmVTdHJlYW1zLnB1c2godGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLmlkKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBzZWxlY3RSYWRpb2Jyb3dzZXJSYW5nZVNlbGVjdGlvbihpbmRleCkgewogICAgICBjb25zdCBsYXN0SW5kZXggPQogICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZVt0aGlzLnJhZGlvQnJvd3Nlci5hY3RpdmUubGVuZ3RoIC0gMV07CiAgICAgIGNvbnN0IGRpciA9IGluZGV4ID4gbGFzdEluZGV4ID8gMSA6IC0xOwogICAgICBmb3IgKGxldCBpID0gbGFzdEluZGV4OyBpICE9IGluZGV4ICsgZGlyOyBpICs9IGRpcikgewogICAgICAgIGlmICghdGhpcy5yYWRpb0Jyb3dzZXIuYWN0aXZlLmluY2x1ZGVzKGkpKSB7CiAgICAgICAgICB0aGlzLnJhZGlvQnJvd3Nlci5hY3RpdmUucHVzaChpKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBzZWxlY3RJbXBvcnRNM1VSYW5nZVNlbGVjdGlvbihpbmRleCkgewogICAgICBjb25zdCBsYXN0SW5kZXggPQogICAgICAgIHRoaXMuaW1wb3J0TTNVLmltcG9ydEdyb3Vwc1t0aGlzLmltcG9ydE0zVS5pbXBvcnRHcm91cHMubGVuZ3RoIC0gMV07CiAgICAgIGNvbnN0IGRpciA9IGluZGV4ID4gbGFzdEluZGV4ID8gMSA6IC0xOwogICAgICBmb3IgKGxldCBpID0gbGFzdEluZGV4OyBpICE9IGluZGV4ICsgZGlyOyBpICs9IGRpcikgewogICAgICAgIGlmICghdGhpcy5pbXBvcnRNM1UuaW1wb3J0R3JvdXBzLmluY2x1ZGVzKGkpKSB7CiAgICAgICAgICB0aGlzLmltcG9ydE0zVS5pbXBvcnRHcm91cHMucHVzaChpKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBzZWxlY3RHcm91cFNlbGVjdGlvbihpdGVtKSB7CiAgICAgIHRoaXMuYWN0aXZlR3JvdXBzLmxlbmd0aCA9IDA7CiAgICAgIHRoaXMuYWN0aXZlR3JvdXBzLnB1c2goaXRlbSk7CiAgICB9LAogICAgc2VsZWN0U3RyZWFtU2VsZWN0aW9uKGl0ZW0pIHsKICAgICAgdGhpcy5hY3RpdmVTdHJlYW1zLmxlbmd0aCA9IDA7CiAgICAgIHRoaXMuYWN0aXZlU3RyZWFtcy5wdXNoKGl0ZW0pOwogICAgfSwKICAgIHNlbGVjdFJhZGlvYnJvd3NlclNlbGVjdGlvbihpdGVtKSB7CiAgICAgIHRoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZS5sZW5ndGggPSAwOwogICAgICB0aGlzLnJhZGlvQnJvd3Nlci5hY3RpdmUucHVzaChpdGVtKTsKICAgIH0sCiAgICBzZWxlY3RJbXBvcnRNM1VTZWxlY3Rpb24oaXRlbSkgewogICAgICB0aGlzLmltcG9ydE0zVS5pbXBvcnRHcm91cHMubGVuZ3RoID0gMDsKICAgICAgdGhpcy5pbXBvcnRNM1UuaW1wb3J0R3JvdXBzLnB1c2goaXRlbSk7CiAgICB9LAogICAgZmluZEFuZFJlcGxhY2VNb2RhbChzaG93LCB0eXBlID0gMSkgewogICAgICB0aGlzLmZpbmRSZXBsYWNlLnR5cGUgPSB0eXBlOwogICAgICB0aGlzLmZpbmRSZXBsYWNlLm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBmaW5kQW5kUmVwbGFjZSgpIHsKICAgICAgbGV0IG9wdGlvbnMgPSAiIjsKICAgICAgaWYgKHRoaXMuZmluZFJlcGxhY2UucmVwbGFjZUFsbCkgewogICAgICAgIG9wdGlvbnMgKz0gImciOwogICAgICB9CiAgICAgIGlmICh0aGlzLmZpbmRSZXBsYWNlLmlnbm9yZUNhc2UpIHsKICAgICAgICBvcHRpb25zICs9ICJpIjsKICAgICAgfQogICAgICBsZXQgcmUgPSBuZXcgUmVnRXhwKHRoaXMuZmluZFJlcGxhY2UuZnJvbS5yZXBsYWNlKCJ8IiwgIlxcfCIpLCBvcHRpb25zKTsKICAgICAgc3dpdGNoIChwYXJzZUludCh0aGlzLmZpbmRSZXBsYWNlLnR5cGUpKSB7CiAgICAgICAgLy8gR3JvdXAKICAgICAgICBjYXNlIDE6CiAgICAgICAgICBpZiAocGFyc2VJbnQodGhpcy5maW5kUmVwbGFjZS5zZWxlY3RlZE9ubHkpID09PSAxKSB7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZUdyb3Vwcy5pbmNsdWRlcyh0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5pZCkKICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmdyb3VwX25hbWUgPQogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5ncm91cF9uYW1lLnJlcGxhY2UoCiAgICAgICAgICAgICAgICAgICAgcmUsCiAgICAgICAgICAgICAgICAgICAgdGhpcy5maW5kUmVwbGFjZS50bwogICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5maWx0ZXJlZEdyb3Vwcy5tYXAoKGdyb3VwKSA9PiB7CiAgICAgICAgICAgICAgZ3JvdXAubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgIGdyb3VwLmdyb3VwX25hbWUgPSBncm91cC5ncm91cF9uYW1lLnJlcGxhY2UoCiAgICAgICAgICAgICAgICByZSwKICAgICAgICAgICAgICAgIHRoaXMuZmluZFJlcGxhY2UudG8KICAgICAgICAgICAgICApOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwoKICAgICAgICAvLyBTdHJlYW1zCiAgICAgICAgY2FzZSAyOgogICAgICAgICAgaWYgKHBhcnNlSW50KHRoaXMuZmluZFJlcGxhY2Uuc2VsZWN0ZWRPbmx5KSA9PT0gMSkgewogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlU3RyZWFtcy5pbmNsdWRlcyh0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uaWQpCiAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDEpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLnN0cmVhbV90dmdfbmFtZSA9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLnN0cmVhbV90dmdfbmFtZS5yZXBsYWNlKAogICAgICAgICAgICAgICAgICAgICAgcmUsCiAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZpbmRSZXBsYWNlLnRvCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMikgewogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0ubW92aWVfbmFtZSA9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLm1vdmllX25hbWUucmVwbGFjZSgKICAgICAgICAgICAgICAgICAgICAgIHJlLAogICAgICAgICAgICAgICAgICAgICAgdGhpcy5maW5kUmVwbGFjZS50bwogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDMpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLnNlcmllX25hbWUgPQogICAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5zZXJpZV9uYW1lLnJlcGxhY2UoCiAgICAgICAgICAgICAgICAgICAgICByZSwKICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmluZFJlcGxhY2UudG8KICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5maWx0ZXJlZFN0cmVhbXMubWFwKChzdHJlYW0pID0+IHsKICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDEpIHsKICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lID0gc3RyZWFtLnN0cmVhbV90dmdfbmFtZS5yZXBsYWNlKAogICAgICAgICAgICAgICAgICByZSwKICAgICAgICAgICAgICAgICAgdGhpcy5maW5kUmVwbGFjZS50bwogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAyKSB7CiAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgc3RyZWFtLm1vdmllX25hbWUgPSBzdHJlYW0ubW92aWVfbmFtZS5yZXBsYWNlKAogICAgICAgICAgICAgICAgICByZSwKICAgICAgICAgICAgICAgICAgdGhpcy5maW5kUmVwbGFjZS50bwogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAzKSB7CiAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgc3RyZWFtLnNlcmllX25hbWUgPSBzdHJlYW0uc2VyaWVfbmFtZS5yZXBsYWNlKAogICAgICAgICAgICAgICAgICByZSwKICAgICAgICAgICAgICAgICAgdGhpcy5maW5kUmVwbGFjZS50bwogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgICAgdGhpcy5maW5kUmVwbGFjZS5tb2RhbCA9IGZhbHNlOwogICAgfSwKICAgIHByZWZpeFN1ZmZpeE1vZGFsKHNob3csIHR5cGUgPSAxKSB7CiAgICAgIHRoaXMucHJlZml4U3VmZml4LnR5cGUgPSB0eXBlOwogICAgICB0aGlzLnByZWZpeFN1ZmZpeC5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgYWRkUHJlZml4U3VmZml4KCkgewogICAgICBsZXQgcHJlZml4ID0gdGhpcy5wcmVmaXhTdWZmaXgucHJlZml4OwogICAgICBsZXQgc3VmZml4ID0gdGhpcy5wcmVmaXhTdWZmaXguc3VmZml4OwogICAgICBzd2l0Y2ggKHBhcnNlSW50KHRoaXMucHJlZml4U3VmZml4LnR5cGUpKSB7CiAgICAgICAgLy8gR3JvdXAKICAgICAgICBjYXNlIDE6CiAgICAgICAgICBpZiAocGFyc2VJbnQodGhpcy5wcmVmaXhTdWZmaXguc2VsZWN0ZWRPbmx5KSA9PT0gMSkgewogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgdGhpcy5hY3RpdmVHcm91cHMuaW5jbHVkZXModGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uaWQpCiAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5ncm91cF9uYW1lID0KICAgICAgICAgICAgICAgICAgcHJlZml4ICsgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uZ3JvdXBfbmFtZSArIHN1ZmZpeDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuZmlsdGVyZWRHcm91cHMubWFwKChncm91cCkgPT4gewogICAgICAgICAgICAgIGdyb3VwLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICBncm91cC5ncm91cF9uYW1lID0gcHJlZml4ICsgZ3JvdXAuZ3JvdXBfbmFtZSArIHN1ZmZpeDsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKCiAgICAgICAgLy8gU3RyZWFtCiAgICAgICAgY2FzZSAyOgogICAgICAgICAgaWYgKHBhcnNlSW50KHRoaXMucHJlZml4U3VmZml4LnNlbGVjdGVkT25seSkgPT09IDEpIHsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZVN0cmVhbXMuaW5jbHVkZXModGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLmlkKQogICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAxKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5zdHJlYW1fdHZnX25hbWUgPQogICAgICAgICAgICAgICAgICAgIHByZWZpeCArCiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLnN0cmVhbV90dmdfbmFtZSArCiAgICAgICAgICAgICAgICAgICAgc3VmZml4OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5tb3ZpZV9uYW1lID0KICAgICAgICAgICAgICAgICAgICBwcmVmaXggKyB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0ubW92aWVfbmFtZSArIHN1ZmZpeDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMykgewogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uc2VyaWVfbmFtZSA9CiAgICAgICAgICAgICAgICAgICAgcHJlZml4ICsgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLnNlcmllX25hbWUgKyBzdWZmaXg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDEpIHsKICAgICAgICAgICAgICB0aGlzLmZpbHRlcmVkU3RyZWFtcy5tYXAoKHN0cmVhbSkgPT4gewogICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX25hbWUgPQogICAgICAgICAgICAgICAgICBwcmVmaXggKyBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lICsgc3VmZml4OwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMikgewogICAgICAgICAgICAgIHRoaXMuZmlsdGVyZWRTdHJlYW1zLm1hcCgoc3RyZWFtKSA9PiB7CiAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgc3RyZWFtLm1vdmllX25hbWUgPSBwcmVmaXggKyBzdHJlYW0ubW92aWVfbmFtZSArIHN1ZmZpeDsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDMpIHsKICAgICAgICAgICAgICB0aGlzLmZpbHRlcmVkU3RyZWFtcy5tYXAoKHN0cmVhbSkgPT4gewogICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHN0cmVhbS5zZXJpZV9uYW1lID0gcHJlZml4ICsgc3RyZWFtLnNlcmllX25hbWUgKyBzdWZmaXg7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICAgIHRoaXMucHJlZml4U3VmZml4Lm1vZGFsID0gZmFsc2U7CiAgICB9LAogICAgY29udmVydENhc2VNb2RhbChzaG93LCB0eXBlKSB7CiAgICAgIHRoaXMuY29udmVydENhc2UudHlwZSA9IHR5cGU7CiAgICAgIHRoaXMuY29udmVydENhc2UubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGNoYW5nZUNhc2UoKSB7CiAgICAgIGxldCBtZXRob2QgPSB0aGlzLmNvbnZlcnRDYXNlLm1ldGhvZDsKICAgICAgbGV0IGdyb3VwczsKICAgICAgbGV0IHN0cmVhbXM7CiAgICAgIGlmIChwYXJzZUludCh0aGlzLmNvbnZlcnRDYXNlLnNlbGVjdGVkT25seSkgPT09IDEpIHsKICAgICAgICBncm91cHMgPSB0aGlzLmZpbHRlcmVkR3JvdXBzLmZpbHRlcigoZ3JvdXApID0+IHsKICAgICAgICAgIHJldHVybiB0aGlzLmFjdGl2ZUdyb3Vwcy5pbmNsdWRlcyhncm91cC5pZCk7CiAgICAgICAgfSk7CiAgICAgICAgc3RyZWFtcyA9IHRoaXMuZmlsdGVyZWRTdHJlYW1zLmZpbHRlcigoc3RyZWFtKSA9PiB7CiAgICAgICAgICByZXR1cm4gdGhpcy5hY3RpdmVTdHJlYW1zLmluY2x1ZGVzKHN0cmVhbS5pZCk7CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZ3JvdXBzID0gdGhpcy5maWx0ZXJlZEdyb3VwczsKICAgICAgICBzdHJlYW1zID0gdGhpcy5maWx0ZXJlZFN0cmVhbXM7CiAgICAgIH0KICAgICAgc3dpdGNoIChwYXJzZUludCh0aGlzLmNvbnZlcnRDYXNlLnR5cGUpKSB7CiAgICAgICAgLy8gQ2F0ZWdvcmllcwogICAgICAgIGNhc2UgMToKICAgICAgICAgIGdyb3Vwcy5tYXAoKGdyb3VwKSA9PiB7CiAgICAgICAgICAgIHN3aXRjaCAocGFyc2VJbnQobWV0aG9kKSkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGdyb3VwLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGdyb3VwLmdyb3VwX25hbWUgPSBncm91cC5ncm91cF9uYW1lLnRpdGxlQ2FzZSgpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgZ3JvdXAubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgZ3JvdXAuZ3JvdXBfbmFtZSA9IGdyb3VwLmdyb3VwX25hbWUudG9VcHBlckNhc2UoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIGdyb3VwLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGdyb3VwLmdyb3VwX25hbWUgPSBncm91cC5ncm91cF9uYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgLy8gU3RyZWFtcwogICAgICAgIGNhc2UgMjoKICAgICAgICAgIHN0cmVhbXMubWFwKChzdHJlYW0pID0+IHsKICAgICAgICAgICAgc3dpdGNoIChwYXJzZUludChtZXRob2QpKSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAxKSB7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX25hbWUgPSBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lLnRpdGxlQ2FzZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5tb3ZpZV9uYW1lID0gc3RyZWFtLm1vdmllX25hbWUudGl0bGVDYXNlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDMpIHsKICAgICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgc3RyZWFtLnNlcmllX25hbWUgPSBzdHJlYW0uc2VyaWVfbmFtZS50aXRsZUNhc2UoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMSkgewogICAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lID0gc3RyZWFtLnN0cmVhbV90dmdfbmFtZS50b1VwcGVyQ2FzZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5tb3ZpZV9uYW1lID0gc3RyZWFtLm1vdmllX25hbWUudG9VcHBlckNhc2UoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMykgewogICAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICBzdHJlYW0uc2VyaWVfbmFtZSA9IHN0cmVhbS5zZXJpZV9uYW1lLnRvVXBwZXJDYXNlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDEpIHsKICAgICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfbmFtZSA9IHN0cmVhbS5zdHJlYW1fdHZnX25hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMikgewogICAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICBzdHJlYW0ubW92aWVfbmFtZSA9IHN0cmVhbS5tb3ZpZV9uYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDMpIHsKICAgICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgc3RyZWFtLnNlcmllX25hbWUgPSBzdHJlYW0uc2VyaWVfbmFtZS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgICAgdGhpcy5jb252ZXJ0Q2FzZS5tb2RhbCA9IGZhbHNlOwogICAgfSwKICAgIGVkaXRHcm91cE1vZGFsKHNob3cpIHsKICAgICAgbGV0IGluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KAogICAgICAgIChncm91cCkgPT4gZ3JvdXAuaWQgPT09IHRoaXMuYWN0aXZlR3JvdXBzWzBdCiAgICAgICk7CiAgICAgIGxldCBncm91cCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2luZGV4XTsKICAgICAgaWYgKGdyb3VwKSB7CiAgICAgICAgdGhpcy5ncm91cEVkaXRvci5pZCA9IHRoaXMuYWN0aXZlR3JvdXBzWzBdOwogICAgICAgIHRoaXMuZ3JvdXBFZGl0b3IuZ3JvdXBfdHlwZSA9IGdyb3VwLmdyb3VwX3R5cGU7CiAgICAgICAgdGhpcy5ncm91cEVkaXRvci5ncm91cF9uYW1lID0gZ3JvdXAuZ3JvdXBfbmFtZTsKICAgICAgICB0aGlzLmdyb3VwRWRpdG9yLmdyb3VwX2lzX2hpZGRlbiA9IGdyb3VwLmdyb3VwX2lzX2hpZGRlbjsKICAgICAgICB0aGlzLmdyb3VwRWRpdG9yLmdyb3VwX3BhcmVudF9jb2RlID0gZ3JvdXAuZ3JvdXBfcGFyZW50X2NvZGU7CiAgICAgICAgdGhpcy5ncm91cEVkaXRvci5tb2RhbCA9IHNob3c7CiAgICAgIH0KICAgIH0sCiAgICBlZGl0U3RyZWFtTW9kYWwoc2hvdykgewogICAgICBsZXQgaW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMuZmluZEluZGV4KAogICAgICAgIChzdHJlYW0pID0+IHN0cmVhbS5pZCA9PT0gdGhpcy5hY3RpdmVTdHJlYW1zWzBdCiAgICAgICk7CiAgICAgIGxldCBzdHJlYW0gPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdOwogICAgICBpZiAoc3RyZWFtKSB7CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3IuaWQgPSB0aGlzLmFjdGl2ZVN0cmVhbXNbMF07CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX3R2Z19uYW1lID0gc3RyZWFtLnN0cmVhbV90dmdfbmFtZTsKICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1fdHZnX2lkID0gc3RyZWFtLnN0cmVhbV90dmdfaWQ7CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX3R2Z19sb2dvID0gc3RyZWFtLnN0cmVhbV90dmdfbG9nbzsKICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1fcGFyZW50X2NvZGUgPSBzdHJlYW0uc3RyZWFtX3BhcmVudF9jb2RlOwogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV9yYWRpbyA9IHN0cmVhbS5zdHJlYW1fcmFkaW87CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX2lzX2hpZGRlbiA9IHN0cmVhbS5zdHJlYW1faXNfaGlkZGVuOwogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnNvdXJjZV9zdHJlYW1fdXJsID0gc3RyZWFtLnNvdXJjZV9zdHJlYW1fdXJsOwogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV9pc19jdXN0b20gPSBzdHJlYW0uc3RyZWFtX2lzX2N1c3RvbTsKICAgICAgICBpZiAoCiAgICAgICAgICBzdHJlYW0ubW92aWVfbmFtZSAhPT0gdW5kZWZpbmVkICYmCiAgICAgICAgICBzdHJlYW0ubW92aWVfeWVhciAhPT0gdW5kZWZpbmVkICYmCiAgICAgICAgICBzdHJlYW0udG1kYl9pZCAhPT0gdW5kZWZpbmVkCiAgICAgICAgKSB7CiAgICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5tb3ZpZV9uYW1lID0gc3RyZWFtLm1vdmllX25hbWU7CiAgICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5tb3ZpZV95ZWFyID0gc3RyZWFtLm1vdmllX3llYXI7CiAgICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci50bWRiX2lkID0gc3RyZWFtLnRtZGJfaWQ7CiAgICAgICAgfQogICAgICAgIGlmICgKICAgICAgICAgIHN0cmVhbS5zZXJpZV9uYW1lICE9PSB1bmRlZmluZWQgJiYKICAgICAgICAgIHN0cmVhbS5zZXJpZV9zZWFzb24gIT09IHVuZGVmaW5lZCAmJgogICAgICAgICAgc3RyZWFtLnNlcmllX2VwaXNvZGUgIT09IHVuZGVmaW5lZAogICAgICAgICkgewogICAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc2VyaWVfbmFtZSA9IHN0cmVhbS5zZXJpZV9uYW1lOwogICAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc2VyaWVfc2Vhc29uID0gc3RyZWFtLnNlcmllX3NlYXNvbjsKICAgICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnNlcmllX2VwaXNvZGUgPSBzdHJlYW0uc2VyaWVfZXBpc29kZTsKICAgICAgICB9CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3IubW9kYWwgPSBzaG93OwogICAgICB9CiAgICB9LAogICAgZWRpdEdyb3VwKCkgewogICAgICBsZXQgaW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoCiAgICAgICAgKGdyb3VwKSA9PiBncm91cC5pZCA9PT0gdGhpcy5ncm91cEVkaXRvci5pZAogICAgICApOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpbmRleF0uZ3JvdXBfdHlwZSA9CiAgICAgICAgdGhpcy5ncm91cEVkaXRvci5ncm91cF90eXBlOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpbmRleF0uZ3JvdXBfbmFtZSA9CiAgICAgICAgdGhpcy5ncm91cEVkaXRvci5ncm91cF9uYW1lOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpbmRleF0uZ3JvdXBfaXNfaGlkZGVuID0KICAgICAgICB0aGlzLmdyb3VwRWRpdG9yLmdyb3VwX2lzX2hpZGRlbjsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaW5kZXhdLmdyb3VwX3BhcmVudF9jb2RlID0KICAgICAgICB0aGlzLmdyb3VwRWRpdG9yLmdyb3VwX3BhcmVudF9jb2RlOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpbmRleF0ubW9kaWZpZWQgPSB0cnVlOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgICB0aGlzLmdyb3VwRWRpdG9yLm1vZGFsID0gZmFsc2U7CiAgICB9LAogICAgZWRpdFN0cmVhbSgpIHsKICAgICAgbGV0IGluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmZpbmRJbmRleCgKICAgICAgICAoc3RyZWFtKSA9PiBzdHJlYW0uaWQgPT09IHRoaXMuYWN0aXZlU3RyZWFtc1swXQogICAgICApOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnN0cmVhbV90dmdfbmFtZSA9CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX3R2Z19uYW1lOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnN0cmVhbV90dmdfaWQgPQogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV90dmdfaWQ7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc3RyZWFtX3R2Z19sb2dvID0KICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1fdHZnX2xvZ287CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc3RyZWFtX3BhcmVudF9jb2RlID0KICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1fcGFyZW50X2NvZGU7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc3RyZWFtX2lzX2hpZGRlbiA9CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX2lzX2hpZGRlbjsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zdHJlYW1fcmFkaW8gPQogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV9yYWRpbzsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zb3VyY2Vfc3RyZWFtX3VybCA9CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc291cmNlX3N0cmVhbV91cmw7CiAgICAgIGlmICgKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLm1vdmllX25hbWUgIT09IHVuZGVmaW5lZCAmJgogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0ubW92aWVfeWVhciAhPT0gdW5kZWZpbmVkICYmCiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS50bWRiX2lkICE9PSB1bmRlZmluZWQKICAgICAgKSB7CiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5tb3ZpZV9uYW1lID0KICAgICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLm1vdmllX25hbWU7CiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5tb3ZpZV95ZWFyID0KICAgICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLm1vdmllX3llYXI7CiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS50bWRiX2lkID0gdGhpcy5zdHJlYW1FZGl0b3IudG1kYl9pZDsKICAgICAgfQogICAgICBpZiAoCiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zZXJpZV9uYW1lICE9PSB1bmRlZmluZWQgJiYKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnNlcmllX3NlYXNvbiAhPT0gdW5kZWZpbmVkICYmCiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zZXJpZV9lcGlzb2RlICE9PSB1bmRlZmluZWQKICAgICAgKSB7CiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zZXJpZV9uYW1lID0KICAgICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnNlcmllX25hbWU7CiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zZXJpZV9zZWFzb24gPQogICAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc2VyaWVfc2Vhc29uOwogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc2VyaWVfZXBpc29kZSA9CiAgICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zZXJpZV9lcGlzb2RlOwogICAgICB9CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0ubW9kaWZpZWQgPSB0cnVlOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgICB0aGlzLnN0cmVhbUVkaXRvci5tb2RhbCA9IGZhbHNlOwogICAgfSwKICAgIHNvcnRHcm91cEFscGhhVXAoKSB7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuc29ydCgoYSwgYikgPT4KICAgICAgICBiLmdyb3VwX25hbWUgPiBhLmdyb3VwX25hbWUgPyAxIDogYS5ncm91cF9uYW1lID4gYi5ncm91cF9uYW1lID8gLTEgOiAwCiAgICAgICk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLm1hcCgoZ3JvdXApID0+IChncm91cC5tb2RpZmllZCA9IHRydWUpKTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgIH0sCiAgICBzb3J0R3JvdXBBbHBoYURvd24oKSB7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuc29ydCgoYSwgYikgPT4KICAgICAgICBhLmdyb3VwX25hbWUgPiBiLmdyb3VwX25hbWUgPyAxIDogYi5ncm91cF9uYW1lID4gYS5ncm91cF9uYW1lID8gLTEgOiAwCiAgICAgICk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLm1hcCgoZ3JvdXApID0+IChncm91cC5tb2RpZmllZCA9IHRydWUpKTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgIH0sCiAgICBzb3J0R3JvdXBUeXBlVXAoKSB7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuc29ydCgoYSwgYikgPT4KICAgICAgICBiLmdyb3VwX3R5cGUgPiBhLmdyb3VwX3R5cGUgPyAxIDogYS5ncm91cF90eXBlID4gYi5ncm91cF90eXBlID8gLTEgOiAwCiAgICAgICk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLm1hcCgoZ3JvdXApID0+IChncm91cC5tb2RpZmllZCA9IHRydWUpKTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgIH0sCiAgICBzb3J0R3JvdXBUeXBlRG93bigpIHsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5zb3J0KChhLCBiKSA9PgogICAgICAgIGEuZ3JvdXBfdHlwZSA+IGIuZ3JvdXBfdHlwZSA/IDEgOiBiLmdyb3VwX3R5cGUgPiBhLmdyb3VwX3R5cGUgPyAtMSA6IDAKICAgICAgKTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMubWFwKChncm91cCkgPT4gKGdyb3VwLm1vZGlmaWVkID0gdHJ1ZSkpOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgfSwKICAgIHNvcnRTdHJlYW1BbHBoYVVwKCkgewogICAgICAvL0VSTlNUIEhJRVIKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLnNvcnQoKGEsIGIpID0+IHsKICAgICAgICBzd2l0Y2ggKHRoaXMuYWN0aXZlR3JvdXBUeXBlKSB7CiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIHJldHVybiBiLnN0cmVhbV90dmdfbmFtZSA+IGEuc3RyZWFtX3R2Z19uYW1lCiAgICAgICAgICAgICAgPyAxCiAgICAgICAgICAgICAgOiBhLnN0cmVhbV90dmdfbmFtZSA+IGIuc3RyZWFtX3R2Z19uYW1lCiAgICAgICAgICAgICAgPyAtMQogICAgICAgICAgICAgIDogMDsKICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgcmV0dXJuIGIubW92aWVfbmFtZSA+IGEubW92aWVfbmFtZQogICAgICAgICAgICAgID8gMQogICAgICAgICAgICAgIDogYS5tb3ZpZV9uYW1lID4gYi5tb3ZpZV9uYW1lCiAgICAgICAgICAgICAgPyAtMQogICAgICAgICAgICAgIDogMDsKICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgcmV0dXJuIGIuc2VyaWVfbmFtZSA+IGEuc2VyaWVfbmFtZQogICAgICAgICAgICAgID8gMQogICAgICAgICAgICAgIDogYS5zZXJpZV9uYW1lID4gYi5zZXJpZV9uYW1lCiAgICAgICAgICAgICAgPyAtMQogICAgICAgICAgICAgIDogMDsKICAgICAgICB9CiAgICAgIH0pOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubWFwKChzdHJlYW0pID0+IChzdHJlYW0ubW9kaWZpZWQgPSB0cnVlKSk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICB9LAogICAgc29ydFN0cmVhbUFscGhhRG93bigpIHsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLnNvcnQoKGEsIGIpID0+IHsKICAgICAgICBzd2l0Y2ggKHRoaXMuYWN0aXZlR3JvdXBUeXBlKSB7CiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIHJldHVybiBhLnN0cmVhbV90dmdfbmFtZSA+IGIuc3RyZWFtX3R2Z19uYW1lCiAgICAgICAgICAgICAgPyAxCiAgICAgICAgICAgICAgOiBiLnN0cmVhbV90dmdfbmFtZSA+IGEuc3RyZWFtX3R2Z19uYW1lCiAgICAgICAgICAgICAgPyAtMQogICAgICAgICAgICAgIDogMDsKICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgcmV0dXJuIGEubW92aWVfbmFtZSA+IGIubW92aWVfbmFtZQogICAgICAgICAgICAgID8gMQogICAgICAgICAgICAgIDogYi5tb3ZpZV9uYW1lID4gYS5tb3ZpZV9uYW1lCiAgICAgICAgICAgICAgPyAtMQogICAgICAgICAgICAgIDogMDsKICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgcmV0dXJuIGEuc2VyaWVfbmFtZSA+IGIuc2VyaWVfbmFtZQogICAgICAgICAgICAgID8gMQogICAgICAgICAgICAgIDogYi5zZXJpZV9uYW1lID4gYS5zZXJpZV9uYW1lCiAgICAgICAgICAgICAgPyAtMQogICAgICAgICAgICAgIDogMDsKICAgICAgICB9CiAgICAgIH0pOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubWFwKChzdHJlYW0pID0+IChzdHJlYW0ubW9kaWZpZWQgPSB0cnVlKSk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICB9LAogICAgc29ydFN0cmVhbUhpZGRlblVwKCkgewogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMuc29ydCgoYSwgYikgPT4KICAgICAgICBiLnN0cmVhbV9pc19oaWRkZW4gPiBhLnN0cmVhbV9pc19oaWRkZW4KICAgICAgICAgID8gMQogICAgICAgICAgOiBhLnN0cmVhbV9pc19oaWRkZW4gPiBiLnN0cmVhbV9pc19oaWRkZW4KICAgICAgICAgID8gLTEKICAgICAgICAgIDogMAogICAgICApOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubWFwKChncm91cCkgPT4gKGdyb3VwLm1vZGlmaWVkID0gdHJ1ZSkpOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgfSwKICAgIHNvcnRTdHJlYW1IaWRkZW5Eb3duKCkgewogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMuc29ydCgoYSwgYikgPT4KICAgICAgICBhLnN0cmVhbV9pc19oaWRkZW4gPiBiLnN0cmVhbV9pc19oaWRkZW4KICAgICAgICAgID8gMQogICAgICAgICAgOiBiLnN0cmVhbV9pc19oaWRkZW4gPiBhLnN0cmVhbV9pc19oaWRkZW4KICAgICAgICAgID8gLTEKICAgICAgICAgIDogMAogICAgICApOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubWFwKChncm91cCkgPT4gKGdyb3VwLm1vZGlmaWVkID0gdHJ1ZSkpOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgfSwKICAgIGFkZEdyb3VwKCkgewogICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGh0dHBTZXJ2aWNlCiAgICAgICAgLnBvc3QoImVkaXRvci9hZGQtZ3JvdXAiLCB7IHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkIH0pCiAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIGlmIChyZXMuc3RhdHVzID09PSB0cnVlICYmIHJlcy5kYXRhKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLnB1c2gocmVzLmRhdGEpOwogICAgICAgICAgICAgIHRoaXMuYWN0aXZlR3JvdXAgPQogICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbCiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmxlbmd0aCAtIDEKICAgICAgICAgICAgICAgIF0uaWQ7CiAgICAgICAgICAgICAgdGhpcy5hY3RpdmVHcm91cHMgPSBbCiAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1sKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMubGVuZ3RoIC0gMQogICAgICAgICAgICAgICAgXS5pZCwKICAgICAgICAgICAgICBdOwogICAgICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICAgICAgfSkudGhlbigoKSA9PiB7CiAgICAgICAgICAgICAgdGhpcy5lZGl0R3JvdXBNb2RhbCh0cnVlKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIHRoaXMuJG5vdGlmeSgKICAgICAgICAgICAgImVycm9yIiwKICAgICAgICAgICAgdGhpcy4kdCgicHJvZmlsZS5mYWlsZWQiKSwKICAgICAgICAgICAgdGhpcy4kdCgiZWRpdG9yLmFkZC1ncm91cC1lcnJvciIpLAogICAgICAgICAgICAibGEtdXNlci1zaGllbGQiLAogICAgICAgICAgICB7IGR1cmF0aW9uOiA1MDAwLCBwZXJtYW5lbnQ6IGZhbHNlIH0KICAgICAgICAgICk7CiAgICAgICAgfSk7CiAgICB9LAogICAgYWRkU3RyZWFtKCkgewogICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGh0dHBTZXJ2aWNlCiAgICAgICAgLnBvc3QoImVkaXRvci9hZGQtc3RyZWFtIiwgewogICAgICAgICAgcGxheWxpc3RfaWQ6IHRoaXMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICBncm91cF9pZDogdGhpcy5nZXRHcm91cFdpdGhJZCh0aGlzLmFjdGl2ZUdyb3VwKS5pZCwKICAgICAgICAgIHN0cmVhbV90eXBlOiB0aGlzLmdldEdyb3VwV2l0aElkKHRoaXMuYWN0aXZlR3JvdXApLmdyb3VwX3R5cGUsCiAgICAgICAgfSkKICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgaWYgKHJlcy5zdGF0dXMgPT09IHRydWUgJiYgcmVzLmRhdGEpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLnVuc2hpZnQocmVzLmRhdGEpOwogICAgICAgICAgICAgIHRoaXMuYWN0aXZlU3RyZWFtID0KICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1sKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aCAtIDEKICAgICAgICAgICAgICAgIF0uaWQ7CiAgICAgICAgICAgICAgdGhpcy5hY3RpdmVTdHJlYW1zID0gWwogICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zWwogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoIC0gMQogICAgICAgICAgICAgICAgXS5pZCwKICAgICAgICAgICAgICBdOwogICAgICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICAgICAgfSkudGhlbigoKSA9PiB7CiAgICAgICAgICAgICAgdGhpcy5lZGl0U3RyZWFtTW9kYWwodHJ1ZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB0aGlzLiRub3RpZnkoCiAgICAgICAgICAgICJlcnJvciIsCiAgICAgICAgICAgIHRoaXMuJHQoInByb2ZpbGUuZmFpbGVkIiksCiAgICAgICAgICAgIHRoaXMuJHQoImVkaXRvci5hZGQtc3RyZWFtLWVycm9yIiksCiAgICAgICAgICAgICJsYS11c2VyLXNoaWVsZCIsCiAgICAgICAgICAgIHsgZHVyYXRpb246IDUwMDAsIHBlcm1hbmVudDogZmFsc2UgfQogICAgICAgICAgKTsKICAgICAgICB9KTsKICAgIH0sCiAgICBsb2FkU3RyZWFtcygpIHsKICAgICAgdGhpcy5hY3RpdmVTdHJlYW0gPSAtMTsKICAgICAgdGhpcy5hY3RpdmVTdHJlYW1zID0gW107CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcyA9IFtdOwogICAgICBsZXQgaW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoCiAgICAgICAgKGdyb3VwKSA9PiBncm91cC5pZCA9PT0gdGhpcy5hY3RpdmVHcm91cAogICAgICApOwogICAgICBsZXQgZ3JvdXAgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpbmRleF07CiAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAuZ2V0KAogICAgICAgICAgYGVkaXRvci9zdHJlYW1zLyR7dGhpcy5wbGF5bGlzdEVkaXRvci5pZH0vJHtncm91cC5pZH0vJHtncm91cC5ncm91cF90eXBlfWAKICAgICAgICApCiAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgZG9jdW1lbnQuYm9keS5zY3JvbGxUb3AgPSAwOwogICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcCA9IDA7CiAgICAgICAgICBpZiAocmVzLnN0YXR1cyA9PT0gdHJ1ZSkgewogICAgICAgICAgICBsZXQgc3RyZWFtcyA9IHJlcy5kYXRhLm1hcCgoc3RyZWFtKSA9PiB7CiAgICAgICAgICAgICAgY29uc3Qgc3RyID0gT2JqZWN0LmFzc2lnbih7fSwgc3RyZWFtKTsKICAgICAgICAgICAgICBzdHIuc291cmNlX3N0cmVhbV90dmdfbmFtZSA9IHN0cmVhbS5zdHJlYW1fdHZnX25hbWU7CiAgICAgICAgICAgICAgc3RyLnNvdXJjZV9zdHJlYW1fdHZnX2lkID0gc3RyZWFtLnN0cmVhbV90dmdfaWQ7CiAgICAgICAgICAgICAgc3RyLnNvdXJjZV9zdHJlYW1fdHZnX2xvZ28gPSBzdHJlYW0uc3RyZWFtX3R2Z19sb2dvOwogICAgICAgICAgICAgIHN0ci5zb3VyY2Vfc3RyZWFtX3R2Z19jaG5vID0gc3RyZWFtLnN0cmVhbV90dmdfY2hubzsKICAgICAgICAgICAgICBzdHIuc291cmNlX3N0cmVhbV90dmdfc2hpZnQgPSBzdHJlYW0uc3RyZWFtX3R2Z19zaGlmdDsKICAgICAgICAgICAgICBzdHIuc291cmNlX3N0cmVhbV9wYXJlbnRfY29kZSA9IHN0cmVhbS5zdHJlYW1fcGFyZW50X2NvZGU7CiAgICAgICAgICAgICAgc3RyLnNvdXJjZV9zdHJlYW1fYXVkaW9fdHJhY2sgPSBzdHJlYW0uc3RyZWFtX2F1ZGlvX3RyYWNrOwogICAgICAgICAgICAgIHN0ci5zb3VyY2Vfc3RyZWFtX2FzcGVjdF9yYXRpbyA9IHN0cmVhbS5zdHJlYW1fYXNwZWN0X3JhdGlvOwogICAgICAgICAgICAgIHN0ci5zb3VyY2Vfc3RyZWFtX3JhZGlvID0gc3RyZWFtLnN0cmVhbV9yYWRpbzsKICAgICAgICAgICAgICBzdHIuc291cmNlX3N0cmVhbV9vcmRlciA9IHN0cmVhbS5zdHJlYW1fb3JkZXI7CiAgICAgICAgICAgICAgc3RyLnNvdXJjZV9zdHJlYW1faXNfaGlkZGVuID0gc3RyZWFtLnN0cmVhbV9pc19oaWRkZW47CiAgICAgICAgICAgICAgc3RyLm1vZGlmaWVkID0gZmFsc2U7CiAgICAgICAgICAgICAgc3RyLnN0cmVhbV9pc19yZW1vdmVkID0gMDsKICAgICAgICAgICAgICBpZiAoZ3JvdXAuZ3JvdXBfdHlwZSA9PSAyKSB7CiAgICAgICAgICAgICAgICBpZiAoc3RyLm1vdmllX25hbWUgPT0gIiIpIHsKICAgICAgICAgICAgICAgICAgc3RyLm1vdmllX25hbWUgPSBzdHIuc3RyZWFtX3R2Z19uYW1lOwogICAgICAgICAgICAgICAgICBzdHIuc291cmNlX21vdmllX25hbWUgPSBzdHIuc3RyZWFtX3R2Z19uYW1lOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgc3RyLnNvdXJjZV9tb3ZpZV9uYW1lID0gc3RyZWFtLm1vdmllX25hbWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzdHIuc291cmNlX21vdmllX3llYXIgPSBzdHJlYW0ubW92aWVfeWVhcjsKICAgICAgICAgICAgICAgIHN0ci5zb3VyY2VfdG1kYl9pZCA9IHN0cmVhbS50bWRiX2lkOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoZ3JvdXAuZ3JvdXBfdHlwZSA9PSAzKSB7CiAgICAgICAgICAgICAgICBpZiAoc3RyLnNlcmllX25hbWUgPT0gIiIpIHsKICAgICAgICAgICAgICAgICAgc3RyLnNlcmllX25hbWUgPSBzdHIuc3RyZWFtX3R2Z19uYW1lOwogICAgICAgICAgICAgICAgICBzdHIuc291cmNlX3NlcmllX25hbWUgPSBzdHIuc3RyZWFtX3R2Z19uYW1lOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgc3RyLnNvdXJjZV9zZXJpZV9uYW1lID0gc3RyZWFtLnNlcmllX25hbWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzdHIuc291cmNlX3NlcmllX3NlYXNvbiA9IHN0cmVhbS5zZXJpZV9zZWFzb247CiAgICAgICAgICAgICAgICBzdHIuc291cmNlX3NlcmllX2VwaXNvZGUgPSBzdHJlYW0uc2VyaWVfZXBpc29kZTsKICAgICAgICAgICAgICAgIHN0ci5zb3VyY2VfdG1kYl9pZCA9IHN0cmVhbS50bWRiX2lkOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm4gc3RyOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgc3RyZWFtcy5zb3J0KChhLCBiKSA9PgogICAgICAgICAgICAgIGEuc291cmNlX3N0cmVhbV9vcmRlciA+IGIuc291cmNlX3N0cmVhbV9vcmRlcgogICAgICAgICAgICAgICAgPyAxCiAgICAgICAgICAgICAgICA6IGIuc291cmNlX3N0cmVhbV9vcmRlciA+IGEuc291cmNlX3N0cmVhbV9vcmRlcgogICAgICAgICAgICAgICAgPyAtMQogICAgICAgICAgICAgICAgOiAwCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcyA9IHN0cmVhbXM7CiAgICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgfSk7CiAgICB9LAogICAgbW92ZVRvU2VsZWN0ZWRHcm91cCgpIHsKICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBsZXQgc3RyZWFtcyA9IHRoaXMuYWN0aXZlU3RyZWFtcy5qb2luKCk7CiAgICAgIGxldCBpbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleCgoZ3JvdXApID0+IHsKICAgICAgICByZXR1cm4gZ3JvdXAuaWQgPT0gdGhpcy5hY3RpdmVHcm91cDsKICAgICAgfSk7CiAgICAgIGh0dHBTZXJ2aWNlCiAgICAgICAgLnBvc3QoYGVkaXRvci9tb3ZlLXRvLWdyb3VwLyR7dGhpcy5hY3RpdmVHcm91cFR5cGV9YCwgewogICAgICAgICAgcGxheWxpc3RfaWQ6IHRoaXMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICBzdHJlYW1zOiBzdHJlYW1zLAogICAgICAgICAgZ3JvdXBfaWQ6IHRoaXMuYWN0aXZlR3JvdXBzWzBdLAogICAgICAgIH0pCiAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIGlmIChyZXMuc3RhdHVzICYmIHJlcy5kYXRhKSB7CiAgICAgICAgICAgIHRoaXMubG9hZFBsYXlsaXN0KHRoaXMucGxheWxpc3RFZGl0b3IuaWQsIGluZGV4KTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0pOwogICAgfSwKICAgIHNhdmVDaGFuZ2VzTW9kYWwoc2hvdywgc2F2ZSA9IGZhbHNlKSB7CiAgICAgIHRoaXMuc2F2ZUNoYW5nZXMubW9kYWwgPSBzaG93OwogICAgICBpZiAoc2F2ZSkgewogICAgICAgIHRoaXMuZG9TYXZlKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5sb2FkU3RyZWFtcygpOwogICAgICB9CiAgICB9LAogICAgcmFkaW9Ccm93c2VyTW9kYWwoc2hvdywgc2F2ZSA9IGZhbHNlKSB7CiAgICAgIGlmIChzaG93KSB7CiAgICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuc2VhcmNoID0gIiI7CiAgICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIucmVzdWx0cyA9IFtdOwogICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZSA9IFtdOwogICAgICB9CiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlOwogICAgICAgIGxldCBncm91cEluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KChncm91cCkgPT4gewogICAgICAgICAgcmV0dXJuIGdyb3VwLmlkID09IHRoaXMuYWN0aXZlR3JvdXA7CiAgICAgICAgfSk7CiAgICAgICAgbGV0IG9yZGVyID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsKICAgICAgICBjb25zdCBzdHJlYW1zID0gdGhpcy5yYWRpb0Jyb3dzZXIuYWN0aXZlLm1hcCgoaW5kZXgpID0+IHsKICAgICAgICAgIGxldCByYWRpbyA9IHRoaXMucmFkaW9Ccm93c2VyLnJlc3VsdHNbaW5kZXhdOwogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgc291cmNlX3N0cmVhbV91cmw6IHJhZGlvLnVybCwKICAgICAgICAgICAgc3RyZWFtX3R2Z19uYW1lOiByYWRpby5uYW1lLAogICAgICAgICAgICBzdHJlYW1fdHZnX2lkOiAiIiwKICAgICAgICAgICAgc3RyZWFtX3R2Z19sb2dvOiByYWRpby5mYXZpY29uLAogICAgICAgICAgICBzdHJlYW1fcmFkaW86IHRydWUsCiAgICAgICAgICAgIHN0cmVhbV9vcmRlcjogb3JkZXIrKywKICAgICAgICAgIH07CiAgICAgICAgfSk7CiAgICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAgIC5wb3N0KGBlZGl0b3IvYWRkLXN0cmVhbXMvJHt0aGlzLmFjdGl2ZUdyb3VwVHlwZX1gLCB7CiAgICAgICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgICBncm91cF9pZDogdGhpcy5nZXRHcm91cFdpdGhJZCh0aGlzLmFjdGl2ZUdyb3VwKS5pZCwKICAgICAgICAgICAgc3RyZWFtczogc3RyZWFtcywKICAgICAgICAgIH0pCiAgICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgIGlmIChyZXMuc3RhdHVzKSB7CiAgICAgICAgICAgICAgdGhpcy5sb2FkUGxheWxpc3QodGhpcy5wbGF5bGlzdEVkaXRvci5pZCwgZ3JvdXBJbmRleCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pCiAgICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgfSk7CiAgICAgIH0KICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGZpbmRSYWRpb2Jyb3dzZXIoc2VhcmNoKSB7CiAgICAgIGlmIChzZWFyY2gubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIucmVzdWx0cyA9IFtdOwogICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZSA9IFtdOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLmlzTG9hZGluZyA9IHRydWU7CiAgICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAgIC5wb3N0KCJlZGl0b3IvZmluZC1yYWRpb2Jyb3dzZXIiLCB7CiAgICAgICAgICAgIHNlYXJjaDogc2VhcmNoLAogICAgICAgICAgfSkKICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuYWN0aXZlID0gW107CiAgICAgICAgICAgIGlmIChyZXMuc3RhdHVzKSB7CiAgICAgICAgICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIucmVzdWx0cyA9IHJlcy5kYXRhOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLnJlc3VsdHMgPSBbXTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnJhZGlvQnJvd3Nlci5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIH0pCiAgICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgICB0aGlzLnJhZGlvQnJvd3Nlci5hY3RpdmUgPSBbXTsKICAgICAgICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIucmVzdWx0cyA9IFtdOwogICAgICAgICAgICB0aGlzLnJhZGlvQnJvd3Nlci5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgc291bmRjbG91ZE1vZGFsKHNob3csIHNhdmUgPSBmYWxzZSkgewogICAgICBpZiAoc2hvdykgewogICAgICAgIHRoaXMuc291bmRjbG91ZC51cmwgPSAiIjsKICAgICAgICB0aGlzLnNvdW5kY2xvdWQudHJhY2sgPSBudWxsOwogICAgICB9CiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgaWYgKHRoaXMuc291bmRjbG91ZC50cmFjaykgewogICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgbGV0IGdyb3VwSW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoKGdyb3VwKSA9PiB7CiAgICAgICAgICAgIHJldHVybiBncm91cC5pZCA9PSB0aGlzLmFjdGl2ZUdyb3VwOwogICAgICAgICAgfSk7CiAgICAgICAgICBsZXQgb3JkZXIgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOwogICAgICAgICAgY29uc3Qgc3RyZWFtcyA9IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgIHNvdXJjZV9zdHJlYW1fdXJsOiB0aGlzLnNvdW5kY2xvdWQudXJsLAogICAgICAgICAgICAgIHN0cmVhbV90dmdfbmFtZTogdGhpcy5zb3VuZGNsb3VkLnRyYWNrLnRpdGxlLAogICAgICAgICAgICAgIHN0cmVhbV90dmdfaWQ6ICIiLAogICAgICAgICAgICAgIHN0cmVhbV90dmdfbG9nbzogdGhpcy5zb3VuZGNsb3VkLnRyYWNrLmFydHdvcmtfdXJsLnJlcGxhY2UoCiAgICAgICAgICAgICAgICAibGFyZ2UuanBnIiwKICAgICAgICAgICAgICAgICJ0NTAweDUwMC5qcGciCiAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICBzdHJlYW1fcmFkaW86IHRydWUsCiAgICAgICAgICAgICAgc3RyZWFtX29yZGVyOiBvcmRlcisrLAogICAgICAgICAgICB9LAogICAgICAgICAgXTsKICAgICAgICAgIGh0dHBTZXJ2aWNlCiAgICAgICAgICAgIC5wb3N0KGBlZGl0b3IvYWRkLXN0cmVhbXMvJHt0aGlzLmFjdGl2ZUdyb3VwVHlwZX1gLCB7CiAgICAgICAgICAgICAgcGxheWxpc3RfaWQ6IHRoaXMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICAgICAgZ3JvdXBfaWQ6IHRoaXMuZ2V0R3JvdXBXaXRoSWQodGhpcy5hY3RpdmVHcm91cCkuaWQsCiAgICAgICAgICAgICAgc3RyZWFtczogc3RyZWFtcywKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgaWYgKHJlcy5zdGF0dXMpIHsKICAgICAgICAgICAgICAgIHRoaXMubG9hZFBsYXlsaXN0KHRoaXMucGxheWxpc3RFZGl0b3IuaWQsIGdyb3VwSW5kZXgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy5zb3VuZGNsb3VkLm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBnZXRTb3VuZGNsb3VkVHJhY2sodXJsLCBjbGllbnRfaWQpIHsKICAgICAgaWYgKHVybC5sZW5ndGggPT09IDAgfHwgIS9zb3VuZGNsb3VkXC5jb20vLnRlc3QodXJsKSkgewogICAgICAgIHRoaXMuc291bmRjbG91ZC51cmwgPSAiIjsKICAgICAgICB0aGlzLnNvdW5kY2xvdWQudHJhY2sgPSBudWxsOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc291bmRjbG91ZC5pc0xvYWRpbmcgPSB0cnVlOwogICAgICAgIGh0dHBTZXJ2aWNlCiAgICAgICAgICAucG9zdCgiZWRpdG9yL3NvdW5kY2xvdWQtdHJhY2siLCB7CiAgICAgICAgICAgIHVybDogdXJsLAogICAgICAgICAgICBjbGllbnRfaWQ6IGNsaWVudF9pZCwKICAgICAgICAgIH0pCiAgICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgIGlmIChyZXMuc3RhdHVzICYmIE9iamVjdC5rZXlzKHJlcy5kYXRhKS5sZW5ndGgpIHsKICAgICAgICAgICAgICB0aGlzLnNvdW5kY2xvdWQudHJhY2sgPSByZXMuZGF0YTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0aGlzLnNvdW5kY2xvdWQudHJhY2sgPSBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuc291bmRjbG91ZC5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIH0pCiAgICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgICB0aGlzLnNvdW5kY2xvdWQudHJhY2sgPSBudWxsOwogICAgICAgICAgICB0aGlzLnNvdW5kY2xvdWQuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIHlvdXR1YmVNb2RhbChzaG93LCBzYXZlID0gZmFsc2UpIHsKICAgICAgaWYgKHNob3cpIHsKICAgICAgICB0aGlzLnlvdXR1YmUudXJsID0gIiI7CiAgICAgICAgdGhpcy55b3V0dWJlLnZpZGVvID0gbnVsbDsKICAgICAgICB0aGlzLnlvdXR1YmUuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0KICAgICAgaWYgKHNhdmUpIHsKICAgICAgICBpZiAodGhpcy55b3V0dWJlLnZpZGVvKSB7CiAgICAgICAgICB0aGlzLnlvdXR1YmUuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgIGxldCBncm91cEluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KChncm91cCkgPT4gewogICAgICAgICAgICByZXR1cm4gZ3JvdXAuaWQgPT0gdGhpcy5hY3RpdmVHcm91cDsKICAgICAgICAgIH0pOwogICAgICAgICAgbGV0IG9yZGVyID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsKICAgICAgICAgIGNvbnN0IHN0cmVhbXMgPSBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBzb3VyY2Vfc3RyZWFtX3VybDogdGhpcy55b3V0dWJlLnVybCwKICAgICAgICAgICAgICBzdHJlYW1fdHZnX25hbWU6IHRoaXMueW91dHViZS52aWRlby52aWRlb0RldGFpbHMudGl0bGUsCiAgICAgICAgICAgICAgc3RyZWFtX3R2Z19pZDogIiIsCiAgICAgICAgICAgICAgc3RyZWFtX3R2Z19sb2dvOiBgaHR0cDovL2kueXRpbWcuY29tL3ZpLyR7dGhpcy55b3V0dWJlLnZpZGVvSWR9L21heHJlc2RlZmF1bHQuanBnYCwKICAgICAgICAgICAgICBzdHJlYW1fb3JkZXI6IG9yZGVyKyssCiAgICAgICAgICAgIH0sCiAgICAgICAgICBdOwogICAgICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAgICAgLnBvc3QoYGVkaXRvci9hZGQtc3RyZWFtcy8ke3RoaXMuYWN0aXZlR3JvdXBUeXBlfWAsIHsKICAgICAgICAgICAgICBwbGF5bGlzdF9pZDogdGhpcy5wbGF5bGlzdEVkaXRvci5pZCwKICAgICAgICAgICAgICBncm91cF9pZDogdGhpcy5nZXRHcm91cFdpdGhJZCh0aGlzLmFjdGl2ZUdyb3VwKS5pZCwKICAgICAgICAgICAgICBzdHJlYW1zOiBzdHJlYW1zLAogICAgICAgICAgICB9KQogICAgICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgdGhpcy55b3V0dWJlLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgIGlmIChyZXMuc3RhdHVzKSB7CiAgICAgICAgICAgICAgICB0aGlzLmxvYWRQbGF5bGlzdCh0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLCBncm91cEluZGV4KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICAgICAgdGhpcy55b3V0dWJlLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy55b3V0dWJlLm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBnZXRZb3V0dWJlUGFnZSh2aWRlb0lkKSB7CiAgICAgIHRoaXMueW91dHViZS5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZQogICAgICAgIC5wb3N0KCJlZGl0b3IveW91dHViZS12aWRlbyIsIHsgdmlkZW9faWQ6IHZpZGVvSWQgfSkKICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICBpZiAocmVzLnN0YXR1cyAmJiBPYmplY3Qua2V5cyhyZXMuZGF0YSkubGVuZ3RoKSB7CiAgICAgICAgICAgIHRoaXMueW91dHViZS52aWRlbyA9IHJlcy5kYXRhOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy55b3V0dWJlLnZpZGVvID0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMueW91dHViZS5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICB0aGlzLnlvdXR1YmUudmlkZW8gPSBudWxsOwogICAgICAgICAgdGhpcy55b3V0dWJlLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0pOwogICAgfSwKICAgIHZpbWVvTW9kYWwoc2hvdywgc2F2ZSA9IGZhbHNlKSB7CiAgICAgIGlmIChzaG93KSB7CiAgICAgICAgdGhpcy52aW1lby51cmwgPSAiIjsKICAgICAgICB0aGlzLnZpbWVvLnZpZGVvID0gbnVsbDsKICAgICAgICB0aGlzLnZpbWVvLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9CiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgaWYgKHRoaXMudmltZW8udmlkZW8pIHsKICAgICAgICAgIHRoaXMudmltZW8uaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgIGxldCBncm91cEluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KChncm91cCkgPT4gewogICAgICAgICAgICByZXR1cm4gZ3JvdXAuaWQgPT0gdGhpcy5hY3RpdmVHcm91cDsKICAgICAgICAgIH0pOwogICAgICAgICAgbGV0IG9yZGVyID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsKICAgICAgICAgIGNvbnN0IHN0cmVhbXMgPSBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBzb3VyY2Vfc3RyZWFtX3VybDogdGhpcy52aW1lby51cmwsCiAgICAgICAgICAgICAgc3RyZWFtX3R2Z19uYW1lOiB0aGlzLnZpbWVvLnZpZGVvLnZpZGVvLnRpdGxlLAogICAgICAgICAgICAgIHN0cmVhbV90dmdfaWQ6ICIiLAogICAgICAgICAgICAgIHN0cmVhbV90dmdfbG9nbzogdGhpcy52aW1lby52aWRlby52aWRlby50aHVtYnMuYmFzZSwKICAgICAgICAgICAgICBzdHJlYW1fb3JkZXI6IG9yZGVyKyssCiAgICAgICAgICAgIH0sCiAgICAgICAgICBdOwogICAgICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAgICAgLnBvc3QoYGVkaXRvci9hZGQtc3RyZWFtcy8ke3RoaXMuYWN0aXZlR3JvdXBUeXBlfWAsIHsKICAgICAgICAgICAgICBwbGF5bGlzdF9pZDogdGhpcy5wbGF5bGlzdEVkaXRvci5pZCwKICAgICAgICAgICAgICBncm91cF9pZDogdGhpcy5nZXRHcm91cFdpdGhJZCh0aGlzLmFjdGl2ZUdyb3VwKS5pZCwKICAgICAgICAgICAgICBzdHJlYW1zOiBzdHJlYW1zLAogICAgICAgICAgICB9KQogICAgICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgdGhpcy52aW1lby5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICBpZiAocmVzLnN0YXR1cykgewogICAgICAgICAgICAgICAgdGhpcy5sb2FkUGxheWxpc3QodGhpcy5wbGF5bGlzdEVkaXRvci5pZCwgZ3JvdXBJbmRleCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgICAgIHRoaXMudmltZW8uaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLnZpbWVvLm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBnZXRWaW1lb0NvbmZpZyh2aWRlb0lkKSB7CiAgICAgIHRoaXMudmltZW8uaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAucG9zdCgiZWRpdG9yL3ZpbWVvLXZpZGVvIiwgeyB2aWRlb19pZDogdmlkZW9JZCB9KQogICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgIHRoaXMudmltZW8udmlkZW8gPSByZXMuZGF0YTsKICAgICAgICAgIHRoaXMudmltZW8uaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgfSk7CiAgICB9LAogICAgZGFpbHltb3Rpb25Nb2RhbChzaG93LCBzYXZlID0gZmFsc2UpIHsKICAgICAgaWYgKHNob3cpIHsKICAgICAgICB0aGlzLmRhaWx5bW90aW9uLnVybCA9ICIiOwogICAgICAgIHRoaXMuZGFpbHltb3Rpb24udmlkZW8gPSBudWxsOwogICAgICAgIHRoaXMuZGFpbHltb3Rpb24uaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0KICAgICAgaWYgKHNhdmUpIHsKICAgICAgICBpZiAodGhpcy5kYWlseW1vdGlvbi52aWRlbykgewogICAgICAgICAgdGhpcy5kYWlseW1vdGlvbi5pc0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgbGV0IGdyb3VwSW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoKGdyb3VwKSA9PiB7CiAgICAgICAgICAgIHJldHVybiBncm91cC5pZCA9PSB0aGlzLmFjdGl2ZUdyb3VwOwogICAgICAgICAgfSk7CiAgICAgICAgICBsZXQgb3JkZXIgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOwogICAgICAgICAgY29uc3Qgc3RyZWFtcyA9IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgIHNvdXJjZV9zdHJlYW1fdXJsOiB0aGlzLmRhaWx5bW90aW9uLnVybCwKICAgICAgICAgICAgICBzdHJlYW1fdHZnX25hbWU6IHRoaXMuZGFpbHltb3Rpb24udmlkZW8udGl0bGUsCiAgICAgICAgICAgICAgc3RyZWFtX3R2Z19pZDogIiIsCiAgICAgICAgICAgICAgc3RyZWFtX3R2Z19sb2dvOiB0aGlzLmRhaWx5bW90aW9uLnZpZGVvLnRodW1ibmFpbF8xMDgwX3VybCwKICAgICAgICAgICAgICBzdHJlYW1fb3JkZXI6IG9yZGVyKyssCiAgICAgICAgICAgIH0sCiAgICAgICAgICBdOwogICAgICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAgICAgLnBvc3QoYGVkaXRvci9hZGQtc3RyZWFtcy8ke3RoaXMuYWN0aXZlR3JvdXBUeXBlfWAsIHsKICAgICAgICAgICAgICBwbGF5bGlzdF9pZDogdGhpcy5wbGF5bGlzdEVkaXRvci5pZCwKICAgICAgICAgICAgICBncm91cF9pZDogdGhpcy5nZXRHcm91cFdpdGhJZCh0aGlzLmFjdGl2ZUdyb3VwKS5pZCwKICAgICAgICAgICAgICBzdHJlYW1zOiBzdHJlYW1zLAogICAgICAgICAgICB9KQogICAgICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgdGhpcy5kYWlseW1vdGlvbi5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICBpZiAocmVzLnN0YXR1cykgewogICAgICAgICAgICAgICAgdGhpcy5sb2FkUGxheWxpc3QodGhpcy5wbGF5bGlzdEVkaXRvci5pZCwgZ3JvdXBJbmRleCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgICAgIHRoaXMuZGFpbHltb3Rpb24uaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLmRhaWx5bW90aW9uLm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBnZXREYWlseW1vdGlvbkNvbmZpZyh2aWRlb0lkKSB7CiAgICAgIHRoaXMuZGFpbHltb3Rpb24uaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAucG9zdCgiZWRpdG9yL2RhaWx5bW90aW9uLXZpZGVvIiwgeyB2aWRlb19pZDogdmlkZW9JZCB9KQogICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgIHRoaXMuZGFpbHltb3Rpb24udmlkZW8gPSByZXMuZGF0YTsKICAgICAgICAgIHRoaXMuZGFpbHltb3Rpb24uaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgfSk7CiAgICB9LAogICAgdGVkVGFsa3NNb2RhbChzaG93LCBzYXZlID0gZmFsc2UpIHsKICAgICAgaWYgKHNob3cpIHsKICAgICAgICB0aGlzLnRlZFRhbGtzLnVybCA9ICIiOwogICAgICAgIHRoaXMudGVkVGFsa3MudmlkZW8gPSBudWxsOwogICAgICAgIHRoaXMudGVkVGFsa3MuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0KICAgICAgaWYgKHNhdmUpIHsKICAgICAgICBpZiAodGhpcy50ZWRUYWxrcy52aWRlbykgewogICAgICAgICAgdGhpcy50ZWRUYWxrcy5pc0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgbGV0IGdyb3VwSW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoKGdyb3VwKSA9PiB7CiAgICAgICAgICAgIHJldHVybiBncm91cC5pZCA9PSB0aGlzLmFjdGl2ZUdyb3VwOwogICAgICAgICAgfSk7CiAgICAgICAgICBsZXQgb3JkZXIgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOwogICAgICAgICAgY29uc3Qgc3RyZWFtcyA9IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgIHNvdXJjZV9zdHJlYW1fdXJsOiB0aGlzLnRlZFRhbGtzLnVybCwKICAgICAgICAgICAgICBzdHJlYW1fdHZnX25hbWU6IHRoaXMudGVkVGFsa3MudmlkZW8udGl0bGUsCiAgICAgICAgICAgICAgc3RyZWFtX3R2Z19pZDogIiIsCiAgICAgICAgICAgICAgc3RyZWFtX3R2Z19sb2dvOiB0aGlzLnRlZFRhbGtzLnZpZGVvLmhlcm8sCiAgICAgICAgICAgICAgc3RyZWFtX29yZGVyOiBvcmRlcisrLAogICAgICAgICAgICB9LAogICAgICAgICAgXTsKICAgICAgICAgIGh0dHBTZXJ2aWNlCiAgICAgICAgICAgIC5wb3N0KGBlZGl0b3IvYWRkLXN0cmVhbXMvJHt0aGlzLmFjdGl2ZUdyb3VwVHlwZX1gLCB7CiAgICAgICAgICAgICAgcGxheWxpc3RfaWQ6IHRoaXMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICAgICAgZ3JvdXBfaWQ6IHRoaXMuZ2V0R3JvdXBXaXRoSWQodGhpcy5hY3RpdmVHcm91cCkuaWQsCiAgICAgICAgICAgICAgc3RyZWFtczogc3RyZWFtcywKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgIHRoaXMudGVkVGFsa3MuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgaWYgKHJlcy5zdGF0dXMpIHsKICAgICAgICAgICAgICAgIHRoaXMubG9hZFBsYXlsaXN0KHRoaXMucGxheWxpc3RFZGl0b3IuaWQsIGdyb3VwSW5kZXgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgICAgICB0aGlzLnRlZFRhbGtzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy50ZWRUYWxrcy5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgZ2V0VGVkVGFsa3NDb25maWcodXJsKSB7CiAgICAgIHRoaXMudGVkVGFsa3MuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UucG9zdCgiZWRpdG9yL3RlZC10YWxrcy12aWRlbyIsIHsgdXJsOiB1cmwgfSkudGhlbigocmVzKSA9PiB7CiAgICAgICAgdGhpcy50ZWRUYWxrcy52aWRlbyA9IHJlcy5kYXRhLnRhbGtzLmxlbmd0aCA/IHJlcy5kYXRhLnRhbGtzWzBdIDogbnVsbDsKICAgICAgICB0aGlzLnRlZFRhbGtzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9KTsKICAgIH0sCiAgICB4aGFtc3Rlck1vZGFsKHNob3csIHNhdmUgPSBmYWxzZSkgewogICAgICBpZiAoc2hvdykgewogICAgICAgIHRoaXMueGhhbXN0ZXIudXJsID0gIiI7CiAgICAgICAgdGhpcy54aGFtc3Rlci52aWRlbyA9IG51bGw7CiAgICAgICAgdGhpcy54aGFtc3Rlci5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfQogICAgICBpZiAoc2F2ZSkgewogICAgICAgIGlmICh0aGlzLnhoYW1zdGVyLnZpZGVvKSB7CiAgICAgICAgICB0aGlzLnhoYW1zdGVyLmlzTG9hZGluZyA9IHRydWU7CiAgICAgICAgICBsZXQgZ3JvdXBJbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleCgoZ3JvdXApID0+IHsKICAgICAgICAgICAgcmV0dXJuIGdyb3VwLmlkID09IHRoaXMuYWN0aXZlR3JvdXA7CiAgICAgICAgICB9KTsKICAgICAgICAgIGxldCBvcmRlciA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7CiAgICAgICAgICBjb25zdCBzdHJlYW1zID0gWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgc291cmNlX3N0cmVhbV91cmw6IHRoaXMueGhhbXN0ZXIudXJsLAogICAgICAgICAgICAgIHN0cmVhbV90dmdfbmFtZTogdGhpcy54aGFtc3Rlci52aWRlby52aWRlb0VudGl0eS50aXRsZSwKICAgICAgICAgICAgICBzdHJlYW1fdHZnX2lkOiAiIiwKICAgICAgICAgICAgICBzdHJlYW1fdHZnX2xvZ286IHRoaXMueGhhbXN0ZXIudmlkZW8udmlkZW9FbnRpdHkudGh1bWJCaWcsCiAgICAgICAgICAgICAgc3RyZWFtX29yZGVyOiBvcmRlcisrLAogICAgICAgICAgICB9LAogICAgICAgICAgXTsKICAgICAgICAgIGh0dHBTZXJ2aWNlCiAgICAgICAgICAgIC5wb3N0KGBlZGl0b3IvYWRkLXN0cmVhbXMvJHt0aGlzLmFjdGl2ZUdyb3VwVHlwZX1gLCB7CiAgICAgICAgICAgICAgcGxheWxpc3RfaWQ6IHRoaXMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICAgICAgZ3JvdXBfaWQ6IHRoaXMuZ2V0R3JvdXBXaXRoSWQodGhpcy5hY3RpdmVHcm91cCkuaWQsCiAgICAgICAgICAgICAgc3RyZWFtczogc3RyZWFtcywKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgIHRoaXMueGhhbXN0ZXIuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgaWYgKHJlcy5zdGF0dXMpIHsKICAgICAgICAgICAgICAgIHRoaXMubG9hZFBsYXlsaXN0KHRoaXMucGxheWxpc3RFZGl0b3IuaWQsIGdyb3VwSW5kZXgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgICAgICB0aGlzLnhoYW1zdGVyLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy54aGFtc3Rlci5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgZ2V0WGhhbXN0ZXJDb25maWcodXJsKSB7CiAgICAgIHRoaXMueGhhbXN0ZXIuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UucG9zdCgiZWRpdG9yL3hoYW1zdGVyLXZpZGVvIiwgeyB1cmw6IHVybCB9KS50aGVuKChyZXMpID0+IHsKICAgICAgICB0aGlzLnhoYW1zdGVyLnZpZGVvID0gcmVzLmRhdGE7CiAgICAgICAgdGhpcy54aGFtc3Rlci5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfSk7CiAgICB9LAogICAgZ3JvdXBEb3VibGVDbGljaygpIHsKICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBzLmxlbmd0aCA9PT0gMSkgewogICAgICAgIHRoaXMuZWRpdEdyb3VwTW9kYWwodHJ1ZSk7CiAgICAgIH0KICAgIH0sCiAgICBzdHJlYW1Eb3VibGVDbGljaygpIHsKICAgICAgaWYgKHRoaXMuYWN0aXZlU3RyZWFtcy5sZW5ndGggPT09IDEpIHsKICAgICAgICB0aGlzLmVkaXRTdHJlYW1Nb2RhbCh0cnVlKTsKICAgICAgfQogICAgfSwKICAgIGxvYWRMb2dvQ291bnRyaWVzKCkgewogICAgICB0aGlzLmZpbmRMb2dvLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGh0dHBTZXJ2aWNlCiAgICAgICAgLmdldCgiZWRpdG9yL2xvZ28tY291bnRyaWVzIikKICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICB0aGlzLmZpbmRMb2dvLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgdGhpcy5maW5kTG9nby5jb3VudHJpZXMgPSByZXMuZGF0YQogICAgICAgICAgICAubWFwKChjb3VudHJ5KSA9PiB7CiAgICAgICAgICAgICAgbGV0IGNuID0gdGhpcy5jb3VudHJpZXMuZmluZCgKICAgICAgICAgICAgICAgIChjbnQpID0+IGNudC5jb2RlLnRvTG93ZXJDYXNlKCkgPT0gY291bnRyeS50b0xvd2VyQ2FzZSgpCiAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgdGV4dDogY24gPyBjbi5uYW1lIDogY291bnRyeSwKICAgICAgICAgICAgICAgIHZhbHVlOiBjb3VudHJ5LAogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5zb3J0KChhLCBiKSA9PiB7CiAgICAgICAgICAgICAgcmV0dXJuIGEudGV4dC50b1VwcGVyQ2FzZSgpIDwgYi50ZXh0LnRvVXBwZXJDYXNlKCkKICAgICAgICAgICAgICAgID8gLTEKICAgICAgICAgICAgICAgIDogYS50ZXh0LnRvVXBwZXJDYXNlKCkgPiBiLnRleHQudG9VcHBlckNhc2UoKQogICAgICAgICAgICAgICAgPyAxCiAgICAgICAgICAgICAgICA6IDA7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgdGhpcy5hc3NpZ25Mb2dvLmNvdW50cmllcyA9IFsuLi50aGlzLmZpbmRMb2dvLmNvdW50cmllc107CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgdGhpcy5maW5kTG9nby5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICB9KTsKICAgIH0sCiAgICBsb2FkVFZHSURDb3VudHJpZXMoKSB7CiAgICAgIHRoaXMuYXNzaWduVFZHSUQuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAuZ2V0KCJlZGl0b3IvdHYtZ3VpZGUtY291bnRyaWVzIikKICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICB0aGlzLmFzc2lnblRWR0lELmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgdGhpcy5hc3NpZ25UVkdJRC5jb3VudHJpZXMgPSByZXMuZGF0YQogICAgICAgICAgICAubWFwKChjb3VudHJ5KSA9PiB7CiAgICAgICAgICAgICAgbGV0IGNuID0gdGhpcy5jb3VudHJpZXMuZmluZCgKICAgICAgICAgICAgICAgIChjbnQpID0+IGNudC5jb2RlLnRvTG93ZXJDYXNlKCkgPT0gY291bnRyeS50b0xvd2VyQ2FzZSgpCiAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgdGV4dDogY24gPyBjbi5uYW1lIDogY291bnRyeSwKICAgICAgICAgICAgICAgIHZhbHVlOiBjb3VudHJ5LAogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5zb3J0KChhLCBiKSA9PiB7CiAgICAgICAgICAgICAgcmV0dXJuIGEudGV4dC50b1VwcGVyQ2FzZSgpIDwgYi50ZXh0LnRvVXBwZXJDYXNlKCkKICAgICAgICAgICAgICAgID8gLTEKICAgICAgICAgICAgICAgIDogYS50ZXh0LnRvVXBwZXJDYXNlKCkgPiBiLnRleHQudG9VcHBlckNhc2UoKQogICAgICAgICAgICAgICAgPyAxCiAgICAgICAgICAgICAgICA6IDA7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgdGhpcy5hc3NpZ25UVkdJRC5jb3VudHJpZXMudW5zaGlmdCh7CiAgICAgICAgICAgIHRleHQ6IHRoaXMuJHQoImdlbmVyYWwuYWxsIiksCiAgICAgICAgICAgIHZhbHVlOiAiYWxsIiwKICAgICAgICAgIH0pOwogICAgICAgICAgdGhpcy5maW5kVFZHSUQuY291bnRyaWVzID0gWy4uLnRoaXMuYXNzaWduVFZHSUQuY291bnRyaWVzXTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICB0aGlzLmFzc2lnblRWR0lELmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0pOwogICAgfSwKICAgIGxvYWRMb2dvc0ZpbmQoY291bnRyeSkgewogICAgICB0aGlzLmZpbmRMb2dvLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGh0dHBTZXJ2aWNlCiAgICAgICAgLmdldChgZWRpdG9yL2xvZ29zLyR7Y291bnRyeX1gKQogICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgIHRoaXMuZmluZExvZ28ubG9nbyA9ICIiOwogICAgICAgICAgdGhpcy5maW5kTG9nby5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIHRoaXMuZmluZExvZ28ubG9nb3MgPSByZXMuZGF0YS5tYXAoKGxvZ28pID0+IHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICB0ZXh0OiBsb2dvLmxhYmVsLAogICAgICAgICAgICAgIHZhbHVlOiBsb2dvLmZpbGVuYW1lLAogICAgICAgICAgICB9OwogICAgICAgICAgfSk7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgdGhpcy5maW5kTG9nby5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICB9KTsKICAgIH0sCiAgICBmaW5kTG9nb01vZGFsKHNob3csIHNhdmUgPSBmYWxzZSkgewogICAgICBsZXQgc2VsZWN0ZWQgPSB0aGlzLmdldFN0cmVhbVdpdGhJZCh0aGlzLmFjdGl2ZVN0cmVhbXNbMF0pOwogICAgICBpZiAoc2hvdykgewogICAgICAgIHRoaXMuZmluZExvZ28ubG9nbyA9ICIiOwogICAgICAgIHRoaXMuZmluZExvZ28udGl0bGUgPSBzZWxlY3RlZC5zdHJlYW1fdHZnX25hbWU7CiAgICAgIH0KICAgICAgdGhpcy5maW5kTG9nby5zZWFyY2ggPSAiIjsKICAgICAgaWYgKHNhdmUpIHsKICAgICAgICBpZiAoc2VsZWN0ZWQpIHsKICAgICAgICAgIHNlbGVjdGVkLnN0cmVhbV90dmdfbG9nbyA9IGBodHRwOi8vc3RhdGljLmlwdHYtdG9vbHMuY29tLyR7dGhpcy5maW5kTG9nby5jb3VudHJ5fS8ke3RoaXMuZmluZExvZ28ubG9nb31gOwogICAgICAgICAgc2VsZWN0ZWQubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy5maW5kTG9nby5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgbG9hZExvZ29zQXNzaWduKGNvdW50cnkpIHsKICAgICAgdGhpcy5hc3NpZ25Mb2dvLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGh0dHBTZXJ2aWNlCiAgICAgICAgLmdldChgZWRpdG9yL2xvZ29zLyR7Y291bnRyeX1gKQogICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgIHRoaXMuYXNzaWduTG9nby5sb2dvID0gIiI7CiAgICAgICAgICB0aGlzLmFzc2lnbkxvZ28uaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB0aGlzLmFzc2lnbkxvZ28ubG9nb3MgPSByZXMuZGF0YS5tYXAoKGxvZ28pID0+IGxvZ28uZmlsZW5hbWUpOwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgIHRoaXMuYXNzaWduTG9nby5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICB9KTsKICAgIH0sCiAgICBhc3NpZ25Mb2dvTW9kYWwoc2hvdywgc2F2ZSA9IGZhbHNlKSB7CiAgICAgIGlmIChzaG93KSB7CiAgICAgICAgdGhpcy5hc3NpZ25Mb2dvLmxvZ28gPSAiIjsKICAgICAgfQogICAgICBpZiAoc2F2ZSkgewogICAgICAgIHZhciBjaGFuZ2VkID0gZmFsc2U7CiAgICAgICAgdmFyIHN0cmluZ1NpbWlsYXJpdHkgPSByZXF1aXJlKCJzdHJpbmctc2ltaWxhcml0eSIpOwogICAgICAgIGxldCBzdHJlYW1zID0gW107CiAgICAgICAgaWYgKHRoaXMuYXNzaWduTG9nby5hc3NpZ25BbGwgPT0gMSkgewogICAgICAgICAgc3RyZWFtcyA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtczsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc3RyZWFtcyA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5maWx0ZXIoCiAgICAgICAgICAgIChzdHJlYW0pID0+ICFzdHJlYW0uc3RyZWFtX3R2Z19sb2dvLmxlbmd0aAogICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgc3RyZWFtcy5tYXAoKHN0cmVhbSkgPT4gewogICAgICAgICAgbGV0IG1hdGNoMSA9IHN0cmluZ1NpbWlsYXJpdHkuZmluZEJlc3RNYXRjaCgKICAgICAgICAgICAgU3RyaW5nKHN0cmVhbS5zdHJlYW1fdHZnX25hbWUpLnJlcGxhY2UoLyBoZCQvaSwgIiIpLAogICAgICAgICAgICB0aGlzLmFzc2lnbkxvZ28ubG9nb3MKICAgICAgICAgICkuYmVzdE1hdGNoOwogICAgICAgICAgbGV0IG1hdGNoMiA9IHN0cmluZ1NpbWlsYXJpdHkuZmluZEJlc3RNYXRjaCgKICAgICAgICAgICAgU3RyaW5nKHN0cmVhbS5zdHJlYW1fdHZnX2lkKSwKICAgICAgICAgICAgdGhpcy5hc3NpZ25Mb2dvLmxvZ29zCiAgICAgICAgICApLmJlc3RNYXRjaDsKICAgICAgICAgIGlmIChtYXRjaDEucmF0aW5nID49IDAuMykgewogICAgICAgICAgICBjaGFuZ2VkID0gdHJ1ZTsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfbG9nbyA9IGBodHRwOi8vc3RhdGljLmlwdHYtdG9vbHMuY29tLyR7dGhpcy5hc3NpZ25Mb2dvLmNvdW50cnl9LyR7bWF0Y2gxLnRhcmdldH1gOwogICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgfSBlbHNlIGlmIChtYXRjaDIucmF0aW5nID49IDAuNSkgewogICAgICAgICAgICBjaGFuZ2VkID0gdHJ1ZTsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfbG9nbyA9IGBodHRwOi8vc3RhdGljLmlwdHYtdG9vbHMuY29tLyR7dGhpcy5hc3NpZ25Mb2dvLmNvdW50cnl9LyR7bWF0Y2gyLnRhcmdldH1gOwogICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IGNoYW5nZWQ7CiAgICAgIH0KICAgICAgdGhpcy5hc3NpZ25Mb2dvLm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBsb2FkVFZHSURBc3NpZ24oY291bnRyeSkgewogICAgICB0aGlzLmFzc2lnblRWR0lELmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGh0dHBTZXJ2aWNlCiAgICAgICAgLmdldChgZWRpdG9yL3R2LWd1aWRlLyR7Y291bnRyeX1gKQogICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgIHRoaXMuYXNzaWduVFZHSUQuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB0aGlzLmFzc2lnblRWR0lELmNoYW5uZWxzID0gcmVzLmRhdGE7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgdGhpcy5hc3NpZ25UVkdJRC5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICB9KTsKICAgIH0sCiAgICBhc3NpZ25UVkdJRE1vZGFsKHNob3csIHNhdmUgPSBmYWxzZSkgewogICAgICBpZiAoc2F2ZSkgewogICAgICAgIHZhciBjaGFuZ2VkID0gZmFsc2U7CiAgICAgICAgdmFyIHN0cmluZ1NpbWlsYXJpdHkgPSByZXF1aXJlKCJzdHJpbmctc2ltaWxhcml0eSIpOwogICAgICAgIGxldCBzdHJlYW1zID0gW107CiAgICAgICAgaWYgKHRoaXMuYXNzaWduVFZHSUQuYXNzaWduQWxsID09IDEpIHsKICAgICAgICAgIHN0cmVhbXMgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXM7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN0cmVhbXMgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMuZmlsdGVyKAogICAgICAgICAgICAoc3RyZWFtKSA9PgogICAgICAgICAgICAgICFzdHJlYW0uc3RyZWFtX3R2Z19pZC5sZW5ndGggfHwgc3RyZWFtLnN0cmVhbV90dmdfaWQubGVuZ3RoID09IDAKICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIGxldCBjaGFubmVsTmFtZXMgPSB0aGlzLmFzc2lnblRWR0lELmNoYW5uZWxzLm1hcCgKICAgICAgICAgIChjaGFubmVsKSA9PiBjaGFubmVsLnR2Z19uYW1lLnRvTG93ZXJDYXNlKCkKICAgICAgICApOwogICAgICAgIGxldCBjaGFubmVsSWRzID0gdGhpcy5hc3NpZ25UVkdJRC5jaGFubmVscy5tYXAoCiAgICAgICAgICAoY2hhbm5lbCkgPT4gY2hhbm5lbC50dmdfaWQudG9Mb3dlckNhc2UoKQogICAgICAgICk7CiAgICAgICAgc3RyZWFtcy5tYXAoKHN0cmVhbSkgPT4gewogICAgICAgICAgbGV0IG1hdGNoMSA9IHN0cmluZ1NpbWlsYXJpdHkuZmluZEJlc3RNYXRjaCgKICAgICAgICAgICAgU3RyaW5nKHN0cmVhbS5zdHJlYW1fdHZnX25hbWUpLnRvTG93ZXJDYXNlKCksCiAgICAgICAgICAgIGNoYW5uZWxOYW1lcwogICAgICAgICAgKS5iZXN0TWF0Y2g7CiAgICAgICAgICBsZXQgbWF0Y2gyID0gc3RyaW5nU2ltaWxhcml0eS5maW5kQmVzdE1hdGNoKAogICAgICAgICAgICBTdHJpbmcoc3RyZWFtLnN0cmVhbV90dmdfaWQpLnRvTG93ZXJDYXNlKCksCiAgICAgICAgICAgIGNoYW5uZWxJZHMKICAgICAgICAgICkuYmVzdE1hdGNoOwogICAgICAgICAgbGV0IG1hdGNoMyA9IHN0cmluZ1NpbWlsYXJpdHkuZmluZEJlc3RNYXRjaCgKICAgICAgICAgICAgU3RyaW5nKHN0cmVhbS5zdHJlYW1fdHZnX25hbWUpLnJlcGxhY2UoCiAgICAgICAgICAgICAgLyBoZCR8IGZoZCR8IGhldmMkfCBoMjY1JHwvaSwKICAgICAgICAgICAgICAiIgogICAgICAgICAgICApLnRvTG93ZXJDYXNlKCksCiAgICAgICAgICAgIGNoYW5uZWxOYW1lcwogICAgICAgICAgKS5iZXN0TWF0Y2g7CiAgICAgICAgICBpZiAobWF0Y2gyLnJhdGluZyA+PSAwLjc1KSB7CiAgICAgICAgICAgIGNoYW5nZWQgPSB0cnVlOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19pZCA9IG1hdGNoMi50YXJnZXQ7CiAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICB9IGVsc2UgaWYgKG1hdGNoMS5yYXRpbmcgPj0gMC43NSkgewogICAgICAgICAgICBjaGFuZ2VkID0gdHJ1ZTsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfaWQgPSB0aGlzLmFzc2lnblRWR0lELmNoYW5uZWxzLmZpbmQoCiAgICAgICAgICAgICAgKGNoYW5uZWwpID0+IGNoYW5uZWwudHZnX25hbWUudG9Mb3dlckNhc2UoKSA9PT0gbWF0Y2gxLnRhcmdldAogICAgICAgICAgICApLnR2Z19pZDsKICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgIH0gZWxzZSBpZiAobWF0Y2gzLnJhdGluZyA+PSAwLjc1KSB7CiAgICAgICAgICAgIGNoYW5nZWQgPSB0cnVlOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19pZCA9IHRoaXMuYXNzaWduVFZHSUQuY2hhbm5lbHMuZmluZCgKICAgICAgICAgICAgICAoY2hhbm5lbCkgPT4gY2hhbm5lbC50dmdfbmFtZS50b0xvd2VyQ2FzZSgpID09PSBtYXRjaDEudGFyZ2V0CiAgICAgICAgICAgICkudHZnX2lkOwogICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY2hhbmdlZCA9IHRydWU7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX2lkID0gIiI7CiAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gY2hhbmdlZDsKICAgICAgfQogICAgICB0aGlzLmFzc2lnblRWR0lELm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBsb2FkVFZHSURGaW5kKGNvdW50cnkpIHsKICAgICAgdGhpcy5maW5kVFZHSUQuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAuZ2V0KGBlZGl0b3IvdHYtZ3VpZGUvJHtjb3VudHJ5fWApCiAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgdGhpcy5maW5kVFZHSUQuY2hhbm5lbCA9ICIiOwogICAgICAgICAgdGhpcy5maW5kVFZHSUQuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB0aGlzLmZpbmRUVkdJRC5jaGFubmVscyA9IHJlcy5kYXRhLm1hcCgoY2hhbm5lbCkgPT4gewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIHRleHQ6IGNoYW5uZWwudHZnX25hbWUsCiAgICAgICAgICAgICAgdmFsdWU6IGNoYW5uZWwudHZnX2lkLAogICAgICAgICAgICB9OwogICAgICAgICAgfSk7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgdGhpcy5maW5kVFZHSUQuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgfSk7CiAgICB9LAogICAgZmluZFRWR0lETW9kYWwoc2hvdywgc2F2ZSA9IGZhbHNlKSB7CiAgICAgIGxldCBzZWxlY3RlZCA9IHRoaXMuZ2V0U3RyZWFtV2l0aElkKHRoaXMuYWN0aXZlU3RyZWFtc1swXSk7CiAgICAgIGlmIChzaG93KSB7CiAgICAgICAgdGhpcy5maW5kVFZHSUQuY2hhbm5lbCA9ICIiOwogICAgICAgIHRoaXMuZmluZFRWR0lELnRpdGxlID0gc2VsZWN0ZWQuc3RyZWFtX3R2Z19uYW1lOwogICAgICB9CiAgICAgIHRoaXMuZmluZFRWR0lELnNlYXJjaCA9ICIiOwogICAgICBpZiAoc2F2ZSkgewogICAgICAgIGlmIChzZWxlY3RlZCkgewogICAgICAgICAgc2VsZWN0ZWQuc3RyZWFtX3R2Z19pZCA9IHRoaXMuZmluZFRWR0lELmNoYW5uZWw7CiAgICAgICAgICBzZWxlY3RlZC5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLmZpbmRUVkdJRC5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgaW1wb3J0TTNVTW9kYWwoc2hvdywgc2F2ZSA9IGZhbHNlKSB7CiAgICAgIGlmIChzaG93KSB7CiAgICAgICAgdGhpcy5pbXBvcnRNM1UuZmlsZSA9IG51bGw7CiAgICAgICAgdGhpcy5pbXBvcnRNM1UubTN1ID0gbnVsbDsKICAgICAgICB0aGlzLmltcG9ydE0zVS5ncm91cHMgPSBbXTsKICAgICAgICB0aGlzLmltcG9ydE0zVS5pbXBvcnRHcm91cHMgPSBbXTsKICAgICAgfQogICAgICBpZiAoc2F2ZSkgewogICAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgICBsZXQgZ3JvdXBJbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleCgoZ3JvdXApID0+IHsKICAgICAgICAgIHJldHVybiBncm91cC5pZCA9PSB0aGlzLmFjdGl2ZUdyb3VwOwogICAgICAgIH0pOwogICAgICAgIGh0dHBTZXJ2aWNlCiAgICAgICAgICAucG9zdCgiZWRpdG9yL2ltcG9ydCIsIHsKICAgICAgICAgICAgcGxheWxpc3RfaWQ6IHRoaXMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICAgIGltcG9ydDogdGhpcy5pbXBvcnRNM1UuZ3JvdXBzLmZpbHRlcigoZ3JvdXAsIGluZGV4KSA9PgogICAgICAgICAgICAgIHRoaXMuaW1wb3J0TTNVLmltcG9ydEdyb3Vwcy5pbmNsdWRlcyhpbmRleCkKICAgICAgICAgICAgKSwKICAgICAgICAgIH0pCiAgICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgIGlmIChyZXMuc3RhdHVzKSB7CiAgICAgICAgICAgICAgdGhpcy5sb2FkUGxheWxpc3QodGhpcy5wbGF5bGlzdEVkaXRvci5pZCwgZ3JvdXBJbmRleCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pCiAgICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgfSk7CiAgICAgIH0KICAgICAgdGhpcy5pbXBvcnRNM1UubW9kYWwgPSBzaG93OwogICAgfSwKICAgIHVwbG9hZE0zVShldmVudCkgewogICAgICBjb25zdCBpbnB1dCA9IGV2ZW50LnRhcmdldDsKICAgICAgaWYgKCJmaWxlcyIgaW4gaW5wdXQgJiYgaW5wdXQuZmlsZXMubGVuZ3RoID4gMCkgewogICAgICAgIHRoaXMuaW1wb3J0TTNVLmlzTG9hZGluZyA9IHRydWU7CiAgICAgICAgdGhpcy5yZWFkRmlsZUNvbnRlbnQoaW5wdXQuZmlsZXNbMF0pCiAgICAgICAgICAudGhlbigoY29udGVudCkgPT4gewogICAgICAgICAgICB0aGlzLmltcG9ydE0zVS5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5wYXJzZU0zVShjb250ZW50KTsKICAgICAgICAgIH0pCiAgICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7CiAgICAgICAgICAgIHRoaXMuJG5vdGlmeSgKICAgICAgICAgICAgICAiZXJyb3IiLAogICAgICAgICAgICAgIHRoaXMuJHQoInByb2ZpbGUuZmFpbGVkIiksCiAgICAgICAgICAgICAgZXJyb3IsCiAgICAgICAgICAgICAgImxhLXVzZXItc2hpZWxkIiwKICAgICAgICAgICAgICB7IGR1cmF0aW9uOiA1MDAwLCBwZXJtYW5lbnQ6IGZhbHNlIH0KICAgICAgICAgICAgKTsKICAgICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgcGFyc2VNM1UoY29udGVudCkgewogICAgICBsZXQgdm0gPSB0aGlzOwogICAgICB2bS5pbXBvcnRNM1UuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgbTN1CiAgICAgICAgLnBhcnNlKAogICAgICAgICAgY29udGVudCwKICAgICAgICAgIHsgdGFnOiAibmFtZSIsIHR5cGU6IFsiTW92aWUiLCAiU2VyaWVzIiwgIlZPRCIsICJMaXZlIl0gfSwKICAgICAgICAgIHRydWUKICAgICAgICApCiAgICAgICAgLnRoZW4oKHBsYXlsaXN0KSA9PiB7CiAgICAgICAgICB0aGlzLmltcG9ydE0zVS5tM3UgPSBwbGF5bGlzdDsKICAgICAgICAgIHRoaXMuaW1wb3J0TTNVLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgdGhpcy5pbXBvcnRNM1UuZ3JvdXBzID0gcGxheWxpc3QuZ3JvdXBzOwogICAgICAgICAgdGhpcy5pbXBvcnRNM1UuaW1wb3J0R3JvdXBzID0gW107CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7CiAgICAgICAgICB2bS5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIHZtLiRub3RpZnkoCiAgICAgICAgICAgICJlcnJvciIsCiAgICAgICAgICAgIHZtLiR0KCJwcm9maWxlLmZhaWxlZCIpLAogICAgICAgICAgICBlcnJvciwKICAgICAgICAgICAgImxhLXVzZXItc2hpZWxkIiwKICAgICAgICAgICAgeyBkdXJhdGlvbjogNTAwMCwgcGVybWFuZW50OiBmYWxzZSB9CiAgICAgICAgICApOwogICAgICAgIH0pOwogICAgfSwKICAgIHJlYWRGaWxlQ29udGVudChmaWxlKSB7CiAgICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgICAgcmVhZGVyLm9ubG9hZCA9IChldmVudCkgPT4gcmVzb2x2ZShldmVudC50YXJnZXQucmVzdWx0KTsKICAgICAgICByZWFkZXIub25lcnJvciA9IChlcnJvcikgPT4gcmVqZWN0KGVycm9yKTsKICAgICAgICByZWFkZXIucmVhZEFzVGV4dChmaWxlKTsKICAgICAgfSk7CiAgICB9LAogIH0sCiAgYmVmb3JlTW91bnQoKSB7CiAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5hZGQoInJpZ2h0LW1lbnUiKTsKICAgIEV2ZW50QnVzLiRvbigic2VhcmNoIiwgdGhpcy5zZWFyY2hFZGl0b3IpOwogICAgRXZlbnRCdXMuJG9uKCJwcmludCIsIHRoaXMucHJpbnRFZGl0b3IpOwogICAgRXZlbnRCdXMuJG9uKCJ0YWItY2hhbmdlIiwgdGhpcy5kb1RhYkNoYW5nZSk7CiAgICBFdmVudEJ1cy4kb24oInNhdmUiLCB0aGlzLmRvU2F2ZSk7CiAgICBFdmVudEJ1cy4kb24oImNhbmNlbCIsIHRoaXMuZG9DYW5jZWwpOwogICAgaWYgKHRoaXMubW92aWVTZXJpZVBsYXlsaXN0KSB7CiAgICAgIHRoaXMubG9hZFBsYXlsaXN0KHRoaXMubW92aWVTZXJpZVBsYXlsaXN0KTsKICAgIH0KICAgIHRoaXMubG9hZExvZ29Db3VudHJpZXMoKTsKICAgIHRoaXMubG9hZFRWR0lEQ291bnRyaWVzKCk7CiAgfSwKICBiZWZvcmVEZXN0cm95KCkgewogICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QucmVtb3ZlKCJyaWdodC1tZW51Iik7CiAgICBFdmVudEJ1cy4kb2ZmKCJzZWFyY2giLCB0aGlzLnNlYXJjaEVkaXRvcik7CiAgICBFdmVudEJ1cy4kb2ZmKCJwcmludCIsIHRoaXMucHJpbnRFZGl0b3IpOwogICAgRXZlbnRCdXMuJG9mZigidGFiLWNoYW5nZSIsIHRoaXMuZG9UYWJDaGFuZ2UpOwogICAgRXZlbnRCdXMuJG9mZigic2F2ZSIsIHRoaXMuZG9TYXZlKTsKICAgIEV2ZW50QnVzLiRvZmYoImNhbmNlbCIsIHRoaXMuZG9DYW5jZWwpOwogIH0sCiAgd2F0Y2g6IHsKICAgIGRyYWdTdHJlYW06IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgaWYgKCF2YWwpIHsKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgICB9CiAgICB9LAogICAgZHJhZ0dyb3VwOiBmdW5jdGlvbiAodmFsKSB7CiAgICAgIGlmICghdmFsKSB7CiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgICAgfQogICAgfSwKICAgIGFjdGl2ZUdyb3VwOiBmdW5jdGlvbiAodmFsKSB7CiAgICAgIGlmICh0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQpIHsKICAgICAgICB0aGlzLnNhdmVDaGFuZ2VzTW9kYWwodHJ1ZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5sb2FkU3RyZWFtcygpOwogICAgICB9CiAgICB9LAogICAgInBsYXlsaXN0RWRpdG9yLmNoYW5nZWQiOiBmdW5jdGlvbiAodmFsKSB7CiAgICAgIEV2ZW50QnVzLiRlbWl0KCJlZGl0b3ItY2hhbmdlcyIsIHZhbCk7CiAgICB9LAogICAgInJhZGlvQnJvd3Nlci5zZWFyY2giOiBmdW5jdGlvbiAodmFsKSB7CiAgICAgIGxldCB2bSA9IHRoaXM7CiAgICAgIGNsZWFyVGltZW91dCh0aGlzLnJhZGlvQnJvd3Nlci5ib3VuY2UpOwogICAgICB0aGlzLnJhZGlvQnJvd3Nlci5ib3VuY2UgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICB2bS5maW5kUmFkaW9icm93c2VyKHZhbCk7CiAgICAgIH0sIDUwMCk7CiAgICB9LAogICAgInNvdW5kY2xvdWQudXJsIjogZnVuY3Rpb24gKHZhbCkgewogICAgICBsZXQgdm0gPSB0aGlzOwogICAgICBjbGVhclRpbWVvdXQodGhpcy5yYWRpb0Jyb3dzZXIuYm91bmNlKTsKICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuYm91bmNlID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgdm0uZ2V0U291bmRjbG91ZFRyYWNrKHZhbCwgdm0uc291bmRjbG91ZENsaWVudElkKTsKICAgICAgfSwgNTAwKTsKICAgIH0sCiAgICAieW91dHViZS51cmwiOiBmdW5jdGlvbiAodmFsKSB7CiAgICAgIGlmICghdmFsLmxlbmd0aCkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAoL3lvdXR1XC4/YmUvaS50ZXN0KHZhbCkpIHsKICAgICAgICB2YXIgaTsKICAgICAgICB2YXIgcGF0dGVybnMgPSBbCiAgICAgICAgICAveW91dHVcLmJlXC8oW14jJj9dezExfSkvLCAvLyB5b3V0dS5iZS88aWQ+CiAgICAgICAgICAvXD92PShbXiMmP117MTF9KS8sIC8vID92PTxpZD4KICAgICAgICAgIC8mdj0oW14jJj9dezExfSkvLCAvLyAmdj08aWQ+CiAgICAgICAgICAvZW1iZWRcLyhbXiMmP117MTF9KS8sIC8vIGVtYmVkLzxpZD4KICAgICAgICAgIC9cL3ZcLyhbXiMmP117MTF9KS8sIC8vIC92LzxpZD4KICAgICAgICBdOwoKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcGF0dGVybnMubGVuZ3RoOyArK2kpIHsKICAgICAgICAgIGlmIChwYXR0ZXJuc1tpXS50ZXN0KHZhbCkpIHsKICAgICAgICAgICAgdGhpcy55b3V0dWJlLnZpZGVvSWQgPSBwYXR0ZXJuc1tpXS5leGVjKHZhbClbMV07CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHZhciB0b2tlbnMgPSB2YWwuc3BsaXQoL1svJj89Iy5cc10vZyk7CiAgICAgICAgZm9yIChpID0gMDsgaSA8IHRva2Vucy5sZW5ndGg7ICsraSkgewogICAgICAgICAgaWYgKC9eW14jJj9dezExfSQvLnRlc3QodG9rZW5zW2ldKSkgewogICAgICAgICAgICB0aGlzLnlvdXR1YmUudmlkZW9JZCA9IHRva2Vuc1tpXTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdGhpcy55b3V0dWJlLnZpZGVvSWQgPSAiIjsKICAgICAgfSBlbHNlIHsKICAgICAgICB0cnkgewogICAgICAgICAgdmFyIHVybHAgPSBuZXcgVVJMKHZhbCk7CiAgICAgICAgICB0aGlzLnlvdXR1YmUudmlkZW9JZCA9IHVybHAuc2VhcmNoUGFyYW1zLmdldCgidiIpOwogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICB0aGlzLnlvdXR1YmUudmlkZW9JZCA9ICIiOwogICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgICJ5b3V0dWJlLnZpZGVvSWQiOiBmdW5jdGlvbiAodmFsKSB7CiAgICAgIGxldCB2bSA9IHRoaXM7CiAgICAgIGNsZWFyVGltZW91dCh0aGlzLnlvdXR1YmUuYm91bmNlKTsKICAgICAgdGhpcy55b3V0dWJlLmJvdW5jZSA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgIGlmICh2YWwubGVuZ3RoKSB7CiAgICAgICAgICB2bS5nZXRZb3V0dWJlUGFnZSh2YWwpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2bS55b3V0dWJlLnZpZGVvID0gbnVsbDsKICAgICAgICB9CiAgICAgIH0sIDUwMCk7CiAgICB9LAogICAgInZpbWVvLnVybCI6IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgaWYgKC92aW1lb1wuY29tL2kudGVzdCh2YWwpKSB7CiAgICAgICAgbGV0IG1hdGNoID0gdmFsLm1hdGNoKAogICAgICAgICAgLyg/Ond3d1wufHBsYXllclwuKT92aW1lby5jb21cLyg/OmNoYW5uZWxzXC8oPzpcdytcLyk/fGdyb3Vwc1wvKD86W14vXSopXC92aWRlb3NcL3xhbGJ1bVwvKD86XGQrKVwvdmlkZW9cL3x2aWRlb1wvfCkoXGQrKSg/OlthLXpBLVowLTlfLV0rKT8vaQogICAgICAgICk7CiAgICAgICAgaWYgKG1hdGNoLmxlbmd0aCA+PSAyKSB7CiAgICAgICAgICB0aGlzLnZpbWVvLnZpZGVvSWQgPSBtYXRjaFsxXTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy52aW1lby52aWRlb0lkID0gIiI7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMudmltZW8udmlkZW9JZCA9ICIiOwogICAgICB9CiAgICB9LAogICAgInZpbWVvLnZpZGVvSWQiOiBmdW5jdGlvbiAodmFsKSB7CiAgICAgIGxldCB2bSA9IHRoaXM7CiAgICAgIGNsZWFyVGltZW91dCh0aGlzLnZpbWVvLmJvdW5jZSk7CiAgICAgIHRoaXMudmltZW8uYm91bmNlID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKHZhbC5sZW5ndGgpIHsKICAgICAgICAgIHZtLmdldFZpbWVvQ29uZmlnKHZhbCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZtLnZpbWVvLnZpZGVvID0gbnVsbDsKICAgICAgICB9CiAgICAgIH0sIDUwMCk7CiAgICB9LAogICAgImRhaWx5bW90aW9uLnVybCI6IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgaWYgKC9kYWlseW1vdGlvblwuY29tL2kudGVzdCh2YWwpKSB7CiAgICAgICAgbGV0IG1hdGNoID0gdmFsLm1hdGNoKAogICAgICAgICAgL14uK2RhaWx5bW90aW9uLmNvbVwvKHZpZGVvfGh1YilcLyhbXl9dKylbXiNdKigjdmlkZW89KFteXyZdKykpPy9pCiAgICAgICAgKTsKICAgICAgICBpZiAobWF0Y2gubGVuZ3RoID49IDQgJiYgbWF0Y2hbNF0pIHsKICAgICAgICAgIHRoaXMuZGFpbHltb3Rpb24udmlkZW9JZCA9IG1hdGNoWzRdOwogICAgICAgIH0gZWxzZSBpZiAobWF0Y2gubGVuZ3RoID49IDIpIHsKICAgICAgICAgIHRoaXMuZGFpbHltb3Rpb24udmlkZW9JZCA9IG1hdGNoWzJdOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLmRhaWx5bW90aW9uLnZpZGVvSWQgPSAiIjsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5kYWlseW1vdGlvbi52aWRlb0lkID0gIiI7CiAgICAgIH0KICAgIH0sCiAgICAiZGFpbHltb3Rpb24udmlkZW9JZCI6IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgbGV0IHZtID0gdGhpczsKICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuZGFpbHltb3Rpb24uYm91bmNlKTsKICAgICAgdGhpcy5kYWlseW1vdGlvbi5ib3VuY2UgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAodmFsLmxlbmd0aCkgewogICAgICAgICAgdm0uZ2V0RGFpbHltb3Rpb25Db25maWcodmFsKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdm0uZGFpbHltb3Rpb24udmlkZW8gPSBudWxsOwogICAgICAgIH0KICAgICAgfSwgNTAwKTsKICAgIH0sCiAgICAidGVkVGFsa3MudXJsIjogZnVuY3Rpb24gKHZhbCkgewogICAgICBpZiAoL3RlZFwuY29tXC90YWxrcy9pLnRlc3QodmFsKSkgewogICAgICAgIGxldCB2bSA9IHRoaXM7CiAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMudGVkVGFsa3MuYm91bmNlKTsKICAgICAgICB0aGlzLnRlZFRhbGtzLmJvdW5jZSA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKHZhbC5sZW5ndGgpIHsKICAgICAgICAgICAgdm0uZ2V0VGVkVGFsa3NDb25maWcodmFsKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZtLnRlZFRhbGtzLnZpZGVvID0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICB9LCA1MDApOwogICAgICB9CiAgICB9LAogICAgInhoYW1zdGVyLnVybCI6IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgbGV0IHZtID0gdGhpczsKICAgICAgaWYgKC94aGFtc3RlclwuY29tXC92aWRlb3MvaS50ZXN0KHZhbCkpIHsKICAgICAgICBjbGVhclRpbWVvdXQodGhpcy54aGFtc3RlckJvdW5jZSk7CiAgICAgICAgdGhpcy54aGFtc3RlckJvdW5jZSA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKHZhbC5sZW5ndGgpIHsKICAgICAgICAgICAgdm0uZ2V0WGhhbXN0ZXJDb25maWcodmFsKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZtLnhoYW1zdGVyLnZpZGVvID0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICB9LCA1MDApOwogICAgICB9CiAgICB9LAogICAgImZpbmRMb2dvLmNvdW50cnkiOiBmdW5jdGlvbiAodmFsKSB7CiAgICAgIGlmICh2YWwubGVuZ3RoKSB7CiAgICAgICAgdGhpcy5sb2FkTG9nb3NGaW5kKHZhbCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5maW5kTG9nby5sb2dvID0gIiI7CiAgICAgIH0KICAgIH0sCiAgICAiYXNzaWduTG9nby5jb3VudHJ5IjogZnVuY3Rpb24gKHZhbCkgewogICAgICBpZiAodmFsLmxlbmd0aCkgewogICAgICAgIHRoaXMubG9hZExvZ29zQXNzaWduKHZhbCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5hc3NpZ25Mb2dvLmxvZ28gPSAiIjsKICAgICAgfQogICAgfSwKICAgICJmaW5kVFZHSUQuY291bnRyeSI6IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgaWYgKHZhbC5sZW5ndGgpIHsKICAgICAgICB0aGlzLmxvYWRUVkdJREZpbmQodmFsKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmZpbmRUVkdJRC5jaGFubmVsID0gIiI7CiAgICAgIH0KICAgIH0sCiAgICAiYXNzaWduVFZHSUQuY291bnRyeSI6IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgaWYgKHZhbC5sZW5ndGgpIHsKICAgICAgICB0aGlzLmxvYWRUVkdJREFzc2lnbih2YWwpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYXNzaWduVFZHSUQuY2hhbm5lbHMgPSBbXTsKICAgICAgfQogICAgfSwKICAgIG1vdmllU2VyaWVQbGF5bGlzdDogZnVuY3Rpb24gKHZhbCkgewogICAgICB0aGlzLmxvYWRQbGF5bGlzdCh2YWwpOwogICAgfSwKICB9LAp9Owo="},null]}