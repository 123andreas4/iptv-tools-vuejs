{"remainingRequest":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/vue-loader/lib/index.js??vue-loader-options!/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/src/views/app/xtream/editor.vue?vue&type=script&lang=js&","dependencies":[{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/src/views/app/xtream/editor.vue","mtime":1625832741237},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/media/ernst/63bce43c-5e51-4bf1-a611-3afdf32ac6f6/VueJS/IPTV-Tools/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCi8qIGVzbGludC1kaXNhYmxlIHZ1ZS9uby1zaWRlLWVmZmVjdHMtaW4tY29tcHV0ZWQtcHJvcGVydGllcyAqLwovKiBlc2xpbnQtZGlzYWJsZSBuby11bnVzZWQtdmFycyAqLwovKiBlc2xpbnQtZGlzYWJsZSBuby11c2VsZXNzLWVzY2FwZSAqLwoKaW1wb3J0IHsgRXZlbnRCdXMgfSBmcm9tICIuLi8uLi8uLi9zZXJ2aWNlcy9lYnVzIjsKaW1wb3J0IHsgaHR0cFNlcnZpY2UgfSBmcm9tICIuLi8uLi8uLi9zZXJ2aWNlcy9odHRwIjsKaW1wb3J0IHsgbWFwR2V0dGVycyB9IGZyb20gInZ1ZXgiOwppbXBvcnQgZHJhZ2dhYmxlIGZyb20gInZ1ZWRyYWdnYWJsZSI7CmltcG9ydCB7IFN1YnNjcmlwdGlvblR5cGUgfSBmcm9tICIuLi8uLi8uLi9jb25zdGFudHMvY29uZmlnIjsKaW1wb3J0IHsgY291bnRyaWVzIH0gZnJvbSAiLi4vLi4vLi4vaGVscGVycyI7CmltcG9ydCB7IG0zdSB9IGZyb20gIi4uLy4uLy4uL3BsdWdpbnMvbTN1IjsKCmV4cG9ydCBkZWZhdWx0IHsKICBjb21wb25lbnRzOiB7CiAgICBkcmFnZ2FibGUsCiAgfSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgZGF0ZU9wdGlvbnM6IHsgZGF5OiAiMi1kaWdpdCIsIG1vbnRoOiAibnVtZXJpYyIsIHllYXI6ICJudW1lcmljIiB9LAogICAgICBjb3VudHJpZXMsCiAgICAgIGFjdGl2ZVRhYjogMCwKICAgICAgYWN0aXZlR3JvdXA6IC0xLAogICAgICBhY3RpdmVHcm91cHM6IFtdLAogICAgICBhY3RpdmVTdHJlYW06IC0xLAogICAgICBhY3RpdmVTdHJlYW1zOiBbXSwKICAgICAgZHJhZ0dyb3VwOiBmYWxzZSwKICAgICAgZHJhZ1N0cmVhbTogZmFsc2UsCiAgICAgIGVkaXRvcjogZmFsc2UsCiAgICAgIHNlYXJjaDogbnVsbCwKICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgcGxheWxpc3RFZGl0b3I6IHsKICAgICAgICBpZDogdW5kZWZpbmVkLAogICAgICAgIHBsYXlsaXN0OiBudWxsLAogICAgICAgIGdyb3VwczogW10sCiAgICAgICAgc3RyZWFtczogW10sCiAgICAgICAgY2hhbmdlZDogZmFsc2UsCiAgICAgIH0sCiAgICAgIGZpbmRSZXBsYWNlOiB7CiAgICAgICAgdHlwZTogMCwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgZnJvbTogIiIsCiAgICAgICAgdG86ICIiLAogICAgICAgIHJlcGxhY2VBbGw6IGZhbHNlLAogICAgICAgIGlnbm9yZUNhc2U6IGZhbHNlLAogICAgICAgIHNlbGVjdGVkT25seTogMCwKICAgICAgfSwKICAgICAgcHJlZml4U3VmZml4OiB7CiAgICAgICAgdHlwZTogMCwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgcHJlZml4OiAiIiwKICAgICAgICBzdWZmaXg6ICIiLAogICAgICAgIHNlbGVjdGVkT25seTogMCwKICAgICAgfSwKICAgICAgY29udmVydENhc2U6IHsKICAgICAgICB0eXBlOiAwLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBtZXRob2Q6IDAsCiAgICAgICAgc2VsZWN0ZWRPbmx5OiAwLAogICAgICB9LAogICAgICBncm91cEVkaXRvcjogewogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBpZDogMCwKICAgICAgICBncm91cF9uYW1lOiAiIiwKICAgICAgICBncm91cF9wYXJlbnRfY29kZTogIiIsCiAgICAgICAgZ3JvdXBfdHlwZTogMSwKICAgICAgICBncm91cF9pc19oaWRkZW46IDAsCiAgICAgIH0sCiAgICAgIHN0cmVhbUVkaXRvcjogewogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBpZDogLTEsCiAgICAgICAgc3RyZWFtX3R2Z19uYW1lOiAiIiwKICAgICAgICBzdHJlYW1fdHZnX2lkOiAiIiwKICAgICAgICBzdHJlYW1fdHZnX2xvZ286ICIiLAogICAgICAgIHN0cmVhbV9wYXJlbnRfY29kZTogIiIsCiAgICAgICAgc3RyZWFtX3JhZGlvOiAwLAogICAgICAgIHN0cmVhbV9pc19oaWRkZW46IDAsCiAgICAgICAgc3RyZWFtX2lzX2N1c3RvbTogMCwKICAgICAgICBtb3ZpZV9uYW1lOiAiIiwKICAgICAgICBtb3ZpZV95ZWFyOiAiIiwKICAgICAgICBzZXJpZV9uYW1lOiAiIiwKICAgICAgICBzZXJpZV9zZWFzb246IDAsCiAgICAgICAgc2VyaWVfZXBpc29kZTogMCwKICAgICAgICBzb3VyY2Vfc3RyZWFtX3VybDogIiIsCiAgICAgIH0sCiAgICAgIHJhZGlvQnJvd3NlcjogewogICAgICAgIGlzTG9hZGluZzogZmFsc2UsCiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIGJvdW5jZTogbnVsbCwKICAgICAgICBhY3RpdmU6IFtdLAogICAgICAgIHNlYXJjaDogIiIsCiAgICAgICAgcmVzdWx0czogW10sCiAgICAgIH0sCiAgICAgIHNvdW5kY2xvdWQ6IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBib3VuY2U6IG51bGwsCiAgICAgICAgdXJsOiAiIiwKICAgICAgICB0cmFjazogbnVsbCwKICAgICAgfSwKICAgICAgeW91dHViZTogewogICAgICAgIGlzTG9hZGluZzogZmFsc2UsCiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIGJvdW5jZTogbnVsbCwKICAgICAgICB1cmw6ICIiLAogICAgICAgIHZpZGVvSWQ6ICIiLAogICAgICAgIHZpZGVvOiBudWxsLAogICAgICB9LAogICAgICB2aW1lbzogewogICAgICAgIGlzTG9hZGluZzogZmFsc2UsCiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIGJvdW5jZTogbnVsbCwKICAgICAgICB1cmw6ICIiLAogICAgICAgIHZpZGVvSWQ6ICIiLAogICAgICAgIHZpZGVvOiBudWxsLAogICAgICB9LAogICAgICBkYWlseW1vdGlvbjogewogICAgICAgIGlzTG9hZGluZzogZmFsc2UsCiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIGJvdW5jZTogbnVsbCwKICAgICAgICB1cmw6ICIiLAogICAgICAgIHZpZGVvSWQ6ICIiLAogICAgICAgIHZpZGVvOiBudWxsLAogICAgICB9LAogICAgICB0ZWRUYWxrczogewogICAgICAgIGlzTG9hZGluZzogZmFsc2UsCiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIGJvdW5jZTogbnVsbCwKICAgICAgICB1cmw6ICIiLAogICAgICAgIHZpZGVvOiBudWxsLAogICAgICB9LAogICAgICB4aGFtc3RlcjogewogICAgICAgIGlzTG9hZGluZzogZmFsc2UsCiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIGJvdW5jZTogbnVsbCwKICAgICAgICB1cmw6ICIiLAogICAgICAgIHZpZGVvOiBudWxsLAogICAgICB9LAogICAgICBmaW5kTG9nbzogewogICAgICAgIGlzTG9hZGluZzogZmFsc2UsCiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIGNvdW50cmllczogW10sCiAgICAgICAgY291bnRyeTogIiIsCiAgICAgICAgbG9nb3M6IFtdLAogICAgICAgIGxvZ286ICIiLAogICAgICAgIHNlYXJjaDogIiIsCiAgICAgICAgdGl0bGU6ICIiLAogICAgICB9LAogICAgICBhc3NpZ25Mb2dvOiB7CiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgICAgY291bnRyaWVzOiBbXSwKICAgICAgICBjb3VudHJ5OiAiIiwKICAgICAgICBsb2dvczogW10sCiAgICAgICAgYXNzaWduQWxsOiAwLAogICAgICB9LAogICAgICBpbXBvcnRNM1U6IHsKICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICAgIG1vZGFsOiBmYWxzZSwKICAgICAgICBncm91cHM6IFtdLAogICAgICAgIGltcG9ydEdyb3VwczogW10sCiAgICAgICAgbTN1OiBudWxsLAogICAgICAgIGZpbGU6IG51bGwsCiAgICAgIH0sCiAgICAgIGZpbmRUVkdJRDogewogICAgICAgIGlzTG9hZGluZzogZmFsc2UsCiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIGNvdW50cmllczogW10sCiAgICAgICAgY291bnRyeTogIiIsCiAgICAgICAgY2hhbm5lbHM6IFtdLAogICAgICAgIGNoYW5uZWw6ICIiLAogICAgICAgIHNlYXJjaDogIiIsCiAgICAgICAgdGl0bGU6ICIiLAogICAgICB9LAogICAgICBhc3NpZ25UVkdJRDogewogICAgICAgIGlzTG9hZGluZzogZmFsc2UsCiAgICAgICAgbW9kYWw6IGZhbHNlLAogICAgICAgIGNvdW50cmllczogW10sCiAgICAgICAgY291bnRyeTogIiIsCiAgICAgICAgY2hhbm5lbHM6IFtdLAogICAgICAgIGFzc2lnbkFsbDogMCwKICAgICAgfSwKICAgICAgc2F2ZUNoYW5nZXM6IHsKICAgICAgICBtb2RhbDogZmFsc2UsCiAgICAgIH0sCiAgICAgIGdyb3VwVHlwZXM6IFsKICAgICAgICB7IHRleHQ6IHRoaXMuJHQoInh0cmVhbS5saXZlIiksIHZhbHVlOiAxIH0sCiAgICAgICAgeyB0ZXh0OiB0aGlzLiR0KCJ4dHJlYW0ubW92aWVzIiksIHZhbHVlOiAyIH0sCiAgICAgICAgeyB0ZXh0OiB0aGlzLiR0KCJ4dHJlYW0uc2VyaWVzIiksIHZhbHVlOiAzIH0sCiAgICAgIF0sCiAgICB9OwogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIC4uLm1hcEdldHRlcnMoWwogICAgICAiY3VycmVudFVzZXIiLAogICAgICAic2V0dGluZ3MiLAogICAgICAic291bmRjbG91ZENsaWVudElkIiwKICAgICAgIm1vdmllU2VyaWVQbGF5bGlzdCIsCiAgICBdKSwKICAgIHNob3dUb29sdGlwcyAoKSB7CiAgICAgIHJldHVybiB0aGlzLnNldHRpbmdzLnNob3dUb29sdGlwczsKICAgIH0sCiAgICBzZWFyY2hGaWx0ZXJlZCgpIHsKICAgICAgaWYgKHRoaXMuc2VhcmNoID09PSBudWxsKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuYWNjb3VudHM7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIHJlID0gbmV3IFJlZ0V4cCh0aGlzLnNlYXJjaCwgImkiKTsKICAgICAgICByZXR1cm4gdGhpcy5hY2NvdW50cy5maWx0ZXIoKGFjY291bnQpID0+IHsKICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgIFN0cmluZyhhY2NvdW50LnRpdGxlKS5tYXRjaChyZSkgfHwKICAgICAgICAgICAgU3RyaW5nKGFjY291bnQuaG9zdCkubWF0Y2gocmUpIHx8CiAgICAgICAgICAgIFN0cmluZyhhY2NvdW50LnBvcnQpLm1hdGNoKHJlKSB8fAogICAgICAgICAgICBTdHJpbmcoYWNjb3VudC51c2VybmFtZSkubWF0Y2gocmUpIHx8CiAgICAgICAgICAgIFN0cmluZyhhY2NvdW50LnBhc3N3b3JkKS5tYXRjaChyZSkgfHwKICAgICAgICAgICAgdGhpcy5mb3JtYXREYXRlKGFjY291bnQuc3luY2VkX2F0KS5tYXRjaChyZSkgfHwKICAgICAgICAgICAgdGhpcy4kdChgc3luYy1pbnRlcnZhbC4ke2FjY291bnQuc3luY19pbnRlcnZhbH1gKS5tYXRjaChyZSkKICAgICAgICAgICk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBwbGF5bGlzdFNlbGVjdGVkKCkgewogICAgICByZXR1cm4gdGhpcy5wbGF5bGlzdEVkaXRvci5pZCAhPT0gdW5kZWZpbmVkOwogICAgfSwKICAgIGxhc3RTZWxlY3RlZEdyb3VwKCkgewogICAgICByZXR1cm4gdGhpcy5hY3RpdmVHcm91cHNbdGhpcy5hY3RpdmVHcm91cHMubGVuZ3RoIC0gMV07CiAgICB9LAogICAgbGFzdFNlbGVjdGVkU3RyZWFtKCkgewogICAgICByZXR1cm4gdGhpcy5hY3RpdmVTdHJlYW1zW3RoaXMuYWN0aXZlU3RyZWFtcy5sZW5ndGggLSAxXTsKICAgIH0sCiAgICBjYW5FZGl0R3JvdXBUeXBlKCkgewogICAgICByZXR1cm4gKAogICAgICAgIHRoaXMuZ3JvdXBFZGl0b3IuaWQgJiYKICAgICAgICB0aGlzLmdldEdyb3VwV2l0aElkKHRoaXMuZ3JvdXBFZGl0b3IuaWQpLnN0cmVhbXMgPT0gMAogICAgICApOwogICAgfSwKICAgIHN1YnNjcmlwdGlvbkxpbWl0ZWQoKSB7CiAgICAgIHJldHVybiAoCiAgICAgICAgdGhpcy5jdXJyZW50VXNlci5zdWJzY3JpcHRpb24gJiYKICAgICAgICB0aGlzLmN1cnJlbnRVc2VyLnN1YnNjcmlwdGlvbi5zdWJzY3JpcHRpb25fdHlwZSA9PQogICAgICAgICAgU3Vic2NyaXB0aW9uVHlwZS5FbnRodXNpYXN0CiAgICAgICk7CiAgICB9LAogICAgZmlsdGVyZWRHcm91cHMoKSB7CiAgICAgIGlmICh0aGlzLnN1YnNjcmlwdGlvbkxpbWl0ZWQpIHsKICAgICAgICByZXR1cm4gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmlsdGVyKAogICAgICAgICAgKGdyb3VwKSA9PgogICAgICAgICAgICBncm91cC5ncm91cF9pc19yZW1vdmVkICE9PSAxICYmCiAgICAgICAgICAgIGdyb3VwLnNvdXJjZV9ncm91cF90eXBlID09IDEgJiYKICAgICAgICAgICAgZ3JvdXAuZ3JvdXBfdHlwZSA9PSAxCiAgICAgICAgKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmlsdGVyKAogICAgICAgIChncm91cCkgPT4gZ3JvdXAuZ3JvdXBfaXNfcmVtb3ZlZCAhPT0gMQogICAgICApOwogICAgfSwKICAgIGZpbHRlcmVkU3RyZWFtcygpIHsKICAgICAgcmV0dXJuIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5maWx0ZXIoCiAgICAgICAgKGdyb3VwKSA9PiBncm91cC5zdHJlYW1faXNfcmVtb3ZlZCAhPT0gMQogICAgICApOwogICAgfSwKICAgIGFjdGl2ZUdyb3VwVHlwZSgpIHsKICAgICAgbGV0IGluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KAogICAgICAgIChncm91cCkgPT4gZ3JvdXAuaWQgPT0gdGhpcy5hY3RpdmVHcm91cAogICAgICApOwogICAgICByZXR1cm4gaW5kZXggPiAtMSA/IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2luZGV4XS5ncm91cF90eXBlIDogMDsKICAgIH0sCiAgICBmaWx0ZXJlZExvZ29zKCkgewogICAgICBpZiAoIXRoaXMuZmluZExvZ28uc2VhcmNoLmxlbmd0aCkgewogICAgICAgIHJldHVybiB0aGlzLmZpbmRMb2dvLmxvZ29zOwogICAgICB9CiAgICAgIGxldCBzZWxlY3RlZFN0cmVhbSA9IHRoaXMuZ2V0U3RyZWFtV2l0aElkKHRoaXMuYWN0aXZlU3RyZWFtc1swXSk7CiAgICAgIGxldCByZSA9IG5ldyBSZWdFeHAodGhpcy5maW5kTG9nby5zZWFyY2gsICJpIik7CiAgICAgIHJldHVybiB0aGlzLmZpbmRMb2dvLmxvZ29zLmZpbHRlcigobG9nbykgPT4gewogICAgICAgIHJldHVybiBsb2dvLnRleHQubWF0Y2gocmUpOwogICAgICB9KTsKICAgIH0sCiAgICBmaWx0ZXJlZFRWR0lEUygpIHsKICAgICAgaWYgKCF0aGlzLmZpbmRUVkdJRC5zZWFyY2gubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZmluZFRWR0lELmNoYW5uZWxzOwogICAgICB9CiAgICAgIGxldCBzZWxlY3RlZFN0cmVhbSA9IHRoaXMuZ2V0U3RyZWFtV2l0aElkKHRoaXMuYWN0aXZlU3RyZWFtc1swXSk7CiAgICAgIGxldCByZSA9IG5ldyBSZWdFeHAodGhpcy5maW5kVFZHSUQuc2VhcmNoLCAiaSIpOwogICAgICByZXR1cm4gdGhpcy5maW5kVFZHSUQuY2hhbm5lbHMuZmlsdGVyKChjaGFubmVsKSA9PiB7CiAgICAgICAgcmV0dXJuIGNoYW5uZWwudGV4dC5tYXRjaChyZSk7CiAgICAgIH0pOwogICAgfSwKICAgIGdyb3VwQ29udGV4dE1lbnUoKSB7CiAgICAgIGxldCB2bSA9IHRoaXM7CiAgICAgIHJldHVybiBbCiAgICAgICAgewogICAgICAgICAgaWNvbjogImxhLXBsdXMiLAogICAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5hZGQtZ3JvdXAiKSwKICAgICAgICAgIG9uQ2xpY2s6IHZtLmFkZEdyb3VwLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgZGlzYWJsZWQ6IHZtLmFjdGl2ZUdyb3Vwcy5sZW5ndGggIT09IDEsCiAgICAgICAgICBpY29uOiAibGEtZWRpdCIsCiAgICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLmVkaXQtZ3JvdXAiKSwKICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKHZtLmFjdGl2ZUdyb3Vwcy5sZW5ndGggPT09IDEpIHsKICAgICAgICAgICAgICB2bS5lZGl0R3JvdXBNb2RhbCh0cnVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGRpdmlkZXI6IHRydWUsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICB0ZXh0OiB2bS4kdCgiZ2VuZXJhbC5zZWxlY3QtYWxsIiksCiAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZtLmFjdGl2ZUdyb3VwcyA9IFsuLi52bS5wbGF5bGlzdEVkaXRvci5ncm91cHMubWFwKChnKSA9PiBnLmlkKV07CiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgdGV4dDogdm0uJHQoImdlbmVyYWwuc2VsZWN0LW5vbmUiKSwKICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdm0uYWN0aXZlR3JvdXBzID0gW107CiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgZGl2aWRlcjogdHJ1ZSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGljb246ICJsYS1zZWFyY2giLAogICAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5maW5kLXJlcGxhY2UiKSwKICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdm0uZmluZEFuZFJlcGxhY2VNb2RhbCh0cnVlLCAxKTsKICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBpY29uOiAibGEtcGVuIiwKICAgICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IuYWRkLXByZWZpeC1zdWZmaXgiKSwKICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdm0ucHJlZml4U3VmZml4TW9kYWwodHJ1ZSwgMSk7CiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgaWNvbjogImxhLWZvbnQiLAogICAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5jaGFuZ2UtY2FzZSIpLAogICAgICAgICAgb25DbGljazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2bS5jb252ZXJ0Q2FzZU1vZGFsKHRydWUsIDEpOwogICAgICAgICAgfSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGRpdmlkZXI6IHRydWUsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBkaXNhYmxlZDogdm0uYWN0aXZlR3JvdXBzLmxlbmd0aCA9PT0gMCwKICAgICAgICAgIGljb246ICJsYS1leWUiLAogICAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci50b2dnbGUtdmlzaWJpbGl0eSIpLAogICAgICAgICAgb25DbGljazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICBpZiAodm0uYWN0aXZlR3JvdXBzLmxlbmd0aCkgewogICAgICAgICAgICAgIHZtLnRvZ2dsZUdyb3VwVmlzaWJpbGl0eSgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgZGlzYWJsZWQ6IHZtLmFjdGl2ZUdyb3Vwcy5sZW5ndGggPT09IDAsCiAgICAgICAgICBpY29uOiAibGEtdHJhc2giLAogICAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5kZWxldGUiKSwKICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKHZtLmFjdGl2ZUdyb3Vwcy5sZW5ndGgpIHsKICAgICAgICAgICAgICB2bS5kZWxldGVTZWxlY3RlZEdyb3VwcygpOwogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgIF07CiAgICB9LAogICAgc3RyZWFtQ29udGV4dE1lbnUoKSB7CiAgICAgIGxldCB2bSA9IHRoaXM7CiAgICAgIHJldHVybiBbCiAgICAgICAgewogICAgICAgICAgaWNvbjogImxhLXBsdXMiLAogICAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5hZGQtc3RyZWFtIiksCiAgICAgICAgICBvbkNsaWNrOiB2bS5hZGRTdHJlYW0sCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBkaXNhYmxlZDogdm0uYWN0aXZlU3RyZWFtcy5sZW5ndGggIT09IDEsCiAgICAgICAgICBpY29uOiAibGEtZWRpdCIsCiAgICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLmVkaXQtc3RyZWFtIiksCiAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmICh2bS5hY3RpdmVTdHJlYW1zLmxlbmd0aCA9PT0gMSkgewogICAgICAgICAgICAgIHZtLmVkaXRTdHJlYW1Nb2RhbCh0cnVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGRpdmlkZXI6IHRydWUsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICB0ZXh0OiB2bS4kdCgiZ2VuZXJhbC5zZWxlY3QtYWxsIiksCiAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZtLmFjdGl2ZVN0cmVhbXMgPSBbLi4udm0ucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5tYXAoKGcpID0+IGcuaWQpXTsKICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICB0ZXh0OiB2bS4kdCgiZ2VuZXJhbC5zZWxlY3Qtbm9uZSIpLAogICAgICAgICAgb25DbGljazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2bS5hY3RpdmVTdHJlYW1zID0gW107CiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgZGl2aWRlcjogdHJ1ZSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGRpc2FibGVkOgogICAgICAgICAgICB2bS5hY3RpdmVHcm91cHMubGVuZ3RoICE9PSAxIHx8CiAgICAgICAgICAgIHZtLmFjdGl2ZVN0cmVhbXMubGVuZ3RoID09PSAwIHx8CiAgICAgICAgICAgIHZtLmdldEdyb3VwV2l0aElkKHZtLmFjdGl2ZUdyb3Vwc1swXSkuZ3JvdXBfdHlwZSAhPT0KICAgICAgICAgICAgICB2bS5hY3RpdmVHcm91cFR5cGUgfHwKICAgICAgICAgICAgdm0uYWN0aXZlR3JvdXBzWzBdID09PSB2bS5hY3RpdmVHcm91cCwKICAgICAgICAgIGljb246ICJsYS1jaGV2cm9uLWxlZnQiLAogICAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5tb3ZlLXRvLXNlbGVjdGVkLWdyb3VwIiksCiAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZtLm1vdmVUb1NlbGVjdGVkR3JvdXAoKTsKICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBkaXZpZGVyOiB0cnVlLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgaWNvbjogImxhLXNlYXJjaCIsCiAgICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLmZpbmQtcmVwbGFjZSIpLAogICAgICAgICAgb25DbGljazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2bS5maW5kQW5kUmVwbGFjZU1vZGFsKHRydWUsIDIpOwogICAgICAgICAgfSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGljb246ICJsYS1wZW4iLAogICAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5hZGQtcHJlZml4LXN1ZmZpeCIpLAogICAgICAgICAgb25DbGljazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2bS5wcmVmaXhTdWZmaXhNb2RhbCh0cnVlLCAyKTsKICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBpY29uOiAibGEtZm9udCIsCiAgICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLmNoYW5nZS1jYXNlIiksCiAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZtLmNvbnZlcnRDYXNlTW9kYWwodHJ1ZSwgMik7CiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgZGl2aWRlcjogdHJ1ZSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGRpc2FibGVkOiB2bS5hY3RpdmVTdHJlYW1zLmxlbmd0aCAhPT0gMSB8fCB2bS5hY3RpdmVHcm91cFR5cGUgIT09IDEsCiAgICAgICAgICBpY29uOiAibGEtcGhvdG8tdmlkZW8iLAogICAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5maW5kLWxvZ28iKSwKICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdm0uZmluZExvZ29Nb2RhbCh0cnVlKTsKICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBkaXNhYmxlZDogdm0uYWN0aXZlU3RyZWFtcy5sZW5ndGggIT09IDEgfHwgdm0uYWN0aXZlR3JvdXBUeXBlICE9PSAxLAogICAgICAgICAgaWNvbjogImxhLXRoLWxpc3QiLAogICAgICAgICAgdGV4dDogdm0uJHQoImVkaXRvci5maW5kLXR2LWd1aWRlIiksCiAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZtLmZpbmRUVkdJRE1vZGFsKHRydWUpOwogICAgICAgICAgfSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGRpdmlkZXI6IHRydWUsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBkaXNhYmxlZDogdm0uYWN0aXZlU3RyZWFtcy5sZW5ndGggPT09IDAgfHwgdm0uYWN0aXZlR3JvdXBUeXBlICE9PSAxLAogICAgICAgICAgaWNvbjogImxhLW11c2ljIiwKICAgICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IudG9nZ2xlLXJhZGlvIiksCiAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmICh2bS5hY3RpdmVTdHJlYW1zLmxlbmd0aCAmJiB2bS5hY3RpdmVHcm91cFR5cGUgPT0gMSkgewogICAgICAgICAgICAgIHZtLnRvZ2dsZVN0cmVhbVJhZGlvKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBkaXNhYmxlZDogdm0uYWN0aXZlU3RyZWFtcy5sZW5ndGggPT09IDAsCiAgICAgICAgICBpY29uOiAibGEtZXllIiwKICAgICAgICAgIHRleHQ6IHZtLiR0KCJlZGl0b3IudG9nZ2xlLXZpc2liaWxpdHkiKSwKICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKHZtLmFjdGl2ZVN0cmVhbXMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgdm0udG9nZ2xlU3RyZWFtVmlzaWJpbGl0eSgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgZGl2aWRlcjogdHJ1ZSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIGRpc2FibGVkOiB2bS5hY3RpdmVTdHJlYW1zLmxlbmd0aCA9PT0gMCwKICAgICAgICAgIGljb246ICJsYS10cmFzaCIsCiAgICAgICAgICB0ZXh0OiB2bS4kdCgiZWRpdG9yLmRlbGV0ZSIpLAogICAgICAgICAgb25DbGljazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICBpZiAodm0uYWN0aXZlU3RyZWFtcy5sZW5ndGgpIHsKICAgICAgICAgICAgICB2bS5kZWxldGVTZWxlY3RlZFN0cmVhbXMoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICB9LAogICAgICBdOwogICAgfSwKICB9LAogIG1ldGhvZHM6IHsKICAgIGdyb3VwRHJhZ0NoYW5nZWQoZykgewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmdyb3VwX29yZGVyICE9IGkgKyAxKSB7CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5ncm91cF9vcmRlciA9IGkgKyAxOwogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHN0cmVhbURyYWdDaGFuZ2VkKGcpIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAodGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLnN0cmVhbV9vcmRlciAhPSBpICsgMSkgewogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLnN0cmVhbV9vcmRlciA9IGkgKyAxOwogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBvcGVuQ29udGV4dChjb250ZXh0KSB7CiAgICAgIHRoaXMuJHJlZnNbY29udGV4dF0ub3BlbigpOwogICAgfSwKICAgIHNlYXJjaEVkaXRvcihzZWFyY2gpIHsKICAgICAgaWYgKHNlYXJjaC5sZW5ndGggPT09IDApIHsKICAgICAgICB0aGlzLnNlYXJjaCA9IG51bGw7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zZWFyY2ggPSBzZWFyY2g7CiAgICAgIH0KICAgIH0sCiAgICBwcmludEVkaXRvcigpIHsKICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVkaXRvciIpLnByaW50KCk7CiAgICB9LAogICAgZm9ybWF0TnVtYmVyKG51bWJlcikgewogICAgICByZXR1cm4gbmV3IEludGwuTnVtYmVyRm9ybWF0KHRoaXMuJHQoImRhdGUubG9jYWxlIikpLmZvcm1hdChudW1iZXIpOwogICAgfSwKICAgIGZvcm1hdERhdGUoZGF0ZSkgewogICAgICByZXR1cm4gbmV3IERhdGUoZGF0ZSkudG9Mb2NhbGVTdHJpbmcoCiAgICAgICAgdGhpcy4kdCgiZGF0ZS5sb2NhbGUiKSwKICAgICAgICB0aGlzLmRhdGVPcHRpb25zCiAgICAgICk7CiAgICB9LAogICAgZm9ybWF0RGF0ZVlvdXR1YmUoZGF0ZSkgewogICAgICByZXR1cm4gbmV3IERhdGUoZGF0ZSkudG9Mb2NhbGVEYXRlU3RyaW5nKHRoaXMuJHQoImRhdGUubG9jYWxlIiksIHsKICAgICAgICB5ZWFyOiAibnVtZXJpYyIsCiAgICAgICAgbW9udGg6ICJzaG9ydCIsCiAgICAgICAgZGF5OiAibnVtZXJpYyIsCiAgICAgIH0pOwogICAgfSwKICAgIGZvcm1hdFNlY29uZHMoc2VjKSB7CiAgICAgIHZhciBkID0gTnVtYmVyKHNlYyk7CiAgICAgIHZhciBoID0gTWF0aC5mbG9vcihkIC8gMzYwMCk7CiAgICAgIHZhciBtID0gTWF0aC5mbG9vcigoZCAlIDM2MDApIC8gNjApOwogICAgICB2YXIgcyA9IE1hdGguZmxvb3IoKGQgJSAzNjAwKSAlIDYwKTsKCiAgICAgIHZhciBob3VyID0gdGhpcy4kdCgiZ2VuZXJhbC5ob3VyIik7CiAgICAgIHZhciBob3VycyA9IHRoaXMuJHQoImdlbmVyYWwuaG91cnMiKTsKICAgICAgdmFyIG1pbnV0ZSA9IHRoaXMuJHQoImdlbmVyYWwubWludXRlIik7CiAgICAgIHZhciBtaW51dGVzID0gdGhpcy4kdCgiZ2VuZXJhbC5taW51dGVzIik7CiAgICAgIHZhciBzZWNvbmQgPSB0aGlzLiR0KCJnZW5lcmFsLnNlY29uZCIpOwogICAgICB2YXIgc2Vjb25kcyA9IHRoaXMuJHQoImdlbmVyYWwuc2Vjb25kcyIpOwoKICAgICAgdmFyIGhEaXNwbGF5ID0gaCA+IDAgPyBoICsgKGggPT0gMSA/IGAgJHtob3VyfSBgIDogYCAke2hvdXJzfSBgKSA6ICIiOwogICAgICB2YXIgbURpc3BsYXkgPSBtID4gMCA/IG0gKyAobSA9PSAxID8gYCAke21pbnV0ZX0gYCA6IGAgJHttaW51dGVzfSBgKSA6ICIiOwogICAgICB2YXIgc0Rpc3BsYXkgPSBzID4gMCA/IHMgKyAocyA9PSAxID8gYCAke3NlY29uZH0gYCA6IGAgJHtzZWNvbmRzfSBgKSA6ICIiOwogICAgICByZXR1cm4gaERpc3BsYXkgKyBtRGlzcGxheSArIHNEaXNwbGF5OwogICAgfSwKCiAgICBnZXRHcm91cFdpdGhJZChpZCkgewogICAgICBsZXQgaW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoCiAgICAgICAgKGdyb3VwKSA9PiBncm91cC5pZCA9PSBpZAogICAgICApOwogICAgICByZXR1cm4gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaW5kZXhdOwogICAgfSwKICAgIGdldFN0cmVhbVdpdGhJZChpZCkgewogICAgICBsZXQgaW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMuZmluZEluZGV4KAogICAgICAgIChzdHJlYW0pID0+IHN0cmVhbS5pZCA9PSBpZAogICAgICApOwogICAgICByZXR1cm4gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XTsKICAgIH0sCiAgICBkb1NhdmUoKSB7CiAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gZmFsc2U7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgIGxldCBpbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleCgoZ3JvdXApID0+IHsKICAgICAgICAgIHJldHVybiBncm91cC5pZCA9PSB0aGlzLmFjdGl2ZUdyb3VwOwogICAgICAgIH0pOwogICAgICAgIGxldCB1cGRhdGVHcm91cHMgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3VwcwogICAgICAgICAgLmZpbHRlcigoZ3JvdXApID0+ICFncm91cC5ncm91cF9pc19yZW1vdmVkICYmIGdyb3VwLm1vZGlmaWVkKQogICAgICAgICAgLm1hcCgoZ3JvdXApID0+IHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICBpZDogZ3JvdXAuaWQsCiAgICAgICAgICAgICAgZ3JvdXBfbmFtZTogZ3JvdXAuZ3JvdXBfbmFtZSwKICAgICAgICAgICAgICBncm91cF9vcmRlcjogZ3JvdXAuZ3JvdXBfb3JkZXIsCiAgICAgICAgICAgICAgZ3JvdXBfdHlwZTogZ3JvdXAuZ3JvdXBfdHlwZSwKICAgICAgICAgICAgICBncm91cF9wYXJlbnRfY29kZTogZ3JvdXAuZ3JvdXBfcGFyZW50X2NvZGUsCiAgICAgICAgICAgICAgZ3JvdXBfaXNfaGlkZGVuOiBncm91cC5ncm91cF9pc19oaWRkZW4sCiAgICAgICAgICAgIH07CiAgICAgICAgICB9KTsKICAgICAgICBsZXQgZGVsZXRlR3JvdXBzID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMKICAgICAgICAgIC5maWx0ZXIoKGdyb3VwKSA9PiBncm91cC5ncm91cF9pc19yZW1vdmVkICYmIGdyb3VwLm1vZGlmaWVkKQogICAgICAgICAgLm1hcCgoZ3JvdXApID0+IGdyb3VwLmlkKQogICAgICAgICAgLmpvaW4oKTsKCiAgICAgICAgbGV0IHVwZGF0ZVN0cmVhbXM7CiAgICAgICAgc3dpdGNoICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSkgewogICAgICAgICAgLy8gTGl2ZSBzdHJlYW1zCiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIHVwZGF0ZVN0cmVhbXMgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMKICAgICAgICAgICAgICAuZmlsdGVyKAogICAgICAgICAgICAgICAgKHN0cmVhbSkgPT4gc3RyZWFtLnN0cmVhbV9pc19yZW1vdmVkICE9PSAxICYmIHN0cmVhbS5tb2RpZmllZAogICAgICAgICAgICAgICkKICAgICAgICAgICAgICAubWFwKChzdHJlYW0pID0+IHsKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgIGlkOiBzdHJlYW0uaWQsCiAgICAgICAgICAgICAgICAgIHNvdXJjZV9zdHJlYW1fdXJsOiBzdHJlYW0uc291cmNlX3N0cmVhbV91cmwsCiAgICAgICAgICAgICAgICAgIHN0cmVhbV90dmdfbmFtZTogc3RyZWFtLnN0cmVhbV90dmdfbmFtZSwKICAgICAgICAgICAgICAgICAgc3RyZWFtX3R2Z19pZDogc3RyZWFtLnN0cmVhbV90dmdfaWQsCiAgICAgICAgICAgICAgICAgIHN0cmVhbV90dmdfbG9nbzogc3RyZWFtLnN0cmVhbV90dmdfbG9nbywKICAgICAgICAgICAgICAgICAgc3RyZWFtX3BhcmVudF9jb2RlOiBzdHJlYW0uc3RyZWFtX3BhcmVudF9jb2RlLAogICAgICAgICAgICAgICAgICBzdHJlYW1fcmFkaW86IHN0cmVhbS5zdHJlYW1fcmFkaW8sCiAgICAgICAgICAgICAgICAgIHN0cmVhbV9pc19oaWRkZW46IHN0cmVhbS5zdHJlYW1faXNfaGlkZGVuLAogICAgICAgICAgICAgICAgICBzdHJlYW1fb3JkZXI6IHN0cmVhbS5zdHJlYW1fb3JkZXIsCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIC8vIE1vdmllcwogICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICB1cGRhdGVTdHJlYW1zID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zCiAgICAgICAgICAgICAgLmZpbHRlcigKICAgICAgICAgICAgICAgIChzdHJlYW0pID0+IHN0cmVhbS5zdHJlYW1faXNfcmVtb3ZlZCAhPT0gMSAmJiBzdHJlYW0ubW9kaWZpZWQKICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgLm1hcCgoc3RyZWFtKSA9PiB7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICBpZDogc3RyZWFtLmlkLAogICAgICAgICAgICAgICAgICBzb3VyY2Vfc3RyZWFtX3VybDogc3RyZWFtLnNvdXJjZV9zdHJlYW1fdXJsLAogICAgICAgICAgICAgICAgICBtb3ZpZV9uYW1lOiBzdHJlYW0ubW92aWVfbmFtZSwKICAgICAgICAgICAgICAgICAgbW92aWVfeWVhcjogc3RyZWFtLm1vdmllX3llYXIsCiAgICAgICAgICAgICAgICAgIHRtZGJfaWQ6IHN0cmVhbS50bWRiX2lkLAogICAgICAgICAgICAgICAgICBzdHJlYW1fdHZnX2xvZ286IHN0cmVhbS5zdHJlYW1fdHZnX2xvZ28sCiAgICAgICAgICAgICAgICAgIHN0cmVhbV9pc19oaWRkZW46IHN0cmVhbS5zdHJlYW1faXNfaGlkZGVuLAogICAgICAgICAgICAgICAgICBzdHJlYW1fb3JkZXI6IHN0cmVhbS5zdHJlYW1fb3JkZXIsCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIC8vIFNlcmllcwogICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICB1cGRhdGVTdHJlYW1zID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zCiAgICAgICAgICAgICAgLmZpbHRlcigKICAgICAgICAgICAgICAgIChzdHJlYW0pID0+IHN0cmVhbS5zdHJlYW1faXNfcmVtb3ZlZCAhPT0gMSAmJiBzdHJlYW0ubW9kaWZpZWQKICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgLm1hcCgoc3RyZWFtKSA9PiB7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICBpZDogc3RyZWFtLmlkLAogICAgICAgICAgICAgICAgICBzb3VyY2Vfc3RyZWFtX3VybDogc3RyZWFtLnNvdXJjZV9zdHJlYW1fdXJsLAogICAgICAgICAgICAgICAgICBzZXJpZV9uYW1lOiBzdHJlYW0uc2VyaWVfbmFtZSwKICAgICAgICAgICAgICAgICAgc2VyaWVfc2Vhc29uOiBzdHJlYW0uc2VyaWVfc2Vhc29uLAogICAgICAgICAgICAgICAgICBzZXJpZV9lcGlzb2RlOiBzdHJlYW0uc2VyaWVfZXBpc29kZSwKICAgICAgICAgICAgICAgICAgdG1kYl9pZDogc3RyZWFtLnRtZGJfaWQsCiAgICAgICAgICAgICAgICAgIHN0cmVhbV90dmdfbG9nbzogc3RyZWFtLnN0cmVhbV90dmdfbG9nbywKICAgICAgICAgICAgICAgICAgc3RyZWFtX2lzX2hpZGRlbjogc3RyZWFtLnN0cmVhbV9pc19oaWRkZW4sCiAgICAgICAgICAgICAgICAgIHN0cmVhbV9vcmRlcjogc3RyZWFtLnN0cmVhbV9vcmRlciwKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBsZXQgZGVsZXRlU3RyZWFtcyA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcwogICAgICAgICAgLmZpbHRlcigoc3RyZWFtKSA9PiBzdHJlYW0uc3RyZWFtX2lzX3JlbW92ZWQgPT09IDEgJiYgc3RyZWFtLm1vZGlmaWVkKQogICAgICAgICAgLm1hcCgoc3RyZWFtKSA9PiBzdHJlYW0uaWQpCiAgICAgICAgICAuam9pbigpOwoKICAgICAgICBsZXQgcmVxdWVzdHMgPSBbXTsKICAgICAgICBpZiAodXBkYXRlR3JvdXBzLmxlbmd0aCkgewogICAgICAgICAgcmVxdWVzdHMucHVzaCgKICAgICAgICAgICAgaHR0cFNlcnZpY2UucG9zdCgiZWRpdG9yL3VwZGF0ZS1ncm91cHMiLCB7CiAgICAgICAgICAgICAgcGxheWxpc3RfaWQ6IHRoaXMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICAgICAgZ3JvdXBzOiB1cGRhdGVHcm91cHMsCiAgICAgICAgICAgIH0pCiAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICBpZiAoZGVsZXRlR3JvdXBzLmxlbmd0aCkgewogICAgICAgICAgaW5kZXggPSAwOwogICAgICAgICAgcmVxdWVzdHMucHVzaCgKICAgICAgICAgICAgaHR0cFNlcnZpY2UucG9zdCgiZWRpdG9yL2RlbGV0ZS1ncm91cHMiLCB7CiAgICAgICAgICAgICAgcGxheWxpc3RfaWQ6IHRoaXMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICAgICAgZ3JvdXBzOiBkZWxldGVHcm91cHMsCiAgICAgICAgICAgIH0pCiAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICBpZiAodXBkYXRlU3RyZWFtcy5sZW5ndGgpIHsKICAgICAgICAgIHJlcXVlc3RzLnB1c2goCiAgICAgICAgICAgIGh0dHBTZXJ2aWNlLnBvc3QoYGVkaXRvci91cGRhdGUtc3RyZWFtcy8ke3RoaXMuYWN0aXZlR3JvdXBUeXBlfWAsIHsKICAgICAgICAgICAgICBwbGF5bGlzdF9pZDogdGhpcy5wbGF5bGlzdEVkaXRvci5pZCwKICAgICAgICAgICAgICBzdHJlYW1zOiB1cGRhdGVTdHJlYW1zLAogICAgICAgICAgICB9KQogICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgaWYgKGRlbGV0ZVN0cmVhbXMubGVuZ3RoKSB7CiAgICAgICAgICByZXF1ZXN0cy5wdXNoKAogICAgICAgICAgICBodHRwU2VydmljZS5wb3N0KGBlZGl0b3IvZGVsZXRlLXN0cmVhbXMvJHt0aGlzLmFjdGl2ZUdyb3VwVHlwZX1gLCB7CiAgICAgICAgICAgICAgcGxheWxpc3RfaWQ6IHRoaXMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICAgICAgc3RyZWFtczogZGVsZXRlU3RyZWFtcywKICAgICAgICAgICAgfSkKICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIFByb21pc2UuYWxsKHJlcXVlc3RzKS50aGVuKChyZXMpID0+IHsKICAgICAgICAgIHRoaXMubG9hZFBsYXlsaXN0KHRoaXMucGxheWxpc3RFZGl0b3IuaWQsIGluZGV4KTsKICAgICAgICAgIHJlc29sdmUocmVzKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LAogICAgZG9DYW5jZWwoKSB7CiAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgUHJvbWlzZS5hbGwoW3RoaXMucmVzdG9yZUdyb3VwcygpLCB0aGlzLnJlc3RvcmVTdHJlYW1zKCldKS50aGVuKCgpID0+IHsKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSBmYWxzZTsKICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9KTsKICAgIH0sCiAgICBkb1RhYkNoYW5nZSh0YWIpIHsKICAgICAgdGhpcy5hY3RpdmVUYWIgPSB0YWI7CiAgICB9LAogICAgdXBkYXRlR3JvdXBPcmRlcihzb3VyY2UpIHsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgbGV0IGdyb3VwcyA9IFsuLi5zb3VyY2VdOwogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZ3JvdXBzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBncm91cHNbaV0uc291cmNlX2dyb3VwX29yZGVyID0gaSArIDE7CiAgICAgICAgICBncm91cHNbaV0uZ3JvdXBfb3JkZXIgPSBpICsgMTsKICAgICAgICB9CiAgICAgICAgcmVzb2x2ZShncm91cHMpOwogICAgICB9KTsKICAgIH0sCiAgICB1cGRhdGVTdHJlYW1PcmRlcihzb3VyY2UpIHsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgbGV0IHN0cmVhbXMgPSBbLi4uc291cmNlXTsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHN0cmVhbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHN0cmVhbXNbaV0uc291cmNlX3N0cmVhbV9vcmRlciA9IGkgKyAxOwogICAgICAgICAgc3RyZWFtc1tpXS5zdHJlYW1fb3JkZXIgPSBpICsgMTsKICAgICAgICB9CiAgICAgICAgcmVzb2x2ZShzdHJlYW1zKTsKICAgICAgfSk7CiAgICB9LAogICAgcmVzdG9yZUdyb3VwT3JkZXIoKSB7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLnNvcnQoKGEsIGIpID0+CiAgICAgICAgICBhLnNvdXJjZV9ncm91cF9vcmRlciA+IGIuc291cmNlX2dyb3VwX29yZGVyCiAgICAgICAgICAgID8gMQogICAgICAgICAgICA6IGIuc291cmNlX2dyb3VwX29yZGVyID4gYS5zb3VyY2VfZ3JvdXBfb3JkZXIKICAgICAgICAgICAgPyAtMQogICAgICAgICAgICA6IDAKICAgICAgICApOwogICAgICAgIHJlc29sdmUoKTsKICAgICAgfSk7CiAgICB9LAogICAgcmVzdG9yZVN0cmVhbU9yZGVyKCkgewogICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMuc29ydCgoYSwgYikgPT4KICAgICAgICAgIGEuc291cmNlX3N0cmVhbV9vcmRlciA+IGIuc291cmNlX3N0cmVhbV9vcmRlcgogICAgICAgICAgICA/IDEKICAgICAgICAgICAgOiBiLnNvdXJjZV9zdHJlYW1fb3JkZXIgPiBhLnNvdXJjZV9zdHJlYW1fb3JkZXIKICAgICAgICAgICAgPyAtMQogICAgICAgICAgICA6IDAKICAgICAgICApOwogICAgICAgIHJlc29sdmUoKTsKICAgICAgfSk7CiAgICB9LAogICAgcmVzdG9yZUdyb3VwcygpIHsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgdGhpcy5yZXN0b3JlR3JvdXBPcmRlcigpLnRoZW4oKCkgPT4gewogICAgICAgICAgbGV0IGdyb3VwOwogICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBncm91cCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldOwogICAgICAgICAgICBncm91cC5tb2RpZmllZCA9IGZhbHNlOwogICAgICAgICAgICBncm91cC5ncm91cF9pc19yZW1vdmVkID0gMDsKICAgICAgICAgICAgZ3JvdXAuZ3JvdXBfdHlwZSA9IGdyb3VwLnNvdXJjZV9ncm91cF90eXBlOwogICAgICAgICAgICBncm91cC5ncm91cF9uYW1lID0gZ3JvdXAuc291cmNlX2dyb3VwX25hbWU7CiAgICAgICAgICAgIGdyb3VwLnBhcmVudF9jb2RlID0gZ3JvdXAuc291cmNlX2dyb3VwX3BhcmVudF9jb2RlOwogICAgICAgICAgICBncm91cC5ncm91cF9pc19oaWRkZW4gPSBncm91cC5zb3VyY2VfZ3JvdXBfaXNfaGlkZGVuOwogICAgICAgICAgfQogICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0sCiAgICByZXN0b3JlU3RyZWFtcygpIHsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgdGhpcy5yZXN0b3JlU3RyZWFtT3JkZXIoKS50aGVuKCgpID0+IHsKICAgICAgICAgIGxldCBzdHJlYW07CiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBzdHJlYW0gPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV07CiAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IGZhbHNlOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX2lzX3JlbW92ZWQgPSAwOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lID0gc3RyZWFtLnNvdXJjZV9zdHJlYW1fdHZnX25hbWU7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX2lkID0gc3RyZWFtLnNvdXJjZV9zdHJlYW1fdHZnX2lkOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19sb2dvID0gc3RyZWFtLnNvdXJjZV9zdHJlYW1fdHZnX2xvZ287CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX2Nobm8gPSBzdHJlYW0uc291cmNlX3N0cmVhbV90dmdfY2hubzsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfc2hpZnQgPSBzdHJlYW0uc291cmNlX3N0cmVhbV90dmdfc2hpZnQ7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fcGFyZW50X2NvZGUgPSBzdHJlYW0uc291cmNlX3N0cmVhbV9wYXJlbnRfY29kZTsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV9hdWRpb190cmFjayA9IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX2F1ZGlvX3RyYWNrOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX2FzcGVjdF9yYXRpbyA9IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX2FzcGVjdF9yYXRpbzsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV9yYWRpbyA9IHN0cmVhbS5zb3VyY2Vfc3RyZWFtX3JhZGlvOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX29yZGVyID0gc3RyZWFtLnNvdXJjZV9zdHJlYW1fb3JkZXI7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1faXNfaGlkZGVuID0gc3RyZWFtLnNvdXJjZV9zdHJlYW1faXNfaGlkZGVuOwogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgc3RyZWFtLm1vdmllX25hbWUgIT09IHVuZGVmaW5lZCAmJgogICAgICAgICAgICAgIHN0cmVhbS5tb3ZpZV95ZWFyICE9PSB1bmRlZmluZWQKICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgc3RyZWFtLm1vdmllX25hbWUgPSBzdHJlYW0uc291cmNlX21vdmllX25hbWU7CiAgICAgICAgICAgICAgc3RyZWFtLm1vdmllX3llYXIgPSBzdHJlYW0uc291cmNlX21vdmllX3llYXI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgIHN0cmVhbS5zZXJpZV9uYW1lICE9PSB1bmRlZmluZWQgJiYKICAgICAgICAgICAgICBzdHJlYW0uc2VyaWVfc2Vhc29uICE9PSB1bmRlZmluZWQgJiYKICAgICAgICAgICAgICBzdHJlYW0uc2VyaWVfZXBpc29kZSAhPT0gdW5kZWZpbmVkCiAgICAgICAgICAgICkgewogICAgICAgICAgICAgIHN0cmVhbS5zZXJpZV9uYW1lID0gc3RyZWFtLnNvdXJjZV9zZXJpZV9uYW1lOwogICAgICAgICAgICAgIHN0cmVhbS5zZXJpZV9zZWFzb24gPSBzdHJlYW0uc291cmNlX3NlcmllX3NlYXNvbjsKICAgICAgICAgICAgICBzdHJlYW0uc2VyaWVfZXBpc29kZSA9IHN0cmVhbS5zb3VyY2Vfc2VyaWVfZXBpc29kZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0sCiAgICB0b2dnbGVHcm91cFZpc2liaWxpdHkoKSB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cHMuaW5jbHVkZXModGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uaWQpKSB7CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5ncm91cF9pc19oaWRkZW4gPQogICAgICAgICAgICAhdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uZ3JvdXBfaXNfaGlkZGVuOwogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgfSwKICAgIHRvZ2dsZVN0cmVhbVZpc2liaWxpdHkoKSB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHRoaXMuYWN0aXZlU3RyZWFtcy5pbmNsdWRlcyh0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uaWQpKSB7CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uc3RyZWFtX2lzX2hpZGRlbiA9CiAgICAgICAgICAgICF0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uc3RyZWFtX2lzX2hpZGRlbjsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICB9LAogICAgdG9nZ2xlU3RyZWFtUmFkaW8oKSB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHRoaXMuYWN0aXZlU3RyZWFtcy5pbmNsdWRlcyh0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uaWQpKSB7CiAgICAgICAgICBpZiAodGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLnN0cmVhbV9yYWRpbyA9PSAwKSB7CiAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5zdHJlYW1fcmFkaW8gPSAxOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLnN0cmVhbV9yYWRpbyA9IDA7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgfSwKICAgIGRlbGV0ZVNlbGVjdGVkR3JvdXBzKCkgewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBzLmluY2x1ZGVzKHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmlkKSkgewogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uZ3JvdXBfaXNfcmVtb3ZlZCA9IDE7CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICB9LAogICAgZGVsZXRlU2VsZWN0ZWRTdHJlYW1zKCkgewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmICh0aGlzLmFjdGl2ZVN0cmVhbXMuaW5jbHVkZXModGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLmlkKSkgewogICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLnN0cmVhbV9pc19yZW1vdmVkID0gMTsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICB9LAogICAgbG9hZFBsYXlsaXN0KHZhbCwgZ3JvdXBfaW5kZXggPSB1bmRlZmluZWQpIHsKICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBpZiAodGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkKSB7CiAgICAgICAgdGhpcy5kb1NhdmUoKTsKICAgICAgfQogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkID0gdmFsOwogICAgICBodHRwU2VydmljZQogICAgICAgIC5nZXQoYGVkaXRvci9ncm91cHMvJHt2YWx9YCkKICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICBpZiAocmVzLnN0YXR1cyA9PT0gdHJ1ZSkgewogICAgICAgICAgICB0aGlzLnVwZGF0ZUdyb3VwT3JkZXIocmVzLmRhdGEpLnRoZW4oKGdyb3VwcykgPT4gewogICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzID0gZ3JvdXBzLm1hcCgoZ3JvdXApID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGdycCA9IE9iamVjdC5hc3NpZ24oe30sIGdyb3VwKTsKICAgICAgICAgICAgICAgIGdycC5zb3VyY2VfZ3JvdXBfcGFyZW50X2NvZGUgPSBncm91cC5ncm91cF9wYXJlbnRfY29kZTsKICAgICAgICAgICAgICAgIGdycC5zb3VyY2VfZ3JvdXBfaXNfaGlkZGVuID0gZ3JvdXAuZ3JvdXBfaXNfaGlkZGVuOwogICAgICAgICAgICAgICAgZ3JwLnNvdXJjZV9ncm91cF9uYW1lID0gZ3JvdXAuZ3JvdXBfbmFtZTsKICAgICAgICAgICAgICAgIGdycC5zb3VyY2VfZ3JvdXBfdHlwZSA9IGdyb3VwLmdyb3VwX3R5cGU7CiAgICAgICAgICAgICAgICBncnAuZ3JvdXBfaXNfcmVtb3ZlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgZ3JwLm1vZGlmaWVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICByZXR1cm4gZ3JwOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIGlmIChncm91cHMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICBpZiAoZ3JvdXBfaW5kZXggPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZUdyb3VwID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbMF0uaWQ7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZUdyb3VwID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbZ3JvdXBfaW5kZXhdLmlkOwogICAgICAgICAgICAgICAgICB0aGlzLmxvYWRTdHJlYW1zKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICB9KTsKICAgIH0sCiAgICB0b2dnbGVHcm91cFNlbGVjdGlvbihpdGVtKSB7CiAgICAgIGxldCBpZHggPSB0aGlzLmFjdGl2ZUdyb3Vwcy5pbmRleE9mKGl0ZW0pOwogICAgICBpZiAoaWR4ICE9PSAtMSkgewogICAgICAgIHRoaXMuYWN0aXZlR3JvdXBzLnNwbGljZShpZHgsIDEpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYWN0aXZlR3JvdXBzLnB1c2goaXRlbSk7CiAgICAgIH0KICAgIH0sCiAgICB0b2dnbGVTdHJlYW1TZWxlY3Rpb24oaXRlbSkgewogICAgICBsZXQgaWR4ID0gdGhpcy5hY3RpdmVTdHJlYW1zLmluZGV4T2YoaXRlbSk7CiAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgdGhpcy5hY3RpdmVTdHJlYW1zLnNwbGljZShpZHgsIDEpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYWN0aXZlU3RyZWFtcy5wdXNoKGl0ZW0pOwogICAgICB9CiAgICB9LAogICAgdG9nZ2xlUmFkaW9icm93c2VyU2VsZWN0aW9uKGl0ZW0pIHsKICAgICAgbGV0IGlkeCA9IHRoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZS5pbmRleE9mKGl0ZW0pOwogICAgICBpZiAoaWR4ICE9PSAtMSkgewogICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZS5zcGxpY2UoaWR4LCAxKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnJhZGlvQnJvd3Nlci5hY3RpdmUucHVzaChpdGVtKTsKICAgICAgfQogICAgfSwKICAgIHRvZ2dsZUltcG9ydE0zVVNlbGVjdGlvbihpdGVtKSB7CiAgICAgIGxldCBpZHggPSB0aGlzLmltcG9ydE0zVS5pbXBvcnRHcm91cHMuaW5kZXhPZihpdGVtKTsKICAgICAgaWYgKGlkeCAhPT0gLTEpIHsKICAgICAgICB0aGlzLmltcG9ydE0zVS5pbXBvcnRHcm91cHMuc3BsaWNlKGlkeCwgMSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5pbXBvcnRNM1UuaW1wb3J0R3JvdXBzLnB1c2goaXRlbSk7CiAgICAgIH0KICAgIH0sCiAgICBpbmRleE9mR3JvdXAoZ3JvdXApIHsKICAgICAgcmV0dXJuIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLm1hcCgoZykgPT4gZy5pZCkuaW5kZXhPZihncm91cCk7CiAgICB9LAogICAgc2VsZWN0R3JvdXBSYW5nZVNlbGVjdGlvbihpdGVtKSB7CiAgICAgIGNvbnN0IGxhc3RJbmRleCA9IHRoaXMuaW5kZXhPZkdyb3VwKHRoaXMubGFzdFNlbGVjdGVkR3JvdXApOwogICAgICBjb25zdCBpdGVtSW5kZXggPSB0aGlzLmluZGV4T2ZHcm91cChpdGVtKTsKICAgICAgY29uc3QgZGlyID0gaXRlbUluZGV4ID4gbGFzdEluZGV4ID8gMSA6IC0xOwogICAgICBmb3IgKGxldCBpID0gbGFzdEluZGV4OyBpICE9IGl0ZW1JbmRleCArIGRpcjsgaSArPSBkaXIpIHsKICAgICAgICBpZiAoIXRoaXMuYWN0aXZlR3JvdXBzLmluY2x1ZGVzKHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmlkKSkgewogICAgICAgICAgdGhpcy5hY3RpdmVHcm91cHMucHVzaCh0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5pZCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgaW5kZXhPZlN0cmVhbShzdHJlYW0pIHsKICAgICAgcmV0dXJuIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5tYXAoKGcpID0+IGcuaWQpLmluZGV4T2Yoc3RyZWFtKTsKICAgIH0sCiAgICBzZWxlY3RTdHJlYW1SYW5nZVNlbGVjdGlvbihpdGVtKSB7CiAgICAgIGNvbnN0IGxhc3RJbmRleCA9IHRoaXMuaW5kZXhPZlN0cmVhbSh0aGlzLmxhc3RTZWxlY3RlZFN0cmVhbSk7CiAgICAgIGNvbnN0IGl0ZW1JbmRleCA9IHRoaXMuaW5kZXhPZlN0cmVhbShpdGVtKTsKICAgICAgY29uc3QgZGlyID0gaXRlbUluZGV4ID4gbGFzdEluZGV4ID8gMSA6IC0xOwogICAgICBmb3IgKGxldCBpID0gbGFzdEluZGV4OyBpICE9IGl0ZW1JbmRleCArIGRpcjsgaSArPSBkaXIpIHsKICAgICAgICBpZiAoIXRoaXMuYWN0aXZlU3RyZWFtcy5pbmNsdWRlcyh0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uaWQpKSB7CiAgICAgICAgICB0aGlzLmFjdGl2ZVN0cmVhbXMucHVzaCh0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uaWQpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHNlbGVjdFJhZGlvYnJvd3NlclJhbmdlU2VsZWN0aW9uKGluZGV4KSB7CiAgICAgIGNvbnN0IGxhc3RJbmRleCA9CiAgICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuYWN0aXZlW3RoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZS5sZW5ndGggLSAxXTsKICAgICAgY29uc3QgZGlyID0gaW5kZXggPiBsYXN0SW5kZXggPyAxIDogLTE7CiAgICAgIGZvciAobGV0IGkgPSBsYXN0SW5kZXg7IGkgIT0gaW5kZXggKyBkaXI7IGkgKz0gZGlyKSB7CiAgICAgICAgaWYgKCF0aGlzLnJhZGlvQnJvd3Nlci5hY3RpdmUuaW5jbHVkZXMoaSkpIHsKICAgICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZS5wdXNoKGkpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHNlbGVjdEltcG9ydE0zVVJhbmdlU2VsZWN0aW9uKGluZGV4KSB7CiAgICAgIGNvbnN0IGxhc3RJbmRleCA9CiAgICAgICAgdGhpcy5pbXBvcnRNM1UuaW1wb3J0R3JvdXBzW3RoaXMuaW1wb3J0TTNVLmltcG9ydEdyb3Vwcy5sZW5ndGggLSAxXTsKICAgICAgY29uc3QgZGlyID0gaW5kZXggPiBsYXN0SW5kZXggPyAxIDogLTE7CiAgICAgIGZvciAobGV0IGkgPSBsYXN0SW5kZXg7IGkgIT0gaW5kZXggKyBkaXI7IGkgKz0gZGlyKSB7CiAgICAgICAgaWYgKCF0aGlzLmltcG9ydE0zVS5pbXBvcnRHcm91cHMuaW5jbHVkZXMoaSkpIHsKICAgICAgICAgIHRoaXMuaW1wb3J0TTNVLmltcG9ydEdyb3Vwcy5wdXNoKGkpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHNlbGVjdEdyb3VwU2VsZWN0aW9uKGl0ZW0pIHsKICAgICAgdGhpcy5hY3RpdmVHcm91cHMubGVuZ3RoID0gMDsKICAgICAgdGhpcy5hY3RpdmVHcm91cHMucHVzaChpdGVtKTsKICAgIH0sCiAgICBzZWxlY3RTdHJlYW1TZWxlY3Rpb24oaXRlbSkgewogICAgICB0aGlzLmFjdGl2ZVN0cmVhbXMubGVuZ3RoID0gMDsKICAgICAgdGhpcy5hY3RpdmVTdHJlYW1zLnB1c2goaXRlbSk7CiAgICB9LAogICAgc2VsZWN0UmFkaW9icm93c2VyU2VsZWN0aW9uKGl0ZW0pIHsKICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuYWN0aXZlLmxlbmd0aCA9IDA7CiAgICAgIHRoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZS5wdXNoKGl0ZW0pOwogICAgfSwKICAgIHNlbGVjdEltcG9ydE0zVVNlbGVjdGlvbihpdGVtKSB7CiAgICAgIHRoaXMuaW1wb3J0TTNVLmltcG9ydEdyb3Vwcy5sZW5ndGggPSAwOwogICAgICB0aGlzLmltcG9ydE0zVS5pbXBvcnRHcm91cHMucHVzaChpdGVtKTsKICAgIH0sCiAgICBmaW5kQW5kUmVwbGFjZU1vZGFsKHNob3csIHR5cGUgPSAxKSB7CiAgICAgIHRoaXMuZmluZFJlcGxhY2UudHlwZSA9IHR5cGU7CiAgICAgIHRoaXMuZmluZFJlcGxhY2UubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGZpbmRBbmRSZXBsYWNlKCkgewogICAgICBsZXQgb3B0aW9ucyA9ICIiOwogICAgICBpZiAodGhpcy5maW5kUmVwbGFjZS5yZXBsYWNlQWxsKSB7CiAgICAgICAgb3B0aW9ucyArPSAiZyI7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuZmluZFJlcGxhY2UuaWdub3JlQ2FzZSkgewogICAgICAgIG9wdGlvbnMgKz0gImkiOwogICAgICB9CiAgICAgIGxldCByZSA9IG5ldyBSZWdFeHAodGhpcy5maW5kUmVwbGFjZS5mcm9tLnJlcGxhY2UoInwiLCAiXFx8IiksIG9wdGlvbnMpOwogICAgICBzd2l0Y2ggKHBhcnNlSW50KHRoaXMuZmluZFJlcGxhY2UudHlwZSkpIHsKICAgICAgICAvLyBHcm91cAogICAgICAgIGNhc2UgMToKICAgICAgICAgIGlmIChwYXJzZUludCh0aGlzLmZpbmRSZXBsYWNlLnNlbGVjdGVkT25seSkgPT09IDEpIHsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlR3JvdXBzLmluY2x1ZGVzKHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmlkKQogICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaV0uZ3JvdXBfbmFtZSA9CiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmdyb3VwX25hbWUucmVwbGFjZSgKICAgICAgICAgICAgICAgICAgICByZSwKICAgICAgICAgICAgICAgICAgICB0aGlzLmZpbmRSZXBsYWNlLnRvCiAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLmZpbHRlcmVkR3JvdXBzLm1hcCgoZ3JvdXApID0+IHsKICAgICAgICAgICAgICBncm91cC5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgZ3JvdXAuZ3JvdXBfbmFtZSA9IGdyb3VwLmdyb3VwX25hbWUucmVwbGFjZSgKICAgICAgICAgICAgICAgIHJlLAogICAgICAgICAgICAgICAgdGhpcy5maW5kUmVwbGFjZS50bwogICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CgogICAgICAgIC8vIFN0cmVhbXMKICAgICAgICBjYXNlIDI6CiAgICAgICAgICBpZiAocGFyc2VJbnQodGhpcy5maW5kUmVwbGFjZS5zZWxlY3RlZE9ubHkpID09PSAxKSB7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgdGhpcy5hY3RpdmVTdHJlYW1zLmluY2x1ZGVzKHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5pZCkKICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMSkgewogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uc3RyZWFtX3R2Z19uYW1lID0KICAgICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uc3RyZWFtX3R2Z19uYW1lLnJlcGxhY2UoCiAgICAgICAgICAgICAgICAgICAgICByZSwKICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmluZFJlcGxhY2UudG8KICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5tb3ZpZV9uYW1lID0KICAgICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0ubW92aWVfbmFtZS5yZXBsYWNlKAogICAgICAgICAgICAgICAgICAgICAgcmUsCiAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZpbmRSZXBsYWNlLnRvCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMykgewogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uc2VyaWVfbmFtZSA9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLnNlcmllX25hbWUucmVwbGFjZSgKICAgICAgICAgICAgICAgICAgICAgIHJlLAogICAgICAgICAgICAgICAgICAgICAgdGhpcy5maW5kUmVwbGFjZS50bwogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLmZpbHRlcmVkU3RyZWFtcy5tYXAoKHN0cmVhbSkgPT4gewogICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMSkgewogICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX25hbWUgPSBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lLnJlcGxhY2UoCiAgICAgICAgICAgICAgICAgIHJlLAogICAgICAgICAgICAgICAgICB0aGlzLmZpbmRSZXBsYWNlLnRvCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDIpIHsKICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICBzdHJlYW0ubW92aWVfbmFtZSA9IHN0cmVhbS5tb3ZpZV9uYW1lLnJlcGxhY2UoCiAgICAgICAgICAgICAgICAgIHJlLAogICAgICAgICAgICAgICAgICB0aGlzLmZpbmRSZXBsYWNlLnRvCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDMpIHsKICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICBzdHJlYW0uc2VyaWVfbmFtZSA9IHN0cmVhbS5zZXJpZV9uYW1lLnJlcGxhY2UoCiAgICAgICAgICAgICAgICAgIHJlLAogICAgICAgICAgICAgICAgICB0aGlzLmZpbmRSZXBsYWNlLnRvCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgICB0aGlzLmZpbmRSZXBsYWNlLm1vZGFsID0gZmFsc2U7CiAgICB9LAogICAgcHJlZml4U3VmZml4TW9kYWwoc2hvdywgdHlwZSA9IDEpIHsKICAgICAgdGhpcy5wcmVmaXhTdWZmaXgudHlwZSA9IHR5cGU7CiAgICAgIHRoaXMucHJlZml4U3VmZml4Lm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBhZGRQcmVmaXhTdWZmaXgoKSB7CiAgICAgIGxldCBwcmVmaXggPSB0aGlzLnByZWZpeFN1ZmZpeC5wcmVmaXg7CiAgICAgIGxldCBzdWZmaXggPSB0aGlzLnByZWZpeFN1ZmZpeC5zdWZmaXg7CiAgICAgIHN3aXRjaCAocGFyc2VJbnQodGhpcy5wcmVmaXhTdWZmaXgudHlwZSkpIHsKICAgICAgICAvLyBHcm91cAogICAgICAgIGNhc2UgMToKICAgICAgICAgIGlmIChwYXJzZUludCh0aGlzLnByZWZpeFN1ZmZpeC5zZWxlY3RlZE9ubHkpID09PSAxKSB7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZUdyb3Vwcy5pbmNsdWRlcyh0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5pZCkKICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2ldLmdyb3VwX25hbWUgPQogICAgICAgICAgICAgICAgICBwcmVmaXggKyB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpXS5ncm91cF9uYW1lICsgc3VmZml4OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5maWx0ZXJlZEdyb3Vwcy5tYXAoKGdyb3VwKSA9PiB7CiAgICAgICAgICAgICAgZ3JvdXAubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgIGdyb3VwLmdyb3VwX25hbWUgPSBwcmVmaXggKyBncm91cC5ncm91cF9uYW1lICsgc3VmZml4OwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwoKICAgICAgICAvLyBTdHJlYW0KICAgICAgICBjYXNlIDI6CiAgICAgICAgICBpZiAocGFyc2VJbnQodGhpcy5wcmVmaXhTdWZmaXguc2VsZWN0ZWRPbmx5KSA9PT0gMSkgewogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlU3RyZWFtcy5pbmNsdWRlcyh0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uaWQpCiAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDEpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLnN0cmVhbV90dmdfbmFtZSA9CiAgICAgICAgICAgICAgICAgICAgcHJlZml4ICsKICAgICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uc3RyZWFtX3R2Z19uYW1lICsKICAgICAgICAgICAgICAgICAgICBzdWZmaXg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDIpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2ldLm1vdmllX25hbWUgPQogICAgICAgICAgICAgICAgICAgIHByZWZpeCArIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5tb3ZpZV9uYW1lICsgc3VmZml4OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAzKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpXS5zZXJpZV9uYW1lID0KICAgICAgICAgICAgICAgICAgICBwcmVmaXggKyB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaV0uc2VyaWVfbmFtZSArIHN1ZmZpeDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMSkgewogICAgICAgICAgICAgIHRoaXMuZmlsdGVyZWRTdHJlYW1zLm1hcCgoc3RyZWFtKSA9PiB7CiAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfbmFtZSA9CiAgICAgICAgICAgICAgICAgIHByZWZpeCArIHN0cmVhbS5zdHJlYW1fdHZnX25hbWUgKyBzdWZmaXg7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAyKSB7CiAgICAgICAgICAgICAgdGhpcy5maWx0ZXJlZFN0cmVhbXMubWFwKChzdHJlYW0pID0+IHsKICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICBzdHJlYW0ubW92aWVfbmFtZSA9IHByZWZpeCArIHN0cmVhbS5tb3ZpZV9uYW1lICsgc3VmZml4OwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMykgewogICAgICAgICAgICAgIHRoaXMuZmlsdGVyZWRTdHJlYW1zLm1hcCgoc3RyZWFtKSA9PiB7CiAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgc3RyZWFtLnNlcmllX25hbWUgPSBwcmVmaXggKyBzdHJlYW0uc2VyaWVfbmFtZSArIHN1ZmZpeDsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgICAgdGhpcy5wcmVmaXhTdWZmaXgubW9kYWwgPSBmYWxzZTsKICAgIH0sCiAgICBjb252ZXJ0Q2FzZU1vZGFsKHNob3csIHR5cGUpIHsKICAgICAgdGhpcy5jb252ZXJ0Q2FzZS50eXBlID0gdHlwZTsKICAgICAgdGhpcy5jb252ZXJ0Q2FzZS5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgY2hhbmdlQ2FzZSgpIHsKICAgICAgbGV0IG1ldGhvZCA9IHRoaXMuY29udmVydENhc2UubWV0aG9kOwogICAgICBsZXQgZ3JvdXBzOwogICAgICBsZXQgc3RyZWFtczsKICAgICAgaWYgKHBhcnNlSW50KHRoaXMuY29udmVydENhc2Uuc2VsZWN0ZWRPbmx5KSA9PT0gMSkgewogICAgICAgIGdyb3VwcyA9IHRoaXMuZmlsdGVyZWRHcm91cHMuZmlsdGVyKChncm91cCkgPT4gewogICAgICAgICAgcmV0dXJuIHRoaXMuYWN0aXZlR3JvdXBzLmluY2x1ZGVzKGdyb3VwLmlkKTsKICAgICAgICB9KTsKICAgICAgICBzdHJlYW1zID0gdGhpcy5maWx0ZXJlZFN0cmVhbXMuZmlsdGVyKChzdHJlYW0pID0+IHsKICAgICAgICAgIHJldHVybiB0aGlzLmFjdGl2ZVN0cmVhbXMuaW5jbHVkZXMoc3RyZWFtLmlkKTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBncm91cHMgPSB0aGlzLmZpbHRlcmVkR3JvdXBzOwogICAgICAgIHN0cmVhbXMgPSB0aGlzLmZpbHRlcmVkU3RyZWFtczsKICAgICAgfQogICAgICBzd2l0Y2ggKHBhcnNlSW50KHRoaXMuY29udmVydENhc2UudHlwZSkpIHsKICAgICAgICAvLyBDYXRlZ29yaWVzCiAgICAgICAgY2FzZSAxOgogICAgICAgICAgZ3JvdXBzLm1hcCgoZ3JvdXApID0+IHsKICAgICAgICAgICAgc3dpdGNoIChwYXJzZUludChtZXRob2QpKSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgZ3JvdXAubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgZ3JvdXAuZ3JvdXBfbmFtZSA9IGdyb3VwLmdyb3VwX25hbWUudGl0bGVDYXNlKCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICBncm91cC5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICBncm91cC5ncm91cF9uYW1lID0gZ3JvdXAuZ3JvdXBfbmFtZS50b1VwcGVyQ2FzZSgpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgZ3JvdXAubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgZ3JvdXAuZ3JvdXBfbmFtZSA9IGdyb3VwLmdyb3VwX25hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICAvLyBTdHJlYW1zCiAgICAgICAgY2FzZSAyOgogICAgICAgICAgc3RyZWFtcy5tYXAoKHN0cmVhbSkgPT4gewogICAgICAgICAgICBzd2l0Y2ggKHBhcnNlSW50KG1ldGhvZCkpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDEpIHsKICAgICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfbmFtZSA9IHN0cmVhbS5zdHJlYW1fdHZnX25hbWUudGl0bGVDYXNlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDIpIHsKICAgICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgc3RyZWFtLm1vdmllX25hbWUgPSBzdHJlYW0ubW92aWVfbmFtZS50aXRsZUNhc2UoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMykgewogICAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICBzdHJlYW0uc2VyaWVfbmFtZSA9IHN0cmVhbS5zZXJpZV9uYW1lLnRpdGxlQ2FzZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAxKSB7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX25hbWUgPSBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lLnRvVXBwZXJDYXNlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodGhpcy5hY3RpdmVHcm91cFR5cGUgPT09IDIpIHsKICAgICAgICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgc3RyZWFtLm1vdmllX25hbWUgPSBzdHJlYW0ubW92aWVfbmFtZS50b1VwcGVyQ2FzZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAzKSB7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5zZXJpZV9uYW1lID0gc3RyZWFtLnNlcmllX25hbWUudG9VcHBlckNhc2UoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMSkgewogICAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lID0gc3RyZWFtLnN0cmVhbV90dmdfbmFtZS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlR3JvdXBUeXBlID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHN0cmVhbS5tb3ZpZV9uYW1lID0gc3RyZWFtLm1vdmllX25hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZUdyb3VwVHlwZSA9PT0gMykgewogICAgICAgICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICBzdHJlYW0uc2VyaWVfbmFtZSA9IHN0cmVhbS5zZXJpZV9uYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgICB0aGlzLmNvbnZlcnRDYXNlLm1vZGFsID0gZmFsc2U7CiAgICB9LAogICAgZWRpdEdyb3VwTW9kYWwoc2hvdykgewogICAgICBsZXQgaW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoCiAgICAgICAgKGdyb3VwKSA9PiBncm91cC5pZCA9PT0gdGhpcy5hY3RpdmVHcm91cHNbMF0KICAgICAgKTsKICAgICAgbGV0IGdyb3VwID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHNbaW5kZXhdOwogICAgICBpZiAoZ3JvdXApIHsKICAgICAgICB0aGlzLmdyb3VwRWRpdG9yLmlkID0gdGhpcy5hY3RpdmVHcm91cHNbMF07CiAgICAgICAgdGhpcy5ncm91cEVkaXRvci5ncm91cF90eXBlID0gZ3JvdXAuZ3JvdXBfdHlwZTsKICAgICAgICB0aGlzLmdyb3VwRWRpdG9yLmdyb3VwX25hbWUgPSBncm91cC5ncm91cF9uYW1lOwogICAgICAgIHRoaXMuZ3JvdXBFZGl0b3IuZ3JvdXBfaXNfaGlkZGVuID0gZ3JvdXAuZ3JvdXBfaXNfaGlkZGVuOwogICAgICAgIHRoaXMuZ3JvdXBFZGl0b3IuZ3JvdXBfcGFyZW50X2NvZGUgPSBncm91cC5ncm91cF9wYXJlbnRfY29kZTsKICAgICAgICB0aGlzLmdyb3VwRWRpdG9yLm1vZGFsID0gc2hvdzsKICAgICAgfQogICAgfSwKICAgIGVkaXRTdHJlYW1Nb2RhbChzaG93KSB7CiAgICAgIGxldCBpbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5maW5kSW5kZXgoCiAgICAgICAgKHN0cmVhbSkgPT4gc3RyZWFtLmlkID09PSB0aGlzLmFjdGl2ZVN0cmVhbXNbMF0KICAgICAgKTsKICAgICAgbGV0IHN0cmVhbSA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF07CiAgICAgIGlmIChzdHJlYW0pIHsKICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5pZCA9IHRoaXMuYWN0aXZlU3RyZWFtc1swXTsKICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1fdHZnX25hbWUgPSBzdHJlYW0uc3RyZWFtX3R2Z19uYW1lOwogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV90dmdfaWQgPSBzdHJlYW0uc3RyZWFtX3R2Z19pZDsKICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1fdHZnX2xvZ28gPSBzdHJlYW0uc3RyZWFtX3R2Z19sb2dvOwogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV9wYXJlbnRfY29kZSA9IHN0cmVhbS5zdHJlYW1fcGFyZW50X2NvZGU7CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX3JhZGlvID0gc3RyZWFtLnN0cmVhbV9yYWRpbzsKICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1faXNfaGlkZGVuID0gc3RyZWFtLnN0cmVhbV9pc19oaWRkZW47CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc291cmNlX3N0cmVhbV91cmwgPSBzdHJlYW0uc291cmNlX3N0cmVhbV91cmw7CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX2lzX2N1c3RvbSA9IHN0cmVhbS5zdHJlYW1faXNfY3VzdG9tOwogICAgICAgIGlmICgKICAgICAgICAgIHN0cmVhbS5tb3ZpZV9uYW1lICE9PSB1bmRlZmluZWQgJiYKICAgICAgICAgIHN0cmVhbS5tb3ZpZV95ZWFyICE9PSB1bmRlZmluZWQgJiYKICAgICAgICAgIHN0cmVhbS50bWRiX2lkICE9PSB1bmRlZmluZWQKICAgICAgICApIHsKICAgICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLm1vdmllX25hbWUgPSBzdHJlYW0ubW92aWVfbmFtZTsKICAgICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLm1vdmllX3llYXIgPSBzdHJlYW0ubW92aWVfeWVhcjsKICAgICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnRtZGJfaWQgPSBzdHJlYW0udG1kYl9pZDsKICAgICAgICB9CiAgICAgICAgaWYgKAogICAgICAgICAgc3RyZWFtLnNlcmllX25hbWUgIT09IHVuZGVmaW5lZCAmJgogICAgICAgICAgc3RyZWFtLnNlcmllX3NlYXNvbiAhPT0gdW5kZWZpbmVkICYmCiAgICAgICAgICBzdHJlYW0uc2VyaWVfZXBpc29kZSAhPT0gdW5kZWZpbmVkCiAgICAgICAgKSB7CiAgICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zZXJpZV9uYW1lID0gc3RyZWFtLnNlcmllX25hbWU7CiAgICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zZXJpZV9zZWFzb24gPSBzdHJlYW0uc2VyaWVfc2Vhc29uOwogICAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc2VyaWVfZXBpc29kZSA9IHN0cmVhbS5zZXJpZV9lcGlzb2RlOwogICAgICAgIH0KICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5tb2RhbCA9IHNob3c7CiAgICAgIH0KICAgIH0sCiAgICBlZGl0R3JvdXAoKSB7CiAgICAgIGxldCBpbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleCgKICAgICAgICAoZ3JvdXApID0+IGdyb3VwLmlkID09PSB0aGlzLmdyb3VwRWRpdG9yLmlkCiAgICAgICk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2luZGV4XS5ncm91cF90eXBlID0KICAgICAgICB0aGlzLmdyb3VwRWRpdG9yLmdyb3VwX3R5cGU7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2luZGV4XS5ncm91cF9uYW1lID0KICAgICAgICB0aGlzLmdyb3VwRWRpdG9yLmdyb3VwX25hbWU7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2luZGV4XS5ncm91cF9pc19oaWRkZW4gPQogICAgICAgIHRoaXMuZ3JvdXBFZGl0b3IuZ3JvdXBfaXNfaGlkZGVuOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1tpbmRleF0uZ3JvdXBfcGFyZW50X2NvZGUgPQogICAgICAgIHRoaXMuZ3JvdXBFZGl0b3IuZ3JvdXBfcGFyZW50X2NvZGU7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2luZGV4XS5tb2RpZmllZCA9IHRydWU7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICAgIHRoaXMuZ3JvdXBFZGl0b3IubW9kYWwgPSBmYWxzZTsKICAgIH0sCiAgICBlZGl0U3RyZWFtKCkgewogICAgICBsZXQgaW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMuZmluZEluZGV4KAogICAgICAgIChzdHJlYW0pID0+IHN0cmVhbS5pZCA9PT0gdGhpcy5hY3RpdmVTdHJlYW1zWzBdCiAgICAgICk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc3RyZWFtX3R2Z19uYW1lID0KICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1fdHZnX25hbWU7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc3RyZWFtX3R2Z19pZCA9CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX3R2Z19pZDsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zdHJlYW1fdHZnX2xvZ28gPQogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV90dmdfbG9nbzsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zdHJlYW1fcGFyZW50X2NvZGUgPQogICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnN0cmVhbV9wYXJlbnRfY29kZTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zdHJlYW1faXNfaGlkZGVuID0KICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zdHJlYW1faXNfaGlkZGVuOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnN0cmVhbV9yYWRpbyA9CiAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc3RyZWFtX3JhZGlvOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnNvdXJjZV9zdHJlYW1fdXJsID0KICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zb3VyY2Vfc3RyZWFtX3VybDsKICAgICAgaWYgKAogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0ubW92aWVfbmFtZSAhPT0gdW5kZWZpbmVkICYmCiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5tb3ZpZV95ZWFyICE9PSB1bmRlZmluZWQgJiYKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnRtZGJfaWQgIT09IHVuZGVmaW5lZAogICAgICApIHsKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLm1vdmllX25hbWUgPQogICAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3IubW92aWVfbmFtZTsKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLm1vdmllX3llYXIgPQogICAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3IubW92aWVfeWVhcjsKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnRtZGJfaWQgPSB0aGlzLnN0cmVhbUVkaXRvci50bWRiX2lkOwogICAgICB9CiAgICAgIGlmICgKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnNlcmllX25hbWUgIT09IHVuZGVmaW5lZCAmJgogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtc1tpbmRleF0uc2VyaWVfc2Vhc29uICE9PSB1bmRlZmluZWQgJiYKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnNlcmllX2VwaXNvZGUgIT09IHVuZGVmaW5lZAogICAgICApIHsKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnNlcmllX25hbWUgPQogICAgICAgICAgdGhpcy5zdHJlYW1FZGl0b3Iuc2VyaWVfbmFtZTsKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbaW5kZXhdLnNlcmllX3NlYXNvbiA9CiAgICAgICAgICB0aGlzLnN0cmVhbUVkaXRvci5zZXJpZV9zZWFzb247CiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5zZXJpZV9lcGlzb2RlID0KICAgICAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLnNlcmllX2VwaXNvZGU7CiAgICAgIH0KICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zW2luZGV4XS5tb2RpZmllZCA9IHRydWU7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICAgIHRoaXMuc3RyZWFtRWRpdG9yLm1vZGFsID0gZmFsc2U7CiAgICB9LAogICAgc29ydEdyb3VwQWxwaGFVcCgpIHsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5zb3J0KChhLCBiKSA9PgogICAgICAgIGIuZ3JvdXBfbmFtZSA+IGEuZ3JvdXBfbmFtZSA/IDEgOiBhLmdyb3VwX25hbWUgPiBiLmdyb3VwX25hbWUgPyAtMSA6IDAKICAgICAgKTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMubWFwKChncm91cCkgPT4gKGdyb3VwLm1vZGlmaWVkID0gdHJ1ZSkpOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgfSwKICAgIHNvcnRHcm91cEFscGhhRG93bigpIHsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5zb3J0KChhLCBiKSA9PgogICAgICAgIGEuZ3JvdXBfbmFtZSA+IGIuZ3JvdXBfbmFtZSA/IDEgOiBiLmdyb3VwX25hbWUgPiBhLmdyb3VwX25hbWUgPyAtMSA6IDAKICAgICAgKTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMubWFwKChncm91cCkgPT4gKGdyb3VwLm1vZGlmaWVkID0gdHJ1ZSkpOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgfSwKICAgIHNvcnRHcm91cFR5cGVVcCgpIHsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5zb3J0KChhLCBiKSA9PgogICAgICAgIGIuZ3JvdXBfdHlwZSA+IGEuZ3JvdXBfdHlwZSA/IDEgOiBhLmdyb3VwX3R5cGUgPiBiLmdyb3VwX3R5cGUgPyAtMSA6IDAKICAgICAgKTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMubWFwKChncm91cCkgPT4gKGdyb3VwLm1vZGlmaWVkID0gdHJ1ZSkpOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgfSwKICAgIHNvcnRHcm91cFR5cGVEb3duKCkgewogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3VwcyA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLnNvcnQoKGEsIGIpID0+CiAgICAgICAgYS5ncm91cF90eXBlID4gYi5ncm91cF90eXBlID8gMSA6IGIuZ3JvdXBfdHlwZSA+IGEuZ3JvdXBfdHlwZSA/IC0xIDogMAogICAgICApOwogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5tYXAoKGdyb3VwKSA9PiAoZ3JvdXAubW9kaWZpZWQgPSB0cnVlKSk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICB9LAogICAgc29ydFN0cmVhbUFscGhhVXAoKSB7CiAgICAgIC8vRVJOU1QgSElFUgogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMuc29ydCgoYSwgYikgPT4gewogICAgICAgIHN3aXRjaCAodGhpcy5hY3RpdmVHcm91cFR5cGUpIHsKICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgcmV0dXJuIGIuc3RyZWFtX3R2Z19uYW1lID4gYS5zdHJlYW1fdHZnX25hbWUKICAgICAgICAgICAgICA/IDEKICAgICAgICAgICAgICA6IGEuc3RyZWFtX3R2Z19uYW1lID4gYi5zdHJlYW1fdHZnX25hbWUKICAgICAgICAgICAgICA/IC0xCiAgICAgICAgICAgICAgOiAwOwogICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICByZXR1cm4gYi5tb3ZpZV9uYW1lID4gYS5tb3ZpZV9uYW1lCiAgICAgICAgICAgICAgPyAxCiAgICAgICAgICAgICAgOiBhLm1vdmllX25hbWUgPiBiLm1vdmllX25hbWUKICAgICAgICAgICAgICA/IC0xCiAgICAgICAgICAgICAgOiAwOwogICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICByZXR1cm4gYi5zZXJpZV9uYW1lID4gYS5zZXJpZV9uYW1lCiAgICAgICAgICAgICAgPyAxCiAgICAgICAgICAgICAgOiBhLnNlcmllX25hbWUgPiBiLnNlcmllX25hbWUKICAgICAgICAgICAgICA/IC0xCiAgICAgICAgICAgICAgOiAwOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5tYXAoKHN0cmVhbSkgPT4gKHN0cmVhbS5tb2RpZmllZCA9IHRydWUpKTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgIH0sCiAgICBzb3J0U3RyZWFtQWxwaGFEb3duKCkgewogICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMuc29ydCgoYSwgYikgPT4gewogICAgICAgIHN3aXRjaCAodGhpcy5hY3RpdmVHcm91cFR5cGUpIHsKICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgcmV0dXJuIGEuc3RyZWFtX3R2Z19uYW1lID4gYi5zdHJlYW1fdHZnX25hbWUKICAgICAgICAgICAgICA/IDEKICAgICAgICAgICAgICA6IGIuc3RyZWFtX3R2Z19uYW1lID4gYS5zdHJlYW1fdHZnX25hbWUKICAgICAgICAgICAgICA/IC0xCiAgICAgICAgICAgICAgOiAwOwogICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICByZXR1cm4gYS5tb3ZpZV9uYW1lID4gYi5tb3ZpZV9uYW1lCiAgICAgICAgICAgICAgPyAxCiAgICAgICAgICAgICAgOiBiLm1vdmllX25hbWUgPiBhLm1vdmllX25hbWUKICAgICAgICAgICAgICA/IC0xCiAgICAgICAgICAgICAgOiAwOwogICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICByZXR1cm4gYS5zZXJpZV9uYW1lID4gYi5zZXJpZV9uYW1lCiAgICAgICAgICAgICAgPyAxCiAgICAgICAgICAgICAgOiBiLnNlcmllX25hbWUgPiBhLnNlcmllX25hbWUKICAgICAgICAgICAgICA/IC0xCiAgICAgICAgICAgICAgOiAwOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5tYXAoKHN0cmVhbSkgPT4gKHN0cmVhbS5tb2RpZmllZCA9IHRydWUpKTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gdHJ1ZTsKICAgIH0sCiAgICBzb3J0U3RyZWFtSGlkZGVuVXAoKSB7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcyA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5zb3J0KChhLCBiKSA9PgogICAgICAgIGIuc3RyZWFtX2lzX2hpZGRlbiA+IGEuc3RyZWFtX2lzX2hpZGRlbgogICAgICAgICAgPyAxCiAgICAgICAgICA6IGEuc3RyZWFtX2lzX2hpZGRlbiA+IGIuc3RyZWFtX2lzX2hpZGRlbgogICAgICAgICAgPyAtMQogICAgICAgICAgOiAwCiAgICAgICk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5tYXAoKGdyb3VwKSA9PiAoZ3JvdXAubW9kaWZpZWQgPSB0cnVlKSk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICB9LAogICAgc29ydFN0cmVhbUhpZGRlbkRvd24oKSB7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcyA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5zb3J0KChhLCBiKSA9PgogICAgICAgIGEuc3RyZWFtX2lzX2hpZGRlbiA+IGIuc3RyZWFtX2lzX2hpZGRlbgogICAgICAgICAgPyAxCiAgICAgICAgICA6IGIuc3RyZWFtX2lzX2hpZGRlbiA+IGEuc3RyZWFtX2lzX2hpZGRlbgogICAgICAgICAgPyAtMQogICAgICAgICAgOiAwCiAgICAgICk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5tYXAoKGdyb3VwKSA9PiAoZ3JvdXAubW9kaWZpZWQgPSB0cnVlKSk7CiAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICB9LAogICAgYWRkR3JvdXAoKSB7CiAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAucG9zdCgiZWRpdG9yL2FkZC1ncm91cCIsIHsgcGxheWxpc3RfaWQ6IHRoaXMucGxheWxpc3RFZGl0b3IuaWQgfSkKICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgaWYgKHJlcy5zdGF0dXMgPT09IHRydWUgJiYgcmVzLmRhdGEpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMucHVzaChyZXMuZGF0YSk7CiAgICAgICAgICAgICAgdGhpcy5hY3RpdmVHcm91cCA9CiAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwc1sKICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMubGVuZ3RoIC0gMQogICAgICAgICAgICAgICAgXS5pZDsKICAgICAgICAgICAgICB0aGlzLmFjdGl2ZUdyb3VwcyA9IFsKICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzWwogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5sZW5ndGggLSAxCiAgICAgICAgICAgICAgICBdLmlkLAogICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgICAgICB9KS50aGVuKCgpID0+IHsKICAgICAgICAgICAgICB0aGlzLmVkaXRHcm91cE1vZGFsKHRydWUpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgdGhpcy4kbm90aWZ5KAogICAgICAgICAgICAiZXJyb3IiLAogICAgICAgICAgICB0aGlzLiR0KCJwcm9maWxlLmZhaWxlZCIpLAogICAgICAgICAgICB0aGlzLiR0KCJlZGl0b3IuYWRkLWdyb3VwLWVycm9yIiksCiAgICAgICAgICAgICJsYS11c2VyLXNoaWVsZCIsCiAgICAgICAgICAgIHsgZHVyYXRpb246IDUwMDAsIHBlcm1hbmVudDogZmFsc2UgfQogICAgICAgICAgKTsKICAgICAgICB9KTsKICAgIH0sCiAgICBhZGRTdHJlYW0oKSB7CiAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAucG9zdCgiZWRpdG9yL2FkZC1zdHJlYW0iLCB7CiAgICAgICAgICBwbGF5bGlzdF9pZDogdGhpcy5wbGF5bGlzdEVkaXRvci5pZCwKICAgICAgICAgIGdyb3VwX2lkOiB0aGlzLmdldEdyb3VwV2l0aElkKHRoaXMuYWN0aXZlR3JvdXApLmlkLAogICAgICAgICAgc3RyZWFtX3R5cGU6IHRoaXMuZ2V0R3JvdXBXaXRoSWQodGhpcy5hY3RpdmVHcm91cCkuZ3JvdXBfdHlwZSwKICAgICAgICB9KQogICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICBpZiAocmVzLnN0YXR1cyA9PT0gdHJ1ZSAmJiByZXMuZGF0YSkgewogICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMudW5zaGlmdChyZXMuZGF0YSk7CiAgICAgICAgICAgICAgdGhpcy5hY3RpdmVTdHJlYW0gPQogICAgICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zWwogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoIC0gMQogICAgICAgICAgICAgICAgXS5pZDsKICAgICAgICAgICAgICB0aGlzLmFjdGl2ZVN0cmVhbXMgPSBbCiAgICAgICAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXNbCiAgICAgICAgICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGggLSAxCiAgICAgICAgICAgICAgICBdLmlkLAogICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgICAgICB9KS50aGVuKCgpID0+IHsKICAgICAgICAgICAgICB0aGlzLmVkaXRTdHJlYW1Nb2RhbCh0cnVlKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIHRoaXMuJG5vdGlmeSgKICAgICAgICAgICAgImVycm9yIiwKICAgICAgICAgICAgdGhpcy4kdCgicHJvZmlsZS5mYWlsZWQiKSwKICAgICAgICAgICAgdGhpcy4kdCgiZWRpdG9yLmFkZC1zdHJlYW0tZXJyb3IiKSwKICAgICAgICAgICAgImxhLXVzZXItc2hpZWxkIiwKICAgICAgICAgICAgeyBkdXJhdGlvbjogNTAwMCwgcGVybWFuZW50OiBmYWxzZSB9CiAgICAgICAgICApOwogICAgICAgIH0pOwogICAgfSwKICAgIGxvYWRTdHJlYW1zKCkgewogICAgICB0aGlzLmFjdGl2ZVN0cmVhbSA9IC0xOwogICAgICB0aGlzLmFjdGl2ZVN0cmVhbXMgPSBbXTsKICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zID0gW107CiAgICAgIGxldCBpbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleCgKICAgICAgICAoZ3JvdXApID0+IGdyb3VwLmlkID09PSB0aGlzLmFjdGl2ZUdyb3VwCiAgICAgICk7CiAgICAgIGxldCBncm91cCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzW2luZGV4XTsKICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZQogICAgICAgIC5nZXQoCiAgICAgICAgICBgZWRpdG9yL3N0cmVhbXMvJHt0aGlzLnBsYXlsaXN0RWRpdG9yLmlkfS8ke2dyb3VwLmlkfS8ke2dyb3VwLmdyb3VwX3R5cGV9YAogICAgICAgICkKICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICBkb2N1bWVudC5ib2R5LnNjcm9sbFRvcCA9IDA7CiAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wID0gMDsKICAgICAgICAgIGlmIChyZXMuc3RhdHVzID09PSB0cnVlKSB7CiAgICAgICAgICAgIGxldCBzdHJlYW1zID0gcmVzLmRhdGEubWFwKChzdHJlYW0pID0+IHsKICAgICAgICAgICAgICBjb25zdCBzdHIgPSBPYmplY3QuYXNzaWduKHt9LCBzdHJlYW0pOwogICAgICAgICAgICAgIHN0ci5zb3VyY2Vfc3RyZWFtX3R2Z19uYW1lID0gc3RyZWFtLnN0cmVhbV90dmdfbmFtZTsKICAgICAgICAgICAgICBzdHIuc291cmNlX3N0cmVhbV90dmdfaWQgPSBzdHJlYW0uc3RyZWFtX3R2Z19pZDsKICAgICAgICAgICAgICBzdHIuc291cmNlX3N0cmVhbV90dmdfbG9nbyA9IHN0cmVhbS5zdHJlYW1fdHZnX2xvZ287CiAgICAgICAgICAgICAgc3RyLnNvdXJjZV9zdHJlYW1fdHZnX2Nobm8gPSBzdHJlYW0uc3RyZWFtX3R2Z19jaG5vOwogICAgICAgICAgICAgIHN0ci5zb3VyY2Vfc3RyZWFtX3R2Z19zaGlmdCA9IHN0cmVhbS5zdHJlYW1fdHZnX3NoaWZ0OwogICAgICAgICAgICAgIHN0ci5zb3VyY2Vfc3RyZWFtX3BhcmVudF9jb2RlID0gc3RyZWFtLnN0cmVhbV9wYXJlbnRfY29kZTsKICAgICAgICAgICAgICBzdHIuc291cmNlX3N0cmVhbV9hdWRpb190cmFjayA9IHN0cmVhbS5zdHJlYW1fYXVkaW9fdHJhY2s7CiAgICAgICAgICAgICAgc3RyLnNvdXJjZV9zdHJlYW1fYXNwZWN0X3JhdGlvID0gc3RyZWFtLnN0cmVhbV9hc3BlY3RfcmF0aW87CiAgICAgICAgICAgICAgc3RyLnNvdXJjZV9zdHJlYW1fcmFkaW8gPSBzdHJlYW0uc3RyZWFtX3JhZGlvOwogICAgICAgICAgICAgIHN0ci5zb3VyY2Vfc3RyZWFtX29yZGVyID0gc3RyZWFtLnN0cmVhbV9vcmRlcjsKICAgICAgICAgICAgICBzdHIuc291cmNlX3N0cmVhbV9pc19oaWRkZW4gPSBzdHJlYW0uc3RyZWFtX2lzX2hpZGRlbjsKICAgICAgICAgICAgICBzdHIubW9kaWZpZWQgPSBmYWxzZTsKICAgICAgICAgICAgICBzdHIuc3RyZWFtX2lzX3JlbW92ZWQgPSAwOwogICAgICAgICAgICAgIGlmIChncm91cC5ncm91cF90eXBlID09IDIpIHsKICAgICAgICAgICAgICAgIGlmIChzdHIubW92aWVfbmFtZSA9PSAiIikgewogICAgICAgICAgICAgICAgICBzdHIubW92aWVfbmFtZSA9IHN0ci5zdHJlYW1fdHZnX25hbWU7CiAgICAgICAgICAgICAgICAgIHN0ci5zb3VyY2VfbW92aWVfbmFtZSA9IHN0ci5zdHJlYW1fdHZnX25hbWU7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBzdHIuc291cmNlX21vdmllX25hbWUgPSBzdHJlYW0ubW92aWVfbmFtZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHN0ci5zb3VyY2VfbW92aWVfeWVhciA9IHN0cmVhbS5tb3ZpZV95ZWFyOwogICAgICAgICAgICAgICAgc3RyLnNvdXJjZV90bWRiX2lkID0gc3RyZWFtLnRtZGJfaWQ7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChncm91cC5ncm91cF90eXBlID09IDMpIHsKICAgICAgICAgICAgICAgIGlmIChzdHIuc2VyaWVfbmFtZSA9PSAiIikgewogICAgICAgICAgICAgICAgICBzdHIuc2VyaWVfbmFtZSA9IHN0ci5zdHJlYW1fdHZnX25hbWU7CiAgICAgICAgICAgICAgICAgIHN0ci5zb3VyY2Vfc2VyaWVfbmFtZSA9IHN0ci5zdHJlYW1fdHZnX25hbWU7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBzdHIuc291cmNlX3NlcmllX25hbWUgPSBzdHJlYW0uc2VyaWVfbmFtZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHN0ci5zb3VyY2Vfc2VyaWVfc2Vhc29uID0gc3RyZWFtLnNlcmllX3NlYXNvbjsKICAgICAgICAgICAgICAgIHN0ci5zb3VyY2Vfc2VyaWVfZXBpc29kZSA9IHN0cmVhbS5zZXJpZV9lcGlzb2RlOwogICAgICAgICAgICAgICAgc3RyLnNvdXJjZV90bWRiX2lkID0gc3RyZWFtLnRtZGJfaWQ7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiBzdHI7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBzdHJlYW1zLnNvcnQoKGEsIGIpID0+CiAgICAgICAgICAgICAgYS5zb3VyY2Vfc3RyZWFtX29yZGVyID4gYi5zb3VyY2Vfc3RyZWFtX29yZGVyCiAgICAgICAgICAgICAgICA/IDEKICAgICAgICAgICAgICAgIDogYi5zb3VyY2Vfc3RyZWFtX29yZGVyID4gYS5zb3VyY2Vfc3RyZWFtX29yZGVyCiAgICAgICAgICAgICAgICA/IC0xCiAgICAgICAgICAgICAgICA6IDAKICAgICAgICAgICAgKTsKICAgICAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zID0gc3RyZWFtczsKICAgICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICB9KTsKICAgIH0sCiAgICBtb3ZlVG9TZWxlY3RlZEdyb3VwKCkgewogICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGxldCBzdHJlYW1zID0gdGhpcy5hY3RpdmVTdHJlYW1zLmpvaW4oKTsKICAgICAgbGV0IGluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KChncm91cCkgPT4gewogICAgICAgIHJldHVybiBncm91cC5pZCA9PSB0aGlzLmFjdGl2ZUdyb3VwOwogICAgICB9KTsKICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAucG9zdChgZWRpdG9yL21vdmUtdG8tZ3JvdXAvJHt0aGlzLmFjdGl2ZUdyb3VwVHlwZX1gLCB7CiAgICAgICAgICBwbGF5bGlzdF9pZDogdGhpcy5wbGF5bGlzdEVkaXRvci5pZCwKICAgICAgICAgIHN0cmVhbXM6IHN0cmVhbXMsCiAgICAgICAgICBncm91cF9pZDogdGhpcy5hY3RpdmVHcm91cHNbMF0sCiAgICAgICAgfSkKICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgaWYgKHJlcy5zdGF0dXMgJiYgcmVzLmRhdGEpIHsKICAgICAgICAgICAgdGhpcy5sb2FkUGxheWxpc3QodGhpcy5wbGF5bGlzdEVkaXRvci5pZCwgaW5kZXgpOwogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgfSk7CiAgICB9LAogICAgc2F2ZUNoYW5nZXNNb2RhbChzaG93LCBzYXZlID0gZmFsc2UpIHsKICAgICAgdGhpcy5zYXZlQ2hhbmdlcy5tb2RhbCA9IHNob3c7CiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgdGhpcy5kb1NhdmUoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmxvYWRTdHJlYW1zKCk7CiAgICAgIH0KICAgIH0sCiAgICByYWRpb0Jyb3dzZXJNb2RhbChzaG93LCBzYXZlID0gZmFsc2UpIHsKICAgICAgaWYgKHNob3cpIHsKICAgICAgICB0aGlzLnJhZGlvQnJvd3Nlci5zZWFyY2ggPSAiIjsKICAgICAgICB0aGlzLnJhZGlvQnJvd3Nlci5yZXN1bHRzID0gW107CiAgICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuYWN0aXZlID0gW107CiAgICAgIH0KICAgICAgaWYgKHNhdmUpIHsKICAgICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7CiAgICAgICAgbGV0IGdyb3VwSW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoKGdyb3VwKSA9PiB7CiAgICAgICAgICByZXR1cm4gZ3JvdXAuaWQgPT0gdGhpcy5hY3RpdmVHcm91cDsKICAgICAgICB9KTsKICAgICAgICBsZXQgb3JkZXIgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOwogICAgICAgIGNvbnN0IHN0cmVhbXMgPSB0aGlzLnJhZGlvQnJvd3Nlci5hY3RpdmUubWFwKChpbmRleCkgPT4gewogICAgICAgICAgbGV0IHJhZGlvID0gdGhpcy5yYWRpb0Jyb3dzZXIucmVzdWx0c1tpbmRleF07CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBzb3VyY2Vfc3RyZWFtX3VybDogcmFkaW8udXJsLAogICAgICAgICAgICBzdHJlYW1fdHZnX25hbWU6IHJhZGlvLm5hbWUsCiAgICAgICAgICAgIHN0cmVhbV90dmdfaWQ6ICIiLAogICAgICAgICAgICBzdHJlYW1fdHZnX2xvZ286IHJhZGlvLmZhdmljb24sCiAgICAgICAgICAgIHN0cmVhbV9yYWRpbzogdHJ1ZSwKICAgICAgICAgICAgc3RyZWFtX29yZGVyOiBvcmRlcisrLAogICAgICAgICAgfTsKICAgICAgICB9KTsKICAgICAgICBodHRwU2VydmljZQogICAgICAgICAgLnBvc3QoYGVkaXRvci9hZGQtc3RyZWFtcy8ke3RoaXMuYWN0aXZlR3JvdXBUeXBlfWAsIHsKICAgICAgICAgICAgcGxheWxpc3RfaWQ6IHRoaXMucGxheWxpc3RFZGl0b3IuaWQsCiAgICAgICAgICAgIGdyb3VwX2lkOiB0aGlzLmdldEdyb3VwV2l0aElkKHRoaXMuYWN0aXZlR3JvdXApLmlkLAogICAgICAgICAgICBzdHJlYW1zOiBzdHJlYW1zLAogICAgICAgICAgfSkKICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKHJlcy5zdGF0dXMpIHsKICAgICAgICAgICAgICB0aGlzLmxvYWRQbGF5bGlzdCh0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLCBncm91cEluZGV4KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSkKICAgICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB9KTsKICAgICAgfQogICAgICB0aGlzLnJhZGlvQnJvd3Nlci5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgZmluZFJhZGlvYnJvd3NlcihzZWFyY2gpIHsKICAgICAgaWYgKHNlYXJjaC5sZW5ndGggPT09IDApIHsKICAgICAgICB0aGlzLnJhZGlvQnJvd3Nlci5yZXN1bHRzID0gW107CiAgICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuYWN0aXZlID0gW107CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgICBodHRwU2VydmljZQogICAgICAgICAgLnBvc3QoImVkaXRvci9maW5kLXJhZGlvYnJvd3NlciIsIHsKICAgICAgICAgICAgc2VhcmNoOiBzZWFyY2gsCiAgICAgICAgICB9KQogICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICB0aGlzLnJhZGlvQnJvd3Nlci5hY3RpdmUgPSBbXTsKICAgICAgICAgICAgaWYgKHJlcy5zdGF0dXMpIHsKICAgICAgICAgICAgICB0aGlzLnJhZGlvQnJvd3Nlci5yZXN1bHRzID0gcmVzLmRhdGE7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGhpcy5yYWRpb0Jyb3dzZXIucmVzdWx0cyA9IFtdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgfSkKICAgICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLmFjdGl2ZSA9IFtdOwogICAgICAgICAgICB0aGlzLnJhZGlvQnJvd3Nlci5yZXN1bHRzID0gW107CiAgICAgICAgICAgIHRoaXMucmFkaW9Ccm93c2VyLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBzb3VuZGNsb3VkTW9kYWwoc2hvdywgc2F2ZSA9IGZhbHNlKSB7CiAgICAgIGlmIChzaG93KSB7CiAgICAgICAgdGhpcy5zb3VuZGNsb3VkLnVybCA9ICIiOwogICAgICAgIHRoaXMuc291bmRjbG91ZC50cmFjayA9IG51bGw7CiAgICAgIH0KICAgICAgaWYgKHNhdmUpIHsKICAgICAgICBpZiAodGhpcy5zb3VuZGNsb3VkLnRyYWNrKSB7CiAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7CiAgICAgICAgICBsZXQgZ3JvdXBJbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleCgoZ3JvdXApID0+IHsKICAgICAgICAgICAgcmV0dXJuIGdyb3VwLmlkID09IHRoaXMuYWN0aXZlR3JvdXA7CiAgICAgICAgICB9KTsKICAgICAgICAgIGxldCBvcmRlciA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7CiAgICAgICAgICBjb25zdCBzdHJlYW1zID0gWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgc291cmNlX3N0cmVhbV91cmw6IHRoaXMuc291bmRjbG91ZC51cmwsCiAgICAgICAgICAgICAgc3RyZWFtX3R2Z19uYW1lOiB0aGlzLnNvdW5kY2xvdWQudHJhY2sudGl0bGUsCiAgICAgICAgICAgICAgc3RyZWFtX3R2Z19pZDogIiIsCiAgICAgICAgICAgICAgc3RyZWFtX3R2Z19sb2dvOiB0aGlzLnNvdW5kY2xvdWQudHJhY2suYXJ0d29ya191cmwucmVwbGFjZSgKICAgICAgICAgICAgICAgICJsYXJnZS5qcGciLAogICAgICAgICAgICAgICAgInQ1MDB4NTAwLmpwZyIKICAgICAgICAgICAgICApLAogICAgICAgICAgICAgIHN0cmVhbV9yYWRpbzogdHJ1ZSwKICAgICAgICAgICAgICBzdHJlYW1fb3JkZXI6IG9yZGVyKyssCiAgICAgICAgICAgIH0sCiAgICAgICAgICBdOwogICAgICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAgICAgLnBvc3QoYGVkaXRvci9hZGQtc3RyZWFtcy8ke3RoaXMuYWN0aXZlR3JvdXBUeXBlfWAsIHsKICAgICAgICAgICAgICBwbGF5bGlzdF9pZDogdGhpcy5wbGF5bGlzdEVkaXRvci5pZCwKICAgICAgICAgICAgICBncm91cF9pZDogdGhpcy5nZXRHcm91cFdpdGhJZCh0aGlzLmFjdGl2ZUdyb3VwKS5pZCwKICAgICAgICAgICAgICBzdHJlYW1zOiBzdHJlYW1zLAogICAgICAgICAgICB9KQogICAgICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICBpZiAocmVzLnN0YXR1cykgewogICAgICAgICAgICAgICAgdGhpcy5sb2FkUGxheWxpc3QodGhpcy5wbGF5bGlzdEVkaXRvci5pZCwgZ3JvdXBJbmRleCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLnNvdW5kY2xvdWQubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGdldFNvdW5kY2xvdWRUcmFjayh1cmwsIGNsaWVudF9pZCkgewogICAgICBpZiAodXJsLmxlbmd0aCA9PT0gMCB8fCAhL3NvdW5kY2xvdWRcLmNvbS8udGVzdCh1cmwpKSB7CiAgICAgICAgdGhpcy5zb3VuZGNsb3VkLnVybCA9ICIiOwogICAgICAgIHRoaXMuc291bmRjbG91ZC50cmFjayA9IG51bGw7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zb3VuZGNsb3VkLmlzTG9hZGluZyA9IHRydWU7CiAgICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAgIC5wb3N0KCJlZGl0b3Ivc291bmRjbG91ZC10cmFjayIsIHsKICAgICAgICAgICAgdXJsOiB1cmwsCiAgICAgICAgICAgIGNsaWVudF9pZDogY2xpZW50X2lkLAogICAgICAgICAgfSkKICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgaWYgKHJlcy5zdGF0dXMgJiYgT2JqZWN0LmtleXMocmVzLmRhdGEpLmxlbmd0aCkgewogICAgICAgICAgICAgIHRoaXMuc291bmRjbG91ZC50cmFjayA9IHJlcy5kYXRhOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRoaXMuc291bmRjbG91ZC50cmFjayA9IG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5zb3VuZGNsb3VkLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgfSkKICAgICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICAgIHRoaXMuc291bmRjbG91ZC50cmFjayA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuc291bmRjbG91ZC5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgeW91dHViZU1vZGFsKHNob3csIHNhdmUgPSBmYWxzZSkgewogICAgICBpZiAoc2hvdykgewogICAgICAgIHRoaXMueW91dHViZS51cmwgPSAiIjsKICAgICAgICB0aGlzLnlvdXR1YmUudmlkZW8gPSBudWxsOwogICAgICAgIHRoaXMueW91dHViZS5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfQogICAgICBpZiAoc2F2ZSkgewogICAgICAgIGlmICh0aGlzLnlvdXR1YmUudmlkZW8pIHsKICAgICAgICAgIHRoaXMueW91dHViZS5pc0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgbGV0IGdyb3VwSW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoKGdyb3VwKSA9PiB7CiAgICAgICAgICAgIHJldHVybiBncm91cC5pZCA9PSB0aGlzLmFjdGl2ZUdyb3VwOwogICAgICAgICAgfSk7CiAgICAgICAgICBsZXQgb3JkZXIgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOwogICAgICAgICAgY29uc3Qgc3RyZWFtcyA9IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgIHNvdXJjZV9zdHJlYW1fdXJsOiB0aGlzLnlvdXR1YmUudXJsLAogICAgICAgICAgICAgIHN0cmVhbV90dmdfbmFtZTogdGhpcy55b3V0dWJlLnZpZGVvLnZpZGVvRGV0YWlscy50aXRsZSwKICAgICAgICAgICAgICBzdHJlYW1fdHZnX2lkOiAiIiwKICAgICAgICAgICAgICBzdHJlYW1fdHZnX2xvZ286IGBodHRwOi8vaS55dGltZy5jb20vdmkvJHt0aGlzLnlvdXR1YmUudmlkZW9JZH0vbWF4cmVzZGVmYXVsdC5qcGdgLAogICAgICAgICAgICAgIHN0cmVhbV9vcmRlcjogb3JkZXIrKywKICAgICAgICAgICAgfSwKICAgICAgICAgIF07CiAgICAgICAgICBodHRwU2VydmljZQogICAgICAgICAgICAucG9zdChgZWRpdG9yL2FkZC1zdHJlYW1zLyR7dGhpcy5hY3RpdmVHcm91cFR5cGV9YCwgewogICAgICAgICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgICAgIGdyb3VwX2lkOiB0aGlzLmdldEdyb3VwV2l0aElkKHRoaXMuYWN0aXZlR3JvdXApLmlkLAogICAgICAgICAgICAgIHN0cmVhbXM6IHN0cmVhbXMsCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICB0aGlzLnlvdXR1YmUuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgaWYgKHJlcy5zdGF0dXMpIHsKICAgICAgICAgICAgICAgIHRoaXMubG9hZFBsYXlsaXN0KHRoaXMucGxheWxpc3RFZGl0b3IuaWQsIGdyb3VwSW5kZXgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgICAgICB0aGlzLnlvdXR1YmUuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLnlvdXR1YmUubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGdldFlvdXR1YmVQYWdlKHZpZGVvSWQpIHsKICAgICAgdGhpcy55b3V0dWJlLmlzTG9hZGluZyA9IHRydWU7CiAgICAgIGh0dHBTZXJ2aWNlCiAgICAgICAgLnBvc3QoImVkaXRvci95b3V0dWJlLXZpZGVvIiwgeyB2aWRlb19pZDogdmlkZW9JZCB9KQogICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgIGlmIChyZXMuc3RhdHVzICYmIE9iamVjdC5rZXlzKHJlcy5kYXRhKS5sZW5ndGgpIHsKICAgICAgICAgICAgdGhpcy55b3V0dWJlLnZpZGVvID0gcmVzLmRhdGE7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnlvdXR1YmUudmlkZW8gPSBudWxsOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy55b3V0dWJlLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgIHRoaXMueW91dHViZS52aWRlbyA9IG51bGw7CiAgICAgICAgICB0aGlzLnlvdXR1YmUuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgfSk7CiAgICB9LAogICAgdmltZW9Nb2RhbChzaG93LCBzYXZlID0gZmFsc2UpIHsKICAgICAgaWYgKHNob3cpIHsKICAgICAgICB0aGlzLnZpbWVvLnVybCA9ICIiOwogICAgICAgIHRoaXMudmltZW8udmlkZW8gPSBudWxsOwogICAgICAgIHRoaXMudmltZW8uaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0KICAgICAgaWYgKHNhdmUpIHsKICAgICAgICBpZiAodGhpcy52aW1lby52aWRlbykgewogICAgICAgICAgdGhpcy52aW1lby5pc0xvYWRpbmcgPSB0cnVlOwogICAgICAgICAgbGV0IGdyb3VwSW5kZXggPSB0aGlzLnBsYXlsaXN0RWRpdG9yLmdyb3Vwcy5maW5kSW5kZXgoKGdyb3VwKSA9PiB7CiAgICAgICAgICAgIHJldHVybiBncm91cC5pZCA9PSB0aGlzLmFjdGl2ZUdyb3VwOwogICAgICAgICAgfSk7CiAgICAgICAgICBsZXQgb3JkZXIgPSB0aGlzLnBsYXlsaXN0RWRpdG9yLnN0cmVhbXMubGVuZ3RoOwogICAgICAgICAgY29uc3Qgc3RyZWFtcyA9IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgIHNvdXJjZV9zdHJlYW1fdXJsOiB0aGlzLnZpbWVvLnVybCwKICAgICAgICAgICAgICBzdHJlYW1fdHZnX25hbWU6IHRoaXMudmltZW8udmlkZW8udmlkZW8udGl0bGUsCiAgICAgICAgICAgICAgc3RyZWFtX3R2Z19pZDogIiIsCiAgICAgICAgICAgICAgc3RyZWFtX3R2Z19sb2dvOiB0aGlzLnZpbWVvLnZpZGVvLnZpZGVvLnRodW1icy5iYXNlLAogICAgICAgICAgICAgIHN0cmVhbV9vcmRlcjogb3JkZXIrKywKICAgICAgICAgICAgfSwKICAgICAgICAgIF07CiAgICAgICAgICBodHRwU2VydmljZQogICAgICAgICAgICAucG9zdChgZWRpdG9yL2FkZC1zdHJlYW1zLyR7dGhpcy5hY3RpdmVHcm91cFR5cGV9YCwgewogICAgICAgICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgICAgIGdyb3VwX2lkOiB0aGlzLmdldEdyb3VwV2l0aElkKHRoaXMuYWN0aXZlR3JvdXApLmlkLAogICAgICAgICAgICAgIHN0cmVhbXM6IHN0cmVhbXMsCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICB0aGlzLnZpbWVvLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgIGlmIChyZXMuc3RhdHVzKSB7CiAgICAgICAgICAgICAgICB0aGlzLmxvYWRQbGF5bGlzdCh0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLCBncm91cEluZGV4KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICAgICAgdGhpcy52aW1lby5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMudmltZW8ubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGdldFZpbWVvQ29uZmlnKHZpZGVvSWQpIHsKICAgICAgdGhpcy52aW1lby5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZQogICAgICAgIC5wb3N0KCJlZGl0b3IvdmltZW8tdmlkZW8iLCB7IHZpZGVvX2lkOiB2aWRlb0lkIH0pCiAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgdGhpcy52aW1lby52aWRlbyA9IHJlcy5kYXRhOwogICAgICAgICAgdGhpcy52aW1lby5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICB9KTsKICAgIH0sCiAgICBkYWlseW1vdGlvbk1vZGFsKHNob3csIHNhdmUgPSBmYWxzZSkgewogICAgICBpZiAoc2hvdykgewogICAgICAgIHRoaXMuZGFpbHltb3Rpb24udXJsID0gIiI7CiAgICAgICAgdGhpcy5kYWlseW1vdGlvbi52aWRlbyA9IG51bGw7CiAgICAgICAgdGhpcy5kYWlseW1vdGlvbi5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfQogICAgICBpZiAoc2F2ZSkgewogICAgICAgIGlmICh0aGlzLmRhaWx5bW90aW9uLnZpZGVvKSB7CiAgICAgICAgICB0aGlzLmRhaWx5bW90aW9uLmlzTG9hZGluZyA9IHRydWU7CiAgICAgICAgICBsZXQgZ3JvdXBJbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleCgoZ3JvdXApID0+IHsKICAgICAgICAgICAgcmV0dXJuIGdyb3VwLmlkID09IHRoaXMuYWN0aXZlR3JvdXA7CiAgICAgICAgICB9KTsKICAgICAgICAgIGxldCBvcmRlciA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7CiAgICAgICAgICBjb25zdCBzdHJlYW1zID0gWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgc291cmNlX3N0cmVhbV91cmw6IHRoaXMuZGFpbHltb3Rpb24udXJsLAogICAgICAgICAgICAgIHN0cmVhbV90dmdfbmFtZTogdGhpcy5kYWlseW1vdGlvbi52aWRlby50aXRsZSwKICAgICAgICAgICAgICBzdHJlYW1fdHZnX2lkOiAiIiwKICAgICAgICAgICAgICBzdHJlYW1fdHZnX2xvZ286IHRoaXMuZGFpbHltb3Rpb24udmlkZW8udGh1bWJuYWlsXzEwODBfdXJsLAogICAgICAgICAgICAgIHN0cmVhbV9vcmRlcjogb3JkZXIrKywKICAgICAgICAgICAgfSwKICAgICAgICAgIF07CiAgICAgICAgICBodHRwU2VydmljZQogICAgICAgICAgICAucG9zdChgZWRpdG9yL2FkZC1zdHJlYW1zLyR7dGhpcy5hY3RpdmVHcm91cFR5cGV9YCwgewogICAgICAgICAgICAgIHBsYXlsaXN0X2lkOiB0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLAogICAgICAgICAgICAgIGdyb3VwX2lkOiB0aGlzLmdldEdyb3VwV2l0aElkKHRoaXMuYWN0aXZlR3JvdXApLmlkLAogICAgICAgICAgICAgIHN0cmVhbXM6IHN0cmVhbXMsCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICB0aGlzLmRhaWx5bW90aW9uLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgIGlmIChyZXMuc3RhdHVzKSB7CiAgICAgICAgICAgICAgICB0aGlzLmxvYWRQbGF5bGlzdCh0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLCBncm91cEluZGV4KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICAgICAgdGhpcy5kYWlseW1vdGlvbi5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMuZGFpbHltb3Rpb24ubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGdldERhaWx5bW90aW9uQ29uZmlnKHZpZGVvSWQpIHsKICAgICAgdGhpcy5kYWlseW1vdGlvbi5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZQogICAgICAgIC5wb3N0KCJlZGl0b3IvZGFpbHltb3Rpb24tdmlkZW8iLCB7IHZpZGVvX2lkOiB2aWRlb0lkIH0pCiAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgdGhpcy5kYWlseW1vdGlvbi52aWRlbyA9IHJlcy5kYXRhOwogICAgICAgICAgdGhpcy5kYWlseW1vdGlvbi5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICB9KTsKICAgIH0sCiAgICB0ZWRUYWxrc01vZGFsKHNob3csIHNhdmUgPSBmYWxzZSkgewogICAgICBpZiAoc2hvdykgewogICAgICAgIHRoaXMudGVkVGFsa3MudXJsID0gIiI7CiAgICAgICAgdGhpcy50ZWRUYWxrcy52aWRlbyA9IG51bGw7CiAgICAgICAgdGhpcy50ZWRUYWxrcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgfQogICAgICBpZiAoc2F2ZSkgewogICAgICAgIGlmICh0aGlzLnRlZFRhbGtzLnZpZGVvKSB7CiAgICAgICAgICB0aGlzLnRlZFRhbGtzLmlzTG9hZGluZyA9IHRydWU7CiAgICAgICAgICBsZXQgZ3JvdXBJbmRleCA9IHRoaXMucGxheWxpc3RFZGl0b3IuZ3JvdXBzLmZpbmRJbmRleCgoZ3JvdXApID0+IHsKICAgICAgICAgICAgcmV0dXJuIGdyb3VwLmlkID09IHRoaXMuYWN0aXZlR3JvdXA7CiAgICAgICAgICB9KTsKICAgICAgICAgIGxldCBvcmRlciA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5sZW5ndGg7CiAgICAgICAgICBjb25zdCBzdHJlYW1zID0gWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgc291cmNlX3N0cmVhbV91cmw6IHRoaXMudGVkVGFsa3MudXJsLAogICAgICAgICAgICAgIHN0cmVhbV90dmdfbmFtZTogdGhpcy50ZWRUYWxrcy52aWRlby50aXRsZSwKICAgICAgICAgICAgICBzdHJlYW1fdHZnX2lkOiAiIiwKICAgICAgICAgICAgICBzdHJlYW1fdHZnX2xvZ286IHRoaXMudGVkVGFsa3MudmlkZW8uaGVybywKICAgICAgICAgICAgICBzdHJlYW1fb3JkZXI6IG9yZGVyKyssCiAgICAgICAgICAgIH0sCiAgICAgICAgICBdOwogICAgICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAgICAgLnBvc3QoYGVkaXRvci9hZGQtc3RyZWFtcy8ke3RoaXMuYWN0aXZlR3JvdXBUeXBlfWAsIHsKICAgICAgICAgICAgICBwbGF5bGlzdF9pZDogdGhpcy5wbGF5bGlzdEVkaXRvci5pZCwKICAgICAgICAgICAgICBncm91cF9pZDogdGhpcy5nZXRHcm91cFdpdGhJZCh0aGlzLmFjdGl2ZUdyb3VwKS5pZCwKICAgICAgICAgICAgICBzdHJlYW1zOiBzdHJlYW1zLAogICAgICAgICAgICB9KQogICAgICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgdGhpcy50ZWRUYWxrcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICBpZiAocmVzLnN0YXR1cykgewogICAgICAgICAgICAgICAgdGhpcy5sb2FkUGxheWxpc3QodGhpcy5wbGF5bGlzdEVkaXRvci5pZCwgZ3JvdXBJbmRleCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgICAgIHRoaXMudGVkVGFsa3MuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLnRlZFRhbGtzLm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBnZXRUZWRUYWxrc0NvbmZpZyh1cmwpIHsKICAgICAgdGhpcy50ZWRUYWxrcy5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZS5wb3N0KCJlZGl0b3IvdGVkLXRhbGtzLXZpZGVvIiwgeyB1cmw6IHVybCB9KS50aGVuKChyZXMpID0+IHsKICAgICAgICB0aGlzLnRlZFRhbGtzLnZpZGVvID0gcmVzLmRhdGEudGFsa3MubGVuZ3RoID8gcmVzLmRhdGEudGFsa3NbMF0gOiBudWxsOwogICAgICAgIHRoaXMudGVkVGFsa3MuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0pOwogICAgfSwKICAgIHhoYW1zdGVyTW9kYWwoc2hvdywgc2F2ZSA9IGZhbHNlKSB7CiAgICAgIGlmIChzaG93KSB7CiAgICAgICAgdGhpcy54aGFtc3Rlci51cmwgPSAiIjsKICAgICAgICB0aGlzLnhoYW1zdGVyLnZpZGVvID0gbnVsbDsKICAgICAgICB0aGlzLnhoYW1zdGVyLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9CiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgaWYgKHRoaXMueGhhbXN0ZXIudmlkZW8pIHsKICAgICAgICAgIHRoaXMueGhhbXN0ZXIuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgIGxldCBncm91cEluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KChncm91cCkgPT4gewogICAgICAgICAgICByZXR1cm4gZ3JvdXAuaWQgPT0gdGhpcy5hY3RpdmVHcm91cDsKICAgICAgICAgIH0pOwogICAgICAgICAgbGV0IG9yZGVyID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmxlbmd0aDsKICAgICAgICAgIGNvbnN0IHN0cmVhbXMgPSBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBzb3VyY2Vfc3RyZWFtX3VybDogdGhpcy54aGFtc3Rlci51cmwsCiAgICAgICAgICAgICAgc3RyZWFtX3R2Z19uYW1lOiB0aGlzLnhoYW1zdGVyLnZpZGVvLnZpZGVvRW50aXR5LnRpdGxlLAogICAgICAgICAgICAgIHN0cmVhbV90dmdfaWQ6ICIiLAogICAgICAgICAgICAgIHN0cmVhbV90dmdfbG9nbzogdGhpcy54aGFtc3Rlci52aWRlby52aWRlb0VudGl0eS50aHVtYkJpZywKICAgICAgICAgICAgICBzdHJlYW1fb3JkZXI6IG9yZGVyKyssCiAgICAgICAgICAgIH0sCiAgICAgICAgICBdOwogICAgICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAgICAgLnBvc3QoYGVkaXRvci9hZGQtc3RyZWFtcy8ke3RoaXMuYWN0aXZlR3JvdXBUeXBlfWAsIHsKICAgICAgICAgICAgICBwbGF5bGlzdF9pZDogdGhpcy5wbGF5bGlzdEVkaXRvci5pZCwKICAgICAgICAgICAgICBncm91cF9pZDogdGhpcy5nZXRHcm91cFdpdGhJZCh0aGlzLmFjdGl2ZUdyb3VwKS5pZCwKICAgICAgICAgICAgICBzdHJlYW1zOiBzdHJlYW1zLAogICAgICAgICAgICB9KQogICAgICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgdGhpcy54aGFtc3Rlci5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICBpZiAocmVzLnN0YXR1cykgewogICAgICAgICAgICAgICAgdGhpcy5sb2FkUGxheWxpc3QodGhpcy5wbGF5bGlzdEVkaXRvci5pZCwgZ3JvdXBJbmRleCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgICAgIHRoaXMueGhhbXN0ZXIuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLnhoYW1zdGVyLm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBnZXRYaGFtc3RlckNvbmZpZyh1cmwpIHsKICAgICAgdGhpcy54aGFtc3Rlci5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZS5wb3N0KCJlZGl0b3IveGhhbXN0ZXItdmlkZW8iLCB7IHVybDogdXJsIH0pLnRoZW4oKHJlcykgPT4gewogICAgICAgIHRoaXMueGhhbXN0ZXIudmlkZW8gPSByZXMuZGF0YTsKICAgICAgICB0aGlzLnhoYW1zdGVyLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICB9KTsKICAgIH0sCiAgICBncm91cERvdWJsZUNsaWNrKCkgewogICAgICBpZiAodGhpcy5hY3RpdmVHcm91cHMubGVuZ3RoID09PSAxKSB7CiAgICAgICAgdGhpcy5lZGl0R3JvdXBNb2RhbCh0cnVlKTsKICAgICAgfQogICAgfSwKICAgIHN0cmVhbURvdWJsZUNsaWNrKCkgewogICAgICBpZiAodGhpcy5hY3RpdmVTdHJlYW1zLmxlbmd0aCA9PT0gMSkgewogICAgICAgIHRoaXMuZWRpdFN0cmVhbU1vZGFsKHRydWUpOwogICAgICB9CiAgICB9LAogICAgbG9hZExvZ29Db3VudHJpZXMoKSB7CiAgICAgIHRoaXMuZmluZExvZ28uaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAuZ2V0KCJlZGl0b3IvbG9nby1jb3VudHJpZXMiKQogICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgIHRoaXMuZmluZExvZ28uaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB0aGlzLmZpbmRMb2dvLmNvdW50cmllcyA9IHJlcy5kYXRhCiAgICAgICAgICAgIC5tYXAoKGNvdW50cnkpID0+IHsKICAgICAgICAgICAgICBsZXQgY24gPSB0aGlzLmNvdW50cmllcy5maW5kKAogICAgICAgICAgICAgICAgKGNudCkgPT4gY250LmNvZGUudG9Mb3dlckNhc2UoKSA9PSBjb3VudHJ5LnRvTG93ZXJDYXNlKCkKICAgICAgICAgICAgICApOwogICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICB0ZXh0OiBjbiA/IGNuLm5hbWUgOiBjb3VudHJ5LAogICAgICAgICAgICAgICAgdmFsdWU6IGNvdW50cnksCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLnNvcnQoKGEsIGIpID0+IHsKICAgICAgICAgICAgICByZXR1cm4gYS50ZXh0LnRvVXBwZXJDYXNlKCkgPCBiLnRleHQudG9VcHBlckNhc2UoKQogICAgICAgICAgICAgICAgPyAtMQogICAgICAgICAgICAgICAgOiBhLnRleHQudG9VcHBlckNhc2UoKSA+IGIudGV4dC50b1VwcGVyQ2FzZSgpCiAgICAgICAgICAgICAgICA/IDEKICAgICAgICAgICAgICAgIDogMDsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB0aGlzLmFzc2lnbkxvZ28uY291bnRyaWVzID0gWy4uLnRoaXMuZmluZExvZ28uY291bnRyaWVzXTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICB0aGlzLmZpbmRMb2dvLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0pOwogICAgfSwKICAgIGxvYWRUVkdJRENvdW50cmllcygpIHsKICAgICAgdGhpcy5hc3NpZ25UVkdJRC5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZQogICAgICAgIC5nZXQoImVkaXRvci90di1ndWlkZS1jb3VudHJpZXMiKQogICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgIHRoaXMuYXNzaWduVFZHSUQuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB0aGlzLmFzc2lnblRWR0lELmNvdW50cmllcyA9IHJlcy5kYXRhCiAgICAgICAgICAgIC5tYXAoKGNvdW50cnkpID0+IHsKICAgICAgICAgICAgICBsZXQgY24gPSB0aGlzLmNvdW50cmllcy5maW5kKAogICAgICAgICAgICAgICAgKGNudCkgPT4gY250LmNvZGUudG9Mb3dlckNhc2UoKSA9PSBjb3VudHJ5LnRvTG93ZXJDYXNlKCkKICAgICAgICAgICAgICApOwogICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICB0ZXh0OiBjbiA/IGNuLm5hbWUgOiBjb3VudHJ5LAogICAgICAgICAgICAgICAgdmFsdWU6IGNvdW50cnksCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLnNvcnQoKGEsIGIpID0+IHsKICAgICAgICAgICAgICByZXR1cm4gYS50ZXh0LnRvVXBwZXJDYXNlKCkgPCBiLnRleHQudG9VcHBlckNhc2UoKQogICAgICAgICAgICAgICAgPyAtMQogICAgICAgICAgICAgICAgOiBhLnRleHQudG9VcHBlckNhc2UoKSA+IGIudGV4dC50b1VwcGVyQ2FzZSgpCiAgICAgICAgICAgICAgICA/IDEKICAgICAgICAgICAgICAgIDogMDsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB0aGlzLmFzc2lnblRWR0lELmNvdW50cmllcy51bnNoaWZ0KHsKICAgICAgICAgICAgdGV4dDogdGhpcy4kdCgiZ2VuZXJhbC5hbGwiKSwKICAgICAgICAgICAgdmFsdWU6ICJhbGwiLAogICAgICAgICAgfSk7CiAgICAgICAgICB0aGlzLmZpbmRUVkdJRC5jb3VudHJpZXMgPSBbLi4udGhpcy5hc3NpZ25UVkdJRC5jb3VudHJpZXNdOwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgIHRoaXMuYXNzaWduVFZHSUQuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgfSk7CiAgICB9LAogICAgbG9hZExvZ29zRmluZChjb3VudHJ5KSB7CiAgICAgIHRoaXMuZmluZExvZ28uaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAuZ2V0KGBlZGl0b3IvbG9nb3MvJHtjb3VudHJ5fWApCiAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgdGhpcy5maW5kTG9nby5sb2dvID0gIiI7CiAgICAgICAgICB0aGlzLmZpbmRMb2dvLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgdGhpcy5maW5kTG9nby5sb2dvcyA9IHJlcy5kYXRhLm1hcCgobG9nbykgPT4gewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIHRleHQ6IGxvZ28ubGFiZWwsCiAgICAgICAgICAgICAgdmFsdWU6IGxvZ28uZmlsZW5hbWUsCiAgICAgICAgICAgIH07CiAgICAgICAgICB9KTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICB0aGlzLmZpbmRMb2dvLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0pOwogICAgfSwKICAgIGZpbmRMb2dvTW9kYWwoc2hvdywgc2F2ZSA9IGZhbHNlKSB7CiAgICAgIGxldCBzZWxlY3RlZCA9IHRoaXMuZ2V0U3RyZWFtV2l0aElkKHRoaXMuYWN0aXZlU3RyZWFtc1swXSk7CiAgICAgIGlmIChzaG93KSB7CiAgICAgICAgdGhpcy5maW5kTG9nby5sb2dvID0gIiI7CiAgICAgICAgdGhpcy5maW5kTG9nby50aXRsZSA9IHNlbGVjdGVkLnN0cmVhbV90dmdfbmFtZTsKICAgICAgfQogICAgICB0aGlzLmZpbmRMb2dvLnNlYXJjaCA9ICIiOwogICAgICBpZiAoc2F2ZSkgewogICAgICAgIGlmIChzZWxlY3RlZCkgewogICAgICAgICAgc2VsZWN0ZWQuc3RyZWFtX3R2Z19sb2dvID0gYGh0dHA6Ly9zdGF0aWMuaXB0di10b29scy5jb20vJHt0aGlzLmZpbmRMb2dvLmNvdW50cnl9LyR7dGhpcy5maW5kTG9nby5sb2dvfWA7CiAgICAgICAgICBzZWxlY3RlZC5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLmZpbmRMb2dvLm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBsb2FkTG9nb3NBc3NpZ24oY291bnRyeSkgewogICAgICB0aGlzLmFzc2lnbkxvZ28uaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAuZ2V0KGBlZGl0b3IvbG9nb3MvJHtjb3VudHJ5fWApCiAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgdGhpcy5hc3NpZ25Mb2dvLmxvZ28gPSAiIjsKICAgICAgICAgIHRoaXMuYXNzaWduTG9nby5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIHRoaXMuYXNzaWduTG9nby5sb2dvcyA9IHJlcy5kYXRhLm1hcCgobG9nbykgPT4gbG9nby5maWxlbmFtZSk7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgdGhpcy5hc3NpZ25Mb2dvLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0pOwogICAgfSwKICAgIGFzc2lnbkxvZ29Nb2RhbChzaG93LCBzYXZlID0gZmFsc2UpIHsKICAgICAgaWYgKHNob3cpIHsKICAgICAgICB0aGlzLmFzc2lnbkxvZ28ubG9nbyA9ICIiOwogICAgICB9CiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgdmFyIGNoYW5nZWQgPSBmYWxzZTsKICAgICAgICB2YXIgc3RyaW5nU2ltaWxhcml0eSA9IHJlcXVpcmUoInN0cmluZy1zaW1pbGFyaXR5Iik7CiAgICAgICAgbGV0IHN0cmVhbXMgPSBbXTsKICAgICAgICBpZiAodGhpcy5hc3NpZ25Mb2dvLmFzc2lnbkFsbCA9PSAxKSB7CiAgICAgICAgICBzdHJlYW1zID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzdHJlYW1zID0gdGhpcy5wbGF5bGlzdEVkaXRvci5zdHJlYW1zLmZpbHRlcigKICAgICAgICAgICAgKHN0cmVhbSkgPT4gIXN0cmVhbS5zdHJlYW1fdHZnX2xvZ28ubGVuZ3RoCiAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICBzdHJlYW1zLm1hcCgoc3RyZWFtKSA9PiB7CiAgICAgICAgICBsZXQgbWF0Y2gxID0gc3RyaW5nU2ltaWxhcml0eS5maW5kQmVzdE1hdGNoKAogICAgICAgICAgICBTdHJpbmcoc3RyZWFtLnN0cmVhbV90dmdfbmFtZSkucmVwbGFjZSgvIGhkJC9pLCAiIiksCiAgICAgICAgICAgIHRoaXMuYXNzaWduTG9nby5sb2dvcwogICAgICAgICAgKS5iZXN0TWF0Y2g7CiAgICAgICAgICBsZXQgbWF0Y2gyID0gc3RyaW5nU2ltaWxhcml0eS5maW5kQmVzdE1hdGNoKAogICAgICAgICAgICBTdHJpbmcoc3RyZWFtLnN0cmVhbV90dmdfaWQpLAogICAgICAgICAgICB0aGlzLmFzc2lnbkxvZ28ubG9nb3MKICAgICAgICAgICkuYmVzdE1hdGNoOwogICAgICAgICAgaWYgKG1hdGNoMS5yYXRpbmcgPj0gMC4zKSB7CiAgICAgICAgICAgIGNoYW5nZWQgPSB0cnVlOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19sb2dvID0gYGh0dHA6Ly9zdGF0aWMuaXB0di10b29scy5jb20vJHt0aGlzLmFzc2lnbkxvZ28uY291bnRyeX0vJHttYXRjaDEudGFyZ2V0fWA7CiAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICB9IGVsc2UgaWYgKG1hdGNoMi5yYXRpbmcgPj0gMC41KSB7CiAgICAgICAgICAgIGNoYW5nZWQgPSB0cnVlOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19sb2dvID0gYGh0dHA6Ly9zdGF0aWMuaXB0di10b29scy5jb20vJHt0aGlzLmFzc2lnbkxvZ28uY291bnRyeX0vJHttYXRjaDIudGFyZ2V0fWA7CiAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5wbGF5bGlzdEVkaXRvci5jaGFuZ2VkID0gY2hhbmdlZDsKICAgICAgfQogICAgICB0aGlzLmFzc2lnbkxvZ28ubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGxvYWRUVkdJREFzc2lnbihjb3VudHJ5KSB7CiAgICAgIHRoaXMuYXNzaWduVFZHSUQuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAuZ2V0KGBlZGl0b3IvdHYtZ3VpZGUvJHtjb3VudHJ5fWApCiAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgdGhpcy5hc3NpZ25UVkdJRC5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIHRoaXMuYXNzaWduVFZHSUQuY2hhbm5lbHMgPSByZXMuZGF0YTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICB0aGlzLmFzc2lnblRWR0lELmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0pOwogICAgfSwKICAgIGFzc2lnblRWR0lETW9kYWwoc2hvdywgc2F2ZSA9IGZhbHNlKSB7CiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgdmFyIGNoYW5nZWQgPSBmYWxzZTsKICAgICAgICB2YXIgc3RyaW5nU2ltaWxhcml0eSA9IHJlcXVpcmUoInN0cmluZy1zaW1pbGFyaXR5Iik7CiAgICAgICAgbGV0IHN0cmVhbXMgPSBbXTsKICAgICAgICBpZiAodGhpcy5hc3NpZ25UVkdJRC5hc3NpZ25BbGwgPT0gMSkgewogICAgICAgICAgc3RyZWFtcyA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtczsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc3RyZWFtcyA9IHRoaXMucGxheWxpc3RFZGl0b3Iuc3RyZWFtcy5maWx0ZXIoCiAgICAgICAgICAgIChzdHJlYW0pID0+CiAgICAgICAgICAgICAgIXN0cmVhbS5zdHJlYW1fdHZnX2lkLmxlbmd0aCB8fCBzdHJlYW0uc3RyZWFtX3R2Z19pZC5sZW5ndGggPT0gMAogICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgbGV0IGNoYW5uZWxOYW1lcyA9IHRoaXMuYXNzaWduVFZHSUQuY2hhbm5lbHMubWFwKAogICAgICAgICAgKGNoYW5uZWwpID0+IGNoYW5uZWwudHZnX25hbWUudG9Mb3dlckNhc2UoKQogICAgICAgICk7CiAgICAgICAgbGV0IGNoYW5uZWxJZHMgPSB0aGlzLmFzc2lnblRWR0lELmNoYW5uZWxzLm1hcCgKICAgICAgICAgIChjaGFubmVsKSA9PiBjaGFubmVsLnR2Z19pZC50b0xvd2VyQ2FzZSgpCiAgICAgICAgKTsKICAgICAgICBzdHJlYW1zLm1hcCgoc3RyZWFtKSA9PiB7CiAgICAgICAgICBsZXQgbWF0Y2gxID0gc3RyaW5nU2ltaWxhcml0eS5maW5kQmVzdE1hdGNoKAogICAgICAgICAgICBTdHJpbmcoc3RyZWFtLnN0cmVhbV90dmdfbmFtZSkudG9Mb3dlckNhc2UoKSwKICAgICAgICAgICAgY2hhbm5lbE5hbWVzCiAgICAgICAgICApLmJlc3RNYXRjaDsKICAgICAgICAgIGxldCBtYXRjaDIgPSBzdHJpbmdTaW1pbGFyaXR5LmZpbmRCZXN0TWF0Y2goCiAgICAgICAgICAgIFN0cmluZyhzdHJlYW0uc3RyZWFtX3R2Z19pZCkudG9Mb3dlckNhc2UoKSwKICAgICAgICAgICAgY2hhbm5lbElkcwogICAgICAgICAgKS5iZXN0TWF0Y2g7CiAgICAgICAgICBsZXQgbWF0Y2gzID0gc3RyaW5nU2ltaWxhcml0eS5maW5kQmVzdE1hdGNoKAogICAgICAgICAgICBTdHJpbmcoc3RyZWFtLnN0cmVhbV90dmdfbmFtZSkucmVwbGFjZSgKICAgICAgICAgICAgICAvIGhkJHwgZmhkJHwgaGV2YyR8IGgyNjUkfC9pLAogICAgICAgICAgICAgICIiCiAgICAgICAgICAgICkudG9Mb3dlckNhc2UoKSwKICAgICAgICAgICAgY2hhbm5lbE5hbWVzCiAgICAgICAgICApLmJlc3RNYXRjaDsKICAgICAgICAgIGlmIChtYXRjaDIucmF0aW5nID49IDAuNzUpIHsKICAgICAgICAgICAgY2hhbmdlZCA9IHRydWU7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX2lkID0gbWF0Y2gyLnRhcmdldDsKICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgIH0gZWxzZSBpZiAobWF0Y2gxLnJhdGluZyA+PSAwLjc1KSB7CiAgICAgICAgICAgIGNoYW5nZWQgPSB0cnVlOwogICAgICAgICAgICBzdHJlYW0uc3RyZWFtX3R2Z19pZCA9IHRoaXMuYXNzaWduVFZHSUQuY2hhbm5lbHMuZmluZCgKICAgICAgICAgICAgICAoY2hhbm5lbCkgPT4gY2hhbm5lbC50dmdfbmFtZS50b0xvd2VyQ2FzZSgpID09PSBtYXRjaDEudGFyZ2V0CiAgICAgICAgICAgICkudHZnX2lkOwogICAgICAgICAgICBzdHJlYW0ubW9kaWZpZWQgPSB0cnVlOwogICAgICAgICAgfSBlbHNlIGlmIChtYXRjaDMucmF0aW5nID49IDAuNzUpIHsKICAgICAgICAgICAgY2hhbmdlZCA9IHRydWU7CiAgICAgICAgICAgIHN0cmVhbS5zdHJlYW1fdHZnX2lkID0gdGhpcy5hc3NpZ25UVkdJRC5jaGFubmVscy5maW5kKAogICAgICAgICAgICAgIChjaGFubmVsKSA9PiBjaGFubmVsLnR2Z19uYW1lLnRvTG93ZXJDYXNlKCkgPT09IG1hdGNoMS50YXJnZXQKICAgICAgICAgICAgKS50dmdfaWQ7CiAgICAgICAgICAgIHN0cmVhbS5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjaGFuZ2VkID0gdHJ1ZTsKICAgICAgICAgICAgc3RyZWFtLnN0cmVhbV90dmdfaWQgPSAiIjsKICAgICAgICAgICAgc3RyZWFtLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSBjaGFuZ2VkOwogICAgICB9CiAgICAgIHRoaXMuYXNzaWduVFZHSUQubW9kYWwgPSBzaG93OwogICAgfSwKICAgIGxvYWRUVkdJREZpbmQoY291bnRyeSkgewogICAgICB0aGlzLmZpbmRUVkdJRC5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBodHRwU2VydmljZQogICAgICAgIC5nZXQoYGVkaXRvci90di1ndWlkZS8ke2NvdW50cnl9YCkKICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICB0aGlzLmZpbmRUVkdJRC5jaGFubmVsID0gIiI7CiAgICAgICAgICB0aGlzLmZpbmRUVkdJRC5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIHRoaXMuZmluZFRWR0lELmNoYW5uZWxzID0gcmVzLmRhdGEubWFwKChjaGFubmVsKSA9PiB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgdGV4dDogY2hhbm5lbC50dmdfbmFtZSwKICAgICAgICAgICAgICB2YWx1ZTogY2hhbm5lbC50dmdfaWQsCiAgICAgICAgICAgIH07CiAgICAgICAgICB9KTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICB0aGlzLmZpbmRUVkdJRC5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICB9KTsKICAgIH0sCiAgICBmaW5kVFZHSURNb2RhbChzaG93LCBzYXZlID0gZmFsc2UpIHsKICAgICAgbGV0IHNlbGVjdGVkID0gdGhpcy5nZXRTdHJlYW1XaXRoSWQodGhpcy5hY3RpdmVTdHJlYW1zWzBdKTsKICAgICAgaWYgKHNob3cpIHsKICAgICAgICB0aGlzLmZpbmRUVkdJRC5jaGFubmVsID0gIiI7CiAgICAgICAgdGhpcy5maW5kVFZHSUQudGl0bGUgPSBzZWxlY3RlZC5zdHJlYW1fdHZnX25hbWU7CiAgICAgIH0KICAgICAgdGhpcy5maW5kVFZHSUQuc2VhcmNoID0gIiI7CiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgaWYgKHNlbGVjdGVkKSB7CiAgICAgICAgICBzZWxlY3RlZC5zdHJlYW1fdHZnX2lkID0gdGhpcy5maW5kVFZHSUQuY2hhbm5lbDsKICAgICAgICAgIHNlbGVjdGVkLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMuZmluZFRWR0lELm1vZGFsID0gc2hvdzsKICAgIH0sCiAgICBpbXBvcnRNM1VNb2RhbChzaG93LCBzYXZlID0gZmFsc2UpIHsKICAgICAgaWYgKHNob3cpIHsKICAgICAgICB0aGlzLmltcG9ydE0zVS5maWxlID0gbnVsbDsKICAgICAgICB0aGlzLmltcG9ydE0zVS5tM3UgPSBudWxsOwogICAgICAgIHRoaXMuaW1wb3J0TTNVLmdyb3VwcyA9IFtdOwogICAgICAgIHRoaXMuaW1wb3J0TTNVLmltcG9ydEdyb3VwcyA9IFtdOwogICAgICB9CiAgICAgIGlmIChzYXZlKSB7CiAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlOwogICAgICAgIGxldCBncm91cEluZGV4ID0gdGhpcy5wbGF5bGlzdEVkaXRvci5ncm91cHMuZmluZEluZGV4KChncm91cCkgPT4gewogICAgICAgICAgcmV0dXJuIGdyb3VwLmlkID09IHRoaXMuYWN0aXZlR3JvdXA7CiAgICAgICAgfSk7CiAgICAgICAgaHR0cFNlcnZpY2UKICAgICAgICAgIC5wb3N0KCJlZGl0b3IvaW1wb3J0IiwgewogICAgICAgICAgICBwbGF5bGlzdF9pZDogdGhpcy5wbGF5bGlzdEVkaXRvci5pZCwKICAgICAgICAgICAgaW1wb3J0OiB0aGlzLmltcG9ydE0zVS5ncm91cHMuZmlsdGVyKChncm91cCwgaW5kZXgpID0+CiAgICAgICAgICAgICAgdGhpcy5pbXBvcnRNM1UuaW1wb3J0R3JvdXBzLmluY2x1ZGVzKGluZGV4KQogICAgICAgICAgICApLAogICAgICAgICAgfSkKICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKHJlcy5zdGF0dXMpIHsKICAgICAgICAgICAgICB0aGlzLmxvYWRQbGF5bGlzdCh0aGlzLnBsYXlsaXN0RWRpdG9yLmlkLCBncm91cEluZGV4KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSkKICAgICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB9KTsKICAgICAgfQogICAgICB0aGlzLmltcG9ydE0zVS5tb2RhbCA9IHNob3c7CiAgICB9LAogICAgdXBsb2FkTTNVKGV2ZW50KSB7CiAgICAgIGNvbnN0IGlucHV0ID0gZXZlbnQudGFyZ2V0OwogICAgICBpZiAoImZpbGVzIiBpbiBpbnB1dCAmJiBpbnB1dC5maWxlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgdGhpcy5pbXBvcnRNM1UuaXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgICB0aGlzLnJlYWRGaWxlQ29udGVudChpbnB1dC5maWxlc1swXSkKICAgICAgICAgIC50aGVuKChjb250ZW50KSA9PiB7CiAgICAgICAgICAgIHRoaXMuaW1wb3J0TTNVLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLnBhcnNlTTNVKGNvbnRlbnQpOwogICAgICAgICAgfSkKICAgICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHsKICAgICAgICAgICAgdGhpcy4kbm90aWZ5KAogICAgICAgICAgICAgICJlcnJvciIsCiAgICAgICAgICAgICAgdGhpcy4kdCgicHJvZmlsZS5mYWlsZWQiKSwKICAgICAgICAgICAgICBlcnJvciwKICAgICAgICAgICAgICAibGEtdXNlci1zaGllbGQiLAogICAgICAgICAgICAgIHsgZHVyYXRpb246IDUwMDAsIHBlcm1hbmVudDogZmFsc2UgfQogICAgICAgICAgICApOwogICAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBwYXJzZU0zVShjb250ZW50KSB7CiAgICAgIGxldCB2bSA9IHRoaXM7CiAgICAgIHZtLmltcG9ydE0zVS5pc0xvYWRpbmcgPSB0cnVlOwogICAgICBtM3UKICAgICAgICAucGFyc2UoCiAgICAgICAgICBjb250ZW50LAogICAgICAgICAgeyB0YWc6ICJuYW1lIiwgdHlwZTogWyJNb3ZpZSIsICJTZXJpZXMiLCAiVk9EIiwgIkxpdmUiXSB9LAogICAgICAgICAgdHJ1ZQogICAgICAgICkKICAgICAgICAudGhlbigocGxheWxpc3QpID0+IHsKICAgICAgICAgIHRoaXMuaW1wb3J0TTNVLm0zdSA9IHBsYXlsaXN0OwogICAgICAgICAgdGhpcy5pbXBvcnRNM1UuaXNMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICB0aGlzLmltcG9ydE0zVS5ncm91cHMgPSBwbGF5bGlzdC5ncm91cHM7CiAgICAgICAgICB0aGlzLmltcG9ydE0zVS5pbXBvcnRHcm91cHMgPSBbXTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHsKICAgICAgICAgIHZtLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgdm0uJG5vdGlmeSgKICAgICAgICAgICAgImVycm9yIiwKICAgICAgICAgICAgdm0uJHQoInByb2ZpbGUuZmFpbGVkIiksCiAgICAgICAgICAgIGVycm9yLAogICAgICAgICAgICAibGEtdXNlci1zaGllbGQiLAogICAgICAgICAgICB7IGR1cmF0aW9uOiA1MDAwLCBwZXJtYW5lbnQ6IGZhbHNlIH0KICAgICAgICAgICk7CiAgICAgICAgfSk7CiAgICB9LAogICAgcmVhZEZpbGVDb250ZW50KGZpbGUpIHsKICAgICAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgICAgICByZWFkZXIub25sb2FkID0gKGV2ZW50KSA9PiByZXNvbHZlKGV2ZW50LnRhcmdldC5yZXN1bHQpOwogICAgICAgIHJlYWRlci5vbmVycm9yID0gKGVycm9yKSA9PiByZWplY3QoZXJyb3IpOwogICAgICAgIHJlYWRlci5yZWFkQXNUZXh0KGZpbGUpOwogICAgICB9KTsKICAgIH0sCiAgfSwKICBiZWZvcmVNb3VudCgpIHsKICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmFkZCgicmlnaHQtbWVudSIpOwogICAgRXZlbnRCdXMuJG9uKCJzZWFyY2giLCB0aGlzLnNlYXJjaEVkaXRvcik7CiAgICBFdmVudEJ1cy4kb24oInByaW50IiwgdGhpcy5wcmludEVkaXRvcik7CiAgICBFdmVudEJ1cy4kb24oInRhYi1jaGFuZ2UiLCB0aGlzLmRvVGFiQ2hhbmdlKTsKICAgIEV2ZW50QnVzLiRvbigic2F2ZSIsIHRoaXMuZG9TYXZlKTsKICAgIEV2ZW50QnVzLiRvbigiY2FuY2VsIiwgdGhpcy5kb0NhbmNlbCk7CiAgICBpZiAodGhpcy5tb3ZpZVNlcmllUGxheWxpc3QpIHsKICAgICAgdGhpcy5sb2FkUGxheWxpc3QodGhpcy5tb3ZpZVNlcmllUGxheWxpc3QpOwogICAgfQogICAgdGhpcy5sb2FkTG9nb0NvdW50cmllcygpOwogICAgdGhpcy5sb2FkVFZHSURDb3VudHJpZXMoKTsKICB9LAogIGJlZm9yZURlc3Ryb3koKSB7CiAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5yZW1vdmUoInJpZ2h0LW1lbnUiKTsKICAgIEV2ZW50QnVzLiRvZmYoInNlYXJjaCIsIHRoaXMuc2VhcmNoRWRpdG9yKTsKICAgIEV2ZW50QnVzLiRvZmYoInByaW50IiwgdGhpcy5wcmludEVkaXRvcik7CiAgICBFdmVudEJ1cy4kb2ZmKCJ0YWItY2hhbmdlIiwgdGhpcy5kb1RhYkNoYW5nZSk7CiAgICBFdmVudEJ1cy4kb2ZmKCJzYXZlIiwgdGhpcy5kb1NhdmUpOwogICAgRXZlbnRCdXMuJG9mZigiY2FuY2VsIiwgdGhpcy5kb0NhbmNlbCk7CiAgfSwKICB3YXRjaDogewogICAgZHJhZ1N0cmVhbTogZnVuY3Rpb24gKHZhbCkgewogICAgICBpZiAoIXZhbCkgewogICAgICAgIHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCA9IHRydWU7CiAgICAgIH0KICAgIH0sCiAgICBkcmFnR3JvdXA6IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgaWYgKCF2YWwpIHsKICAgICAgICB0aGlzLnBsYXlsaXN0RWRpdG9yLmNoYW5nZWQgPSB0cnVlOwogICAgICB9CiAgICB9LAogICAgYWN0aXZlR3JvdXA6IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgaWYgKHRoaXMucGxheWxpc3RFZGl0b3IuY2hhbmdlZCkgewogICAgICAgIHRoaXMuc2F2ZUNoYW5nZXNNb2RhbCh0cnVlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmxvYWRTdHJlYW1zKCk7CiAgICAgIH0KICAgIH0sCiAgICAicGxheWxpc3RFZGl0b3IuY2hhbmdlZCI6IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgRXZlbnRCdXMuJGVtaXQoImVkaXRvci1jaGFuZ2VzIiwgdmFsKTsKICAgIH0sCiAgICAicmFkaW9Ccm93c2VyLnNlYXJjaCI6IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgbGV0IHZtID0gdGhpczsKICAgICAgY2xlYXJUaW1lb3V0KHRoaXMucmFkaW9Ccm93c2VyLmJvdW5jZSk7CiAgICAgIHRoaXMucmFkaW9Ccm93c2VyLmJvdW5jZSA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgIHZtLmZpbmRSYWRpb2Jyb3dzZXIodmFsKTsKICAgICAgfSwgNTAwKTsKICAgIH0sCiAgICAic291bmRjbG91ZC51cmwiOiBmdW5jdGlvbiAodmFsKSB7CiAgICAgIGxldCB2bSA9IHRoaXM7CiAgICAgIGNsZWFyVGltZW91dCh0aGlzLnJhZGlvQnJvd3Nlci5ib3VuY2UpOwogICAgICB0aGlzLnJhZGlvQnJvd3Nlci5ib3VuY2UgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICB2bS5nZXRTb3VuZGNsb3VkVHJhY2sodmFsLCB2bS5zb3VuZGNsb3VkQ2xpZW50SWQpOwogICAgICB9LCA1MDApOwogICAgfSwKICAgICJ5b3V0dWJlLnVybCI6IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgaWYgKCF2YWwubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmICgveW91dHVcLj9iZS9pLnRlc3QodmFsKSkgewogICAgICAgIHZhciBpOwogICAgICAgIHZhciBwYXR0ZXJucyA9IFsKICAgICAgICAgIC95b3V0dVwuYmVcLyhbXiMmP117MTF9KS8sIC8vIHlvdXR1LmJlLzxpZD4KICAgICAgICAgIC9cP3Y9KFteIyY/XXsxMX0pLywgLy8gP3Y9PGlkPgogICAgICAgICAgLyZ2PShbXiMmP117MTF9KS8sIC8vICZ2PTxpZD4KICAgICAgICAgIC9lbWJlZFwvKFteIyY/XXsxMX0pLywgLy8gZW1iZWQvPGlkPgogICAgICAgICAgL1wvdlwvKFteIyY/XXsxMX0pLywgLy8gL3YvPGlkPgogICAgICAgIF07CgogICAgICAgIGZvciAoaSA9IDA7IGkgPCBwYXR0ZXJucy5sZW5ndGg7ICsraSkgewogICAgICAgICAgaWYgKHBhdHRlcm5zW2ldLnRlc3QodmFsKSkgewogICAgICAgICAgICB0aGlzLnlvdXR1YmUudmlkZW9JZCA9IHBhdHRlcm5zW2ldLmV4ZWModmFsKVsxXTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdmFyIHRva2VucyA9IHZhbC5zcGxpdCgvWy8mPz0jLlxzXS9nKTsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdG9rZW5zLmxlbmd0aDsgKytpKSB7CiAgICAgICAgICBpZiAoL15bXiMmP117MTF9JC8udGVzdCh0b2tlbnNbaV0pKSB7CiAgICAgICAgICAgIHRoaXMueW91dHViZS52aWRlb0lkID0gdG9rZW5zW2ldOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB0aGlzLnlvdXR1YmUudmlkZW9JZCA9ICIiOwogICAgICB9IGVsc2UgewogICAgICAgIHRyeSB7CiAgICAgICAgICB2YXIgdXJscCA9IG5ldyBVUkwodmFsKTsKICAgICAgICAgIHRoaXMueW91dHViZS52aWRlb0lkID0gdXJscC5zZWFyY2hQYXJhbXMuZ2V0KCJ2Iik7CiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgIHRoaXMueW91dHViZS52aWRlb0lkID0gIiI7CiAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgInlvdXR1YmUudmlkZW9JZCI6IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgbGV0IHZtID0gdGhpczsKICAgICAgY2xlYXJUaW1lb3V0KHRoaXMueW91dHViZS5ib3VuY2UpOwogICAgICB0aGlzLnlvdXR1YmUuYm91bmNlID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKHZhbC5sZW5ndGgpIHsKICAgICAgICAgIHZtLmdldFlvdXR1YmVQYWdlKHZhbCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZtLnlvdXR1YmUudmlkZW8gPSBudWxsOwogICAgICAgIH0KICAgICAgfSwgNTAwKTsKICAgIH0sCiAgICAidmltZW8udXJsIjogZnVuY3Rpb24gKHZhbCkgewogICAgICBpZiAoL3ZpbWVvXC5jb20vaS50ZXN0KHZhbCkpIHsKICAgICAgICBsZXQgbWF0Y2ggPSB2YWwubWF0Y2goCiAgICAgICAgICAvKD86d3d3XC58cGxheWVyXC4pP3ZpbWVvLmNvbVwvKD86Y2hhbm5lbHNcLyg/Olx3K1wvKT98Z3JvdXBzXC8oPzpbXi9dKilcL3ZpZGVvc1wvfGFsYnVtXC8oPzpcZCspXC92aWRlb1wvfHZpZGVvXC98KShcZCspKD86W2EtekEtWjAtOV8tXSspPy9pCiAgICAgICAgKTsKICAgICAgICBpZiAobWF0Y2gubGVuZ3RoID49IDIpIHsKICAgICAgICAgIHRoaXMudmltZW8udmlkZW9JZCA9IG1hdGNoWzFdOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLnZpbWVvLnZpZGVvSWQgPSAiIjsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy52aW1lby52aWRlb0lkID0gIiI7CiAgICAgIH0KICAgIH0sCiAgICAidmltZW8udmlkZW9JZCI6IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgbGV0IHZtID0gdGhpczsKICAgICAgY2xlYXJUaW1lb3V0KHRoaXMudmltZW8uYm91bmNlKTsKICAgICAgdGhpcy52aW1lby5ib3VuY2UgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAodmFsLmxlbmd0aCkgewogICAgICAgICAgdm0uZ2V0VmltZW9Db25maWcodmFsKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdm0udmltZW8udmlkZW8gPSBudWxsOwogICAgICAgIH0KICAgICAgfSwgNTAwKTsKICAgIH0sCiAgICAiZGFpbHltb3Rpb24udXJsIjogZnVuY3Rpb24gKHZhbCkgewogICAgICBpZiAoL2RhaWx5bW90aW9uXC5jb20vaS50ZXN0KHZhbCkpIHsKICAgICAgICBsZXQgbWF0Y2ggPSB2YWwubWF0Y2goCiAgICAgICAgICAvXi4rZGFpbHltb3Rpb24uY29tXC8odmlkZW98aHViKVwvKFteX10rKVteI10qKCN2aWRlbz0oW15fJl0rKSk/L2kKICAgICAgICApOwogICAgICAgIGlmIChtYXRjaC5sZW5ndGggPj0gNCAmJiBtYXRjaFs0XSkgewogICAgICAgICAgdGhpcy5kYWlseW1vdGlvbi52aWRlb0lkID0gbWF0Y2hbNF07CiAgICAgICAgfSBlbHNlIGlmIChtYXRjaC5sZW5ndGggPj0gMikgewogICAgICAgICAgdGhpcy5kYWlseW1vdGlvbi52aWRlb0lkID0gbWF0Y2hbMl07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuZGFpbHltb3Rpb24udmlkZW9JZCA9ICIiOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmRhaWx5bW90aW9uLnZpZGVvSWQgPSAiIjsKICAgICAgfQogICAgfSwKICAgICJkYWlseW1vdGlvbi52aWRlb0lkIjogZnVuY3Rpb24gKHZhbCkgewogICAgICBsZXQgdm0gPSB0aGlzOwogICAgICBjbGVhclRpbWVvdXQodGhpcy5kYWlseW1vdGlvbi5ib3VuY2UpOwogICAgICB0aGlzLmRhaWx5bW90aW9uLmJvdW5jZSA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgIGlmICh2YWwubGVuZ3RoKSB7CiAgICAgICAgICB2bS5nZXREYWlseW1vdGlvbkNvbmZpZyh2YWwpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2bS5kYWlseW1vdGlvbi52aWRlbyA9IG51bGw7CiAgICAgICAgfQogICAgICB9LCA1MDApOwogICAgfSwKICAgICJ0ZWRUYWxrcy51cmwiOiBmdW5jdGlvbiAodmFsKSB7CiAgICAgIGlmICgvdGVkXC5jb21cL3RhbGtzL2kudGVzdCh2YWwpKSB7CiAgICAgICAgbGV0IHZtID0gdGhpczsKICAgICAgICBjbGVhclRpbWVvdXQodGhpcy50ZWRUYWxrcy5ib3VuY2UpOwogICAgICAgIHRoaXMudGVkVGFsa3MuYm91bmNlID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBpZiAodmFsLmxlbmd0aCkgewogICAgICAgICAgICB2bS5nZXRUZWRUYWxrc0NvbmZpZyh2YWwpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdm0udGVkVGFsa3MudmlkZW8gPSBudWxsOwogICAgICAgICAgfQogICAgICAgIH0sIDUwMCk7CiAgICAgIH0KICAgIH0sCiAgICAieGhhbXN0ZXIudXJsIjogZnVuY3Rpb24gKHZhbCkgewogICAgICBsZXQgdm0gPSB0aGlzOwogICAgICBpZiAoL3hoYW1zdGVyXC5jb21cL3ZpZGVvcy9pLnRlc3QodmFsKSkgewogICAgICAgIGNsZWFyVGltZW91dCh0aGlzLnhoYW1zdGVyQm91bmNlKTsKICAgICAgICB0aGlzLnhoYW1zdGVyQm91bmNlID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBpZiAodmFsLmxlbmd0aCkgewogICAgICAgICAgICB2bS5nZXRYaGFtc3RlckNvbmZpZyh2YWwpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdm0ueGhhbXN0ZXIudmlkZW8gPSBudWxsOwogICAgICAgICAgfQogICAgICAgIH0sIDUwMCk7CiAgICAgIH0KICAgIH0sCiAgICAiZmluZExvZ28uY291bnRyeSI6IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgaWYgKHZhbC5sZW5ndGgpIHsKICAgICAgICB0aGlzLmxvYWRMb2dvc0ZpbmQodmFsKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmZpbmRMb2dvLmxvZ28gPSAiIjsKICAgICAgfQogICAgfSwKICAgICJhc3NpZ25Mb2dvLmNvdW50cnkiOiBmdW5jdGlvbiAodmFsKSB7CiAgICAgIGlmICh2YWwubGVuZ3RoKSB7CiAgICAgICAgdGhpcy5sb2FkTG9nb3NBc3NpZ24odmFsKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmFzc2lnbkxvZ28ubG9nbyA9ICIiOwogICAgICB9CiAgICB9LAogICAgImZpbmRUVkdJRC5jb3VudHJ5IjogZnVuY3Rpb24gKHZhbCkgewogICAgICBpZiAodmFsLmxlbmd0aCkgewogICAgICAgIHRoaXMubG9hZFRWR0lERmluZCh2YWwpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZmluZFRWR0lELmNoYW5uZWwgPSAiIjsKICAgICAgfQogICAgfSwKICAgICJhc3NpZ25UVkdJRC5jb3VudHJ5IjogZnVuY3Rpb24gKHZhbCkgewogICAgICBpZiAodmFsLmxlbmd0aCkgewogICAgICAgIHRoaXMubG9hZFRWR0lEQXNzaWduKHZhbCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5hc3NpZ25UVkdJRC5jaGFubmVscyA9IFtdOwogICAgICB9CiAgICB9LAogICAgbW92aWVTZXJpZVBsYXlsaXN0OiBmdW5jdGlvbiAodmFsKSB7CiAgICAgIHRoaXMubG9hZFBsYXlsaXN0KHZhbCk7CiAgICB9LAogIH0sCn07Cg=="},null]}